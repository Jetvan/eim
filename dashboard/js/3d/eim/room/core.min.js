if(!demo)var demo={};demo.Default={LAZY_MIN:10,LAZY_MAX:500,CLEAR_COLOR:"#000000",_envmaps:{},_creators:{},_filters:{},_templates:{},registerCreator:function(e,t){this._creators[e]=t},getCreator:function(e){return this._creators[e]},registerFilter:function(e,t){this._filters[e]=t},getFilter:function(e){return this._filters[e]},registerTemplates:function(e,t){this._templates[e]=t},getTemplates:function(e){return this._templates[e]},setup:function(e){demo.Default.loadImages(["images/outside_lightmap.png","images/table_shadow.png","images/conf_table_shadow.png"]);var t=new mono.Network3D,a=new mono.PerspectiveCamera(30,1.5,30,5e4);a.setPosition(1500,3200,4e3),t.setCamera(a);var o=t.getDefaultInteraction();o.yLowerLimitAngle=Math.PI/180*2,o.yUpLimitAngle=Math.PI/2,o.maxDistance=3e4,o.minDistance=50,o.zoomSpeed=3,o.panSpeed=.2,t.isSelectable=function(e){return!1},document.getElementById(e).appendChild(t.getRootView()),mono.Utils.autoAdjustNetworkBounds(t,document.documentElement,"clientWidth","clientHeight"),t.getRootView().addEventListener("dblclick",function(e){demo.Default.handleDoubleClick(e,t)}),demo.Default.setupLights(t.getDataBox()),demo.Default.loadTempJson();var n=((new Date).getTime(),demo.Default.filterJson(t.getDataBox(),scenceJson.objects));demo.Default.loadJson(t,n,scenceJson.clearColor);(new Date).getTime()},setupLights:function(e){var t=new mono.PointLight(16777215,.3);t.setPosition(0,1e3,-1e3),e.add(t);var t=new mono.PointLight(16777215,.3);t.setPosition(0,1e3,1e3),e.add(t);var t=new mono.PointLight(16777215,.3);t.setPosition(1e3,-1e3,-1e3),e.add(t),e.add(new mono.AmbientLight("white"))},handleDoubleClick:function(e,t){var a=t.getCamera(),o=t.getDefaultInteraction(),n=demo.Default.findFirstObjectByMouse(t,e);if(n){var i=n.element,r=n.point,m=a.getTarget();if(demo.Default.animateCamera(a,o,m,r,function(){i.getClient("animation")&&demo.Default.playAnimation(i,i.getClient("animation"))}),i.getStyle("lazy.function")){var s=i.getStyle("lazy.function");(new Date).getTime();s();(new Date).getTime()}}else{var m=a.getTarget(),r=new mono.Vec3(0,0,0);demo.Default.animateCamera(a,o,m,r)}},getEnvmap:function(e){return this._envmaps[e]},setEnvmap:function(e,t){this._envmaps[e]=t},copyProperties:function(e,t,a){if(e&&t)for(var o in e)a&&a.indexOf(o)>=0||(t[o]=e[o])},createAnnotationObject:function(e){var t=e.translate||[0,0,0],a=e.label,o=e.text,n=new mono.Annotation(a,o);return n.setPosition(t[0],t[1],t[2]),n},createCubeObject:function(e){var t=e.translate||[0,0,0],a=e.width,o=e.height,n=e.depth,i=e.sideColor,r=e.topColor,m=new mono.Cube(a,o,n);return m.setPosition(t[0],t[1]+o/2,t[2]),m.s({"m.color":i,"m.ambient":i,"left.m.lightmap.image":"./js/plugins/eim/room/images/inside_lightmap.png","right.m.lightmap.image":"./js/plugins/eim/room/images/outside_lightmap.png","front.m.lightmap.image":"./js/plugins/eim/room/images/outside_lightmap.png","back.m.lightmap.image":"./js/plugins/eim/room/images/inside_lightmap.png","top.m.color":r,"top.m.ambient":r,"bottom.m.color":r,"bottom.m.ambient":r}),m},createCylinderObject:function(e){var t=e.translate||[0,0,0],a=e.radius||10,o=e.topRadius||a,n=e.bottomRadius||a,i=e.height,r=e.sideColor||"#A5BDDD",m=new mono.Cylinder(o,n,i);return m.setPosition(t[0],t[1]+i/2,t[2]),m.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":r,"m.ambient":r,"side.m.lightmap.image":"./js/plugins/eim/room/images/inside_lightmap.png"}),m},createPathObject:function(e){for(var t=e.translate||[0,0,0],a=e.width,o=e.height,n=e.data,i=void 0,r=e.insideColor,m=e.outsideColor,s=e.asideColor||m,l=e.zsideColor||m,g=e.topColor,u=e.bottomColor||g,c=e.insideImage,d=e.outsideImage,p=e.topImage,h=e.repeat||e.height,f=0;f<n.length;f++){var v=n[f];i?i.lineTo(v[0],v[1],0):(i=new mono.Path,i.moveTo(v[0],v[1],0))}var w=this.createWall(i,a,o,r,m,s,l,g,u,c,d,p,h);return w.setPosition(t[0],t[1],-t[2]),w},createPathNodeObject:function(e){for(var t=e.translate||[0,0,0],a=e.scale||[1,1,1],o=e.radius||5,n=void 0,i=e.data,r=e.pathImage,m=e.repeat,s=0;s<i.length;s++){var l=i[s];n?"c"===l[0]?n.quadraticCurveTo(l[1],10,l[2],l[3],10,l[4]):n.lineTo(l[0],10,l[1]):(n=new mono.Path,n.moveTo(l[0],10,l[1]))}var g=this.createPathNode(n,o,r,m,t,a);return g},filterJson:function(e,t){for(var a=[],o=0;o<t.length;o++){var n=t[o],i=n.type,r=this.getFilter(i);if(r){var m=r(e,n);m&&(m instanceof Array?a=a.concat(m):(this.copyProperties(n,m,["type"]),a.push(m)))}else a.push(n)}return a},createCombo:function(e){for(var t=[],a=[],o=[],n=0;n<e.length;n++){var i=e[n],r=i.op||"+",m=i.style,s=i.client,l=(i.translate||[0,0,0],i.rotate||[0,0,0]),g=null;if("path"===i.type&&(g=this.createPathObject(i)),"cube"===i.type&&(g=this.createCubeObject(i)),"cylinder"===i.type&&(g=this.createCylinderObject(i)),"pathNode"===i.type&&(g=this.createPathNodeObject(i)),g){if(g.setRotation(l[0],l[1],l[2]),m&&g.s(m),s)for(var n in s)g.setClient(n,s[n]);t.push(g),t.length>1&&a.push(r),o.push(g.getId())}}if(t.length>0){var u=new mono.ComboNode(t,a);return u.setNames(o),u}return null},loadJson:function(e,t,a){var o=e.getDataBox(),a=a||demo.Default.CLEAR_COLOR;e.setClearColor(a),e.setClearColor(0,0,0),e.setClearAlpha(0);var n,i,r=[],m=[],s=[];console.log(t.length);for(var l=0;l<t.length;l++){var g=t[l];if(!g.shadowGhost){var u=g.op,c=g.style,d=g.client,p=(g.translate||[0,0,0],g.rotate||[0,0,0]),h=null;"path"===g.type&&(h=this.createPathObject(g)),"cube"===g.type&&(h=this.createCubeObject(g)),"annotation"===g.type&&(h=this.createAnnotationObject(g)),"pathNode"===g.type&&(h=this.createPathNodeObject(g)),"cylinder"===g.type&&(h=this.createCylinderObject(g)),g.shadowHost&&(n=h,i=h.getId());var f=demo.Default.getCreator(g.type);f?f(o,g):h&&(h.setRotation(p[0],p[1],p[2]),c&&h.s(c),d&&h.c(d),u?(r.push(h),r.length>1&&m.push(u),s.push(h.getId())):o.add(h))}}if(r.length>0){var v=new mono.ComboNode(r,m);if(v.setNames(s),o.add(v),n&&i){var w=function(e,a,o){return function(){var n=((new Date).getTime(),demo.Default.createShadowImage(t,a.getWidth(),a.getDepth())),i=o+"-top.m.lightmap.image";e.setStyle(i,n);(new Date).getTime()}};setTimeout(w(v,n,i),demo.Default.LAZY_MAX)}}},loadRackContent:function(e,t,a,o,n,i,r,m,s,l,g){for(var u=10,c=9,d=2,p=!1;u<200;){var h="server"+(parseInt(3*Math.random())+1)+".png",f=u>100&&!p&&m?m.color:null,v=this.createServer(e,s,l,h,f);if(f&&(p=!0),v.setPositionY(u),v.setPositionZ(v.getPositionZ()+5),"server3.png"===h?(v.setScaleY(6),u+=6*c):u+=c,u+=d,u>200){e.remove(v);break}}},createServer:function(e,t,a,o,n){var i=t.getPositionX(),r=t.getPositionZ(),m=a.getWidth(),s=8,l=a.getDepth(),g=new mono.Cube(m,s,l);n=n?n:"#5B6976",g.s({"m.color":n,"m.ambient":n,"m.type":"phong","m.texture.image":"./js/plugins/eim/room/images/rack_inside.png"}),g.setPosition(i+.5,s/2,r+(t.getDepth()-g.getDepth())/2);var u=new mono.Cube(m+2,s+1,.5);n=n?n:"#5BA1AF",u.s({"m.type":"phong","m.texture.image":"./js/plugins/eim/room/images/rack_inside.png","front.m.texture.image":"./js/plugins/eim/room/images/"+o,"front.m.texture.repeat":new mono.Vec2(1,1),"m.specularStrength":100,"m.color":n,"m.ambient":n}),u.setPosition(i+.5,(s+1)/2,r+g.getDepth()/2+(t.getDepth()-g.getDepth())/2);var c=new mono.ComboNode([g,u],["+"]);return c.setClient("animation","pullOut.z"),c.setPositionZ(c.getPositionZ()-5),e.add(c),c},createWall:function(e,t,a,o,n,i,r,m,s,l,g,u,c){var d=new mono.PathCube(e,t,a);return d.s({"outside.m.color":n,"inside.m.type":"basic","inside.m.color":o,"aside.m.color":i,"zside.m.color":r,"top.m.color":m,"bottom.m.color":s,"inside.m.texture.image":l,"outside.m.texture.image":g,"top.m.texture.image":u,"inside.m.lightmap.image":"./js/plugins/eim/room/images/inside_lightmap.png","outside.m.lightmap.image":"./js/plugins/eim/room/images/outside_lightmap.png","aside.m.lightmap.image":"./js/plugins/eim/room/images/outside_lightmap.png","zside.m.lightmap.image":"./js/plugins/eim/room/images/outside_lightmap.png"}),d.setRepeat(c),d},createShadowImage:function(e,t,a){var o=document.createElement("canvas");o.width=t,o.height=a;var n=o.getContext("2d");n.beginPath(),n.rect(0,0,t,a),n.fillStyle="white",n.fill();var i=!1;i&&(n.lineWidth=1,n.strokeStyle="black",n.stroke());for(var r=0;r<e.length;r++){var m=e[r];if(m.floorShadow){var s=m.translate||[0,0,0],l=m.rotate||[0,0,0],l=-l[1];if("path"===m.type){var g=t/2+s[0],u=a-(a/2+s[2]),c=m.data;n.save(),n.translate(g,u),n.rotate(l),n.beginPath();for(var d=!0,p=0;p<c.length;p++){var h=c[p];d?(n.moveTo(h[0],-h[1]),d=!1):n.lineTo(h[0],-h[1])}n.lineWidth=m.width,n.strokeStyle="#C8C8C8",n.shadowColor="#222222",n.shadowBlur=60,n.shadowOffsetX=0,n.shadowOffsetY=0,n.stroke(),n.restore()}if("cube"===m.type){var g=t/2+s[0],u=a/2+s[2],f=m.width,v=m.depth;n.save(),n.translate(g,u),n.rotate(l),n.beginPath(),n.moveTo(-f/2,0),n.lineTo(f/2,0),n.lineWidth=v,n.strokeStyle="white",n.shadowColor="#222222",n.shadowBlur=60,n.shadowOffsetX=0,n.shadowOffsetY=0,n.stroke(),n.restore()}if("rack"===m.type||"electric"===m.type){var g=t/2+s[0],u=a/2+s[2],f=e.width||60,w=e.height||200,b=e.depth||80,f=.99*f,v=.99*b;n.beginPath(),n.moveTo(g-f/2,u),n.lineTo(g+f/2,u),n.lineWidth=v,n.strokeStyle="black",n.shadowColor="black",n.shadowBlur=100,n.shadowOffsetX=0,n.shadowOffsetY=0,n.stroke(),n.restore()}if("plant"===m.type){var g=t/2+s[0],u=a/2+s[2],C=m.scale||[1,1,1],y=11*Math.min(C[0],C[2]);n.beginPath(),n.arc(g,u,y,0,2*Math.PI,!1),n.lineWidth=v,n.fillStyle="black",n.shadowColor="black",n.shadowBlur=25,n.shadowOffsetX=0,n.shadowOffsetY=0,n.fill(),n.restore()}}else if(m.shadowImage&&demo.Default.loaded){var s=m.translate||[0,0,0],g=t/2+s[0],u=a/2+s[2],l=m.rotate||[0,0,0];l=-l[1];var D=m.shadowImage,P=D.src,f=D.width||100,w=D.height||100,_=D.xOffset||0,j=D.yOffset||0;n.save(),n.translate(g,u),n.rotate(l),n.globalAlpha=.5,n.shadowColor="black",n.shadowBlur=50,n.shadowOffsetX=0,n.shadowOffsetY=0;var A=demo.Default.images[P];n.drawImage(A,-f/2+_,-w/2+j,f,w),n.translate(-g,-u),n.restore()}}return o},createTree:function(e,t,a,o,n,i){var r;if(demo.Default._treeInstance)r=demo.Default._treeInstance.clone();else{var m=100,s=200,l="./js/plugins/eim/images/tree.png",g=[],u=new mono.Cylinder(1,5,s,10,1,(!1),(!1));u.s({"m.type":"phong","m.color":"#411212","m.ambient":"#411212","m.texture.repeat":new mono.Vec2(10,4),"m.specularmap.image":"./js/plugins/eim/room/images/metal_normalmap.jpg","m.normalmap.image":"./js/plugins/eim/room/images/metal_normalmap.jpg"}),g.push(u);for(var c=5,d=0;d<c;d++){var p=new mono.Cube(m,s+20,.01);p.s({"m.transparent":!0,"front.m.visible":!0,"front.m.texture.image":l,"back.m.visible":!0,"back.m.texture.image":l}),p.setSelectable(!1),p.setEditable(!1),p.setParent(u),p.setPositionY(20),p.setRotationY(Math.PI*d/c),g.push(p)}demo.Default._treeInstance=new mono.ComboNode(g),demo.Default._treeInstance.setClient("tree.original.y",u.getHeight()/2*n),r=demo.Default._treeInstance}return r.setPosition(e,r.getClient("tree.original.y")+t,a),r.setScale(o,n,i),r},createPlant:function(e,t,a,o,n,i){var r;if(demo.Default._plantInstance)r=demo.Default._plantInstance.clone();else{var m=30,s=30,l="./js/plugins/eim/room/images/plant.png",g=[],u=new mono.Cylinder(.5*m,.4*m,2*s,20,1,(!1),(!1));u.s({"m.type":"phong","m.color":"#ADADAD","m.ambient":"#ADADAD","m.texture.repeat":new mono.Vec2(10,4),"m.specularmap.image":"./js/plugins/eim/room/images/metal_normalmap.jpg","m.normalmap.image":"./js/plugins/eim/room/images/metal_normalmap.jpg"});var c=u.clone();c.setScale(.9,1,.9);var d=c.clone();d.setScale(.9,.9,.9),d.s({"m.type":"phong","m.color":"#163511","m.ambient":"#163511","m.texture.repeat":new mono.Vec2(10,4)});var p=new mono.ComboNode([u,c,d],["-","+"]);g.push(p);for(var h=5,f=0;f<h;f++){var r=new mono.Cube(2*m,s+20,.01);r.s({"m.transparent":!0,"front.m.visible":!0,"front.m.texture.image":l,"back.m.visible":!0,"back.m.texture.image":l}),r.setSelectable(!1),r.setEditable(!1),r.setParent(p),r.setPositionY(u.getHeight()/2+r.getHeight()/2-20),r.setRotationY(Math.PI*f/h),g.push(r)}demo.Default._plantInstance=new mono.ComboNode(g),demo.Default._plantInstance.setClient("plant.original.y",u.getHeight()/2+u.getHeight()/4*Math.min(o,i)),r=demo.Default._plantInstance}return r.setPosition(e,r.getClient("plant.original.y")+t,a),r.setScale(o,n,i),r},createPathNode:function(e,t,a,o,n,i){var n=n||[0,0,0],i=i||[1,1,1],o=o||new mono.Vec2(1,1),r=new mono.PathNode(e);return r.s({"m.texture.image":a,"m.texture.repeat":o}),r.setRadius(t),r.setScale(i[0],i[1],i[2]),r.setPosition(n[0],n[1],n[2]),r},createShapeNode:function(e,t,a,o,n){var i=new mono.ShapeNode(e);return i.s({"m.type":"phong","m.color":"#2D2F31","m.ambient":"#2D2F31","m.specular":"#e5e5e5","m.normalmap.image":"./js/plugins/eim/room/images/metal_normalmap.jpg","m.texture.repeat":new mono.Vec2(10,6),"m.specularStrength":3}),i.setVertical(!0),i.setAmount(t),i.setPosition(a,o,n),i},createPathCube:function(e,t,a,o,n,i){var r=new mono.PathCube(e,t,a);return r.s({"m.type":"phong","m.color":"#2D2F31","m.ambient":"#2D2F31","m.specular":"#e5e5e5","m.normalmap.image":"./js/plugins/eim/room/images/metal_normalmap.jpg","m.texture.repeat":new mono.Vec2(10,6),"m.specularStrength":3}),r.setPosition(o,n,i),r},findFirstObjectByMouse:function(e,t){var a=e.getElementsByMouseEvent(t);if(a.length)for(var o=0;o<a.length;o++){var n=a[o],i=n.element;if(!(i instanceof mono.Billboard))return n}return null},animateCamera:function(e,t,a,o,n){twaver.Util.stopAllAnimates(!0);var i=e.getPosition().sub(e.getTarget()),r=new twaver.Animate({from:0,to:1,dur:500,easing:"easeBoth",onUpdate:function(n){var r=a.x+(o.x-a.x)*n,m=a.y+(o.y-a.y)*n,s=a.z+(o.z-a.z)*n,l=new mono.Vec3(r,m,s);e.lookAt(l),t.target=l;var g=(new mono.Vec3).addVectors(i,l);e.setPosition(g)}});r.onDone=n,r.play()},playAnimation:function(e,t){var a=t.split(".");if("pullOut"===a[0]){var o=a[1];demo.Default.animatePullOut(e,o)}if("rotate"===a[0]){var n=a[1],i=a[2];demo.Default.animateRotate(e,n,i)}},animatePullOut:function(e,t){twaver.Util.stopAllAnimates(!0);var a=e.getBoundingBox().size().multiply(e.getScale()),o=.8,n=new mono.Vec3(0,0,1),i=0;"x"===t&&(n=new mono.Vec3(1,0,0),i=a.x),"-x"===t&&(n=new mono.Vec3((-1),0,0),i=a.x),"y"===t&&(n=new mono.Vec3(0,1,0),i=a.y),"-y"===t&&(n=new mono.Vec3(0,(-1),0),i=a.y),"z"===t&&(n=new mono.Vec3(0,0,1),i=a.z),"-z"===t&&(n=new mono.Vec3(0,0,(-1)),i=a.z),i*=o,e.getClient("animated")&&(n=n.negate());var r=e.getPosition().clone();e.setClient("animated",!e.getClient("animated")),new twaver.Animate({from:0,to:1,dur:2e3,easing:"bounceOut",onUpdate:function(t){e.setPosition(r.clone().add(n.clone().multiplyScalar(i*t)))}}).play()},animateRotate:function(e,t,a){twaver.Util.stopAllAnimates(!0);var o=e.getBoundingBox().size().multiply(e.getScale()),n=0,i=1;e.getClient("animated")&&(i=-1),e.setClient("animated",!e.getClient("animated"));var r,m;if("left"===t){r=new mono.Vec3(-o.x/2,0,0);var m=new mono.Vec3(0,1,0)}if("right"===t){r=new mono.Vec3(o.x/2,0,0);var m=new mono.Vec3(0,1,0)}var s=new twaver.Animate({from:n,to:i,dur:1800,easing:"bounceOut",onUpdate:function(t){void 0===this.lastValue&&(this.lastValue=0),e.rotateFromAxis(m.clone(),r.clone(),Math.PI/180*a*(t-this.lastValue)),this.lastValue=t},onDone:function(){delete this.lastValue}});s.play()},getRandomInt:function(e){return parseInt(Math.random()*e)},getRandomLazyTime:function(){var e=demo.Default.LAZY_MAX-demo.Default.LAZY_MIN;return demo.Default.getRandomInt(e)+demo.Default.LAZY_MIN},parseSVG:function(e){return e.loadXml(e)},loadImages:function(e){function t(t){a++,a>=e.length&&(demo.Default.loaded=!0)}demo.Default.images={};for(var a=0,o=0;o<e.length;o++){var n=new Image;n.onload=t,n.src=e[o],demo.Default.images[e[o]]=n}}};