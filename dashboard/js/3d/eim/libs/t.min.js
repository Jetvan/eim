!function(t,e){function r(t,e,i,r,a,n){var s=a.realSize?a.realSize:a;e=e||"",e=String(e),t.font=i,t.fillStyle=r,t.strokeStyle="gray",t.textBaseline="middle",t.textAlign="center";for(var o=e.split("\n"),l=o.length,h=s.height/l,c=(a.height-s.height)/2,u=0;u<l;u++){var f=ni.getTextSize(i,o[u]).width,d=(a.height,f/2);"right"==n?(d=a.width-f/2,t.textAlign="center"):"left"==n?(d=f/2,t.textAlign="center",t.textBaseline="middle"):"center"==n&&(d=a.width/2),t.strokeText(o[u],d,h/2+u*h+c),t.fillText(o[u],d,h/2+u*h+c)}}function n(t,e){var i=0;if(t.shadowMatrix)for(var r=0,a=e.size();r<a;r++){var n=e.get(r);n.refreshShadowUniforms(t,i)&&i++}}function s(t,e){var i=0;if(t.pShadowMap)for(var r=0,a=e.size();r<a;r++){var n=e.get(r);n.refreshUniformsPointShadow(t,i)&&i++}}function o(t,e,i){e._modelViewMatrix||(e._modelViewMatrix=new ti),i.uniformMatrix4fv(t.modelViewMatrix,!1,e._modelViewMatrix.elements),t.normalMatrix&&i.uniformMatrix3fv(t.normalMatrix,!1,e._normalMatrix.elements)}function l(t,e,i){var r;return"fragment"===t?r=i.createShader(i.FRAGMENT_SHADER):"vertex"===t&&(r=i.createShader(i.VERTEX_SHADER)),i.shaderSource(r,e),i.compileShader(r),i.getShaderParameter(r,i.COMPILE_STATUS)?r:(console.log(i.getShaderInfoLog(r)),console.error(e),null)}function h(t,e){t.ambientLightColor.value=e.ambient,t.directionalLightColor.value=e.directional.colors,t.directionalLightDirection.value=e.directional.positions,t.pointLightColor.value=e.point.colors,t.pointLightPosition.value=e.point.positions,t.pointLightDistance.value=e.point.distances,t.spotLightColor.value=e.spot.colors,t.spotLightPosition.value=e.spot.positions,t.spotLightDistance.value=e.spot.distances,t.spotLightDirection.value=e.spot.directions,t.spotLightAngleCos.value=e.spot.anglesCos,t.spotLightExponent.value=e.spot.exponents,t.hemisphereLightSkyColor.value=e.hemi.skyColors,t.hemisphereLightGroundColor.value=e.hemi.groundColors,t.hemisphereLightDirection.value=e.hemi.positions}function f(t,e,i,r){t[e]=i.r*r,t[e+1]=i.g*r,t[e+2]=i.b*r}function d(t,e,i,r){t[e]=i.r*i.r*r,t[e+1]=i.g*i.g*r,t[e+2]=i.b*i.b*r}function p(t){var e=t;xi.isNaN(e._renderInterval)&&(e._renderInterval=10),e.__timeOutFunc||(e.__timeOutFunc=function(){requestAnimationFrame(e.__timeOutFunc),e.render()}),setTimeout(e.__timeOutFunc,e._renderInterval)}function m(t,e,i){null!=t&&("number"==typeof t?this.fromNumber(t,e,i):null==e&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,e))}function g(){return new m(null)}function y(t,e,i,r,a,n){for(;--n>=0;){var s=e*this[t++]+i[r]+a;a=Math.floor(s/67108864),i[r++]=67108863&s}return a}function v(t,e,i,r,a,n){for(var s=32767&e,o=e>>15;--n>=0;){var l=32767&this[t],h=this[t++]>>15,c=o*l+h*s;l=s*l+((32767&c)<<15)+i[r]+(1073741823&a),a=(l>>>30)+(c>>>15)+o*h+(a>>>30),i[r++]=1073741823&l}return a}function x(t,e,i,r,a,n){for(var s=16383&e,o=e>>14;--n>=0;){var l=16383&this[t],h=this[t++]>>14,c=o*l+h*s;l=s*l+((16383&c)<<14)+i[r]+a,a=(l>>28)+(c>>14)+o*h,i[r++]=268435455&l}return a}function w(t){return Ni.charAt(t)}function _(t,e){var i=Bi[t.charCodeAt(e)];return null==i?-1:i}function M(t){for(var e=this.t-1;e>=0;--e)t[e]=this[e];t.t=this.t,t.s=this.s}function S(t){this.t=1,this.s=t<0?-1:0,t>0?this[0]=t:t<-1?this[0]=t+DV:this.t=0}function A(t){var e=g();return e.fromInt(t),e}function P(t,e){var i;if(16==e)i=4;else if(8==e)i=3;else if(256==e)i=8;else if(2==e)i=1;else if(32==e)i=5;else{if(4!=e)return void this.fromRadix(t,e);i=2}this.t=0,this.s=0;for(var r=t.length,a=!1,n=0;--r>=0;){var s=8==i?255&t[r]:_(t,r);s<0?"-"==t.charAt(r)&&(a=!0):(a=!1,0==n?this[this.t++]=s:n+i>this.DB?(this[this.t-1]|=(s&(1<<this.DB-n)-1)<<n,this[this.t++]=s>>this.DB-n):this[this.t-1]|=s<<n,n+=i,n>=this.DB&&(n-=this.DB))}8==i&&0!=(128&t[0])&&(this.s=-1,n>0&&(this[this.t-1]|=(1<<this.DB-n)-1<<n)),this.clamp(),a&&m.ZERO.subTo(this,this)}function T(){for(var t=this.s&this.DM;this.t>0&&this[this.t-1]==t;)--this.t}function C(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var i,r=(1<<e)-1,a=!1,n="",s=this.t,o=this.DB-s*this.DB%e;if(s-- >0)for(o<this.DB&&(i=this[s]>>o)>0&&(a=!0,n=w(i));s>=0;)o<e?(i=(this[s]&(1<<o)-1)<<e-o,i|=this[--s]>>(o+=this.DB-e)):(i=this[s]>>(o-=e)&r,o<=0&&(o+=this.DB,--s)),i>0&&(a=!0),a&&(n+=w(i));return a?n:"0"}function z(){var t=g();return m.ZERO.subTo(this,t),t}function L(){return this.s<0?this.negate():this}function E(t){var e=this.s-t.s;if(0!=e)return e;var i=this.t;if(e=i-t.t,0!=e)return e;for(;--i>=0;)if(0!=(e=this[i]-t[i]))return e;return 0}function D(t){var e,i=1;return 0!=(e=t>>>16)&&(t=e,i+=16),0!=(e=t>>8)&&(t=e,i+=8),0!=(e=t>>4)&&(t=e,i+=4),0!=(e=t>>2)&&(t=e,i+=2),0!=(e=t>>1)&&(t=e,i+=1),i}function N(){return this.t<=0?0:this.DB*(this.t-1)+D(this[this.t-1]^this.s&this.DM)}function B(t,e){var i;for(i=this.t-1;i>=0;--i)e[i+t]=this[i];for(i=t-1;i>=0;--i)e[i]=0;e.t=this.t+t,e.s=this.s}function R(t,e){for(var i=t;i<this.t;++i)e[i-t]=this[i];e.t=Math.max(this.t-t,0),e.s=this.s}function F(t,e){var i,r=t%this.DB,a=this.DB-r,n=(1<<a)-1,s=Math.floor(t/this.DB),o=this.s<<r&this.DM;for(i=this.t-1;i>=0;--i)e[i+s+1]=this[i]>>a|o,o=(this[i]&n)<<r;for(i=s-1;i>=0;--i)e[i]=0;e[s]=o,e.t=this.t+s+1,e.s=this.s,e.clamp()}function I(t,e){e.s=this.s;var i=Math.floor(t/this.DB);if(i>=this.t)return void(e.t=0);var r=t%this.DB,a=this.DB-r,n=(1<<r)-1;e[0]=this[i]>>r;for(var s=i+1;s<this.t;++s)e[s-i-1]|=(this[s]&n)<<a,e[s-i]=this[s]>>r;r>0&&(e[this.t-i-1]|=(this.s&n)<<a),e.t=this.t-i,e.clamp()}function k(t,e){for(var i=0,r=0,a=Math.min(t.t,this.t);i<a;)r+=this[i]-t[i],e[i++]=r&this.DM,r>>=this.DB;if(t.t<this.t){for(r-=t.s;i<this.t;)r+=this[i],e[i++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;i<t.t;)r-=t[i],e[i++]=r&this.DM,r>>=this.DB;r-=t.s}e.s=r<0?-1:0,r<-1?e[i++]=this.DV+r:r>0&&(e[i++]=r),e.t=i,e.clamp()}function V(t,e){var i=this.abs(),r=t.abs(),a=i.t;for(e.t=a+r.t;--a>=0;)e[a]=0;for(a=0;a<r.t;++a)e[a+i.t]=i.am(0,r[a],e,a,0,i.t);e.s=0,e.clamp(),this.s!=t.s&&m.ZERO.subTo(e,e)}function O(t){for(var e=this.abs(),i=t.t=2*e.t;--i>=0;)t[i]=0;for(i=0;i<e.t-1;++i){var r=e.am(i,e[i],t,2*i,0,1);(t[i+e.t]+=e.am(i+1,2*e[i],t,2*i+1,r,e.t-i-1))>=e.DV&&(t[i+e.t]-=e.DV,t[i+e.t+1]=1)}t.t>0&&(t[t.t-1]+=e.am(i,e[i],t,2*i,0,1)),t.s=0,t.clamp()}function U(t,e,i){var r=t.abs();if(!(r.t<=0)){var a=this.abs();if(a.t<r.t)return null!=e&&e.fromInt(0),void(null!=i&&this.copyTo(i));null==i&&(i=g());var n=g(),s=this.s,o=t.s,l=this.DB-D(r[r.t-1]);l>0?(r.lShiftTo(l,n),a.lShiftTo(l,i)):(r.copyTo(n),a.copyTo(i));var h=n.t,c=n[h-1];if(0!=c){var u=c*(1<<this.F1)+(h>1?n[h-2]>>this.F2:0),f=this.FV/u,d=(1<<this.F1)/u,p=1<<this.F2,y=i.t,v=y-h,x=null==e?g():e;for(n.dlShiftTo(v,x),i.compareTo(x)>=0&&(i[i.t++]=1,i.subTo(x,i)),m.ONE.dlShiftTo(h,x),x.subTo(n,n);n.t<h;)n[n.t++]=0;for(;--v>=0;){var w=i[--y]==c?this.DM:Math.floor(i[y]*f+(i[y-1]+p)*d);if((i[y]+=n.am(0,w,i,v,0,h))<w)for(n.dlShiftTo(v,x),i.subTo(x,i);i[y]<--w;)i.subTo(x,i)}null!=e&&(i.drShiftTo(h,e),s!=o&&m.ZERO.subTo(e,e)),i.t=h,i.clamp(),l>0&&i.rShiftTo(l,i),s<0&&m.ZERO.subTo(i,i)}}}function G(t){var e=g();return this.abs().divRemTo(t,null,e),this.s<0&&e.compareTo(m.ZERO)>0&&t.subTo(e,e),e}function H(t){this.m=t}function X(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t}function W(t){return t}function Y(t){t.divRemTo(this.m,null,t)}function q(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function Z(t,e){t.squareTo(e),this.reduce(e)}function J(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var e=3&t;return e=e*(2-(15&t)*e)&15,e=e*(2-(255&t)*e)&255,e=e*(2-((65535&t)*e&65535))&65535,e=e*(2-t*e%this.DV)%this.DV,e>0?this.DV-e:-e}function Q(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function K(t){var e=g();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&e.compareTo(m.ZERO)>0&&this.m.subTo(e,e),e}function $(t){var e=g();return t.copyTo(e),this.reduce(e),e}function tt(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var i=32767&t[e],r=i*this.mpl+((i*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(i=e+this.m.t,t[i]+=this.m.am(0,r,t,e,0,this.m.t);t[i]>=t.DV;)t[i]-=t.DV,t[++i]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)}function et(t,e){t.squareTo(e),this.reduce(e)}function it(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function rt(){return 0==(this.t>0?1&this[0]:this.s)}function at(t,e){if(t>4294967295||t<1)return m.ONE;var i=g(),r=g(),a=e.convert(this),n=D(t)-1;for(a.copyTo(i);--n>=0;)if(e.sqrTo(i,r),(t&1<<n)>0)e.mulTo(r,a,i);else{var s=i;i=r,r=s}return e.revert(i)}function nt(t,e){var i;return i=t<256||e.isEven()?new H(e):new Q(e),this.exp(t,i)}function st(){var t=g();return this.copyTo(t),t}function ot(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function lt(){return 0==this.t?this.s:this[0]<<24>>24}function ht(){return 0==this.t?this.s:this[0]<<16>>16}function ct(t){return Math.floor(Math.LN2*this.DB/Math.log(t))}function ut(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function ft(t){if(null==t&&(t=10),0==this.signum()||t<2||t>36)return"0";var e=this.chunkSize(t),i=Math.pow(t,e),r=A(i),a=g(),n=g(),s="";for(this.divRemTo(r,a,n);a.signum()>0;)s=(i+n.intValue()).toString(t).substr(1)+s,a.divRemTo(r,a,n);return n.intValue().toString(t)+s}function dt(t,e){this.fromInt(0),null==e&&(e=10);for(var i=this.chunkSize(e),r=Math.pow(e,i),a=!1,n=0,s=0,o=0;o<t.length;++o){var l=_(t,o);l<0?"-"==t.charAt(o)&&0==this.signum()&&(a=!0):(s=e*s+l,++n>=i&&(this.dMultiply(r),this.dAddOffset(s,0),n=0,s=0))}n>0&&(this.dMultiply(Math.pow(e,n)),this.dAddOffset(s,0)),a&&m.ZERO.subTo(this,this)}function pt(t,e,i){if("number"==typeof e)if(t<2)this.fromInt(1);else for(this.fromNumber(t,i),this.testBit(t-1)||this.bitwiseTo(m.ONE.shiftLeft(t-1),bt,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(m.ONE.shiftLeft(t-1),this);else{var r=new Array,a=7&t;r.length=(t>>3)+1,e.nextBytes(r),a>0?r[0]&=(1<<a)-1:r[0]=0,this.fromString(r,256)}}function mt(){var t=this.t,e=new Array;e[0]=this.s;var i,r=this.DB-t*this.DB%8,a=0;if(t-- >0)for(r<this.DB&&(i=this[t]>>r)!=(this.s&this.DM)>>r&&(e[a++]=i|this.s<<this.DB-r);t>=0;)r<8?(i=(this[t]&(1<<r)-1)<<8-r,i|=this[--t]>>(r+=this.DB-8)):(i=this[t]>>(r-=8)&255,r<=0&&(r+=this.DB,--t)),0!=(128&i)&&(i|=-256),0==a&&(128&this.s)!=(128&i)&&++a,(a>0||i!=this.s)&&(e[a++]=i);return e}function gt(t){return 0==this.compareTo(t)}function yt(t){return this.compareTo(t)<0?this:t}function vt(t){return this.compareTo(t)>0?this:t}function xt(t,e,i){var r,a,n=Math.min(t.t,this.t);for(r=0;r<n;++r)i[r]=e(this[r],t[r]);if(t.t<this.t){for(a=t.s&this.DM,r=n;r<this.t;++r)i[r]=e(this[r],a);i.t=this.t}else{for(a=this.s&this.DM,r=n;r<t.t;++r)i[r]=e(a,t[r]);i.t=t.t}i.s=e(this.s,t.s),i.clamp()}function wt(t,e){return t&e}function _t(t){var e=g();return this.bitwiseTo(t,wt,e),e}function bt(t,e){return t|e}function Mt(t){var e=g();return this.bitwiseTo(t,bt,e),e}function St(t,e){return t^e}function At(t){var e=g();return this.bitwiseTo(t,St,e),e}function Pt(t,e){return t&~e}function Tt(t){var e=g();return this.bitwiseTo(t,Pt,e),e}function Ct(){for(var t=g(),e=0;e<this.t;++e)t[e]=this.DM&~this[e];return t.t=this.t,t.s=~this.s,t}function zt(t){var e=g();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e}function Lt(t){var e=g();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e}function Et(t){if(0==t)return-1;var e=0;return 0==(65535&t)&&(t>>=16,e+=16),0==(255&t)&&(t>>=8,e+=8),0==(15&t)&&(t>>=4,e+=4),0==(3&t)&&(t>>=2,e+=2),0==(1&t)&&++e,e}function Dt(){for(var t=0;t<this.t;++t)if(0!=this[t])return t*this.DB+Et(this[t]);return this.s<0?this.t*this.DB:-1}function Nt(t){for(var e=0;0!=t;)t&=t-1,++e;return e}function Bt(){for(var t=0,e=this.s&this.DM,i=0;i<this.t;++i)t+=Nt(this[i]^e);return t}function Rt(t){var e=Math.floor(t/this.DB);return e>=this.t?0!=this.s:0!=(this[e]&1<<t%this.DB)}function Ft(t,e){var i=m.ONE.shiftLeft(t);return this.bitwiseTo(i,e,i),i}function It(t){return this.changeBit(t,bt)}function kt(t){return this.changeBit(t,Pt)}function Vt(t){return this.changeBit(t,St)}function Ot(t,e){for(var i=0,r=0,a=Math.min(t.t,this.t);i<a;)r+=this[i]+t[i],e[i++]=r&this.DM,r>>=this.DB;if(t.t<this.t){for(r+=t.s;i<this.t;)r+=this[i],e[i++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;i<t.t;)r+=t[i],e[i++]=r&this.DM,r>>=this.DB;r+=t.s}e.s=r<0?-1:0,r>0?e[i++]=r:r<-1&&(e[i++]=this.DV+r),e.t=i,e.clamp()}function Ut(t){var e=g();return this.addTo(t,e),e}function Gt(t){var e=g();return this.subTo(t,e),e}function Ht(t){var e=g();return this.multiplyTo(t,e),e}function jt(){var t=g();return this.squareTo(t),t}function Xt(t){var e=g();return this.divRemTo(t,e,null),e}function Wt(t){var e=g();return this.divRemTo(t,null,e),e}function Yt(t){var e=g(),i=g();return this.divRemTo(t,e,i),new Array(e,i)}function qt(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()}function Zt(t,e){if(0!=t){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=t;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}}function Jt(){}function Qt(t){return t}function Kt(t,e,i){t.multiplyTo(e,i)}function $t(t,e){t.squareTo(e)}function te(t){return this.exp(t,new Jt)}function ee(t,e,i){var r=Math.min(this.t+t.t,e);for(i.s=0,i.t=r;r>0;)i[--r]=0;var a;for(a=i.t-this.t;r<a;++r)i[r+this.t]=this.am(0,t[r],i,r,0,this.t);for(a=Math.min(t.t,e);r<a;++r)this.am(0,t[r],i,r,0,e-r);i.clamp()}function ie(t,e,i){--e;var r=i.t=this.t+t.t-e;for(i.s=0;--r>=0;)i[r]=0;for(r=Math.max(e-this.t,0);r<t.t;++r)i[this.t+r-e]=this.am(e-r,t[r],i,0,0,this.t+r-e);i.clamp(),i.drShiftTo(1,i)}function re(t){this.r2=g(),this.q3=g(),m.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}function ae(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=g();return t.copyTo(e),this.reduce(e),e}function ne(t){return t}function se(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)}function oe(t,e){t.squareTo(e),this.reduce(e)}function le(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function he(t,e){var i,r,a=t.bitLength(),n=A(1);if(a<=0)return n;i=a<18?1:a<48?3:a<144?4:a<768?5:6,r=a<8?new H(e):e.isEven()?new re(e):new Q(e);var s=new Array,o=3,l=i-1,h=(1<<i)-1;if(s[1]=r.convert(this),i>1){var c=g();for(r.sqrTo(s[1],c);o<=h;)s[o]=g(),r.mulTo(c,s[o-2],s[o]),o+=2}var u,f,d=t.t-1,p=!0,m=g();for(a=D(t[d])-1;d>=0;){for(a>=l?u=t[d]>>a-l&h:(u=(t[d]&(1<<a+1)-1)<<l-a,d>0&&(u|=t[d-1]>>this.DB+a-l)),o=i;0==(1&u);)u>>=1,--o;if((a-=o)<0&&(a+=this.DB,--d),p)s[u].copyTo(n),p=!1;else{for(;o>1;)r.sqrTo(n,m),r.sqrTo(m,n),o-=2;o>0?r.sqrTo(n,m):(f=n,n=m,m=f),r.mulTo(m,s[u],n)}for(;d>=0&&0==(t[d]&1<<a);)r.sqrTo(n,m),f=n,n=m,m=f,--a<0&&(a=this.DB-1,--d)}return r.revert(n)}function ce(t){var e=this.s<0?this.negate():this.clone(),i=t.s<0?t.negate():t.clone();if(e.compareTo(i)<0){var r=e;e=i,i=r}var a=e.getLowestSetBit(),n=i.getLowestSetBit();if(n<0)return e;for(a<n&&(n=a),n>0&&(e.rShiftTo(n,e),i.rShiftTo(n,i));e.signum()>0;)(a=e.getLowestSetBit())>0&&e.rShiftTo(a,e),(a=i.getLowestSetBit())>0&&i.rShiftTo(a,i),e.compareTo(i)>=0?(e.subTo(i,e),e.rShiftTo(1,e)):(i.subTo(e,i),i.rShiftTo(1,i));return n>0&&i.lShiftTo(n,i),i}function ue(t){if(t<=0)return 0;var e=this.DV%t,i=this.s<0?t-1:0;if(this.t>0)if(0==e)i=this[0]%t;else for(var r=this.t-1;r>=0;--r)i=(e*i+this[r])%t;return i}function fe(t){var e=t.isEven();if(this.isEven()&&e||0==t.signum())return m.ZERO;for(var i=t.clone(),r=this.clone(),a=A(1),n=A(0),s=A(0),o=A(1);0!=i.signum();){for(;i.isEven();)i.rShiftTo(1,i),e?(a.isEven()&&n.isEven()||(a.addTo(this,a),n.subTo(t,n)),a.rShiftTo(1,a)):n.isEven()||n.subTo(t,n),n.rShiftTo(1,n);for(;r.isEven();)r.rShiftTo(1,r),e?(s.isEven()&&o.isEven()||(s.addTo(this,s),o.subTo(t,o)),s.rShiftTo(1,s)):o.isEven()||o.subTo(t,o),o.rShiftTo(1,o);i.compareTo(r)>=0?(i.subTo(r,i),e&&a.subTo(s,a),n.subTo(o,n)):(r.subTo(i,r),e&&s.subTo(a,s),o.subTo(n,o))}return 0!=r.compareTo(m.ONE)?m.ZERO:o.compareTo(t)>=0?o.subtract(t):o.signum()<0?(o.addTo(t,o),o.signum()<0?o.add(t):o):o}function de(t){var e,i=this.abs();if(1==i.t&&i[0]<=Ri[Ri.length-1]){for(e=0;e<Ri.length;++e)if(i[0]==Ri[e])return!0;return!1}if(i.isEven())return!1;for(e=1;e<Ri.length;){for(var r=Ri[e],a=e+1;a<Ri.length&&r<Fi;)r*=Ri[a++];for(r=i.modInt(r);e<a;)if(r%Ri[e++]==0)return!1}return i.millerRabin(t)}function pe(t){var e=this.subtract(m.ONE),i=e.getLowestSetBit();if(i<=0)return!1;var r=e.shiftRight(i);t=t+1>>1,t>Ri.length&&(t=Ri.length);for(var a=g(),n=0;n<t;++n){a.fromInt(Ri[Math.floor(Math.random()*Ri.length)]);var s=a.modPow(r,this);if(0!=s.compareTo(m.ONE)&&0!=s.compareTo(e)){for(var o=1;o++<i&&0!=s.compareTo(e);)if(s=s.modPowInt(2,this),0==s.compareTo(m.ONE))return!1;if(0!=s.compareTo(e))return!1}}return!0}function me(){this.i=0,this.j=0,this.S=new Array}function ge(t){var e,i,r;for(e=0;e<256;++e)this.S[e]=e;for(i=0,e=0;e<256;++e)i=i+this.S[e]+t[e%t.length]&255,r=this.S[e],this.S[e]=this.S[i],this.S[i]=r;this.i=0,this.j=0}function ye(){var t;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,t=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=t,this.S[t+this.S[this.i]&255]}function ve(){return new me}function xe(t){ki[Vi++]^=255&t,ki[Vi++]^=t>>8&255,ki[Vi++]^=t>>16&255,ki[Vi++]^=t>>24&255,Vi>=Oi&&(Vi-=Oi)}function we(){xe((new Date).getTime())}function _e(){if(null==Ii){for(we(),Ii=ve(),Ii.init(ki),Vi=0;Vi<ki.length;++Vi)ki[Vi]=0;Vi=0}return Ii.next()}function be(t){var e;for(e=0;e<t.length;++e)t[e]=_e()}function Me(){}function Se(t,e){return new m(t,e)}function Ae(t,e){if(e<t.length+11)return null;for(var i=new Array,r=t.length-1;r>=0&&e>0;){var a=t.charCodeAt(r--);a<128?i[--e]=a:a>127&&a<2048?(i[--e]=63&a|128,i[--e]=a>>6|192):(i[--e]=63&a|128,i[--e]=a>>6&63|128,i[--e]=a>>12|224)}i[--e]=0;for(var n=new Me,s=new Array;e>2;){for(s[0]=0;0==s[0];)n.nextBytes(s);i[--e]=s[0]}return i[--e]=2,i[--e]=0,new m(i)}function Pe(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function Te(t,e){this.n=Se(t,16),this.e=parseInt(e,16)}function Ce(t){return t.modPowInt(this.e,this.n)}function ze(t){var e=Ae(t,this.n.bitLength()+7>>3);if(null==e)return null;var i=this.doPrivate(e);if(null==i)return null;var r=i.toString(16);return 0==(1&r.length)?r:"0"+r}function Le(t,e){for(var i=t.toByteArray(),r=0;r<i.length&&0==i[r];)++r;if(i.length-r!=e-1||2!=i[r])return null;for(++r;0!=i[r];)if(++r>=i.length)return null;for(var a="";++r<i.length;){var n=255&i[r];n<128?a+=String.fromCharCode(n):n>191&&n<224?(a+=String.fromCharCode((31&n)<<6|63&i[r+1]),++r):(a+=String.fromCharCode((15&n)<<12|(63&i[r+1])<<6|63&i[r+2]),r+=2)}return a}function Ee(t,e,i){this.n=Se(t,16),this.e=parseInt(e,16),this.d=Se(i,16)}function De(t,e,i,r,a,n,s,o){this.n=Se(t,16),this.e=parseInt(e,16),this.d=Se(i,16),this.p=Se(r,16),this.q=Se(a,16),this.dmp1=Se(n,16),this.dmq1=Se(s,16),this.coeff=Se(o,16)}function Ne(t){if(null==this.p||null==this.q)return t.modPow(this.d,this.n);for(var e=t.mod(this.p).modPow(this.dmp1,this.p),i=t.mod(this.q).modPow(this.dmq1,this.q);e.compareTo(i)<0;)e=e.add(this.p);return e.subtract(i).multiply(this.coeff).mod(this.p).multiply(this.q).add(i)}function Be(t){var e=Se(t,16),i=this.doPublic(e);return null==i?null:Le(i,this.n.bitLength()+7>>3)}function Re(t,e){t.diffuse.value=e.color,t.opacity.value=e.opacity}function Fe(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}function Ie(t,e){t.psColor.value=e.color,t.opacity.value=e.opacity,t.size.value=e.size,t.scale.value=e.scale||1,t.map.value=e.map}function ke(t,e){return t.distance-e.distance}function Ve(t,e,i,r,a){(t instanceof Je.Node||t instanceof Je.Billboard)&&Ue(t,e,i,r,a)}function Oe(t,i,r,a,n){if(t!==e)for(var s=t.getDescendants(),o=0,l=s.length;o<l;o++)Ve(s[o],i,r,a,n)}function Ue(t,i,r,a,n){if(a||0!=n.isVisible(t)){if(t instanceof Je.Billboard){var s=i.matrixPosition;s.setFromMatrixPosition(t.worldMatrix);var o=i.ray.distanceToPoint(s),l=t.material.alignment,h=new Je.Plane(1,1);(l.x||l.y)&&(h.setPosition(l.x,l.y,0),h=Je.Utils.transformElement(h,!0)),h.setPosition(s);var c=(new Ke).getScaleFromMatrix(t.worldMatrix);h.setScale(c.x,c.y,1);var u=i.direction.clone(),f=h.getPosition().clone(),d=t.material;d&&d.vertical&&(u.y=0),f.sub(u),h.lookAt(f),h.updateWorldMatrix(!0);var p=[];return Ue(h,i,p,!0,n),0===p.length?r:(r.push({distance:p[0].distance,point:t._position,face:null,object:t,element:t}),r)}if(t instanceof Je.Line){var m=1;m-=1;var g=Math.sqrt(i.linePrecision+m),y=g*g,v=t;if(null==v.boundingSphere&&v.computeBoundingSphere(),nr.copy(v.boundingSphere),nr.applyMatrix4(t.worldMatrix),i.ray.isIntersectionSphere(nr)===!1)return r;ir.getInverse(t.worldMatrix),er.copy(i.ray).transform(ir);for(var x=v.vertices,w=x.length,_=new Ke,b=new Ke,M=t.type===Je.LineStrip?1:2,S=0;S<w-1;S+=M){var A=er.distanceSqToSegment(x[S],x[S+1],b,_);if(!(A>y)){var o=er.origin.distanceTo(b);o<i.near||o>i.far||r.push({distance:o,point:_.clone().applyMatrix4(t.worldMatrix),face:null,faceIndex:null,element:t,object:t})}}return r}if(null===t.boundingSphere&&t.computeBoundingSphere(),nr.set(t.worldMatrix.getPosition(),t.boundingSphere.radius*t.worldMatrix.getMaxScaleOnAxis()),!i.ray.isIntersectionSphere(nr))return r;var P,T,C,z,v=t,x=v.vertices,L=t.material instanceof Je.ArrayMaterial,E=L===!0?t.material.materials:null,D=t.material.side,g=i.precision;t.rotationWorldMatrix.extractRotation(t.worldMatrix),ir.getInverse(t.worldMatrix),er.copy(i.ray).transform(ir);for(var N=0,B=v.faces.length;N<B;N++){var R=v.faces[N],F=L===!0?E[R.materialIndex]:t.material,I=n.getOverLoadMaterial(t,F);if(I&&(F=I),F!==e&&F.visible!==!1&&(v.visible!==!1||a)&&(!F.transparent||0!=F.opacity)){rr.setFromNormalAndCoplanarPoint(R.normal,x[R.a]);var k=er.distanceToPlane(rr);if(!(Math.abs(k)<g||k<0)){D=F.side;var V=er.direction.dot(rr.normal);if((D===Je.DoubleSide||(D===Je.FrontSide?V<0:V>0))&&!(k<i.near||k>i.far)){ar=er.at(k,ar);var O,U=new Ke,G=(R.materialIndex,!1);if(n&&n._selectTransparencyThreshold>0&&(G=1==F.transparent||F.alphaTest>0),R instanceof Je.Face3){if(P=x[R.a],T=x[R.b],C=x[R.c],!Je.Triangle.containsPoint(ar,P,T,C))continue;U=Je.Triangle.barycoordFromPoint(ar,P,T,C)}else{if(!(R instanceof Je.Face4))throw Error("face type not supported");P=x[R.a],T=x[R.b],C=x[R.c],z=x[R.d];var H=Je.Triangle.containsPoint(ar,P,T,z),j=Je.Triangle.containsPoint(ar,T,C,z);if(!H&&!j)continue;H?U=Je.Triangle.barycoordFromPoint(ar,P,T,z):(U=Je.Triangle.barycoordFromPoint(ar,T,C,z),O=!0)}var X=new Qe,W=U.z,Y=U.x,q=U.y;if(v.uvs&&v.uvs[N]){var Z=v.uvs[N];R instanceof Je.Face3?(X.x=Z[0].x*Y+Z[1].x*q+Z[2].x*W,X.y=Z[0].y*Y+Z[1].y*q+Z[2].y*W):O?(X.x=Z[1].x*Y+Z[2].x*q+Z[3].x*W,X.y=Z[1].y*Y+Z[2].y*q+Z[3].y*W):(X.x=Z[0].x*Y+Z[1].x*q+Z[3].x*W,X.y=Z[0].y*Y+Z[1].y*q+Z[3].y*W)}var J,Q=1;if(X=n.debugUV||X,G){if(F.opacity<n._selectTransparencyThreshold)continue;if(null==F.map)Q=F.opacity;else{J=F.map._image;var K=xi.getPixelFromImage(J,X.x,X.y);Q=K[3]/255*(null==F.opacity?1:F.opacity)}Q<F.alphaTest?Q=0:0==F.transparent&&(Q=1)}Q<n._selectTransparencyThreshold||r.push({distance:k,point:i.ray.at(k),face:R,uv:X,faceIndex:N,element:t,object:t,side:V>0?1:-1})}}}}}}function Ge(t){if(!gr[t.id]){if(vr=!0,gr[t.id]=t,t.finish=null==t.finish?t.delay+t.dur+t.interval:t.finish,null==t.from&&t.attr&&t.source){var e;(e=t.attr.match(/^S[:@](.*)/i))?t.from=t.source.getStyle(e[1]):(e=t.attr.match(/^C[:@](.*)/i))?t.from=t.source.getClient(e[1]):t.from=twaver.Util.getValue(t.source,t.attr)}He(t),je(t)}return t}function He(t){var e=t.type,i=t.from,r=t.to;"number"===e?(t.from=i||0,t.to=r||0):"point"===e?(i?i.length&&(t.from={x:i[0],y:i[1]}):t.from="scale"===t.attr?{x:1,y:1}:{x:0,y:0},r?r.length&&(t.to={x:r[0],y:r[1]}):t.to="scale"===t.attr?{x:1,y:1}:{x:0,y:0}):"rect"===e?(i?i.length&&(t.from={x:i[0],y:i[1],w:i[2],h:i[3]}):t.from={x:0,y:0,w:0,h:0},r?r.length&&(t.to={x:r[0],y:r[1],w:r[2],h:r[3]}):t.to={x:0,y:0,w:0,h:0}):"color"===e?(t.from=getColorValue(i),t.to=getColorValue(r)):"set"!==e&&"group_set"===e,t.current=t.from}function je(t){var e=t.type,i=t.from,r=t.to;"number"===e?t.delta=r-i:"point"===e?t.delta={x:r.x-i.x,y:r.y-i.y}:"rect"===e?t.delta={x:r.x-i.x,y:r.y-i.y,w:r.w-i.w,h:r.h-i.h}:"color"===e?t.delta={r:r.r-i.r,g:r.g-i.g,b:r.b-i.b,a:r.a-i.a}:"set"!==e&&"group_set"===e}function Xe(t,e){return gr[t.id]&&(null==e&&(e=!0),e&&Ze(t,t.to),t.onStop&&t.onStop(),t.time=0,t.total=0,t.start=null,t.count=0,t.started=!1,t.stopped=!1,delete gr[t.id]),t}function We(t){null==t&&(t=!0),Object.keys(gr).forEach(function(e){var i=gr[e];t&&Ze(i,i.to),i.onStop&&i.onStop()}),gr={}}function Ye(t){Object.keys(gr).forEach(function(e){var i=gr[e];if(i){if(null==i.start&&(i.start=t),i.total=t-i.start,i.total>i.delay){i.time=i.total-i.delay;var r=!1;if(i.time>=i.dur&&(i.time=i.dur,r=!0),!i.stopped&&Ze(i,qe(i)),i.stopped=r,i.total>=i.finish)if(i.count++,i.count>=i.repeat)Xe(i,!1),i.onDone&&i.onDone();else if(i.time=0,i.total=0,i.start=null,i.stopped=!1,i.reverse){var a=i.from;i.from=i.to,i.to=a,je(i)}}!vr&&(vr=!0)}})}function qe(t,e){var i=t.type,r=t.delta,a=t.from,n=t.time,s=t.dur,o=hi[t.easing||"easeNone"];return o||(o=hi.easeNone),"number"===i?e=o(n,a,r,s):"point"===i?e={x:o(n,a.x,r.x,s),y:o(n,a.y,r.y,s)}:"rect"===i?e={x:o(n,a.x,r.x,s),y:o(n,a.y,r.y,s),w:o(n,a.w,r.w,s),h:o(n,a.h,r.h,s)}:"color"===i?e="rgba("+Math.floor(o(n,a.r,r.r,s))+","+Math.floor(o(n,a.g,r.g,s))+","+Math.floor(o(n,a.b,r.b,s))+","+Math.floor(o(n,a.a,r.a,s))+")":"set"===i?t.time&&(e=t.to):"group_set"===i&&(e=t.to[t.groupIndex]),t.current=e,e}function Ze(t,e){if(t.started||(t.started=!0,t.onPlay&&t.onPlay()),t.filter&&(e=t.filter(e)),t.attr&&t.source){var i;(i=t.attr.match(/^S[:@](.*)/i))?t.source.setStyle(i[1],e):(i=t.attr.match(/^C[:@](.*)/i))?t.source.setClient(i[1],e):twaver.Util.setValue(t.source,t.attr,e)}t.onUpdate&&t.onUpdate(e)}self.Int32Array=self.Int32Array||Array,self.Float32Array=self.Float32Array||Array,Object.create=Object.create||function(t){var e=function(){};return e.prototype=t,new e};var Je={version:"2.0.6",_id:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],id:function(t){t=null==t?"":t;for(var e=[],i=0;i<32;i++)e[i]=this._id[Math.floor(16*Math.random())];return e[12]="4",e[16]=this._id[3&e[16]|8],t+e.join("")},ip:function(t,e,i,r){var a=i+e;t[Je.getter(e,r)]=function(){return this[a]},t[Je.setter(e)]=function(t){var i=this[a];i!==t&&(this.setPropertyValue?this.setPropertyValue(a,t)&&(this.onPropertyChange(e,i,t),this.firePropertyChange(e,i,t)):(this[a]=t,this.onPropertyChange(e,i,t),this.firePropertyChange(e,i,t)))}},getter:function(t,e){var i=t.charAt(0).toUpperCase()+t.slice(1),r=/ble$/.test(t)||/ed$/.test(t)?"is":"get";return e&&e.indexOf(t)!=-1&&(r="is"),r+i},setter:function(t){var e=t.charAt(0).toUpperCase()+t.slice(1);return"set"+e},getValue:function(t,e,i){var r=e.charAt(0).toUpperCase()+e.slice(1),a="get"+r,n="is"+r;return i?"boolean"===i?t[n]():(null==t[a]&&console.log("get Function "+a+" not exist"),t[a]()):t[a]?t[a]():t[n]?t[n]():t[e]},setValue:function(t,e,i){t["set"+e.charAt(0).toUpperCase()+e.slice(1)](i)},clone:function(t){if(!t)return null;var e={};for(var i in t)e[i]=t[i];return e},addMethod:function(t,e){var i=t.prototype;for(var r in e)i[r]=e[r]},classCache:{},getClass:function(e){var i=Je.classCache[e];if(!i){var r=e.split("."),a=r.length;i=t;for(var n=0;n<a;n++)i=i[r[n]];Je.classCache[e]=i}return i},newInstance:function(t){"string"==typeof t&&(t=Je.getClass(t),t=t.prototype);var e=t.constructor;if(!e)return null;var i=arguments.length,r=arguments;if(1===i)return new e;if(2===i)return new e(r[1]);if(3===i)return new e(r[1],r[2]);if(4===i)return new e(r[1],r[2],r[3]);if(5===i)return new e(r[1],r[2],r[3],r[4]);if(6===i)return new e(r[1],r[2],r[3],r[4],r[5]);if(7===i)return new e(r[1],r[2],r[3],r[4],r[5],r[6]);if(8===i)return new e(r[1],r[2],r[3],r[4],r[5],r[6],r[7]);throw"don't support args more than 7"},xml:function(e){if(t.DOMParser)return(new DOMParser).parseFromString(e,"text/xml");var i=new ActiveXObject("Microsoft.XmlDOM");return i.async=!1,i.loadXml(e),i}};t.TGL=Je,t.mono=Je;Je.extend=function(t,e,i){if(e){var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t,t.superClass=e.prototype,e.prototype.constructor==Object.prototype.constructor&&(e.prototype.constructor=e)}var a=t.prototype;if(i){a.getClassName=function(){return i.className};for(var n in i){if("__accessor"===n)for(var s=i.__accessor,o=i.__bool,l=0;l<s.length;l++){var h=s[l];Je.ip(a,h,"",o)}else if("___accessor"===n)for(var s=i.___accessor,l=0;l<s.length;l++){var h=s[l];Je.ip(a,h,"_",o)}a[n]=i[n]}i.constructor&&(a.newInstance=function(){return Je.newInstance(this)})}},Je.defaultEulerOrder="XYZ",String.prototype.startsWith=String.prototype.startsWith||function(t){return this.slice(0,t.length)===t},String.prototype.endsWith=String.prototype.endsWith||function(t){var e=String(t),i=this.lastIndexOf(e);return(-1<i&&i)===this.length-e.length},String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},function(){for(var i=0,r=["ms","moz","webkit","o"],a=0;a<r.length&&!t.requestAnimationFrame;++a)t.requestAnimationFrame=t[r[a]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[r[a]+"CancelAnimationFrame"]||t[r[a]+"CancelRequestAnimationFrame"];t.requestAnimationFrame===e&&(t.requestAnimationFrame=function(e,r){var a=Date.now(),n=Math.max(0,16-(a-i)),s=t.setTimeout(function(){e(a+n)},n);return i=a+n,s}),t.cancelAnimationFrame=t.cancelAnimationFrame||function(e){t.clearTimeout(e)}}(),Je.CullFaceNone=0,Je.CullFaceBack=1,Je.CullFaceFront=2,Je.CullFaceFrontBack=3,Je.FrontFaceDirectionCW=0,Je.FrontFaceDirectionCCW=1,Je.BasicShadowMap=0,Je.PCFShadowMap=1,Je.PCFSoftShadowMap=2,Je.FrontSide="front",Je.BackSide="back",Je.DoubleSide="both",Je.BothSide="both",Je.NoShading=0,Je.FlatShading=1,Je.SmoothShading=2,Je.NormalTypeFlat="flat",Je.NormalTypeSmooth="smooth",Je.NoColors=0,Je.FaceColors=1,Je.VertexColors=2,Je.NoBlending=0,Je.NormalBlending=1,Je.AdditiveBlending=2,Je.SubtractiveBlending=3,Je.MultiplyBlending=4,Je.CustomBlending=5,Je.AddEquation=100,Je.SubtractEquation=101,Je.ReverseSubtractEquation=102,Je.ZeroFactor=200,Je.OneFactor=201,Je.SrcColorFactor=202,Je.OneMinusSrcColorFactor=203,Je.SrcAlphaFactor=204,Je.OneMinusSrcAlphaFactor=205,Je.DstAlphaFactor=206,Je.OneMinusDstAlphaFactor=207,Je.DstColorFactor=208,Je.OneMinusDstColorFactor=209,Je.SrcAlphaSaturateFactor=210,Je.MultiplyOperation=0,Je.MixOperation=1,Je.AddOperation=2,Je.UVMapping=function(){},Je.CubeReflectionMapping=function(){},Je.CubeRefractionMapping=function(){},Je.SphericalReflectionMapping=function(){},Je.SphericalRefractionMapping=function(){},Je.RepeatWrapping="repeat",Je.ClampToEdgeWrapping="clamp",Je.MirroredRepeatWrapping="mirrored",Je.NearestFilter=1003,Je.NearestMipMapNearestFilter=1004,Je.NearestMipMapLinearFilter=1005,Je.LinearFilter=1006,Je.LinearMipMapNearestFilter=1007,Je.LinearMipMapLinearFilter=1008,Je.UnsignedByteType=1009,Je.ByteType=1010,Je.ShortType=1011,Je.UnsignedShortType=1012,Je.IntType=1013,Je.UnsignedIntType=1014,Je.FloatType=1015,Je.UnsignedShort4444Type=1016,Je.UnsignedShort5551Type=1017,Je.UnsignedShort565Type=1018,Je.AlphaFormat=1019,Je.RGBFormat=1020,Je.RGBAFormat=1021,Je.LuminanceFormat=1022,Je.LuminanceAlphaFormat=1023,Je.RGB_S3TC_DXT1_Format=2001,Je.RGBA_S3TC_DXT1_Format=2002,Je.RGBA_S3TC_DXT3_Format=2003,Je.RGBA_S3TC_DXT5_Format=2004,Je.Gradient_Linear_U=1,Je.Gradient_Linear_V=2,Je.Gradient_Linear_UV=3,Je.Gradient_Linear_NUV=4,Je.Gradient_Linear_Radial=5,Je.Gradient_Linear_Sweep=6,Je.Math={clamp:function(t,e,i){
return t<e?e:t>i?i:t},isConcave:function(t,e,i){var r=i?1:-1;return(t.x*e.y-e.x*t.y)*r<0},area:function(t,i,r,a){var n=a?1:-1;if(!t||!i||!r)return e;var s=-t.x*i.y-i.x*r.y-r.x*t.y+r.x*i.y+i.x*t.y+t.x*r.y;return s*n},isClockwise:function(t,e,i){e=e||"x",i=i||"y";for(var r=0,a=t.length,n=0;n<a;n++){var s=t[n],o=t[n+1===a?0:n+1];r+=(o[e]-s[e])*(o[i]+s[i])}return r<0},isClockwise3:function(t,e,i){(new mono.Vec3).crossVectors(t,e),(new mono.Vec3).subVectors(e,t),(new mono.Vec3).subVectors(e,t)},clampBottom:function(t,e){return t<e?e:t},mapLinear:function(t,e,i,r,a){return r+(t-e)*(a-r)/(i-e)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},sign:function(t){return t<0?-1:t>0?1:0},degToRad:function(t){return t*Je.Math.__d2r},radToDeg:function(t){return t*Je.Math.__r2d},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*(3-2*t))},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*t*(t*(6*t-15)+10))},PI2:2*Math.PI,generateUUID:function(){var t,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),r=0;return function(){for(var a=0;a<36;a++)8==a||13==a||18==a||23==a?i[a]="-":14==a?i[a]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),t=15&r,r>>=4,i[a]=e[19==a?3&t|8:t]);return i.join("")}}()},Je.Math.__d2r=Math.PI/180,Je.Math.__r2d=180/Math.PI,Je.Quat=function(t,i,r,a){this.x=t||0,this.y=i||0,this.z=r||0,this.w=a!==e?a:1},Je.Quat.prototype={constructor:Je.Quat,set:function(t,e,i,r){return this.x=t,this.y=e,this.z=i,this.w=r,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},setFromEuler:function(t,i){var r=Math.cos(t.x/2),a=Math.cos(t.y/2),n=Math.cos(t.z/2),s=Math.sin(t.x/2),o=Math.sin(t.y/2),l=Math.sin(t.z/2);return i===e||"XYZ"===i?(this.x=s*a*n+r*o*l,this.y=r*o*n-s*a*l,this.z=r*a*l+s*o*n,this.w=r*a*n-s*o*l):"YXZ"===i?(this.x=s*a*n+r*o*l,this.y=r*o*n-s*a*l,this.z=r*a*l-s*o*n,this.w=r*a*n+s*o*l):"ZXY"===i?(this.x=s*a*n-r*o*l,this.y=r*o*n+s*a*l,this.z=r*a*l+s*o*n,this.w=r*a*n-s*o*l):"ZYX"===i?(this.x=s*a*n-r*o*l,this.y=r*o*n+s*a*l,this.z=r*a*l-s*o*n,this.w=r*a*n+s*o*l):"YZX"===i?(this.x=s*a*n+r*o*l,this.y=r*o*n+s*a*l,this.z=r*a*l-s*o*n,this.w=r*a*n-s*o*l):"XZY"===i&&(this.x=s*a*n-r*o*l,this.y=r*o*n-s*a*l,this.z=r*a*l+s*o*n,this.w=r*a*n+s*o*l),this},setFromAxisAngle:function(t,e){var i=e/2,r=Math.sin(i);return this.x=t.x*r,this.y=t.y*r,this.z=t.z*r,this.w=Math.cos(i),this},setFromRotationMatrix:function(t){var e,i=t.elements,r=i[0],a=i[4],n=i[8],s=i[1],o=i[5],l=i[9],h=i[2],c=i[6],u=i[10],f=r+o+u;return f>0?(e=.5/Math.sqrt(f+1),this.w=.25/e,this.x=(c-l)*e,this.y=(n-h)*e,this.z=(s-a)*e):r>o&&r>u?(e=2*Math.sqrt(1+r-o-u),this.w=(c-l)/e,this.x=.25*e,this.y=(a+s)/e,this.z=(n+h)/e):o>u?(e=2*Math.sqrt(1+o-r-u),this.w=(n-h)/e,this.x=(a+s)/e,this.y=.25*e,this.z=(l+c)/e):(e=2*Math.sqrt(1+u-r-o),this.w=(s-a)/e,this.x=(n+h)/e,this.y=(l+c)/e,this.z=.25*e),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var t=this.length();return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(t=1/t,this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t),this},multiply:function(t,i){return i!==e?(console.warn("DEPRECATED: Quat's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,i)):this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,e){var i=t.x,r=t.y,a=t.z,n=t.w,s=e.x,o=e.y,l=e.z,h=e.w;return this.x=i*h+n*s+r*l-a*o,this.y=r*h+n*o+a*s-i*l,this.z=a*h+n*l+i*o-r*s,this.w=n*h-i*s-r*o-a*l,this},multiplyVector3:function(t){return console.warn("DEPRECATED: Quat's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( Quat ) instead."),t.applyQuaternion(this)},slerp:function(t,e){var i=this.x,r=this.y,a=this.z,n=this.w,s=n*t.w+i*t.x+r*t.y+a*t.z;if(s<0?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,s=-s):this.copy(t),s>=1)return this.w=n,this.x=i,this.y=r,this.z=a,this;var o=Math.acos(s),l=Math.sqrt(1-s*s);if(Math.abs(l)<.001)return this.w=.5*(n+this.w),this.x=.5*(i+this.x),this.y=.5*(r+this.y),this.z=.5*(a+this.z),this;var h=Math.sin((1-e)*o)/l,c=Math.sin(e*o)/l;return this.w=n*h+this.w*c,this.x=i*h+this.x*c,this.y=r*h+this.y*c,this.z=a*h+this.z*c,this},toEuler:function(){var t=this.w*this.w,e=this.x*this.x,i=this.y*this.y,r=this.z*this.z,a=180/Math.PI*Math.atan2(2*(this.y*this.z+this.x*this.w),-e-i+r+t),n=180/Math.PI*Math.asin(-2*(this.x*this.z-this.y*this.w)),s=180/Math.PI*Math.atan2(2*(this.x*this.y+this.z*this.w),e-i-r+t);return[a,n,s]},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},clone:function(){return new Je.Quat(this.x,this.y,this.z,this.w)}},Je.Quat.slerp=function(t,e,i,r){return i.copy(t).slerp(e,r)};var Qe=function(t,e){this.x=t||0,this.y=e||0};Qe.prototype={constructor:Qe,set:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,i){return i!==e?(console.warn("DEPRECATED: Vec2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this)},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScalar:function(t){return this.x+=t,this.y+=t,this},sub:function(t,i){return i!==e?(console.warn("DEPRECATED: Vec2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this)},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},divideScalar:function(t){return 0!==t?(this.x/=t,this.y/=t):this.set(0,0),this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this},clamp:function(t,e){return this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x),this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},setLength:function(t){var e=this.length();return 0!==e&&t!==e&&this.multiplyScalar(t/e),this},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},equals:function(t){return null!=t&&(t.x===this.x&&t.y===this.y)},clone:function(){return new Qe(this.x,this.y)}},Je.Vec2=Qe;var Ke=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0};Je.Vec3=Ke,Ke.prototype={set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},center:function(t,e){return this.x=(t.x+e.x)/2,this.y=(t.y+e.y)/2,this.z=(t.z+e.z)/2,this},copy:function(t){return(null==this||null==t)&&console.log("TGL.Vec3.copy this : "+this+" v : "+t),this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t){return(!this||!t)&&console.log("TGL.Vec3.add this : "+this+" v : "+t),this.x+=t.x,this.y+=t.y,this.z+=t.z,this},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return(!t||!e)&&console.log("TGL.Vec3.addVectors a : "+t+" b : "+e),this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},subVectors:function(t,e){return(null==t||null==e)&&console.log("null"),this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyMatrix3:function(t){var e=this.x,i=this.y,r=this.z,a=t.elements;return this.x=a[0]*e+a[3]*i+a[6]*r,this.y=a[1]*e+a[4]*i+a[7]*r,this.z=a[2]*e+a[5]*i+a[8]*r,this},applyMatrix4:function(t){var e=this.x,i=this.y,r=this.z,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*r+a[12],this.y=a[1]*e+a[5]*i+a[9]*r+a[13],this.z=a[2]*e+a[6]*i+a[10]*r+a[14],this},applyProjection:function(t){var e=this.x,i=this.y,r=this.z,a=t.elements,n=1/(a[3]*e+a[7]*i+a[11]*r+a[15]);return this.x=(a[0]*e+a[4]*i+a[8]*r+a[12])*n,this.y=(a[1]*e+a[5]*i+a[9]*r+a[13])*n,this.z=(a[2]*e+a[6]*i+a[10]*r+a[14])*n,this},applyQuaternion:function(t){var e=this.x,i=this.y,r=this.z,a=t.x,n=t.y,s=t.z,o=t.w,l=o*e+n*r-s*i,h=o*i+s*e-a*r,c=o*r+a*i-n*e,u=-a*e-n*i-s*r;return this.x=l*o+u*-a+h*-s-c*-n,this.y=h*o+u*-n+c*-a-l*-s,this.z=c*o+u*-s+l*-n-h*-a,this},applyEuler:function(t,e){var i=Ke.__q1.setFromEuler(t,e);return this.applyQuaternion(i),this},applyAxisAngle:function(t,e){var i=Ke.__q1.setFromAxisAngle(t,e);return this.applyQuaternion(i),this},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return 0!==t?(this.x/=t,this.y/=t,this.z/=t):(this.x=0,this.y=0,this.z=0),this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this.z>t.z&&(this.z=t.z),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this.z<t.z&&(this.z=t.z),this},clamp:function(t,e){return this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x),this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y),this.z<t.z?this.z=t.z:this.z>e.z&&(this.z=e.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){var e=this.length();return 0!==e&&t!==e&&this.multiplyScalar(t/e),this},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this},cross:function(t){var e=this.x,i=this.y,r=this.z;return this.x=i*t.z-r*t.y,this.y=r*t.x-e*t.z,this.z=e*t.y-i*t.x,this},crossVectors:function(t,e){return this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x,this},angleTo:function(t){return Math.acos(this.dot(t)/this.length()/t.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y,r=this.z-t.z;return e*e+i*i+r*r},getPositionFromMatrix:function(t){return this.x=t.elements[12],this.y=t.elements[13],this.z=t.elements[14],this},setEulerFromRotationMatrix:function(t,i){function r(t){return Math.min(Math.max(t,-1),1)}var a=t.elements,n=a[0],s=a[4],o=a[8],l=a[1],h=a[5],c=a[9],u=a[2],f=a[6],d=a[10];return i===e||"XYZ"===i?(this.y=Math.asin(r(o)),Math.abs(o)<.99999?(this.x=Math.atan2(-c,d),this.z=Math.atan2(-s,n)):(this.x=Math.atan2(f,h),this.z=0)):"YXZ"===i?(this.x=Math.asin(-r(c)),Math.abs(c)<.99999?(this.y=Math.atan2(o,d),this.z=Math.atan2(l,h)):(this.y=Math.atan2(-u,n),this.z=0)):"ZXY"===i?(this.x=Math.asin(r(f)),Math.abs(f)<.99999?(this.y=Math.atan2(-u,d),this.z=Math.atan2(-s,h)):(this.y=0,this.z=Math.atan2(l,n))):"ZYX"===i?(this.y=Math.asin(-r(u)),Math.abs(u)<.99999?(this.x=Math.atan2(f,d),this.z=Math.atan2(l,n)):(this.x=0,this.z=Math.atan2(-s,h))):"YZX"===i?(this.z=Math.asin(r(l)),Math.abs(l)<.99999?(this.x=Math.atan2(-c,h),this.y=Math.atan2(-u,n)):(this.x=0,this.y=Math.atan2(o,d))):"XZY"===i&&(this.z=Math.asin(-r(s)),Math.abs(s)<.99999?(this.x=Math.atan2(f,h),this.y=Math.atan2(o,n)):(this.x=Math.atan2(-c,d),this.y=0)),this},setEulerFromQuaternion:function(t,i){function r(t){return Math.min(Math.max(t,-1),1)}var a=t.x*t.x,n=t.y*t.y,s=t.z*t.z,o=t.w*t.w;return i===e||"XYZ"===i?(this.x=Math.atan2(2*(t.x*t.w-t.y*t.z),o-a-n+s),this.y=Math.asin(r(2*(t.x*t.z+t.y*t.w))),this.z=Math.atan2(2*(t.z*t.w-t.x*t.y),o+a-n-s)):"YXZ"===i?(this.x=Math.asin(r(2*(t.x*t.w-t.y*t.z))),this.y=Math.atan2(2*(t.x*t.z+t.y*t.w),o-a-n+s),this.z=Math.atan2(2*(t.x*t.y+t.z*t.w),o-a+n-s)):"ZXY"===i?(this.x=Math.asin(r(2*(t.x*t.w+t.y*t.z))),this.y=Math.atan2(2*(t.y*t.w-t.z*t.x),o-a-n+s),this.z=Math.atan2(2*(t.z*t.w-t.x*t.y),o-a+n-s)):"ZYX"===i?(this.x=Math.atan2(2*(t.x*t.w+t.z*t.y),o-a-n+s),this.y=Math.asin(r(2*(t.y*t.w-t.x*t.z))),this.z=Math.atan2(2*(t.x*t.y+t.z*t.w),o+a-n-s)):"YZX"===i?(this.x=Math.atan2(2*(t.x*t.w-t.z*t.y),o-a+n-s),this.y=Math.atan2(2*(t.y*t.w-t.x*t.z),o+a-n-s),this.z=Math.asin(r(2*(t.x*t.y+t.z*t.w)))):"XZY"===i&&(this.x=Math.atan2(2*(t.x*t.w+t.y*t.z),o-a+n-s),this.y=Math.atan2(2*(t.x*t.z+t.y*t.w),o+a-n-s),this.z=Math.asin(r(2*(t.z*t.w-t.x*t.y)))),this},getScaleFromMatrix:function(t){var e=this.set(t.elements[0],t.elements[1],t.elements[2]).length(),i=this.set(t.elements[4],t.elements[5],t.elements[6]).length(),r=this.set(t.elements[8],t.elements[9],t.elements[10]).length();return this.x=e,this.y=i,this.z=r,this},toString:function(){return this.x+"_"+this.y+"_"+this.z},equals:function(t){return null!=t&&(t.x===this.x&&t.y===this.y&&t.z===this.z)},clone:function(){return new Ke(this.x,this.y,this.z)},setFromMatrixPosition:function(t){return this.x=t.elements[12],this.y=t.elements[13],this.z=t.elements[14],this},rotateFromAxisAndCenter:function(t,e,i){var r=(new Je.Mat4).makeRotationAxisAndCenter(t,e,i);return this.applyMatrix4(r),this},rotationTowards:function(t,e){var i=(new Je.Mat4).rotationTowards(t,e);return this.setEulerFromRotationMatrix(i),this},constructor:Je.Vec3},Ke.__q1=new Je.Quat,Je.Vec4=function(t,i,r,a){this.x=t||0,this.y=i||0,this.z=r||0,this.w=a!==e?a:1},Je.Vec4.prototype={constructor:Je.Vec4,set:function(t,e,i,r){return this.x=t,this.y=e,this.z=i,this.w=r,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==e?t.w:1,this},add:function(t,i){return i!==e?(console.warn("DEPRECATED: Vec4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},sub:function(t,i){return i!==e?(console.warn("DEPRECATED: Vec4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,i=this.y,r=this.z,a=this.w,n=t.elements;return this.x=n[0]*e+n[4]*i+n[8]*r+n[12]*a,this.y=n[1]*e+n[5]*i+n[9]*r+n[13]*a,this.z=n[2]*e+n[6]*i+n[10]*r+n[14]*a,this.w=n[3]*e+n[7]*i+n[11]*r+n[15]*a,this},divideScalar:function(t){return 0!==t?(this.x/=t,this.y/=t,this.z/=t,this.w/=t):(this.x=0,this.y=0,this.z=0,this.w=1),this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this.z>t.z&&(this.z=t.z),this.w>t.w&&(this.w=t.w),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this.z<t.z&&(this.z=t.z),this.w<t.w&&(this.w=t.w),this},clamp:function(t,e){return this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x),this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y),this.z<t.z?this.z=t.z:this.z>e.z&&(this.z=e.z),this.w<t.w?this.w=t.w:this.w>e.w&&(this.w=e.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){var e=this.length();return 0!==e&&t!==e&&this.multiplyScalar(t/e),this},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},clone:function(){return new Je.Vec4(this.x,this.y,this.z,this.w)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,i,r,a,n=.01,s=.1,o=t.elements,l=o[0],h=o[4],c=o[8],u=o[1],f=o[5],d=o[9],p=o[2],m=o[6],g=o[10];if(Math.abs(h-u)<n&&Math.abs(c-p)<n&&Math.abs(d-m)<n){if(Math.abs(h+u)<s&&Math.abs(c+p)<s&&Math.abs(d+m)<s&&Math.abs(l+f+g-3)<s)return this.set(1,0,0,0),this;e=Math.PI;var y=(l+1)/2,v=(f+1)/2,x=(g+1)/2,w=(h+u)/4,_=(c+p)/4,b=(d+m)/4;return y>v&&y>x?y<n?(i=0,r=.707106781,a=.707106781):(i=Math.sqrt(y),r=w/i,a=_/i):v>x?v<n?(i=.707106781,r=0,a=.707106781):(r=Math.sqrt(v),i=w/r,a=b/r):x<n?(i=.707106781,r=.707106781,a=0):(a=Math.sqrt(x),i=_/a,r=b/a),this.set(i,r,a,e),this}var M=Math.sqrt((m-d)*(m-d)+(c-p)*(c-p)+(u-h)*(u-h));return Math.abs(M)<.001&&(M=1),this.x=(m-d)/M,this.y=(c-p)/M,this.z=(u-h)/M,this.w=Math.acos((l+f+g-1)/2),this}};var $e=function(t,i,r,a,n,s,o,l,h){this.elements=new Float32Array(9),this.set(t!==e?t:1,i||0,r||0,a||0,n!==e?n:1,s||0,o||0,l||0,h!==e?h:1)};$e.prototype={constructor:$e,set:function(t,e,i,r,a,n,s,o,l){var h=this.elements;return h[0]=t,h[3]=e,h[6]=i,h[1]=r,h[4]=a,h[7]=n,h[2]=s,h[5]=o,h[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(t){var e=t.elements;return this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]),this},multiplyVector3:function(t){return console.warn("DEPRECATED: Mat3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){var t=new Ke;return function(e){for(var i=0,r=e.length;i<r;i+=3)t.x=e[i],t.y=e[i+1],t.z=e[i+2],t.applyMatrix3(this),e[i]=t.x,e[i+1]=t.y,e[i+2]=t.z;return e}}(),multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],i=t[1],r=t[2],a=t[3],n=t[4],s=t[5],o=t[6],l=t[7],h=t[8];return e*n*h-e*s*l-i*a*h+i*s*o+r*a*l-r*n*o},getInverse:function(t,e){var i=t.elements,r=this.elements;r[0]=i[10]*i[5]-i[6]*i[9],r[1]=-i[10]*i[1]+i[2]*i[9],r[2]=i[6]*i[1]-i[2]*i[5],r[3]=-i[10]*i[4]+i[6]*i[8],r[4]=i[10]*i[0]-i[2]*i[8],r[5]=-i[6]*i[0]+i[2]*i[4],r[6]=i[9]*i[4]-i[5]*i[8],r[7]=-i[9]*i[0]+i[1]*i[8],r[8]=i[5]*i[0]-i[1]*i[4];var a=i[0]*r[0]+i[1]*r[3]+i[2]*r[6];if(0===a){var n="Mat3.getInverse(): can't invert matrix, determinant is 0";if(e)throw new Error(n);return console.warn(n),this.identity(),this}return this.multiplyScalar(1/a),this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.getInverse(t).transpose(),this},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},clone:function(){var t=this.elements;return new $e(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])}},Je.Mat3=$e;var ti=function(t,i,r,a,n,s,o,l,h,c,u,f,d,p,m,g){this.elements=new Float32Array(16),this.set(t!==e?t:1,i||0,r||0,a||0,n||0,s!==e?s:1,o||0,l||0,h||0,c||0,u!==e?u:1,f||0,d||0,p||0,m||0,g!==e?g:1)};ti.prototype={constructor:ti,set:function(t,e,i,r,a,n,s,o,l,h,c,u,f,d,p,m){var g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=r,g[1]=a,g[5]=n,g[9]=s,g[13]=o,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=f,g[7]=d,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),this},setRotationFromEuler:function(t,i){var r=this.elements,a=t.x,n=t.y,s=t.z,o=Math.cos(a),l=Math.sin(a),h=Math.cos(n),c=Math.sin(n),u=Math.cos(s),f=Math.sin(s);if(i===e||"XYZ"===i){var d=o*u,p=o*f,m=l*u,g=l*f;r[0]=h*u,r[4]=-h*f,r[8]=c,r[1]=p+m*c,r[5]=d-g*c,r[9]=-l*h,r[2]=g-d*c,r[6]=m+p*c,r[10]=o*h}else if("YXZ"===i){var y=h*u,v=h*f,x=c*u,w=c*f;r[0]=y+w*l,r[4]=x*l-v,r[8]=o*c,r[1]=o*f,r[5]=o*u,r[9]=-l,r[2]=v*l-x,r[6]=w+y*l,r[10]=o*h}else if("ZXY"===i){var y=h*u,v=h*f,x=c*u,w=c*f;r[0]=y-w*l,r[4]=-o*f,r[8]=x+v*l,r[1]=v+x*l,r[5]=o*u,r[9]=w-y*l,r[2]=-o*c,r[6]=l,r[10]=o*h}else if("ZYX"===i){var d=o*u,p=o*f,m=l*u,g=l*f;r[0]=h*u,r[4]=m*c-p,r[8]=d*c+g,r[1]=h*f,r[5]=g*c+d,r[9]=p*c-m,r[2]=-c,r[6]=l*h,r[10]=o*h}else if("YZX"===i){var _=o*h,b=o*c,M=l*h,S=l*c;r[0]=h*u,r[4]=S-_*f,r[8]=M*f+b,r[1]=f,r[5]=o*u,r[9]=-l*u,r[2]=-c*u,r[6]=b*f+M,r[10]=_-S*f}else if("XZY"===i){var _=o*h,b=o*c,M=l*h,S=l*c;r[0]=h*u,r[4]=-f,r[8]=c*u,r[1]=_*f+S,r[5]=o*u,r[9]=b*f-M,r[2]=M*f-b,r[6]=l*u,r[10]=S*f+_}return this},setRotationFromQuaternion:function(t){var e=this.elements,i=t.x,r=t.y,a=t.z,n=t.w,s=i+i,o=r+r,l=a+a,h=i*s,c=i*o,u=i*l,f=r*o,d=r*l,p=a*l,m=n*s,g=n*o,y=n*l;return e[0]=1-(f+p),e[4]=c-y,e[8]=u+g,e[1]=c+y,e[5]=1-(h+p),e[9]=d-m,e[2]=u-g,e[6]=d+m,e[10]=1-(h+f),this},lookAt:function(t,e,i){var r=this.elements,a=ti.__v1,n=ti.__v2,s=ti.__v3;return s.subVectors(t,e).normalize(),0===s.length()&&(s.z=1),a.crossVectors(i,s).normalize(),0===a.length()&&(s.x+=1e-4,a.crossVectors(i,s).normalize()),n.crossVectors(s,a),r[0]=a.x,r[1]=a.y,r[2]=a.z,r[4]=n.x,r[5]=n.y,r[6]=n.z,r[8]=s.x,r[9]=s.y,r[10]=s.z,this},multiply:function(t,i){return i!==e?this.multiplyMatrices(t,i):this.multiplyMatrices(this,t)},multiplyMatrices:function(t,e){var i=t.elements,r=e.elements,a=this.elements,n=i[0],s=i[4],o=i[8],l=i[12],h=i[1],c=i[5],u=i[9],f=i[13],d=i[2],p=i[6],m=i[10],g=i[14],y=i[3],v=i[7],x=i[11],w=i[15],_=r[0],b=r[4],M=r[8],S=r[12],A=r[1],P=r[5],T=r[9],C=r[13],z=r[2],L=r[6],E=r[10],D=r[14],N=r[3],B=r[7],R=r[11],F=r[15];return a[0]=n*_+s*A+o*z+l*N,a[4]=n*b+s*P+o*L+l*B,a[8]=n*M+s*T+o*E+l*R,a[12]=n*S+s*C+o*D+l*F,a[1]=h*_+c*A+u*z+f*N,a[5]=h*b+c*P+u*L+f*B,a[9]=h*M+c*T+u*E+f*R,a[13]=h*S+c*C+u*D+f*F,a[2]=d*_+p*A+m*z+g*N,a[6]=d*b+p*P+m*L+g*B,a[10]=d*M+p*T+m*E+g*R,a[14]=d*S+p*C+m*D+g*F,a[3]=y*_+v*A+x*z+w*N,a[7]=y*b+v*P+x*L+w*B,a[11]=y*M+v*T+x*E+w*R,a[15]=y*S+v*C+x*D+w*F,this},multiplyToArray:function(t,e,i){var r=this.elements;return this.multiplyMatrices(t,e),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},multiplyVector3:function(t){return t.applyProjection(this)},multiplyVector4:function(t){return t.applyMatrix4(this)},multiplyVector3Array:function(t){for(var e=ti.__v1,i=0,r=t.length;i<r;i+=3)e.x=t[i],e.y=t[i+1],e.z=t[i+2],e.applyProjection(this),t[i]=e.x,t[i+1]=e.y,t[i+2]=e.z;return t},rotateAxis:function(t){var e=this.elements,i=t.x,r=t.y,a=t.z;return t.x=i*e[0]+r*e[4]+a*e[8],t.y=i*e[1]+r*e[5]+a*e[9],t.z=i*e[2]+r*e[6]+a*e[10],t.normalize(),t},crossVector:function(t){var e=this.elements,i=new Je.Vector4;return i.x=e[0]*t.x+e[4]*t.y+e[8]*t.z+e[12]*t.w,i.y=e[1]*t.x+e[5]*t.y+e[9]*t.z+e[13]*t.w,i.z=e[2]*t.x+e[6]*t.y+e[10]*t.z+e[14]*t.w,i.w=t.w?e[3]*t.x+e[7]*t.y+e[11]*t.z+e[15]*t.w:1,i},determinant:function(){var t=this.elements,e=t[0],i=t[4],r=t[8],a=t[12],n=t[1],s=t[5],o=t[9],l=t[13],h=t[2],c=t[6],u=t[10],f=t[14],d=t[3],p=t[7],m=t[11],g=t[15];return d*(+a*o*c-r*l*c-a*s*u+i*l*u+r*s*f-i*o*f)+p*(+e*o*f-e*l*u+a*n*u-r*n*f+r*l*h-a*o*h)+m*(+e*l*c-e*s*f-a*n*c+i*n*f+a*s*h-i*l*h)+g*(-r*s*h-e*o*c+e*s*u+r*n*c-i*n*u+i*o*h)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},flattenToArrayOffset:function(t,e){var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t},getPosition:function(){var t=this.elements;return(new Ke).set(t[12],t[13],t[14])},setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getColumnX:function(){var t=this.elements;return ti.__v1.set(t[0],t[1],t[2])},getColumnY:function(){var t=this.elements;return ti.__v1.set(t[4],t[5],t[6])},getColumnZ:function(){var t=this.elements;return ti.__v1.set(t[8],t[9],t[10])},getInverse:function(t,e){var i=this.elements,r=t.elements,a=r[0],n=r[4],s=r[8],o=r[12],l=r[1],h=r[5],c=r[9],u=r[13],f=r[2],d=r[6],p=r[10],m=r[14],g=r[3],y=r[7],v=r[11],x=r[15];i[0]=c*m*y-u*p*y+u*d*v-h*m*v-c*d*x+h*p*x,i[4]=o*p*y-s*m*y-o*d*v+n*m*v+s*d*x-n*p*x,i[8]=s*u*y-o*c*y+o*h*v-n*u*v-s*h*x+n*c*x,i[12]=o*c*d-s*u*d-o*h*p+n*u*p+s*h*m-n*c*m,i[1]=u*p*g-c*m*g-u*f*v+l*m*v+c*f*x-l*p*x,i[5]=s*m*g-o*p*g+o*f*v-a*m*v-s*f*x+a*p*x,i[9]=o*c*g-s*u*g-o*l*v+a*u*v+s*l*x-a*c*x,i[13]=s*u*f-o*c*f+o*l*p-a*u*p-s*l*m+a*c*m,i[2]=h*m*g-u*d*g+u*f*y-l*m*y-h*f*x+l*d*x,i[6]=o*d*g-n*m*g-o*f*y+a*m*y+n*f*x-a*d*x,i[10]=n*u*g-o*h*g+o*l*y-a*u*y-n*l*x+a*h*x,i[14]=o*h*f-n*u*f-o*l*d+a*u*d+n*l*m-a*h*m,i[3]=c*d*g-h*p*g-c*f*y+l*p*y+h*f*v-l*d*v,i[7]=n*p*g-s*d*g+s*f*y-a*p*y-n*f*v+a*d*v,i[11]=s*h*g-n*c*g-s*l*y+a*c*y+n*l*v-a*h*v,i[15]=n*c*f-s*h*f+s*l*d-a*c*d-n*l*p+a*h*p;var w=r[0]*i[0]+r[1]*i[4]+r[2]*i[8]+r[3]*i[12];if(0==w){var _="Mat4.getInverse(): can't invert matrix, determinant is 0";if(e)throw new Error(_);return console.warn(_),this.identity(),this}return this.multiplyScalar(1/w),this},compose:function(t,e,i){var r=this.elements,a=ti.__m1,n=ti.__m2;return a.identity(),a.setRotationFromQuaternion(e),n.makeScale(i.x,i.y,i.z),this.multiplyMatrices(a,n),r[12]=t.x,r[13]=t.y,r[14]=t.z,this},decompose:function(t,e,i){var r=this.elements,a=ti.__v1,n=ti.__v2,s=ti.__v3;a.set(r[0],r[1],r[2]),n.set(r[4],r[5],r[6]),s.set(r[8],r[9],r[10]),t=t instanceof Ke?t:new Ke,e=e instanceof Je.Quat?e:new Je.Quat,i=i instanceof Ke?i:new Ke,i.x=a.length(),i.y=n.length(),i.z=s.length(),t.x=r[12],t.y=r[13],t.z=r[14];var o=ti.__m1;return o.copy(this),o.elements[0]/=i.x,o.elements[1]/=i.x,o.elements[2]/=i.x,o.elements[4]/=i.y,o.elements[5]/=i.y,o.elements[6]/=i.y,o.elements[8]/=i.z,o.elements[9]/=i.z,o.elements[10]/=i.z,e.setFromRotationMatrix(o),[t,e,i]},extractPosition:function(t){var e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this},extractRotation:function(t){var e=this.elements,i=t.elements,r=ti.__v1,a=1/r.set(i[0],i[1],i[2]).length(),n=1/r.set(i[4],i[5],i[6]).length(),s=1/r.set(i[8],i[9],i[10]).length();return e[0]=i[0]*a,e[1]=i[1]*a,e[2]=i[2]*a,e[4]=i[4]*n,e[5]=i[5]*n,e[6]=i[6]*n,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,this},translate:function(t){var e=this.elements,i=t.x,r=t.y,a=t.z;return e[12]=e[0]*i+e[4]*r+e[8]*a+e[12],e[13]=e[1]*i+e[5]*r+e[9]*a+e[13],e[14]=e[2]*i+e[6]*r+e[10]*a+e[14],e[15]=e[3]*i+e[7]*r+e[11]*a+e[15],this},rotateX:function(t){var e=this.elements,i=e[4],r=e[5],a=e[6],n=e[7],s=e[8],o=e[9],l=e[10],h=e[11],c=Math.cos(t),u=Math.sin(t);return e[4]=c*i+u*s,e[5]=c*r+u*o,e[6]=c*a+u*l,e[7]=c*n+u*h,e[8]=c*s-u*i,e[9]=c*o-u*r,e[10]=c*l-u*a,e[11]=c*h-u*n,this},rotateY:function(t){var e=this.elements,i=e[0],r=e[1],a=e[2],n=e[3],s=e[8],o=e[9],l=e[10],h=e[11],c=Math.cos(t),u=Math.sin(t);return e[0]=c*i-u*s,e[1]=c*r-u*o,e[2]=c*a-u*l,e[3]=c*n-u*h,e[8]=c*s+u*i,e[9]=c*o+u*r,e[10]=c*l+u*a,e[11]=c*h+u*n,this},rotateZ:function(t){var e=this.elements,i=e[0],r=e[1],a=e[2],n=e[3],s=e[4],o=e[5],l=e[6],h=e[7],c=Math.cos(t),u=Math.sin(t);return e[0]=c*i+u*s,e[1]=c*r+u*o,e[2]=c*a+u*l,e[3]=c*n+u*h,e[4]=c*s-u*i,e[5]=c*o-u*r,e[6]=c*l-u*a,e[7]=c*h-u*n,this},rotateByAxis:function(t,e){var i=this.elements;if(1===t.x&&0===t.y&&0===t.z)return this.rotateX(e);if(0===t.x&&1===t.y&&0===t.z)return this.rotateY(e);if(0===t.x&&0===t.y&&1===t.z)return this.rotateZ(e);var r=t.x,a=t.y,n=t.z,s=Math.sqrt(r*r+a*a+n*n);r/=s,a/=s,n/=s;var o=r*r,l=a*a,h=n*n,c=Math.cos(e),u=Math.sin(e),f=1-c,d=r*a*f,p=r*n*f,m=a*n*f,g=r*u,y=a*u,v=n*u,x=o+(1-o)*c,w=d+v,_=p-y,b=d-v,M=l+(1-l)*c,S=m+g,A=p+y,P=m-g,T=h+(1-h)*c,C=i[0],z=i[1],L=i[2],E=i[3],D=i[4],N=i[5],B=i[6],R=i[7],F=i[8],I=i[9],k=i[10],V=i[11];i[12],i[13],i[14],i[15];return i[0]=x*C+w*D+_*F,i[1]=x*z+w*N+_*I,i[2]=x*L+w*B+_*k,i[3]=x*E+w*R+_*V,i[4]=b*C+M*D+S*F,i[5]=b*z+M*N+S*I,i[6]=b*L+M*B+S*k,i[7]=b*E+M*R+S*V,i[8]=A*C+P*D+T*F,i[9]=A*z+P*N+T*I,i[10]=A*L+P*B+T*k,i[11]=A*E+P*R+T*V,this},scale:function(t){var e=this.elements,i=t.x,r=t.y,a=t.z;return e[0]*=i,e[4]*=r,e[8]*=a,e[1]*=i,e[5]*=r,e[9]*=a,e[2]*=i,e[6]*=r,e[10]*=a,e[3]*=i,e[7]*=r,e[11]*=a,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,Math.max(i,r)))},makeTranslation:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var i=Math.cos(e),r=Math.sin(e),a=1-i,n=t.x,s=t.y,o=t.z,l=a*n,h=a*s;return this.set(l*n+i,l*s-r*o,l*o+r*s,0,l*s+r*o,h*s+i,h*o-r*n,0,l*o-r*s,h*o+r*n,a*o*o+i,0,0,0,0,1),this},makeScale:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},makeFrustum:function(t,e,i,r,a,n){var s=this.elements,o=2*a/(e-t),l=2*a/(r-i),h=(e+t)/(e-t),c=(r+i)/(r-i),u=-(n+a)/(n-a),f=-2*n*a/(n-a);return s[0]=o,s[4]=0,s[8]=h,s[12]=0,s[1]=0,s[5]=l,s[9]=c,s[13]=0,s[2]=0,s[6]=0,s[10]=u,s[14]=f,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makePerspective:function(t,e,i,r){var a=i*Math.tan(Je.Math.degToRad(.5*t)),n=-a,s=n*e,o=a*e;return this.makeFrustum(s,o,n,a,i,r);
},makeOrthographic:function(t,e,i,r,a,n){var s=this.elements,o=e-t,l=i-r,h=n-a,c=(e+t)/o,u=(i+r)/l,f=(n+a)/h;return s[0]=2/o,s[4]=0,s[8]=0,s[12]=-c,s[1]=0,s[5]=2/l,s[9]=0,s[13]=-u,s[2]=0,s[6]=0,s[10]=-2/h,s[14]=-f,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},clone:function(){var t=this.elements;return new ti(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])},makeRotationFromQuaternion:function(t){var e=this.elements,i=t.x,r=t.y,a=t.z,n=t.w,s=i+i,o=r+r,l=a+a,h=i*s,c=i*o,u=i*l,f=r*o,d=r*l,p=a*l,m=n*s,g=n*o,y=n*l;return e[0]=1-(f+p),e[4]=c-y,e[8]=u+g,e[1]=c+y,e[5]=1-(h+p),e[9]=d-m,e[2]=u-g,e[6]=d+m,e[10]=1-(h+f),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},getEulerAngles:function(){var t=(new ti).extractRotation(this).elements,e=t[0],i=t[1],r=t[2],a=t[5],n=t[6],s=t[10],o=Math.atan2(n,s),l=Math.atan2(-r,Math.sqrt(e*e+i*i)),h=Math.sin(o),c=Math.cos(o),u=Math.atan2(h*t[8]-c*t[4],c*a-h*t[9]);return new Ke(o,l,u)},makeRotationAxisAndCenter:function(t,e,i){var r=Math.cos(e),a=Math.sin(e),n=1-r,s=t.x,o=t.y,l=t.z,h=n*s,c=n*o,u=i.x,f=i.y,d=i.z,p=this,m=new Float32Array(16);return m[0]=h*s+r,m[4]=h*o-a*l,m[8]=h*l+a*o,m[12]=u-u*(h*s+r)-f*(h*o-a*l)-d*(h*l+a*o),m[1]=h*o+a*l,m[5]=c*o+r,m[9]=c*l-a*s,m[13]=f-u*(h*o+a*l)-f*(c*o+r)-d*(c*l-a*s),m[2]=h*l-a*o,m[6]=c*l+a*s,m[10]=n*l*l+r,m[14]=d-u*(h*l-a*o)-f*(c*l+a*s)-d*(n*l*l+r),m[3]=0,m[7]=0,m[11]=0,m[15]=1,p.elements=m,p},rotationTowards:function(t,e){var i=Math.acos(e.dot(t)/e.length()/t.length()),r=(new Je.Vec3).crossVectors(e,t).normalize();return this.makeRotationAxis(r,-i),this},equals:function(t){if(t instanceof ti){for(var e=0;e<this.elements.length;e++)if(Math.abs(this.elements[e]-t.elements[e])>1e-4)return!1;return!0}}},ti.__v1=new Ke,ti.__v2=new Ke,ti.__v3=new Ke,ti.__m1=new ti,ti.__m2=new ti,Je.Mat4=ti,Je.Euler=function(t,e,i,r){this._x=t||0,this._y=e||0,this._z=i||0,this._order=r||Je.Euler.DefaultOrder},Je.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Je.Euler.DefaultOrder="XYZ",Je.Euler.prototype={constructor:Je.Euler,_x:0,_y:0,_z:0,_order:Je.Euler.DefaultOrder,_quaternion:e,_updateQuaternion:function(){this._quaternion!==e&&this._quaternion.setFromEuler(this,!1)},get x(){return this._x},set x(t){this._x=t,this._updateQuaternion()},get y(){return this._y},set y(t){this._y=t,this._updateQuaternion()},get z(){return this._z},set z(t){this._z=t,this._updateQuaternion()},get order(){return this._order},set order(t){this._order=t,this._updateQuaternion()},set:function(t,e,i,r){return this._x=t,this._y=e,this._z=i,this._order=r||this._order,this._updateQuaternion(),this},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._updateQuaternion(),this},setFromRotationMatrix:function(t,e){function i(t){return Math.min(Math.max(t,-1),1)}var r=t.elements,a=r[0],n=r[4],s=r[8],o=r[1],l=r[5],h=r[9],c=r[2],u=r[6],f=r[10];return e=e||this._order,"XYZ"===e?(this._y=Math.asin(i(s)),Math.abs(s)<.99999?(this._x=Math.atan2(-h,f),this._z=Math.atan2(-n,a)):(this._x=Math.atan2(u,l),this._z=0)):"YXZ"===e?(this._x=Math.asin(-i(h)),Math.abs(h)<.99999?(this._y=Math.atan2(s,f),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-c,a),this._z=0)):"ZXY"===e?(this._x=Math.asin(i(u)),Math.abs(u)<.99999?(this._y=Math.atan2(-c,f),this._z=Math.atan2(-n,l)):(this._y=0,this._z=Math.atan2(o,a))):"ZYX"===e?(this._y=Math.asin(-i(c)),Math.abs(c)<.99999?(this._x=Math.atan2(u,f),this._z=Math.atan2(o,a)):(this._x=0,this._z=Math.atan2(-n,l))):"YZX"===e?(this._z=Math.asin(i(o)),Math.abs(o)<.99999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,a)):(this._x=0,this._y=Math.atan2(s,f))):"XZY"===e?(this._z=Math.asin(-i(n)),Math.abs(n)<.99999?(this._x=Math.atan2(u,l),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-h,f),this._y=0)):console.warn("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+e),this._order=e,this._updateQuaternion(),this},setFromQuaternion:function(t,e,i){function r(t){return Math.min(Math.max(t,-1),1)}var a=t.x*t.x,n=t.y*t.y,s=t.z*t.z,o=t.w*t.w;return e=e||this._order,"XYZ"===e?(this._x=Math.atan2(2*(t.x*t.w-t.y*t.z),o-a-n+s),this._y=Math.asin(r(2*(t.x*t.z+t.y*t.w))),this._z=Math.atan2(2*(t.z*t.w-t.x*t.y),o+a-n-s)):"YXZ"===e?(this._x=Math.asin(r(2*(t.x*t.w-t.y*t.z))),this._y=Math.atan2(2*(t.x*t.z+t.y*t.w),o-a-n+s),this._z=Math.atan2(2*(t.x*t.y+t.z*t.w),o-a+n-s)):"ZXY"===e?(this._x=Math.asin(r(2*(t.x*t.w+t.y*t.z))),this._y=Math.atan2(2*(t.y*t.w-t.z*t.x),o-a-n+s),this._z=Math.atan2(2*(t.z*t.w-t.x*t.y),o-a+n-s)):"ZYX"===e?(this._x=Math.atan2(2*(t.x*t.w+t.z*t.y),o-a-n+s),this._y=Math.asin(r(2*(t.y*t.w-t.x*t.z))),this._z=Math.atan2(2*(t.x*t.y+t.z*t.w),o+a-n-s)):"YZX"===e?(this._x=Math.atan2(2*(t.x*t.w-t.z*t.y),o-a+n-s),this._y=Math.atan2(2*(t.y*t.w-t.x*t.z),o+a-n-s),this._z=Math.asin(r(2*(t.x*t.y+t.z*t.w)))):"XZY"===e?(this._x=Math.atan2(2*(t.x*t.w+t.y*t.z),o-a+n-s),this._y=Math.atan2(2*(t.x*t.z+t.y*t.w),o+a-n-s),this._z=Math.asin(r(2*(t.z*t.w-t.x*t.y)))):console.warn("WARNING: Euler.setFromQuaternion() given unsupported order: "+e),this._order=e,i!==!1&&this._updateQuaternion(),this},reorder:function(){var t=new Je.Quat;return function(e){t.setFromEuler(this),this.setFromQuaternion(t,e)}}(),fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==e&&(this._order=t[3]),this._updateQuaternion(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},clone:function(){return new Je.Euler(this._x,this._y,this._z,this._order)}},Je.math={},Je.math.Plane=function(t,i){this.normal=t!==e?t:new Ke(1,0,0),this.constant=i!==e?i:0},Je.math.Plane.prototype={constructor:Je.math.Plane,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,i,r){return this.normal.set(t,e,i),this.constant=r,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(t,e,i){var r=Je.math.Plane.__v1.subVectors(i,e).cross(Je.math.Plane.__v2.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return this.orthoPoint(t,e).sub(t).negate()},orthoPoint:function(t,e){var i=this.distanceToPoint(t),r=e||new Ke;return r.copy(this.normal).multiplyScalar(i)},isIntersectionLine:function(t,e){var i=this.distanceToPoint(t),r=this.distanceToPoint(e);return i<0&&r>0||r<0&&i>0},isIntersectionFace:function(t,e){var i=[];i.push(e[t.a]),i.push(e[t.b]),i.push(e[t.c]),null!=t.d&&i.push(e[t.d]);var r,a,n,s=[];for(r=0;r<i.length;r++)s.push(this.distanceToPoint(i[r]));for(r=0;r<s.length;r++)if(0==r)a=n=s[r];else{if(n=s[r],a<0&&n>0||n<0&&a>0)return"intersect";a=n}return n>0?"in":"out"},intersectLine:function(t,i,r){var a=r||new Ke,n=Je.math.Plane.__v1.subVectors(i,t),s=this.normal.dot(n);if(0==s)return 0==this.distanceToPoint(t)?a.copy(t):e;var o=-(t.dot(this.normal)+this.constant)/s;return o<0||o>1?e:a.copy(n).multiplyScalar(o).add(t)},coplanarPoint:function(t){var e=t||new Ke;return e.copy(this.normal).multiplyScalar(-this.constant)},transform:function(t,e){e=e||(new Je.Mat3).getInverse(t).transpose();var i=Je.math.Plane.__v1.copy(this.normal).applyMatrix3(e),r=this.coplanarPoint(Je.math.Plane.__v2);return r.applyMatrix4(t),this.setFromNormalAndCoplanarPoint(i,r),this},translate:function(t){return this.constant=this.constant-t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant==this.constant},clone:function(){return(new Je.math.Plane).copy(this)}},Je.math.Plane.__vZero=new Ke(0,0,0),Je.math.Plane.__v1=new Ke,Je.math.Plane.__v2=new Ke,Je.Frustum=function(t,i,r,a,n,s){this.planes=[t!==e?t:new Je.math.Plane,i!==e?i:new Je.math.Plane,r!==e?r:new Je.math.Plane,a!==e?a:new Je.math.Plane,n!==e?n:new Je.math.Plane,s!==e?s:new Je.math.Plane]},Je.Frustum.prototype={set:function(t,e,i,r,a,n){var s=this.planes;return s[0].copy(t),s[1].copy(e),s[2].copy(i),s[3].copy(r),s[4].copy(a),s[5].copy(n),this},setPoints:function(t){this.points=t},copy:function(t){for(var e=this.planes,i=0;i<6;i++)e[i].copy(t.planes[i]);return this},setFromMatrix:function(t){var e=this.planes,i=t.elements,r=i[0],a=i[1],n=i[2],s=i[3],o=i[4],l=i[5],h=i[6],c=i[7],u=i[8],f=i[9],d=i[10],p=i[11],m=i[12],g=i[13],y=i[14],v=i[15];return e[0].setComponents(s-r,c-o,p-u,v-m).normalize(),e[1].setComponents(s+r,c+o,p+u,v+m).normalize(),e[2].setComponents(s+a,c+l,p+f,v+g).normalize(),e[3].setComponents(s-a,c-l,p-f,v-g).normalize(),e[4].setComponents(s-n,c-h,p-d,v-y).normalize(),e[5].setComponents(s+n,c+h,p+d,v+y).normalize(),this},intersectsObjectAccurate:function(t,e){if(0==e)return this.intersectsObject(t);var i,r,a=t.worldMatrix,n=(this.planes,t.vertices),s=[],o=n.length;for(r=0;r<o;r++)if(i=n[r].clone(),i.applyMatrix4(a),s.push(i),this.containsPoint(i))return!0;if(2==e)if(t instanceof Je.Line)for(r=0,o=s.length;r<o-1;r++){var l=s[r],h=s[r+1];if(this.containsLine(l,h))return!0}else{var c,u=t.faces;for(r=0,o=u.length;r<o;r++){if(c=u[r],this.containsLine(s[c.a],s[c.b]))return!0;if(this.containsLine(s[c.b],s[c.c]))return!0;if(null!=c.d){if(this.containsLine(s[c.c],s[c.d]))return!0;if(this.containsLine(s[c.d],s[c.a]))return!0}else if(this.containsLine(s[c.a],s[c.c]))return!0}}return!1},intersectsObject:function(t){var e=t.worldMatrix,i=this.planes,r=e.getPosition();if(!t.computeBoundingSphere)return!1;t.boundingSphere||t.computeBoundingSphere();for(var a=-t.boundingSphere.radius*e.getMaxScaleOnAxis(),n=0;n<6;n++){var s=i[n].distanceToPoint(r);if(s<a)return!1}return!0},intersectsSphere:function(t){for(var e=this.planes,i=t.center,r=-t.radius,a=0;a<6;a++){var n=e[a].distanceToPoint(i);if(n<r)return!1}return!0},intersectsBox:function(t){for(var e=new Ke,i=new Ke,r=this.planes,a=0;a<6;a++){var n=r[a];e.x=n.normal.x>0?t.min.x:t.max.x,i.x=n.normal.x>0?t.max.x:t.min.x,e.y=n.normal.y>0?t.min.y:t.max.y,i.y=n.normal.y>0?t.max.y:t.min.y,e.z=n.normal.z>0?t.min.z:t.max.z,i.z=n.normal.z>0?t.max.z:t.min.z;var s=n.distanceToPoint(e),o=n.distanceToPoint(i);if(s<0&&o<0)return!1}return!0},containsLine:function(t,e){for(var i=this.planes,r=new Ke,a=0;a<6;a++)if(r=i[a].intersectLine(t,e,r),r&&this.containsPoint(r))return!0;return!1},containsPoint:function(t){for(var e=this.planes,i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0},clone:function(){return(new Je.Frustum).copy(this)}},Je.Ray=function(t,i){this.origin=t!==e?t:new Ke,this.direction=i!==e?i:new Ke},Je.Ray.prototype={constructor:Je.Ray,set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){var i=e||new Ke;return i.copy(this.direction).multiplyScalar(t).add(this.origin)},recast:function(t){return this.origin.copy(this.at(t,Je.Ray.__v1)),this},closestPointToPoint:function(t,e){var i=e||new Ke;i.subVectors(t,this.origin);var r=i.dot(this.direction);return i.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(t){var e=Je.Ray.__v1.subVectors(t,this.origin).dot(this.direction);return Je.Ray.__v1.copy(this.direction).multiplyScalar(e).add(this.origin),Je.Ray.__v1.distanceTo(t)},isIntersectionSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},isIntersectionPlane:function(t){var e=t.normal.dot(this.direction);return 0!=e||0==t.distanceToPoint(this.origin)},distanceToPlane:function(t){var i=t.normal.dot(this.direction);if(0==i)return 0==t.distanceToPoint(this.origin)?0:e;var r=-(this.origin.dot(t.normal)+t.constant)/i;return r},intersectPlane:function(t,i){var r=this.distanceToPlane(t);return r===e?e:this.at(r,i)},transform:function(t){return this.direction.add(this.origin).applyMatrix4(t),this.origin.applyMatrix4(t),this.direction.sub(this.origin),this},distanceSqToSegment:function(t,e,i,r){var a,n,s,o,l=t.clone().add(e).multiplyScalar(.5),h=e.clone().sub(t).normalize(),c=.5*t.distanceTo(e),u=this.origin.clone().sub(l),f=-this.direction.dot(h),d=u.dot(this.direction),p=-u.dot(h),m=u.lengthSq(),g=Math.abs(1-f*f);if(g>=0)if(a=f*p-d,n=f*d-p,o=c*g,a>=0)if(n>=-o)if(n<=o){var y=1/g;a*=y,n*=y,s=a*(a+f*n+2*d)+n*(f*a+n+2*p)+m}else n=c,a=Math.max(0,-(f*n+d)),s=-a*a+n*(n+2*p)+m;else n=-c,a=Math.max(0,-(f*n+d)),s=-a*a+n*(n+2*p)+m;else n<=-o?(a=Math.max(0,-(-f*c+d)),n=a>0?-c:Math.min(Math.max(-c,-p),c),s=-a*a+n*(n+2*p)+m):n<=o?(a=0,n=Math.min(Math.max(-c,-p),c),s=n*(n+2*p)+m):(a=Math.max(0,-(f*c+d)),n=a>0?c:Math.min(Math.max(-c,-p),c),s=-a*a+n*(n+2*p)+m);else n=f>0?-c:c,a=Math.max(0,-(f*n+d)),s=-a*a+n*(n+2*p)+m;return i&&i.copy(this.direction.clone().multiplyScalar(a).add(this.origin)),r&&r.copy(h.clone().multiplyScalar(n).add(l)),s},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)},clone:function(){return(new Je.Ray).copy(this)}},Je.Ray.__v1=new Ke,Je.Ray.__v2=new Ke,Je.Triangle=function(t,i,r){this.a=t!==e?t:new Ke,this.b=i!==e?i:new Ke,this.c=r!==e?r:new Ke},Je.Triangle.normal=function(t,e,i,r){var a=r||new Ke;a.subVectors(i,e),Je.Triangle.__v0.subVectors(t,e),a.cross(Je.Triangle.__v0);var n=a.lengthSq();return n>0?a.multiplyScalar(1/Math.sqrt(n)):a.set(0,0,0)},Je.Triangle.barycoordFromPoint=function(t,e,i,r,a){Je.Triangle.__v0.subVectors(r,e),Je.Triangle.__v1.subVectors(i,e),Je.Triangle.__v2.subVectors(t,e);var n=Je.Triangle.__v0.dot(Je.Triangle.__v0),s=Je.Triangle.__v0.dot(Je.Triangle.__v1),o=Je.Triangle.__v0.dot(Je.Triangle.__v2),l=Je.Triangle.__v1.dot(Je.Triangle.__v1),h=Je.Triangle.__v1.dot(Je.Triangle.__v2),c=n*l-s*s,u=a||new Ke;if(0==c)return u.set(-2,-1,-1);var f=1/c,d=(l*o-s*h)*f,p=(n*h-s*o)*f;return u.set(1-d-p,p,d)},Je.Triangle.containsPoint=function(t,e,i,r){var a=Je.Triangle.barycoordFromPoint(t,e,i,r,Je.Triangle.__v3);return a.x>=0&&a.y>=0&&a.x+a.y<=1},Je.Triangle.prototype={constructor:Je.Triangle,set:function(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this},setFromPointsAndIndices:function(t,e,i,r){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[r]),this},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},area:function(){return Je.Triangle.__v0.subVectors(this.c,this.b),Je.Triangle.__v1.subVectors(this.a,this.b),.5*Je.Triangle.__v0.cross(Je.Triangle.__v1).length()},midpoint:function(t){var e=t||new Ke;return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(t){return Je.Triangle.normal(this.a,this.b,this.c,t)},plane:function(t){var e=t||new Je.math.Plane;return e.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(t,e){return Je.Triangle.barycoordFromPoint(t,this.a,this.b,this.c,e)},containsPoint:function(t){return Je.Triangle.containsPoint(t,this.a,this.b,this.c)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)},clone:function(){return(new Je.Triangle).copy(this)},intersectLine:function(t,e){var i=this.plane(),r=i.intersectLine(t,e);return null!=r&&this.containsPoint(r)}},Je.Triangle.__v0=new Ke,Je.Triangle.__v1=new Ke,Je.Triangle.__v2=new Ke,Je.Triangle.__v3=new Ke;var ei={getLogicalPoint:function(t,e){var i,r=t.getBoundingClientRect();if(ii.isTouchable&&e.changedTouches&&e.changedTouches.length>0){var a=e.changedTouches[0],n=ii.isAndroid?0:$touch.scrollLeft(),s=ii.isAndroid?0:$touch.scrollTop();i={x:a.clientX+t.scrollLeft-r.left-n,y:a.clientY+t.scrollTop-r.top-s}}else{if(!ei.isValidEvent(t,e))return null;i={x:e.clientX-r.left+t.scrollLeft,y:e.clientY-r.top+t.scrollTop}}return i},isValidEvent:function(t,e){if(!e)return!1;if(e.target===t)if(ii.isFirefox){if(t.clientHeight<t.scrollHeight&&e.layerX<25)return!1;if(t.clientWidth<t.scrollWidth&&e.layerY<25)return!1}else if(e.offsetX>t.clientWidth||e.offsetY>t.clientHeight)return!1;return!0},isImage:function(t){return t&&t.nodeName&&"img"===t.nodeName.toLowerCase()},isCanvas:function(t){return t&&t.nodeName&&"canvas"===t.nodeName.toLowerCase()},createView:function(t,e){var i=document.createElement("div");return i.style.position=vi.VIEW_POSITION,i.style.fontSize=vi.VIEW_FONT_SIZE,i.style.fontFamily=vi.VIEW_FONT_FAMILY,i.style.cursor="default",i.style.outline="none",i.style.textAlign="left",i.style.msTouchAction="none",i.tabIndex=0,e||(i.onmousedown=ei.preventDefault),i.style.setProperty&&(i.style.setProperty("-khtml-user-select","none",null),i.style.setProperty("-webkit-user-select","none",null),i.style.setProperty("-moz-user-select","none",null),i.style.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null)),t&&(i.style.overflow=t),i},preventDefault:function(t){vi.KEEP_DEFAULT_FUNCTION(t)||(t.preventDefault?t.preventDefault():t.preventManipulation?t.preventManipulation():t.returnValue=!1)},createCanvas:function(t){var e=document.createElement("canvas"),i=t.getView();return e.width=i.width,e.height=i.height,e.style.msTouchAction="none",e.style.position="absolute",e},isCtrlDown:function(t){return t.ctrlKey||t.metaKey},getScrollTop:function(t){if(!t)return 0;var e=t.scrollTop,i=t.parentElement;return e+this.getScrollTop(i)},getScrollLeft:function(t){if(!t)return 0;var e=t.scrollLeft,i=t.parentElement;return e+this.getScrollLeft(i)},debug:function(t,e){try{t.call(e)}catch(i){alert(i)}},setFocus:function(t){if(document.activeElement!==t){var e,i,r,a=document.documentElement;document.body;a&&(ii.isIE||ii.isOpera||a.scrollLeft||a.scrollTop)&&(e=a.scrollLeft,i=a.scrollTop,r=a),t.focus(),r&&(r.scrollLeft=e,r.scrollTop=i)}},isRightClick:function(e){var i;if(!e)var e=t.event;return e.which?i=3==e.which:e.button&&(i=2==e.button),i}};Je.html=ei;var ii=function(){var t={},e=navigator.userAgent.toLowerCase();return t.isOpera=/opera/.test(e),t.isIE=/msie/.test(e)||/trident/.test(e),t.isFirefox=/firefox/i.test(e),t.isChrome=/chrome/i.test(e),t.isSafari=!t.isChrome&&/safari/i.test(e),t.isIPhone=/iphone/.test(e),t.isIPod=/ipod/.test(e),t.isIPad=/ipad/.test(e),t.isAndroid=/android/i.test(e),t.isWebOS=/webos/i.test(e),t.isMSToucheable=navigator.msMaxTouchPoints&&navigator.msMaxTouchPoints>1,t.isTouchable="ontouchend"in document||t.isMSToucheable,t.isIOS=t.isIPhone||t.isIPod||t.isIPad,t}();Je.ua=ii,function(){function e(t){var e,i,a,n,s,o;for(a=t.length,i=0,e="";i<a;){if(n=255&t.charCodeAt(i++),i==a){e+=r.charAt(n>>2),e+=r.charAt((3&n)<<4),e+="==";break}if(s=t.charCodeAt(i++),i==a){e+=r.charAt(n>>2),e+=r.charAt((3&n)<<4|(240&s)>>4),e+=r.charAt((15&s)<<2),e+="=";break}o=t.charCodeAt(i++),e+=r.charAt(n>>2),e+=r.charAt((3&n)<<4|(240&s)>>4),e+=r.charAt((15&s)<<2|(192&o)>>6),e+=r.charAt(63&o)}return e}function i(t){var e,i,r,n,s,o,l;for(o=t.length,s=0,l="";s<o;){do e=a[255&t.charCodeAt(s++)];while(s<o&&e==-1);if(e==-1)break;do i=a[255&t.charCodeAt(s++)];while(s<o&&i==-1);if(i==-1)break;l+=String.fromCharCode(e<<2|(48&i)>>4);do{if(r=255&t.charCodeAt(s++),61==r)return l;r=a[r]}while(s<o&&r==-1);if(r==-1)break;l+=String.fromCharCode((15&i)<<4|(60&r)>>2);do{if(n=255&t.charCodeAt(s++),61==n)return l;n=a[n]}while(s<o&&n==-1);if(n==-1)break;l+=String.fromCharCode((3&r)<<6|n)}return l}var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=new Array((-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),62,(-1),(-1),(-1),63,52,53,54,55,56,57,58,59,60,61,(-1),(-1),(-1),(-1),(-1),(-1),(-1),0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,(-1),(-1),(-1),(-1),(-1),(-1),26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,(-1),(-1),(-1),(-1),(-1));t.btoa||(t.btoa=e),t.atob||(t.atob=i)}();var ri=function(){var e=!1,i=document.createElement("canvas");if(i.getContext("2d")&&(e=!0),!e)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};var r=!!i.getContext("2d").getImageData,a=!!i.toDataURL,n=!!t.btoa,s=function(t){var e=parseInt(t.width),i=parseInt(t.height);return t.getContext("2d").getImageData(0,0,e,i)},o=function(t){var e="";if("string"==typeof t)e=t;else for(var i=t,r=0;r<i.length;r++)e+=String.fromCharCode(i[r]);return btoa(e)},l=function(t){var e=[],i=t.width,r=t.height;e.push(66),e.push(77);var a=i*r*3+54;e.push(a%256),a=Math.floor(a/256),e.push(a%256),a=Math.floor(a/256),e.push(a%256),a=Math.floor(a/256),e.push(a%256),e.push(0),e.push(0),e.push(0),e.push(0),e.push(54),e.push(0),e.push(0),e.push(0);var n=[];n.push(40),n.push(0),n.push(0),n.push(0);var s=i;n.push(s%256),s=Math.floor(s/256),n.push(s%256),s=Math.floor(s/256),n.push(s%256),s=Math.floor(s/256),n.push(s%256);var l=r;n.push(l%256),l=Math.floor(l/256),n.push(l%256),l=Math.floor(l/256),n.push(l%256),l=Math.floor(l/256),n.push(l%256),n.push(1),n.push(0),n.push(24),n.push(0),n.push(0),n.push(0),n.push(0),n.push(0);var h=i*r*3;n.push(h%256),h=Math.floor(h/256),n.push(h%256),h=Math.floor(h/256),n.push(h%256),h=Math.floor(h/256),n.push(h%256);for(var c=0;c<16;c++)n.push(0);var u=(4-3*i%4)%4,f=t.data,d="",p=r;do{for(var m=i*(p-1)*4,g="",y=0;y<i;y++){var v=4*y;g+=String.fromCharCode(f[m+v+2]),g+=String.fromCharCode(f[m+v+1]),g+=String.fromCharCode(f[m+v])}for(var x=0;x<u;x++)g+=String.fromCharCode(0);d+=g}while(--p);var w=o(e.concat(n))+o(d);return w},h=function(t,e){return"data:"+e+";base64,"+t},c=function(t){var e=document.createElement("img");return e.src=t,e},u=function(t,e,i,r,a){i=i||(e?e.w:t.width),r=r||(e?e.h:t.height);var n=document.createElement("canvas");n.width=i,n.height=r,n.style.width=i+"px",n.style.height=r+"px";var s=n.getContext("2d"),s=n.getContext("2d"),o=t.style.backgroundColor;return o||(o="PNG"===a?"rgba(255,255,255,0.0)":"BMP"===a?"rgba(255,255,255,0.01)":"#FFFFFF"),s.fillStyle=o,s.fillRect(0,0,i,r),e=e?e:{x:0,y:0,w:t.width,h:t.height},s.drawImage(t,e.x,e.y,e.w,e.h,0,0,i,r),n};return{saveAsPNG:function(t,e,i,r,n){if(!a)return!1;var s=u(t,e,r,n,"PNG"),o=s.toDataURL("image/png");return i?c(o):o},saveAsJPEG:function(t,e,i,r,n){if(!a)return!1;var s=u(t,e,r,n,"JPEG"),o="image/jpeg",l=s.toDataURL(o);return 5==l.indexOf(o)&&(i?c(l):l)},saveAsBMP:function(t,e,i,a,o){if(!r||!n)return!1;var f=u(t,e,a,o,"BMP"),d=s(f),p=l(d);return i?c(h(p,"image/bmp")):h(p,"image/bmp")}}}(),ai={},ni={cache:{},g:document.createElement("canvas").getContext("2d"),getTextSize:function(t,e){ni.g.font=t?t:vi.FONT;var i=ni.cache[ni.g.font];return i||(i=2*ni.g.measureText("e").width+4,ni.cache[ni.g.font]=i),{width:ni.g.measureText(e).width+4,height:i}}};ai.g=ni,Je.g=ni;var si={};setTimeout;si.bcld=function(t,e,i,r,a,n,s,o,l){var h,c,u=t/2,f=[],d=[],p={vertices:[],faces:[],uvs:[],uv2s:[]};for(c=0;c<=e;c++){var m=[],g=[],y=c/e,v=y*(i-r)+r;for(h=0;h<=a;h++){var x=h/a,w=new Ke;w.x=v*Math.sin(x*o+l),w.y=-y*t+u,w.z=v*Math.cos(x*o+l),p.vertices.push(w),m.push(p.vertices.length-1),g.push(new Qe(x,1-y))}f.push(m),d.push(g)}var _,b,M=(i-r)/t;for(h=0;h<a;h++)for(0!==r?(_=p.vertices[f[0][h]].clone(),b=p.vertices[f[0][h+1]].clone()):(_=p.vertices[f[1][h]].clone(),b=p.vertices[f[1][h+1]].clone()),_.setY(Math.sqrt(_.x*_.x+_.z*_.z)*M).normalize(),b.setY(Math.sqrt(b.x*b.x+b.z*b.z)*M).normalize(),c=0;c<e;c++){var S=f[c][h],A=f[c+1][h],P=f[c+1][h+1],T=f[c][h+1],C=_.clone(),z=_.clone(),L=b.clone(),E=b.clone(),D=d[c][h].clone(),N=d[c+1][h].clone(),B=d[c+1][h+1].clone(),R=d[c][h+1].clone();p.faces.push(new mi(S,A,T,[C,z,E],null,0)),p.uvs.push([D,N,R]),p.uv2s.push([D.clone(),N.clone(),R.clone()]),p.faces.push(new mi(A,P,T,[z,L,E],null,0)),p.uvs.push([N,B,R]),p.uv2s.push([N.clone(),B.clone(),R.clone()])}var F=!1;if(n===!1&&r>0)for(p.vertices.push(new Ke(0,u,0)),F=!0,h=0;h<a;h++){var S=f[0][h],A=f[0][h+1],P=p.vertices.length-1,C=new Ke(0,1,0),z=new Ke(0,1,0),L=new Ke(0,1,0),I=p.vertices[S],k=p.vertices[A],D=new Qe((I.x/r+1)/2,1-(I.z/r+1)/2),N=new Qe((k.x/r+1)/2,1-(k.z/r+1)/2),B=new Qe(.5,.5);p.faces.push(new mi(S,A,P,[C,z,L],null,1)),p.uvs.push([D,N,B]),p.uv2s.push([D.clone(),N.clone(),B.clone()])}var V=!1;if(s===!1&&i>0)for(p.vertices.push(new Ke(0,(-u),0)),V=!0,h=0;h<a;h++){var S=f[c][h+1],A=f[c][h],P=p.vertices.length-1,C=new Ke(0,(-1),0),z=new Ke(0,(-1),0),L=new Ke(0,(-1),0),I=p.vertices[S],k=p.vertices[A],D=new Qe((I.x/i+1)/2,(I.z/i+1)/2),N=new Qe((k.x/i+1)/2,(k.z/i+1)/2),B=new Qe(.5,.5);p.faces.push(new mi(S,A,P,[C,z,L],null,2)),p.uvs.push([D,N,B]),p.uv2s.push([D.clone(),N.clone(),B.clone()])}if(o!==2*Math.PI){!F&&p.vertices.push(new Ke(0,u,0)),!V&&p.vertices.push(new Ke(0,(-u),0));var S=f[0][0],A=f[e][0],P=p.vertices.length-1,T=p.vertices.length-2,D=new Qe(0,0),N=new Qe(0,1),B=new Qe(1,1),R=new Qe(1,0);p.faces.push(new mi(S,P,A)),p.uvs.push([D,B,N]),p.uv2s.push([D.clone(),B.clone(),N.clone()]),p.faces.push(new mi(T,P,S)),p.uvs.push([R,B,D]),p.uv2s.push([R.clone(),B.clone(),D.clone()]),S=f[0][a],A=f[e][a];var D=new Qe(0,0),N=new Qe(0,1),B=new Qe(1,1),R=new Qe(1,0);p.faces.push(new mi(S,A,T)),p.uvs.push([D,N,R]),p.uv2s.push([D.clone(),N.clone(),R.clone()]),p.faces.push(new mi(A,P,T)),p.uvs.push([N,B,R]),p.uv2s.push([N.clone(),B.clone(),R.clone()])}return p},si.buildCubeData=function(t,e,i,r,a,n,s,o){function l(l){var p,m,g,y,v,x,w,_,b,M;h=c.length;var S,A="six-each"==s||"front-other"==s||"back-other"==s||"left-other"==s||"right-other"==s||"top-other"==s||"bottom-other"==s,P=new Qe(0,0),T=A?new Qe(1/3,.5):new Qe(1,1),C=s.split("-")[0];"six"==C?C=null:T=new Qe(.5,1),"right"==l?(p="z",m="y",g="x",y=-1,v=-1,x=t/2,w=i,_=e,b=n,M=a,S=0,P=new Qe(2/3,0)):"left"==l?(p="z",m="y",g="x",y=1,v=-1,x=-t/2,w=i,_=e,b=n,M=a,S=1):"top"==l?(p="x",m="z",g="y",y=1,v=1,x=e/2,w=t,_=i,b=r,M=n,S=2,P=new Qe(1/3,.5)):"bottom"==l?(p="x",m="z",g="y",y=1,v=-1,x=-e/2,w=t,_=i,b=r,M=n,S=3,P=new Qe(0,.5)):"front"==l?(p="x",m="y",g="z",y=1,v=-1,x=i/2,w=t,_=e,b=r,M=a,S=4,P=new Qe(1/3,0)):"back"==l&&(p="x",m="y",g="z",y=-1,v=-1,x=-i/2,w=t,_=e,b=r,M=a,S=5,P=new Qe(2/3,.5)),C&&(P=C==l?new Qe(0,0):new Qe(.5,0));var z,L,E=b+1,D=M+1;for(L=0;L<D;L++)for(z=0;z<E;z++){var N=new Ke;N[p]=(z/b*w-w/2)*y+o[p],N[m]=(L/M*_-_/2)*v+o[m],N[g]=x+o[g],c.push(N)}A&&(S=0);var B=new Ke;for(B[g]=x>0?1:-1,L=0;L<M;L++)for(z=0;z<b;z++){var R=z+E*L,F=z+E*(L+1),I=z+1+E*(L+1),k=z+1+E*L,V=[new Qe(z/b,1-L/M),new Qe(z/b,1-(L+1)/M),new Qe((z+1)/b,1-(L+1)/M),new Qe((z+1)/b,1-L/M)];if(A)for(var O=0;O<V.length;O++)V[O].multiply(T).add(P);var U=new gi(R+h,F+h,I+h,k+h);U.normal.copy(B),U.vertexNormals.push(B.clone(),B.clone(),B.clone(),B.clone()),U.materialIndex=S,u.push(U),f.push([V[0],V[1],V[2],V[3]]),d.push([V[0].clone(),V[1].clone(),V[2].clone(),V[3].clone()])}}var h,c=[],u=[],f=[],d=[];l("right"),l("left"),l("top"),l("bottom"),l("front"),l("back");var p={vertices:c,faces:u,uvs:f,uv2s:d};return p},si.bsd=function(t,e,i,r,a,n,s){var o,l,h=[],c=[],u=[],f=[],d=[],p=[];for(l=0;l<=i;l++){var m=[],g=[];for(o=0;o<=e;o++){var y=o/e,v=l/i,x=new Ke;x.x=-t*Math.cos(r+y*a)*Math.sin(n+v*s),x.y=t*Math.cos(n+v*s),x.z=t*Math.sin(r+y*a)*Math.sin(n+v*s),h.push(x),m.push(h.length-1),g.push(new Qe(y,1-v))}d.push(m),p.push(g)}for(l=0;l<i;l++)for(o=0;o<e;o++){var w=d[l][o+1],_=d[l][o],b=d[l+1][o],M=d[l+1][o+1],S=h[w].clone().normalize(),A=h[_].clone().normalize(),P=h[b].clone().normalize(),T=h[M].clone().normalize(),C=p[l][o+1].clone(),z=p[l][o].clone(),L=p[l+1][o].clone(),E=p[l+1][o+1].clone();Math.abs(h[w].y)===t?(u.push(new mi(w,b,M,[S,P,T])),c.push([C,L,E]),f.push([C.clone(),L.clone(),E.clone()])):Math.abs(h[b].y)===t?(u.push(new mi(w,_,b,[S,A,P])),c.push([C,z,L]),f.push([C.clone(),z.clone(),L.clone()])):(u.push(new mi(w,_,M,[S,A,T])),c.push([C,z,E]),f.push([C.clone(),z.clone(),E.clone()]),u.push(new mi(_,b,M,[A.clone(),P,T.clone()])),c.push([z.clone(),L,E.clone()]),f.push([z.clone(),L.clone(),E.clone()]))}return{vertices:h,faces:u,uvs:c,uv2s:f}};var oi=function(t){var i,r,a,n,s,o,l,h={},c=t.primitive;if(c.groups)return t.groups=c.groups,void(t.groupList=c.groupList);c.groups={};var u=t.material,f=t.getMaterialMapping();for(i=0,r=c.faces.length;i<r;i++)a=c.faces[i],n=u instanceof Je.ArrayMaterial?a.materialIndex:0,n=f[n],o=n!==e?n:-1,h[o]===e&&(h[o]={hash:o,counter:0}),l=h[o].hash+"_"+h[o].counter,c.groups[l]===e&&(c.groups[l]={faces3:[],faces4:[],materialIndex:n,vertices:0}),s=a instanceof mi?3:4,c.groups[l].vertices+s>65535&&(h[o].counter+=1,l=h[o].hash+"_"+h[o].counter,c.groups[l]===e&&(c.groups[l]={faces3:[],faces4:[],materialIndex:n,vertices:0})),a instanceof mi?c.groups[l].faces3.push(i):c.groups[l].faces4.push(i),c.groups[l].vertices+=s;c.groupsList=[];for(var d in t.groups)c.groupsList.push(t.groups[d]);t.groups=c.groups,t.groupList=c.groupsList},li=function(t,i,r,a){var n,s,o,l,h,c,u,f,d,p,m,g,y,v,x=t,w=x,_=w.vertices,b=_.length,M=w.colors,S=M.length,A=w.sizes,P=A.length,T=a.__vertexArray,C=a.__colorArray,z=a.__normalArray,L=a.__sortArray,E=w.verticesNeedUpdate,D=(w.elementsNeedUpdate,w.normalsNeedUpdate),N=w.colorsNeedUpdate,B=w.__webglCustomAttributesList;if(P<b&&(P=b),x.sortParticles){for(_projScreenMatrixPS.copy(_projScreenMatrix),_projScreenMatrixPS.multiply(x.matrixWorld),n=0;n<b;n++)l=_[n],_vector3.copy(l),_vector3.applyProjection(_projScreenMatrixPS),L[n]=[_vector3.z,n];for(L.sort(numericalSort),n=0;n<b;n++)l=_[L[n][1]],h=3*n,T[h]=l.x,T[h+1]=l.y,T[h+2]=l.z;for(s=0;s<S;s++)h=3*s,u=M[L[s][1]],C[h]=u.r,C[h+1]=u.g,C[h+2]=u.b;for(o=0;o<P;o++)h=3*o,f=A[L[o][1]],f=null==f?1:f,z[h]=null==f.x?f||1:f.x,z[h+1]=0,z[h+2]=0;if(B)for(d=0,p=B.length;d<p;d++)if(v=B[d],v.boundTo===e||"vertices"===v.boundTo)if(h=0,g=v.value.length,1===v.size)for(m=0;m<g;m++)c=L[m][1],v.array[m]=v.value[c];else if(2===v.size)for(m=0;m<g;m++)c=L[m][1],y=v.value[c],v.array[h]=y.x,v.array[h+1]=y.y,h+=2;else if(3===v.size)if("c"===v.type)for(m=0;m<g;m++)c=L[m][1],y=v.value[c],v.array[h]=y.r,v.array[h+1]=y.g,v.array[h+2]=y.b,h+=3;else for(m=0;m<g;m++)c=L[m][1],y=v.value[c],v.array[h]=y.x,v.array[h+1]=y.y,v.array[h+2]=y.z,h+=3;else if(4===v.size)for(m=0;m<g;m++)c=L[m][1],y=v.value[c],v.array[h]=y.x,v.array[h+1]=y.y,v.array[h+2]=y.z,v.array[h+3]=y.w,h+=4}else{if(E)for(n=0;n<b;n++)l=_[n],h=3*n,T[h]=l.x,T[h+1]=l.y,T[h+2]=l.z;if(N)for(s=0;s<S;s++)u=M[s],h=3*s,C[h]=u.r,C[h+1]=u.g,C[h+2]=u.b;if(D)for(o=0;o<P;o++)f=null==A[o]?1:A[o],h=3*o,z[h]=null==f.x?f||1:f.x,z[h+1]=0,z[h+2]=0;if(B)for(d=0,p=B.length;d<p;d++)if(v=B[d],v.needsUpdate&&(v.boundTo===e||"vertices"===v.boundTo))if(g=v.value.length,h=0,1===v.size)for(m=0;m<g;m++)v.array[m]=v.value[m];else if(2===v.size)for(m=0;m<g;m++)y=v.value[m],v.array[h]=y.x,v.array[h+1]=y.y,h+=2;else if(3===v.size)if("c"===v.type)for(m=0;m<g;m++)y=v.value[m],v.array[h]=y.r,v.array[h+1]=y.g,v.array[h+2]=y.b,h+=3;else for(m=0;m<g;m++)y=v.value[m],v.array[h]=y.x,v.array[h+1]=y.y,v.array[h+2]=y.z,h+=3;else if(4===v.size)for(m=0;m<g;m++)y=v.value[m],v.array[h]=y.x,v.array[h+1]=y.y,v.array[h+2]=y.z,v.array[h+3]=y.w,h+=4}if((E||x.sortParticles)&&(r.bindBuffer(r.ARRAY_BUFFER,a.__webglVertexBuffer),r.bufferData(r.ARRAY_BUFFER,T,i)),(N||x.sortParticles)&&(r.bindBuffer(r.ARRAY_BUFFER,a.__webglColorBuffer),r.bufferData(r.ARRAY_BUFFER,C,i)),(D||x.sortParticles)&&(r.bindBuffer(r.ARRAY_BUFFER,a.__webglNormalBuffer),r.bufferData(r.ARRAY_BUFFER,z,i)),B)for(d=0,p=B.length;d<p;d++)v=B[d],(v.needsUpdate||x.sortParticles)&&(r.bindBuffer(r.ARRAY_BUFFER,v.buffer),r.bufferData(r.ARRAY_BUFFER,v.array,i))};si.buildGroupBufferData=function(t,i,r,a,n,s,o,l){var h="basic"!=n._type,c=n.isVertexColor(),u=n.needUV();h=!0;var f,d,p,m,g,y,v,x,w,_,b,M,S,A,P,T,C,z,L,E,D,N,B,R,F,I=l.needSmoothNormal(i,n),k=0,V=0,O=0,U=0,G=0,H=0,j=0,X=0,W=0,Y=0,q=o.__vertexArray,Z=o.__uvArray,J=o.__uv2Array,Q=o.__normalArray,K=o.__colorArray,$=o.__webglCustomAttributesList,tt=o.__faceArray,et=o.__lineArray,it=i,rt=it.verticesNeedUpdate,at=it.elementsNeedUpdate,nt=it.uvsNeedUpdate,st=it.normalsNeedUpdate,ot=(it.tangentsNeedUpdate,
it.colorsNeedUpdate),lt=(it.morphTargetsNeedUpdate,it.vertices),ht=t.faces3,ct=t.faces4,ut=it.faces,ft=it.uvs,dt=it.uv2s;it.colors,it.skinIndices,it.skinWeights,it.morphTargets,it.morphNormals;if(rt){for(f=0,d=ht.length;f<d;f++)m=ut[ht[f]],b=lt[m.a],M=lt[m.b],S=lt[m.c],q[V]=b.x,q[V+1]=b.y,q[V+2]=b.z,q[V+3]=M.x,q[V+4]=M.y,q[V+5]=M.z,q[V+6]=S.x,q[V+7]=S.y,q[V+8]=S.z,V+=9;for(f=0,d=ct.length;f<d;f++)m=ut[ct[f]],b=lt[m.a],M=lt[m.b],S=lt[m.c],A=lt[m.d],q[V]=b.x,q[V+1]=b.y,q[V+2]=b.z,q[V+3]=M.x,q[V+4]=M.y,q[V+5]=M.z,q[V+6]=S.x,q[V+7]=S.y,q[V+8]=S.z,q[V+9]=A.x,q[V+10]=A.y,q[V+11]=A.z,V+=12;s.bindBuffer(s.ARRAY_BUFFER,o.__webglVertexBuffer),s.bufferData(s.ARRAY_BUFFER,q,r),o.__vertexArray=q}if(ot&&c){for(f=0,d=ht.length;f<d;f++)m=ut[ht[f]],v=m.vertexColors,x=m.color,3===v.length&&c===Je.VertexColors?(P=v[0],T=v[1],C=v[2]):(P=x,T=x,C=x),K[X]=P.r,K[X+1]=P.g,K[X+2]=P.b,K[X+3]=T.r,K[X+4]=T.g,K[X+5]=T.b,K[X+6]=C.r,K[X+7]=C.g,K[X+8]=C.b,X+=9;for(f=0,d=ct.length;f<d;f++)m=ut[ct[f]],v=m.vertexColors,x=m.color,4===v.length&&c===Je.VertexColors?(P=v[0],T=v[1],C=v[2],z=v[3]):(P=x,T=x,C=x,z=x),K[X]=P.r,K[X+1]=P.g,K[X+2]=P.b,K[X+3]=T.r,K[X+4]=T.g,K[X+5]=T.b,K[X+6]=C.r,K[X+7]=C.g,K[X+8]=C.b,K[X+9]=z.r,K[X+10]=z.g,K[X+11]=z.b,X+=12;X>0&&(s.bindBuffer(s.ARRAY_BUFFER,o.__webglColorBuffer),s.bufferData(s.ARRAY_BUFFER,K,r))}if(st&&h){for(f=0,d=ht.length;f<d;f++)if(m=ut[ht[f]],g=m.vertexNormals,y=m.normal,3===g.length&&I)for(L=0;L<3;L++)D=g[L],Q[H]=D.x,Q[H+1]=D.y,Q[H+2]=D.z,H+=3;else for(L=0;L<3;L++)Q[H]=y.x,Q[H+1]=y.y,Q[H+2]=y.z,H+=3;for(f=0,d=ct.length;f<d;f++)if(m=ut[ct[f]],g=m.vertexNormals,y=m.normal,4===g.length&&I)for(L=0;L<4;L++)D=g[L],null==Q&&console.log("normal array is null"),Q[H]=D.x,Q[H+1]=D.y,Q[H+2]=D.z,H+=3;else for(L=0;L<4;L++)Q[H]=y.x,Q[H+1]=y.y,Q[H+2]=y.z,H+=3;s.bindBuffer(s.ARRAY_BUFFER,o.__webglNormalBuffer),s.bufferData(s.ARRAY_BUFFER,Q,r),o.__normalArray=Q}if(nt&&ft&&u){for(f=0,d=ht.length;f<d;f++)if(p=ht[f],w=ft[p],w!==e)for(L=0;L<3;L++)N=w[L],Z[O]=N.x,Z[O+1]=N.y,O+=2;for(f=0,d=ct.length;f<d;f++)if(p=ct[f],w=ft[p],w!==e)for(L=0;L<4;L++)N=w[L],Z[O]=N.x,Z[O+1]=N.y,O+=2;O>0&&(s.bindBuffer(s.ARRAY_BUFFER,o.__webglUVBuffer),s.bufferData(s.ARRAY_BUFFER,Z,r),o.uvArray=Z)}if(nt&&dt&&u){for(f=0,d=ht.length;f<d;f++)if(p=ht[f],_=dt[p],_!==e)for(L=0;L<3;L++)B=_[L],J[U]=B.x,J[U+1]=B.y,U+=2;for(f=0,d=ct.length;f<d;f++)if(p=ct[f],_=dt[p],_!==e)for(L=0;L<4;L++)B=_[L],J[U]=B.x,J[U+1]=B.y,U+=2;U>0&&(s.bindBuffer(s.ARRAY_BUFFER,o.__webglUV2Buffer),s.bufferData(s.ARRAY_BUFFER,J,r))}if(at){for(f=0,d=ht.length;f<d;f++)tt[G]=k,tt[G+1]=k+1,tt[G+2]=k+2,G+=3,et[j]=k,et[j+1]=k+1,et[j+2]=k,et[j+3]=k+2,et[j+4]=k+1,et[j+5]=k+2,j+=6,k+=3;for(f=0,d=ct.length;f<d;f++)tt[G]=k,tt[G+1]=k+1,tt[G+2]=k+3,tt[G+3]=k+1,tt[G+4]=k+2,tt[G+5]=k+3,G+=6,et[j]=k,et[j+1]=k+1,et[j+2]=k,et[j+3]=k+3,et[j+4]=k+1,et[j+5]=k+2,et[j+6]=k+2,et[j+7]=k+3,j+=8,k+=4;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,tt,r),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,et,r),o.__lineArray=et}if($)for(L=0,E=$.length;L<E;L++)if(F=$[L],F.__original.needsUpdate){if(W=0,Y=0,1===F.size){if(F.boundTo===e||"vertices"===F.boundTo){for(f=0,d=ht.length;f<d;f++)m=ut[ht[f]],F.array[W]=F.value[m.a],F.array[W+1]=F.value[m.b],F.array[W+2]=F.value[m.c],W+=3;for(f=0,d=ct.length;f<d;f++)m=ut[ct[f]],F.array[W]=F.value[m.a],F.array[W+1]=F.value[m.b],F.array[W+2]=F.value[m.c],F.array[W+3]=F.value[m.d],W+=4}else if("faces"===F.boundTo){for(f=0,d=ht.length;f<d;f++)R=F.value[ht[f]],F.array[W]=R,F.array[W+1]=R,F.array[W+2]=R,W+=3;for(f=0,d=ct.length;f<d;f++)R=F.value[ct[f]],F.array[W]=R,F.array[W+1]=R,F.array[W+2]=R,F.array[W+3]=R,W+=4}}else if(2===F.size){if(F.boundTo===e||"vertices"===F.boundTo){for(f=0,d=ht.length;f<d;f++)m=ut[ht[f]],b=F.value[m.a],M=F.value[m.b],S=F.value[m.c],F.array[W]=b.x,F.array[W+1]=b.y,F.array[W+2]=M.x,F.array[W+3]=M.y,F.array[W+4]=S.x,F.array[W+5]=S.y,W+=6;for(f=0,d=ct.length;f<d;f++)m=ut[ct[f]],b=F.value[m.a],M=F.value[m.b],S=F.value[m.c],A=F.value[m.d],F.array[W]=b.x,F.array[W+1]=b.y,F.array[W+2]=M.x,F.array[W+3]=M.y,F.array[W+4]=S.x,F.array[W+5]=S.y,F.array[W+6]=A.x,F.array[W+7]=A.y,W+=8}else if("faces"===F.boundTo){for(f=0,d=ht.length;f<d;f++)R=F.value[ht[f]],b=R,M=R,S=R,F.array[W]=b.x,F.array[W+1]=b.y,F.array[W+2]=M.x,F.array[W+3]=M.y,F.array[W+4]=S.x,F.array[W+5]=S.y,W+=6;for(f=0,d=ct.length;f<d;f++)R=F.value[ct[f]],b=R,M=R,S=R,A=R,F.array[W]=b.x,F.array[W+1]=b.y,F.array[W+2]=M.x,F.array[W+3]=M.y,F.array[W+4]=S.x,F.array[W+5]=S.y,F.array[W+6]=A.x,F.array[W+7]=A.y,W+=8}}else if(3===F.size){var pt;if(pt="c"===F.type?["r","g","b"]:["x","y","z"],F.boundTo===e||"vertices"===F.boundTo){for(f=0,d=ht.length;f<d;f++)m=ut[ht[f]],b=F.value[m.a],M=F.value[m.b],S=F.value[m.c],F.array[W]=b[pt[0]],F.array[W+1]=b[pt[1]],F.array[W+2]=b[pt[2]],F.array[W+3]=M[pt[0]],F.array[W+4]=M[pt[1]],F.array[W+5]=M[pt[2]],F.array[W+6]=S[pt[0]],F.array[W+7]=S[pt[1]],F.array[W+8]=S[pt[2]],W+=9;for(f=0,d=ct.length;f<d;f++)m=ut[ct[f]],b=F.value[m.a],M=F.value[m.b],S=F.value[m.c],A=F.value[m.d],F.array[W]=b[pt[0]],F.array[W+1]=b[pt[1]],F.array[W+2]=b[pt[2]],F.array[W+3]=M[pt[0]],F.array[W+4]=M[pt[1]],F.array[W+5]=M[pt[2]],F.array[W+6]=S[pt[0]],F.array[W+7]=S[pt[1]],F.array[W+8]=S[pt[2]],F.array[W+9]=A[pt[0]],F.array[W+10]=A[pt[1]],F.array[W+11]=A[pt[2]],W+=12}else if("faces"===F.boundTo){for(f=0,d=ht.length;f<d;f++)R=F.value[ht[f]],b=R,M=R,S=R,F.array[W]=b[pt[0]],F.array[W+1]=b[pt[1]],F.array[W+2]=b[pt[2]],F.array[W+3]=M[pt[0]],F.array[W+4]=M[pt[1]],F.array[W+5]=M[pt[2]],F.array[W+6]=S[pt[0]],F.array[W+7]=S[pt[1]],F.array[W+8]=S[pt[2]],W+=9;for(f=0,d=ct.length;f<d;f++)R=F.value[ct[f]],b=R,M=R,S=R,A=R,F.array[W]=b[pt[0]],F.array[W+1]=b[pt[1]],F.array[W+2]=b[pt[2]],F.array[W+3]=M[pt[0]],F.array[W+4]=M[pt[1]],F.array[W+5]=M[pt[2]],F.array[W+6]=S[pt[0]],F.array[W+7]=S[pt[1]],F.array[W+8]=S[pt[2]],F.array[W+9]=A[pt[0]],F.array[W+10]=A[pt[1]],F.array[W+11]=A[pt[2]],W+=12}else if("faceVertices"===F.boundTo){for(f=0,d=ht.length;f<d;f++)R=F.value[ht[f]],b=R[0],M=R[1],S=R[2],F.array[W]=b[pt[0]],F.array[W+1]=b[pt[1]],F.array[W+2]=b[pt[2]],F.array[W+3]=M[pt[0]],F.array[W+4]=M[pt[1]],F.array[W+5]=M[pt[2]],F.array[W+6]=S[pt[0]],F.array[W+7]=S[pt[1]],F.array[W+8]=S[pt[2]],W+=9;for(f=0,d=ct.length;f<d;f++)R=F.value[ct[f]],b=R[0],M=R[1],S=R[2],A=R[3],F.array[W]=b[pt[0]],F.array[W+1]=b[pt[1]],F.array[W+2]=b[pt[2]],F.array[W+3]=M[pt[0]],F.array[W+4]=M[pt[1]],F.array[W+5]=M[pt[2]],F.array[W+6]=S[pt[0]],F.array[W+7]=S[pt[1]],F.array[W+8]=S[pt[2]],F.array[W+9]=A[pt[0]],F.array[W+10]=A[pt[1]],F.array[W+11]=A[pt[2]],W+=12}}else if(4===F.size)if(F.boundTo===e||"vertices"===F.boundTo){for(f=0,d=ht.length;f<d;f++)m=ut[ht[f]],b=F.value[m.a],M=F.value[m.b],S=F.value[m.c],F.array[W]=b.x,F.array[W+1]=b.y,F.array[W+2]=b.z,F.array[W+3]=b.w,F.array[W+4]=M.x,F.array[W+5]=M.y,F.array[W+6]=M.z,F.array[W+7]=M.w,F.array[W+8]=S.x,F.array[W+9]=S.y,F.array[W+10]=S.z,F.array[W+11]=S.w,W+=12;for(f=0,d=ct.length;f<d;f++)m=ut[ct[f]],b=F.value[m.a],M=F.value[m.b],S=F.value[m.c],A=F.value[m.d],F.array[W]=b.x,F.array[W+1]=b.y,F.array[W+2]=b.z,F.array[W+3]=b.w,F.array[W+4]=M.x,F.array[W+5]=M.y,F.array[W+6]=M.z,F.array[W+7]=M.w,F.array[W+8]=S.x,F.array[W+9]=S.y,F.array[W+10]=S.z,F.array[W+11]=S.w,F.array[W+12]=A.x,F.array[W+13]=A.y,F.array[W+14]=A.z,F.array[W+15]=A.w,W+=16}else if("faces"===F.boundTo){for(f=0,d=ht.length;f<d;f++)R=F.value[ht[f]],b=R,M=R,S=R,F.array[W]=b.x,F.array[W+1]=b.y,F.array[W+2]=b.z,F.array[W+3]=b.w,F.array[W+4]=M.x,F.array[W+5]=M.y,F.array[W+6]=M.z,F.array[W+7]=M.w,F.array[W+8]=S.x,F.array[W+9]=S.y,F.array[W+10]=S.z,F.array[W+11]=S.w,W+=12;for(f=0,d=ct.length;f<d;f++)R=F.value[ct[f]],b=R,M=R,S=R,A=R,F.array[W]=b.x,F.array[W+1]=b.y,F.array[W+2]=b.z,F.array[W+3]=b.w,F.array[W+4]=M.x,F.array[W+5]=M.y,F.array[W+6]=M.z,F.array[W+7]=M.w,F.array[W+8]=S.x,F.array[W+9]=S.y,F.array[W+10]=S.z,F.array[W+11]=S.w,F.array[W+12]=A.x,F.array[W+13]=A.y,F.array[W+14]=A.z,F.array[W+15]=A.w,W+=16}else if("faceVertices"===F.boundTo){for(f=0,d=ht.length;f<d;f++)R=F.value[ht[f]],b=R[0],M=R[1],S=R[2],F.array[W]=b.x,F.array[W+1]=b.y,F.array[W+2]=b.z,F.array[W+3]=b.w,F.array[W+4]=M.x,F.array[W+5]=M.y,F.array[W+6]=M.z,F.array[W+7]=M.w,F.array[W+8]=S.x,F.array[W+9]=S.y,F.array[W+10]=S.z,F.array[W+11]=S.w,W+=12;for(f=0,d=ct.length;f<d;f++)R=F.value[ct[f]],b=R[0],M=R[1],S=R[2],A=R[3],F.array[W]=b.x,F.array[W+1]=b.y,F.array[W+2]=b.z,F.array[W+3]=b.w,F.array[W+4]=M.x,F.array[W+5]=M.y,F.array[W+6]=M.z,F.array[W+7]=M.w,F.array[W+8]=S.x,F.array[W+9]=S.y,F.array[W+10]=S.z,F.array[W+11]=S.w,F.array[W+12]=A.x,F.array[W+13]=A.y,F.array[W+14]=A.z,F.array[W+15]=A.w,W+=16}s.bindBuffer(s.ARRAY_BUFFER,F.buffer),s.bufferData(s.ARRAY_BUFFER,F.array,r)}a&&si.deleteGroupBufferData(t)},si.buildLineBufferData=function(t,i,r,a){var n,s,o,l,h,c,u,f,d,p,m,g,y=t,v=y.vertices,x=y.colors,w=y.lineDistances,_=v.length,b=x.length,M=w.length,S=a.__vertexArray,A=a.__colorArray,P=a.__lineDistanceArray,T=y.verticesNeedUpdate,C=y.colorsNeedUpdate,z=y.lineDistancesNeedUpdate,L=y.__webglCustomAttributesList;if(T){for(n=0;n<_;n++)l=v[n],h=3*n,S[h]=l.x,S[h+1]=l.y,S[h+2]=l.z;r.bindBuffer(r.ARRAY_BUFFER,a.__webglVertexBuffer),r.bufferData(r.ARRAY_BUFFER,S,i)}if(C){for(s=0;s<b;s++)c=x[s],h=3*s,A[h]=c.r,A[h+1]=c.g,A[h+2]=c.b;r.bindBuffer(r.ARRAY_BUFFER,a.__webglColorBuffer),r.bufferData(r.ARRAY_BUFFER,A,i)}if(z){for(o=0;o<M;o++)P[o]=w[o];r.bindBuffer(r.ARRAY_BUFFER,a.__webglLineDistanceBuffer),r.bufferData(r.ARRAY_BUFFER,P,i)}if(L)for(u=0,f=L.length;u<f;u++)if(g=L[u],g.needsUpdate&&(g.boundTo===e||"vertices"===g.boundTo)){if(h=0,p=g.value.length,1===g.size)for(d=0;d<p;d++)g.array[d]=g.value[d];else if(2===g.size)for(d=0;d<p;d++)m=g.value[d],g.array[h]=m.x,g.array[h+1]=m.y,h+=2;else if(3===g.size)if("c"===g.type)for(d=0;d<p;d++)m=g.value[d],g.array[h]=m.r,g.array[h+1]=m.g,g.array[h+2]=m.b,h+=3;else for(d=0;d<p;d++)m=g.value[d],g.array[h]=m.x,g.array[h+1]=m.y,g.array[h+2]=m.z,h+=3;else if(4===g.size)for(d=0;d<p;d++)m=g.value[d],g.array[h]=m.x,g.array[h+1]=m.y,g.array[h+2]=m.z,g.array[h+3]=m.w,h+=4;r.bindBuffer(r.ARRAY_BUFFER,g.buffer),r.bufferData(r.ARRAY_BUFFER,g.array,i)}},si.buildLineBufferData=function(t,i,r,a){var n,s,o,l,h,c,u,f,d,p,m,g,y=t,v=y.vertices,x=y.colors,w=y.lineDistances,_=v.length,b=x.length,M=w.length,S=a.__vertexArray,A=a.__colorArray,P=a.__lineDistanceArray,T=y.verticesNeedUpdate,C=y.colorsNeedUpdate,z=y.lineDistancesNeedUpdate,L=y.__webglCustomAttributesList;if(T){for(n=0;n<_;n++)l=v[n],h=3*n,S[h]=l.x,S[h+1]=l.y,S[h+2]=l.z;r.bindBuffer(r.ARRAY_BUFFER,a.__webglVertexBuffer),r.bufferData(r.ARRAY_BUFFER,S,i)}if(C){for(s=0;s<b;s++)c=x[s],h=3*s,A[h]=c.r,A[h+1]=c.g,A[h+2]=c.b;r.bindBuffer(r.ARRAY_BUFFER,a.__webglColorBuffer),r.bufferData(r.ARRAY_BUFFER,A,i)}if(z){for(o=0;o<M;o++)P[o]=w[o];r.bindBuffer(r.ARRAY_BUFFER,a.__webglLineDistanceBuffer),r.bufferData(r.ARRAY_BUFFER,P,i)}if(L)for(u=0,f=L.length;u<f;u++)if(g=L[u],g.needsUpdate&&(g.boundTo===e||"vertices"===g.boundTo)){if(h=0,p=g.value.length,1===g.size)for(d=0;d<p;d++)g.array[d]=g.value[d];else if(2===g.size)for(d=0;d<p;d++)m=g.value[d],g.array[h]=m.x,g.array[h+1]=m.y,h+=2;else if(3===g.size)if("c"===g.type)for(d=0;d<p;d++)m=g.value[d],g.array[h]=m.r,g.array[h+1]=m.g,g.array[h+2]=m.b,h+=3;else for(d=0;d<p;d++)m=g.value[d],g.array[h]=m.x,g.array[h+1]=m.y,g.array[h+2]=m.z,h+=3;else if(4===g.size)for(d=0;d<p;d++)m=g.value[d],g.array[h]=m.x,g.array[h+1]=m.y,g.array[h+2]=m.z,g.array[h+3]=m.w,h+=4;r.bindBuffer(r.ARRAY_BUFFER,g.buffer),r.bufferData(r.ARRAY_BUFFER,g.array,i)}},si.deleteGroupBufferData=function(t){delete t.__inittedArrays,delete t.__colorArray,delete t.__normalArray,delete t.__tangentArray,delete t.__uvArray,delete t.__uv2Array,delete t.__faceArray,delete t.__vertexArray,delete t.__lineArray,delete t.__skinIndexArray,delete t.__skinWeightArray},si.getMaterial=function(t,e){var i=t.material;return i instanceof Je.ArrayMaterial?(e>i.materials.length-1&&(e=i.materials.length-1),i.materials[e]):i},Je.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(t){var e=t.familyName.toLowerCase(),i=this;i.faces[e]=i.faces[e]||{},i.faces[e][t.cssFontWeight]=i.faces[e][t.cssFontWeight]||{},i.faces[e][t.cssFontWeight][t.cssFontStyle]=t;i.faces[e][t.cssFontWeight][t.cssFontStyle]=t;return t},drawText:function(t){var e,i=this.getFace(),r=this.size/i.resolution,a=0,n=String(t).split(""),s=n.length,o=[];for(e=0;e<s;e++){var l=new Je.Path,h=this.extractGlyphPoints(n[e],i,r,a,l);a+=h.offset,o.push(h.path)}var c,u,f,d=a/2;for(e=0;e<s;e++){var l=o[e];for(f=0;f<l.actions.length;f++){var c=l.actions[f].args;for(u=0;u<c.length;u++)u%3===0&&(c[u]-=d)}}return{paths:o,offset:d}},extractGlyphPoints:function(t,e,i,r,a,n){var s,o,l,h,c,u,f,d,p,m,g,y,v,x,w,_,b,M,S,A=[],P=e.glyphs[t]||e.glyphs["?"],T=0;if(P){if(P.o)for(h=P._cachedOutline||(P._cachedOutline=P.o.split(" ")),u=h.length,f=i,d=i,s=0;s<u;)switch(c=h[s++]){case"m":p=h[s++]*f+r,m=h[s++]*d-T,a.moveTo(p,m,0);break;case"l":p=h[s++]*f+r,m=h[s++]*d-T,a.lineTo(p,m,0);break;case"q":if(g=h[s++]*f+r,y=h[s++]*d-T,w=h[s++]*f+r,_=h[s++]*d-T,a.quadraticCurveTo(w,_,0,g,y,0),S=A[A.length-1],S)for(v=S.x,x=S.y,o=1,l=this.divisions;o<=l;o++){var C=o/l;Je.Shape.Utils.b2(C,v,w,g),Je.Shape.Utils.b2(C,x,_,y)}break;case"b":if(g=h[s++]*f+r,y=h[s++]*d-T,w=h[s++]*f+r,_=h[s++]*-d-T,b=h[s++]*f+r,M=h[s++]*-d-T,a.bezierCurveTo(g,y,0,w,_,0,b,M,0),S=A[A.length-1],S)for(v=S.x,x=S.y,o=1,l=this.divisions;o<=l;o++){var C=o/l;Je.Shape.Utils.b3(C,v,w,b,g),Je.Shape.Utils.b3(C,x,_,M,y)}}return{offset:P.ha*i,path:a}}}},Je.FontUtils.generateShapes=function(t,i){i=i||{};var r=i.size!==e?i.size:100,a=i.curveSegments!==e?i.curveSegments:4,n=i.font!==e?i.font:"helvetiker",s=i.weight!==e?i.weight:"normal",o=i.style!==e?i.style:"normal";Je.FontUtils.size=r,Je.FontUtils.divisions=a,Je.FontUtils.face=n,Je.FontUtils.weight=s,Je.FontUtils.style=o;for(var l=Je.FontUtils.drawText(t),h=l.paths,c=[],u=0,f=h.length;u<f;u++)Array.prototype.push.apply(c,h[u].toShapes());return c},function(t){var e=1e-10,i=function(t,e){var i=t.length;if(i<3)return null;var n,s,o,l=[],h=[],c=[];if(r(t)>0)for(s=0;s<i;s++)h[s]=s;else for(s=0;s<i;s++)h[s]=i-1-s;var u=i,f=2*u;for(s=u-1;u>2;){if(f--<=0)return console.log("Warning, unable to triangulate polygon!"),e?c:l;if(n=s,u<=n&&(n=0),s=n+1,u<=s&&(s=0),o=s+1,u<=o&&(o=0),a(t,n,s,o,u,h)){var d,p,m,g,y;for(d=h[n],p=h[s],m=h[o],l.push([t[d],t[p],t[m]]),c.push([h[n],h[s],h[o]]),g=s,y=s+1;y<u;g++,y++)h[g]=h[y];u--,f=2*u}}return e?c:l},r=function(t){for(var e=t.length,i=0,r=e-1,a=0;a<e;r=a++)i+=t[r].x*t[a].y-t[a].x*t[r].y;return.5*i},a=function(t,i,r,a,n,s){var o,l,h,c,u,f,d,p,m;if(l=t[s[i]].x,h=t[s[i]].y,c=t[s[r]].x,u=t[s[r]].y,f=t[s[a]].x,d=t[s[a]].y,e>(c-l)*(d-h)-(u-h)*(f-l))return!1;var g,y,v,x,w,_,b,M,S,A,P,T,C,z,L;for(g=f-c,y=d-u,v=l-f,x=h-d,w=c-l,_=u-h,o=0;o<n;o++)if(o!==i&&o!==r&&o!==a&&(p=t[s[o]].x,m=t[s[o]].y,b=p-l,M=m-h,S=p-c,A=m-u,P=p-f,T=m-d,L=g*A-y*S,C=w*M-_*b,z=v*T-x*P,L>=-e&&z>=-e&&C>=-e))return!1;return!0};return t.Triangulate=i,t.Triangulate.area=r,t}(Je.FontUtils),self._typeface_js={faces:Je.FontUtils.faces,loadFace:Je.FontUtils.loadFace},Je.typeface_js=self._typeface_js;var hi={easeNone:function(t,e,i,r){return i*t/r+e},easeIn:function(t,e,i,r){return i*(t/=r)*t+e},easeOut:function(t,e,i,r){return-i*(t/=r)*(t-2)+e},easeBoth:function(t,e,i,r){return(t/=r/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInStrong:function(t,e,i,r){return i*(t/=r)*t*t*t+e},easeOutStrong:function(t,e,i,r){return-i*((t=t/r-1)*t*t*t-1)+e},easeBothStrong:function(t,e,i,r){return(t/=r/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},elasticIn:function(t,e,i,r,a,n){var s;return 0===t?e:1===(t/=r)?e+i:(n||(n=.3*r),!a||a<Math.abs(i)?(a=i,s=n/4):s=n/(2*Math.PI)*Math.asin(i/a),-(a*Math.pow(2,10*(t-=1))*Math.sin(2*(t*r-s)*Math.PI/n))+e)},elasticOut:function(t,e,i,r,a,n){var s;return 0===t?e:1===(t/=r)?e+i:(n||(n=.3*r),!a||a<Math.abs(i)?(a=i,s=n/4):s=n/(2*Math.PI)*Math.asin(i/a),a*Math.pow(2,-10*t)*Math.sin(2*(t*r-s)*Math.PI/n)+i+e)},elasticBoth:function(t,e,i,r,a,n){var s;return 0===t?e:2===(t/=r/2)?e+i:(n||(n=.3*r*1.5),!a||a<Math.abs(i)?(a=i,s=n/4):s=n/(2*Math.PI)*Math.asin(i/a),t<1?-.5*a*Math.pow(2,10*(t-=1))*Math.sin(2*(t*r-s)*Math.PI/n)+e:a*Math.pow(2,-10*(t-=1))*Math.sin(2*(t*r-s)*Math.PI/n)*.5+i+e)},backIn:function(t,i,r,a,n){return n===e&&(n=1.70158),t===a&&(t-=.001),r*(t/=a)*t*((n+1)*t-n)+i},backOut:function(t,e,i,r,a){return"undefined"==typeof a&&(a=1.70158),i*((t=t/r-1)*t*((a+1)*t+a)+1)+e},backBoth:function(t,e,i,r,a){return"undefined"==typeof a&&(a=5.70158),(t/=r/2)<1?i/2*t*t*(((a*=1.525)+1)*t-a)+e:i/2*((t-=2)*t*(((a*=1.525)+1)*t+a)+2)+e},bounceIn:function(t,e,i,r){return i-hi.bounceOut(r-t,0,i,r)+e},bounceOut:function(t,e,i,r){return(t/=r)<1/2.75?7.5625*i*t*t+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},bounceBoth:function(t,e,i,r){return t<r/2?.5*hi.bounceIn(2*t,0,i,r)+e:.5*hi.bounceOut(2*t-r,0,i,r)+.5*i+e}},ci=function(){if(this._as=[],1===arguments.length){var t=arguments[0];if(t instanceof ci&&(t=t._as),t instanceof Array)for(var e=t.length,i=0;i<e;i++)this._as.push(t[i]);else null!=t&&this._as.push(t)}else if(arguments.length>1)for(e=arguments.length,i=0;i<e;i++)this._as.push(arguments[i])};Je.List=ci,Je.extend(Je.List,Object,{size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(t,i){return i===e?this._as.push(t):this._as.splice(i,0,t)},addAll:function(t){if(t instanceof ci&&(t=t._as),t instanceof Array)for(var e=t.length,i=0;i<e;i++)this._as.push(t[i]);else this._as.push(t)},get:function(t){return this._as[t]},remove:function(t){var e=this._as.indexOf(t);return e>=0&&e<this._as.length&&this.removeAt(e),e},removeAt:function(t){return this._as.splice(t,1)[0]},set:function(t,e){return this._as[t]=e},clear:function(){return this._as.splice(0,this._as.length)},contains:function(t){return this.indexOf(t)>=0},indexOf:function(t){return this._as.indexOf(t)},forEach:function(t,e){for(var i=this._as.length,r=0;r<i;r++){var a=this._as[r];e?t.call(e,a):t(a)}},forEachReverse:function(t,e){for(var i=this._as.length,r=i-1;r>=0;r--){var a=this._as[r];e?t.call(e,a):t(a)}},toArray:function(t,e){if(t){for(var i=[],r=this._as.length,a=0;a<r;a++){var n=this._as[a];e?t.call(e,n)&&i.push(n):t(n)&&i.push(n)}return i}return this._as.concat()},toList:function(t,e){if(t){for(var i=new ci,r=this._as.length,a=0;a<r;a++){var n=this._as[a];e?t.call(e,n)&&i.add(n):t(n)&&i.add(n)}return i}return new ci(this)},sort:function(t){return t?this._as.sort(t):this._as.sort(),this},toString:function(){return this._as.toString()}}),Je.ImageCache=function(){};var ui=Je.ImageCache;ui.AlarmBillboardImage=new Image,ui.AlarmBillboardImage.src="data:image/png;base64,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",ui.Logo=new Image,ui.Logo.src="data:image/png;base64,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",
Je.ImageUtils={},Je.ImageUtils.registerDefaultImage=function(t){null!=t.src?ui.Logo.src=t.src:ui.Logo.src=t},Je.ImageUtils.registerAlarmImage=function(t){null!=t.src?ui.AlarmBillboardImage.src=t.src:ui.AlarmBillboardImage.src=t},ui.ssaoNormalImage=new Image,ui.ssaoNormalImage.src="data:image/png;base64,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",ui.ssaoNormalImage.loaded=!0,Je.EventDispatcher=function(){this.listeners={}},Je.extend(Je.EventDispatcher,null,{constructor:Je.EventDispatcher,addEventListener:function(t,i){this.listeners[t]===e&&(this.listeners[t]=[]),this.listeners[t].indexOf(i)===-1&&this.listeners[t].push(i)},removeEventListener:function(t,e){var i=this.listeners[t].indexOf(e);i!==-1&&this.listeners[t].splice(i,1)},dispatchEvent:function(t){var i=this.listenters[t.type];if(i!=e){t.target=this;for(var r=0;r<i.length;r++){var a=i[r];a.call(this,t)}}},contains:function(t,e){if(this._ls)for(var i,r=0,a=this._ls.size();r<a;r++)if(i=this._ls.get(r),t===i.l&&e===i.s)return!0;return!1},add:function(t,e,i){if(null==t)return void console.error("TGL.EventDispatcher#add:listener is null");var r={l:t,s:e,a:i};this._ls||(this._ls=new ci),this._f?(this._addPendings||(this._addPendings=new ci),this._addPendings.add(r)):r.a?this._ls.add(r,0):this._ls.add(r)},remove:function(t,e){this._ls&&(this._f?(this._removePendings||(this._removePendings=new ci),this._removePendings.add({l:t,s:e})):this._remove(t,e))},_remove:function(t,e){for(var i,r=0,a=this._ls.size();r<a;r++)if(i=this._ls.get(r),i.l===t&&i.s===e)return void this._ls.removeAt(r)},fire:function(t){if(this._ls){var e,i,r=this._ls.size();for(this._f=!0,e=0;e<r;e++)i=this._ls.get(e),i.s?i.l.call(i.s,t):i.l(t);if(this._f=!1,this._removePendings){for(r=this._removePendings.size(),e=0;e<r;e++)i=this._removePendings.get(e),this._remove(i.l,i.s);delete this._removePendings}if(this._addPendings){for(r=this._addPendings.size(),e=0;e<r;e++)i=this._addPendings.get(e),i.a?this._ls.add(i,0):this._ls.add(i);delete this._addPendings}}}}),Je.PropertyChangeDispatcher=function(){this._dispatcher=new Je.EventDispatcher},Je.extend(Je.PropertyChangeDispatcher,Object,{addPropertyChangeListener:function(t,e,i){this._dispatcher.add(t,e,i)},removePropertyChangeListener:function(t,e){this._dispatcher.remove(t,e)},firePropertyChange:function(t,e,i){if(e==i)return!1;var r={property:t,oldValue:e,newValue:i,source:this};return this._dispatcher.fire(r),this.onPropertyChanged(r),!0},onPropertyChanged:function(t){}}),Je.Texture=function(t,i,r,a,n,s,o,l,h){Je.PropertyChangeDispatcher.call(this),this.id=Je.TextureIdCount++,this.name="",null!=t&&this.setImage(t),this.mipmaps=[],this.mapping=i!==e?i:new Je.UVMapping,this.wrapS=r!==e?r:Je.RepeatWrapping,this.wrapT=a!==e?a:Je.RepeatWrapping,this.magFilter=n!==e?n:Je.LinearFilter,this.minFilter=s!==e?s:Je.LinearMipMapLinearFilter,this.anisotropy=h!==e?h:1,this.format=o!==e?o:Je.RGBAFormat,this.type=l!==e?l:Je.UnsignedByteType,this.repeatX=1,this.repeatY=1,this.offsetX=0,this.offsetY=0,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!1,this.flipX=!1,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},Je.extend(Je.Texture,Je.PropertyChangeDispatcher,{getUniqueCode:function(){if(ei.isImage(this._image)||"string"==typeof this._image||xi.isArray(this._image))return this._imageSrc+" "+this.format+" "+this.type+"  "+this.wrapS+" "+this.wrapT+" "+this.magFilter+" "+this.minFilter+" "+this.flipY+" "+this.flipX+this.anisotropy;if(ei.isCanvas(this._image)){var t=this._image;return t.__uniqueCode||(t.__uniqueCode=Je.id("texture")),t.__uniqueCode+" "+this.format+" "+this.type+" "+this.wrapS+" "+this.wrapT+" "+this.magFilter+" "+this.minFilter+" "+this.flipY+" "+this.flipX+this.anisotropy}},resetValue:function(){this.name="",this._image=null,this.mipmaps=[],this.mapping=new Je.UVMapping,this.wrapS=Je.RepeatWrapping,this.wrapT=Je.RepeatWrapping,this.magFilter=Je.LinearFilter,this.minFilter=Je.LinearMipMapLinearFilter,this.anisotropy=1,this.format=Je.RGBAFormat,this.type=Je.UnsignedByteType,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!1,this.flipX=!1,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},clone:function(t,i){return t===e&&(t=new Je.Texture),null==i||i?t.setImage(this._image):t._image=this._image,t._imageSrc=this._imageSrc,t.mipmaps=this.mipmaps.slice(0),t.mapping=this.mapping,t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.format=this.format,t.type=this.type,t.generateMipmaps=this.generateMipmaps,t.premultiplyAlpha=this.premultiplyAlpha,t.flipY=this.flipY,t.flipX=this.flipX,t.unpackAlignment=this.unpackAlignment,t},onloadTexture:function(){},setImageSrc:function(t){if("string"==typeof t)this._imageSrc=t;else if(xi.isArray(t)){for(var e="",i=0;i<t.length;i++)e+="string"==typeof t[i]?t:t[i].src;this._imageSrc=e}else this._imageSrc=t.src},loadAllImages:function(t,e){function i(i){i.onload=function(){i.loaded=!0,i.onload=null,a++,a==r&&(n.onloadTexture(),n.firePropertyChange("image",e,n._image),t.loaded=!0)}}for(var r=t.length,a=0,n=this,s=0;s<r;s++)i(t[s])},setImage:function(t){var e=this._image;if(xi.isArray(t)){for(var i,r="",a=[],n=0;n<t.length;n++)"string"==typeof t[n]?(r+=t,i=new Image,t[n].startsWith("data:image")||(i.crossOrigin="use-credentials"),i.src=t[n],a.push(i)):(r+=t[n].src,a.push(t[n]));this._imageSrc=r,this.loadAllImages(a,e),this._image=a}else if("string"==typeof t){if(this._image&&this._image.src===t)return;this._imageSrc=t;var s=new Image;t.startsWith("data:image")||(s.crossOrigin="use-credentials"),s.src=t;var o=this;o._image=s,s.onload=function(t){s.loaded=!0,s.onload=null,o.onloadTexture(),o.firePropertyChange("image",e,s)}}else{if(this._image===t)return;this._imageSrc=t.src;var e=this._image;if(ei.isCanvas(t)&&(t.loaded=!0),t&&!t.loaded){var o=this;o._image=t;var l=t.onload;t.onload=function(i){l&&l.call(null,i),t.loaded=!0,t.onload=null,o.onloadTexture(),o.firePropertyChange("image",e,t)}}else this._image=t,this.firePropertyChange("image",e,t)}},getImage:function(){return this._image},dispose:function(){this.firePropertyChange("disposed",!1,!0)}}),Je.TextureIdCount=0,Je.PixelsTexture=function(t,e,i,r,a,n,s,o,l,h,c){Je.Texture.call(this,null,n,s,o,l,h,r,a,c),this.image={data:t,width:e,height:i}},Je.PixelsTexture.prototype=Object.create(Je.Texture.prototype),Je.PixelsTexture.prototype.clone=function(){var t=new Je.PixelsTexture;return Je.Texture.prototype.clone.call(this,t),t},Je.CompressedTexture=function(t,e,i,r,a,n,s,o,l,h,c){Je.Texture.call(this,null,n,s,o,l,h,r,a,c),this.image={width:e,height:i},this.mipmaps=t,this.generateMipmaps=!1},Je.CompressedTexture.prototype=Object.create(Je.Texture.prototype),Je.CompressedTexture.prototype.clone=function(){var t=new Je.CompressedTexture;return Je.Texture.prototype.clone.call(this,t),t};var fi={pools:{},useTimes:{},size:0,setTexture:function(t,e){fi.size++,fi.pools[t]=e},getTexture:function(t){return fi.pools[t]},useTexture:function(t){if(t){var e=t.id,i=fi.useTimes[e]||0;i++,fi.useTimes[e]=i}},unUseTexture:function(t){if(t){var e=t.id,i=fi.useTimes[e]||0;if(i--,fi.useTimes[e]=i,i<=0){var r=t.getUniqueCode();delete fi.pools[r],fi.size--,t.dispose()}}}};Je.TexturePool=fi,Je.TexturePool.TestTexture=new Je.Texture,Je.SerializationSettings=function(){var t=Je.SerializationSettings;this.isDataBoxSerializable=t.isDataBoxSerializable,this.isStyleSerializable=t.isStyleSerializable,this.isClientSerializable=t.isClientSerializable,this.encodeURI=t.encodeURI,this._pm=Je.clone(t._pm),this._sm=Je.clone(t._sm),this._cm=Je.clone(t._cm)},function(){var t=Je.SerializationSettings;t.isDataBoxSerializable=!0,t.isStyleSerializable=!0,t.isClientSerializable=!0,t.encodeURI=!0,t._pm={},t._sm={},t._cm={},t.setPropertyType=function(e,i){t._pm[e]=i},t.getPropertyType=function(e){return t._pm[e]},t.setStyleType=function(e,i){t._sm[e]=i},t.getStyleType=function(e){return t._sm[e]},t.setClientType=function(e,i){t._cm[e]=i},t.getClientType=function(e){return t._cm[e]}}(),Je.extend(Je.SerializationSettings,Object,{setPropertyType:function(t,e){this._pm[t]=e},getPropertyType:function(t){return this._pm[t]},setStyleType:function(t,e){this._sm[t]=e},getStyleType:function(t){return this._sm[t]},setClientType:function(t,e){this._cm[t]=e},getClientType:function(t){return this._cm[t]}}),Je.Styles={_m:{},setStyle:function(t,e){return null==e?delete Je.Styles._m[t]:Je.Styles._m[t]=e,Je.Styles},getStyle:function(t){return Je.Styles._m[t]}},Je.Styles.MaterailType="S:m.type",Je.Styles.NormalType="S:m.normalType",Je.Styles.PREFIX_STYLE="S:",function(){var t=function(t,e){Je.SerializationSettings.setPropertyType(t,e)};t("combos","data.list"),t("name","cdata"),t("toolTip","cdata"),t("parent","data"),t("fromNode","data"),t("toNode","data"),t("alarmState","alarmstate"),t("vertices","list.vec3"),t("faces","serializeabe.list"),t("uvs","list.vec2"),t("position","vec3"),t("rotation","vec3"),t("scale","vec3"),t("location","point"),t("materialSize","number"),t("color","color"),t("ambient","color"),t("diffuse","color"),t("specular","color"),t("intensity","number"),t("distance","number"),t("type","number"),t("startClosed","boolean"),t("endClosed","boolean"),t("curveSegments","number"),t("amount","number"),t("vertical","boolean"),t("repeat","number"),t("centralized","boolean"),t("visible","boolean"),t=function(t,e,i){null==i&&(i=null!=e?e instanceof Je.Vec2?"vec2":e instanceof Je.Vec3?"vec3":typeof e:"string"),Je.Styles.setStyle(t,e),Je.SerializationSettings.setStyleType(t,i)},t("select.style","border"),t("select.width",1),t("select.color",65280),t("select.offset",0),t("outer.width",1),t("outer.offset",0),t("outer.color",null,"color"),t("m.type","basic"),t("m.color",16777215,"color"),t("m.side","front"),t("m.alphaTest",0),t("m.polygonOffset",!1),t("m.polygonOffsetFactor",0),t("m.polygonOffsetUnits",0),t("m.wireframe",!1),t("m.wireframeLinewidth",1),t("m.gradient",{}),t("m.gradientType",1),t("m.transparent",!1),t("m.opacity",1),t("m.visible",!0),t("m.depthTest",!0),t("m.depthMask",!0),t("m.alignment",new Je.Vec2(0,0)),t("m.linewidth",1),t("m.texture.image",null),t("m.texture.offset",new Je.Vec2(0,0)),t("m.texture.repeat",new Je.Vec2(1,1)),t("m.texture.wrapS",Je.RepeatWrapping),t("m.texture.wrapT",Je.RepeatWrapping),t("m.texture.flipX",!1),t("m.texture.flipY",!1),t("m.normalmap.image",null),t("m.envmap.image",null),t("m.specularmap.image",null),t("right.m.type","basic"),t("left.m.type","basic"),t("top.m.type","basic"),t("bottom.m.type","basic"),t("front.m.type","basic"),t("back.m.type","basic"),t("side.m.type","basic"),t("alarm.billboard.scale",null),t("alarm.billboard.position","top"),t("alarm.billboard.vertical",!1),t("annotation.class","tgl_annotation")}(),Je.extend(Je.Styles,Object,{});var di=function(t,i){this.min=t!==e?t:new Qe(1/0,1/0),this.max=i!==e?i:new Qe((-(1/0)),(-(1/0)))};Je.Box2=di,di.prototype={constructor:Je.Box2,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){if(t.length>0){var e=t[0];this.min.copy(e),this.max.copy(e);for(var i=1,r=t.length;i<r;i++)e=t[i],e.x<this.min.x?this.min.x=e.x:e.x>this.max.x&&(this.max.x=e.x),e.y<this.min.y?this.min.y=e.y:e.y>this.max.y&&(this.max.y=e.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var t=new Qe;return function(e,i){var r=t.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}}(),copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(t){var e=t||new Qe;return e.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){var e=t||new Qe;return e.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){var i=e||new Qe;return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){var i=e||new Qe;return i.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new Qe;return function(e){var i=t.copy(e).clamp(this.min,this.max);return i.sub(e).length()}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},clone:function(){return(new di).copy(this)}},Je.BoundingBox=function(t,i){this.min=t!==e?t:new Ke(1/0,1/0,1/0),this.max=i!==e?i:new Ke((-(1/0)),(-(1/0)),(-(1/0)))},Je.BoundingBox.prototype={constructor:Je.BoundingBox,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){if(t.length>0){var e=t[0];this.min.copy(e),this.max.copy(e);for(var i=1,r=t.length;i<r;i++)e=t[i],e.x<this.min.x?this.min.x=e.x:e.x>this.max.x&&(this.max.x=e.x),e.y<this.min.y?this.min.y=e.y:e.y>this.max.y&&(this.max.y=e.y),e.z<this.min.z?this.min.z=e.z:e.z>this.max.z&&(this.max.z=e.z)}else this.makeEmpty();return this},setFromCenterAndSize:function(t,e){var i=Je.BoundingBox.__v1.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(t){var e=t||new Ke;return e.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){var e=t||new Ke;return e.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t){return new Ke((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},clampPoint:function(t,e){e||new Ke;return(new Ke).copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){var e=Je.BoundingBox.__v1.copy(t).clamp(this.min,this.max);return e.sub(t).length()},getBoundingSphere:function(t){var e=t||new Je.Sphere;return e.center=this.center(),e.radius=.5*this.size(Je.BoundingBox.__v0).length(),e},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},transform:function(t){var e=[Je.BoundingBox.__v0.set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Je.BoundingBox.__v0.set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Je.BoundingBox.__v1.set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Je.BoundingBox.__v2.set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Je.BoundingBox.__v3.set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Je.BoundingBox.__v4.set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Je.BoundingBox.__v5.set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Je.BoundingBox.__v6.set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Je.BoundingBox.__v7.set(this.max.x,this.max.y,this.max.z).applyMatrix4(t)];return this.makeEmpty(),this.setFromPoints(e),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},clone:function(){return(new Je.BoundingBox).copy(this)}},Je.BoundingBox.__v0=new Ke,Je.BoundingBox.__v1=new Ke,Je.BoundingBox.__v2=new Ke,Je.BoundingBox.__v3=new Ke,Je.BoundingBox.__v4=new Ke,Je.BoundingBox.__v5=new Ke,Je.BoundingBox.__v6=new Ke,Je.BoundingBox.__v7=new Ke,Je.BoundingSphere=function(t,i){this.center=t!==e?t:new Ke,this.radius=i!==e?i:0},Je.BoundingSphere.prototype={constructor:Je.BoundingSphere,set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromCenterAndPoints:function(t,e){for(var i=0,r=0,a=e.length;r<a;r++){var n=t.distanceToSquared(e[r]);i=Math.max(i,n)}return this.center=t,this.radius=Math.sqrt(i),this},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsBoundingSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},clampPoint:function(t,e){var i=this.center.distanceToSquared(t),r=e||new Ke;return r.copy(t),i>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(t){var e=t||new Je.Box3;return e.set(this.center,this.center),e.expandByScalar(this.radius),e},transform:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius},clone:function(){return(new Je.BoundingSphere).copy(this)}},Je.Primitive=function(t,e){t=t||{},this.data=t,this.vertices=t.vertices,this.faces=t.faces,this.uvs=t.uvs,this.uv2s=t.uv2s,this.uniqueCode=e},Je.extend(Je.Primitive,Object,{clone:function(t){if(t){var e,i={};for(i.vertices=[],e=0;e<this.vertices.length;e++)i.vertices.push(this.vertices[e].clone());for(i.faces=[],e=0;e<this.faces.length;e++)i.faces.push(this.faces[e].clone());for(i.uvs=[],e=0;e<this.uvs.length;e++){for(var r=this.uvs[e],a=[],n=0;n<r.length;n++)a.push(r[n].clone);i.uvs.push(a)}for(i.uv2s=[],e=0;e<this.uv2s.length;e++)i.uv2s.push(this.uv2s[e].clone());return new Je.Primitive(i)}return new Je.Primitvie(this.data)}}),Je.PrimitiveCache={_cache:{},_useCount:{},getPrimitive:function(t){return t?Je.PrimitiveCache._cache[t]:null},setPrimitive:function(t,e){t&&(Je.PrimitiveCache._cache[t]=e)},usePrimitive:function(t){var e=Je.PrimitiveCache._useCount[t]||0;e++,Je.PrimitiveCache._useCount[t]=e},unUsePrimitive:function(t){var e=Je.PrimitiveCache._useCount[t]||0;e--,e<=0&&delete Je.PrimitiveCache._useCount[t]}},Je.PrimitiveGroupCache={},Je.Color=function(t){return t!==e&&this.set(t),this},Je.extend(Je.Color,Object,{r:1,g:1,b:1,getUniqueCode:function(){return""+this.r+this.g+this.b},set:function(t){switch(typeof t){case"number":this.setHex(t);break;case"string":this.setStyle(t)}},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,i){return this.r=t,this.g=e,this.b=i,this},setHSV:function(t,e,i){var r,a,n,s,o;return 0===i?this.r=this.g=this.b=0:(r=Math.floor(6*t),a=6*t-r,n=i*(1-e),s=i*(1-e*a),o=i*(1-e*(1-a)),0===r?(this.r=i,this.g=o,this.b=n):1===r?(this.r=s,this.g=i,this.b=n):2===r?(this.r=n,this.g=i,this.b=o):3===r?(this.r=n,this.g=s,this.b=i):4===r?(this.r=o,this.g=n,this.b=i):5===r&&(this.r=i,this.g=n,this.b=s)),this},setStyle:function(t){if(/^rgb\((\d+),(\d+),(\d+)\)$/i.test(t)){var e=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(t);return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,this}if(/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.test(t)){var e=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.exec(t);return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(t)){var e=/^\#([0-9a-f]{6})$/i.exec(t);return this.setHex(parseInt(e[1],16)),
this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(t)){var e=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(t);return this.setHex(parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3],16)),this}if(/^(\w+)$/i.test(t))return this.setHex(Je.ColorKeywords[t]),this},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t){return this.r=t.r*t.r,this.g=t.g*t.g,this.b=t.b*t.b,this},copyLinearToGamma:function(t){return this.r=Math.sqrt(t.r),this.g=Math.sqrt(t.g),this.b=Math.sqrt(t.b),this},convertGammaToLinear:function(){var t=this.r,e=this.g,i=this.b;return this.r=t*t,this.g=e*e,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},getHSV:function(t){var i,r,a=this.r,n=this.g,s=this.b,o=Math.max(Math.max(a,n),s),l=Math.min(Math.min(a,n),s),h=o;if(l===o)i=0,r=0;else{var c=o-l;r=c/o,i=a===o?(n-s)/c:n===o?2+(s-a)/c:4+(a-n)/c,i/=6,i<0&&(i+=1),i>1&&(i-=1)}return t===e&&(t={h:0,s:0,v:0}),t.h=i,t.s=r,t.v=h,t},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},clone:function(){return(new Je.Color).setRGB(this.r,this.g,this.b)}}),Je.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Je.Data=function(t){Je.PropertyChangeDispatcher.call(this),this._childList=new ci,this._childMap={},this._clientMap={},this._id=t},Je.extend(Je.Data,Je.PropertyChangeDispatcher,{___accessor:["name"],constructor:Je.Data,getId:function(){return this._id},onAlarmChange:function(){},onPropertyChange:function(t,e,i){},setGroupId:function(t){if(this._groupId!==t){var e=this._groupId;this._groupId=t,this.firePropertyChange("groupId",e,t)}},getGroupId:function(){return this._groupId},hasChildren:function(){return this._childList.size()>0},getChildren:function(){return this._childList},isDescendantOf:function(t){if(!t)return!1;if(!t.hasChildren())return!1;for(var e=this._parent;e;){if(t===e)return!0;e=e.getParent()}return!1},getParent:function(){return this._parent},getRoot:function(){var t=this._parent;return t&&null==t._parent?t:t&&null!=t._parent?t.getRoot(t):arguments[0]},setParent:function(t){if(!(this._isUpdatingParent||this._parent===t||this===t||t&&t.isDescendantOf(this))){var e=this._parent;this._parent=t,this._isUpdatingParent=!0,e&&e.removeChild(this),t&&t.addChild(this),delete this._isUpdatingParent,this.firePropertyChange("parent",e,t),this.onParentChanged(e,t)}},onParentChanged:function(t,e){},addChild:function(t,i){return i===e&&(i=this._childList.size()),!(!t||t===this)&&(!this._childMap[t.getId()]&&(!this.isDescendantOf(t)&&(t.getParent()&&t.getParent().removeChild(t),(i<0||i>this._childList.size())&&(i=this._childList.size()),this._childList.add(t,i),this._childMap[t._id]=t,t.setParent(this),this.firePropertyChange("children",null,t),this.onChildAdded(t,i),!0)))},onChildAdded:function(t,e){},clearChildren:function(){if(null!=this._childList&&this._childList.size()>0){var t=this._childList.toList(),e=this;t.forEach(function(t){e.removeChild(t)})}},removeChild:function(t){if(!t)return!1;if(!this._childMap[t._id])return!1;var e=this._childList.remove(t);return delete this._childMap[t._id],this.firePropertyChange("children",t,null),t.setParent(null),this.onChildRemoved(t,e),!0},onChildRemoved:function(t,e){},c:function(t){if(t)for(var e in t)this.setClient(e,t[e])},setClient:function(t,e){if(null==t)return this;null==this._clientMap&&(this._clientMap=new Object);var i=this._clientMap[t];if(i!==e)return null==e?delete this._clientMap[t]:this._clientMap[t]=e,this._clientMap[t]=e,this.firePropertyChange("C:"+t,i,e),this.onClientChanged(t,i,e),this},getClient:function(t){return this._clientMap[t]},onClientChanged:function(t,e,i){},setPropertyValue:function(t,e){if(this[t]===e)return!1;var i=this[t];return i instanceof Je.Color&&null!=e?(i=i.clone(),e instanceof Je.Color?this[t].copy(e):this[t].set(e)):this[t]=e,!0}}),Je.Element=function(t){Je.Data.call(this,t),this._id=t||Je.id("E"),this.styleMap={},this._visible=!0,this._selected=!1,this._selectable=!0,this._editable=!0,this.editing=!1,this.up=new Ke(0,1,0),this._position=new Ke(0,0,0),this._rotation=new Ke(0,0,0),this._scale=new Ke(1,1,1),this.eulerOrder=Je.defaultEulerOrder,this.rotationAutoUpdate=!0,this.matrix=new ti,this.worldMatrix=new ti,this.rotationWorldMatrix=new ti,this.matrixAutoUpdate=!1,this.worldMatrixNeedsUpdate=!0,this.quaternion=new Je.Quat,this.useQuaternion=!1,this._sizeFixed=!1,this._fixedSize=108,this.castShadow=!0,this.receiveShadow=!0,this.frustumCulled=!0,this._vector=new Ke,this.renderDepth=null,this._attachId="",this._groupId=null,this.editTransformToParent=!1,this._alarmState=new Je.AlarmState(this),this.colors=[]},Je.Element.__m1=new ti,Je.ElementIdCount=0,Je.extend(Je.Element,Je.Data,{IStyle:!0,___accessor:["visible","selected","selectable","editable","sizeFixed"],constructor:Je.Element,getAlarmState:function(){return this._alarmState},onAlarmChange:function(t,e){var i=this._alarmState.getHighestNativeAlarmSeverity();i?this.setStyle("m.alarmColor",new Je.Color(i.color)):this.setStyle("m.alarmColor",null)},getDefaultInstance:function(){return this.constructor.defaultInstance===e&&(this.constructor.defaultInstance=new this.constructor),this.constructor.defaultInstance},onParentChanged:function(t,e){this.updateWorldMatrix(!0,!1)},onChildAdded:function(t,e){t.updateWorldMatrix(!0,!1)},onChildRemoved:function(t,e){t.updateWorldMatrix(!0,!1)},generatePrimitiveKey:function(){return null},serializeProperty:function(){},clear:function(t){},getSelectStyle:function(){return this.getStyle("select.style")},isSpaceChangedProperty:function(t){return"scale"===t||"position"===t||"rotation"===t},isStyleEquals:function(t,e,i){return null==e&&null==i||e===i},setStyle:function(t,e){if(null==t)return this;null==this.styleMap&&(this.styleMap={});var i=this.styleMap[t];return this.isStyleEquals(t,i,e)?this:(null==e?delete this.styleMap[t]:this.styleMap[t]=e,this.onStyleChanged(t,i,e),this.firePropertyChange(Je.Styles.PREFIX_STYLE+t,i,e),this)},c:function(t){if(t)for(var e in t)this.setClient(e,t[e])},s:function(t){if(null!=t){null==this.styleMap&&(this.styleMap={});var e,i,r,a={},n={};for(e in t)i=t[e],r=this.styleMap[e],this.isStyleEquals(e,r,i)||(null==i?delete this.styleMap[e]:this.styleMap[e]=i,n[e]=r,this.isMaterialStyle(e)&&(a[e]=[i,r]));this.onMaterialStylesChanged(a);for(e in t)this.firePropertyChange(Je.Styles.PREFIX_STYLE+e,n[e],this.styleMap[e]);return this}},getStyle:function(t,e,i){null==i&&(i=!0);var r;return null!=this.styleMap&&(r=this.styleMap[t]),e&&(r=this.getCloneObject(r)),null==r&&i&&(r=this.getDefaultStyle(t,e)),r},getCloneObject:function(t){if(null==t)return null;if(Je.Utils.isArray(t)){for(var e=[],i=0;i<t.length;i++)e.push(this.getCloneObject(t[i]));return e}return t.clone?t.clone():t},getSideIndexMapping:function(){},setMaterialStyle:function(t,e){},setMaterialStyles:function(t){var e,r,a,n;for(var s in t){if(s.startsWith("m."))e=s.substr(s.indexOf(".")+1);else if(this.getSideIndexMapping()&&this.isSideStyle(a)){var o=a.substr(0,a.indexOf(".")),l=this.getSideMaterialIndex(o);if(l!=i)continue;a=a.substr(a.indexOf(".")+1),e=a.substr(s.indexOf(".")+1)}else s.startsWith("alarm.billboard.")&&(n=!0);var h=t[s];r=h[0],null==r?r=Je.Styles.getStyle(s):xi.isArray(r)&&(r=r[i]),this._A97(this.material,e,r)}n&&this._alarmBillboard&&this._setAlarmBillboardPositionAndSize(this._alarmBillboard)},onMaterialStylesChanged:function(t){this.setMaterialStyles(t)},isMaterialStyle:function(t){return!!t.startsWith("m.")||!(!this.getSideIndexMapping()||!this.isSideStyle(t))},onStyleChanged:function(t,e,i){if(t.startsWith("m."))this.setMaterialStyle(t,i);else if(this.getSideIndexMapping()&&this.isSideStyle(t)){var r=t.substr(0,t.indexOf("."));t=t.substr(t.indexOf(".")+1);var a=this.getSideMaterialIndex(r);this.setMaterialStyle(t,i,a)}else t.startsWith("alarm.billboard.")&&this._alarmBillboard&&this._setAlarmBillboardPositionAndSize(this._alarmBillboard)},textureMapping:{texture:"map",texture1:"map1",texture2:"map2",textureb:"blendMap",texturebp:"bumpMap",lightMap:"lightMap",lightmap:"lightMap",normalmap:"normalMap",envmap:"envMap",specularmap:"specularMap"},_A97:function(t,e,i){if(e.startsWith("texture.")||e.startsWith("texture1.")||e.startsWith("texture2.")||e.startsWith("textureb.")||e.startsWith("texturen.")||e.startsWith("texturebp.")||e.startsWith("lightmap")||e.startsWith("envmap")||e.startsWith("normalmap")||e.startsWith("specularmap")){var r=e.substr(0,e.indexOf(".")),a=e.substr(e.indexOf(".")+1);if("offset"===a||"repeat"===a)return void t.setPropertyValue(a,this.getCloneObject(i));var n=this.textureMapping[r],s=t[n],o=Je.TexturePool.TestTexture;if("image"===a){var l=i;if(e.startsWith("envmap")&&xi.isArray(l))for(var h=0;h<l.length;h++)if(null==l[h]){l=null;break}if(null==s&&null!=l){o.resetValue(),o._image=l,o.setImageSrc(l);var c=o.getUniqueCode(),u=Je.TexturePool.getTexture(c);null==u&&(u=new Je.Texture(l),Je.TexturePool.setTexture(c,u)),t.setMap(u,n)}else if(null==l)t.setMap(null,n);else{s.clone(o,!1),o._image=l,o.setImageSrc(l);var c=o.getUniqueCode(),u=Je.TexturePool.getTexture(c);u!==s&&(null==u&&(u=new Je.Texture,s.clone(u,!1),u.setImage(l),Je.TexturePool.setTexture(c,u)),t.setMap(u,n))}}else if(null!=s){s.clone(o,!1),o[a]=this.getCloneObject(i);var c=o.getUniqueCode(),u=Je.TexturePool.getTexture(c);u!=s&&(null==u&&(u=new Je.Texture,s.clone(u),u[a]=i),t.setMap(u,n))}}else"type"===e&&t.setType?t.setType(i):t.setPropertyValue(e,this.getCloneObject(i))},getDefaultStyle:function(t,e){if(null==t)return null;if(t.startsWith("m.")){var i=[],r=t.substr(t.indexOf(".")+1);if(this.material.materials){var a=this.material.materials;a=a||[this.material];for(var n=0;n<a.length;n++){var s=a[n];if(r.startsWith("texture.")||r.startsWith("texture1.")||r.startsWith("texture2.")||r.startsWith("textureb.")||r.startsWith("texturen.")||r.startsWith("texturebp.")||r.startsWith("lightmap")||r.startsWith("envmap")||r.startsWith("normalmap")||r.startsWith("specularmap")){var o=r.substr(0,r.indexOf(".")),l=r.substr(r.indexOf(".")+1),h=(r.substr(r.indexOf(".")+1),this.textureMapping[o]),c=s[h];if(c)if("image"===l)if(xi.isArray(c._image)){var u=[];i.push(u);for(var f=0;f<c._image.length;f++)u.push(c._image[f].src)}else i.push(c._image.src);else"offset"===l||"repeat"===l?i.push(s[l]):i.push(s.map[l]);else i.push(Je.Styles.getStyle(t))}else i.push(s[r])}}e&&(i=this.getCloneObject(i));for(var d=!0,n=0;n<i.length;n++)if(0!=i.indexOf(i[n])){d=!1;break}return d?i[0]:i}if(this.isSideStyle(t)){var p=t.substr(0,t.indexOf("."));t=t.substr(t.indexOf(".")+1);var r=t.substr(t.indexOf(".")+1),m=this.getSideMaterialIndex(p);if(null!=m){var g,s=this.material.materials[m];return r.startsWith("texture.")?s.map&&(g="texture.image"===r?s.map._image.src:s.map[r]):g=s[r],e&&(g=this.getCloneObject(g)),g}}return Je.Styles.getStyle(t)},isSideStyle:function(t){if(t.indexOf(".")===-1)return!1;var i=this.getSideIndexMapping();if(!i)return!1;var r=t.substr(0,t.indexOf("."));return i[r]!==e},setUp:function(t,e,i){var r;if(3===arguments.length){if(this.up.x===t&&this.up.y===e&&this.up.z===i)return;r=new Ke(t,e,i)}else{if(this.up.x===t.x&&this.up.y===t.y&&this.up.z===t.z)return;r=t}var a=this.up;this.up=r,this.onUpChanged(a,newValue),this.firePropertyChange("up",a,r)},getUp:function(){return this.up},onUpChanged:function(t,e){},checkNumber:function(t,e,i,r){xi.isNaN(t)&&console.error(r+",x is not a number"),xi.isNaN(e)&&console.error(r+",y is not a number"),xi.isNaN(i)&&console.error(r+",z is not a number")},invalidateTexture:function(t){var e,i,r,a=this.material;if(null!=t&&a instanceof Je.ArrayMaterial){if("string"==typeof t){var n=this.getSideIndexMapping();if(null!=n&&(t=n[t]),null==t)return}if("number"!=typeof t)return;r=a instanceof Je.ArrayMaterial?a.materials[t]:materail,this._dirtyMaterialTexture(r)}else if(a instanceof Je.ArrayMaterial)for(i=a.materials,e=0;e<i.length;e++)r=i[e],this._dirtyMaterialTexture(r);else this._dirtyMaterialTexture(a)},_dirtyMaterialTexture:function(t){null!=t&&t.map&&t.map instanceof Je.Texture&&this._dirtyTexture(t.map)},_dirtyTexture:function(t){var e=t._image;t.firePropertyChange("image",null,e)},p:function(t,e,i){return 0===arguments.length?this.getPosition():void(3===arguments.length?this.setPosition(t,e,i):this.setPosition(t))},checkPosition:function(t){return!0},setPosition:function(t,e,i){var r;if(3===arguments.length){if(this._position.x===t&&this._position.y===e&&this._position.z===i)return;this.checkNumber(t,e,i,"setPosition"),r=new Ke(t,e,i)}else{if(this._position.x===t.x&&this._position.y===t.y&&this._position.z===t.z)return;if(!(t instanceof Ke))throw"Element.setPosition : position is not instanceof TGL.Vec3";r=t}if(this.checkPosition(r)){var a=this._position;this._position=r,this.updateWorldMatrix(!0,!1),this.firePropertyChange("position",a,r)}},getPosition:function(t){return t==e&&(t=!0),t?this._position.clone():this._position},setPositionX:function(t){if(this._position.x!==t){this.checkNumber(t,0,0,"setPositionX");var e=this._position.x,i=this._position.clone();return i.x=t,!!this.checkPosition(i)&&(this._position.x=t,this.updateWorldMatrix(!0,!1),this.firePropertyChange("positionX",e,t),void 0)}},setX:function(t){this.setPositionX(t)},getPositionX:function(){return this._position.x},getX:function(){return this.getPositionX()},setPositionY:function(t){if(this._position.y!==t){this.checkNumber(0,t,0,"setPositionY");var e=this._position.y,i=this._position.clone();return i.y=t,!!this.checkPosition(i)&&(this._position.y=t,this.updateWorldMatrix(!0,!1),this.firePropertyChange("positionY",e,t),void 0)}},setY:function(t){this.setPositionY(t)},getPositionY:function(){return this._position.y},getY:function(){return this.getPositionY()},setPositionZ:function(t){if(this._position.z!==t){this.checkNumber(0,0,t,"setPositionZ");var e=this._position.z,i=this._position.clone();return i.z=t,!!this.checkPosition(i)&&(this._position.z=t,this.updateWorldMatrix(!0,!1),this.firePropertyChange("positionZ",e,t),void 0)}},setZ:function(t){this.setPositionZ(t)},getPositionZ:function(){return this._position.z},getZ:function(){return this.getPositionZ()},setScale:function(t,e,i){var r;if(3===arguments.length){if(this._scale.x===t&&this._scale.y===e&&this._scale.z===i)return;this.checkNumber(t,e,i,"setScale"),r=new Ke(t,e,i)}else{if(this._scale.x===t.x&&this._scale.y===t.y&&this._scale.z===t.z)return;if(!(t instanceof Ke))throw"Element.setScale : scale is not instanceof TGL.Vec3";r=t}var a=this._scale;r.x=r.x||1,r.y=r.y||1,r.z=r.z||1,this._scale=r,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scale",a,r)},getScale:function(t){return t==e&&(t=!0),t?this._scale.clone():this._scale},setScaleX:function(t){if(this._scale.x!==t){this.checkNumber(t,0,0,"setScalX");var e=this._scale.x;this._scale.x=t,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scaleX",e,t)}},getScaleX:function(){return this._scale.x},setScaleY:function(t){if(this._scale.y!==t){this.checkNumber(0,t,0,"setScaleY");var e=this._scale.y;this._scale.y=t,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scaleY",e,t)}},getScaleY:function(){return this._scale.y},setScaleZ:function(t){if(this._scale.z!==t){this.checkNumber(0,0,t,"setScaleZ");var e=this._scale.z;this._scale.z=t,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scaleZ",e,t)}},getScaleZ:function(){return this._scale.z},setRotation:function(t,e,i){var r;if(3===arguments.length){if(this._rotation.x===t&&this._rotation.y===e&&this._rotation.z===i)return;this.checkNumber(t,e,i,"setRotation"),r=new Ke(t,e,i)}else{if(this._rotation.x===t.x&&this._rotation.y===t.y&&this._rotation.z===t.z)return;if(!(t instanceof Ke))throw"Element.setRotation : rotation is not instanceof TGL.Vec3";r=t}var a=this._rotation;this._rotation=r,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotation",a,r)},getRotation:function(t){return t==e&&(t=!0),t?this._rotation.clone():this._rotation},setRotationX:function(t){if(this._rotation.x!==t){this.checkNumber(t,0,0,"setRotationX");var e=this._rotation.x;this._rotation.x=t,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotationX",e,t)}},getRotationX:function(){return this._rotation.x},setRotationY:function(t){if(this._rotation.y!==t){this.checkNumber(0,t,0,"setRotationY");var e=this._rotation.y;this._rotation.y=t,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotationY",e,t)}},getRotationY:function(){return this._rotation.y},setRotationZ:function(t){if(this._rotation.z!==t){this.checkNumber(0,0,t,"setRotationZ");var e=this._rotation.z;this._rotation.z=t,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotationZ",e,t)}},getRotationZ:function(){return this._rotation.z},applyMatrix:function(t){var e=this.matrix.clone();this.matrix.multiplyMatrices(t,this.matrix),this._scale.getScaleFromMatrix(this.matrix);var i=(new ti).extractRotation(this.matrix);this._rotation.setEulerFromRotationMatrix(i,this.eulerOrder),this._position.getPositionFromMatrix(this.matrix),this.updateWorldMatrix(!0,!1),this.firePropertyChange("matrix",e,this.matrix)},translate:function(t,e){this.matrix.rotateAxis(e),this.setPosition(this._position.clone().add(e.multiplyScalar(t)))},translateX:function(t){this.translate(t,this._vector.set(1,0,0))},translateY:function(t){this.translate(t,this._vector.set(0,1,0))},translateZ:function(t){this.translate(t,this._vector.set(0,0,1))},rotateFromAxis:function(t,e,i){e=e.clone().applyMatrix4(this.matrix),t=t.clone().normalize().applyMatrix4((new ti).extractRotation(this.matrix));var r=(new ti).makeRotationAxisAndCenter(t,i,e);this.applyMatrix(r)},rotateFromWorldAxis:function(t,e){var i=new ti;i.makeRotationAxis(t.normalize(),e),i.multiply(this.matrix),this.matrix=i;var r=(new ti).extractRotation(this.matrix),a=new Ke;a.setEulerFromRotationMatrix(r,this.eulerOrder),this.setRotation(a)},getEulerAngles:function(){return this.matrix.getEulerAngles()},rotateFromWorldXAxis:function(t){this.rotateFromWorldAxis(new Ke(1,0,0),t)},rotateFromWorldYAxis:function(t){this.rotateFromWorldAxis(new Ke(0,1,0),t)},rotateFromWorldZAxis:function(t){this.rotateFromWorldAxis(new Ke(0,0,1),t)},getRelativeTransform:function(t){if(t instanceof Je.Element){var e=(new ti).getInverse(t.matrix.clone()),i=(new ti).multiplyMatrices(e,this.matrix.clone()),r=(new Ke).getPositionFromMatrix(i),a=(new Ke).setEulerFromRotationMatrix(i),n=(new Ke).getScaleFromMatrix(i),s={position:r,rotation:a,scale:n,matrix:i};return s}return null},localToWorld:function(t){return null==this._parent?t:t.clone().applyMatrix4(this._parent.worldMatrix)},localToWorld2:function(t){return t.clone().applyMatrix4(this.worldMatrix)},getWorldPosition:function(){return this.worldMatrix.getPosition()},direction:function(t){var e=t.applyMatrix4((new ti).extractRotation(this.worldMatrix));return e.normalize(),e},frontDirection:function(){var t=new Ke(0,0,1);return t=t.applyMatrix4((new ti).extractRotation(this.worldMatrix)),t.normalize(),t},worldPosition:function(t,e){e=e>0?e:t.length();var i=this.worldMatrix.getPosition();return i.add(this.direction(t).multiplyScalar(e))},frontWorldPosition:function(t){t=t>0?t:1;var e=this.worldMatrix.getPosition();return e.add(this.frontDirection().multiplyScalar(t))},worldToLocal:function(t){return t.clone().applyMatrix4(Je.Element.__m1.getInverse(this.worldMatrix))},lookAt:function(t,e){this.matrix.lookAt(t,this._position,e?e:this.up),this.rotationAutoUpdate&&(this.useQuaternion===!1?this._rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):this.quaternion.copy(this.matrix.decompose()[1])),this.worldMatrixNeedsUpdate=!0},iterator:function(t){t(this),this._childList&&this._childList.forEach(function(e){e.iterator(t)})},getChildByName:function(t,i){for(var r=0,a=this.children.length;r<a;r++){var n=this.children[r];if(n.name===t)return n;if(i===!0&&(n=n.getChildByName(t,i),n!==e))return n}return e},getDescendants:function(t){t===e&&(t=[]);var i=this.getChildren().toArray();Array.prototype.push.apply(t,i);for(var r=0,a=i.length;r<a;r++)i[r].getDescendants(t);return t},fixSize:function(t){if(this._sizeFixed){this.updateWorldMatrix();var e=new Ke,i=new Ke;e.getPositionFromMatrix(this.worldMatrix),t.updateWorldMatrix(),i.getPositionFromMatrix(t.worldMatrix),scale=e.distanceTo(i)/this._fixedSize,0===scale&&(scale=1e-5),this.setScale(scale,scale,scale)}},updateMatrix:function(){this.matrix.setPosition(this._position),this.useQuaternion===!1?this.matrix.setRotationFromEuler(this._rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),(1!==this._scale.x||1!==this._scale.y||1!==this._scale.z)&&this.matrix.scale(this._scale),this.worldMatrixNeedsUpdate=!0},updateWorldMatrix:function(t,i){if(i=i==e||i,this.matrixAutoUpdate===!0&&this.updateMatrix(),this.worldMatrixNeedsUpdate===!0||t===!0){this.matrixAutoUpdate===!1&&this.updateMatrix();var r=this.worldMatrix.clone();this._parent==e?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiplyMatrices(this._parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0,r.equals(this.worldMatrix)||(i&&this.firePropertyChange("worldMatrix",r,this.worldMatrix),this.updateCameraMatrix&&this.updateCameraMatrix(!1))}this._childList.forEach(function(e){e.updateWorldMatrix(t)})},cloneCallback:function(t){},clonePrefab:function(t){var i=new mono.Entity;t===e&&(t=!0),i.name=this.name,null==i.up&&(i.up=new Ke(0,1,0)),i.up.copy(this.up),i._position.copy(this._position),i._rotation.copy(this._rotation),i.eulerOrder=this.eulerOrder,i._scale.copy(this._scale),i.renderDepth=this.renderDepth,i.rotationAutoUpdate=this.rotationAutoUpdate,i.matrix.copy(this.matrix),i.worldMatrix.copy(this.worldMatrix),i.rotationWorldMatrix.copy(this.rotationWorldMatrix),i.matrixAutoUpdate=this.matrixAutoUpdate,i.worldMatrixNeedsUpdate=this.worldMatrixNeedsUpdate,i.quaternion.copy(this.quaternion),i.useQuaternion=this.useQuaternion,i._visible=this._visible,i.castShadow=this.castShadow,i.receiveShadow=this.receiveShadow,i.frustumCulled=this.frustumCulled,i.styleMap=i.styleMap||{},t&&this._childList&&this._childList.forEach(function(e){i.addChild(e.clonePrefab(t))}),i.vertices=this.vertices,i.faces=this.faces,i.uvs=this.uvs,i.uv2s=this.uv2s,i.primitive=this.primitive,i.data=this.primitive.data,i.computed=!0;for(var r in this.styleMap)i.styleMap[r]=this.getCloneObject(this.styleMap[r]);if(null!=this._clientMap)for(var a in this._clientMap)i.setClient(a,this._clientMap[a]);if(i.material=this.material,this.material instanceof Je.ArrayMaterial){i.material=new Je.ArrayMaterial,i.material.materials=[];for(var n=0;n<this.material.materials.length;n++)i.material.materials.push(this.material.materials[n])}return i.materialSize=this.getMaterialSize(),i},createCloneObject:function(){return this.constructor?object=new this.constructor:object=new Je.Element,object},clone:function(t,i,r){if("boolean"==typeof t&&(r=i,i=t,t=e),t==e&&(t=this.createCloneObject()),r===e&&(r=!0),t.name=this.name,null==t.up&&(t.up=new Ke(0,1,0)),t.up.copy(this.up),t._position.copy(this._position),t._rotation.copy(this._rotation),t.eulerOrder=this.eulerOrder,t._scale.copy(this._scale),t.renderDepth=this.renderDepth,t.rotationAutoUpdate=this.rotationAutoUpdate,t.matrix.copy(this.matrix),t.worldMatrix.copy(this.worldMatrix),t.rotationWorldMatrix.copy(this.rotationWorldMatrix),t.matrixAutoUpdate=this.matrixAutoUpdate,t.worldMatrixNeedsUpdate=this.worldMatrixNeedsUpdate,t.quaternion.copy(this.quaternion),t.useQuaternion=this.useQuaternion,t._visible=this._visible,t.castShadow=this.castShadow,t.receiveShadow=this.receiveShadow,t.frustumCulled=this.frustumCulled,t.styleMap=t.styleMap||{},r&&this._childList&&this._childList.forEach(function(e){t.addChild(e.clone(i,r))}),this.constructor){var a=this.constructor.prototype.__accessor,n=this.constructor.prototype.__bool;if(a&&a.length>0)for(var s=0;s<a.length;s++){var o=a[s],l=Je.getter(o,n),h=Je.setter(o);"vertices"===o?t.vertices=this.vertices:"faces"===o?t.faces=this.faces:t[h]&&t[h](this[l]())}}if(i&&this.vertices){var c=t,u=this.vertices;c.vertices=[],c.faces=[],c.uvs=[];for(var s=0,f=u.length;s<f;s++)c.vertices.push(u[s].clone());for(var d=this.faces,s=0,f=d.length;s<f;s++)c.faces.push(d[s].clone());for(var p=this.uvs,s=0,f=p.length;s<f;s++){for(var m=p[s],g=[],y=0,v=m.length;y<v;y++)g.push(new Je.Vec2(m[y].x,m[y].y));c.uvs.push(g)}}for(var x in this.styleMap)t.setStyle(x,this.getCloneObject(this.styleMap[x]));if(null!=this._clientMap)for(var w in this._clientMap)t.setClient(w,this._clientMap[w]);return t.cloneCallback(i),t}}),Je.Annotation=function(t,e,i,r){Je.Element.call(this,r),this._label=t,this._text=e,this.buttons=i,this._cameraPosition=null},Je.extend(Je.Annotation,Je.Element,{___accessor:["label","text","cameraPosition"]}),Je.Node=function(t){Je.Element.call(this,t),this.name="",this.computed=!1,this.selectionData=null,this.stylesMap=new Object,this.renderGroup=[],this.primitive=null,this.vertices=[],this.faces=[],this.uvs=[],this.uv2s=[],this.colors=[],this.normals=[],this.faces=[],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.morphTargetsNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1,this.computeNodeData(),this._alarmBillboard=null},Je.extend(Je.Node,Je.Element,{__accessor:["vertices","faces","uvs","linkAgent"],__SizePropeties:[],setUpdateFlags:function(t){this.verticesNeedUpdate=t,this.morphTargetsNeedUpdate=t,this.elementsNeedUpdate=t,this.uvsNeedUpdate=t,this.normalsNeedUpdate=t,this.tangentsNeedUpdate=t,this.colorsNeedUpdate=t},getLinks:function(){return this._links},getFromLinks:function(){return this._fromLinks},getToLinks:function(){return this._toLinks},_addFromLink:function(t){this._allLinks||(this._allLinks=new ci),this._fromLinks||(this._fromLinks=new ci),this._allLinks.add(t),this._fromLinks.add(t),this._resetLinkSet()},_addToLink:function(t){this._allLinks||(this._allLinks=new ci),this._toLinks||(this._toLinks=new ci),this._allLinks.add(t),this._toLinks.add(t),this._resetLinkSet()},_removeFromLink:function(t){this._allLinks.remove(t),this._fromLinks.remove(t),0===this._allLinks.size()&&delete this._allLinks,0===this._fromLinks.size()&&delete this._fromLinks,this._resetLinkSet()},_removeToLink:function(t){this._allLinks.remove(t),this._toLinks.remove(t),0===this._allLinks.size()&&delete this._allLinks,0===this._toLinks.size()&&delete this._toLinks,this._resetLinkSet()},_resetLinkSet:function(){if(delete this._loopedLinks,!this._allLinks||0===this._allLinks.size())return void delete this._links;var t;this._allLinks.forEach(function(e){e.isLooped()&&(t||(t={}),t[e._id]||(this._loopedLinks||(this._loopedLinks=new ci),this._loopedLinks.add(e),t[e._id]=e))},this),t?(this._links=new ci,this._allLinks.forEach(function(e){t[e._id]?t[e._id]!==!1&&(t[e._id]=!1,this._links.add(e)):this._links.add(e)},this)):this._links=this._allLinks},onAlarmChange:function(t,e){Je.Element.prototype.onAlarmChange.call(this,t,e);var i=this;setTimeout(function(){var t=i._alarmState.getPropagateSeverity();t||(t=i._alarmState.getHighestNativeAlarmSeverity());var e=i._parent,r=!1;if(null!=e&&e._alarmState){var a=e._alarmState.getPropagateSeverity();a||(r=!0)}else r=!0;t&&r?(null==i._alarmBillboard&&i.setAlarmBillboard(new Je.Billboard),i._alarmBillboard.setStyle("m.texture.image",Je.ImageCache.AlarmBillboardImage),i._alarmBillboard.setStyle("m.color",t.color),i._alarmBillboard.setStyle("m.alignment",Je.BillboardAlignment.bottomCenter)):i.setAlarmBillboard(null)},10)},_setAlarmBillboardPositionAndSize:function(t){var e=this.getStyle("alarm.billboard.position"),i=this.getBoundingBox(),r=i.min,a=i.max,n=i.center(),s=i.size();"topLeft"===e?t._position.set(r.x,a.y,n.z+1):"topRight"===e?t._position.set(a.x,a.y,n.z+1):"topBack"===e?t._position.set(n.x,a.y,r.z-1):"topFront"===e?t._position.set(n.x,a.y,a.z+1):t._position.set(n.x,a.y,n.z+1);var o=this.getStyle("alarm.billboard.scale");o instanceof Ke?t._scale.copy(o):t._scale.set(s.x/2,s.x/2,1);var l=this.getStyle("alarm.billboard.vertical");t.setStyle("m.vertical",l)},getLinkOffset:function(t){return new mono.Vec3(0,0,0)},getLinkExtend:function(t){return new mono.Vec3(0,0,0)},clearLinkOrthogonal:function(t,e){return!1},clearLinkExtend:function(t,e){return!1},setAlarmBillboard:function(t){if(this._alarmBillboard!=t){var e=this._alarmBillboard;t?(this._alarmBillboard=t,t.setParent(this),t.setClient("alarmBillboard",!0),this._setAlarmBillboardPositionAndSize(t)):(this._alarmBillboard.setParent(null),
delete this._alarmBillboard),this.firePropertyChange("alarmBillboard",e,t)}},needUpdate:function(){return this.verticesNeedUpdate||this.morphTargetsNeedUpdate||this.elementsNeedUpdate||this.uvsNeedUpdate||this.normalsNeedUpdate||this.tangentsNeedUpdate||this.colorsNeedUpdate},getVerticesWithChildren:function(t,e){function i(i){i.applyMatrix4(t),e.push(i)}null==e&&(e=[]),null==t&&(t=new ti);var r;if(this instanceof Je.Node){if(null!=this.vertices&&0!=this.vertices.length){var a=this.getBoundingBox(),n=a.min,s=a.max;i(n.clone()),i(s.clone()),i(new Ke(n.x,n.y,s.z)),i(new Ke(n.x,s.y,n.z)),i(new Ke(s.x,n.y,n.z)),i(new Ke(s.x,s.y,n.z)),i(new Ke(s.x,n.y,s.z)),i(new Ke(n.x,s.y,s.z))}for(var r=0;r<(this._childList?this._childList.size():0);r++){var o=this._childList.get(r),l=new ti;l.multiplyMatrices(t,o.matrix.clone()),o.getVerticesWithChildren&&o.getVerticesWithChildren(l,e)}}return e},getBoundingBoxWithChildren:function(t){var e=this.getVerticesWithChildren();if(t)for(var i=0;i<t.length;i++){var r=t[i];if(r.getParent()===this.getParent()&&r!==this){var a=(new ti).getInverse(this.matrix.clone()),n=(new ti).multiplyMatrices(a,r.matrix.clone());e=e.concat(r.getVerticesWithChildren(n))}}var s=new Je.BoundingBox;return s.setFromPoints(e),s},getWorldBoundingBox:function(){for(var t=[],e=0;e<this.vertices.length;e++){var i=this.vertices[e].clone();i.applyMatrix4(this.worldMatrix),t.push(i)}var r=new Je.BoundingBox;return r.setFromPoints(t),r},getBoundingBox:function(){return null==this.boundingBox&&this.computeBoundingBox(),this.boundingBox},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Je.BoundingBox),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Je.BoundingSphere),this.boundingSphere.setFromCenterAndPoints(this.boundingSphere.center,this.vertices)},createPropagateAlarmCube:function(t){if(null==this.boundingBox&&this.computeBoundingBox(),t._attachId=this._id,null==this.propagateAlarmData){var e=this.getStyle("outer.offset"),i=this.boundingBox.min,r=this.boundingBox.max;t.width=r.x-i.x+e,t.height=r.y-i.y+e,t.depth=r.z-i.z+e,t.computed=!1,t.computeNodeData(),this.propagateAlarmData=t.data,oi(t,!0),this.propagateAlarmData.primitive=t.primitive,this.propagateAlarmData.groups=t.groups;for(var a=(new Ke).center(i,r),n=0;n<t.vertices.length;n++){var s=t.vertices[n];s.add(a)}this.propagateAlarmData.vertices=t.vertices}else{var o=this.propagateAlarmData;t.primitive=o.primitive,t.data=o,t.vertices=o.vertices,t.uvs=o.uvs,t.faces=o.faces,t.groups=o.groups}this.updateMatrix(!0),t._position.copy(this._position),t._scale.copy(this._scale),t._rotation.copy(this._rotation),t.useQuaternion=this.useQuaternion,t.quaternion=this.quaternion,t.worldMatrix=this.worldMatrix,t._parent=this.getParent(),t.updateMatrix(!0);var l=t.material;l.wireframeLinewidth=this.getStyle("outer.width");var h=this.getAlarmState().getPropagateSeverity();return l.color.set(h.color),t},createCanvasSelectionCube:function(){return null==this._csc&&(this._csc=new yi,this._csc.material=new Je.EntityMaterial,this._csc.material.wireframe=!0),this.createSelectionCube(this._csc),this._csc},createSelectionCube:function(t){if(null==this.boundingBox&&this.computeBoundingBox(),t._attachId=this._id+"_selection",null==this.selectionData){var e=this.getStyle("select.offset"),i=this.boundingBox.min,r=this.boundingBox.max,a=(new Ke).center(i,r);t.width=r.x-i.x+e,t.height=r.y-i.y+e,t.depth=r.z-i.z+e,t.offset=a,t.computed=!1;t.computeNodeData();this.selectionData=t.data,oi(t,!0),this.selectionData.primitive=t.primitive,this.selectionData.groups=t.groups,this.selectionData.vertices=t.vertices}else{var n=this.selectionData;t.primitive=n.primitive,t.data=n,t.vertices=n.vertices,t.uvs=n.uvs,t.faces=n.faces,t.groups=n.groups}this.updateMatrix(!0),t._position.copy(this._position),t._scale.copy(this._scale),t._rotation.copy(this._rotation),t.useQuaternion=this.useQuaternion,t.quaternion=this.quaternion,t.worldMatrix=this.worldMatrix,t._parent=this.getParent(),t.updateMatrix(!0);var s=t.material;return s.wireframeLinewidth=this.getStyle("select.width"),s.color.set(this.getStyle("select.color")),t},mergeVertices:function(){var t,i,r,a,n,s,o,l={},h=[],c=[],u=4,f=Math.pow(10,u);for(this.__tmpVertices=e,null==this.vertices&&console.log("vertices is null"),r=0,a=this.vertices.length;r<a;r++)t=this.vertices[r],i=[Math.round(t.x*f),Math.round(t.y*f),Math.round(t.z*f)].join("_"),l[i]===e?(l[i]=r,h.push(this.vertices[r]),c[r]=h.length-1):c[r]=c[l[i]];var d=[];for(r=0,a=this.faces.length;r<a;r++)if(n=this.faces[r],n instanceof mi){n.a=c[n.a],n.b=c[n.b],n.c=c[n.c],s=[n.a,n.b,n.c];for(var p=-1,m=0;m<3;m++)if(s[m]==s[(m+1)%3]){p=m,d.push(r);break}}else if(n instanceof gi){n.a=c[n.a],n.b=c[n.b],n.c=c[n.c],n.d=c[n.d],s=[n.a,n.b,n.c,n.d];for(var p=-1,m=0;m<4;m++)s[m]==s[(m+1)%4]&&(p>=0&&d.push(r),p=m);if(p>=0){s.splice(p,1);var g=new mi(s[0],s[1],s[2],n.normal,n.color,n.materialIndex);o=this.uvs[r],o&&o.splice(p,1),n.vertexNormals&&n.vertexNormals.length>0&&(g.vertexNormals=n.vertexNormals,g.vertexNormals.splice(p,1)),n.vertexColors&&n.vertexColors.length>0&&(g.vertexColors=n.vertexColors,g.vertexColors.splice(p,1)),this.faces[r]=g}}for(r=d.length-1;r>=0;r--);var y=this.vertices.length-h.length;return this.vertices=h,y},computeVertexNormals:function(t){var i,r,a,n,s,o;if(this.__tmpVertices===e){for(this.__tmpVertices=new Array(this.vertices.length),o=this.__tmpVertices,i=0,r=this.vertices.length;i<r;i++)o[i]=new Je.Vec3;for(a=0,n=this.faces.length;a<n;a++)s=this.faces[a],s.vertexNormals=[new Je.Vec3,new Je.Vec3,new Je.Vec3]}else for(o=this.__tmpVertices,i=0,r=this.vertices.length;i<r;i++)o[i].set(0,0,0);if(t){var l,h,c,u=new Je.Vec3,f=new Je.Vec3;new Je.Vec3,new Je.Vec3,new Je.Vec3;for(a=0,n=this.faces.length;a<n;a++)s=this.faces[a],l=this.vertices[s.a],h=this.vertices[s.b],c=this.vertices[s.c],u.subVectors(c,h),f.subVectors(l,h),u.cross(f),o[s.a].add(u),o[s.b].add(u),o[s.c].add(u),s.d!=e&&o[s.d].add(u)}else for(a=0,n=this.faces.length;a<n;a++)s=this.faces[a],o[s.a].add(s.normal),o[s.b].add(s.normal),o[s.c].add(s.normal);for(i=0,r=this.vertices.length;i<r;i++)o[i].normalize();for(a=0,n=this.faces.length;a<n;a++)s=this.faces[a],s.vertexNormals[0].copy(o[s.a]),s.vertexNormals[1].copy(o[s.b]),s.vertexNormals[2].copy(o[s.c]),s.d!=e&&(s.vertexNormals[3]=o[s.d].clone())},computeCentroids:function(){var t,e,i;for(t=0,e=this.faces.length;t<e;t++)i=this.faces[t],i.centroid=i.centroid||new Ke,null==i.centroid&&console.log("fdasfdsa"),i.centroid.set||(i.centroid=new Ke),i.centroid.set(0,0,0),i instanceof mi?(i.centroid.add(this.vertices[i.a]),i.centroid.add(this.vertices[i.b]),i.centroid.add(this.vertices[i.c]),i.centroid.divideScalar(3)):i instanceof gi&&(i.centroid.add(this.vertices[i.a]),i.centroid.add(this.vertices[i.b]),i.centroid.add(this.vertices[i.c]),i.centroid.add(this.vertices[i.d]),i.centroid.divideScalar(4))},computeFaceNormals:function(){var t,e,i,r,a,n,s=new Ke,o=new Ke;for(t=0,e=this.faces.length;t<e;t++)i=this.faces[t],r=this.vertices[i.a],a=this.vertices[i.b],n=this.vertices[i.c],s.subVectors(n,a),o.subVectors(r,a),s.cross(o),s.normalize(),i.normal.copy||(i.normal=new Ke),i.normal.copy(s)},computeVertex:function(){},computePrimitive:function(){},generalteGroup:function(){},getMatetial:function(){return this.material},computeNodeMaterial:function(t){},cacheNodeMaterial:function(t){},needComputeVertexNormal:function(){return!0},computeNodeData:function(t){if(this.computed===!1){var e=this.generatePrimitiveKey();this._attachId&&(e+="_"+this._attachId);var i=Je.PrimitiveCache.getPrimitive(e),r=!1;if(i)this.primitive&&Je.PrimitiveCache.unUsePrimitive(i),this.computeNodeMaterial(i);else{var a=this.computeData();if(this.needComputeVertexNormal()&&(Je.Node.prototype.mergeVertices.call(a),Je.Node.prototype.computeFaceNormals.call(a),Je.Node.prototype.computeVertexNormals.call(a,!0)),(null==a.uv2s||0==a.uv2s.length)&&(a.uv2s=[],null!=a.uvs&&a.uvs.length>0))for(var n=0;n<a.uvs.length;n++){for(var s=[],o=a.uvs[n],l=0;l<o.length;l++)s.push(o[l].clone());a.uv2s.push(s)}i=new Je.Primitive(a,e),Je.PrimitiveCache.setPrimitive(e,i),this.cacheNodeMaterial(i),r=!0}return Je.PrimitiveCache.usePrimitive(i),this.primitive=i,this.data=i.data,this.vertices=i.vertices,this.faces=i.faces,this.uvs=i.uvs,this.uv2s=i.uv2s,this.computed=!0,r}},computeData:function(){var t={vertices:[],faces:[],uv2s:[],uvs:[]};return this.vertices=t.vertices,this.uvs=t.uvs,this.faces=t.faces,this.data=t,t},setMaterial:function(t,e,i){var r=e.getUniqueCode?e.getUniqueCode():null,a=Ki.getMaterial(r);a?(this.material.materials[t]=a,Ki.useMaterial(a)):(this.material.materials[t]=e,Ki.setMaterial(r,e),Ki.useMaterial(e)),Ki.unUseMaterial(i)},onMaterialMapping:function(){this.groups=e},getMaterialSize:function(){return this.materialSize||1},startBatch:function(){this.batch=!0},endBatch:function(){this.materialMappingChanges!==e&&(this.onSizeChanged(),this.onMaterialMapping(),this.firePropertyChange("materialMapping",this.materialMappingChanges[0],this.materialMappingChanges[1]),this.materialMappingChanges=e),this.batch=!1},compareAndSetMaterial:function(t,e,i){this.setMaterial(i,e,t)},cloneStyle:function(t){if(this.getClassName()!=t.getClassName())return void console.warn("ApplyStyle fail, the source with not the same class");for(var e=this.getMaterialMapping(),i=0;i<this.getMaterialSize();i++){var r=this.material.materials[i],a=t.material.materials[i];this.compareAndSetMaterial(r,a,i)}var n=this.getMaterialMapping();Je.Utils.isSame(e,n)||(this.batch?this.materialMappingChanges=[e,n]:(this.onSizeChanged(),this.onMaterialMapping(),this.firePropertyChange("materialMapping",e,n)))},_considerArray:function(t,e){if(!t.startsWith("envmap.image"))return xi.isArray(e);var i=!1;if(xi.isArray(e))for(var r=0;r<e.length;r++)if(xi.isArray(e[r])){i=!0;break}return i},setMaterialStyles:function(t){var e,i,r,a,n,s,o=this.getMaterialMapping(),o=this.getMaterialMapping();for(var l in t)var h=t[l];for(var c=0;c<this.getMaterialSize();c++){i=this.material.materials[c],r=i.clone();var u=!1;for(var l in t){var f=!1;if(l.startsWith("m."))a=l.substr(l.indexOf(".")+1);else if(this.getSideIndexMapping()&&this.isSideStyle(l)){var d=l.substr(0,l.indexOf(".")),n=this.getSideMaterialIndex(d);if(n!=c)continue;f=!0,s=l.substr(l.indexOf(".")+1),a=s.substr(s.indexOf(".")+1)}var h=t[l];e=h[0],null==e?e=Je.Styles.getStyle(l):this._considerArray(a,e)&&(e=e[c]),this._A97(r,a,e),u=!0}u&&this.compareAndSetMaterial(i,r,c)}this.changeMapping(o)},setMaterialStyle:function(t,e,i){var e,r,a,n,s,o=t;if(t.startsWith("m.")&&(o=t.substr(t.indexOf(".")+1)),null==i&&!Je.Utils.isArray(e)){var l=[];for(c=0;c<this.getMaterialSize();c++)l.push(e);this.styleMap[t]=l,e=l}var h=!1;if(o.startsWith("envmap.image")&&e&&xi.isArray(e))for(var c=0;c<e.length;c++){if(xi.isArray(e[c])){h=!1;break}h=!0}var u=this.getMaterialMapping();if(null!=i||Je.Utils.isArray(e)&&!h){if(Je.Utils.isArray(e)){r=e;for(var c=0;c<this.getMaterialSize();c++)a=r[c],n=this.material.materials[c],s=n.clone(),null==a&&(a=Je.Styles.getStyle(t)),this._A97(s,o,a),this.compareAndSetMaterial(n,s,c)}else if(null!=i){var u=this.getMaterialMapping();n=this.material.materials[i],s=n.clone(),this._A97(s,o,e),this.compareAndSetMaterial(n,s,i),this.synchronizeIndexStyle(t,i,e)}}else for(var f=[],c=0;c<this.getMaterialSize();c++)f[c]!==!0&&(a=e,n=this.material.materials[c],s=n.clone(),null==a&&(a=Je.Styles.getStyle(t)),this._A97(s,o,a),this.compareAndSetMaterial(n,s,c));this.changeMapping(u)},changeMapping:function(t){var e=this.getMaterialMapping();Je.Utils.isSame(t,e)||(this.batch?this.materialMappingChanges=[t,e]:(this.onSizeChanged(),this.onMaterialMapping(),this.firePropertyChange("materialMapping",t,e)))},synchronizeSideStyle:function(t,e,i){var r=this.getMaterialIndexSide(e);r&&null!=this.styleMap[r+"."+t]&&(this.styleMap[r+"."+t]=i)},synchronizeIndexStyle:function(t,e,r){var a=this.styleMap[t];if(null==a&&(a=this.getStyle(t),this.styleMap[t]=a),Je.Utils.isArray(a))a[e]=r;else{var n=[];for(i=0;i<this.getMaterialSize();i++)n.push(a);n[e]=r,this.styleMap[t]=n}},getDefaultMaterial:function(t,e){return t?t instanceof Je.ArrayMaterial?0===t.materials.length?Ki.DefaultMaterial:(e>=t.materials.length&&(e=t.materials.length-1),t.materials[e]):t:Ki.DefaultMaterial},createMaterial:function(t){var e=new Je.ArrayMaterial;this.material=e;for(var i=this.getMaterialSize(),r=0;r<i;r++)this.setMaterial(r,this.getDefaultMaterial(t,r))},onPropertyChange:function(t,e,i){this.changeProperty=t,this.oldGroups=this.groups;var r=this.isSizeChangedProperty(t);r&&this.onSizeChanged(),r&&this.onMaterialMapping(),r&&this.firePropertyChange("materialMapping",0,1)},onSizeChanged:function(){this.computed=!1,this.computeNodeData(),this.computeCentroids(),this.computeFaceNormals(),this.computeBoundingBox(),this.selectionData=null,this.boundingSphere=null,this.changeProperty=null},isSizeChangedProperty:function(t){return this.__SizePropeties.indexOf(t)!==-1||"vertices"==t||"faces"==t||"uvs"==t},isGroupChangedProperty:function(t){},getMaterialMapping:function(){var t={},e=this.material.materials;for(var i in e)t[i]=e.indexOf(e[i]);return t},getSideMaterialIndex:function(t){var e=this.getSideIndexMapping();if(e)return e[t]},getMaterialIndexSide:function(t){var e=this.getIndexSideMapping();if(e)return e[t]},getIndexSideMapping:function(){var t=this.getSideIndexMapping();if(t&&!this.IndexSideMapping){this.IndexSideMapping={};var e,i;for(e in t)i=t[e],this.IndexSideMapping[i]=e}return this.IndexSideMapping},getSideIndexMapping:function(){},disposeMaterial:function(){},getMaterial:function(){return this.material}});var pi=function(t,e,i){this.normal=t instanceof Je.Vec3?t:new Je.Vec3,this.vertexNormals=t instanceof Array?t:[],this.color=e instanceof Je.Color?e:new Je.Color,this.vertexColors=e instanceof Array?e:[],this.materialIndex=i?i:0,this.centroid=new Je.Vec3,this.needVertexNormal=!1};Je.Face=pi,pi.prototype={constructor:Je.Face,subClone:function(){},clone:function(){var t=this.subClone();t.normal.copy(this.normal),t.color.copy(this.color),t.centroid.copy(this.centroid),t.materialIndex=this.materialIndex;var e,i;for(e=0,i=this.vertexNormals.length;e<i;e++)t.vertexNormals.push(this.vertexNormals[e]);for(e=0,i=this.vertexColors.length;e<i;e++)t.vertexColors.push(this.vertexColors[e]);return t}};var mi=function(t,e,i,r,a,n){Je.Face.call(this,r,a,n),this.a=t,this.b=e,this.c=i};Je.Face3=mi,mi.prototype=Object.create(Je.Face.prototype),mi.prototype.constructor=Je.Face3,mi.prototype.subClone=function(){var t=new mi(this.a,this.b,this.c);return t},mi.prototype.vertexCount=3,mi.prototype.serializeJsonValue=function(){return{a:this.a,b:this.b,c:this.c}};var gi=function(t,e,i,r,a,n,s){Je.Face.call(this,a,n,s),this.a=t,this.b=e,this.c=i,this.d=r};Je.Face4=gi,gi.prototype=Object.create(Je.Face.prototype),gi.prototype.constructor=Je.Face4,gi.prototype.subClone=function(){var t=new gi(this.a,this.b,this.c,this.d);return t},gi.prototype.splitToFace3s=function(){var t=new mi(this.a,this.b,this.d,this.normal,this.color,this.materialIndex),e=new mi(this.d,this.b,this.c,this.normal,this.color,this.materialIndex);return[t,e]},gi.prototype.vertexCount=4,gi.prototype.serializeJsonValue=function(){return{a:this.a,b:this.b,c:this.c,d:this.d}},Je.Entity=function(t,i){t instanceof Je.ArrayMaterial?(this.material=t,this.materialSize=this.material.materials.length||1):t instanceof Je.Material?(this.material=t,this.materialSize=1):t&&(this.materialSize=t),this.materialSize=this.materialSize||1,this.createMaterial(this.material),i!=e&&null==this._id&&(this._id=i),Je.Node.call(this,this._id),this.groups=null},Je.extend(Je.Entity,Je.Node,{constructor:Je.Entity,className:"TGL.Entity",__accessor:["computeVertexNormal"],__SizePropeties:["computeVertexNormal"],setUpdateFlags:function(t){this.verticesNeedUpdate=t,this.morphTargetsNeedUpdate=t,this.elementsNeedUpdate=t,this.uvsNeedUpdate=t,this.normalsNeedUpdate=t,this.colorsNeedUpdate=t,this.tangentsNeedUpdate=t,this.buffersNeedUpdate=t},cloneCallback:function(t){t&&"TGL.Entity"===this.className&&(this.computed=!1,this.computeNodeData())},needComputeVertexNormal:function(){return this.computeVertexNormal},computeData:function(){var t={vertices:this.vertices,faces:this.faces,uvs:this.uvs,uv2s:this.uv2s};return t},createCloneObject:function(){return this.constructor===Je.Entity?new Je.Entity(this.materialSize):Je.Element.prototype.createCloneObject.call(this)},getMaterialSize:function(){return this.materialSize},setMaterialSize:function(t){"number"==typeof t&&(this.materialSize=t,this.createMaterial(this.material))}});var yi=function(){var t,e,i,r,a,n,s,o;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(s=arguments[0],t=s.width,e=s.height,i=s.depth,r=s.segmentsW,a=s.segmentsH,n=s.segmentsD,o=s.wrapMode,this._id=s.id):arguments[0]instanceof Je.Material?(this.material=arguments[0],t=arguments[1],e=arguments[2],i=arguments[3],r=arguments[4],a=arguments[5],n=arguments[6],o=arguments[7]):(t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4],n=arguments[5],o=arguments[6]),this.width=t||1,this.height=e||1,this.depth=i||1,this.segmentsW=r||1,this.segmentsH=a||1,this.segmentsD=n||1,this.wrapMode=(o||"").toLowerCase(),this.materialSize=null==this.wrapMode||""==this.wrapMode?6:1,this.offset=new Ke(0,0,0),Je.Entity.call(this)};Je.Cube=yi,Je.extend(Je.Cube,Je.Entity,{__accessor:["width","height","depth","wrapMode"],__SizePropeties:["width","height","depth","wrapMode"],className:"TGL.Cube",getUVs:function(){return this.uvs},setPropertyValue:function(t,e){var i=this[t];if(i===e)return!1;if(this[t]=e,"wrapMode"===t){var r=this.wrapMode,a="six-each"==r||"front-other"==r||"back-other"==r||"left-other"==r||"right-other"==r||"top-other"==r||"bottom-other"==r;this.materialSize=null==this.wrapMode||""==this.wrapMode?6:1,a||(this[t]="")}return!0},getLinkOffset:function(t){t.length();t.normalize();var e=t.x/this.getWidth(),i=t.y/this.getHeight(),r=t.z/this.getDepth(),a=Math.max(Math.abs(e),Math.abs(i),Math.abs(r));return a==Math.abs(e)?new Ke(this.getWidth()/2*(e<0?-1:1),0,0):a==Math.abs(i)?new Ke(0,this.getHeight()/2*(i<0?-1:1),0):new Ke(0,0,this.getDepth()/2*(r<0?-1:1))},getLinkExtend:function(t){var e=this.worldMatrix.clone();return e=(new mono.Mat4).extractRotation(e),this.getLinkOffset(t.applyMatrix4((new ti).getInverse(e)))},computeData:function(){var t=si.buildCubeData(this.width,this.height,this.depth,this.segmentsW,this.segmentsH,this.segmentsD,this.wrapMode,this.offset||new Ke(0,0,0));return this.vertices=t.vertices,this.uvs=t.uvs,this.faces=t.faces,this.data=t,t},getSideIndexMapping:function(){return this.wrapMap?null:Je.Cube.SideIndexMapping},generatePrimitiveKey:function(){return"cube_"+this.width+"_"+this.height+"_"+this.depth+"_"+this.segmentsW+"_"+this.segmentsH+"_"+this.segmentsD+"_"+(this.material instanceof Je.ArrayMaterial?1:0)+"_"+this.wrapMode+"_"+this.offset.x+"_"+this.offset.y+"_ "+this.offset.z+"_"+Je.Utils.toString(this.getMaterialMapping())},serialize:function(t){var e=t;1!==this.width&&e.serializeSimple("p","width",this.width,"number"),1!==this.height&&e.serializeSimple("p","height",this.height,"number"),1!==this.depth&&e.serializeSimple("p","depth",this.depth,"number"),1!==this.widthSegemtns&&e.serializeSimple("p","widthSegemtns",this.widthSegemtns,"number"),1!==this.heightSegments&&e.serializeSimple("p","heightSegments",this.heightSegments,"number"),1!==this.depthSegments&&e.serializeSimple("p","depthSegments",this.depthSegments,"number"),Je.Element.serialize.call(this,e)}}),yi.SideIndexMapping={right:0,left:1,top:2,bottom:3,front:4,back:5},Je.Sphere=function(){var t,i,r,a,n,s,o;if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var l=arguments[0];t=l.radius,i=l.segmentsW,r=l.segmentsH,a=l.longitudeStart,n=l.longitudeLength,s=l.latitudeStart,this._id=l.id}else arguments[0]instanceof Je.Material?(this.material=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4],n=arguments[5],s=arguments[6],o=arguments[7]):(t=arguments[0],i=arguments[1],r=arguments[2],a=arguments[3],n=arguments[4],s=arguments[5],o=arguments[6]);this.radius=t||50,this.segmentsW=Math.max(3,Math.floor(i)||22),this.segmentsH=Math.max(2,Math.floor(r)||15),this.longitudeStart=a!==e?a:0,this.longitudeLength=n!==e?n:2*Math.PI,this.latitudeStart=s!==e?s:0,this.latitudeLength=o!==e?o:Math.PI,this.materialSize=1,Je.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},Je.extend(Je.Sphere,Je.Entity,{constructor:Je.Sphere,__accessor:["radius","segmentsW","segmentsH","latitudeStart","latitudeLength","longitudeStart","longitudeLength"],__SizePropeties:["radius","segmentsW","segmentsH","latitudeStart","latitudeLength","longitudeStart","longitudeLength"],className:"TGL.Sphere",computeData:function(){var t=si.bsd(this.radius,this.segmentsW,this.segmentsH,this.longitudeStart,this.longitudeLength,this.latitudeStart,this.latitudeLength);return this.vertices=t.vertices,this.uvs=t.uvs,this.faces=t.faces,this.data=t,t},setWidthSegments:function(t){console.log("TGL.Sphere.setWidthSegments has deprecated,please use setSegmentsW"),this.setSegmentsW(t)},setHeightSegments:function(t){console.log("TGL.Sphere.setHeightSegments has deprecated,please use setSegmentsW"),this.setSegmentsH(t)},generatePrimitiveKey:function(){return"sphere_"+this.radius+"_"+this.segmentsW+"_"+this.segmentsH+"_"+this.longitudeStart+"_"+this.longitudeLength+"_"+this.latitudeStart+"_"+this.latitudeLength},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Je.BoundingSphere(new Je.Vec3,this.radius))},getLinkOffset:function(t){t.length();return t.normalize(),t.multiplyScalar(this.radius)},serialize:function(t){var e=t;50!==this.radius&&e.serializeSimple(qi,"radius",this.radius,"number"),24!==this.widthSegments&&e.serializeSimple(qi,"widthSegments",this.widthSegments,"number"),18!==this.heightSegments&&e.serializeSimple(qi,"heightSegments",this.heightSegments,"number"),0!==this.phiStart&&e.serializeSimple(qi,"phiStart",this.phiStart,"number"),this.phiLength!==2*Math.PI&&e.serializeSimple(qi,"phiLength",this.phiLength,"number"),0!==this.thetaStart&&e.serializeSimple(qi,"thetaStart",this.thetaStart,"number"),this.thetaLength!==Math.PI&&e.serializeSimple(qi,"thetaLength",this.thetaLength,"number")}}),Je.Plane=function(){var t,e,i,r;arguments[0]instanceof Je.Material?(this.material=arguments[0],t=arguments[1],e=arguments[2],i=arguments[3],r=arguments[4]):(t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3]),this.width=t||5,this.height=e||5,this.segmentsW=i||1,this.segmentsH=r||1,this.vertices=[],this.faces=[],this.uvs=[],this.uv2s=[],this.materialSize=1,this.computeData=function(){var t,e,i=this.width/2,r=this.height/2,a=this.segmentsW,n=this.segmentsH,s=a+1,o=n+1,l=this.width/a,h=this.height/n,c=new Je.Vec3(0,0,1),u={vertices:[],faces:[],uvs:[]};for(e=0;e<o;e++)for(t=0;t<s;t++){var f=t*l-i,d=e*h-r;u.vertices.push(new Je.Vec3(f,(-d),0))}for(e=0;e<n;e++)for(t=0;t<a;t++){var p=t+s*e,m=t+s*(e+1),g=t+1+s*(e+1),y=t+1+s*e,v=new Je.Vec2(t/a,1-e/n),x=new Je.Vec2(t/a,1-(e+1)/n),w=new Je.Vec2((t+1)/a,1-(e+1)/n),_=new Je.Vec2((t+1)/a,1-e/n),b=new Je.Face4(p,m,g,y);b.normal.copy(c),b.vertexNormals.push(c.clone(),c.clone(),c.clone(),c.clone()),u.faces.push(b),u.uvs.push([v,x,w,_])}return u},Je.Entity.call(this),this.computeCentroids()},Je.extend(Je.Plane,Je.Entity,{constructor:Je.Plane,className:"TGL.Plane",__accessor:["width","height","segmentsW","segmentsH"],__SizePropeties:["width","height","segmentsW","segmentsH"],clone:function(){var t=new Je.Plane(this.material,this.width,this.height,this.segmentsW,this.segmentsH);return this.superClass.clone.call(this,t),t},getSelectStyle:function(){var t=this.getStyle("select.style");return"outline.normal"!=t&&"outline"!=t||(t="outline.wireframe"),t}}),Je.Cylinder=function(){var t,i,r,a,n,s,o,l,h;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(options=arguments[0],t=options.radiusTop,i=options.radiusBottom,r=options.height,a=options.segmentsR,n=options.segmentsH,s=options.openTop,o=options.openBottom,l=options.arcLength,h=options.arcStart,this._id=options.id):arguments[0]instanceof Je.Material?(this.material=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4],n=arguments[5],s=arguments[6],o=arguments[7],l=arguments[8],h=arguments[9]):(t=arguments[0],i=arguments[1],r=arguments[2],a=arguments[3],n=arguments[4],s=arguments[5],o=arguments[6],l=arguments[7],h=arguments[8]),this.radiusTop=t=t!==e?t:20,this.radiusBottom=i=i!==e?i:20,this.height=r=r!==e?r:100,this.segmentsR=a=a||20,this.segmentsH=n=n||1,this.openTop=s!==e&&s,this.openBottom=o!=e&&o,this.arcLength=l!==e?l:2*Math.PI,this.arcStart=h!==e?h:0,this.materialSize=3,Je.Entity.call(this),this.computeNodeData(),this.computeCentroids(),this.computeFaceNormals()},Je.extend(Je.Cylinder,Je.Entity,{constructor:Je.Cylinder,__accessor:["radiusTop","radiusBottom","height","segmentsR","segmentsH","openTop","openBottom","arcLength","arcStart"],__bool:["openTop","openBottom"],__SizePropeties:["radiusTop","radiusBottom","height","segmentsR","segmentsH","openTop","openBottom","arcLength","arcStart"],className:"TGL.Cylinder",computeData:function(){return si.bcld(this.height,this.segmentsH,this.radiusBottom,this.radiusTop,this.segmentsR,this.openTop,this.openBottom,this.arcLength,this.arcStart)},getLinkOffset:function(t){var e=t.length();t.normalize();var i=t.x,r=t.y,a=t.z,n=Math.sqrt(i*i+a*a),s=r>0?this.radiusTop:this.radiusBottom;if(Math.abs(r/n)>this.height/2/s&&e>0){var o=new Ke(0,this.height/2*(r>0?1:-1),0);return o}return new Ke(i,0,a).normalize().multiplyScalar((this.radiusTop+this.radiusBottom)/2)},getLinkExtend:function(t){var e=this.worldMatrix.clone();return e=(new mono.Mat4).extractRotation(e),this.getLinkOffset(t.applyMatrix4((new ti).getInverse(e)))},clearLinkOrthogonal:function(t,e,i,r){r=r||0;var a=this.getHeight()/2+r,n=(this.radiusTop+this.radiusBottom)/2+r;return"orthogonal.x"==i||"orthogonal.x.n"==i?!(Math.abs(t.y-e.y)>a||Math.abs(t.z-e.z)>n):"orthogonal.y"==i||"orthogonal.y.n"==i?!(Math.abs(t.x-e.x)>n||Math.abs(t.z-e.z)>n):("orthogonal.z"==i||"orthogonal.z.n"==i)&&!(Math.abs(t.y-e.y)>a||Math.abs(t.z-e.z)>n)},clearLinkExtend:function(t,e){return"extend.x"!==e&&"extend.y"===e&&t>this.getHeight()/2},getSideIndexMapping:function(){return Je.Cylinder.SideIndexMapping},generatePrimitiveKey:function(){return"cylinder_"+this.height+"_"+this.segmentsH+"_"+this.radiusTop+"_"+this.radiusBottom+"_"+this.segmentsR+"_"+this.openTop+"_"+this.openBottom+"_"+this.arcLength+"_"+this.arcStart+Je.Utils.toString(this.getMaterialMapping())},needComputeVertexNormal:function(){return!1}}),Je.Cylinder.SideIndexMapping={side:0,top:1,bottom:2},Je.Circle=function(){var t,i,r,a;4===arguments.length?(t=arguments[0],i=arguments[1],r=arguments[2],a=arguments[3]):(this.material=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4]),this.radius=t=t||50,this.segments=i=i!==e?Math.max(3,i):8,this.thetaStart=r=r!==e?r:0,this.thetaLength=a=a!==e?a:2*Math.PI,this.materialSize=1,Je.Entity.call(this),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new Je.BoundingSphere(new Je.Vec3,t)},Je.extend(Je.Circle,Je.Entity,{clone:function(){var t=new Je.Circle(this.material,this.radius,this.segments,this.thetaStart,this.thetaLength);return this.constructor.superClass.clone.call(this,t),t},computeData:function(){var t,e=this.segments,i=[],r=new Je.Vec3,a=new Je.Vec2(.5,.5),n={vertices:[],faces:[],uvs:[],uv2s:[]};for(n.vertices.push(r),i.push(a),t=0;t<=e;t++){var s=new Je.Vec3,o=this.thetaStart+t/e*this.thetaLength;s.x=this.radius*Math.cos(o),s.y=this.radius*Math.sin(o),n.vertices.push(s),i.push(new Je.Vec2((s.x/this.radius+1)/2,(s.y/this.radius+1)/2))}var l=new Je.Vec3(0,0,1);for(t=1;t<=e;t++){var h=t,c=t+1,u=0;n.faces.push(new Je.Face3(h,c,u,[l,l,l])),n.uvs.push([i[t],i[t+1],a])}return n}}),Je.Torus=function(){var t,e,i,r,a;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(options=arguments[0],t=options.radius,e=options.tube,i=options.segmentsR,r=options.segmentsT,a=options.arc,this._id=options.id):arguments[0]instanceof Je.Material?(this.material=arguments[0],t=arguments[1],e=arguments[2],i=arguments[3],r=arguments[4],a=arguments[5]):(t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4]),this.materialSize=1,this.radius=t||100,this.tube=e||40,this.segmentsR=i||8,this.segmentsT=r||6,this.arc=a||2*Math.PI,Je.Entity.call(this),this.computeNodeData(),this.computeCentroids()},Je.extend(Je.Torus,Je.Entity,{__accessor:["radius","tube","segmentsR","segmentsT","arc"],__SizePropeties:["radius","tube","segmentsR","segmentsT","arc"],className:"TGL.Torus",generatePrimitiveKey:function(){return"torus_"+this.radius+"_"+this.tube+"_"+this.segmentsR+"_"+this.segmentsT+"_"+this.arc},computeData:function(){for(var t=new Je.Vec3,e=[],i=[],r={vertices:[],faces:[],uvs:[],uv2s:[]},a=0;a<=this.segmentsR;a++)for(var n=0;n<=this.segmentsT;n++){var s=n/this.segmentsT*this.arc,o=a/this.segmentsR*Math.PI*2;t.x=this.radius*Math.cos(s),t.y=this.radius*Math.sin(s);var l=new Je.Vec3;l.x=(this.radius+this.tube*Math.cos(o))*Math.cos(s),l.y=(this.radius+this.tube*Math.cos(o))*Math.sin(s),l.z=this.tube*Math.sin(o),r.vertices.push(l),e.push(new Je.Vec2(n/this.segmentsT,a/this.segmentsR)),i.push(l.clone().sub(t).normalize())}for(var a=1;a<=this.segmentsR;a++)for(var n=1;n<=this.segmentsT;n++){var h=(this.segmentsT+1)*a+n-1,c=(this.segmentsT+1)*(a-1)+n-1,u=(this.segmentsT+1)*(a-1)+n,f=(this.segmentsT+1)*a+n,d=new Je.Face3(h,c,f,[i[h],i[c],i[f]]);d.normal.add(i[h]),d.normal.add(i[c]),d.normal.add(i[f]),d.normal.normalize(),r.faces.push(d),r.uvs.push([e[h].clone(),e[c].clone(),e[f].clone()]),d=new Je.Face3(c,u,f,[i[c],i[u],i[f]]),d.normal.add(i[c]),d.normal.add(i[u]),d.normal.add(i[f]),d.normal.normalize(),r.faces.push(d),r.uvs.push([e[c].clone(),e[u].clone(),e[f].clone()])}return r}}),Je.Arrow=function(){var t,e,i,r,a;arguments[0]instanceof Je.Material?(this.material=arguments[0],t=arguments[1],e=arguments[2],i=arguments[3],r=arguments[4],a=arguments[5]):(t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4]),this.materialSize=1,this.tailHeight=t||100,this.tailRadius=e||20,this.headHeight=i||20,this.headRadius=r||30,this.radiusSegments=a||30,this.computeData=function(){var n=2;this.headRadius<this.tailRadius&&(this.headRadius=this.tailRadius);var s,o,l=t+i,h=l/2,c=[],u=[],f=[],d=[];for(o=0;o<=n;o++){var p=[],m=[],g=o/n,y=g*r;for(s=0;s<=a;s++){var v=s/a,x=new Je.Vec3;x.x=y*Math.sin(v*Math.PI*2),x.y=-g*i+h,x.z=y*Math.cos(v*Math.PI*2),this.vertices.push(x),p.push(this.vertices.length-1),m.push(new Je.Vec2(v,1-g))}c.push(p),f.push(m)}for(this.vertices.push(new Je.Vec3(0,h-i,0)),o=0;o<=n;o++){var p=[],m=[],g=o/n,y=e;for(s=0;s<=a;s++){var v=s/a,x=new Je.Vec3;x.x=y*Math.sin(v*Math.PI*2),x.y=-g*t+h-i,x.z=y*Math.cos(v*Math.PI*2),this.vertices.push(x),p.push(this.vertices.length-1),m.push(new Je.Vec2(v,1-g))}u.push(p),d.push(m)}this.vertices.push(new Je.Vec3(0,(-h),0));var w,_,b=this.headRadius/l;for(s=0;s<a;s++)for(w=this.vertices[c[0][s]].clone(),_=this.vertices[c[0][s+1]].clone(),w.setY(Math.sqrt(w.x*w.x+w.z*w.z)*b).normalize(),_.setY(Math.sqrt(_.x*_.x+_.z*_.z)*b).normalize(),o=0;o<n;o++){var M=c[o][s],S=c[o+1][s],A=c[o+1][s+1],P=c[o][s+1],T=w.clone(),C=w.clone(),z=_.clone(),L=_.clone(),E=f[o][s].clone(),D=f[o+1][s].clone(),N=f[o+1][s+1].clone(),B=f[o][s+1].clone();this.faces.push(new Je.Face3(M,S,P,[T,C,L])),this.uvs.push([E,D,B]),this.faces.push(new Je.Face3(S,A,P,[C,z,L])),this.uvs.push([D,N,B])}for(s=0;s<a;s++){var M=c[o][s+1],S=c[o][s],A=c.length-1,T=new Je.Vec3(0,(-1),0),C=new Je.Vec3(0,(-1),0),z=new Je.Vec3(0,(-1),0),E=f[o][s+1].clone(),D=f[o][s].clone(),N=new Je.Vec2(D.u,1);this.faces.push(new Je.Face3(M,S,A,[T,C,z])),
this.uvs.push([E,D,N])}var w,_,b=0;for(s=0;s<a;s++)for(w=this.vertices[u[1][s]].clone(),_=this.vertices[u[1][s+1]].clone(),w.setY(Math.sqrt(w.x*w.x+w.z*w.z)*b).normalize(),_.setY(Math.sqrt(_.x*_.x+_.z*_.z)*b).normalize(),o=0;o<n;o++){var M=u[o][s],S=u[o+1][s],A=u[o+1][s+1],P=u[o][s+1],T=w.clone(),C=w.clone(),z=_.clone(),L=_.clone(),E=f[o][s].clone(),D=f[o+1][s].clone(),N=f[o+1][s+1].clone(),B=f[o][s+1].clone();this.faces.push(new Je.Face3(M,S,P,[T,C,L])),this.uvs.push([E,D,B]),this.faces.push(new Je.Face3(S,A,P,[C,z,L])),this.uvs.push([D,N,B])}for(s=0;s<a;s++){var M=u[o][s+1],S=u[o][s],A=u.length-1,T=new Je.Vec3(0,(-1),0),C=new Je.Vec3(0,(-1),0),z=new Je.Vec3(0,(-1),0),E=d[o][s+1].clone(),D=d[o][s].clone(),N=new Je.Vec2(D.u,1);this.faces.push(new Je.Face3(M,S,A,[T,C,z])),this.uvs.push([E,D,N])}return this},Je.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},Je.extend(Je.Arrow,Je.Entity,{}),Je.BufferNode=function(){this.uuid=Je.Math.generateUUID(),this.name="",this.attributes={},this.dynamic=!0,this.offsets=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.morphTargets=[],this.materialSize=1,this.createMaterial(),Je.Node.call(this)},Je.extend(Je.BufferNode,Je.Node,{constructor:Je.BufferNode,compuateBufferData:function(){if(!this.computed){var t=this.attributes.position;t&&t.array&&(t.itemSize=3,t.numItems=t.array.length,this.verticesNeedUpdate=!0);var e=this.attributes.uv;e&&e.array&&(e.itemSize=2,e.numItems=e.array.length,this.uvsNeedUpdate=!0);var i=this.attributes.index;i&&i.array&&(this.offsets=[{index:0,start:0,count:i.array.length}]),this.computed=!0}},applyMatrix:function(t){var i,r;if(this.attributes.position&&(i=this.attributes.position.array),this.attributes.normal&&(r=this.attributes.normal.array),i!==e&&(t.multiplyVec3Array(i),this.verticesNeedUpdate=!0),r!==e){var a=(new Je.Matrix3).getNormalMatrix(t);a.multiplyVec3Array(r),this.normalizeNormals(),this.normalsNeedUpdate=!0}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Je.BoundingBox);var t=this.attributes.position.array;if(t){var i,r,a,n=this.boundingBox;t.length>=3&&(n.min.x=n.max.x=t[0],n.min.y=n.max.y=t[1],n.min.z=n.max.z=t[2]);for(var s=3,o=t.length;s<o;s+=3)i=t[s],r=t[s+1],a=t[s+2],i<n.min.x?n.min.x=i:i>n.max.x&&(n.max.x=i),r<n.min.y?n.min.y=r:r>n.max.y&&(n.max.y=r),a<n.min.z?n.min.z=a:a>n.max.z&&(n.max.z=a)}t!==e&&0!==t.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){var t=new Je.BoundingBox,e=new Je.Vec3;return function(){null===this.boundingSphere&&(this.boundingSphere=new Je.BoundingSphere);var i=this.attributes.position.array;if(i){for(var r=this.boundingSphere.center,a=[],n=0,s=i.length;n<s;n+=3)e.set(i[n],i[n+1],i[n+2]),a.push(e);t.setFromPoints(a),t.center(r);for(var o=0,n=0,s=i.length;n<s;n+=3)e.set(i[n],i[n+1],i[n+2]),o=Math.max(o,r.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(o)}}}(),computeVertexNormals:function(){if(this.attributes.position){var t,i,r,a,n=this.attributes.position.array.length;if(this.attributes.normal===e)this.attributes.normal={itemSize:3,array:new Float32Array(n)};else for(t=0,i=this.attributes.normal.array.length;t<i;t++)this.attributes.normal.array[t]=0;var s,o,l,h,c,u,f=this.attributes.position.array,d=this.attributes.normal.array,p=new Je.Vec3,m=new Je.Vec3,g=new Je.Vec3,y=new Je.Vec3,v=new Je.Vec3;if(this.attributes.index){var x=this.attributes.index.array,w=this.offsets;for(r=0,a=w.length;r<a;++r){var _=w[r].start,b=w[r].count,M=w[r].index;for(t=_,i=_+b;t<i;t+=3)s=M+x[t],o=M+x[t+1],l=M+x[t+2],h=f[3*s],c=f[3*s+1],u=f[3*s+2],p.set(h,c,u),h=f[3*o],c=f[3*o+1],u=f[3*o+2],m.set(h,c,u),h=f[3*l],c=f[3*l+1],u=f[3*l+2],g.set(h,c,u),y.subVectors(g,m),v.subVectors(p,m),y.cross(v),d[3*s]+=y.x,d[3*s+1]+=y.y,d[3*s+2]+=y.z,d[3*o]+=y.x,d[3*o+1]+=y.y,d[3*o+2]+=y.z,d[3*l]+=y.x,d[3*l+1]+=y.y,d[3*l+2]+=y.z}}else for(t=0,i=f.length;t<i;t+=9)h=f[t],c=f[t+1],u=f[t+2],p.set(h,c,u),h=f[t+3],c=f[t+4],u=f[t+5],m.set(h,c,u),h=f[t+6],c=f[t+7],u=f[t+8],g.set(h,c,u),y.subVectors(g,m),v.subVectors(p,m),y.cross(v),d[t]=y.x,d[t+1]=y.y,d[t+2]=y.z,d[t+3]=y.x,d[t+4]=y.y,d[t+5]=y.z,d[t+6]=y.x,d[t+7]=y.y,d[t+8]=y.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var t,e,i,r,a=this.attributes.normal.array,n=0,s=a.length;n<s;n+=3)t=a[n],e=a[n+1],i=a[n+2],r=1/Math.sqrt(t*t+e*e+i*i),a[n]*=r,a[n+1]*=r,a[n+2]*=r},computeTangents:function(){function t(t,e,i){d=a[3*t],p=a[3*t+1],m=a[3*t+2],g=a[3*e],y=a[3*e+1],v=a[3*e+2],x=a[3*i],w=a[3*i+1],_=a[3*i+2],b=s[2*t],M=s[2*t+1],S=s[2*e],A=s[2*e+1],P=s[2*i],T=s[2*i+1],C=g-d,z=x-d,L=y-p,E=w-p,D=v-m,N=_-m,B=S-b,R=P-b,F=A-M,I=T-M,k=1/(B*I-R*F),W.set((I*C-F*z)*k,(I*L-F*E)*k,(I*D-F*N)*k),Y.set((B*z-R*C)*k,(B*E-R*L)*k,(B*N-R*D)*k),c[t].add(W),c[e].add(W),c[i].add(W),u[t].add(Y),u[e].add(Y),u[i].add(Y)}function i(t){rt.x=n[3*t],rt.y=n[3*t+1],rt.z=n[3*t+2],at.copy(rt),$=c[t],et.copy($),et.sub(rt.multiplyScalar(rt.dot($))).normalize(),it.crossVectors(at,$),tt=it.dot(u[t]),K=tt<0?-1:1,h[4*t]=et.x,h[4*t+1]=et.y,h[4*t+2]=et.z,h[4*t+3]=K}if(this.attributes.index===e||this.attributes.position===e||this.attributes.normal===e||this.attributes.uv===e)return void console.warn("Missing required attributes (index, position, normal or uv) in BufferNode.computeTangents()");var r=this.attributes.index.array,a=this.attributes.position.array,n=this.attributes.normal.array,s=this.attributes.uv.array,o=a.length/3;if(this.attributes.tangent===e){var l=4*o;this.attributes.tangent={itemSize:4,array:new Float32Array(l)}}for(var h=this.attributes.tangent.array,c=[],u=[],f=0;f<o;f++)c[f]=new Je.Vec3,u[f]=new Je.Vec3;var d,p,m,g,y,v,x,w,_,b,M,S,A,P,T,C,z,L,E,D,N,B,R,F,I,k,V,O,U,G,H,j,X,W=new Je.Vec3,Y=new Je.Vec3,q=this.offsets;for(U=0,G=q.length;U<G;++U){var Z=q[U].start,J=q[U].count,Q=q[U].index;for(V=Z,O=Z+J;V<O;V+=3)H=Q+r[V],j=Q+r[V+1],X=Q+r[V+2],t(H,j,X)}var K,$,tt,et=new Je.Vec3,it=new Je.Vec3,rt=new Je.Vec3,at=new Je.Vec3;for(U=0,G=q.length;U<G;++U){var Z=q[U].start,J=q[U].count,Q=q[U].index;for(V=Z,O=Z+J;V<O;V+=3)H=Q+r[V],j=Q+r[V+1],X=Q+r[V+2],i(H),i(j),i(X)}this.hasTangents=!0,this.tangentsNeedUpdate=!0},clone:function(){var t=new Je.BufferNode,e=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var i in this.attributes){for(var r=this.attributes[i],a=r.array,n={itemSize:r.itemSize,numItems:r.numItems,array:null},s=0,o=e.length;s<o;s++){var l=e[s];if(a instanceof l){n.array=new l(a);break}}t.attributes[i]=n}for(var s=0,o=this.offsets.length;s<o;s++){var h=this.offsets[s];t.offsets.push({start:h.start,index:h.index,count:h.count})}return t},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Je.Particle=function(t,e,i){var r;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])&&(r=arguments[0],this._id=r.id),Je.Node.call(this,this._id),this.material=new Je.ParticleMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.frustumCulled=!1,this.vertices=(r?r.vertices:t)||[],this.colors=(r?r.colors:e)||[],this.sizes=(r?r.sizes:i)||[],this.setUpdateFlags(!0)},Je.extend(Je.Particle,Je.Node,{clone:function(t){return t===e&&(t=new Je.Particle(this.material)),t.sortParticles=this.sortParticles,t.frustumCulled=this.frustumCulled,Je.Element.prototype.clone.call(this,t),t},needUpdate:function(){return!1},setUpdateFlags:function(t){this.verticesNeedUpdate=t,this.dirtyColors=t,this.normalsNeedUpdate=t},setMaterialStyle:function(t,e){t=t.substr(t.indexOf(".")+1),this._A97(this.material,t,e)}}),Je.Line=function(){var t,i,r;if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var a=arguments[0];t=a.vertices,i=a.colors,r=a.type,this._id=a.id||this._id}else t=arguments[0],i=arguments[1],r=arguments[2];Je.Node.call(this,this._id),this.material=new Je.LineMaterial({color:16777215}),this.type=r!==e?r:Je.LineStrip,this.vertices=t||[],this.colors=i||[]},Je.LineStrip=0,Je.LinePieces=1,Je.extend(Je.Line,Je.Node,{className:"TGL.Line",__accessor:["vertices","type"],__SizePropeties:["vertices","type"],clone:function(t){return t===e&&(t=new Je.Line(this.material,this.type)),Je.Element.prototype.clone.call(this,t,!0),t},onPropertyChange:function(){},setMaterialStyle:function(t,e){t=t.substr(t.indexOf(".")+1),this._A97(this.material,t,e)},setMaterialStyles:function(t){Je.Element.prototype.setMaterialStyles.call(this,t)}}),Je.Line.createEllipse=function(t,e,i,r,a,n,s){"number"==typeof t?(s=n,n=a,a=r,r=i,i=e,e=t,t=new Je.Line):null==t&&(t=new Je.Line);for(var o=new Je.EllipseCurve(0,0,e,i,a,n,s),l=[],h=r||50,c=0;c<=h;c++){var u=o.getPoint(c/h);l.push(u)}return t.setVertices(l),t},Je.Line.createHelix=function(t,e,i,r,a,n){"number"==typeof t?(n=a,a=r,r=i,i=e,e=t,t=new Je.Line):null==t&&(t=new Je.Line);var s=[],o=n||50;a=a||1;for(var l,h,c,u,f=0;f<=o;f++)l=(i*f+e*(o-f))/o,c=a*Math.PI*2*f/o,h=r*(.5-f/o),u=new Ke(l*Math.sin(c),h,l*Math.cos(c)),s.push(u);return t.setVertices(s),t},Je.Line.createRectangle=function(t,e,i,r){"number"==typeof t?(r=i,i=e,e=t,t=new Je.Line):null==t&&(t=new Je.Line);var a=r||50,n=2*(e+i)/a,s=[];if(n>Math.min(e,i))s.push(new Ke(-e/2,-i/2,0)),s.push(new Ke(-e/2,i/2,0)),s.push(new Ke(e/2,i/2,0)),s.push(new Ke(e/2,-i/2,0)),s.push(new Ke(-e/2,-i/2,0));else for(var o,l=-e/2,h=-i/2,c=0;c<=a;c++)l==-e/2&&h<i/2?h+n<=i/2?h+=n:(s.push(new Ke(-e/2,i/2,0)),s.push(new Ke(-e/2,i/2,0)),l+=h+n-i/2,h=i/2):h==i/2&&l<=e/2?l+n<=e/2?l+=n:(s.push(new Ke(e/2,i/2,0)),s.push(new Ke(e/2,i/2,0)),h-=l+n-e/2,l=e/2):l==e/2&&h>-i/2?h-n>=-i/2?h-=n:(s.push(new Ke(e/2,-i/2,0)),s.push(new Ke(e/2,-i/2,0)),l-=-i/2-h+n,h=-i/2):h==-i/2&&l>=-e/2&&(l-n>=-e/2?l-=n:(h+=-e/2-l+n,l=-e/2)),o=new Ke(l,h,0),s.push(o);return t.setVertices(s),t},Je.PathLine=function(){var t,e,i;if(1===arguments.length&&arguments[0]instanceof Object&&!(arguments[0]instanceof Je.Path)){var r=arguments[0];t=r.path,e=r.segments,i=r.type,this._id=r.id||this._id}else t=arguments[0],e=arguments[1],i=arguments[2],this._id=arguments[3];Je.Line.call(this,{vertices:[],colors:[],type:i,id:this._id}),this.segments=e||20,this.setPath(t)},Je.extend(Je.PathLine,Je.Line,{constructor:Je.PathLine,className:"TGL.PathLine",__accessor:["path","segments"],__SizePropeties:["path","segments"],onPropertyChange:function(){this.computeNodeData()},computeNodeData:function(){this.computeData()},adjustPath:function(t){return t},computeData:function(){var t=this.path;if(t){t=this.adjustPath(t);var e,i,r,a,n=t.curves.length,s=t.curves,o=[],l=t.getLength(),h=0,c=this.segments;for(m=0;m<n;m++){if(i=s[m],r=i.getLength(),i instanceof Je.LineCurve3){var u=h/l,f=(r+h)/l;o.push(u),o.push(f)}else for(a=m>0?1:0;a<=c;a++){var d=(r*a/c+h)/l;o.push(d)}h+=r}for(var p=[],m=0;m<o.length;m++)e=o[m],pos=t.getPointAt(e),p.push(pos);return this.vertices=p,[]}}}),Je.Polyhedron=function(){function t(t){var e=t.normalize().clone();e.index=c.vertices.push(e)-1;var i=r(t)/2/Math.PI+.5,n=a(t)/Math.PI+.5;return e.uv=new Je.Vec3(i,1-n),e}function e(t,e,i){var a=new Je.Face3(t.index,e.index,i.index,[t.clone(),e.clone(),i.clone()]);a.centroid.add(t).add(e).add(i).divideScalar(3),c.faces.push(a);var s=r(a.centroid);c.uvs.push([n(t.uv,t,s),n(e.uv,e,s),n(i.uv,i,s)])}function i(i,r){for(var a=Math.pow(2,r),n=(Math.pow(4,r),t(c.vertices[i.a])),s=t(c.vertices[i.b]),o=t(c.vertices[i.c]),l=[],h=0;h<=a;h++){l[h]=[];for(var u=t(n.clone().lerp(o,h/a)),f=t(s.clone().lerp(o,h/a)),d=a-h,p=0;p<=d;p++)0==p&&h==a?l[h][p]=u:l[h][p]=t(u.clone().lerp(f,p/d))}for(var h=0;h<a;h++)for(var p=0;p<2*(a-h)-1;p++){var m=Math.floor(p/2);p%2==0?e(l[h][m+1],l[h+1][m],l[h][m]):e(l[h][m+1],l[h+1][m+1],l[h+1][m])}}function r(t){return Math.atan2(t.z,-t.x)}function a(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}function n(t,e,i){return i<0&&1===t.x&&(t=new Je.Vec3(t.x-1,t.y)),0===e.x&&0===e.z&&(t=new Je.Vec3(i/2/Math.PI+.5,t.y)),t.clone()}var s,o,l,h;arguments[0]instanceof Je.Material?(this.material=arguments[0],s=arguments[1],o=arguments[2],l=arguments[3],h=arguments[4]):(s=arguments[0],o=arguments[1],l=arguments[2],h=arguments[3]),this.materialSize=1,Je.Entity.call(this),l=l||1,h=h||0;for(var c=this,u=0,f=s.length;u<f;u++)t(new Je.Vec3(s[u][0],s[u][1],s[u][2]));for(var d=this.vertices,p=[],u=0,f=o.length;u<f;u++){var m=d[o[u][0]],g=d[o[u][1]],y=d[o[u][2]];p[u]=new Je.Face3(m.index,g.index,y.index,[m.clone(),g.clone(),y.clone()])}for(var u=0,f=p.length;u<f;u++)i(p[u],h);for(var u=0,f=this.uvs.length;u<f;u++){var v=this.uvs[u],x=v[0].x,w=v[1].x,_=v[2].x,b=Math.max(x,Math.max(w,_)),M=Math.min(x,Math.min(w,_));b>.9&&M<.1&&(x<.2&&(v[0].x+=1),w<.2&&(v[1].x+=1),_<.2&&(v[2].x+=1))}for(var u=0,f=this.vertices.length;u<f;u++)this.vertices[u].multiplyScalar(l);this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new Je.BoundingSphere(new Je.Vec3,l)},Je.extend(Je.Polyhedron,Je.Entity,{}),Je.Octahedron=function(t,e,i){var r=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],a=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];Je.Polyhedron.call(this,t,r,a,e,i)},Je.extend(Je.Octahedron,Je.Polyhedron,{clone:function(){return new Je.Octahedron(this.material,this.radius,this.detail)}}),Je.Axis=function(t){t=t||1;var e=[],i=[];e.push(new Je.Vec3,new Je.Vec3(t,0,0),new Je.Vec3,new Je.Vec3(0,t,0),new Je.Vec3,new Je.Vec3(0,0,t)),i.push(new Je.Color(16711680),new Je.Color(16711680),new Je.Color(65280),new Je.Color(65280),new Je.Color(255),new Je.Color(255));var r=new Je.LineMaterial({vertexColors:Je.VertexColors,depthTest:!1,depthMask:!1});Je.Line.call(this,e,i,Je.LinePieces),this.material=r,this.xAxisText=this.makeAxisText("X",16711680),this.yAxisText=this.makeAxisText("Y",65280),this.zAxisText=this.makeAxisText("Z",255),this.xAxisText.setParent(this),this.yAxisText.setParent(this),this.zAxisText.setParent(this),this.setSize(t),this._sizeFixed=!0},Je.extend(Je.Axis,Je.Line,{showAxisText:function(t){this.xAxisText._visible=t,this.yAxisText._visible=t,this.zAxisText._visible=t},setSize:function(t){this.vertices[1].x=t,this.vertices[3].y=t,this.vertices[5].z=t,this.xAxisText.setPosition(t,0,0),this.yAxisText.setPosition(0,t,0),this.zAxisText.setPosition(0,0,t)},fixSize:function(t){Je.Element.prototype.fixSize.call(this,t);this._scale.x,this._scale.y,this._scale.z;this.xAxisText.setScale(3,3,1),this.yAxisText.setScale(3,3,1),this.zAxisText.setScale(3,3,1)},makeAxisText:function(t,e){var i="Arial",r=36,a=Je.BillboardAlignment.topLeft,n=document.createElement("canvas"),s=n.getContext("2d");s.font="Bold "+r+"px "+i,e instanceof Je.Color||(e=new Je.Color(e));var o=s.measureText(t),l=o.width;n.width=xi.nextPowerOfTwo(l),n.height=xi.nextPowerOfTwo(2*s.measureText("e").width+4),s.fillStyle="rgba("+255*e.r+", "+255*e.g+", "+255*e.b+", 1.0)",s.fillText(t,0,10);var h=new Je.Texture(n),c=new Je.BillboardMaterial({map:h,useScreenCoordinates:!1,alignment:a,depthTest:!1,depthMask:!1}),u=new Je.Billboard;return u.material=c,u}}),Je.Curve=function(){},Je.Curve.prototype.getPoint=function(t){return console.log("Warning, getPoint() not implemented!"),null},Je.Curve.prototype.getPointAt=function(t){var e=this.getUtoTmapping(t);return this.getPoint(e)},Je.Curve.prototype.getPoints=function(t){t||(t=5);var e,i=[];for(e=0;e<=t;e++)i.push(this.getPoint(e/t));return i},Je.Curve.prototype.getSpacedPoints=function(t){t||(t=5);var e,i=[];for(e=0;e<=t;e++)i.push(this.getPointAt(e/t));return i},Je.Curve.prototype.getLength=function(){var t=this.getLengths();return t[t.length-1]},Je.Curve.prototype.getLengths=function(t){if(t||(t=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,i,r=[],a=this.getPoint(0),n=0;for(r.push(0),i=1;i<=t;i++)e=this.getPoint(i/t),n+=e.distanceTo(a),r.push(n),a=e;return this.cacheArcLengths=r,r},Je.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},Je.Curve.prototype.getUtoTmapping=function(t,e){var i,r=this.getLengths(),a=0,n=r.length;i=e?e:t*r[n-1];for(var s,o=0,l=n-1;o<=l;)if(a=Math.floor(o+(l-o)/2),s=r[a]-i,s<0)o=a+1;else{if(!(s>0)){l=a;break}l=a-1}if(a=l,r[a]==i){var h=a/(n-1);return h}var c=r[a],u=r[a+1],f=u-c,d=(i-c)/f,h=(a+d)/(n-1);return h},Je.Curve.prototype.getTangent=function(t){var e=1e-4,i=t-e,r=t+e;i<0&&(i=0),r>1&&(r=1);var a=this.getPoint(i),n=this.getPoint(r),s=n.clone().sub(a);return s.normalize()},Je.Curve.prototype.getTangentAt=function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},Je.Curve.Utils={tangentQuadraticBezier:function(t,e,i,r){return 2*(1-t)*(i-e)+2*t*(r-i)},tangentCubicBezier:function(t,e,i,r,a){return-3*e*(1-t)*(1-t)+3*i*(1-t)*(1-t)-6*t*i*(1-t)+6*t*r*(1-t)-3*t*t*r+3*t*t*a},tangentSpline:function(t,e,i,r,a){var n=6*t*t-6*t,s=3*t*t-4*t+1,o=-6*t*t+6*t,l=3*t*t-2*t;return n+s+o+l},interpolate:function(t,e,i,r,a){var n=.5*(i-t),s=.5*(r-e),o=a*a,l=a*o;return(2*e-2*i+n+s)*l+(-3*e+3*i-2*n-s)*o+n*a+e}},Je.Curve.create=function(t,e){return t.prototype=Object.create(Je.Curve.prototype),t.prototype.getPoint=e,t},Je.LineCurve=function(t,e){this.v1=t,this.v2=e},Je.LineCurve.prototype=Object.create(Je.Curve.prototype),Je.LineCurve.prototype.getPoint=function(t){var e=this.v2.clone().sub(this.v1);return e.multiplyScalar(t).add(this.v1),e},Je.LineCurve.prototype.getPointAt=function(t){return this.getPoint(t)},Je.LineCurve.prototype.getTangent=function(t){var e=this.v2.clone().sub(this.v1);return e.normalize()},Je.LineCurve3=function(t,e){this.v1=t,this.v2=e,this.getPoint=function(t){var e=new Je.Vec3;return e.subVectors(this.v2,this.v1),e.multiplyScalar(t),e.add(this.v1),e}},Je.extend(Je.LineCurve3,Je.Curve,{}),Je.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},Je.CurvePath.prototype=Object.create(Je.Curve.prototype),Je.CurvePath.prototype.add=function(t){this.curves.push(t)},Je.CurvePath.prototype.checkConnection=function(){},Je.CurvePath.prototype.closePath=function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Je.LineCurve3(e,t))},Je.CurvePath.prototype.getPoint=function(t){for(var e,i,r=t*this.getLength(),a=this.getCurveLengths(),n=0;n<a.length;){if(a[n]>=r){e=a[n]-r,i=this.curves[n];var s=1-e/i.getLength();return i.getPointAt(s)}n++}return null},Je.CurvePath.prototype.getLength=function(){var t=this.getCurveLengths();return t[t.length-1]},Je.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var t,e=[],i=0,r=this.curves.length;for(t=0;t<r;t++)i+=this.curves[t].getLength(),e.push(i);return this.cacheLengths=e,e},Je.CurvePath.prototype.getBoundingBox=function(){var t,e,i,r,a,n,s=this.getPoints();t=e=Number.NEGATIVE_INFINITY,r=a=Number.POSITIVE_INFINITY;var o,l,h,c,u=s[0]instanceof Je.Vec3;for(c=u?new Je.Vec3:new Je.Vec2,l=0,h=s.length;l<h;l++)o=s[l],o.x>t?t=o.x:o.x<r&&(r=o.x),o.y>e?e=o.y:o.y<a&&(a=o.y),u&&(o.z>i?i=o.z:o.z<n&&(n=o.z)),c.add(o);var f={minX:r,minY:a,maxX:t,maxY:e,centroid:c.divideScalar(h)};return u&&(f.maxZ=i,f.minZ=n),f},Je.CurvePath.prototype.createPointsGeometry=function(t){var e=this.getPoints(t,!0);return this.createGeometry(e)},Je.CurvePath.prototype.createSpacedPointsGeometry=function(t){var e=this.getSpacedPoints(t,!0);return this.createGeometry(e)},Je.CurvePath.prototype.createGeometry=function(t){for(var e=new Je.Geometry,i=0;i<t.length;i++)e.vertices.push(new Je.Vec3(t[i].x,t[i].y,t[i].z||0));return e},Je.CurvePath.prototype.addWrapPath=function(t){this.bends.push(t)},Je.CurvePath.prototype.getTransformedPoints=function(t,e){var i,r,a=this.getPoints(t);for(e||(e=this.bends),i=0,r=e.length;i<r;i++)a=this.getWrapPoints(a,e[i]);return a},Je.CurvePath.prototype.getTransformedSpacedPoints=function(t,e){var i,r,a=this.getSpacedPoints(t);for(e||(e=this.bends),i=0,r=e.length;i<r;i++)a=this.getWrapPoints(a,e[i]);return a},Je.CurvePath.prototype.getWrapPoints=function(t,e){var i,r,a,n,s,o,l=this.getBoundingBox();for(i=0,r=t.length;i<r;i++){a=t[i],n=a.x,s=a.y,o=n/l.maxX,o=e.getUtoTmapping(o,n);var h=e.getPoint(o),c=e.getTangent(o);c.set(-c.y,c.x).multiplyScalar(s),a.x=h.x+c.x,a.y=h.y+c.y}return t},Je.EllipseCurve=function(t,e,i,r,a,n,s){this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=r,this.aStartAngle=a||0,this.aEndAngle=n||2*Math.PI,this.aClockwise=s},Je.EllipseCurve.prototype=Object.create(Je.Curve.prototype),Je.EllipseCurve.prototype.getPoint=function(t){var e,i=this.aEndAngle-this.aStartAngle;i<0&&(i+=2*Math.PI),i>2*Math.PI&&(i-=2*Math.PI),e=this.aClockwise===!0?this.aEndAngle+(1-t)*(2*Math.PI-i):this.aStartAngle+t*i;var r=this.aX+this.xRadius*Math.cos(e),a=this.aY+this.yRadius*Math.sin(e);return new Je.Vec3(r,a,0)},Je.ArcCurve=function(t,e,i,r,a,n){Je.EllipseCurve.call(this,t,e,i,i,r,a,n)},Je.ArcCurve.prototype=Object.create(Je.EllipseCurve.prototype),Je.Path=function(t){Je.CurvePath.call(this),this.actions=[],this.points=[],t&&this.fromPoints(t)},Je.extend(Je.Path,Je.CurvePath,{constructor:Je.Path,className:"TGL.Path",serializeJsonValue:function(){return{actions:this.actions,"class":"TGL.Path"}},deserializeJsonValue:function(t){var e,i,r,a;for(a=0;a<t.actions.length;a++)i=t.actions[a],e=i.action,r=i.args,this[e].apply(this,r)}}),Je.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"curveTo",BEZIER_CURVE_TO:"bCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},Je.Path.prototype.fromPoints=function(t){this.moveTo(t[0].x,t[0].y,t[0].z);for(var e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y,t[e].z)},Je.Path.prototype.closePath=function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.lineTo(t.x,t.y,t.z)},Je.Path.prototype.reverse=function(){var t,e,i,r,a,n=new Je.Path,s=this.actions.length;for(t=s-1;t>=0;t--){if(e=this.actions[t].args,i=e.length,t===s-1&&n.moveTo(e[i-3],e[i-2],e[i-1]),null!=r)switch(a){case Je.PathActions.MOVE_TO:n.moveTo(e[i-3],e[i-2],e[i-1]);break;case Je.PathActions.LINE_TO:n.lineTo(e[i-3],e[i-2],e[i-1]);break;case Je.PathActions.QUADRATIC_CURVE_TO:n.quadraticCurveTo(r[0],r[1],r[2],e[i-3],e[i-2],e[i-1]);break;case Je.PathActions.BEZIER_CURVE_TO:n.bezierCurveTo(r[3],r[4],r[5],r[0],r[1],r[2],e[i-3],e[i-2],e[i-1])}r=e,a=this.actions[t].action}return n},Je.Path.prototype.moveTo=function(t,e,i){t=t||0,e=e||0,i=i||0;var r=Array.prototype.slice.call(arguments);this.actions.push({action:Je.PathActions.MOVE_TO,args:r}),this.points.push(new Ke(t,e,i))},Je.Path.prototype.lineTo=function(t,e,i){if(t=t||0,e=e||0,i=i||0,this.actions&&1===this.actions.length){var r=this.actions[0].args;r[0]===t&&r[1]===e&&r[2]===i&&(console.log("TGL.Path:lineTo the same point of moveTo"),t+=.01)}var r=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,n=a[a.length-3],s=a[a.length-2],o=a[a.length-1],l=new Je.LineCurve3(new Je.Vec3(n,s,o),new Je.Vec3(t,e,i));this.curves.push(l),this.actions.push({action:Je.PathActions.LINE_TO,args:r}),this.points.push(new Ke(t,e,i))},Je.Path.prototype.quadraticCurveTo=function(t,e,i,r,a,n){if(t=t||0,e=e||0,i=i||0,r=r||0,a=a||0,n=n||0,this.actions&&1===this.actions.length){var s=this.actions[0].args;s[0]===r&&s[1]===a&&s[2]===n&&(console.log("TGL.Path:quadraticCurveTo the same point of moveTo"),r=.01)}var s=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,l=o[o.length-3],h=o[o.length-2],c=o[o.length-1],u=new Je.QuadraticBezierCurve3(new Je.Vec3(l,h,c),new Je.Vec3(t,e,i),new Je.Vec3(r,a,n));this.curves.push(u),this.actions.push({action:Je.PathActions.QUADRATIC_CURVE_TO,args:s}),this.points.push(new Ke(r,a,n))},Je.Path.prototype.curveTo=Je.Path.prototype.quadraticCurveTo,Je.Path.prototype.bezierCurveTo=function(t,e,i,r,a,n,s,o,l){var h=Array.prototype.slice.call(arguments),c=this.actions[this.actions.length-1].args,u=c[c.length-3],f=c[c.length-2],d=c[c.length-1],p=new Je.CubicBezierCurve3(new Je.Vec3(u,f,d),new Je.Vec3(t,e,i),new Je.Vec3(r,a,n),new Je.Vec3(s,o,l));this.curves.push(p),this.actions.push({action:Je.PathActions.BEZIER_CURVE_TO,args:h}),this.points.push(new Ke(s,o,l))},Je.Path.prototype.isClockwise=function(){if(this.points.length<2)return e;if(this.points.length<3){var t=this.points[0],i=this.points[1];return i.x>t.x}return Je.Math.isClockwise(this.points)},Je.Path.prototype.bCurveTo=Je.Path.prototype.bezierCurveTo,Je.Path.prototype.splineThru=function(t){var e=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,r=i[i.length-2],a=i[i.length-1],n=[new Je.Vec2(r,a)];Array.prototype.push.apply(n,t);var s=new Je.SplineCurve(n);this.curves.push(s),this.actions.push({action:Je.PathActions.CSPLINE_THRU,args:e})},Je.Path.prototype.arc=function(t,e,i,r,a,n){var s=this.actions[this.actions.length-1].args,o=s[s.length-2],l=s[s.length-1];this.absarc(t+o,e+l,i,r,a,n)},Je.Path.prototype.absarc=function(t,e,i,r,a,n){this.absellipse(t,e,i,i,r,a,n)},Je.Path.prototype.ellipse=function(t,e,i,r,a,n,s){var o=this.actions[this.actions.length-1].args,l=o[o.length-2],h=o[o.length-1];this.absellipse(t+l,e+h,i,r,a,n,s)},Je.Path.prototype.absellipse=function(t,e,i,r,a,n,s){var o=Array.prototype.slice.call(arguments),l=new Je.EllipseCurve(t,e,i,r,a,n,s);this.curves.push(l);var h=l.getPoint(1);o.push(h.x),o.push(h.y),this.actions.push({action:Je.PathActions.ELLIPSE,args:o})},Je.Path.prototype.toArray=function(){var t,e=this.actions.length,i=[];for(t=0;t<e;t++){var r=this.actions[t];"moveTo"===r.action?(i.push("m"),i.push(r.args[0]),i.push(r.args[1]),i.push(r.args[2])):"lineTo"===r.action?(i.push("l"),i.push(r.args[0]),i.push(r.args[1]),i.push(r.args[2])):"curveTo"===r.action&&(i.push("c"),i.push(r.args[0]),i.push(r.args[1]),i.push(r.args[2]),i.push(r.args[3]),i.push(r.args[4]),i.push(r.args[5]))}return i},Je.Path.prototype.getSpacedPoints=function(t,e){t||(t=40);for(var i=[],r=0;r<t;r++)i.push(this.getPoint(r/t));return i},Je.Path.prototype.getPoints=function(t,e){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(t,e);t=t||12;var i,r,a,n,s,o,l,h,c,u,f,d,p,m,g,y,v,x,w,_,b,M,S=[];for(i=0,r=this.actions.length;i<r;i++)switch(a=this.actions[i],n=a.action,s=a.args,n){case Je.PathActions.MOVE_TO:S.push(new Je.Vec3(s[0],s[1],s[2]));break;case Je.PathActions.LINE_TO:S.push(new Je.Vec3(s[0],s[1],s[2]));break;case Je.PathActions.QUADRATIC_CURVE_TO:for(o=s[3],l=s[4],h=s[5],d=s[0],p=s[1],m=s[2],S.length>0?(x=S[S.length-1],g=x.x,y=x.y,v=x.z):(x=this.actions[i-1].args,g=x[x.length-3],y=x[x.length-2],v=x[x.length-1]),w=1;w<=t;w++)_=w/t,b=Je.Shape.Utils.b2(_,g,d,o),M=Je.Shape.Utils.b2(_,y,p,l),tz=Je.Shape.Utils.b2(_,v,m,h),S.push(new Je.Vec3(b,M,tz));break;case Je.PathActions.BEZIER_CURVE_TO:for(o=s[6],l=s[7],h=s[8],d=s[0],p=s[1],m=s[2],c=s[3],u=s[4],f=s[5],S.length>0?(x=S[S.length-1],g=x.x,y=x.y,v=x.z):(x=this.actions[i-1].args,g=x[x.length-3],y=x[x.length-2],v=x[x.length-1]),w=1;w<=t;w++)_=w/t,b=Je.Shape.Utils.b3(_,g,d,c,o),M=Je.Shape.Utils.b3(_,y,p,u,l),tz=Je.Shape.Utils.b3(_,v,m,f,h),S.push(new Je.Vec3(b,M,tz));break;case Je.PathActions.CSPLINE_THRU:x=this.actions[i-1].args;var A=new Je.Vec2(x[x.length-2],x[x.length-1]),P=[A],T=t*s[0].length;P=P.concat(s[0]);var C=new Je.SplineCurve(P);for(w=1;w<=T;w++)S.push(C.getPointAt(w/T));break;case Je.PathActions.ARC:var z,L=s[0],E=s[1],D=s[2],N=s[3],B=s[4],R=!!s[5],F=B-N,I=2*t;for(w=1;w<=I;w++)_=w/I,R||(_=1-_),z=N+_*F,b=L+D*Math.cos(z),M=E+D*Math.sin(z),S.push(new Je.Vec3(b,M));break;case Je.PathActions.ELLIPSE:var z,L=s[0],E=s[1],k=s[2],V=s[3],N=s[4],B=s[5],R=!!s[6],F=B-N,I=2*t;for(w=1;w<=I;w++)_=w/I,R||(_=1-_),z=N+_*F,b=L+k*Math.cos(z),M=E+V*Math.sin(z),S.push(new Je.Vec3(b,M))}var O=S[S.length-1],U=1e-10;return Math.abs(O.x-S[0].x)<U&&Math.abs(O.y-S[0].y)<U&&S.splice(S.length-1,1),e&&S.push(S[0]),S},Je.Path.prototype.toShapes=function(t){var i,r,a,n,s,o=[],l=new Je.Path;for(i=0,r=this.actions.length;i<r;i++)a=this.actions[i],s=a.args,n=a.action,n==Je.PathActions.MOVE_TO&&0!=l.actions.length&&(o.push(l),l=new Je.Path),l[n].apply(l,s);if(0!=l.actions.length&&o.push(l),0==o.length)return[];var h,c,u,f=[];if(1==o.length)return c=o[0],u=new Je.Shape,u.actions=c.actions,u.curves=c.curves,f.push(u),f;var d=!Je.Shape.Utils.isClockWise(o[0].getPoints());if(d=t?!d:d)for(u=new Je.Shape,i=0,r=o.length;i<r;i++)c=o[i],h=Je.Shape.Utils.isClockWise(c.getPoints()),h=t?!h:h,h?(u.actions=c.actions,u.curves=c.curves,f.push(u),u=new Je.Shape):u.holes.push(c);else{for(u=e,i=0,r=o.length;i<r;i++)c=o[i],h=Je.Shape.Utils.isClockWise(c.getPoints()),h=t?!h:h,h?(u&&f.push(u),u=new Je.Shape,u.actions=c.actions,u.curves=c.curves):u.holes.push(c);f.push(u)}return f},Je.Shape=function(){Je.Path.apply(this,arguments),this.holes=[]},Je.Shape.prototype=Object.create(Je.Path.prototype),Je.Shape.prototype.extrude=function(t){var e=new Je.ShapeNode(this,t);return e},Je.Shape.prototype.makeGeometry=function(t){var e=new Je.ShapeGeometry(this,t);return e},Je.Shape.prototype.getPointsHoles=function(t){var e,i=this.holes.length,r=[];for(e=0;e<i;e++)r[e]=this.holes[e].getTransformedPoints(t,this.bends);return r},Je.Shape.prototype.getSpacedPointsHoles=function(t){var e,i=this.holes.length,r=[];for(e=0;e<i;e++)r[e]=this.holes[e].getTransformedSpacedPoints(t,this.bends);return r},Je.Shape.prototype.extractAllPoints=function(t){return{shape:this.getTransformedPoints(t),holes:this.getPointsHoles(t)}},Je.Shape.prototype.extractPoints=function(t){return this.useSpacedPoints?this.extractAllSpacedPoints(t):this.extractAllPoints(t)},Je.Shape.prototype.extractAllSpacedPoints=function(t){return{shape:this.getTransformedSpacedPoints(t),holes:this.getSpacedPointsHoles(t)}},Je.Shape.Utils={removeHoles:function(t,e){var i,r,a,n,s,o,l,h,c,u,f,d,p,m,g,y,v=t.concat(),x=v.concat(),w=[];for(s=0;s<e.length;s++){for(l=e[s],Array.prototype.push.apply(x,l),h=Number.POSITIVE_INFINITY,o=0;o<l.length;o++){f=l[o];var _=[];for(u=0;u<v.length;u++)d=v[u],c=f.distanceToSquared(d),_.push(c),c<h&&(h=c,a=o,n=u)}i=n-1>=0?n-1:v.length-1,r=a-1>=0?a-1:l.length-1;var b=[l[a],v[n],v[i]],M=Je.FontUtils.Triangulate.area(b),S=[l[a],l[r],v[n]],A=Je.FontUtils.Triangulate.area(S),P=1,T=-1,C=n,z=a;n+=P,a+=T,n<0&&(n+=v.length),n%=v.length,a<0&&(a+=l.length),a%=l.length,i=n-1>=0?n-1:v.length-1,r=a-1>=0?a-1:l.length-1,b=[l[a],v[n],v[i]];var L=Je.FontUtils.Triangulate.area(b);S=[l[a],l[r],v[n]];var E=Je.FontUtils.Triangulate.area(S);M+A>L+E&&(n=C,a=z,n<0&&(n+=v.length),n%=v.length,a<0&&(a+=l.length),a%=l.length,i=n-1>=0?n-1:v.length-1,r=a-1>=0?a-1:l.length-1),p=v.slice(0,n),m=v.slice(n),g=l.slice(a),y=l.slice(0,a);var D=[l[a],v[n],v[i]],N=[l[a],l[r],v[n]];w.push(D),w.push(N),v=p.concat(g).concat(y).concat(m)}return{shape:v,isolatedPts:w,allpoints:x}},triangulateShape:function(t,i){var r,a,n,s,o,l,h=Je.Shape.Utils.removeHoles(t,i),c=h.shape,u=h.allpoints,f=h.isolatedPts,d=Je.FontUtils.Triangulate(c,!1),p={};for(r=0,a=u.length;r<a;r++)o=u[r].x+":"+u[r].y,p[o]!==e&&console.log("Duplicate point",o),p[o]=r;for(r=0,a=d.length;r<a;r++)for(s=d[r],n=0;n<3;n++)o=s[n].x+":"+s[n].y,l=p[o],l!==e&&(s[n]=l);for(r=0,a=f.length;r<a;r++)for(s=f[r],n=0;n<3;n++)o=s[n].x+":"+s[n].y,l=p[o],l!==e&&(s[n]=l);return d.concat(f)},isClockWise:function(t){return Je.FontUtils.Triangulate.area(t)<0},b2p0:function(t,e){var i=1-t;return i*i*e},b2p1:function(t,e){return 2*(1-t)*t*e},b2p2:function(t,e){return t*t*e},b2:function(t,e,i,r){return this.b2p0(t,e)+this.b2p1(t,i)+this.b2p2(t,r)},b3p0:function(t,e){var i=1-t;return i*i*i*e},b3p1:function(t,e){var i=1-t;return 3*i*i*t*e},b3p2:function(t,e){var i=1-t;return 3*i*t*t*e},b3p3:function(t,e){return t*t*t*e},b3:function(t,e,i,r,a){return this.b3p0(t,e)+this.b3p1(t,i)+this.b3p2(t,r)+this.b3p3(t,a)}},Je.CubicBezierCurve3=Je.Curve.create(function(t,e,i,r){this.v0=t,this.v1=e,this.v2=i,this.v3=r},function(t){var e,i,r;return e=Je.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=Je.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),r=Je.Shape.Utils.b3(t,this.v0.z,this.v1.z,this.v2.z,this.v3.z),
new Je.Vec3(e,i,r)}),Je.QuadraticBezierCurve3=Je.Curve.create(function(t,e,i){this.v0=t,this.v1=e,this.v2=i},function(t){var e,i,r;return e=Je.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x),i=Je.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y),r=Je.Shape.Utils.b2(t,this.v0.z,this.v1.z,this.v2.z),new Je.Vec3(e,i,r)}),Je.PathNode=function(t,i,r,a,n,s,o,l,h,c){this.materialSize=1,this.closed=!1;var u;1===arguments.length&&arguments[0]instanceof Object&&!(arguments[0]instanceof Je.Path)?(u=arguments[0],this.path=u.path,this.segments=u.segments||20,this.radius=u.radius||1,this.segmentsR=u.segmentsR||8,this.shape=u.shape,this.startCap=u.startCap||"plain",this.endCap=u.endCap||"plain",this.arc=u.arc!=e?u.arc:2*Math.PI,this.arcStart=u.arcStart!=e?u.arcStart:0,this.cutSurface=u.cutSurface||"none",this.startCapR=u.startCapR,this.endCapR=u.endCapR,this.startCapSize=u.startCapSize,this.endCapSize=u.endCapSize,this.binormal=u.binormal,this.startCapExtend=u.startCapExtend===e?1:u.startCapExtend,this.endCapExtend=u.endCapExtend===e?1:u.endCapExtend,this._id=u.id):(this.path=t,this.segments=i||20,this.radius=r||1,this.segmentsR=a||8,this.shape=o,this.startCap=n||"plain",this.endCap=s||"plain",this.arc=l!=e?l:2*Math.PI,this.arcStart=h!=e?h:0,this.cutSurface=c||"none"),this.shape instanceof Array&&(this.segmentsR=this.shape.length),this.startCapSize=this.startCapSize||1,this.endCapSize=this.endCapSize||1,this.segmentsCap=20,this.arc===2*Math.PI&&(this.cutSurface="none"),Je.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},Je.extend(Je.PathNode,Je.Entity,{constructor:Je.PathNode,className:"TGL.PathNode",__accessor:["path","segments","radius","segmentsR","startCap","endCap","shape","startCapSize","endCapSize","segmentsCap","arc","arcStart","cutSurface","startCapR","endCapR","startCapExtend","endCapExtend","binormal"],__SizePropeties:["path","segments","radius","segmentsR","startCap","endCap","shape","startCapSize","endCapSize","segmentsCap","arc","arcStart","cutSurface","startCapR","endCapR","startCapExtend","endCapExtend","binormal"],getCrossSectionPoint:function(){},needComputeVertexNormal:function(){return!0},adjustPath:function(t,e,i){e=e||this.radius,i=i||1;var r,a,n,s,o,l,h,c,u,f,d,p,m=new Je.Path,g=new Ke,y=new Ke,v=new Ke,x=new Ke,w=t.actions.length;for(p=0;p<w;p++)n=t.actions[p],o=p+1===w?null:t.actions[p+1],s=n.args,"moveTo"===n.action?m.moveTo(s[0],s[1],s[2]):"lineTo"===n.action?o&&"lineTo"===o.action?(r=t.actions[p-1],a=r.args,l=o.args,h=new Ke(a[0],a[1],a[2]),c=new Ke(s[0],s[1],s[2]),u=new Ke(l[0],l[1],l[2]),g.subVectors(c,h),y.subVectors(c,u),f=g.angleTo(y),d=Math.min(g.length()/2,y.length()/2),d=Math.min(e*i,d),v.addVectors(c,g.normalize().multiplyScalar(-d)),x.addVectors(c,y.normalize().multiplyScalar(-d)),m.lineTo(v.x,v.y,v.z),m.curveTo(c.x,c.y,c.z,x.x,x.y,x.z)):m.lineTo(s[0],s[1],s[2]):"quadraticCurveTo"===n.action&&m.curveTo(s[0],s[1],s[2],s[3],s[4],s[5]);return m},_resetPath:function(){return this.path},getPointAt:function(t){return this._realPath?this._realPath.getPoint(t):null},getTangentAt:function(t){if(this._realPath){var e=this._realPath.getPoint(t),i=this._realPath.getPoint(t-.001);return e.sub(i).normalize()}return null},computeData:function(){function t(t,e,i,r){return r.vertices.push(new Je.Vec3(t,e,i))-1}this.grid=[],this.startGrid=[],this.endGrid=[];var e,i,r,a,n,s,o,l,h,c,u,f,d,p,m,g,y,v,x,w,_=this.segmentsCap,b=new Je.Vec3,M={};if(M.faces=[],M.uvs=[],M.vertices=[],null==this.path)return M;var S=this._resetPath(),A=this.startCap,P=this.endCap,T=this.cutSurface;this._realPath=S,1==this._autoAjust&&(S=this.adjustPath(S));var m,C,c,z=S.curves.length,L=S.curves,E=[],D=S.getLength(),N=0,B=this.segments;for(h=0;h<z;h++){if(m=L[h],C=m.getLength(),m instanceof Je.LineCurve3){var R=(.001*C+N)/D,F=(.999*C+N)/D;E.push(R),E.push(F)}else{var I=.998*C;for(c=0;c<=B;c++){var k=(.001*C+I*c/B+N)/D;E.push(k)}}N+=C}var V=this.frenetFrames(S,E,this.closed,this.binormal),O=V.tangents,U=V.normals,G=V.binormals;this.tangents=O,this.normals=U,this.binormals=G;var H,j=0,X=E.length-1,W=X+1,Y=0,q=0;for(h=0;h<W;h++){if(this.grid[h]=[],a=E[h],l=S.getPointAt(a),e=O[h],i=U[h],r=G[h],"none"!==A&&0===h)if("round"===A||"arrow"===A){var Z,J;Y+=this.radius*this.startCapSize;for(var Q=l.clone().add(e.clone().multiplyScalar(-this.radius*this.startCapSize)),K=0;K<=_;K++){this.startGrid[K]=[];var $=K/_*Math.PI/2;Z="round"===A?Q.clone().add(e.clone().multiplyScalar(this.radius*this.startCapSize*(1-Math.cos($)))):Q.clone().add(e.clone().multiplyScalar(this.radius*this.startCapSize*K/_));for(var c=0;c<this.segmentsR;c++)n=c/this.segmentsR*this.arc+this.arcStart,"round"===A?(s=-this.radius*Math.cos(n)*Math.sin($),o=this.radius*Math.sin(n)*Math.sin($)):(s=-this.radius*Math.cos(n)*K/_,o=this.radius*Math.sin(n)*K/_,s*=this.startCapR||1.3,o*=this.startCapR||1.3),J=Z.clone(),J.x+=s*i.x+o*r.x,J.y+=s*i.y+o*r.y,J.z+=s*i.z+o*r.z,this.startGrid[K][c]=M.vertices.push(J)-1;"center"===T&&(this.startGrid[K][this.segmentsR]=M.vertices.push(Z.clone())-1)}}else j=M.vertices.push(l);for(c=0;c<this.segmentsR;c++){if(H=c/(this.segmentsR-1),this.shape instanceof Array)s=-this.shape[c].x,o=this.shape[c].y;else if(this.shape instanceof Je.Path){var tt=this.shape.getPointAt(H);s=-tt.x,o=-tt.y}else n=c/this.segmentsR*this.arc+this.arcStart,s=-this.radius*Math.cos(n),o=this.radius*Math.sin(n);b.copy(l),b.x+=s*i.x+o*r.x,b.y+=s*i.y+o*r.y,b.z+=s*i.z+o*r.z,this.grid[h][c]=t(b.x,b.y,b.z,M)}if("center"===T&&(this.grid[h][this.segmentsR]=M.vertices.push(l.clone())-1),"none"!==P&&h===W-1)if("round"===P||"arrow"===P){q+=this.radius*this.endCapSize;for(var Z,J,Q=l.clone().add(e.clone().multiplyScalar(this.radius*this.endCapSize)),K=0;K<=_;K++){this.endGrid[K]=[];var $=(1-K/_)*Math.PI/2;Z="round"===P?Q.clone().add(e.clone().multiplyScalar(-this.radius*this.endCapSize*(1-Math.cos($)))):Q.clone().add(e.clone().multiplyScalar(-this.radius*this.endCapSize*(1-K/_)));for(var c=0;c<this.segmentsR;c++)n=c/this.segmentsR*this.arc+this.arcStart,"round"===P?(s=-this.radius*Math.cos(n)*Math.sin($),o=this.radius*Math.sin(n)*Math.sin($)):(s=-this.radius*Math.cos(n)*(1-K/_),o=this.radius*Math.sin(n)*(1-K/_),s*=this.endCapR||1.3,o*=this.endCapR||1.3),J=Z.clone(),J.x+=s*i.x+o*r.x,J.y+=s*i.y+o*r.y,J.z+=s*i.z+o*r.z,this.endGrid[K][c]=M.vertices.push(J)-1;"center"===T&&(this.endGrid[K][this.segmentsR]=M.vertices.push(Z)-1)}}else M.vertices.push(l)}var et=this.segmentsR,it=this.segmentsR;this.arc!==2*Math.PI&&("center"===T?(et++,it++):"none"===T&&et--);var rt=this.arc/Math.PI/2,at=S.getLength(),nt=at+Y+q,st=0,ot=Y/nt,lt=ot,ht=at/nt,ct=ot+ht,ut=q/nt;if("none"!==A)if("plain"===A)for(d=0,c=0;c<this.segmentsR;c++){f=(c+1)%this.segmentsR,p=this.grid[0][c],m=this.grid[0][f],M.faces.push(new Je.Face3(d,p,m)),n=c/this.segmentsR*2*Math.PI,s=-this.radius*Math.cos(n),o=this.radius*Math.sin(n);var y=new Qe(.5,.5);n=c/this.segmentsR*2*Math.PI,s=-this.radius*Math.cos(n),o=this.radius*Math.sin(n);var v=new Qe((s/this.radius+1)/2,(o/this.radius+1)/2);n=f/this.segmentsR*2*Math.PI,s=-this.radius*Math.cos(n),o=this.radius*Math.sin(n);var x=new Qe((s/this.radius+1)/2,(o/this.radius+1)/2);M.uvs.push([y,v,x])}else for(h=0;h<=_;h++)for(c=0;c<et;c++){if(u=h+1,f=(c+1)%it,d=this.startGrid[h][c],u===_+1?(p=this.grid[0][c],m=this.grid[0][f]):(p=this.startGrid[u][c],m=this.startGrid[u][f]),g=this.startGrid[h][f],c>=this.segmentsR-1){var K=this.segmentsR-1,a=K/this.segmentsR*rt;et===this.segmentsR?(y=new Je.Vec2(h/_*ot+st,a),v=new Je.Vec2((h+1)/_*ot+st,a),x=new Je.Vec2((h+1)/_*ot+st,1),w=new Je.Vec2(h/_*ot+st,1)):c>this.segmentsR-1?(y=new Je.Vec2(h/_*ot+st,(1+a)/2),v=new Je.Vec2((h+1)/_*ot+st,(1+a)/2),x=new Je.Vec2((h+1)/_*ot+st,1),w=new Je.Vec2(h/_*ot+st,1)):(y=new Je.Vec2(h/_*ot+st,a),v=new Je.Vec2((h+1)/_*ot+st,a),x=new Je.Vec2((h+1)/_*ot+st,(1+a)/2),w=new Je.Vec2(h/_*ot+st,(1+a)/2))}else y=new Je.Vec2(h/_*ot+st,c/this.segmentsR*rt),v=new Je.Vec2((h+1)/_*ot+st,c/this.segmentsR*rt),x=new Je.Vec2((h+1)/_*ot+st,(c+1)/this.segmentsR*rt),w=new Je.Vec2(h/_*ot+st,(c+1)/this.segmentsR*rt);0!==h&&(M.faces.push(new Je.Face3(d,p,g,j-1)),M.uvs.push([y,v,w])),M.faces.push(new Je.Face3(p,m,g,j-1)),M.uvs.push([v.clone(),x,w.clone()])}for(h=0;h<X;h++)for(c=0;c<et;c++){if(u=this.closed?(h+1)%X:h+1,f=(c+1)%it,d=this.grid[h][c],p=this.grid[u][c],m=this.grid[u][f],g=this.grid[h][f],c>=this.segmentsR-1){var K=this.segmentsR-1,a=K/this.segmentsR*rt;et===this.segmentsR?(y=new Je.Vec2(E[h]*ht+lt,a),v=new Je.Vec2(E[h+1]*ht+lt,a),x=new Je.Vec2(E[h+1]*ht+lt,1),w=new Je.Vec2(E[h]*ht+lt,1)):c>this.segmentsR-1?(y=new Je.Vec2(E[h]*ht+lt,(a+1)/2),v=new Je.Vec2(E[h+1]*ht+lt,(a+1)/2),x=new Je.Vec2(E[h+1]*ht+lt,1),w=new Je.Vec2(E[h]*ht+lt,1)):(y=new Je.Vec2(E[h]*ht+lt,a),v=new Je.Vec2(E[h+1]*ht+lt,a),x=new Je.Vec2(E[h+1]*ht+lt,(a+1)/2),w=new Je.Vec2(E[h]*ht+lt,(a+1)/2))}else y=new Je.Vec2(E[h]*ht+lt,c/this.segmentsR*rt),v=new Je.Vec2(E[h+1]*ht+lt,c/this.segmentsR*rt),x=new Je.Vec2(E[h+1]*ht+lt,(c+1)/this.segmentsR*rt),w=new Je.Vec2(E[h]*ht+lt,(c+1)/this.segmentsR*rt);M.faces.push(new Je.Face3(d,p,g)),M.uvs.push([y,v,w]),M.faces.push(new Je.Face3(p,m,g)),M.uvs.push([v.clone(),x,w.clone()])}if("none"!==P){d=M.vertices.length-1;var z=this.grid.length;if("plain"===P)for(c=0;c<this.segmentsR;c++){f=(c+1)%this.segmentsR,p=this.grid[z-1][c],m=this.grid[z-1][f],M.faces.push(new Je.Face3(d,m,p)),n=c/this.segmentsR*2*Math.PI,s=-this.radius*Math.cos(n),o=this.radius*Math.sin(n);var y=new Qe(.5,.5);n=c/this.segmentsR*2*Math.PI,s=-this.radius*Math.cos(n),o=this.radius*Math.sin(n);var v=new Qe((s/this.radius+1)/2,(o/this.radius+1)/2);n=f/this.segmentsR*2*Math.PI,s=-this.radius*Math.cos(n),o=this.radius*Math.sin(n);var x=new Qe((s/this.radius+1)/2,(o/this.radius+1)/2);M.uvs.push([y,x,v])}else for(h=-1;h<_;h++)for(c=0;c<et;c++){if(u=h+1,f=(c+1)%it,h===-1?(d=this.grid[z-1][c],g=this.grid[z-1][f]):(d=this.endGrid[h][c],g=this.endGrid[h][f]),p=this.endGrid[u][c],m=this.endGrid[u][f],c>=this.segmentsR-1){var K=this.segmentsR-1,a=K/this.segmentsR*rt;et===this.segmentsR?(y=new Je.Vec2(h/_*ut+ct,a),v=new Je.Vec2((h+1)/_*ut+ct,a),x=new Je.Vec2((h+1)/_*ut+ct,1),w=new Je.Vec2(h/_*ut+ct,1)):c>this.segmentsR-1?(y=new Je.Vec2(h/_*ut+ct,(1+a)/2),v=new Je.Vec2((h+1)/_*ut+ct,(1+a)/2),x=new Je.Vec2((h+1)/_*ut+ct,1),w=new Je.Vec2(h/_*ut+ct,1)):(y=new Je.Vec2(h/_*ut+ct,a),v=new Je.Vec2((h+1)/_*ut+ct,a),x=new Je.Vec2((h+1)/_*ut+ct,(1+a)/2),w=new Je.Vec2(h/_*ut+ct,(1+a)/2))}else y=new Je.Vec2(h/_*ut+ct,c/this.segmentsR*rt),v=new Je.Vec2((h+1)/_*ut+ct,c/this.segmentsR*rt),x=new Je.Vec2((h+1)/_*ut+ct,(c+1)/this.segmentsR*rt),w=new Je.Vec2(h/_*ut+ct,(c+1)/this.segmentsR*rt);M.faces.push(new Je.Face3(d,p,g)),M.uvs.push([y,v,w]),M.faces.push(new Je.Face3(p,m,g)),M.uvs.push([v.clone(),x,w.clone()])}}return M},frenetFrames:function(t,e,i,r){function a(){m[0]=new Je.Vec3,g[0]=new Je.Vec3,s=Number.MAX_VALUE,o=Math.abs(p[0].x),l=Math.abs(p[0].y),h=Math.abs(p[0].z),l<=s&&(s=l,d.set(0,1,0)),o<=s&&(s=o,d.set(1,0,0)),h<=s&&d.set(0,0,1),r&&(d=r.clone()),y.crossVectors(p[0],d).normalize(),m[0].crossVectors(p[0],y),g[0].crossVectors(p[0],m[0])}var n,s,o,l,h,c,u,f,d=(new Je.Vec3,new Je.Vec3),p=(new Je.Vec3,[]),m=[],g=[],y=new Je.Vec3,v=new Je.Mat4,x=e.length-1,w=x+1,_=1e-4,b=[];for(b.tangents=p,b.normals=m,b.binormals=g,c=0;c<w;c++){u=e[c];var f=t.getTangentAt(u);p[c]=new Je.Vec3(f.x,f.y,f.z?f.z:0),p[c].normalize()}for(a(),c=1;c<w;c++)m[c]=m[c-1].clone(),g[c]=g[c-1].clone(),y.crossVectors(p[c-1],p[c]),y.length()>_&&(y.normalize(),n=Math.acos(Je.Math.clamp(p[c-1].dot(p[c]),-1,1)),m[c].applyMatrix4(v.makeRotationAxis(y,n))),g[c].crossVectors(p[c],m[c]);if(i)for(n=Math.acos(Je.Math.clamp(m[0].dot(m[w-1]),-1,1)),n/=w-1,p[0].dot(y.crossVectors(m[0],m[w-1]))>0&&(n=-n),c=1;c<w;c++)m[c].applyMatrix4(v.makeRotationAxis(p[c],n*c)),g[c].crossVectors(p[c],m[c]);return b}}),Je.PathCube=function(t,e,i,r,a){var n;1===arguments.length&&arguments[0]instanceof Object&&!(arguments[0]instanceof Je.Path)?(n=arguments[0],this.path=n.path,this.width=n.width||50,this.height=n.height||100,this.curveSegements=n.curveSegements||32,this.repeat=n.repeat||20,this._id=n.id):(this.path=t,this.width=e||50,this.height=i||100,this.curveSegements=r||32,this.repeat=a||20),this.materialSize=6,Je.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},Je.PathCube.SideIndexMapping={bottom:0,outside:1,inside:2,top:3,aside:4,zside:5},Je.extend(Je.PathCube,Je.Entity,{__accessor:["path","width","height","curveSegements","repeat"],__SizePropeties:["path","width","height","curveSegements","repeat"],constructor:Je.PathCube,className:"TGL.PathCube",getSideIndexMapping:function(){return Je.PathCube.SideIndexMapping},computeData:function(){var t={};if(t.vertices=[],t.faces=[],t.uvs=[],t.uv2s=[],null==this.path)return t;var e,i=this.computePoints(this.path,this.width,this.curveSegements),r=i[0],a=i[1],n=r.length,s=i[2],o=this.height,l=this.repeat,h=[],c=[],u=[],f=[],d=this.path.isClockwise();for(this.innerPoints=this.clonePoints(r),this.outerPoints=this.clonePoints(a),e=0;e<n;e++)this.exchangeYZ(r[e]),this.exchangeYZ(a[e]),h[e]=t.vertices.push(r[e])-1,c[e]=t.vertices.push(a[e])-1,u[e]=t.vertices.push(r[e].clone().setY(o))-1,f[e]=t.vertices.push(a[e].clone().setY(o))-1;var p=s?n:n-1;for(e=0;e<p;e++)this.generateTop(t,e,n,u,f,!0,l),this.generateBottom(t,e,n,h,c,l),this.generateSideWall(t,e,n,f,c,!0,l,d),this.generateSideWall(t,e,n,u,h,!1,l,d);return s||(this.generateEnd(t,u,h,c,f,l,!0),this.generateEnd(t,u,h,c,f,l,!1)),this.clockwise=d,t},clonePoints:function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].clone());return e},getInsidePoints:function(){var t=[];return t=this.clockwise?this.innerPoints:this.outerPoints},generateEnd:function(t,e,i,r,a,n,s){var o,l,h,c,u,f,d,p,m,g,y,v,x,w,_,x,b,M,S,A,P=s?0:i.length-1;o=e[P],l=i[P],h=r[P],c=a[P],b=t.vertices[o],M=t.vertices[l],S=t.vertices[h],A=t.vertices[c],u=b.x,f=b.y,d=b.z,p=M.x,m=M.y,g=M.z,y=S.x,v=S.y,x=S.z,w=A.x,_=A.y,dz=A.z;var T=Math.abs(d-x),C=Math.abs(u-y);s?(t.faces.push(new Je.Face3(o,l,c,null,null,4)),T<C?t.uvs.push([new Je.Vec2(u/n,f/n),new Je.Vec2(p/n,m/n),new Je.Vec2(w/n,_/n)]):t.uvs.push([new Je.Vec2(d/n,f/n),new Je.Vec2(g/n,m/n),new Je.Vec2(dz/n,_/n)]),t.uv2s.push([new Qe(0,1),new Qe(0,0),new Qe(1,1)]),t.faces.push(new Je.Face3(l,h,c,null,null,4)),T<C?t.uvs.push([new Je.Vec2(p/n,m/n),new Je.Vec2(y/n,v/n),new Je.Vec2(w/n,_/n)]):t.uvs.push([new Je.Vec2(g/n,m/n),new Je.Vec2(x/n,v/n),new Je.Vec2(dz/n,_/n)]),t.uv2s.push([new Qe(0,0),new Qe(1,0),new Qe(1,1)])):(t.faces.push(new Je.Face3(l,o,c,null,null,5)),T<C?t.uvs.push([new Je.Vec2(p/n,m/n),new Je.Vec2(u/n,f/n),new Je.Vec2(w/n,_/n)]):t.uvs.push([new Je.Vec2(g/n,m/n),new Je.Vec2(d/n,f/n),new Je.Vec2(dz/n,_/n)]),t.uv2s.push([new Qe(0,0),new Qe(0,1),new Qe(1,1)]),t.faces.push(new Je.Face3(h,l,c,null,null,5)),T<C?t.uvs.push([new Je.Vec2(y/n,v/n),new Je.Vec2(p/n,m/n),new Je.Vec2(w/n,_/n)]):t.uvs.push([new Je.Vec2(x/n,v/n),new Je.Vec2(g/n,m/n),new Je.Vec2(dz/n,_/n)]),t.uv2s.push([new Qe(1,0),new Qe(0,0),new Qe(1,1)]))},generateSideWall:function(t,e,i,r,a,n,s,o){var l,h,c,u,f,d,p,m,g,y,v,x,w,_,b,w,M,S,A,P,T;M=(e+1)%i,l=r[e],h=a[e],c=a[M],u=r[M],S=t.vertices[l],A=t.vertices[h],P=t.vertices[c],T=t.vertices[u],f=S.x,d=S.y,p=S.z,m=A.x,g=A.y,y=A.z,v=P.x,x=P.y,w=P.z,_=T.x,b=T.y,dz=T.z;var C,z=Math.abs(p-w),L=Math.abs(f-v);n?(C=o?1:2,t.faces.push(new Je.Face3(l,h,u,null,null,C)),z<L?t.uvs.push([new Je.Vec2(f/s,d/s),new Je.Vec2(m/s,g/s),new Je.Vec2(_/s,b/s)]):t.uvs.push([new Je.Vec2(p/s,d/s),new Je.Vec2(y/s,g/s),new Je.Vec2(dz/s,b/s)]),t.uv2s.push([new Qe(0,1),new Qe(0,0),new Qe(1,1)]),t.faces.push(new Je.Face3(h,c,u,null,null,C)),z<L?t.uvs.push([new Je.Vec2(m/s,g/s),new Je.Vec2(v/s,x/s),new Je.Vec2(_/s,b/s)]):t.uvs.push([new Je.Vec2(y/s,g/s),new Je.Vec2(w/s,x/s),new Je.Vec2(dz/s,b/s)]),t.uv2s.push([new Qe(0,0),new Qe(1,0),new Qe(1,1)])):(C=o?2:1,t.faces.push(new Je.Face3(h,l,u,null,null,C)),z<L?t.uvs.push([new Je.Vec2(m/s,g/s),new Je.Vec2(f/s,d/s),new Je.Vec2(_/s,b/s)]):t.uvs.push([new Je.Vec2(y/s,g/s),new Je.Vec2(p/s,d/s),new Je.Vec2(dz/s,b/s)]),t.uv2s.push([new Qe(0,0),new Qe(0,1),new Qe(1,1)]),t.faces.push(new Je.Face3(c,h,u,null,null,C)),z<L?t.uvs.push([new Je.Vec2(v/s,x/s),new Je.Vec2(m/s,g/s),new Je.Vec2(_/s,b/s)]):t.uvs.push([new Je.Vec2(w/s,x/s),new Je.Vec2(y/s,g/s),new Je.Vec2(dz/s,b/s)]),t.uv2s.push([new Qe(1,0),new Qe(0,0),new Qe(1,1)]))},generateBottom:function(t,e,i,r,a,n){this.generateTop(t,e,i,r,a,!1,n)},generateTop:function(t,e,i,r,a,n,s){var o,l,h,c,u,f,d,p,m,g,y,v,x,w,_,x,b,M,S,A,P;b=(e+1)%i,o=r[e],l=a[e],h=a[b],c=r[b],M=t.vertices[o],S=t.vertices[l],A=t.vertices[h],P=t.vertices[c],u=M.x,f=M.y,d=M.z,p=S.x,m=S.y,g=S.z,y=A.x,v=A.y,x=A.z,w=P.x,_=P.y,dz=P.z,n?(t.faces.push(new Je.Face3(o,l,c,null,null,3)),t.uvs.push([new Je.Vec2(u/s,d/s),new Je.Vec2(p/s,g/s),new Je.Vec2(w/s,dz/s)]),t.uv2s.push([new Qe(0,1),new Qe(0,0),new Qe(1,1)]),t.faces.push(new Je.Face3(l,h,c,null,null,3)),t.uvs.push([new Je.Vec2(p/s,g/s),new Je.Vec2(y/s,x/s),new Je.Vec2(w/s,dz/s)]),t.uv2s.push([new Qe(0,0),new Qe(1,0),new Qe(1,1)])):(t.faces.push(new Je.Face3(l,o,c,null,null,0)),t.uvs.push([new Je.Vec2(p/s,g/s),new Je.Vec2(u/s,d/s),new Je.Vec2(w/s,dz/s)]),t.uv2s.push([new Qe(0,0),new Qe(0,1),new Qe(1,1)]),t.faces.push(new Je.Face3(h,l,c,null,null,0)),t.uvs.push([new Je.Vec2(y/s,x/s),new Je.Vec2(p/s,g/s),new Je.Vec2(w/s,dz/s)]),t.uv2s.push([new Qe(1,0),new Qe(0,0),new Qe(1,1)]))},exchangeYZ:function(t){var e=t.y;t.y=t.z,t.z=-e},addPoints:function(t,e,i,r,a){e.multiplyScalar(.5),i.push((new Je.Vec3).subVectors(t,e)),r.push((new Je.Vec3).addVectors(t,e))},computeCurvePoint:function(t,e,i,r,a,n,s,o,l){var h,c,f,d,p=r?0:1,m=new Je.Vec3,g=o;if(t){c=t.getTangentAt(1),f=e.getTangentAt(0),concave=Je.Math.isConcave(c,f,!1),f.multiplyScalar(-1),angle=c.angleTo(f),d=Math.sin(angle/2),h=e.getPoint(0),d=0==d?.1:d;var y=concave?i/d:-i/d;1==d?m.crossVectors(f,new Ke(0,0,1)).normalize().multiplyScalar(y):m.addVectors(c,f).normalize().multiplyScalar(y),this.addPoints(h,m,n,s,l)}else f=e.getTangentAt(p),h=e.getPoint(p),m.crossVectors(f,new Je.Vec3(0,0,1)).normalize().multiplyScalar(i),this.addPoints(h,m,n,s,l);if(!(e instanceof Je.LineCurve3)&&a){var v=g+1;for(j=0;j<v-2;j++)u=j/(v-1),f=e.getTangentAt(u),h=e.getPointAt(u),m.crossVectors(f,new Je.Vec3(0,0,1)).normalize().multiplyScalar(i),j*e.getLength()/g>i/Math.abs(d)&&this.addPoints(h,m,n,s,l)}},computePoints:function(t,e,i){var r,a,n,s=(new Je.Vec3,t.isClockwise()),o=t.curves[0].getPoint(0),l=t.curves[t.curves.length-1].getPoint(1);n=o.equals(l),a=t.curves.length;var h=[],c=[];new Je.Path,t.getLength();for(r=0;r<a;r++){var u=r-1;n&&u===-1&&(u=a-1);var f=t.curves[u],d=t.curves[r];this.computeCurvePoint(f,d,e,!0,!0,h,c,i,s),r===a-1&&!n&&this.computeCurvePoint(null,d,e,!1,!1,h,c,i,s)}return[h,c,n]}}),Je.ShapeNode=function(t,e,i,r,a){if(null==t)return t=[],this.materialSize=3,Je.Entity.call(this),void 0;var n;if(!(1===arguments.length&&arguments[0]instanceof Object)||arguments[0]instanceof Je.Shape||arguments[0]instanceof Je.Path&&!Array.isArray(arguments[0]))this.options={curveSegments:e,amount:i,vertical:r,zMinusHalfAmount:this.zMinusHalfAmount,repeat:a||20};else{if(n=arguments[0],t=n.path,null==t)return t=[],this.materialSize=3,Je.Entity.call(this),void 0;e=n.curveSegments,i=n.amount,r=n.vertical,a=n.repeat,this.options={curveSegments:n.curveSegments,amount:n.amount,vertical:n.vertical,zMinusHalfAmount:this.zMinusHalfAmount,repeat:n.repeat||20},this._id=n.id}var s=[];t instanceof Je.Path?(s=t.toShapes(),this.path=t):s=t,this.curveSegments=e,this.amount=i,this.vertical=r,this.repeat=a||20,s=s instanceof Array?s:[s],this.shapes=s,this.shapebb=s[s.length-1].getBoundingBox(),this.materialSize=3,Je.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},Je.ShapeNode.SideIndexMapping={bottom:0,side:1,top:2},Je.extend(Je.ShapeNode,Je.Entity,{constructor:Je.ShapeNode,className:"TGL.ShapeNode",__accessor:["path","curveSegments","amount","vertical","repeat"],__bool:["vertical"],__SizePropeties:["path","curveSegments","amount","vertical","repeat"],computeData:function(){return this.options={curveSegments:this.curveSegments,amount:this.amount,vertical:this.vertical,zMinusHalfAmount:this.zMinusHalfAmount,repeat:this.repeat||20},this.addShapes(this.path,this.options)},getSideIndexMapping:function(){return Je.ShapeNode.SideIndexMapping},addShapes:function(t,e){var i=[];i=t instanceof Je.Path?t.toShapes():t;var r={};if(r.vertices=[],r.uvs=[],r.faces=[],!i)return r;for(var a=i.length,n=0;n<a;n++){var s=i[n];this.addShape(s,e,r)}var o=new Je.BoundingBox;o.setFromPoints(r.vertices);var l=(o.max.y-o.min.y)/2;if(e.zMinusHalfAmount)for(var h=0;h<r.vertices.length;h++)r.vertices[h].y-=l;if(e.vertical)for(var h=0;h<r.vertices.length;h++){var c=r.vertices[h].y;r.vertices[h].y=r.vertices[h].z,r.vertices[h].z=-c}return r}}),Je.ShapeNode.prototype.addShape=function(t,i,r){function a(t,e,i){return e||console.log("die"),e.clone().multiplyScalar(i).add(t)}function n(t,e,i){return o(t,e,i)}function s(t,e,i){var r=Math.atan2(e.y-t.y,e.x-t.x),a=Math.atan2(i.y-t.y,i.x-t.x);r>a&&(a+=2*Math.PI);var n=(r+a)/2,s=-Math.cos(n),o=-Math.sin(n),l=new Je.Vec2(s,o);return l}function o(t,e,i){var r,a,n,o,l,h,c=Je.ShapeNode.__v1,u=Je.ShapeNode.__v2,f=Je.ShapeNode.__v3,d=Je.ShapeNode.__v4,p=Je.ShapeNode.__v5,m=Je.ShapeNode.__v6;return c.set(t.x-e.x,t.y-e.y),u.set(t.x-i.x,t.y-i.y),r=c.normalize(),a=u.normalize(),f.set(-r.y,r.x),d.set(a.y,-a.x),p.copy(t).add(f),m.copy(t).add(d),p.equals(m)?d.clone():(p.copy(e).add(f),m.copy(i).add(d),n=r.dot(d),o=m.sub(p).dot(d),0===n&&(console.log("Either infinite or no solutions!"),0===o?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),l=o/n,l<0?s(t,e,i):(h=r.multiplyScalar(l).add(p),h.sub(t).clone()))}function l(){if(w){var t=0,e=Y*t;for(J=0;J<q;J++)W=V[J],f(W[2]+e,W[1]+e,W[0]+e,!0);for(t=b+2*x,e=Y*t,J=0;J<q;J++)W=V[J],f(W[0]+e,W[1]+e,W[2]+e,!1)}else{for(J=0;J<q;J++)W=V[J],f(W[2],W[1],W[0],!0);for(J=0;J<q;J++)W=V[J],f(W[0]+Y*b,W[1]+Y*b,W[2]+Y*b,!1)}}function h(){var t=0;for(c(O,t),t+=O.length,D=0,N=I.length;D<N;D++)E=I[D],c(E,t),t+=E.length}function c(t,e){var i,r;for(J=t.length;--J>=0;){i=J,r=J-1,r<0&&(r=t.length-1);var a=0,n=b+2*x;for(a=0;a<n;a++){var s=Y*a,o=Y*(a+1),l=e+i+s,h=e+r+s,c=e+r+o,u=e+i+o;d(l,h,c,u,t,a,n,i,r)}}}function u(t,e,i){r.vertices.push(new Je.Vec3(t,e,i-(g?m/2:0)))}function f(e,a,n,s){e+=B,a+=B,n+=B;var o=s?0:2;if(Je.Math.isClockwise([r.vertices[e],r.vertices[a],r.vertices[n]]),"z"){r.faces.push(new Je.Face3(e,a,n,null,null,o));var l=s?P.generateBottomUV(r,t,i,e,a,n):P.generateTopUV(r,t,i,e,a,n);r.uvs.push(l)}else{r.faces.push(new Je.Face3(e,n,a,null,null,o));var l=s?P.generateBottomUV(r,t,i,e,n,a):P.generateTopUV(r,t,i,e,n,a);r.uvs.push(l)}}function d(e,a,n,s,o,l,h,c,u){if(e+=B,a+=B,n+=B,s+=B,Je.Math.isClockwise([r.vertices[e],r.vertices[a],r.vertices[s]]),"z"){r.faces.push(new Je.Face3(e,a,s,null,null,A)),r.faces.push(new Je.Face3(a,n,s,null,null,A));var f=P.generateSideWallUV(r,t,o,i,e,a,n,s,l,h,c,u);r.uvs.push([f[0],f[1],f[3]]),r.uvs.push([f[1],f[2],f[3]])}else{r.faces.push(new Je.Face3(e,s,a,null,null,A)),r.faces.push(new Je.Face3(a,s,n,null,null,A));var f=P.generateSideWallUV(r,t,o,i,e,a,n,s,l,h,c,u);r.uvs.push([f[0],f[3],f[1]]),r.uvs.push([f[1],f[3],f[2]])}}var p,m=i.amount!==e?i.amount:100,g=i.zMinusHalfAmount!==e&&i.zMinusHalfAmount,y=i.bevelThickness!==e?i.bevelThickness:6,v=i.bevelSize!==e?i.bevelSize:y-2,x=i.bevelSegments!==e?i.bevelSegments:3,w=i.bevelEnabled!==e&&i.bevelEnabled,_=i.curveSegments!==e?i.curveSegments:12,b=i.steps!==e?i.steps:1,M=i.extrudePath,S=!1,A=(i.material||0,i.extrudeMaterial||1),P=i.UVGenerator!==e?i.UVGenerator:Je.ShapeNode.WorldUVGenerator;P.repeat=i.repeat;var T,C,z,L;this.shapebb;M&&(p=M.getSpacedPoints(b),S=!0,w=!1,T=i.frames!==e?i.frames:Je.PathNode.prototype.frenetFrames(M,b,!1),C=new Je.Vec3,z=new Je.Vec3,L=new Je.Vec3),w||(x=0,y=0,v=0);var E,D,N,B=r.vertices.length,R=t.extractPoints(_),F=R.shape,I=R.holes,k=!Je.Shape.Utils.isClockWise(F);if(k){for(F=F.reverse(),D=0,N=I.length;D<N;D++)E=I[D],Je.Shape.Utils.isClockWise(E)&&(I[D]=E.reverse());k=!1}var V=Je.Shape.Utils.triangulateShape(F,I),O=F;for(D=0,N=I.length;D<N;D++)E=I[D],F=F.concat(E);for(var U,G,H,j,X,W,Y=F.length,q=V.length,Z=(O.length,180/Math.PI,[]),J=0,Q=O.length,K=Q-1,$=J+1;J<Q;J++,K++,$++){K===Q&&(K=0),$===Q&&($=0);O[J],O[K],O[$];Z[J]=n(O[J],O[K],O[$])}var tt,et=[],it=Z.concat();for(D=0,N=I.length;D<N;D++){for(E=I[D],tt=[],J=0,Q=E.length,K=Q-1,$=J+1;J<Q;J++,K++,$++)K===Q&&(K=0),$===Q&&($=0),tt[J]=n(E[J],E[K],E[$]);et.push(tt),it=it.concat(tt)}for(U=0;U<x;U++){for(H=U/x,j=y*(1-H),G=v*Math.sin(H*Math.PI/2),J=0,Q=O.length;J<Q;J++)X=a(O[J],Z[J],G),u(X.x,X.y,-j);for(D=0,N=I.length;D<N;D++)for(E=I[D],tt=et[D],J=0,Q=E.length;J<Q;J++)X=a(E[J],tt[J],G),u(X.x,X.y,-j)}for(G=v,J=0;J<Y;J++)X=w?a(F[J],it[J],G):F[J],S?(z.copy(T.normals[0]).multiplyScalar(X.x),C.copy(T.binormals[0]).multiplyScalar(X.y),L.copy(p[0]).add(z).add(C),u(L.x,L.y,L.z)):u(X.x,X.y,0);var rt;for(rt=1;rt<=b;rt++)for(J=0;J<Y;J++)X=w?a(F[J],it[J],G):F[J],S?(z.copy(T.normals[rt]).multiplyScalar(X.x),C.copy(T.binormals[rt]).multiplyScalar(X.y),L.copy(p[rt]).add(z).add(C),u(L.x,L.y,L.z)):u(X.x,X.y,m/b*rt);for(U=x-1;U>=0;U--){for(H=U/x,j=y*(1-H),G=v*Math.sin(H*Math.PI/2),J=0,Q=O.length;J<Q;J++)X=a(O[J],Z[J],G),u(X.x,X.y,m+j);for(D=0,N=I.length;D<N;D++)for(E=I[D],tt=et[D],J=0,Q=E.length;J<Q;J++)X=a(E[J],tt[J],G),S?u(X.x,X.y+p[b-1].y,p[b-1].x+j):u(X.x,X.y,m+j)}l(),h()},Je.ShapeNode.WorldUVGenerator={generateTopUV:function(t,e,i,r,a,n){var s=t.vertices[r].x,o=t.vertices[r].y,l=t.vertices[a].x,h=t.vertices[a].y,c=t.vertices[n].x,u=t.vertices[n].y;return[new Je.Vec2(s/this.repeat,o/this.repeat),new Je.Vec2(l/this.repeat,h/this.repeat),new Je.Vec2(c/this.repeat,u/this.repeat)]},generateBottomUV:function(t,e,i,r,a,n){return this.generateTopUV(t,e,i,r,a,n)},uv:function(t,e,i){return new Qe(Math.sqrt(t*t+e*e)/this.repeat,(1-i)/this.repeat)},generateSideWallUV:function(t,e,i,r,a,n,s,o,l,h,c,u){var f=t.vertices[a].x,d=t.vertices[a].y,p=t.vertices[a].z,m=t.vertices[n].x,g=t.vertices[n].y,y=t.vertices[n].z,v=t.vertices[s].x,x=t.vertices[s].y,w=t.vertices[s].z,_=t.vertices[o].x,b=t.vertices[o].y,M=t.vertices[o].z,S=Math.abs(d-g),A=Math.abs(f-m);return S<A?[new Je.Vec2(f/this.repeat,(1-p)/this.repeat),new Je.Vec2(m/this.repeat,(1-y)/this.repeat),new Je.Vec2(v/this.repeat,(1-w)/this.repeat),new Je.Vec2(_/this.repeat,(1-M)/this.repeat)]:[new Je.Vec2(d/this.repeat,(1-p)/this.repeat),new Je.Vec2(g/this.repeat,(1-y)/this.repeat),new Je.Vec2(x/this.repeat,(1-w)/this.repeat),new Je.Vec2(b/this.repeat,(1-M)/this.repeat)]}},Je.ShapeNode.__v1=new Je.Vec2,Je.ShapeNode.__v2=new Je.Vec2,Je.ShapeNode.__v3=new Je.Vec2,Je.ShapeNode.__v4=new Je.Vec2,Je.ShapeNode.__v5=new Je.Vec2,Je.ShapeNode.__v6=new Je.Vec2,Je.TextNode=function(t,i,r,a,n,s,o){var l;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(l=arguments[0],t=l.text,this.font=l.font||"helvetiker",this.size=l.size||150,this.weight=l.weight||"normal",this.fontStyle=l.fontStyle||"normal",this.height=l.height||50,this._id=l.id,this.curveSegments=l.curveSegments):(this.font=a||"helvetiker",this.size=i||150,this.weight=n||"normal",this.fontStyle=s||"normal",this.height=r||50,this.curveSegments=o);var h={size:this.size,height:this.height,font:this.font,weight:this.weight,style:this.fontStyle,curveSegments:this.curveSegments||30,bevelEnabled:!1,zMinusHalfAmount:!0};this.text=t;var c=Je.FontUtils.generateShapes(t,h);h.amount=h.height!==e?h.height:50,h.bevelThickness===e&&(h.bevelThickness=10),h.bevelSize===e&&(h.bevelSize=8),h.bevelEnabled===e&&(h.bevelEnabled=!1),Je.ShapeNode.call(this,c,h.curveSegments,this.height,!1,50,!0)},Je.extend(Je.TextNode,Je.ShapeNode,{constructor:Je.TextNode,className:"TGL.TextNode",__accessor:["text","size","height","font","weight","fontStyle"],__SizePropeties:["text","size","height","font","weight","fontStyle"],computeData:function(){var t={size:this.size,height:this.height,font:this.font,weight:this.weight,style:this.fontStyle,curveSegments:this.curveSegments||30,bevelEnabled:!1,zMinusHalfAmount:!0},e={curveSegments:this.curveSegments,amount:this.height,vertical:!1,zMinusHalfAmount:!0,repeat:20},i=Je.FontUtils.generateShapes(this.text,t);return Je.ShapeNode.prototype.addShapes.call(this,i,e)}}),Je.LatheNode=function(t,i,r,a,n,s){this.materialSize=3;var o;1===arguments.length&&arguments[0]instanceof Object&&!(arguments[0]instanceof Je.Path)?(o=arguments[0],this.path=o.path,this.segmentsH=o.segmentsH||64,this.segmentsR=o.segmentsR||20,this.arc=o.arc!=e?o.arc:2*Math.PI,this.startClosed=o.startClosed,this.endClosed=o.endClosed,this._id=o.id):(this.path=t,this.segmentsH=i||64,this.segmentsR=r||20,this.arc=a!=e?a:2*Math.PI,this.startClosed=n,this.endClosed=s),Je.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},Je.extend(Je.LatheNode,Je.Entity,{constructor:Je.LatheNode,className:"TGL.LatheNode",__accessor:["path","segmentsH","segmentsR","arc","startClosed","endClosed"],__SizePropeties:["path","segmentsH","segmentsR","arc","startClosed","endClosed"],computeData:function(){function t(t){var e=t.x,i=t.z,r=((0===i?e/Math.abs(e):e/Math.abs(i))+1)/2;r=Je.Math.clamp(r,0,1);var a=((0===e?i/Math.abs(i):i/Math.abs(e))+1)/2;return a=Je.Math.clamp(a,0,1),new Je.Vec2(r,a)}var e={},e={};if(e.faces=[],e.uvs=[],e.vertices=[],null==this.path)return e;var i,r,n,s,o,l,h,u=[],f=this.path,d=this.segmentsH,p=this.segmentsR;for(Je.Shape.Utils.isClockWise(f.getPoints())||(f=f.reverse()),r=0;r<=d;r++){for(i=f.getPoint(r/d),u[r]=[],s=Math.abs(i.x),o=i.y,this.startClosed&&0===r&&e.vertices.push(new Je.Vec3(0,o,0)),n=0;n<p;n++)h=n/p*this.arc,l=new Je.Vec3(s*Math.cos(h),o,s*Math.sin(h)),u[r][n]=e.vertices.push(l)-1;this.endClosed&&r===d&&e.vertices.push(new Je.Vec3(0,o,0))}var m=this.arc==2*Math.PI;if(this.startClosed)for(a=0,n=0;n<(m?p:p-1);n++)jp=(n+1)%p,b=u[0][n],c=u[0][jp],uva=new Je.Vec2(.5,.5),uvb=t(e.vertices[b]),uvc=t(e.vertices[c]),e.faces.push(new Je.Face3(a,b,c)),e.uvs.push([uva,uvb,uvc]);for(r=0;r<d;r++)for(n=0;n<(m?p:p-1);n++)ip=r+1,jp=(n+1)%p,a=u[r][n],b=u[ip][n],c=u[ip][jp],Yi=u[r][jp],uva=new Je.Vec2(r/d,n/p),uvb=new Je.Vec2((r+1)/d,n/p),uvc=new Je.Vec2((r+1)/d,(n+1)/p),uvd=new Je.Vec2(r/d,(n+1)/p),e.faces.push(new Je.Face3(a,b,Yi)),e.uvs.push([uva,uvb,uvd]),e.faces.push(new Je.Face3(b,c,Yi)),e.uvs.push([uvb.clone(),uvc,uvd.clone()]);if(this.endClosed)for(a=e.vertices.length-1,n=0;n<(m?p:p-1);n++)jp=(n+1)%p,b=u[u.length-1][n],c=u[u.length-1][jp],uva=new Je.Vec2(0,0),uvb=new Je.Vec2(1,n/p),uvc=new Je.Vec2(1,(n+1)/p),e.faces.push(new Je.Face3(a,b,c)),e.uvs.push([uva,uvb,uvc]);return e}}),Je.CurvePlane=function(t,e,i,r){this.pathH=t,this.pathV=e,this.segmentsH=i||20,this.segmentsV=r||20,Je.Entity.call(this)},Je.extend(Je.CurvePlane,Je.Entity,{constructor:Je.CurvePlane,className:"TGL.CurvePlane",computeData:function(){var t={};if(t.faces=[],t.uvs=[],t.vertices=[],null==this.pathV||null==this.pathH)return t;var e,i,r,a,n,s,o,l,h,c=this.pathV,u=this.pathH,f=this.segmentsV,d=this.segmentsH,p=f+1,m=d+1;for(this.grid=[],e=0;e<m;e++){this.grid[e]=[];var g=u.getPointAt(e/m);for(i=0;i<p;i++){var y=c.getPointAt(i/p);this.grid[e][i]=t.vertices.push(new Ke(g.x,y.y,g.z+y.z))-1}}for(e=0;e<d;e++)for(i=0;i<f;i++)r=this.grid[e][i],a=this.grid[e][i+1],n=this.grid[e+1][i+1],s=this.grid[e+1][i],o=new Qe(e/m,i/p),l=new Qe(e/m,(i+1)/p),uvc=new Qe((e+1)/m,(i+1)/p),h=new Qe((e+1)/m,i/p),t.faces.push(new mi(r,n,a)),t.uvs.push([o,uvc,l]),t.faces.push(new mi(r,s,n)),t.uvs.push([o.clone(),h.clone(),uvc]);return t}}),Je.ComboNode=function(t,e,i,r,a){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var n=t;this.combos=n.combos||[],this.operators=n.operators,this.centralized=i,this.names=a,this._id=n.id}else this.combos=t||[],this.operators=e,this.centralized=i,this._id=r,this.names=a;this.csgs=[],Je.Entity.call(this)},Je.extend(Je.ComboNode,Je.Entity,{constructor:Je.ComboNode,className:"TGL.ComboNode",__accessor:["combos","operators","centralized","names"],
__SizePropeties:["combos","operators","centralized"],getOffsetPosition:function(){return this._offsetPosition},getSideIndexMapping:function(){var t,e,i,r,a=this.combos,n=this.names||[],s={},o=0;if(a&&a.length)for(i=0;i<a.length;i++){t=a[i],e=n[i],e||(r=t.getClassName(),r&&r.indexOf(".")>0&&(r=r.substr(r.lastIndexOf(".")+1)),e=r+""+i,e=e.toLowerCase());var l=t.getSideIndexMapping();if(l)for(var h in l)s[e+"-"+h]=o++;else s[e]=o++}return s},computeData:function(){this.csgs=[];var t={vertices:[],faces:[],uvs:[],uv2s:[]};if(!this.combos)return t;if(null==this.operators||0==this.operators.length){var i=xi.mergeElements(this.combos);if(this.materialSize=i.material.materials.length,this.material=i.material,this.orgMaterial=i.material,t={vertices:i.vertices,faces:i.faces,uvs:i.uvs,uv2s:i.uv2s||[]},this.centralized&&t.vertices){var r=new Je.BoundingBox;r.setFromPoints(t.vertices);var a=r.center();for(s=0;s<t.vertices.length;s++){var n=t.vertices[s];n.sub(a)}this._offsetPosition=a}return t}this.operators=this.operators||[];var s,o,l,h,c=this.combos.length;for(s=0;s<c;s++)this.csgs.push(new Je.CSG(this.combos[s]));for(s=0;s<c;s++)null==o?o=this.csgs[s]:(l=this.operators[s-1],"+"===l||l==e?o=o.union(this.csgs[s]):"-"===l?o=o.substract(this.csgs[s]):"^"===l&&(o=o.intersect(this.csgs[s])));if(!o)return t;if(h=o.toMesh(),"centralized"==this.changeProperty&&null!=this.material||(this.materialSize=h.material.materials.length,this.material=h.material,this.orgMaterial=h.material),t={vertices:h.vertices,faces:h.faces,uvs:h.uvs,uv2s:h.uv2s},this.centralized&&t.vertices){var r=new Je.BoundingBox;r.setFromPoints(t.vertices);var a=r.center();for(s=0;s<t.vertices.length;s++){var n=t.vertices[s];n.sub(a)}this._offsetPosition=a}return h=e,t},computeNodeMaterial:function(t){this.material=t.material,this.materialSize=t.materialSize},cacheNodeMaterial:function(t){t.material=this.material,t.materialSize=this.materialSize},needComputeVertexNormal:function(){return!0},generatePrimitiveKey:function(){return null},changeMapping:function(t){var e=this.getMaterialMapping();Je.Utils.isSame(t,e)||(this.batch?this.materialMappingChanges=[t,e]:(this.onMaterialMapping(),this.firePropertyChange("materialMapping",t,e)))},isStyleEquals:function(t,e,i){return!1},getSelectStyle:function(){var t=this.getStyle("select.style");return"outline.normal"!=t&&"outline"!=t||(t="outline.wireframe"),t},onMaterialMapping:function(){this.groups=e,this.primitive.groups=e}}),Je.Terrain=function(t){if(t=t||{},this._id=t.id,this.width=t.width,this.depth=t.depth,this.segmentsW=t.segmentsW||30,this.segmentsD=t.segmentsD||30,this.heightMap=t.heightMap,this.heightUnit=t.heightUnit||1,this.maxHeight=t.maxHeight||255,this.minHeight=t.minHeight||0,this.baseLayerHeight=t.baseLayerHeight||0,"string"==typeof this.heightMap?(this.image=new Image,this.image.src=this.heightMap):ei.isCanvas(this.heightMap)?this.canvas=this.heightMap:ei.isImage(this.heightMap)&&(this.image=this.heightMap),this.image){var e=this;this.image.onload=function(t){var i=document.createElement("canvas");i.width=e.image.width,i.height=e.image.height;var r=i.getContext("2d");r.drawImage(e.image,0,0),e.canvas=i,e.computed=!1,e.computeNodeData(),e.firePropertyChange("width",0,1)}}this.materialSize=2,Je.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},Je.extend(Je.Terrain,Je.Entity,{constructor:Je.Terrain,className:"TGL.Terrain",__accessor:["width","heightUnit","depth","segmentsW","segmentsD","heightMap","heightUnit","maxHeight","minHeight","baseLayerHeight","smooth"],__SizePropeties:["width","heightUnit","depth","segmentsW","segmentsD","heightMap","heightUnit","maxHeight","minHeight","baseLayerHeight","smooth"],__bool:["smooth"],computeLayerData:function(t,e,i){var r,a,n=this.width/2,s=this.depth/2,o=i?this.segmentsW:1,l=i?this.segmentsD:1,h=o+1,c=l+1,u=this.width/o,f=this.depth/l,d=new Je.Vec3(0,0,1),p=t.vertices.length;for(a=0;a<c;a++)for(r=0;r<h;r++){var m=r*u-n,g=a*f-s,y=0;y=i?i.call(this,r/h,a/c):this.baseLayerHeight*this.heightUnit,t.vertices.push(new Je.Vec3(m,y,g))}for(a=0;a<l;a++)for(r=0;r<o;r++){var v=r+h*a+p,x=r+h*(a+1)+p,w=r+1+h*(a+1)+p,_=r+1+h*a+p,b=new Je.Vec2(r/o,1-a/l),M=new Je.Vec2(r/o,1-(a+1)/l),S=new Je.Vec2((r+1)/o,1-(a+1)/l),A=new Je.Vec2((r+1)/o,1-a/l);if(i){var P=new Je.Face3(v,x,_);P.materialIndex=e,t.faces.push(P),t.uvs.push([b,M,A]),P=new Je.Face3(x,w,_),P.materialIndex=e,t.faces.push(P),t.uvs.push([M.clone(),S,A.clone()])}else{var P=new Je.Face4(v,x,w,_);P.normal.copy(d),P.vertexNormals.push(d.clone(),d.clone(),d.clone(),d.clone()),P.materialIndex=e,t.faces.push(P),t.uvs.push([b,M,S,A])}}},computeData:function(){var t={};return t.vertices=[],t.faces=[],t.uvs=[],this.computeLayerData(t,0),this.computeLayerData(t,1,this.getHeight),t},getFaceNormal:function(t,e){this.computeFaceNormals();var i=this.segmentsW*t,r=this.segmentsD*e,a=Math.floor(i),n=Math.floor(r),s=n*this.segmentsW+a;s=2*s+1,a!=Math.round(i)&&n!=Math.round(r)&&s++;var o=this.faces[s];this.vertices[o.a],this.vertices[o.b],this.vertices[o.c];return o.normal.clone()},setHeightMap:function(t){if(this.heightMap=t,"string"==typeof this.heightMap?(this.image=new Image,this.image.src=this.heightMap):ei.isCanvas(this.heightMap)?this.canvas=this.heightMap:ei.isImage(this.heightMap)&&(this.image=this.heightMap),this.image){var e=this;if(this.image.width){var i=document.createElement("canvas");i.width=e.image.width,i.height=e.image.height;var r=i.getContext("2d");r.drawImage(e.image,0,0),e.canvas=i,e.computed=!1,e.computeNodeData(),e.firePropertyChange("width",0,1)}else this.image.onload=function(t){var i=document.createElement("canvas");i.width=e.image.width,i.height=e.image.height;var r=i.getContext("2d");r.drawImage(e.image,0,0),e.canvas=i,e.computed=!1,e.computeNodeData(),e.firePropertyChange("width",0,1)}}},getHeight:function(t,e){if(null==this.canvas)return 0;var i=this.canvas;if(null==this.heightData){for(var r=i.width*i.height,a=new Float32Array(r),n=0;n<r;n++)a[n]=0;for(var s=i.getContext("2d"),o=s.getImageData(0,0,i.width,i.height),l=o.data,h=0,n=0,c=l.length;n<c;n+=4){var u=l[n]+l[n+1]+l[n+2];a[h++]=u/3}this.heightData=a}var f=t*i.width,d=e*i.height,p=Math.floor(f),m=Math.floor(d),g=[],y=[];g.push(p),f!=p&&g.push(p+1),y.push(m),d!=m&&y.push(m+1);var n,h,v,x=g.length*y.length,w=0;for(n=0;n<g.length;n++)for(h=0;h<y.length;h++)v=y[h]*i.width+g[n],w+=this.heightData[v];return w/=x,w=Je.Math.clamp(w,this.minHeight,this.maxHeight),w*=this.heightUnit},getSideIndexMapping:function(){return Je.Terrain.SideIndexMapping},refreshUniforms:function(t){t.heightUnit&&(t.heightUnit.value=this.heightUnit)}}),Je.Terrain.SideIndexMapping={layer0:0,layer1:1},Je.Link=function(t,e,i){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var r=arguments[0];t=r.fromNode,e=r.toNode,this._id=r.id}else this._id=i;Je.Line.call(this),this.setFromNode(t),this.setToNode(e),this._editable=!1},Je.extend(Je.Link,Je.Line,{className:"TGL.Link",___accessor:["linkType","extend","controls"],__SizePropeties:["fromNode","toNode","linkType","extend","controls"],setFromNode:function(t){if(this._fromNode!=t){var e=this._fromNode;this._fromNode=t,this.onPropertyChange(),this.firePropertyChange("fromNode",e,t),this._fromNode=t,e&&(e._removeFromLink(this),e.removePropertyChangeListener(this.handleNodePropertyChange)),this._fromNode&&(this._fromNode._addFromLink(this),this._fromNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getFromNode:function(){return this._fromNode},setToNode:function(t){if(this._toNode!=t){var e=this._toNode;this._toNode=t,this.onPropertyChange(),this.firePropertyChange("toNode",e,t),e&&(e.removePropertyChangeListener(this.handleNodePropertyChange),e._removeToLink(this)),this._toNode&&(this._toNode._addToLink(this),this._toNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getToNode:function(){return this._toNode},isLooped:function(){return this._fromNode===this._toNode&&null!=this._fromNode&&null!=this._toNode},handleNodePropertyChange:function(t){if(t.property.startsWith("position")||"worldMatrix"==t.property){var e=this.vertices;this.onPropertyChange(),this.firePropertyChange("vertices",e,this.vertices)}},computeNodeData:function(){this.computeData()},updateMatrix:function(){},updateWorldMatrix:function(){},computeData:function(){if(null!=this._fromNode&&null!=this._toNode){null==this._extend&&(this._extend=0);var t=this._fromNode.worldMatrix.getPosition(),e=this._toNode.worldMatrix.getPosition(),i=[];if(i.push(t.clone()),"orthogonal.x"==this._linkType){var r=Math.max(t.x,e.x),a=new Ke(r+this._extend,t.y,t.z);i.push(a),a=new Ke(r+this._extend,e.y,e.z),i.push(a)}else if("orthogonal.x.n"==this._linkType){var n=Math.min(t.x,e.x),a=new Ke(n-this._extend,t.y,t.z);i.push(a),a=new Ke(n-this._extend,e.y,e.z),i.push(a)}else if("orthogonal.y"==this._linkType){var s=Math.max(t.y,e.y),a=new Ke(t.x,s+this._extend,t.z);i.push(a),a=new Ke(e.x,s+this._extend,e.z),i.push(a)}else if("orthogonal.y.n"==this._linkType){var o=Math.min(t.y,e.y),a=new Ke(t.x,o-this._extend,t.z);i.push(a),a=new Ke(e.x,o-this._extend,e.z),i.push(a)}else if("orthogonal.z"==this._linkType){var l=Math.max(t.z,e.z),a=new Ke(t.x,t.y,l+this._extend);i.push(a),a=new Ke(e.x,e.y,l+this._extend),i.push(a)}else if("orthogonal.z.n"==this._linkType){var h=Math.min(t.z,e.z),a=new Ke(t.x,t.y,h-this._extend);i.push(a),a=new Ke(e.x,e.y,h-this._extend),i.push(a)}else if("control"==this._linkType){var c=this._controls;if(c&&c.length>0)for(var u=0;u<c.length;u++)c[u]instanceof Ke&&i.push(c[u].clone())}i.push(e.clone()),this.vertices=i}},onPropertyChange:function(){this.vertices=this.vertices||[],this.computeData(),this.computeBoundingBox(),this.selectionData=null,this.boundingSphere=null}}),Je.PathLink=function(t,e,i){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var r=arguments[0];t=r.fromNode,e=r.toNode,this._id=r.id}else this._id=i;Je.PathNode.call(this),this._autoAjust=!0,this.setFromNode(t),this.setToNode(e)},Je.PathLink.allLinkTypes=["extend.x","extend.y","extend.z","extend.x.n","extend.y.n","extend.z.n","orthogonal.x","orthogonal.y","orthogonal.z","orthogonal.x.n","orthogonal.y.n","orthogonal.z.n","flex.x","flex.y","flex.z","flex.yz","flex.xz","flex.xy"],Je.extend(Je.PathLink,Je.PathNode,{className:"TGL.PathLink",___accessor:["linkType","extend","controls","fromOffset","toOffset"],__SizePropeties:["fromOffset","toOffset","path","segments","radius","segmentsR","startCap","endCap","shape","startCapSize","endCapSize","segmentsCap","arc","arcStart","cutSurface","startCapR","endCapR","startCapExtend","endCapExtend","fromNode","toNode","linkType","extend","controls"],setFromNode:function(t){if(this._fromNode!=t){var e=this._fromNode;this._fromNode=t,this._dirtyPath=!0,this.onPropertyChange("fromNode",e,t),this.firePropertyChange("fromNode",e,t),this._fromNode=t,e&&(e._removeFromLink(this),e.removePropertyChangeListener(this.handleNodePropertyChange)),this._fromNode&&(this._fromNode._addFromLink(this),this._fromNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getFromNode:function(){return this._fromNode},setToNode:function(t){if(this._toNode!=t){var e=this._toNode;this._toNode=t,this.onPropertyChange("toNode",e,t),this.firePropertyChange("toNode",e,t),e&&(e.removePropertyChangeListener(this.handleNodePropertyChange),e._removeToLink(this)),this._toNode&&(this._toNode._addToLink(this),this._toNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getToNode:function(){return this._toNode},isLooped:function(){return this._fromNode===this._toNode&&null!=this._fromNode&&null!=this._toNode},handleNodePropertyChange:function(t){var e=t.source,i=t.property;if(i.startsWith("position")||i.startsWith("rotation")||i.startsWith("scale")||"worldMatrix"==i||"linkAgent"===i||e.isSizeChangedProperty(i)||"parent"===i){this.vertices;this._dirtyPath=!0;var r=this;vi.PATH_LINK_COMPUTE_DELAY?setTimeout(function(){r._computePath()},10):r._computePath()}},_resetPath:function(){if(this.path){var t=!1;if("arrow"!==this.endCap)return this.path;if(this.endCapExtend*this.endCapR>1)return this.path;t=!0;var e,i,r,a=this.path,n=new Je.Path,s=a.actions.length,o=null;for(i=0;i<s-1;i++)e=a.actions[i],r=e.args,o=new Je.Vec3(r[0],r[1],r[2]),"moveTo"===e.action?n.moveTo(r[0],r[1],r[2]):"lineTo"===e.action?n.lineTo(r[0],r[1],r[2]):"quadraticCurveTo"===e.action&&(n.curveTo(r[0],r[1],r[2],r[3],r[4],r[5]),o=new Je.Vec3(r[3],r[4],r[5]));if(i=s-1,e=a.actions[i],r=e.args,"lineTo"===e.action){var l=new Je.Vec3(r[0],r[1],r[2]),h=(new Ke).subVectors(l,o).normalize(),s=this.radius*this.endCapSize,c=null;c=(new Ke).subVectors(l,o).length()<s?o.add(h.multiplyScalar(.1)):l.clone().sub(h.multiplyScalar(s)),n.lineTo(c.x,c.y,c.z)}return n}},_getNodeOffset:function(t,e,i){e=t.worldToLocal(e.clone()),i=t.worldToLocal(i.clone());var r=(new Ke).subVectors(i,e),a=r.length(),n=t.getLinkOffset(r);return n&&n.length()>a&&n.normalize().multiplyScalar(a-.1),n||new Ke(0,0,0)},updateMatrix:function(){},updateWorldMatrix:function(t,e){},onPropertyChange:function(t,e,i){"fromNode"!==t&&"toNode"!==t&&"linkType"!==t&&"extend"!==t&&"controls"!==t&&"fromOffset"!==t&&"toOffset"!==t||(this._dirtyPath=!0),Je.Node.prototype.onPropertyChange.call(this,t,e,i)},computeData:function(){return this._computePath(),Je.PathNode.prototype.computeData.call(this)},_clearFromNodeExtend:function(t,e,i){},_flex:function(t,e,i,r,a){t=t.substr(t.indexOf(".")+1);for(var n,s=["x","y","z"],o=new Ke,l=new Ke,h=0;h<3;h++)n=s[h],o[n]=n===t?r[n]:e[n],l[n]=n===t?r[n]:i[n];a.push(o,l)},_flex2:function(t,e,i,r){t=t.substr(t.indexOf(".")+1);var a=["x","y","z"],n=t[0],s=t[1];if(e[n]!=i[n]){for(var o=new mono.Vec3,l=0;l<a.length;l++)o[a[l]]=a[l]==n?i[a[l]]:e[a[l]];r.push(o)}if(e[s]!=i[s]){for(var h=new mono.Vec3,l=0;l<a.length;l++)h[a[l]]=a[l]==n||a[l]==s?i[a[l]]:e[a[l]];r.push(h)}},_orthogonal:function(t,e,i,r){t=t.substr(t.indexOf(".")+1);var a,n=!1,s=["x","y","z"],o=new Ke,l=0;t.endsWith(".n")&&(n=!0,t=t[0]);for(var h=n?e[t]:i[t],c=0;c<s.length;c++)a=s[c],a!==t&&e[a]==i[a]&&l++;if(2!==l){for(var c=0;c<s.length;c++)a=s[c],a!==t?o[a]=h:o[a]=n?i[a]:e[a];r.push(o)}},_removeSamePoint:function(t){},_computePath:function(){if(this._dirtyPath&&(this._dirtyPath=!1,null!=this._fromNode&&null!=this._toNode)){null==this._extend&&(this._extend=0);var t=this._fromNode.getLinkAgent()||this._fromNode,e=this._toNode.getLinkAgent()||this._toNode,i=t.localToWorld2(new Ke(0,0,0)),r=e.localToWorld2(new Ke(0,0,0));if(t==e){var a=new mono.Path;return a.moveTo(i.x,i.y,i.z),a.lineTo(i.x,i.y+200,i.z),a.lineTo(i.x+200,i.y+200,i.z),a.lineTo(i.x+200,i.y,i.z),a.lineTo(i.x,i.y,i.z),this.setPath(a),a}if(i.equals(r))return void this.setPath(null);var a,n,s=[],o=this.radius*this.endCapSize;if(this._linkType&&this._linkType.startsWith("extend")){var i,r,l,h,c,u,f;if("extend.x"===this._linkType){l=new Ke(1,0,0);var i=t.localToWorld2(t.getLinkExtend(l.clone())),r=e.localToWorld2(e.getLinkExtend(l));f=Math.max(i.x,r.x),u=f+this._extend+o+.1,h=new Ke(u,i.y,i.z),c=new Ke(u,r.y,r.z)}else if("extend.y"===this._linkType){l=new Ke(0,1,0);var i=t.localToWorld2(t.getLinkExtend(l.clone())),r=e.localToWorld2(e.getLinkExtend(l));f=Math.max(i.y,r.y),u=f+this._extend+o+.1,h=new Ke(i.x,u,i.z),c=new Ke(r.x,u,r.z)}else if("extend.z"===this._linkType){l=new Ke(0,0,1);var i=t.localToWorld2(t.getLinkExtend(l.clone())),r=e.localToWorld2(e.getLinkExtend(l));f=Math.max(i.z,r.z),u=f+this._extend+o+.1,h=new Ke(i.x,i.y,u),c=new Ke(r.x,r.y,u)}else if("extend.x.n"===this._linkType){l=new Ke((-1),0,0);var i=t.localToWorld2(t.getLinkExtend(l.clone())),r=e.localToWorld2(e.getLinkExtend(l));f=Math.min(i.x,r.x),u=f-this._extend-o-.1,h=new Ke(u,i.y,i.z),c=new Ke(u,r.y,r.z)}else if("extend.y.n"===this._linkType){l=new Ke(0,(-1),0);var i=t.localToWorld2(t.getLinkExtend(l.clone())),r=e.localToWorld2(e.getLinkExtend(l));f=Math.min(i.y,r.y),u=f-this._extend-o-.1,h=new Ke(i.x,u,i.z),c=new Ke(r.x,u,r.z)}else if("extend.z.n"===this._linkType){l=new Ke(0,0,(-1));var i=t.localToWorld2(t.getLinkExtend(l.clone())),r=e.localToWorld2(e.getLinkExtend(l));f=Math.min(i.z,r.z),u=f-this._extend-o-.1,h=new Ke(i.x,i.y,u),c=new Ke(r.x,r.y,u)}h?s.push(i,h,c,r):s.push(i,r)}else{if(s.push(i),"orthogonal.x"===this._linkType){if(i.y!=r.y||i.z!=r.z){var d=r.x,p=new Ke(d,i.y,i.z);s.push(p)}}else if("orthogonal.x.n"===this._linkType){var d=i.x,p=new Ke(d,r.y,r.z);s.push(p)}else if("orthogonal.y"===this._linkType){var m=r.y,p=new Ke(i.x,m,i.z);s.push(p)}else if("orthogonal.y.n"===this._linkType){var m=i.y,p=new Ke(r.x,m,r.z);s.push(p)}else if("orthogonal.z"===this._linkType){var p=new Ke(i.x,i.y,r.z);s.push(p)}else if("orthogonal.z.n"===this._linkType){var p=new Ke(r.x,r.y,i.z);s.push(p)}var g=new Ke(i.x+r.x,i.y+r.y,i.z+r.z).multiplyScalar(.5);if(("flex.x"===this._linkType||"flex.y"===this._linkType||"flex.z"===this._linkType)&&this._flex(this._linkType,i,r,g,s),("flex.yz"===this._linkType||"flex.zy"===this._linkType||"flex.xy"===this._linkType||"flex.yx"===this._linkType||"flex.xz"===this._linkType||"flex.zx"===this._linkType)&&this._flex2(this._linkType,i,r,s),"control"===this._linkType){var y=this.getControls();xi.isArray(y)&&(s=s.concat(y))}s.push(r),n=s.length;var v=this._getNodeOffset(t,s[0].clone(),s[1].clone()),x=this._getNodeOffset(e,s[n-1].clone(),s[n-2].clone());i=t.localToWorld2(v),r=e.localToWorld2(x),s[0]=i,s[n-1]=r}var n=s.length,w=this.getFromOffset(),_=this.getToOffset();w&&s[0].add(w),_&&s[n-1].add(_);for(var b,a=new Je.Path,M=0;M<n;M++)b=s[M],0===M?a.moveTo(b.x,b.y,b.z):a.lineTo(b.x,b.y,b.z);return this.setPath(a),a}}}),mono.LoadingManager=function(t,i,r){var a=this,n=0,s=0;this.onLoad=t,this.onProgress=i,this.onError=r,this.itemStart=function(t){s++},this.itemEnd=function(t){n++,a.onProgress!==e&&a.onProgress(t,n,s),n===s&&a.onLoad!==e&&a.onLoad()}},mono.DefaultLoadingManager=new mono.LoadingManager,mono.ImageLoader=function(t){this.manager=t!==e?t:mono.DefaultLoadingManager},mono.ImageLoader.prototype={constructor:mono.ImageLoader,load:function(t,i,r,a){var n=this,s=document.createElement("img");return i!==e&&s.addEventListener("load",function(e){n.manager.itemEnd(t),i(this)},!1),r!==e&&s.addEventListener("progress",function(t){r(t)},!1),a!==e&&s.addEventListener("error",function(t){a(t)},!1),this.crossOrigin!==e&&(s.crossOrigin=this.crossOrigin),s.src=t,n.manager.itemStart(t),s},loadFile:function(t,i,r,a){var n=this,s=new FileReader;i!==e&&(s.onload=function(){i(s.result),n.manager.itemEnd(t.name)}),r!==e&&s.addEventListener("progress",function(t){r(t)},!1),a!==e&&s.addEventListener("error",function(t){a(t)},!1),s.readAsDataURL(t),n.manager.itemStart(t.name)},setCrossOrigin:function(t){this.crossOrigin=t}},mono.XHRLoader=function(t){this.manager=t!==e?t:mono.DefaultLoadingManager},mono.XHRLoader.prototype={constructor:mono.XHRLoader,load:function(t,i,r,a){var n=this,s=new XMLHttpRequest;i!==e&&s.addEventListener("load",function(e){i(e.target.responseText),n.manager.itemEnd(t)},!1),r!==e&&s.addEventListener("progress",function(t){r(t)},!1),a!==e&&s.addEventListener("error",function(t){a(t)},!1),this.crossOrigin!==e&&(s.crossOrigin=this.crossOrigin),s.open("GET",t,!0),s.send(null),n.manager.itemStart(t)},loadFile:function(t,i,r,a){if(t){var n=this,s=new FileReader;i!==e&&(s.onload=function(){i(s.result),n.manager.itemEnd(t.name)}),r!==e&&s.addEventListener("progress",function(t){r(t)},!1),a!==e&&s.addEventListener("error",function(t){a(t)},!1),s.readAsText(t),n.manager.itemStart(t.name)}},setCrossOrigin:function(t){this.crossOrigin=t}},mono.MTLLoader=function(t,e,i){this.baseUrl=t,this.options=e,this.crossOrigin=i},mono.extend(mono.MTLLoader,null,{constructor:mono.MTLLoader,load:function(t,e,i,r){var a=this,n=new mono.XHRLoader;n.setCrossOrigin(this.crossOrigin),n.load(t,function(t){e(a.parse(t))})},loadFile:function(t,e,i,r){var a=this,n=new mono.XHRLoader;n.loadFile(t,function(t){e(a.parse(t))})},loadText:function(t,e){e(this.parse(t))},parse:function(t){var e=t.split("\n"),i={},r=/\s+/,a={};this.baseUrl||(this.baseUrl={});for(var n=0;n<e.length;n++){var s=e[n];if(s=s.trim(),0!==s.length&&"#"!==s.charAt(0)){var o=s.indexOf(" "),l=o>=0?s.substring(0,o):s;l=l.toLowerCase();var h=o>=0?s.substring(o+1):"";if(h=h.trim(),"newmtl"===l)i={name:h},a[h]=i;else if(i)if("ka"===l||"kd"===l||"ks"===l){var c=h.split(r,3);i[l]=[parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2])]}else if("map_kd"===l||"map_ka"===l){var u=h;if(h.indexOf(".")>0){h=h.substring(0,h.lastIndexOf(".")).toLowerCase();var f={};if(/\-s/.test(h)){var d=/\-s( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;f=d.exec(h);var p=h.split(f[0]);h=p[p.length-1].trim();var m=u.split(f[0]);u=m[m.length-1].trim()}if(/\-t/.test(h)){var d=/\-t( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;f=d.exec(h);var p=h.split(f[0]);h=p[p.length-1].trim();var m=u.split(f[0]);u=m[m.length-1].trim()}}this.baseUrl[h]=u,i[l]=u}else i[l]=h}}var g=new mono.MTLLoader.MaterialCreator(this.baseUrl,this.options);return g.setMaterials(a),g}}),mono.MTLLoader.MaterialCreator=function(t,e){this.baseUrl=t,this.options=e,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:mono.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:mono.RepeatWrapping},mono.extend(mono.MTLLoader.MaterialCreator,mono.EventDispatcher,{constructor:mono.MTLLoader.MaterialCreator,setMaterials:function(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(t){if(!this.options)return t;var e={};for(var i in t){var r=t[i],a={};e[i]=a;for(var n in r){var s=!0,o=r[n],l=n.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(o=[o[0]/255,o[1]/255,o[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===o[0]&&0===o[1]&&0===o[1]&&(s=!1);break;case"d":this.options&&this.options.invertTransparency&&(o=1-o)}s&&(a[l]=o)}}return e},preload:function(){for(var t in this.materialsInfo)this.create(t)},getIndex:function(t){return this.nameLookup[t]},getAsArray:function(){var t=0;for(var e in this.materialsInfo)this.materialsArray[t]=this.create(e),this.nameLookup[e]=t,t++;return this.materialsArray},create:function(t){return this.materials[t]===e&&this.createMaterial_(t),this.materials[t]},createMaterial_:function(t){var e=this,i=this.materialsInfo[t],r={name:t,side:this.side};for(var a in i){var n=i[a];switch(a.toLowerCase()){case"kd":r.diffuse=(new mono.Color).setRGB(n[0],n[1],n[2]);break;case"ka":r.ambient=(new mono.Color).setRGB(n[0],n[1],n[2]);break;case"ks":r.specular=(new mono.Color).setRGB(n[0],n[1],n[2]);break;case"map_kd":if("string"==typeof this.baseUrl)r.map={},r.map.img=this.baseUrl+n,r.map.wrapS=this.wrap,r.map.wrapT=this.wrap;else if("object"==typeof this.baseUrl&&n.indexOf(".")>0){n=n.substring(0,n.lastIndexOf(".")).toLowerCase();var s={};if(/\-s/.test(n)){var o=/\-s( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;s=o.exec(n);var l=n.split(s[0]);n=l[l.length-1].trim(),s.repeatR=parseInt(s[1]),s.repeatC=parseInt(s[2])}if(/\-t/.test(n)){var o=/\-t( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;s=o.exec(n);var l=n.split(s[0]);n=l[l.length-1].trim(),s.repeatR=parseInt(s[1]),s.repeatC=parseInt(s[2])}this.baseUrl[n]&&(r.map={},r.map.img=this.baseUrl[n],r.map.wrapS=e.wrap,r.map.wrapT=e.wrap,r.map.repeatR=s.repeatR||1,r.map.repeatC=s.repeatC||1)}break;case"ns":r.shininess=n;break;case"d":n<1&&(r.transparent=!0,r.opacity=n)}}return r.diffuse&&(r.ambient||(r.ambient=r.diffuse),r.color=r.diffuse),this.materials[t]=r,this.materials[t]},loadTexture:function(t,e,i,r){var a=/\.dds$/i.test(t);if(a)var n=mono.ImageUtils.loadCompressedTexture(t,e,i,r);else{var s=new Image,n=new mono.Texture(s,e),o=new mono.ImageLoader;o.crossOrigin=this.crossOrigin,o.load(t,function(t){n.image=mono.MTLLoader.ensurePowerOfTwo_(t),n.needsUpdate=!0,i&&i(n)})}return n}}),mono.MTLLoader.ensurePowerOfTwo_=function(t){if(!mono.MTLLoader.isPowerOfTwo_(t.width)||!mono.MTLLoader.isPowerOfTwo_(t.height)){var e=document.createElement("canvas");e.width=mono.MTLLoader.nextHighestPowerOfTwo_(t.width),e.height=mono.MTLLoader.nextHighestPowerOfTwo_(t.height);var i=e.getContext("2d");return i.drawImage(t,0,0,t.width,t.height,0,0,e.width,e.height),e}return t},mono.MTLLoader.isPowerOfTwo_=function(t){return 0===(t&t-1)},mono.MTLLoader.nextHighestPowerOfTwo_=function(t){--t;for(var e=1;e<32;e<<=1)t|=t>>e;return t+1},mono.OBJLoader=function(t){this.manager=t!==e?t:mono.DefaultLoadingManager},mono.extend(mono.OBJLoader,Object,{constructor:mono.ObJLoader,load:function(t,e,i,r){var a=this,n=new mono.XHRLoader(a.manager);n.setCrossOrigin(this.crossOrigin),n.load(t,function(t){e(a.parse(t))})},parse:function(t){function i(t,e,i){return new mono.Vec3(t,e,i)}function r(t,e){return new mono.Vec2(t,e)}function a(t,e,i,r){return new mono.Face3(t,e,i,r)}function n(t,i,r,n){n===e?l.faces.push(a(parseInt(t)-(u+1),parseInt(i)-(u+1),parseInt(r)-(u+1))):l.faces.push(a(parseInt(t)-(u+1),parseInt(i)-(u+1),parseInt(r)-(u+1),[d[parseInt(n[0])-1].clone(),d[parseInt(n[1])-1].clone(),d[parseInt(n[2])-1].clone()]))}function s(t,e,i){l.uvs.push([p[parseInt(t)-1].clone(),p[parseInt(e)-1].clone(),p[parseInt(i)-1].clone()])}function o(t,i,r){t[3]===e?(n(t[0],t[1],t[2],r),i!==e&&i.length>0&&s(i[0],i[1],i[2])):(r!==e&&r.length>0?(n(t[0],t[1],t[3],[r[0],r[1],r[3]]),n(t[1],t[2],t[3],[r[1],r[2],r[3]])):(n(t[0],t[1],t[3]),n(t[1],t[2],t[3])),i!==e&&i.length>0&&(s(i[0],i[1],i[3]),s(i[1],i[2],i[3])))}var l,h,c=new mono.Element,u=0;/^o /gm.test(t)===!1&&(l=new mono.Entity,h=new mono.BasicMaterial,l.setStyle("m.type","phong"),c.addChild(l));for(var f=0,d=[],p=[],m=/v( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,g=/vn( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,y=/vt( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,v=/f( +\d+)( +\d+)( +\d+)( +\d+)?/,x=/f( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))?/,w=/f( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))?/,_=/f( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))?/,b=t.split("\n"),M=0;M<b.length;M++){var S=b[M];S=S.trim();var A;if(0!==S.length&&"#"!==S.charAt(0))if(null!==(A=m.exec(S)))l.vertices.push(i(parseFloat(A[1]),parseFloat(A[2]),parseFloat(A[3])));else if(null!==(A=g.exec(S)))d.push(i(parseFloat(A[1]),parseFloat(A[2]),parseFloat(A[3])));else if(null!==(A=y.exec(S)))p.push(r(parseFloat(A[1]),parseFloat(A[2])));else if(null!==(A=v.exec(S)))o([A[1],A[2],A[3],A[4]]);else if(null!==(A=x.exec(S)))o([A[2],A[5],A[8],A[11]],[A[3],A[6],A[9],A[12]]);else if(null!==(A=w.exec(S)))o([A[2],A[6],A[10],A[14]],[A[3],A[7],A[11],A[15]],[A[4],A[8],A[12],A[16]]);else if(null!==(A=_.exec(S)))o([A[2],A[5],A[8],A[11]],[],[A[3],A[6],A[9],A[12]]);else if(/^o /.test(S))l!==e&&(u+=l.vertices.length),l=new mono.Entity,h=new mono.BasicMaterial,l.setStyle("m.type","phong"),l._name=S.substring(2).trim(),c.addChild(l),f=0;else if(!/^g /.test(S))if(/^usemtl /.test(S)){S.substring(7).trim()}else/^mtllib /.test(S)||/^s /.test(S)}for(var M=0,P=c._childList._as.length;M<P;M++){var l=c._childList._as[M];l.computed=!1,l.computeNodeData(),l.computeCentroids(),l.computeFaceNormals(),l.computeBoundingSphere()}return c}}),mono.OBJMTLLoader=function(){},mono.extend(mono.OBJMTLLoader,mono.MTLLoader,{constructor:mono.OBJMTLLoader,load:function(t,e,i,r,a,n){var s=this,o=new mono.MTLLoader(i);o.load(e,function(e){var a=e;a.preload();var n=new mono.XHRLoader(s.manager);n.setCrossOrigin(this.crossOrigin),n.load(t,function(e){var n=s.parse(e),o="";!i&&t.lastIndexOf("/")>0&&(o=t.substring(0,t.lastIndexOf("/")+1));for(var l=0;l<n._childList._as.length;l++){var h=n._childList._as[l];if(h.mname){var c=a.create(h.mname);s.setGeometryStyle(h,c,o)}for(var u=0;u<h._childList._as.length;u++){var f=h._childList._as[u];if(f.mname){var d=a.create(f.mname);s.setGeometryStyle(f,d,o)}}}r(n)})})},setGeometryStyle:function(t,e,i){if(e.map){this.loadTexture(t,i+e.map.img);var r=e.map.repeatR,a=e.map.repeatC;r&&a&&t.setStyle("m.texture.repeat",new mono.Vec2(r,a))}t.setStyle("m.ambient",e.ambient),t.setStyle("m.specular",e.specular),t.setStyle("m.color",e.color),e.transparent&&(t.setStyle("m.transparent",!0),t.setStyle("m.opacity",e.opacity))},loadBase64:function(t,e,i,r,a,n){var s=this,o=mono.base64decode(e),l=mono.base64decode(t),h=new mono.MTLLoader(i);h.loadText(o,function(t){var e=t;e.preload();var a=s.parse(l),n="";!i&&url.lastIndexOf("/")>0&&(n=url.substring(0,url.lastIndexOf("/")+1));for(var o=0;o<a._childList._as.length;o++){var h=a._childList._as[o];if(h.mname){var c=e.create(h.mname);s.setGeometryStyle(h,c,n)}for(var u=0;u<h._childList._as.length;u++){var f=h._childList._as[u];if(f.mname){var d=e.create(f.mname);s.setGeometryStyle(f,d,n)}}}r(a)})},loadFiles:function(t,e,i,r,a,n){var s=this,o=new mono.MTLLoader(i);o.loadFile(e,function(e){var i=e;i.preload();var a=new mono.XHRLoader(s.manager);a.loadFile(t,function(t){for(var e=s.parse(t),a=0;a<e._childList._as.length;a++){var n=e._childList._as[a];if(n.mname){var o=i.create(n.mname);s.setGeometryStyle(n,o)}for(var l=0;l<n._childList._as.length;l++){var h=n._childList._as[l];if(h.mname){var c=i.create(h.mname);s.setGeometryStyle(h,c)}}}r(e)})})},loadTexture:function(t,e){if("string"==typeof e)t.setStyle("m.texture.image",e);else if(t&&e){var i=new mono.ImageLoader;i.loadFile(e,function(e){t.setStyle("m.texture.image",e)})}},parse:function(t,i){function r(t,e,i){return new mono.Vec3(t,e,i)}function a(t,e){return new mono.Vec2(t,e)}function n(t,e,i,r,a){return new mono.Face3(t,e,i,r,null,a)}function s(t,i){if(p.length>0&&(d.vertices=p,v.length>0&&(d.setMaterialSize(v.length),d.setStyle("m.normalType",Je.NormalTypeSmooth)),d.computed=!1,d.computeCentroids(),d.computeFaceNormals(),d.computeBoundingSphere(),d.faces.length>0)){var r=d._name;f.addChild(d),d=new mono.Entity,d._name=r,d.setStyle("m.type","phong"),m=0}t!==e&&(d._name=t),i!==e&&(d.mname=i)}function o(t,i,r,a,s){a===e?d.faces.push(n(parseInt(t)-(c+1),parseInt(i)-(c+1),parseInt(r)-(c+1))):d.faces.push(n(parseInt(t)-(c+1),parseInt(i)-(c+1),parseInt(r)-(c+1),[g[parseInt(a[0])-1].clone(),g[parseInt(a[1])-1].clone(),g[parseInt(a[2])-1].clone()],s))}function l(t,e,i){d.uvs.push([y[parseInt(t)-1].clone(),y[parseInt(e)-1].clone(),y[parseInt(i)-1].clone()])}function h(t,i,r){var a=v.length>0?v.indexOf(x):0;t[3]===e?(o(t[0],t[1],t[2],r,a),i!==e&&i.length>0&&l(i[0],i[1],i[2])):(r!==e&&r.length>0?(o(t[0],t[1],t[3],[r[0],r[1],r[3]],a),o(t[1],t[2],t[3],[r[1],r[2],r[3]],a)):(o(t[0],t[1],t[3]),o(t[1],t[2],t[3])),i!==e&&i.length>0&&(l(i[0],i[1],i[3]),l(i[1],i[2],i[3])))}var c=0,u=new mono.Entity,f=u,d=new mono.Entity;d.setStyle("m.type","phong");for(var p=[],m=0,g=[],y=[],v=[],x=0,w=/v( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,_=/vn( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,b=/vt( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,M=/f( +\d+)( +\d+)( +\d+)( +\d+)?/,S=/f( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))?/,A=/f( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))?/,P=/f( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))?/,T=/s( +(\d))?/,C=t.split("\n"),z=0;z<C.length;z++){var L=C[z];L=L.trim();var E;if(0!==L.length&&("#"!==L.charAt(0)||"o"==L.charAt(2)))if(null!==(E=w.exec(L)))p.push(r(parseFloat(E[1]),parseFloat(E[2]),parseFloat(E[3])));else if(null!==(E=_.exec(L)))g.push(r(parseFloat(E[1]),parseFloat(E[2]),parseFloat(E[3])));else if(null!==(E=b.exec(L)))y.push(a(parseFloat(E[1]),parseFloat(E[2])));else if(null!==(E=M.exec(L)))h([E[1],E[2],E[3],E[4]]);else if(null!==(E=S.exec(L)))h([E[2],E[5],E[8],E[11]],[E[3],E[6],E[9],E[12]]);else if(null!==(E=A.exec(L)))h([E[2],E[6],E[10],E[14]],[E[3],E[7],E[11],E[15]],[E[4],E[8],E[12],E[16]]);else if(null!==(E=P.exec(L)))h([E[2],E[5],E[8],E[11]],[],[E[3],E[6],E[9],E[12]]);else if("#"===L.charAt(0)&&"o"===L.charAt(2))s(),
c+=p.length,p=[],f=new mono.Entity,f._name=L.substring(2).trim(),u.addChild(f);else if(/^g /.test(L))s(L.substring(2).trim(),e);else if(/^usemtl /.test(L))s(e,L.substring(7).trim());else if(/^mtllib /.test(L)){if(i){var D=L.substring(7);D=D.trim(),i(D)}}else/^s /.test(L)&&(E=T.exec(L),v.indexOf(E[2])<0&&v.push(E[2]),x=E[2])}return s(e,e),u}}),DaeAdapter=mono.DaeAdapter=function(){function t(t,r,a){var n=0;if(t!==e){var s=t.split("/");s.pop(),J=(s.length<1?".":s.join("/"))+"/"}var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState){if(0==o.status||200==o.status)if(o.responseXML)i(o.responseXML,r,t);else if(o.responseText){var e=new DOMParser,s=e.parseFromString(o.responseText,"application/xml");i(s,r,t)}else console.error("ColladaLoader: Empty or non-existing file ("+t+")")}else 3==o.readyState&&a&&(0==n&&(n=o.getResponseHeader("Content-Length")),a({total:n,loaded:o.responseText.length}))},o.open("GET",t,!0),o.send(null)}function i(t,e,i){G=t,C(),Y=f(),X=new o,X.parse();var n=O();if(Z=L(),q=D(),K=a(),X)for(var s=0;s<X.nodes.length;s++)r(X.nodes[s]);var l={lights:n,visualScenes:X,images:Z,materials:K,geometries:Y,entityies:Q};e&&e(l)}function r(t,e){if(t){for(var i={},a=0;a<t.geometries.length;a++){var n,s=t.geometries[a],o=s.instance_material,l=Y[s.url],h={},c=[],u=0;if(l){if(!l.mesh||!l.mesh.primitives)continue;if(o)for(var f=0;f<o.length;f++){var d=o[f],p=K[d.target],m=p.instance_effect.url,g=q[m].shader,y=g.material;if(l.doubleSided){if(!(d.symbol in i)){var v=y.clone();v.side=mono.DoubleSide,i[d.symbol]=v}y=i[d.symbol]}y.opacity=y.opacity?y.opacity:1,h[d.symbol]=u,c.push(y),n=y,n.name=null==p.name||""===p.name?p.id:p.name,u++}var x=n||new mono.LambertMaterial({color:14540253,shading:mono.FlatShading,side:l.doubleSided?mono.DoubleSide:mono.FrontSide}),w=l.mesh.node3D;if(u>1)for(x=new mono.ArrayMaterial(c),f=0;f<w.faces.length;f++){var _=w.faces[f];_.materialIndex=h[_.daeMaterial]}x instanceof mono.ArrayMaterial&&w.setMaterialSize(x.materials.length),w.createMaterial(x),w.matrix=t.matrix,w.matrix.decompose(w._position,w.quaternion,w.scale);var b=w.quaternion;if(b){var M=b.x*b.x,S=b.y*b.y,A=b.z*b.z,P=b.w*b.w;w._rotation.x=Math.atan2(2*(b.x*b.w-b.y*b.z),P-M-S+A),w._rotation.y=Math.asin(mono.Math.clamp(2*(b.x*b.z+b.y*b.w),-1,1)),w._rotation.z=Math.atan2(2*(b.z*b.w-b.x*b.y),P+M-S-A)}Q.push(w)}}for(var f=0;f<t.nodes.length;f++)r(t.nodes[f],t)}}function a(){var t=G.querySelectorAll("library_materials material"),e={};if(t&&t.length>0)for(var i=0;i<t.length;i++){var r=t[i];if(r){var a=(new n).parse(r);a&&(e[a.id]=a)}}return e}function n(){this.id="",this.name="",this.instance_effect=null}function s(){this.url=""}function o(){this.nodes=[],this.id="",this.name=""}function l(){this.nodes=[],this.id="",this.name="",this.sid="",this.type="",this.controllers=[],this.geometries=[],this.type="",this.layer="",this.matrix=new mono.Mat4,this.transforms=[]}function h(){this.sid="",this.type="",this.data=[]}function c(){this.url="",this.instance_material=[]}function u(){this.symbol="",this.target=""}function f(){var t={};t.entity=[];var e=G.querySelectorAll("library_geometries geometry");if(e&&e.length>0)for(var i=0;i<e.length;i++){var r=(new d).parse(e[i]);r&&(t[r.id]=r,t.entity.push(r))}return t}function d(){this.id="",this.mesh=null}function p(){this.sources={},this.primitives=[],this.vertices=null,this.node3D=null}function m(t,e){var i=[t[e],t[e+1],t[e+2]];return g(i,-1),new mono.Vec3(i[0],i[1],i[2])}function g(t,e){if($.convertUpAxis===!0&&H!==$.upAxis)switch(j){case"XtoY":var i=t[0];t[0]=e*t[1],t[1]=i;break;case"XtoZ":var i=t[2];t[2]=t[1],t[1]=t[0],t[0]=i;break;case"YtoX":var i=t[0];t[0]=t[1],t[1]=e*i;break;case"YtoZ":var i=t[1];t[1]=e*t[2],t[2]=i;break;case"ZtoX":var i=t[0];t[0]=t[1],t[1]=t[2],t[2]=i;break;case"ZtoY":var i=t[1];t[1]=t[2],t[2]=e*i}}function y(){this.id="",this.input={}}function v(){this.semantic="",this.offset=0,this.source="",this.set=0}function x(){this.inputs=[],this.count=0,this.p=[],this.material=""}function w(){x.call(this),this.vcount=3}function _(){this.id,this.dataType,this.technique_common={},this.accessor=null,this.data=[]}function b(){this.source="",this.count=0,this.stride=0,this.params=[]}function M(t){return t?parseInt(t,10):0}function S(t){return t.replace(/^\s+/,"").replace(/\s+$/,"")}function A(t){var i=[];if(!t)return t;if(t=S(t),t.length>0)for(var r=t.split(/\s+/),a=0;a<r.length;a++){var n=r[a];n!=e&&null!=n&&null!=parseFloat(n)&&i.push(parseFloat(n))}return i}function P(t){var i=[];if(!t)return[];if(t=S(t),t.length>0)for(var r=t.split(/\s+/),a=0;a<r.length;a++){var n=r[a];n!=e&&null!=n&&null!=parseInt(n)&&i.push(parseInt(n))}return i}function T(t){var e=[];if(!t)return[];if(t=S(t),t.length>0)for(var i=t.split(/\s+/),r=0;r<i.length;r++)e.push("true"==i[r]||"1"==i[r]);return e}function C(){if($.convertUpAxis!==!0||H===$.upAxis)j=null;else switch(H){case"X":j="Y"===$.upAxis?"XtoY":"XtoZ";break;case"Y":j="X"===$.upAxis?"YtoX":"YtoZ";break;case"Z":j="X"===$.upAxis?"ZtoX":"ZtoY"}}function z(t){if($.convertUpAxis){var e=[t[0],t[4],t[8]];g(e,-1),t[0]=e[0],t[4]=e[1],t[8]=e[2],e=[t[1],t[5],t[9]],g(e,-1),t[1]=e[0],t[5]=e[1],t[9]=e[2],e=[t[2],t[6],t[10]],g(e,-1),t[2]=e[0],t[6]=e[1],t[10]=e[2],e=[t[0],t[1],t[2]],g(e,-1),t[0]=e[0],t[1]=e[1],t[2]=e[2],e=[t[4],t[5],t[6]],g(e,-1),t[4]=e[0],t[5]=e[1],t[6]=e[2],e=[t[8],t[9],t[10]],g(e,-1),t[8]=e[0],t[9]=e[1],t[10]=e[2],e=[t[3],t[7],t[11]],g(e,-1),t[3]=e[0],t[7]=e[1],t[11]=e[2]}return new mono.Mat4(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function L(){var t=G.querySelectorAll("library_images image"),e={};if(t&&t.length>0)for(var i=0;i<t.length;i++){var r=t[i];if(r){var a=(new E).parse(r);e[a.id]=a}}return e}function E(){this.id="",this.init_from=""}function D(){var t=G.querySelectorAll("library_effects effect"),e={};if(t&&t.length>0)for(var i=0;i<t.length;i++){var r=t[i];if(r){var a=(new N).parse(r);e[a.id]=a}}return e}function N(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function B(t,e){this.type=t,this.effect=e,this.material=null}function R(){this.color=new mono.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function F(t){this.effect=t,this.init_from=null,this.format=null}function I(t){this.effect=t,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function k(t){for(var i=G.querySelectorAll("library_nodes node"),r=0;r<i.length;r++){var a=i[r].attributes.getNamedItem("id");if(a&&a.value===t)return i[r]}return e}function V(t,e){t.doubleSided=!1;var i=e.querySelectorAll("extra double_sided")[0];i&&i&&1===parseInt(i.textContent,10)&&(t.doubleSided=!0)}function O(){var t=[],e=G.querySelectorAll("library_lights light");if(e&&e.length>0)for(var i=0;i<e.length;i++){var r=(e[i],(new U).parse(e));t.push(r)}return t}function U(){this.id="",this.name="",this.technique=""}this.id="",this.name="",this.type="";var G=null,H="Y",j=null,X=null,W={},Y={},q={},Z={},J="",Q=[],K={},$={};return n.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");for(var e=0;e<t.childNodes.length;e++)if("instance_effect"==t.childNodes[e].nodeName){this.instance_effect=(new s).parse(t.childNodes[e]);break}return this},s.prototype.parse=function(t){return this.url=t.getAttribute("url").replace(/^#/,""),this},o.prototype.parse=function(){var t=G.querySelectorAll("library_visual_scenes visual_scene");if(!t||t.length<0)return this;this.id="",this.name="";for(var e=0;e<t.length;e++){var i=t[e];if(i&&i.childNodes&&i.childNodes.length>0)for(var r=0;r<i.childNodes.length;r++){var a=i.childNodes[r];if(a&&a.nodeName)switch(a.nodeName){case"node":this.nodes.push((new l).parse(a))}}}return this},l.prototype.parse=function(t){if(!t)return this;if(this.id=t.getAttribute("id"),this.sid=t.getAttribute("sid"),this.name=t.getAttribute("name"),this.type=t.getAttribute("type"),this.layer=t.getAttribute("layer"),this.type="JOINT"==this.type?this.type:"NODE",t.childNodes.length>0)for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(i&&i.nodeName)switch(i.nodeName){case"node":this.nodes.push((new l).parse(i));break;case"instance_camera":break;case"instance_controller":break;case"instance_geometry":this.geometries.push((new c).parse(i));break;case"instance_light":break;case"instance_node":var r=i.getAttribute("url").replace(/^#/,""),a=k(r);a&&this.nodes.push((new l).parse(a));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new h).parse(i));break;case"extra":break;default:console.log(i.nodeName)}}return this.updateMatrix(),this},l.prototype.updateMatrix=function(){this.matrix.identity();for(var t=0;t<this.transforms.length;t++)this.transforms[t].apply(this.matrix)},h.prototype.parse=function(t){return this.sid=t.getAttribute("sid"),this.type=t.nodeName,this.data=A(t.textContent),this.convert(),this},h.prototype.convert=function(){switch(this.type){case"matrix":this.obj=z(this.data);break;case"rotate":this.angle=mono.Math.degToRad(this.data[3]);case"translate":g(this.data,-1),this.obj=new mono.Vec3(this.data[0],this.data[1],this.data[2]);break;case"scale":g(this.data,1),this.obj=new mono.Vec3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},h.prototype.apply=function(){var t=new mono.Mat4;return function(e){switch(this.type){case"matrix":e.multiply(this.obj);break;case"translate":e.multiply(t.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":e.multiply(t.makeRotationAxis(this.obj,this.angle));break;case"scale":e.scale(this.obj)}}}(),h.prototype.update=function(t,e){var i=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(e)if(1===e.length)switch(e[0]){case 0:this.obj.n11=t[0],this.obj.n21=t[1],this.obj.n31=t[2],this.obj.n41=t[3];break;case 1:this.obj.n12=t[0],this.obj.n22=t[1],this.obj.n32=t[2],this.obj.n42=t[3];break;case 2:this.obj.n13=t[0],this.obj.n23=t[1],this.obj.n33=t[2],this.obj.n43=t[3];break;case 3:this.obj.n14=t[0],this.obj.n24=t[1],this.obj.n34=t[2],this.obj.n44=t[3]}else if(2===e.length){var r="n"+(e[0]+1)+(e[1]+1);this.obj[r]=t}else console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(t);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(e)&&(e=i[e[0]]),e){case"X":this.obj.x=t;break;case"Y":this.obj.y=t;break;case"Z":this.obj.z=t;break;default:this.obj.x=t[0],this.obj.y=t[1],this.obj.z=t[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(e)&&(e=i[e[0]]),e){case"X":this.obj.x=t;break;case"Y":this.obj.y=t;break;case"Z":this.obj.z=t;break;case"ANGLE":this.angle=mono.Math.degToRad(t);break;default:this.obj.x=t[0],this.obj.y=t[1],this.obj.z=t[2],this.angle=mono.Math.degToRad(t[3])}}},c.prototype.parse=function(t){this.url=t.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType&&"bind_material"==i.nodeName){for(var r=i.querySelectorAll("instance_material"),a=0;a<r.length;a++){var n=r[a];this.instance_material.push((new u).parse(n))}break}}return this},u.prototype.parse=function(t){return this.symbol=t.getAttribute("symbol"),this.target=t.getAttribute("target").replace(/^#/,""),this},d.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(i&&"mesh"==i.nodeName){var r=new p,a=r.parse(i);a&&(this.mesh=a)}}return this},p.prototype.parse=function(t){if(t&&t.childNodes&&t.childNodes.length>0)for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];switch(i.nodeName){case"source":var r=i.getAttribute("id");this.sources[r]=(new _).parse(i);break;case"vertices":var a=new y;this.vertices=a.parse(i);break;case"polygons":var n=(new x).parse(i);n&&this.primitives.push(n);break;case"triangles":var s=(new w).parse(i);s&&this.primitives.push(s);break;case"polylist":var o=null;this.primitives.push(o)}}this.node3D=new mono.Entity;var l=null;for(this.vertices&&this.vertices.input&&this.vertices.input.POSITION&&(l=this.sources[this.vertices.input.POSITION.source].data),e=0;e<this.primitives.length;e++){var h=this.primitives[e];h.setVertices(this.vertices),this.handlePrimitive(h,this.node3D)}for(e=0;e<l.length;e+=3)this.node3D.vertices.push(m(l,e).clone());return this.node3D.computeFaceNormals(),this},p.prototype.handlePrimitive=function(t,i){var r,a,n,s,o,l,h,c=t.p,u=t.inputs,f=0,d=3,p=0,g=[];for(r=0;r<u.length;r++){n=u[r];var y=n.offset+1;switch(p=p<y?y:p,n.semantic){case"TEXCOORD":g.push(n.set)}}for(var v=0;v<c.length;++v)for(var x=c[v],w=0;w<x.length;){var _=[],b=[],M=null,S=[];for(d=t.vcount?t.vcount.length?t.vcount[f++]:t.vcount:x.length/p,r=0;r<d;r++)for(a=0;a<u.length;a++)switch(n=u[a],l=this.sources[n.source],s=x[w+r*p+n.offset],h=l.accessor.params.length,o=s*h,n.semantic){case"VERTEX":_.push(s);break;case"NORMAL":b.push(m(l.data,o));break;case"TEXCOORD":M=M||{},M[n.set]===e&&(M[n.set]=[]),M[n.set].push(new mono.Vec2(l.data[o],l.data[o+1]));break;case"COLOR":S.push((new mono.Color).setRGB(l.data[o],l.data[o+1],l.data[o+2]))}if(0==b.length)if(n=this.vertices.input.NORMAL){l=l[n.source],h=l.accessor.params.length;for(var A=0,P=_.length;A<P;A++)b.push(m(l.data,_[A]*h))}else i.calcNormals=!0;if(!M&&(M={},n=this.vertices.input.TEXCOORD)){g.push(n.set),l=sources[n.source],h=l.accessor.params.length;for(var A=0,P=_.length;A<P;A++)o=_[A]*h,M[n.set]===e&&(M[n.set]=[]),M[n.set].push(new mono.Vec2(l.data[o],1-l.data[o+1]))}if(0==S.length&&(n=this.vertices.input.COLOR)){l=sources[n.source],h=l.accessor.params.length;for(var A=0,P=_.length;A<P;A++)o=_[A]*h,S.push((new mono.Color).setRGB(l.data[o],l.data[o+1],l.data[o+2]))}var T,C,z=null,L=[];if(3===d)L.push(new mono.Face3(_[0],_[1],_[2],b,S.length?S:new mono.Color(16711680)));else if(4===d)L.push(new mono.Face3(_[0],_[1],_[3],[b[0],b[1],b[3]],S.length?[S[0],S[1],S[3]]:new mono.Color(16711680))),L.push(new mono.Face3(_[1],_[2],_[3],[b[1],b[2],b[3]],S.length?[S[1],S[2],S[3]]:new mono.Color(16711680)));else if(d>4&&$.subdivideFaces){var E=S.length?S:new mono.Color;for(a=1;a<d-1;)L.push(new mono.Face3(_[0],_[a],_[a+1],[b[0],b[a++],b[a]],E))}if(L.length)for(var A=0,P=L.length;A<P;A++)for(z=L[A],z.daeMaterial=t.material,i.faces.push(z),a=0;a<g.length;a++)T=M[g[a]],C=d>4?[T[0],T[A+1],T[A+2]]:4===d?0===A?[T[0],T[1],T[3]]:[T[1].clone(),T[2],T[3].clone()]:[T[0],T[1],T[2]],i.uvs===e&&(i.uvs=[]),i.uvs.push(C);else console.log("dropped face with vcount "+d+" for geometry with id: "+i.id);w+=p*d}},y.prototype.parse=function(t){if(t&&(this.id=t.getAttribute("id"),t.childNodes.length>0))for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(i&&i.nodeName)switch(i.nodeName){case"input":var r=(new v).parse(i);this.input[r.semantic]=r}}return this},v.prototype.parse=function(t){return t&&(this.semantic=t.getAttribute("semantic"),this.offset=M(t.getAttribute("offset")),this.set=M(t.getAttribute("set")),this.source=t.getAttribute("source").replace(/^#/,""),"TEXCOORD"==this.semantic&&this.set<0&&(this.set=0)),this},x.prototype.parse=function(t){if(t&&(this.count=t.getAttribute("count"),this.material=t.getAttribute("material"),t.childNodes.length>0))for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(i&&i.nodeName)switch(i.nodeName){case"input":var r=(new v).parse(i);r&&this.inputs.push(r);break;case"p":this.p.push(P(i.textContent))}}return this},x.prototype.setVertices=function(t){for(var e=0;e<this.inputs.length;e++)this.inputs[e].source==t.id&&(this.inputs[e].source=t.input.POSITION.source)},w.prototype=Object.create(x.prototype),_.prototype.parse=function(t){if(!t)return this;if(this.id=t.getAttribute("id"),t.childNodes.length>0)for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(i&&i.nodeName)switch(i.nodeName){case"float_array":this.dataType=i.nodeName,this.data=A(i.textContent);break;case"bool_array":this.dataType=i.nodeName,this.data=T(i.textContent);break;case"int_array":this.data=P(i.textContent),this.dataType=i.nodeName;break;case"technique_common":if(i.childNodes&&i.childNodes.length>0)for(var r=0;r<i.childNodes.length;r++){var a=i.childNodes[r];if(a&&a.nodeName)switch(a.nodeName){case"accessor":var n=(new b).parse(a);n.source&&(this.technique_common[n.source]=n,this.accessor=n)}}}}return this},_.prototype.read=function(){var t=[],e=this.accessor.params[0];switch(e.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var i=0;i<this.data.length;i+=16){var r=this.data.slice(i,i+16),a=z(r);t.push(a)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+e.type+".")}return t},b.prototype.parse=function(t){if(!t)return this;if(this.source=t.getAttribute("source"),this.count=M(t.getAttribute("count")),this.stride=M(t.getAttribute("stride")),t.childNodes.length>0)for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(i&&i.nodeName)switch(i.nodeName){case"param":var r={};r.name=i.getAttribute("name"),r.type=i.getAttribute("type"),this.params.push(r)}}return this},E.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];"init_from"==i.nodeName&&(this.init_from=i.textContent)}return this},N.prototype.create=function(){if(null==this.shader)return null},N.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),V(this,t),this.shader=null;for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(i))}}return this},N.prototype.parseNewparam=function(t){for(var e=t.getAttribute("sid"),i=0;i<t.childNodes.length;i++){var r=t.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"surface":this.surface[e]=new F(this).parse(r);break;case"sampler2D":this.sampler[e]=new I(this).parse(r);break;case"extra":break;default:console.log(r.nodeName)}}},N.prototype.parseProfileCOMMON=function(t){for(var e,i=0;i<t.childNodes.length;i++){var r=t.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"profile_COMMON":this.parseProfileCOMMON(r);break;case"technique":e=r;break;case"newparam":this.parseNewparam(r);break;case"image":var a=(new E).parse(r);Z[a.id]=a;break;case"extra":break;default:console.log(r.nodeName)}}return e},N.prototype.parseTechnique=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new B(i.nodeName,this).parse(i);break;case"extra":this.parseExtra(i)}}},N.prototype.parseExtra=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"technique":this.parseExtraTechnique(i)}}},N.prototype.parseExtraTechnique=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"bump":this.shader.parse(i)}}},B.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[i.nodeName]=(new R).parse(i);break;case"bump":var r=i.getAttribute("bumptype");r?"heightfield"===r.toLowerCase()?this.bump=(new R).parse(i):"normalmap"===r.toLowerCase()?this.normal=(new R).parse(i):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+r+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new R).parse(i)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new R).parse(i));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var a=i.querySelectorAll("float");a.length>0&&(this[i.nodeName]=parseFloat(a[0].textContent))}}return this.create(),this},B.prototype.create=function(){var t={},i=!1;if(this.transparency!==e&&this.transparent!==e){var r=(this.transparent,(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency);r>0&&(i=!0,t.transparent=!0,t.opacity=1-r)}var a={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var n in this)switch(n){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var s=this[n];if(s instanceof R)if(s.isTexture()){var o=s.texture,l=this.effect.sampler[o],h=null;if(l!==e&&l.source!==e){var c=this.effect.surface[l.source];h=Z[c.init_from]}else h=Z[o];if(h){var u=J+h.init_from,f=new Image;f.loaded=!1;var d=new mono.Texture;d._imageSrc=u,d._image=f,d.setImage(u),d.wrapS=s.texOpts.wrapU?mono.RepeatWrapping:mono.ClampToEdgeWrapping,d.wrapT=s.texOpts.wrapV?mono.RepeatWrapping:mono.ClampToEdgeWrapping,d.offsetX=s.texOpts.offsetU,d.offsetY=s.texOpts.offsetV,d.repeatX=s.texOpts.repeatU,d.repeatY=s.texOpts.repeatV,t[a[n]]=d,"emission"===n&&(t.emissive=16777215)}}else"diffuse"!==n&&i||("emission"===n?t.emissive=s.color.getHex():t[n]=s.color.getHex());break;case"shininess":t[n]=this[n];break;case"reflectivity":t[n]=this[n],t[n]>0&&(t.envMap=$.defaultEnvMap),t.combine=mono.MixOperation;break;case"index_of_refraction":t.refractionRatio=this[n],1!==this[n]&&(t.envMap=$.defaultEnvMap);break;case"transparency":}switch(t.shading=mono.SmoothShading,t.side=this.effect.doubleSided?mono.DoubleSide:mono.FrontSide,this.type){case"constant":t.emissive!=e&&(t.color=t.emissive),this.material=new mono.EntityMaterial(t);break;case"phong":case"blinn":t.diffuse!=e&&(t.color=t.diffuse),this.material=new mono.EntityMaterial(t);break;case"lambert":default:t.diffuse!=e&&(t.color=t.diffuse),this.material=new mono.LambertMaterial(t)}return this.material},R.prototype.isColor=function(){return null==this.texture},R.prototype.isTexture=function(){return null!=this.texture},R.prototype.parse=function(t){"transparent"==t.nodeName&&(this.opaque=t.getAttribute("opaque"));for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"color":var r=A(i.textContent);this.color=new mono.Color,this.color.setRGB(r[0],r[1],r[2]),this.color.a=r[3];break;case"texture":this.texture=i.getAttribute("texture"),this.texcoord=i.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(i)}}return this},R.prototype.parseTexture=function(t){if(!t.childNodes)return this;t.childNodes[1]&&"extra"===t.childNodes[1].nodeName&&(t=t.childNodes[1],t.childNodes[1]&&"technique"===t.childNodes[1].nodeName&&(t=t.childNodes[1]));for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];switch(i.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?this.texOpts[i.nodeName]=1:this.texOpts[i.nodeName]=parseInt(i.textContent);break;default:this.texOpts[i.nodeName]=i.textContent}}return this},F.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"init_from":this.init_from=i.textContent;break;case"format":this.format=i.textContent;break;default:console.log("unhandled Surface prop: "+i.nodeName)}}return this},I.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"source":this.source=i.textContent;break;case"minfilter":this.minfilter=i.textContent;break;case"magfilter":this.magfilter=i.textContent;break;case"mipfilter":this.mipfilter=i.textContent;break;case"wrap_s":this.wrap_s=i.textContent;break;case"wrap_t":this.wrap_t=i.textContent;break;default:console.log("unhandled Sampler2D prop: "+i.nodeName)}}return this},U.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"technique_common":this.parseCommon(i);break;case"technique":this.parseTechnique(i)}}return this},U.prototype.parseCommon=function(t){for(var e=0;e<t.childNodes.length;e++)switch(t.childNodes[e].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=t.childNodes[e].nodeName;for(var i=t.childNodes[e],r=0;r<i.childNodes.length;r++){var a=i.childNodes[r];switch(a.nodeName){case"color":var n=A(a.textContent);this.color=new mono.Color(0),this.color.setRGB(n[0],n[1],n[2]),this.color.a=n[3];break;case"falloff_angle":this.falloff_angle=parseFloat(a.textContent);break;case"quadratic_attenuation":var s=parseFloat(a.textContent);this.distance=s?Math.sqrt(1/s):0}}}return this},U.prototype.parseTechnique=function(t){this.profile=t.getAttribute("profile");for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];switch(i.nodeName){case"intensity":this.intensity=parseFloat(i.textContent)}}return this},{load:t,parse:i,geometries:W,options:$}},Je.DataBox=function(t){Je.DataBox.superClass.constructor.apply(this,arguments),1===arguments.length&&(this._name=t),this._dataList=new ci,this._dataMap={},this._rootList=new ci,this._rootMap={},this._clientMap={},this._lightList=new ci,this._billboardList=new ci,this._nodeList=new ci,this._annotationList=new ci,this._particleList=new ci,this.nodes=[],this.particles=[],this.billboards=[],this._dataBoxChangeDispatcher=new Je.EventDispatcher,this._dataPropertyChangeDispatcher=new Je.EventDispatcher,this._groupLists={},this.selection=new ci,this instanceof Je.AlarmBox||(this._selectionModel=new Je.SelectionModel(this),this._alarmBox=new Je.AlarmBox(this),this._alarmStatePropagator=new Je.AlarmStatePropagator(this),this._alarmStatePropagator.setEnable(!0)),this.batch=!1,this._clientMap={}},Je.extend(Je.DataBox,Je.PropertyChangeDispatcher,{constructor:Je.DataBox,className:"TGL.DataBox",___accessor:["name"],add:function(t,e){if(t){1===arguments.length&&(e=-1);var i=t.getId();if(this._dataMap.hasOwnProperty(i)){if(this._dataMap[i]!==t)throw"Data with ID '"+i+"' already exists"}else this._dataMap[i]=t,this._dataList.add(t),t.getParent()||(this._rootMap[i]=t,e>=0?this._rootList.add(t,e):this._rootList.add(t)),t instanceof Je.Billboard?this._billboardList.add(t):t instanceof Je.Node?this._nodeList.add(t):t instanceof Je.Particle?this._particleList.add(t):t instanceof Je.Annotation?this._annotationList.add(t):t instanceof Je.Light&&this._lightList.add(t),this._dataBoxChangeDispatcher.fire({kind:"add",data:t,source:this}),t.getGroupId()&&this.groupElements(t,null,t.getGroupId()),t.addPropertyChangeListener(this.handleDataPropertyChange,this),t._selected=!1}},onPropertyChange:function(){},firePropertyChange:function(){},addByDescendant:function(t,e){e&&0==e(t)||t&&(this.add(t),t.getChildren().size()>0&&t.getChildren().forEach(function(t){this.addByDescendant(t,e)},this))},getAlarmBox:function(){return this._alarmBox},removeById:function(t,e){var i=this.getDataById(t);this.remove(i,e)},remove:function(t,e){if(t&&this._dataMap.hasOwnProperty(t.getId())){t instanceof Je.Link&&(t.setFromNode(null),t.setToNode(null)),t instanceof Je.Node&&t.getLinks()&&t.getLinks().toList().forEach(function(t){this.remove(t)},this),e&&(t.getChildren().forEach(function(e){t.removeChild(e)},this),t.getParent()&&t.getParent().removeChild(t)),this._dataList.remove(t);var i=t._id;delete this._dataMap[i],this._rootMap[i]&&(delete this._rootMap[i],this._rootList.remove(t)),t instanceof Je.Billboard?this._billboardList.remove(t):t instanceof Je.Node?this._nodeList.remove(t):t instanceof Je.Particle?this._particleList.remove(t):t instanceof Je.Annotation?this._annotationList.remove(t):t instanceof Je.Light&&this._lightList.remove(t),t.getGroupId()&&this.groupElements(t,t.getGroupId(),null),t.removePropertyChangeListener(this.handleDataPropertyChange,this),this._dataBoxChangeDispatcher.fire({kind:"remove",data:t,source:this}),this._selectionModel&&this._selectionModel.removeSelection(t)}},removeByDescendant:function(t,e,i){if(t){var r=this;t.hasChildren()&&t.getChildren().forEachReverse(function(t){r.removeByDescendant(t,e,i)}),i&&0==i(t)||this.remove(t,e)}},containsById:function(t){return this._dataMap.hasOwnProperty(t)},contains:function(t){return!!t&&this._dataMap[t._id]===t},lightsSize:function(){return this._lightList.size()},getLights:function(){return this._lightList},getLightsArray:function(){return this._lightList.toArray()},getAnnotations:function(){return this._annotationList},clear:function(t){if(this._dataList.size()>0){var e=this._dataList.toList(function(e){return!this._lightList.contains(e)||t},this);if(e.forEach(function(t){t.removePropertyChangeListener(this.handleDataPropertyChange,this)},this),this._dataList.clear(),this._dataMap={},this._rootList.clear(),this._rootMap={},this._nodeList.clear(),this._billboardList.clear(),t)this._lightList.clear();else{var i=this;this._lightList.forEach(function(t){i._dataList.add(t);var e=t.getId();i._dataMap[e]=t,null==t.getParent()&&(i._rootList.add(t),i._rootMap[e]=t)})}this._dataBoxChangeDispatcher.fire({kind:"clear",datas:e}),this.clearSelection()}},startBatch:function(){this.batch=!0},endBatch:function(){this.batch=!1,this._dataBoxChangeDispatcher.fire({kind:"batchEnd"})},removeSelection:function(){var t=this._selectionModel.toSelection();t.forEach(function(t){this.remove(t)},this)},clearSelection:function(){this._selectionModel&&this._selectionModel.clearSelection()},clearEditing:function(){this._nodeList.forEach(function(t){t.editing=!1}),this._billboardList.forEach(function(t){t.editing=!1})},getDataById:function(t){return this._dataMap[t]},groupElements:function(t,e,i){var r;e&&(r=this._groupLists[e],r&&(r.remove(t),r.isEmpty()&&delete this._groupLists[e])),i&&(r=this._groupLists[i],null==r&&(r=new ci,this._groupLists[i]=r),r.contains(t)||r.add(t))},synchronizeGroup:function(t,e,i,r){if(!this.isAdjustingGroup){this.isAdjustingGroup=!0;var a=t.getGroupId(),n=new Je.Vec3;if(a){var s=this._groupLists[a];s&&s.size()>1&&s.forEach(function(a){a!==t&&!a.isDescendantOf(t)&&!t.isDescendantOf(a)&&(n.subVectors(i,e),a[Je.setter(r)](a[Je.getter(r)]().clone().add(n)))})}this.isAdjustingGroup=!1}},handleDataPropertyChange:function(t){var e=t.source;if("parent"===t.property){var i=e.getId();e.getParent()?this._rootMap[i]&&(delete this._rootMap[i],this._rootList.remove(e)):this._rootMap[i]||(this._rootMap[i]=e,this._rootList.add(e))}else if("groupId"===t.property){var r=t.oldValue,a=t.newValue;this.groupElements(e,r,a)}else"position"===t.property||"scale"===t.property||"rotation"===t.property?this.synchronizeGroup(e,t.oldValue,t.newValue,t.property):"selected"===t.property&&(e._selected?this._selectionModel.appendSelection(e):this._selectionModel.removeSelection(e));this.onDataPropertyChanged(e,t),this._dataPropertyChangeDispatcher.fire(t)},onDataPropertyChanged:function(t,e){},addDataBoxChangeListener:function(t,e,i){this._dataBoxChangeDispatcher.add(t,e,i)},removeDataBoxChangeListener:function(t,e){this._dataBoxChangeDispatcher.remove(t,e)},addDataPropertyChangeListener:function(t,e,i){this._dataPropertyChangeDispatcher.add(t,e,i)},removeDataPropertyChangeListener:function(t,e){this._dataPropertyChangeDispatcher.remove(t,e)},allocateLights:function(){var t,e,i,r,a,n,s,i;r=a=n=s=0;var o=this._lightList;for(t=0,e=o.size();t<e;t++)i=o.get(t),i.onlyShadow||(i instanceof Je.DirectionalLight&&r++,i instanceof Je.PointLight&&a++,i instanceof Je.SpotLight&&n++);return{directional:r,point:a,spot:n,hemi:s}},allocateShadows:function(){var t,e,i,r=0,a=this._lightList;for(t=0,e=a.size();t<e;t++)i=a.get(t),i.castShadow&&(i instanceof Je.SpotLight&&r++,i instanceof Je.DirectionalLight&&!i.shadowCascade&&r++);return r},allocatePointShadows:function(){var t,e,i,r=0,a=this._lightList;for(t=0,e=a.size();t<e;t++)i=a.get(t),i.castShadow&&i instanceof Je.PointLight&&r++;return r},getSelectionModel:function(){
return this._selectionModel},size:function(){return this._dataList.size()},isEmpty:function(){return this._dataList.isEmpty()},getLimit:function(){return this._limit},setLimit:function(t){var e=this._limit;this._limit=t,this.firePropertyChange("limit",e,t),this._checkLimit()},_checkLimit:function(){this._limit>=0&&this.size()>this._limit&&this.removeFirst(this.size()-this._limit)},removeFirst:function(t){for(0===arguments.length&&(t=1);t>0&&this._dataList.size()>0;){var e=this._dataList.get(0);this.remove(e),t--}},getSiblings:function(t){if(!this.contains(t))throw t+" dosen't belong to this dataBox";var e=t.getParent();return e?e.getChildren():this._rootList},getRoots:function(){return this._rootList},getSiblingIndex:function(t){return t.getParent()?t.getParent().getChildren().indexOf(t):this._rootList.indexOf(t)},getNodes:function(){return this._nodeList},getBillboards:function(){return this._billboardList},getDatas:function(){return this._dataList},getDataAt:function(t){return this._dataList.get(t)},toDatas:function(t,e){return this._dataList.toList(t,e)},forEach:function(t,e){this._dataList.forEach(t,e)},forEachReverse:function(t,e){this._dataList.forEachReverse(t,e)},forEachByDepthFirst:function(t,e,i){if(e)this._depthFirst(t,e,i);else for(var r=this._rootList.size(),a=0;a<r;a++){var n=this._rootList.get(a);if(this._depthFirst(t,n,i)===!1)return}},_depthFirst:function(t,e,i){for(var r=e.getChildrenSize(),a=0;a<r;a++){var n=e.getChildAt(a);if(this._depthFirst(t,n,i)===!1)return!1}if(i){if(t.call(i,e)===!1)return!1}else if(t(e)===!1)return!1},forEachByBreadthFirst:function(t,e,i){var r=new ci;for(e?r.add(e):this._rootList.forEach(r.add,r);r.size()>0;)if(e=r.removeAt(0),e.getChildren().forEach(r.add,r),i){if(t.call(i,e)===!1)return}else if(t(e)===!1)return},getAlarmStatePropagator:function(){return this._alarmStatePropagator},setAlarmStatePropagator:function(t){this._alarmStatePropagator!=t&&(this._alarmStatePropagator&&this._alarmStatePropagator.setEnable(!1),this._alarmStatePropagator=t,this._alarmStatePropagator.setEnable(!0))},setClient:function(t,e){if(null==t)return this;null==this._clientMap&&(this._clientMap=new Object);var i=this._clientMap[t];if(i!==e)return null==e?delete this._clientMap[t]:this._clientMap[t]=e,this._clientMap[t]=e,this.firePropertyChange("C:"+t,i,e),this},getClient:function(t){return this._clientMap[t]}}),Je.QuickFinder=function(t,e,i,r,a){if(this._map={},!t)throw"dataBox can not be null";if(!e)throw"propertyName can not be null";this._dataBox=t,this._propertyName=e,this._propertyType=i||"accessor","accessor"===this._propertyType&&(this._getter=Je.getter(e)),this._valueFunction=r||this.getValue,this._filterFunction=a||this.isInterested,this._dataBox.forEach(this._addData,this),this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this,!0)},Je.extend(Je.QuickFinder,Object,{_NULL_:"mono-null-key",getValueFunction:function(){return this._valueFunction},getFilterFunction:function(){return this._filterFunction},handleDataBoxChange:function(t){"add"===t.kind?this._addData(t.data):"remove"===t.kind?this._removeData(t.data):"clear"===t.kind&&(this._map={})},handleDataPropertyChange:function(t){if(this._filterFunction.call(this,t.source)&&("accessor"===this._propertyType&&this._propertyName===t.property||"style"===this._propertyType&&t.source.IStyle&&"S:"+this._propertyName===t.property||"client"===this._propertyType&&"C:"+this._propertyName===t.property)){var e=this._getMap(t.oldValue);e&&e.remove(t.source),this._addData(t.source)}},_getMap:function(t){return t=null==t?this._NULL_:t,this._map[t]},find:function(t){var e=this._getMap(t);return e?e.toList():new ci},findFirst:function(t){var e=this._getMap(t);return!e||e.isEmpty()?null:e.get(0)},_addData:function(t){if(this._filterFunction.call(this,t)){var e=this._valueFunction.call(this,t),i=this._getMap(e);i||(i=new ci,e=null==e?this._NULL_:e,this._map[e]=i),i.add(t)}},_removeData:function(t){if(this._filterFunction.call(this,t)){var e=this._valueFunction.call(this,t),i=this._getMap(e);i&&(i.remove(t),i.isEmpty()&&(e=null==e?this._NULL_:e,delete this._map[e]))}},dispose:function(){this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),delete this._dataBox},getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isInterested:function(t){return!("style"===this._propertyType&&!t.IStyle)&&!("accessor"===this._propertyType&&this._valueFunction===this.getValue&&!t[this._getter])},getValue:function(t){return"accessor"===this._propertyType?t[this._getter]():"style"===this._propertyType&&t.getStyle?t.getStyle(this._propertyName):"client"===this._propertyType&&t.getClient?t.getClient(this._propertyName):null}}),Je.SelectionModel=function(t){Je.SelectionModel.superClass.constructor.apply(this,arguments),this._selectionMode="multipleSelection",this._selectionList=new ci,this._selectionChangeDispatcher=new Je.EventDispatcher,this._selectionMap={},this._setDataBox(t)},Je.extend(Je.SelectionModel,Je.PropertyChangeDispatcher,{getSelectionMode:function(){return this._selectionMode},setSelectionMode:function(t){if(this._selectionMode!==t&&("noneSelection"===t||"singleSelection"===t||"multipleSelection"===t)){this.clearSelection();var e=this._selectionMode;this._selectionMode=t,this.firePropertyChange("selectionMode",e,this._selectionMode)}},getDataBox:function(){return this._dataBox},_setDataBox:function(t){if(!t)throw"dataBox can not be null";if(this._dataBox!==t){this._dataBox&&(this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this));var e=this._dataBox;this._dataBox=t,this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this.firePropertyChange("dataBox",e,this._dataBox)}},dispose:function(){this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this)},handleDataBoxChange:function(t){if("remove"===t.kind){var e=t.data;this.contains(e)&&(this._selectionList.remove(e),delete this._selectionMap[e.getId()],this.fireSelectionChange("remove",new ci(e))),e._selected=!1}else"clear"===t.kind&&this.clearSelection()},getFilterFunction:function(){return this._filterFunction},setFilterFunction:function(t){if(this._filterFunction!==t){this.clearSelection();var e=this._filterFunction;this._filterFunction=t,this.firePropertyChange("filterFunction",e,this._filterFunction)}},fireSelectionChange:function(t,e,i){i&&(this._selectionList.forEach(function(t){i.contains(t)?i.remove(t):i.add(t)}),e=i.toList()),this._selectionChangeDispatcher.fire({kind:t,datas:new ci(e)})},addSelectionChangeListener:function(t,e,i){this._selectionChangeDispatcher.add(t,e,i)},removeSelectionChangeListener:function(t,e){this._selectionChangeDispatcher.remove(t,e)},_filterList:function(t,e){for(var i=new ci(t),r=0;r<i.size();r++){var a=i.get(r);(this._filterFunction&&!this._filterFunction(a)||e&&this.contains(a)||!e&&!this.contains(a)||!this._dataBox.contains(a))&&(i.removeAt(r),r--)}return i},appendSelection:function(t){if("noneSelection"!==this._selectionMode){var e=this._filterList(t,!0);if(!e.isEmpty()){var i=null;"singleSelection"===this._selectionMode&&(i=new ci(this._selectionList),this._selectionList.forEach(function(t){t._selected=!1}),this._selectionList.clear(),this._selectionMap={},e=new ci(e.get(e.size()-1)));for(var r=0;r<e.size();r++){var a=e.get(r);a._selected=!0,this._selectionList.add(a),this._selectionMap[a._id]=a}this.fireSelectionChange("append",e,i)}}},removeSelection:function(t){var e=this._filterList(t);if(0!==e.size()){for(var i=0;i<e.size();i++){var r=e.get(i);r._selected=!1,this._selectionList.remove(r),delete this._selectionMap[r.getId()]}this.fireSelectionChange("remove",e)}},toSelection:function(t,e){return this._selectionList.toList(t,e)},getSelection:function(){return this._selectionList},setSelection:function(t){if("noneSelection"!==this._selectionMode&&(0!==this._selectionList.size()||null!=t)){var e=new ci(this._selectionList);this._selectionList.clear(),this._selectionMap={};var i=this._filterList(t,!0);"singleSelection"===this._selectionMode&&i.size()>1&&(i=new ci(i.get(i.size()-1)));for(var r=0;r<i.size();r++){var a=i.get(r);a._selected=!0,this._selectionList.add(a),this._selectionMap[a.getId()]=a}this.fireSelectionChange("set",null,e)}},clearSelection:function(){if(this._selectionList.size()>0){var t=this._selectionList.toList();this._selectionList.forEach(function(t){t._selected=!1}),this._selectionList.clear(),this._selectionMap={},this.fireSelectionChange("clear",t)}},selectAll:function(){if("noneSelection"!==this._selectionMode){var t=this._dataBox.toDatas(),e=0,i=null;if(this._filterFunction)for(e=0;e<t.size();e++)i=t.get(e),this._filterFunction(i)||(t.removeAt(e),e--);var r=new ci(this._selectionList);for(this._selectionList.clear(),this._selectionMap={},"singleSelection"===this._selectionMode&&t.size()>1&&(t=new ci(t.get(t.size()-1))),e=0;e<t.size();e++)i=t.get(e),this._selectionList.add(i),this._selectionMap[i.getId()]=i;this.fireSelectionChange("all",null,r)}},size:function(){return this._selectionList.size()},contains:function(t){return!!t&&null!=this._selectionMap[t._id]},getLastData:function(){return this._selectionList.size()>0?this._selectionList.get(this._selectionList.size()-1):null},getFirstData:function(){return this._selectionList.size()>0?this._selectionList.get(0):null},isSelectable:function(t){return!!t&&("noneSelection"!==this._selectionMode&&!(this._filterFunction&&!this._filterFunction(t)))}}),Je.AlarmSeverity=function(t,e,i,r,a){this.value=t,this.name=e,this.nickName=i,this.color=r,this.displayName=a},Je.extend(Je.AlarmSeverity,Object,{toString:function(){return this.displayName?this.displayName:this.name}}),function(){var t=Je.AlarmSeverity;t.severities=new ci,t._vm={},t._nm={},t._cp=function(t,e){if(t&&e){var i=t.value-e.value;return i>0?1:i<0?-1:0}return t&&!e?1:!t&&e?-1:0},t.forEach=function(e,i){t.severities.forEach(e,i)},t.getSortFunction=function(){return t._cp},t.setSortFunction=function(e){t._cp=e,t.severities.sort(e)},t.add=function(e,i,r,a,n){var s=new t(e,i,r,a,n);return t._vm[e]=s,t._nm[i]=s,t.severities.add(s),t.severities.sort(t._cp),s},t.remove=function(e){var i=t._nm[e];return i&&(delete t._nm[e],delete t._vm[i.value],t.severities.remove(i)),i},t.CRITICAL=t.add(500,"Critical","C","#FF0000"),t.MAJOR=t.add(400,"Major","M","#FFA000"),t.MINOR=t.add(300,"Minor","m","#FFFF00"),t.WARNING=t.add(200,"Warning","W","#00FFFF"),t.INDETERMINATE=t.add(100,"Indeterminate","N","#C800FF"),t.CLEARED=t.add(0,"Cleared","R","#00FF00"),t.isClearedAlarmSeverity=function(t){return!!t&&0===t.value},t.getByName=function(e){return t._nm[e]},t.getByValue=function(e){return t._vm[e]},t.clear=function(){t.severities.clear(),t._vm={},t._nm={}},t.compare=function(e,i){return t._cp(e,i)}}(),Je.AlarmState=function(t){this._e=t,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0},Je.extend(Je.AlarmState,Object,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._e.firePropertyChange("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var t=null;for(var e in this._am)e=Je.AlarmSeverity.getByName(e),Je.AlarmSeverity.isClearedAlarmSeverity(e)||0!==this.getAcknowledgedAlarmCount(e)&&(t=t&&Je.AlarmSeverity.compare(t,e)>0?t:e);this._haa=t},_c2:function(){var t=null;for(var e in this._nm)e=Je.AlarmSeverity.getByName(e),Je.AlarmSeverity.isClearedAlarmSeverity(e)||0!==this.getNewAlarmCount(e)&&(t=t&&Je.AlarmSeverity.compare(t,e)>0?t:e);this._hna=t},_c3:function(){if(!this._hna)return void(this._hls=!1);for(var t in this._nm)if(t=Je.AlarmSeverity.getByName(t),!Je.AlarmSeverity.isClearedAlarmSeverity(t)&&0!==this.getNewAlarmCount(t)&&Je.AlarmSeverity.compare(this._hna,t)>0)return void(this._hls=!0);this._hls=!1},_c4:function(){var t=this._haa,e=this._hna,i=this._ps;this._hoa=t,Je.AlarmSeverity.compare(e,this._hoa)>0&&(this._hoa=e),Je.AlarmSeverity.compare(i,this._hoa)>0&&(this._hoa=i)},_c5:function(){var t=this._haa,e=this._hna;this._hta=t,Je.AlarmSeverity.compare(e,this._hta)>0&&(this._hta=e)},increaseAcknowledgedAlarm:function(t,e){if(null==e&&(e=1),0!==e){var i=this._am[t.name];null==i&&(i=0),i+=e,this._am[t.name]=i,this._f(),this._e.onAlarmChange()}},increaseNewAlarm:function(t,e){if(null==e&&(e=1),0!==e){var i=this._nm[t.name];null==i&&(i=0),i+=e,this._nm[t.name]=i,this._f(),this._e.onAlarmChange()}},decreaseAcknowledgedAlarm:function(t,e){if(null==e&&(e=1),0!==e){var i=this._am[t.name];if(null==i&&(i=0),i-=e,i<0)throw"Alarm count can not be negative";this._am[t.name]=i,this._f(),this._e.onAlarmChange()}},decreaseNewAlarm:function(t,e){if(null==e&&(e=1),0!==e){var i=this._nm[t.name];if(null==i&&(i=0),i-=e,i<0)throw"Alarm count can not be negative";this._nm[t.name]=i,this._f(),this._e.onAlarmChange()}},acknowledgeAlarm:function(t){this.decreaseNewAlarm(t,1),this.increaseAcknowledgedAlarm(t,1)},acknowledgeAllAlarms:function(t){if(t){var e=this.getNewAlarmCount(t);this.decreaseNewAlarm(t,e),this.increaseAcknowledgedAlarm(t,e)}else for(var i in this._nm)this.acknowledgeAllAlarms(Je.AlarmSeverity.getByName(i))},_c6:function(){this._aac=0;for(var t in this._am)t=Je.AlarmSeverity.getByName(t),this._aac+=this.getAcknowledgedAlarmCount(t)},getAcknowledgedAlarmCount:function(t){if(t){var e=this._am[t.name];return null==e?0:e}return this._aac},getAlarmCount:function(t){return this.getAcknowledgedAlarmCount(t)+this.getNewAlarmCount(t)},_c7:function(){this._nac=0;for(var t in this._nm)t=Je.AlarmSeverity.getByName(t),this._nac+=this.getNewAlarmCount(t)},getNewAlarmCount:function(t){if(t){var e=this._nm[t.name];return null==e?0:e}return this._nac},setNewAlarmCount:function(t,e){this._nm[t.name]=e,this._f()},removeAllNewAlarms:function(t){t?delete this._nm[t]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(t,e){this._am[t.name]=e,this._f()},removeAllAcknowledgedAlarms:function(t){t?delete this._am[t.name]:this._am={},this._f()},isEmpty:function(){return null==this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(t){if(this._ep||(t=null),this._ps!==t){var e=this._ps;this._ps=t,this._f(),this._e.onAlarmChange(),this._e.firePropertyChange("propagateSeverity",e,t)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(t){var e=this._ep;this._ep=t,this._e.firePropertyChange("enablePropagation",e,t)&&(t||this.setPropagateSeverity(null))}}),Je.Alarm=function(t,e,i,r,a){Je.Data.call(this,t),this._id=null!=t?t:Je.id("A"),this._elementId=e,this._alarmSeverity=i,this._acked=r||!1,this._cleared=a||!1},Je.extend(Je.Alarm,Je.Data,{IAlarm:!0,getElementId:function(){return this._elementId},___accessor:["acked","cleared","alarmSeverity"]}),Je.AlarmBox=function(t){if(!t)throw"elementBox can not be null.";Je.AlarmBox.superClass.constructor.call(this),this._elementBox=t,this._alarmElementMapping=new Je.AlarmElementMapping(this,t),this._elementBox.addDataBoxChangeListener(this.handleElementBoxChange,this,!0),this.addDataBoxChangeListener(this.handleAlarmBoxChange,this,!0),this.addDataPropertyChangeListener(this.handleAlarmPropertyChange,this,!0)},Je.extend(Je.AlarmBox,Je.DataBox,{__accessor:["removeAlarmWhenElementIsRemoved"],_name:"AlarmBox",_removeAlarmWhenAlarmIsCleared:!1,_removeAlarmWhenElementIsRemoved:!0,getElementBox:function(){return this._elementBox},isRemoveAlarmWhenAlarmIsCleared:function(){return this._removeAlarmWhenAlarmIsCleared},setRemoveAlarmWhenAlarmIsCleared:function(t){var e=this._removeAlarmWhenAlarmIsCleared;if(this._removeAlarmWhenAlarmIsCleared=t,this.firePropertyChange("removeAlarmWhenAlarmIsCleared",e,t),t)for(var i in this.datas){var r=this.datas[i];r.isCleard()&&this.remove(r)}},getAlarmElementMapping:function(){return this._alarmElementMapping},setAlarmElementMapping:function(t){if(!t)throw"alarmElementMapping can not be null";if(this._alarmElementMapping!==t){var e=this._alarmElementMapping;this.getDatas().forEach(this._decreaseAlarmState,this),this._alarmElementMapping=t,this.getDatas().forEach(this._increaseAlarmState,this),this.firePropertyChange("alarmElementMapping",e,t)}},handleElementBoxChange:function(t){"add"===t.kind?this.handleElementAdded(t.data):"remove"===t.kind?(this.handleElementRemoved(t.data),this._removeAlarmWhenElementIsRemoved&&this.removeAlarmsByElement(t.data)):"clear"===t.kind&&(t.datas.forEach(this.handleElementRemoved,this),this._removeAlarmWhenElementIsRemoved&&this.clear())},handleAlarmBoxChange:function(t){"add"===t.kind?this._increaseAlarmState(t.data):"remove"===t.kind?this._decreaseAlarmState(t.data):"clear"===t.kind&&t.datas.forEach(this._decreaseAlarmState,this)},handleAlarmPropertyChange:function(t){var e=t.source;e.isCleared()||("alarmSeverity"===t.property?this.handleAlarmSeverityChange(e,t):"acked"===t.property&&this.handleAckedChange(e,t)),"cleared"===t.property&&(e.isCleared()?(this._decreaseAlarmState(e,!0),this._removeAlarmWhenAlarmIsCleared&&this.remove(e)):this._increaseAlarmState(e,!0))},handleAckedChange:function(t,e){if(t.getAlarmSeverity()){var i=this.getCorrespondingElements(t);if(i)for(var r=0;r<i.size();r++){var a=i.get(r);e.oldValue?a.getAlarmState().decreaseAcknowledgedAlarm(t.getAlarmSeverity()):a.getAlarmState().decreaseNewAlarm(t.getAlarmSeverity()),e.newValue?a.getAlarmState().increaseAcknowledgedAlarm(t.getAlarmSeverity()):a.getAlarmState().increaseNewAlarm(t.getAlarmSeverity())}}},handleAlarmSeverityChange:function(t,e){var i=e.oldValue,r=e.newValue,a=this.getCorrespondingElements(t);if(a)for(var n=0;n<a.size();n++){var s=a.get(n);i&&(t.isAcked()?s.getAlarmState().decreaseAcknowledgedAlarm(i):s.getAlarmState().decreaseNewAlarm(i)),r&&(t.isAcked()?s.getAlarmState().increaseAcknowledgedAlarm(r):s.getAlarmState().increaseNewAlarm(r))}},getCorrespondingAlarms:function(t){return this._alarmElementMapping.getCorrespondingAlarms(t)},getCorrespondingElements:function(t){return this._alarmElementMapping.getCorrespondingElements(t)},handleElementAdded:function(t){var e=this.getCorrespondingAlarms(t);if(e)for(var i=0;i<e.size();i++){var r=e.get(i);if(!r.isCleared()){var a=r.getAlarmSeverity();a&&(r.isAcked()?t.getAlarmState().increaseAcknowledgedAlarm(a):t.getAlarmState().increaseNewAlarm(a))}}},_increaseAlarmState:function(t,e){if(!t.isCleared()||e){var i=t.getAlarmSeverity();if(i){var r=this.getCorrespondingElements(t);if(r)for(var a=0;a<r.size();a++){var n=r.get(a);t.isAcked()?n.getAlarmState().increaseAcknowledgedAlarm(i):n.getAlarmState().increaseNewAlarm(i)}}}},_decreaseAlarmState:function(t,e){if(t.isCleared||console.log(),!t.isCleared()||e){var i=t.getAlarmSeverity();if(i){var r=this.getCorrespondingElements(t);if(r)for(var a=0;a<r.size();a++){var n=r.get(a);t.isAcked()?n.getAlarmState().decreaseAcknowledgedAlarm(i):n.getAlarmState().decreaseNewAlarm(i)}}}},handleElementRemoved:function(t){var e=this.getCorrespondingAlarms(t);e&&e.forEach(function(e){!e.isCleared()&&e.getAlarmSeverity()&&(e.isAcked()?t.getAlarmState().decreaseAcknowledgedAlarm(e.getAlarmSeverity()):t.getAlarmState().decreaseNewAlarm(e.getAlarmSeverity()))})},removeAlarmsByElement:function(t){var e=this.getCorrespondingAlarms(t);e&&e.forEach(this.remove,this)},add:function(t,e){if(!t.IAlarm)throw"Only IAlarm can be added into AlarmBox";this._removeAlarmWhenAlarmIsCleared&&t.isCleared()||Je.AlarmBox.superClass.add.apply(this,arguments)}}),Je.AlarmElementMapping=function(t,e){if(!e)throw"ElementBox can not be null";if(!t)throw"AlarmBox can not be null";this._elementBox=e,this._alarmBox=t,this._alarmsFinder=new Je.QuickFinder(t,"elementId")},Je.extend(Je.AlarmElementMapping,Object,{getCorrespondingAlarms:function(t){return this._alarmsFinder.find(t.getId())},getCorrespondingElements:function(t){var e=this._elementBox.getDataById(t.getElementId());return new ci(e)},dispose:function(){delete this._elementBox,delete this._alarmBox,delete this._alarmsFinder}}),Je.PropertyPropagator=function(t,e,i){if(!t)throw"dataBox can not be null";if(!e)throw"propertyName can not be null";this._dataBox=t,this._propertyName=e,this._propertyType=i||"accessor","accessor"===this._propertyType&&(this._getter=Je.getter(e),this._setter=Je.setter(e)),this._enable=!1,this._isPropagating=!1},Je.extend(Je.PropertyPropagator,Object,{getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isEnable:function(){return this._enable},setEnable:function(t){if(this._enable!==t)if(this._enable=t,this._enable){this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this);for(var e in this._dataBox.datas)this.propagate(this._dataBox.datas[e])}else this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this)},handleDataBoxChange:function(t){t.data&&this.propagate(t.data)},handleDataPropertyChange:function(t){if(this.isInterestedProperty(t))this.propagate(t.source);else if("parent"===t.property){var e=t.oldValue;e&&this.propagate(e),this.propagate(t.source)}},isInterestedProperty:function(t){return"accessor"===this._propertyType&&this._propertyName===t.property||(!("style"!==this._propertyType||!t.IElement||"S:"+this._propertyName!==t.property)||"client"===this._propertyType&&"C:"+this._propertyName===t.property)},propagate:function(t){t&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(t),this._isPropagating=!1)},propagateToTop:function(t){for(this.propagateToParent(null,t);t&&t.getParent();)this.propagateToParent(t,t.getParent()),t=t.getParent()},propagateToParent:function(t,e){}}),Je.AlarmStatePropagator=function(t){Je.AlarmStatePropagator.superClass.constructor.call(this,t,"alarmState")},Je.extend(Je.AlarmStatePropagator,Je.PropertyPropagator,{handleDataPropertyChange:function(t){"enablePropagation"===t.property?this.propagate(t.source):Je.AlarmStatePropagator.superClass.handleDataPropertyChange.call(this,t)},propagateToParent:function(t,e){var i=null;e.getChildren().forEach(function(t){var e=t.getAlarmState().getHighestOverallAlarmSeverity();Je.AlarmSeverity.compare(e,i)>0&&(i=e)}),e.getAlarmState&&e.getAlarmState().setPropagateSeverity(i)}});var vi={KEEP_DEFAULT_FUNCTION:function(t){return!(!t.target.keepDefault&&!t.target.getAttribute("keepDefault"))||(!(!t.target.parentNode||!t.target.parentNode.keepDefault&&!t.target.parentNode.getAttribute("keepDefault"))||!!t.shiftKey)}};vi.paintSortFunction=function(t,e){return t.z!==e.z?t.z-e.z:0},vi.doubleClickToLookAtFunction=function(t){return!0},vi.needSmoothNormalFunction=function(t){var e=t instanceof yi||t instanceof Je.TextNode||t instanceof Je.PathCube||t instanceof Je.ShapeNode||t instanceof Je.ComboNode||"TGL.Entity"==t.getClassName();return!e},vi.PATH_LINK_COMPUTE_DELAY=!1,Je.Defaults=vi,Je.BasicShader={vertex_shader:"",fragment_shader:""},Je.ShaderUtil={},Je.ShaderUtil.getShader=function(t){},Je.ShaderChunk={gradient_parts_fragment:["#ifdef MAX_GRADIENT","uniform vec3 gradientColor[MAX_GRADIENT];","uniform float gradientStop[MAX_GRADIENT];","uniform int gradientType;","#endif"].join("\n"),gradient_basic_fragment:["#ifdef MAX_GRADIENT","float gradientUV = 1.0;","float PI = 3.14;","if(gradientType == 1){","gradientUV = oUv.x;","} else if(gradientType == 2){","gradientUV = oUv.y;","} else if(gradientType == 3){","gradientUV = (oUv.x + oUv.y)/2.0;","} else if(gradientType == 4){","gradientUV = (oUv.x + 1.0 - oUv.y)/2.0;","} else if(gradientType == 5){","gradientUV = 1.414 * sqrt((oUv.x - 0.5) * (oUv.x - 0.5) + (oUv.y - 0.5) * (oUv.y - 0.5));","} else if(gradientType == 6){","gradientUV = (atan(oUv.y - 0.5,oUv.x - 0.5)) / (2.0 * PI);","if(gradientUV < 0.0){","gradientUV = 1.0 + gradientUV;","}","}","for( int i = 1; i < MAX_GRADIENT; i ++ ){","if(gradientStop[i - 1] <= gradientUV){","if((gradientStop[i] >= gradientUV)){","vec3 color1 = gradientColor[i-1];","vec3 color2 = gradientColor[i];","float stop1 = gradientStop[i-1];","float stop2 =gradientStop[i]; ","gl_FragColor = vec4( (color1 * (stop2 - gradientUV )  + color2 * (gradientUV - stop1))/(stop2 - stop1),opacity);","break;","}","}","}","#endif"].join("\n"),gradient_phong_fragment:["#ifdef MAX_GRADIENT","float gradientUV = 1.0;","float PI = 3.14;","if(gradientType == 1){","gradientUV = oUv.x;","} else if(gradientType == 2){","gradientUV = oUv.y;","} else if(gradientType == 3){","gradientUV = (oUv.x + oUv.y)/2.0;","} else if(gradientType == 4){","gradientUV = (oUv.x + 1.0 - oUv.y)/2.0;","} else if(gradientType == 5){","gradientUV = 1.414 * sqrt((oUv.x - 0.5) * (oUv.x - 0.5) + (oUv.y - 0.5) * (oUv.y - 0.5));","} else if(gradientType == 6){","gradientUV = (atan(oUv.y - 0.5,oUv.x - 0.5)) / (2.0 * PI);","if(gradientUV < 0.0){","gradientUV = 1.0 + gradientUV;","}","}","for( int i = 1; i < MAX_GRADIENT; i ++ ){","if(gradientStop[i - 1] < gradientUV){","if((gradientStop[i] > gradientUV)){","vec3 color1 = gradientColor[i-1];","vec3 color2 = gradientColor[i];","float stop1 = gradientStop[i-1];","float stop2 = gradientStop[i]; ","tempDiffuse = (color1 * (stop2 - gradientUV )  + color2 * (gradientUV - stop1))/(stop2 - stop1);","break;","}","}","}","#endif"].join("\n"),fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( reflectVec.x*flipEnvMap,  reflectVec.y,reflectVec.z) );","#else","vec4 cubeColor = textureCube( envMap, vec3(reflectVec.x*flipEnvMap,  reflectVec.y,reflectVec.z) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","#ifdef PHONG","#else","float specularStrength = 1.0;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP ) ","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined(MAX_GRADIENT)","varying vec2 vUv;","varying vec2 oUv;","uniform vec4 offsetRepeat;","uniform bool flipX; ","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined(MAX_GRADIENT)","varying vec2 vUv;","varying vec2 oUv;","#endif","#ifdef USE_MAP","uniform bool mapLoaded;","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined(MAX_GRADIENT)","if(flipX){","vUv.x = uv.x * offsetRepeat.z * (-1.0) + offsetRepeat.x + offsetRepeat.z;","vUv.y = uv.y * offsetRepeat.w  + offsetRepeat.y;","}else{","vUv = uv * offsetRepeat.zw  + offsetRepeat.xy;","}","oUv = uv;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","if(mapLoaded){","vec4 texelColor = texture2D( map, vUv );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = texelColor * gl_FragColor;","}","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),
specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = uspecularStrength;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0 ","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","vSpotLight[ i ] = vec4( lVector, lDistance );","}","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#else","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#else","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -viewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vPointLight[ i ].xyz );","float lDistance = vPointLight[ i ].w;","#endif","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += tempDiffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","#else","pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vSpotLight[ i ].xyz );","float lDistance = vSpotLight[ i ].w;","#endif","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ]) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += tempDiffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","#else","spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += tempDiffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += tempDiffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","float ssao = 1.0;","#ifdef USE_SSAO","ssao = clamp(1.0 - texture2D(mapSSAO, (finalPosition.xy / finalPosition.w / 2.0 + vec2(0.5,0.5))).x,0.0,1.0);","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + (ambientLightColor * ambient * ssao) + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + (ambientLightColor * ambient) * ssao ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, opacity );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, N_BONE_PIXEL_X );","float y = floor( j / N_BONE_PIXEL_X );","const float dx = 1.0 / N_BONE_PIXEL_X;","const float dy = 1.0 / N_BONE_PIXEL_Y;","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix \t+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","#endif","#ifdef USE_POINT_SHADOWMAP","uniform samplerCube pShadowMap[MAX_POINT_SHADOWS];","uniform float pShadowDarkness[MAX_POINT_SHADOWS];","uniform vec3 pPosition[MAX_POINT_SHADOWS];","varying vec4 pWorldPosition;","#endif","#if defined(USE_SHADOWMAP) || defined(USE_POINT_SHADOWMAP)","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","float unpack (vec4 colour){","const vec4 bitShifts = vec4(1.0,1.0 / 255.0,1.0 / (255.0 * 255.0),1.0 / (255.0 * 255.0 * 255.0));","return dot(colour, bitShifts) * 100000.0;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3(inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2(inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( depthKernel[0][0] < shadowCoord.z ) shadowKernel[0][0] = 0.25;","else shadowKernel[0][0] = 0.0;","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( depthKernel[0][1] < shadowCoord.z ) shadowKernel[0][1] = 0.25;","else shadowKernel[0][1] = 0.0;","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( depthKernel[0][2] < shadowCoord.z ) shadowKernel[0][2] = 0.25;","else shadowKernel[0][2] = 0.0;","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( depthKernel[1][0] < shadowCoord.z ) shadowKernel[1][0] = 0.25;","else shadowKernel[1][0] = 0.0;","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( depthKernel[1][1] < shadowCoord.z ) shadowKernel[1][1] = 0.25;","else shadowKernel[1][1] = 0.0;","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( depthKernel[1][2] < shadowCoord.z ) shadowKernel[1][2] = 0.25;","else shadowKernel[1][2] = 0.0;","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( depthKernel[2][0] < shadowCoord.z ) shadowKernel[2][0] = 0.25;","else shadowKernel[2][0] = 0.0;","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( depthKernel[2][1] < shadowCoord.z ) shadowKernel[2][1] = 0.25;","else shadowKernel[2][1] = 0.0;","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( depthKernel[2][2] < shadowCoord.z ) shadowKernel[2][2] = 0.25;","else shadowKernel[2][2] = 0.0;","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif","#ifdef USE_POINT_SHADOWMAP","for( int i = 0; i < MAX_POINT_SHADOWS; i ++ ) {","vec3 lightVec = normalize(pWorldPosition.xyz - pPosition[i]);","float depth = length(pWorldPosition.xyz - pPosition[i]);","float shadowDepth = unpack (textureCube(pShadowMap[i], lightVec));","depth = depth * 0.95;","if ( depth > shadowDepth){","gl_FragColor.xyz *= 0.8;","}","}","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif","#ifdef USE_POINT_SHADOWMAP","varying vec4 pWorldPosition;","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","#ifdef USE_POINT_SHADOWMAP","pWorldPosition = modelMatrix * vec4(position,1.0);","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")},Je.UniformsUtils={merge:function(t){var e,i,r,a={};for(e=0;e<t.length;e++){r=this.clone(t[e]);for(i in r)a[i]=r[i]}return a},clone:function(t){var e,i,r,a={};for(e in t){a[e]={};for(i in t[e])r=t[e][i],r instanceof Je.Color||r instanceof Je.Vec2||r instanceof Je.Vec3||r instanceof Je.Vec4||r instanceof Je.Mat4||r instanceof Je.Texture?a[e][i]=r.clone():r instanceof Array?a[e][i]=r.slice():a[e][i]=r}return a}},Je.UniformsLib={outline:{diffuse:{type:"c",value:new Je.Color(15658734)},outline_offset:{type:"f",value:0}},glow:{map:{type:"t",value:null}},blur:{orientation:{type:"i",value:0},texelSize:{type:"v2",value:new Je.Vec2(512,512)},blurAmount:{type:"i",value:10},blurScale:{type:"f",value:1},blurStrength:{type:"f",value:.2},map:{type:"t",value:null},useBlur:{type:"i",value:1},blurGlobalAlpha:{type:"f",value:1}},deferred:{linearDepth:{type:"f",value:9e3},isNormal:{type:"i",value:1}},ssao:{map0:{type:"t",value:null},map1:{type:"t",value:null},map2:{type:"t",value:null},occluderBias:{type:"f",value:.05},samplingRadius:{type:"f",value:20},attenuation:{type:"v2",value:new Qe(1,0)},texelSize:{type:"v2",value:new Qe(1/512,1/512)}},common:{diffuse:{type:"c",value:new Je.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},mapLoaded:{type:"i",value:0},offsetRepeat:{type:"v4",value:new Je.Vec4(0,0,1,1)},flipX:{type:"i",value:0},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},gradient:{gradientColor:{type:"v3v",value:[]},gradientStop:{type:"fv1",value:[]},gradientType:{type:"i",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new Je.Vec2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new Je.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{
type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new Je.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new Je.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]},pShadowMap:{type:"tv",value:[]},pShadowMapSize:{type:"v2v",value:[]},pShadowDarkness:{type:"fv1",value:[]},pPosition:{type:"v3v",value:[]}}},Je.ShaderLib={outline:{uniforms:Je.UniformsUtils.merge([Je.UniformsLib.outline]),vertexShader:["uniform float outline_offset;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position + normalize(position)  * outline_offset, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","void main() {","gl_FragColor = vec4(diffuse, 1.0 );","}"].join("\n")},blur:{uniforms:Je.UniformsUtils.merge([Je.UniformsLib.blur]),vertexShader:["varying vec2 vUv;","void main (){","gl_Position = vec4(position, 1.0);","vUv = uv;","}"].join("\n"),fragmentShader:["uniform vec2 texelSize;","uniform sampler2D map;","uniform int orientation;","uniform int blurAmount;","uniform float blurScale;","uniform float blurStrength;","uniform int useBlur;","uniform float blurGlobalAlpha;","uniform sampler2D depthMap;","varying vec2 vUv;","float Gaussian (float x, float deviation){","return (1.0 / sqrt(2.0 * 3.141592 * deviation)) * exp(-((x * x) / (2.0 * deviation)));","}","void main (){","float halfBlur = float(blurAmount) * 0.5;","vec4 colour = vec4(0.0);","if(useBlur == 0){","colour = texture2D(map,vUv);","}else {","vec4 texColour = vec4(0.0);","float deviation = halfBlur * 0.35;","deviation *= deviation;","float strength = 1.0 - blurStrength;","if ( orientation == 0 ){","for (int i = 0; i < 20; ++i){","if ( i >= blurAmount ){","break;","}","float offset = float(i) - halfBlur;","texColour = texture2D(map, vUv + vec2(offset / texelSize.x * blurScale, 0.0)) * Gaussian(offset * strength, deviation);","colour += texColour;","}","}else{","for (int i = 0; i < 20; ++i){","if ( i >= blurAmount )","break;","float offset = float(i) - halfBlur;","texColour = texture2D(map, vUv + vec2(0.0, offset / texelSize.y * blurScale)) * Gaussian(offset * strength, deviation);","colour += texColour;","}","}","}","gl_FragColor = clamp(colour, 0.0, 1.0);","if(useBlur == 0){","gl_FragColor.w *=  gl_FragColor.w * gl_FragColor.w * gl_FragColor.w * blurGlobalAlpha;","}","}"].join("\n")},deferred:{uniforms:Je.UniformsUtils.merge([Je.UniformsLib.deferred]),vertexShader:["varying vec4 vPosition;","varying vec3 vNormal;","void main (){","vNormal = mat3(modelViewMatrix) * normal;","vPosition = modelViewMatrix * vec4(position, 1.0);","gl_Position = projectionMatrix * vPosition;","}"].join("\n"),fragmentShader:["uniform float linearDepth;","uniform int isNormal;","varying vec4 vPosition;","varying vec3 vNormal;","void main (){","float linear_depth = length(vPosition) / linearDepth;","if(isNormal == 1){","vec3 normal = normalize(vNormal);","gl_FragColor = vec4(normal.x, normal.y, normal.z, 1.0);","}else{","gl_FragColor = vec4(vPosition.x, vPosition.y, vPosition.z, linear_depth);","}","}"].join("\n")},ssao:{uniforms:Je.UniformsUtils.merge([Je.UniformsLib.ssao]),vertexShader:["varying vec2 vUv;","void main (){","gl_Position = vec4(position, 1.0);","vUv = uv;","}"].join("\n"),fragmentShader:["uniform sampler2D map0;","uniform sampler2D map1;","uniform sampler2D map2;","uniform vec2 texelSize;","uniform float occluderBias;","uniform float samplingRadius;","uniform vec2 attenuation;","varying vec2 vUv;","float samplePixels (vec3 srcPosition, vec3 srcNormal, vec2 uv){","vec3 dstPosition = texture2D(map0, uv).xyz;","vec3 positionVec = dstPosition - srcPosition;","float intensity = max(dot(normalize(positionVec), srcNormal) - occluderBias, 0.0);","float dist = length(positionVec);","float attenuationValue = 1.0 / (attenuation.x + (attenuation.y * dist));","return intensity * attenuationValue;","}","void main (){","vec3 srcPosition = texture2D(map0, vUv).xyz;","vec3 srcNormal = texture2D(map1, vUv).xyz;","vec2 randVec = normalize(texture2D(map2, vUv).xy * 2.0 - 1.0);","float srcDepth = texture2D(map0, vUv).w;","float kernelRadius = samplingRadius * (1.0 - srcDepth);","vec2 kernel[4];","kernel[0] = vec2(0.0, 1.0);","kernel[1] = vec2(1.0, 0.0);","kernel[2] = vec2(0.0, -1.0);","kernel[3] = vec2(-1.0, 0.0);","const float sin45 = 0.707107;","float occlusion = 0.0;","for (int i = 0; i < 4; ++i){","vec2 k1 = reflect(kernel[i], randVec);","vec2 k2 = vec2(k1.x * sin45 - k1.y * sin45,k1.x * sin45 + k1.y * sin45);","k1 *= texelSize;","k2 *= texelSize;","occlusion += samplePixels(srcPosition, srcNormal, vUv + k1 * kernelRadius);","occlusion += samplePixels(srcPosition, srcNormal, vUv + k2 * kernelRadius * 0.75);","occlusion += samplePixels(srcPosition, srcNormal, vUv + k1 * kernelRadius * 0.5);","occlusion += samplePixels(srcPosition, srcNormal, vUv + k2 * kernelRadius * 0.25);","}","occlusion /= 16.0;","occlusion = clamp(occlusion, 0.0, 1.0);","gl_FragColor =  vec4(occlusion,0.0,0.0,1.0);","}"].join("\n")},basic:{uniforms:Je.UniformsUtils.merge([Je.UniformsLib.common,Je.UniformsLib.gradient,Je.UniformsLib.fog]),vertexShader:[Je.ShaderChunk.map_pars_vertex,Je.ShaderChunk.lightmap_pars_vertex,Je.ShaderChunk.envmap_pars_vertex,Je.ShaderChunk.color_pars_vertex,Je.ShaderChunk.morphtarget_pars_vertex,Je.ShaderChunk.skinning_pars_vertex,"void main() {",Je.ShaderChunk.map_vertex,Je.ShaderChunk.lightmap_vertex,Je.ShaderChunk.color_vertex,Je.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",Je.ShaderChunk.morphnormal_vertex,Je.ShaderChunk.skinnormal_vertex,Je.ShaderChunk.defaultnormal_vertex,"#endif",Je.ShaderChunk.morphtarget_vertex,Je.ShaderChunk.skinning_vertex,Je.ShaderChunk.default_vertex,Je.ShaderChunk.worldpos_vertex,Je.ShaderChunk.envmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",Je.ShaderChunk.color_pars_fragment,Je.ShaderChunk.map_pars_fragment,Je.ShaderChunk.gradient_parts_fragment,Je.ShaderChunk.lightmap_pars_fragment,Je.ShaderChunk.envmap_pars_fragment,Je.ShaderChunk.fog_pars_fragment,Je.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( diffuse, opacity );",Je.ShaderChunk.gradient_basic_fragment,Je.ShaderChunk.map_fragment,Je.ShaderChunk.alphatest_fragment,Je.ShaderChunk.lightmap_fragment,Je.ShaderChunk.color_fragment,Je.ShaderChunk.envmap_fragment,Je.ShaderChunk.linear_to_gamma_fragment,Je.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:Je.UniformsUtils.merge([Je.UniformsLib.common,Je.UniformsLib.fog,Je.UniformsLib.lights,Je.UniformsLib.shadowmap,{ambient:{type:"c",value:new Je.Color(16777215)},emissive:{type:"c",value:new Je.Color(0)},wrapRGB:{type:"v3",value:new Je.Vec3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",Je.ShaderChunk.map_pars_vertex,Je.ShaderChunk.lightmap_pars_vertex,Je.ShaderChunk.envmap_pars_vertex,Je.ShaderChunk.lights_lambert_pars_vertex,Je.ShaderChunk.color_pars_vertex,Je.ShaderChunk.morphtarget_pars_vertex,Je.ShaderChunk.skinning_pars_vertex,Je.ShaderChunk.shadowmap_pars_vertex,"void main() {",Je.ShaderChunk.map_vertex,Je.ShaderChunk.lightmap_vertex,Je.ShaderChunk.color_vertex,Je.ShaderChunk.morphnormal_vertex,Je.ShaderChunk.skinbase_vertex,Je.ShaderChunk.skinnormal_vertex,Je.ShaderChunk.defaultnormal_vertex,Je.ShaderChunk.morphtarget_vertex,Je.ShaderChunk.skinning_vertex,Je.ShaderChunk.default_vertex,Je.ShaderChunk.worldpos_vertex,Je.ShaderChunk.envmap_vertex,Je.ShaderChunk.lights_lambert_vertex,Je.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",Je.ShaderChunk.color_pars_fragment,Je.ShaderChunk.map_pars_fragment,Je.ShaderChunk.lightmap_pars_fragment,Je.ShaderChunk.envmap_pars_fragment,Je.ShaderChunk.fog_pars_fragment,Je.ShaderChunk.shadowmap_pars_fragment,Je.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",Je.ShaderChunk.map_fragment,Je.ShaderChunk.alphatest_fragment,Je.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",Je.ShaderChunk.lightmap_fragment,Je.ShaderChunk.color_fragment,Je.ShaderChunk.envmap_fragment,Je.ShaderChunk.shadowmap_fragment,Je.ShaderChunk.linear_to_gamma_fragment,Je.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:Je.UniformsUtils.merge([Je.UniformsLib.common,Je.UniformsLib.gradient,Je.UniformsLib.bump,Je.UniformsLib.normalmap,Je.UniformsLib.fog,Je.UniformsLib.lights,Je.UniformsLib.shadowmap,{ambient:{type:"c",value:new Je.Color(16777215)},emissive:{type:"c",value:new Je.Color(0)},specular:{type:"c",value:new Je.Color(1118481)},uspecularStrength:{type:"f",value:1},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new Je.Vec3(1,1,1)},mapSSAO:{type:"t",value:null}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;","varying vec4 finalPosition;",Je.ShaderChunk.map_pars_vertex,Je.ShaderChunk.lightmap_pars_vertex,Je.ShaderChunk.envmap_pars_vertex,Je.ShaderChunk.lights_phong_pars_vertex,Je.ShaderChunk.color_pars_vertex,Je.ShaderChunk.morphtarget_pars_vertex,Je.ShaderChunk.skinning_pars_vertex,Je.ShaderChunk.shadowmap_pars_vertex,"void main() {",Je.ShaderChunk.map_vertex,Je.ShaderChunk.lightmap_vertex,Je.ShaderChunk.color_vertex,Je.ShaderChunk.morphnormal_vertex,Je.ShaderChunk.skinbase_vertex,Je.ShaderChunk.skinnormal_vertex,Je.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",Je.ShaderChunk.morphtarget_vertex,Je.ShaderChunk.skinning_vertex,Je.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",Je.ShaderChunk.worldpos_vertex,Je.ShaderChunk.envmap_vertex,Je.ShaderChunk.lights_phong_vertex,Je.ShaderChunk.shadowmap_vertex,"finalPosition = gl_Position;","}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float uspecularStrength;","uniform float shininess;","varying vec4 finalPosition;",Je.ShaderChunk.color_pars_fragment,Je.ShaderChunk.gradient_parts_fragment,Je.ShaderChunk.map_pars_fragment,Je.ShaderChunk.lightmap_pars_fragment,Je.ShaderChunk.envmap_pars_fragment,Je.ShaderChunk.fog_pars_fragment,Je.ShaderChunk.lights_phong_pars_fragment,Je.ShaderChunk.shadowmap_pars_fragment,Je.ShaderChunk.bumpmap_pars_fragment,Je.ShaderChunk.normalmap_pars_fragment,Je.ShaderChunk.specularmap_pars_fragment,"#ifdef USE_SSAO","uniform sampler2D mapSSAO;","#endif","void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );","vec3 tempDiffuse = diffuse;",Je.ShaderChunk.gradient_phong_fragment,Je.ShaderChunk.map_fragment,Je.ShaderChunk.alphatest_fragment,Je.ShaderChunk.specularmap_fragment,Je.ShaderChunk.lights_phong_fragment,Je.ShaderChunk.lightmap_fragment,Je.ShaderChunk.color_fragment,Je.ShaderChunk.envmap_fragment,Je.ShaderChunk.shadowmap_fragment,Je.ShaderChunk.linear_to_gamma_fragment,Je.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:Je.UniformsUtils.merge([Je.UniformsLib.particle,Je.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",Je.ShaderChunk.color_pars_vertex,Je.ShaderChunk.shadowmap_pars_vertex,"void main() {",Je.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","float s = normal.x;","if(s == 0.0){","   s = 1.0;","}","gl_PointSize = size * s;","#endif","gl_Position = projectionMatrix * mvPosition;",Je.ShaderChunk.worldpos_vertex,Je.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",Je.ShaderChunk.color_pars_fragment,Je.ShaderChunk.map_particle_pars_fragment,Je.ShaderChunk.fog_pars_fragment,Je.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",Je.ShaderChunk.map_particle_fragment,Je.ShaderChunk.alphatest_fragment,Je.ShaderChunk.color_fragment,Je.ShaderChunk.shadowmap_fragment,Je.ShaderChunk.fog_fragment,"}"].join("\n")},billboard:{vertexShader:["uniform int useScreenCoordinates;","uniform int sizeAttenuation;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position + alignment;","vec2 rotatedPosition;","rotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;","rotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;","vec4 finalPosition;","if( useScreenCoordinates != 0 ) {","finalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );","} else {","finalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition * ( sizeAttenuation == 1 ? 1.0 : finalPosition.z );","}","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")},dashed:{uniforms:Je.UniformsUtils.merge([Je.UniformsLib.common,Je.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",Je.ShaderChunk.color_pars_vertex,"void main() {",Je.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",Je.ShaderChunk.color_pars_fragment,Je.ShaderChunk.fog_pars_fragment,"void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","gl_FragColor = vec4( diffuse, opacity );",Je.ShaderChunk.color_fragment,Je.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:Je.UniformsUtils.merge([Je.UniformsLib.fog,Je.UniformsLib.lights,Je.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new Je.Vec2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new Je.Color(16777215)},uSpecularColor:{type:"c",value:new Je.Color(1118481)},uSpecualarStrength:{type:"f",value:1},uAmbientColor:{type:"c",value:new Je.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new Je.Vec2(0,0)},uRepeat:{type:"v2",value:new Je.Vec2(1,1)},wrapRGB:{type:"v3",value:new Je.Vec3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform vec3 uSpecularStrength;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float uRefractionRatio;","uniform float uReflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",Je.ShaderChunk.shadowmap_pars_fragment,Je.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","#else","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","#else","spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += uDiffuseColor * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, uRefractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );","}",Je.ShaderChunk.shadowmap_fragment,Je.ShaderChunk.linear_to_gamma_fragment,Je.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",Je.ShaderChunk.skinning_pars_vertex,Je.ShaderChunk.shadowmap_pars_vertex,"void main() {",Je.ShaderChunk.skinbase_vertex,Je.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")},depthRGBA:{uniforms:{isCube:{type:"i",value:0}},vertexShader:[Je.ShaderChunk.morphtarget_pars_vertex,Je.ShaderChunk.skinning_pars_vertex,"varying vec4 vPosition1;","void main() {",Je.ShaderChunk.skinbase_vertex,Je.ShaderChunk.morphtarget_vertex,Je.ShaderChunk.skinning_vertex,Je.ShaderChunk.default_vertex,"vPosition1 = modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),
fragmentShader:["uniform int isCube;","varying vec4 vPosition1;","varying vec3 vPosition2;","vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","vec4 pack (float depth){","const vec4 bias = vec4(1.0 / 255.0,1.0 / 255.0,1.0 / 255.0, 0.0);","float r = depth;","float g = fract(r * 255.0);","float b = fract(g * 255.0);","float a = fract(b * 255.0);","vec4 colour = vec4(r, g, b, a);","return colour - (colour.yzww * bias);","}","void main() {","if(isCube == 1){","gl_FragData[ 0 ] = pack(length(vPosition1) / 100000.0);","}else{","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}","}"].join("\n")}},Je.ShaderTerrain={terrain:{uniforms:Je.UniformsUtils.merge([Je.UniformsLib.fog,Je.UniformsLib.lights,Je.UniformsLib.shadowmap,{enableDiffuse1:{type:"i",value:0},enableDiffuse2:{type:"i",value:0},enableDiffuse3:{type:"i",value:0},enableDisplacement:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse1:{type:"t",value:null},tDiffuse2:{type:"t",value:null},tDiffuse3:{type:"t",value:null},tDetail:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tDisplacement:{type:"t",value:null},heightUnit:{type:"f",value:1},blendRange:{type:"fv1",value:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new Je.Color(15658734)},uSpecularColor:{type:"c",value:new Je.Color(1118481)},uAmbientColor:{type:"c",value:new Je.Color(328965)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uRepeatBase:{type:"v2",value:new Je.Vec2(1,1)},uRepeatOverlay:{type:"v2",value:new Je.Vec2(1,1)},uOffset:{type:"v2",value:new Je.Vec2(0,0)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse1;","uniform bool enableDiffuse2;","uniform bool enableDiffuse3;","uniform bool enableSpecular;","uniform bool enableDisplacement;","uniform float blendRange[2];","uniform float heightUnit;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","uniform sampler2D tDiffuse3;","uniform sampler2D tDetail;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tDisplacement;","uniform float uNormalScale;","uniform vec2 uRepeatOverlay;","uniform vec2 uRepeatBase;","uniform vec2 uOffset;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec4 vPosition;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","varying vec3 vViewPosition;",Je.ShaderChunk.shadowmap_pars_fragment,Je.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec2 uvOverlay = uRepeatOverlay * vUv + uOffset;","vec2 uvBase = uRepeatBase * vUv;","vec3 normalTex = texture2D( tDetail, uvOverlay ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( (enableDiffuse1 && enableDiffuse2)  || (enableDiffuse1 && enableDiffuse3) || (enableDiffuse2 && enableDiffuse3) ){","vec4 colDiffuse1 = texture2D( tDiffuse1, uvOverlay );","vec4 colDiffuse2 = texture2D( tDiffuse2, uvOverlay );","vec4 colDiffuse3 = texture2D( tDiffuse3, uvOverlay );","vec4 allDefiuuses[3];","allDefiuuses[0] = colDiffuse1;","allDefiuuses[1] = colDiffuse2;","allDefiuuses[2] = colDiffuse3;","#ifdef GAMMA_INPUT","colDiffuse1.xyz *= colDiffuse1.xyz;","colDiffuse2.xyz *= colDiffuse2.xyz;","colDiffuse3.xyz *= colDiffuse3.xyz;","#endif","vec4 mixColor;","if(enableDisplacement){","vec4 dis = texture2D( tDisplacement, uvBase );","if(enableDiffuse1 && enableDiffuse2 && enableDiffuse3){","float total = dis.r + dis.g + dis.b;","if(total == 0.0){","mixColor = colDiffuse1 * 1.0/3.0 + colDiffuse2 * 1.0/3.0 + colDiffuse3 * 1.0/3.0;","}else{","mixColor = colDiffuse1 * dis.r/total + colDiffuse2 * dis.g/total + colDiffuse3 * dis.b/total;","}","}","}else {","mixColor = colDiffuse2;","float y = vPosition.y;","float blend2Bottom = blendRange[1] * heightUnit * 255.0;","float percent = 0.0;","if(y < blendRange[0] * heightUnit * 255.0){","mixColor = colDiffuse1;","percent = y / (blendRange[0] * heightUnit * 255.0);","if(percent >=0.8){","mixColor = mix(colDiffuse1,colDiffuse2,(percent - 0.8) / 0.2);","}","} else if(y > blend2Bottom){","mixColor = colDiffuse3;","percent = (y - blend2Bottom) / (heightUnit * 255.0 - blend2Bottom);","if(percent <= 0.2){","mixColor = mix(colDiffuse2,colDiffuse3,percent/0.2);","}","}","}","gl_FragColor = gl_FragColor * mixColor;"," } else if( enableDiffuse1 ) {","gl_FragColor = gl_FragColor * texture2D( tDiffuse1, uvOverlay );","} else if( enableDiffuse2 ) {","gl_FragColor = gl_FragColor * texture2D( tDiffuse2, uvOverlay );","}","if( enableSpecular )","specularTex = texture2D( tSpecular, uvOverlay ).xyz;","mat3 tsb = mat3( vTangent, vBinormal, vNormal );","vec3 finalNormal = tsb * normalTex;","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDistance = lDistance;","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","hemiDiffuse += uDiffuseColor * mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","hemiSpecular += uSpecularColor * mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight ) * hemiSpecularWeight * hemiDiffuseWeight;","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif",Je.ShaderChunk.shadowmap_fragment,Je.ShaderChunk.linear_to_gamma_fragment,Je.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uRepeatBase;","uniform sampler2D tNormal;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec4 vPosition;","varying vec3 vViewPosition;",Je.ShaderChunk.shadowmap_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","vBinormal = cross( vNormal, vTangent ) * tangent.w;","vBinormal = normalize( vBinormal );","vUv = uv;","vec2 uvBase = uv * uRepeatBase;","#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uvBase ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec3 displacedPosition = normal * df + position;","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","#else","vPosition = vec4(position,1.0);","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;","vViewPosition = -mvPosition.xyz;","vec3 normalTex = texture2D( tNormal, uvBase ).xyz * 2.0 - 1.0;","vNormal = normalMatrix * normalTex;",Je.ShaderChunk.shadowmap_vertex,"}"].join("\n")}},Je.ShaderLib.terrain=Je.ShaderTerrain.terrain,Je.Fog=function(t,i,r){this.name="",this.color=new Je.Color(t),this.near=i!==e?i:1,this.far=r!==e?r:1e3},Je.Fog.prototype={constructor:Je.Fog,clone:function(){return new Je.Flog(this.color.getHex(),this.near,this.far)},refreshUniforms:function(t){t.fogNear.value=this.near,t.fogFar.value=this.far,t.fogColor.value=this.color}},Je.FogExp2=function(t,i){this.name="",this.color=new Je.Color(t),this.density=i!==e?i:1},Je.FogExp2.prototype={DensityFactor:25e-5,constructor:Je.FogExp2,clone:function(){return new Je.FogExp2(this.color.getHex(),this.density)},refreshUniforms:function(t){t.fogDensity.value=this.density*this.DensityFactor,t.fogColor.value=this.color}};var xi={},wi=xi.RADIANS_TO_DEGREES=180/Math.PI,_i=xi.DEGREES_TO_RADIANS=Math.PI/180;xi.isPowerOfTwo=function(t){return 0===(t&t-1)},xi.clone=function(t,i){i==e&&(i=new t.prototype.constructor);for(var r in t)if("id"!==r){var a=t[r];if(a.copy&&"function"==typeof a.copy)i[r].copy(a);else if(a instanceof Array){var n=a,s=i[r];null==s&&(s=[]);for(var o=0;o<n.length;o++){var l=n[o];s.push(l.clone())}}else cloneObjet[r]=a}},xi.paramToGL=function(t,e){if(!e)return void console.error("No webgl context");switch(t){case Je.RepeatWrapping:return e.REPEAT;case Je.ClampToEdgeWrapping:return e.CLAMP_TO_EDGE;case Je.MirroredRepeatWrapping:return e.MIRRORED_REPEAT;case Je.NearestFilter:return e.NEAREST;case Je.NearestMipMapNearestFilter:return e.NEAREST_MIPMAP_NEAREST;case Je.NearestMipMapLinearFilter:return e.NEAREST_MIPMAP_LINEAR;case Je.LinearFilter:return e.LINEAR;case Je.LinearMipMapNearestFilter:return e.LINEAR_MIPMAP_NEAREST;case Je.LinearMipMapLinearFilter:return e.LINEAR_MIPMAP_LINEAR;case Je.ByteType:return e.BYTE;case Je.UnsignedByteType:return e.UNSIGNED_BYTE;case Je.ShortType:return e.SHORT;case Je.UnsignedShortType:return e.UNSIGNED_SHORT;case Je.IntType:return e.INT;case Je.UnsignedIntType:return e.UNSIGNED_INT;case Je.FloatType:return e.FLOAT;case Je.AlphaFormat:return e.ALPHA;case Je.RGBFormat:return e.RGB;case Je.RGBAFormat:return e.RGBA;case Je.LuminanceFormat:return e.LUMINANCE;case Je.LuminanceAlphaFormat:return e.LUMINANCE_ALPHA;case Je.AddEquation:return e.FUNC_ADD;case Je.SubtractEquation:return e.FUNC_SUBTRACT;case Je.ReverseSubtractEquation:return e.FUNC_REVERSE_SUBTRACT;case Je.ZeroFactor:return e.ZERO;case Je.OneFactor:return e.ONE;case Je.SrcColorFactor:return e.SRC_COLOR;case Je.OneMinusSrcColorFactor:return e.ONE_MINUS_SRC_COLOR;case Je.SrcAlphaFactor:return e.SRC_ALPHA;case Je.OneMinusSrcAlphaFactor:return e.ONE_MINUS_SRC_ALPHA;case Je.DstAlphaFactor:return e.DST_ALPHA;case Je.OneMinusDstAlphaFactor:return e.ONE_MINUS_DST_ALPHA;case Je.DstColorFactor:return e.DST_COLOR;case Je.OneMinusDstColorFactor:return e.ONE_MINUS_DST_COLOR;case Je.SrcAlphaSaturateFactor:return e.SRC_ALPHA_SATURATE}return 0},xi.createElement=function(t,i,r,a){var n,s,o,l,h=t.vertices.length,c=(t.uvs.length,t.vertices),u=i.vertices,f=t.faces,d=i.faces,p=t.uvs,m=i.uvs,g=[],y=[],v=[];a===e&&(a=0),t instanceof Je.Element&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,s=(new $e).getNormalMatrix(n)),i instanceof Je.Element&&(i.matrixAutoUpdate&&i.updateMatrix(),o=i.matrix,l=(new $e).getNormalMatrix(o));for(var x=0,w=c.length;x<w;x++){var _=c[x],b=_.clone();n&&b.applyMatrix4(n),y.push(b)}for(var x=0,w=u.length;x<w;x++){var _=u[x],b=_.clone();o&&b.applyMatrix4(o),y.push(b)}for(x=0,w=f.length;x<w;x++){var M,S,A,P=f[x],T=P.vertexNormals,C=P.vertexColors;M=P instanceof mi?new mi(P.a,P.b,P.c):new gi(P.a,P.b,P.c,P.d),M.normal.copy(P.normal),s&&M.normal.applyMatrix3(s).normalize();for(var z=0,L=T.length;z<L;z++)S=T[z].clone(),s&&S.applyMatrix3(s).normalize(),M.vertexNormals.push(S);M.color.copy(P.color);for(var z=0,L=C.length;z<L;z++)A=C[z],M.vertexColors.push(A.clone());M.materialIndex=P.materialIndex,M.centroid.copy(P.centroid),n&&M.centroid.applyMatrix4(n),g.push(M)}for(x=0,w=d.length;x<w;x++){var M,S,A,P=d[x],T=P.vertexNormals,C=P.vertexColors;M=P instanceof mi?new mi(P.a+h,P.b+h,P.c+h):new gi(P.a+h,P.b+h,P.c+h,P.d+h),M.normal.copy(P.normal),l&&M.normal.applyMatrix3(l).normalize();for(var z=0,L=T.length;z<L;z++)S=T[z].clone(),l&&S.applyMatrix3(l).normalize(),M.vertexNormals.push(S);M.color.copy(P.color);for(var z=0,L=C.length;z<L;z++)A=C[z],M.vertexColors.push(A.clone());M.materialIndex=P.materialIndex+a,M.centroid.copy(P.centroid),o&&M.centroid.applyMatrix4(o),g.push(M)}for(x=0,w=p.length;x<w;x++){for(var E=p[x],D=[],z=0,L=E.length;z<L;z++)D.push(new Qe(E[z].x,E[z].y));v.push(D)}for(x=0,w=m.length;x<w;x++){for(var E=m[x],D=[],z=0,L=E.length;z<L;z++)D.push(new Qe(E[z].x,E[z].y));v.push(D)}var N=new Je.Entity;return N.vertices=y,N.faces=g,N.uvs=v,N.material=r===e?t.material:r,N},xi.transformElement=function(t,e){var i,r,a=t.vertices,n=t.faces,s=t.uvs,o=[],l=[],h=[];t instanceof Je.Element&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,r=(new $e).getNormalMatrix(i));for(var c=0,u=a.length;c<u;c++){var f=a[c],d=f.clone();i&&d.applyMatrix4(i),l.push(d)}for(c=0,u=n.length;c<u;c++){var p,m,g,y=n[c],v=y.vertexNormals,x=y.vertexColors;p=y instanceof mi?new mi(y.a,y.b,y.c):new gi(y.a,y.b,y.c,y.d),p.normal.copy(y.normal),r&&p.normal.applyMatrix3(r).normalize();for(var w=0,_=v.length;w<_;w++)m=v[w].clone(),r&&m.applyMatrix3(r).normalize(),p.vertexNormals.push(m);p.color.copy(y.color);for(var w=0,_=x.length;w<_;w++)g=x[w],p.vertexColors.push(g.clone());p.materialIndex=y.materialIndex,p.centroid.copy(y.centroid),i&&p.centroid.applyMatrix4(i),o.push(p)}for(c=0,u=s.length;c<u;c++){for(var b=s[c],M=[],w=0,_=b.length;w<_;w++)M.push(new Qe(b[w].x,b[w].y));h.push(M)}if(e){var S=new Je.Entity(t.material);S.vertices=l,S.faces=o,S.uvs=h,S.setPosition(0,0,0),S.setRotation(0,0,0),S.setScale(1,1,1);var A={};return A.vertices=l,A.faces=o,A.uvs=h,S.primitive=new Je.Primitive(A),S}t.vertices=l,t.faces=o,t.uvs=h,t.setPosition(0,0,0),t.setRotation(0,0,0),t.setScale(1,1,1);var A={};A.vertices=l,A.faces=o,A.uvs=h,t.primitive=new Je.Primitive(A);for(var c in i.elements)t._attachId+=i.elements[c];return t},xi.mergeElements=function(t){var e,i,r,a,n,s,o=0,l=0,h=0;for(e=0;e<t.length;e++)r=t[e],o+=r.materialSize;var c=new Je.Entity(o),u={},f={},d=(new Ke(0,0,0),[]),p=[],m=[],g=[],y=new Je.ArrayMaterial;for(e=0;e<t.length;e++){for(r=t[e],r.matrixAutoUpdate&&r.updateWorldMatrix(),a=r.worldMatrix.clone(),n=(new $e).getNormalMatrix(a),i=0;i<r.vertices.length;i++)s=r.vertices[i],d.push(s.clone().applyMatrix4(a));for(i=0;i<r.faces.length;i++){var v,x=r.faces[i];x.vertexNormals,x.vertexColors;v=x instanceof mi?new mi(x.a+l,x.b+l,x.c+l):new gi(x.a+l,x.b+l,x.c+l,x.d+l),v.normal.copy(x.normal),n&&v.normal.applyMatrix3(n).normalize(),v.materialIndex=x.materialIndex+h,v.centroid.copy(x.centroid),a&&v.centroid.applyMatrix4(a),p.push(v)}for(i=0,len=r.uvs.length;i<len;i++){for(var w=r.uvs[i],_=[],b=0,M=w.length;b<M;b++)_.push(new Qe(w[b].x,w[b].y));m.push(_)}if(r.uv2s&&r.uv2s.length>0)for(i=0,len=r.uv2s.length;i<len;i++){for(var S=r.uv2s[i],A=[],b=0,M=S.length;b<M;b++)A.push(new Qe(S[b].x,S[b].y));g.push(A)}y.materials=y.materials.concat(r.material.materials),l+=r.vertices.length,h+=r.materialSize;for(var P in r.styleMap){var T=u[P];null==T&&(T=[]);var C=r.styleMap[P],z=!0;if(xi.isArray(C))for(var b=0;b<C.length;b++)T.push(C[e]),b>0&&C[b]!=C[b-1]&&(z=!1);else for(var b=0;b<r.materialSize;b++)T.push(C);1!=f[P]&&null!=f[P]||(f[P]=z),u[P]=T}}for(var P in f)1==f[P]&&(u[P]=u[P][0]);return c.styleMap=u,c.material=y,c.vertices=d,c.faces=p,c.setUvs(m),c.uv2s=g,c.setUpdateFlags(!0),c},xi.mergeElement=function(t,i,r){var a,n,s,o,l=t.vertices.length,h=(t.uvs.length,t.vertices),c=i.vertices,u=t.faces,f=i.faces,d=t.uvs,p=i.uvs,m=[],g=[],y=[];r===e&&(r=0),t instanceof Je.Element&&(t.matrixAutoUpdate&&t.updateMatrix(),a=t.matrix,n=(new $e).getNormalMatrix(a)),i instanceof Je.Element&&(i.matrixAutoUpdate&&i.updateMatrix(),s=i.matrix,o=(new $e).getNormalMatrix(s));for(var v=0,x=h.length;v<x;v++){var w=h[v],_=w.clone();a&&_.applyMatrix4(a),g.push(_)}for(var v=0,x=c.length;v<x;v++){var w=c[v],_=w.clone();s&&_.applyMatrix4(s),g.push(_)}for(v=0,x=u.length;v<x;v++){var b,M,S,A=u[v],P=A.vertexNormals,T=A.vertexColors;b=A instanceof mi?new mi(A.a,A.b,A.c):new gi(A.a,A.b,A.c,A.d),b.normal.copy(A.normal),n&&b.normal.applyMatrix3(n).normalize();for(var C=0,z=P.length;C<z;C++)M=P[C].clone(),n&&M.applyMatrix3(n).normalize(),b.vertexNormals.push(M);b.color.copy(A.color);for(var C=0,z=T.length;C<z;C++)S=T[C],b.vertexColors.push(S.clone());b.materialIndex=A.materialIndex,b.centroid.copy(A.centroid),a&&b.centroid.applyMatrix4(a),m.push(b)}for(v=0,x=f.length;v<x;v++){var b,M,S,A=f[v],P=A.vertexNormals,T=A.vertexColors;b=A instanceof mi?new mi(A.a+l,A.b+l,A.c+l):new gi(A.a+l,A.b+l,A.c+l,A.d+l),b.normal.copy(A.normal),o&&b.normal.applyMatrix3(o).normalize();for(var C=0,z=P.length;C<z;C++)M=P[C].clone(),o&&M.applyMatrix3(o).normalize(),b.vertexNormals.push(M);b.color.copy(A.color);for(var C=0,z=T.length;C<z;C++)S=T[C],b.vertexColors.push(S.clone());b.materialIndex=A.materialIndex+r,b.centroid.copy(A.centroid),s&&b.centroid.applyMatrix4(s),m.push(b)}for(v=0,x=d.length;v<x;v++){for(var L=d[v],E=[],C=0,z=L.length;C<z;C++)E.push(new Qe(L[C].x,L[C].y));y.push(E)}for(v=0,x=p.length;v<x;v++){for(var L=p[v],E=[],C=0,z=L.length;C<z;C++)E.push(new Qe(L[C].x,L[C].y));y.push(E)}return t.vertices=g,t.faces=m,t.uvs=y,t._position.set(0,0,0),t._rotation.set(0,0,0),t._scale.set(1,1,1),t},xi.autoAdjustNetworkBounds=function(e,i,r,a,n,s){n=n||0,s=s||0,e.adjustBounds(i[r]-n,i[a]-s),t.addEventListener?t.addEventListener("resize",function(){e.adjustBounds(i[r]-n,i[a]-s,s,n)},!0):t.attachEvent?t.attachEvent("onresize",function(){e.adjustBounds(i[r]-n,i[a]-s,s,n)}):t.onresize=function(){e.adjustBounds(i[r]-n,i[a]-s,s,n)}},xi.isEmptyObject=function(t){for(var e in t)return!1;return!0},xi.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},xi.isSame=function(t,e){if(t===e)return!0;if(null==t&&null!=e)return!1;if(null!=t&&null==e)return!1;if(typeof t!=typeof e)return!1;for(var i in t)if(t[i]!=e[i])return!1;for(var i in e)if(t[i]!=e[i])return!1;return!0},xi.toString=function(t){if(t){var e="";for(var i in t)e+=i+":"+t[i];return e}},xi.validateLicense=function(t){Ti=t,Hi()},xi.getLicense=function(){return Ti},xi.getObjectCount=function(t){if(!t)return 0;var e=0;for(var i in t)e++;return e},xi.isNaN=function(t){return""===t||null===t||isNaN(t)},xi.getTransformVertices=function(t,e,i){null==i&&(i=[]);var r,a;if(t instanceof Je.Node||t instanceof Je.Billboard){for(r=0;r<t.vertices.length;r++)a=t.vertices[r].clone(),t instanceof Je.Billboard?(a.x*=t.rotation3d.x,a.y*=t.rotation3d.y,a.add(t.getPosition())):a.applyMatrix4(t.worldMatrix),i.push(a);for(var r=0;r<(t._childList?t._childList.size():0);r++){var n=t._childList.get(r);xi.getTransformVertices(n,e,i)}}return i},xi.getBoundingBox=function(t,e){var i,r,a;if(null==t)return null;i=t instanceof ci?t._as:xi.isArray(t)?t:[t];var n=[];for(r=0;r<i.length;r++)a=i[r],xi.getTransformVertices(a,e,n);var s=new Je.BoundingBox;return s.setFromPoints(n),s},xi.mergeWrapMap=function(t){if(t instanceof yi&&!t.getWrapMap()){for(var e,i=[],r=(t.getMaterialMapping(),t.material.materials),a=0;a<r.length;a++)e=r[a],e.map&&i.indexOf(e.map._image)==-1&&i.push(e.map._image);t.setWrapMap(!0)}},xi.setWrapMap=function(t,e,i,r){xi.loadImages(e,function(a){var n=mono.Utils.createWrapMapFromImages(a,i,r);n.__uniqueCode="";for(var s=0;s<e.length;s++)n.__uniqueCode+=e[s].src;for(var s in i)n.__uniqueCode+=s+":"+i[s];if(xi.isArray(t))for(var s=0;s<t.length;s++)t[s].setStyle("m.texture.image",n),t[s].setClient("_originalImage",e),t[s].setClient("_wrapMapping",i);else t.setStyle("m.texture.image",n),t.setClient("_wrapMapping",i)})},xi.loadImages=function(t,e){function i(t){t.onload=function(){t.loaded=!0,r(),t.onload=null}}function r(){for(var i=0;i<t.length;i++)if(!t[i].loaded)return;e(t)}if(null!=t&&0!=t.length&&null!=e)for(var a=0;a<t.length;a++){var n=t[a];"string"==typeof n&&(t[a]=new Image,t[a].crossOrigin="",t[a].src=n),n=t[a],i(n)}},xi.createWrapMapFromImages=function(t,e,i,r,a){if(null==t||0==t.length)return null;i=(i||"six-each").toLowerCase();var n="six-each"==i||"front-other"==i||"back-other"==i||"left-other"==i||"right-other"==i||"top-other"==i||"bottom-other"==i;if(n){null==e&&(e={0:"bottom",1:"top",2:"back",3:"left",4:"front",5:"right"});var s=document.createElement("canvas"),o=s.getContext("2d"),l=0,h=0;if("six-each"==i){var c={bottom:[0,0],top:[1/3,0],back:[2/3,0],left:[0,.5],front:[1/3,.5],right:[2/3,.5]};if(null==r||null==a)for(var u=0;u<t.length;u++)l=Math.max(t[u].width,l),h=Math.max(t[u].height,h);l*=3,h*=2,l>1024&&(l=1024),h>1024&&(h=1024);var f,d=["front","back","right","left","top","bottom"],p=[];for(var u in e){var m=e[u];"other"!==m?(p.push(m),d.splice(d.indexOf(m),1)):f=u}null!=f&&(e[f]=d),r=r||l,a=a||h,s.setAttribute("width",r),s.setAttribute("height",a);for(var u=(Math.min(t.length,6),0);u<6;u++){var g=e[u];if(g){var y=g;y=xi.isArray(g)?g:g.indexOf(",")!=-1?g.split(","):[g];for(var v=0;v<y.length;v++){var m=y[v],x=c[m][0],w=c[m][1];o.drawImage(t[u],x*r,w*a,r/3,a/2)}}}}else{var _=i.split("-")[0];if(null==r||null==a)for(var u=0;u<t.length;u++)l+=t[u].width,h=Math.max(t[u].height,h);r=r||l,a=a||h,s.setAttribute("width",r),s.setAttribute("height",a);for(var u=(e[_],Math.min(t.length,2),0);u<2;u++){var g=e[u];g&&(g==_?o.drawImage(t[u],0,0,r/2,a):o.drawImage(t[u],r/2,0,r/2,a))}}return s}},xi.getVectorAngles=function(t,e){var i=t;e&&(i=e.clone().sub(t)),i=i.normalize();var r=Math.asin(i.y)*wi,a=Math.atan2(i.x,i.z)*wi;return[a,r]},xi.getPixelFromImage=function(t,e,i){var r;ei.isCanvas(t)?r=t:(r=document.createElement("canvas"),r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(t,0,0,t.width,t.height)),e-=Math.floor(e),i-=Math.floor(i),i=1-i;var a=r.getContext("2d").getImageData(t.width*e,t.height*i,1,1).data;return a},xi.nextPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t++,t},xi.createTextBillboard=function(t,e){var i=new mono.Billboard;t=t||"",e=e||{};var r=xi.createTextImage(t,e);return i.setStyle("m.texture.image",r),i.setScale(r.width,r.height,1),i},xi.createTextImage=function(t,i){t=t||"";var r=i.font,a=i.color,n=i.background,s=i.powerOfTwo,o=i.canvas,l=i.drawFunction;o=o||document.createElement("canvas"),r=r||'20px "Dialog"',a=a||"white",n=n===e?"#0F90C4":n,s=s||!1;var h,c=i.textAlign||"center";h=xi.isArray(t)?t:t.split("\n");var u=mono.Utils.getMaxTextSize(h,r),f=i.ratio||u.width/u.height,d=o.realSize={width:u.width,height:u.height};s&&(u.width=mono.Utils.nextPowerOfTwo(u.width),u.height=mono.Utils.nextPowerOfTwo(u.height));var p=o.drawRect={width:d.width/d.height>f?d.width:d.height*f,height:d.width/d.height>f?d.width/f:d.height};Number.isNaN(p.width)&&console.log("debug -- b",d.width,d.height,f),p.width=Math.min(p.width,u.width),p.height=Math.min(p.height,u.height),o.width=u.width,o.height=u.height,Number.isNaN(p.width)&&console.log("debug -- a");var m=o.getContext("2d");if(n&&(m.fillStyle=n),l)l(m,o.width,o.height);else{n&&m.fillRect(0,0,o.width,o.height),m.font=r,m.fillStyle=a,m.strokeStyle="gray",m.textBaseline="middle",m.textAlign=c;for(var g,y=h.length,v=d.height/y,x=0;x<y;x++){xi.isArray(a)&&(g=a[x],g&&(m.fillStyle=g));var w=mono.Utils.getTextSize(r,h[x]),_=(w.width,w.height,o.height,(p.width-d.width)/2);"center"===c?_=p.width/2:"right"===c&&(_=p.width);var b=(p.height-d.height)/2+v/2+x*v+(o.height-p.height);m.strokeText(h[x],_,b),m.fillText(h[x],_,b)}}return o},xi.createTextImage2=function(t,i){t=t||"",t=String(t);var a=i.font,n=i.color,s=i.background,o=i.powerOfTwo,l=i.canvas,h=i.drawFunction;l=l||document.createElement("canvas"),a=a||'20px "Dialog"',n=n||"white",s=s===e?"#0F90C4":s,o=o||!1;var c=(i.align||"center",i.sizeScale||1),u=xi.getMaxTextSize(t.split("\n"),a);l.realSize={width:u.width,height:u.height},u.width*=c,u.height*=c,o&&(u.width=xi.nextPowerOfTwo(u.width),u.height=xi.nextPowerOfTwo(u.height)),l.width=u.width,l.height=u.height;var f=l.getContext("2d");return s&&(f.fillStyle=s),h?h(f,l.width,l.height):(s&&f.fillRect(0,0,l.width,l.height),r(f,t,a,n,l,"center")),l},xi.getMaxTextSize=function(t,e){if(t&&t.length>0){for(var i=t.length,r=ni.getTextSize(e,t[0]),a=r.width,n=r.height*i,s=0;s<i;s++){var o=ni.getTextSize(e,t[s]).width;a<o&&(a=o)}return{width:a,height:n}}return null},xi.getTextSize=function(t,e){return ni.getTextSize(t,e)},xi.playCameraAnimation=function(t,e,i,r,a){e=e||t.p(),i=i||t.getTarget(),r=r||2e3;var n=mono.Utils.getVectorAngles(t.getTarget(),t.p()),s=mono.Utils.getVectorAngles(i,e),o=t.getTarget(),l=i,h=t.getDistance(),c=(new mono.Vec3).subVectors(e,i).length();new mono.Animate({from:0,to:1,repeat:1,dur:r,onPlay:function(){},onUpdate:function(e){var i=n[0]+(s[0]-n[0])*e,r=n[1]+(s[1]-n[1])*e,a=(new mono.Vec3).lerpVectors(o,l,e),u=h+(c-h)*e,f=new mono.Vec3;f.x=a.x+u*Math.sin(i*_i)*Math.cos(r*_i),f.z=a.z+u*Math.cos(i*_i)*Math.cos(r*_i),f.y=a.y+u*Math.sin(r*_i),t.lookAt(a),t.p(f)},onDone:function(){a&&a()}}).play()},xi.stopAnimate=function(t,e){Xe(t,e)},xi.stopAllAnimates=function(t){We(t)},Je.Utils=xi,Je.GLParameters=function(t,e,i){this.material=t,this.network=e,this.precision=e._precision,this.map=!!t.map,this.mapLoaded=!0,this.envMap=!!t.envMap,this.lightMap=!!t.lightMap,this.bumpMap=!!t.bumpMap&&"phong"===t._type,this.normalMap=!!t.normalMap&&"phong"===t._type,this.specularMap=!!t.specularMap,this.vertexColors=t.vertexColors,this.fog=e._fog,this.useFog=t.fog,this.fogExp=this.fog instanceof Je.FogExp2,this.sizeAttenuation=t.sizeAttenuation,this.skinning=t.skinning,this.maxBones=e.maxBones,this.useVertexTexture=e._supportsBoneTextures&&i&&i.useVertexTexture,this.boneTextureWidth=i&&i.boneTextureWidth,this.boneTextureHeight=i&&i.boneTextureHeight,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.maxMorphTargets=e.maxMorphTargets,this.maxMorphNormals=e.maxMorphNormals,this.maxDirLights=e.maxLightCount.directional,this.maxPointLights=e.maxLightCount.point,this.maxSpotLights=e.maxLightCount.spot,this.maxHemiLights=e.maxLightCount.hemi,this.maxShadows=e.maxShadows,this.maxPointShadows=e.maxPointShadows,this.shadowMapEnable=e._shadowMapEnable&&i.receiveShadow&&this.maxShadows>0,this.pointShadowMapEnable=e._shadowMapEnable&&i.receiveShadow&&this.maxPointShadows>0,this.shadowMapType=e.shadowMapType,this.shadowMapDebug=e.shadowMapDebug,this.shadowMapCascade=e.shadowMapCascade,this.alphaTest=t.alphaTest,this.metal=t.metal,this.perPixel=t.perPixel,this.wrapAround=t.wrapAround,this.doubleSided=t.side===Je.DoubleSide&&!ii.isIE,this.flipSided=t.side===Je.BackSide,this.useSSAO=e.isSSAOEnable()&&e.pm.isLightMaterial(t),this.gammaInput=e.gammaInput,this.gammaOutput=e.gammaOutput,this.physicallyBasedShading=e.physicallyBasedShading,this.supportsVertexTextures=!1,this.shadowMapTypeDefine="SHADOWMAP_TYPE_BASIC",this.shadowMapType===Je.PCFShadowMap?this.shadowMapTypeDefine="SHADOWMAP_TYPE_PCF":this.shadowMapType===Je.PCFSoftShadowMap&&(this.shadowMapTypeDefine="SHADOWMAP_TYPE_PCF_SOFT"),this.maxGrandient=xi.getObjectCount(t.gradient)},Je.GLParameters.prototype.getShaders=function(t){t=t===e?"":t;var i=this,r=["precision "+i.precision+" float;",t,this.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.gammaInput?"#define GAMMA_INPUT":"",i.gammaOutput?"#define GAMMA_OUTPUT":"",i.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,"#define MAX_POINT_SHADOWS "+i.maxPointShadows,"#define MAX_BONES "+i.maxBones,i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.vertexColors?"#define USE_COLOR":"",i.maxGrandient>0?"#define MAX_GRADIENT "+i.maxGrandient:"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.boneTextureWidth?"#define N_BONE_PIXEL_X "+i.boneTextureWidth.toFixed(1):"",i.boneTextureHeight?"#define N_BONE_PIXEL_Y "+i.boneTextureHeight.toFixed(1):"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals?"#define USE_MORPHNORMALS":"",i.perPixel?"#define PHONG_PER_PIXEL":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnable?"#define USE_SHADOWMAP":"",i.shadowMapEnable?"#define "+i.shadowMapTypeDefine:"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.pointShadowMapEnable?"#define USE_POINT_SHADOWMAP":"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n"),a=["precision "+this.precision+" float;",i.bumpMap||i.normalMap?"#extension GL_OES_standard_derivatives : enable":"",t,"#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,"#define MAX_POINT_SHADOWS "+i.maxPointShadows,i.useSSAO?"#define USE_SSAO":"",i.alphaTest?"#define ALPHATEST "+i.alphaTest:"",this.gammaInput?"#define GAMMA_INPUT":"",this.gammaOutput?"#define GAMMA_OUTPUT":"",this.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.maxGrandient>0?"#define MAX_GRADIENT "+i.maxGrandient:"",i.vertexColors?"#define USE_COLOR":"",i.metal?"#define METAL":"",i.perPixel?"#define PHONG_PER_PIXEL":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnable?"#define USE_SHADOWMAP":"",i.shadowMapEnable?"#define "+i.shadowMapTypeDefine:"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.pointShadowMapEnable?"#define USE_POINT_SHADOWMAP":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n");
return[r,a]};var bi={};bi.setDepthTest=function(t,e){var i=e._gl;e._oldDepthTest!==t&&(t?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),e._oldDepthTest=t)},bi.setSmapleAlphaToCoverage=function(t,e){var i=e._gl;e._oldSmapleAlphaToCoverage!==t&&(t?i.enable(i.SAMPLE_ALPHA_TO_COVERAGE):i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),e._oldSmapleAlphaToCoverage=t)},bi.setDepthWrite=function(t,e){var i=e._gl;e._oldDepthWrite!==t&&(i.depthMask(t),e._oldDepthWrite=t)},bi.clear=function(t,i,r,a){var n=a._gl,s=0;(t===e||t)&&(s|=n.COLOR_BUFFER_BIT),(i===e||i)&&(s|=n.DEPTH_BUFFER_BIT),(r===e||r)&&(s|=n.STENCIL_BUFFER_BIT),a._gl.clear(s)},bi.setPolygonOffset=function(t,e,i,r){var a=r._gl;r._oldPolygonOffset!==t&&(t?a.enable(a.POLYGON_OFFSET_FILL):a.disable(a.POLYGON_OFFSET_FILL),r._oldPolygonOffset=t),t&&(r._oldPolygonOffsetFactor!==e||r._oldPolygonOffsetUnits!==i)&&(a.polygonOffset(e,i),r._oldPolygonOffsetFactor=e,r._oldPolygonOffsetUnits=i)},bi.setBlending=function(t,e,i,r,a){var n=a._gl;t!==a._oldBlending&&(t===Je.NoBlending?n.disable(n.BLEND):t===Je.AdditiveBlending?(n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE)):t===Je.SubtractiveBlending?(n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ZERO,n.ONE_MINUS_SRC_COLOR)):t===Je.MultiplyBlending?(n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ZERO,n.SRC_COLOR)):t===Je.CustomBlending?n.enable(n.BLEND):(n.enable(n.BLEND),n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)),a._oldBlending=t),t===Je.CustomBlending?(e!==this._oldBlendEquation&&(n.blendEquation(paramThreeToGL(e)),a._oldBlendEquation=e),i===_oldBlendSrc&&r===_oldBlendDst||(n.blendFunc(paramToGL(i),paramToGL(r)),a._oldBlendSrc=i,a._oldBlendDst=r)):(a._oldBlendEquation=null,a._oldBlendSrc=null,a._oldBlendDst=null)},bi.enableStencil=function(t){t.enable(t.STENCIL_TEST),t.stencilFunc(t.ALWAYS,1,1),t.stencilOp(t.KEEP,t.KEEP,t.REPLACE),t.stencilMask(1),t.clearStencil(0),t.clear(t.STENCIL_BUFFER_BIT)},bi.stencilTest=function(t){t.enable(t.STENCIL_TEST),t.stencilFunc(t.EQUAL,0,1),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.stencilMask(0)},bi.disableStencil=function(t){t.disable(t.STENCIL_TEST)},bi.r=function(t,e,i,r,a,n,s){t._AK47(e,i,r,a,n,s)},bi.g=function(t,e,i,r,a,n){t.renderGroup(e,i,r,a,n)},Je.GLUtils=bi,Je.GPU=function(t){var e=t._gl;this._glExtensionTextureFloat=e.getExtension("OES_texture_float"),this._glExtensionStandardDerivatives=e.getExtension("OES_standard_derivatives"),this._glExtensionTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this._glExtensionCompressedTextureS3TC=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._glExtensionTextureFloat||console.log("Float textures not supported."),this._glExtensionStandardDerivatives||console.log("Standard derivatives not supported."),this._glExtensionTextureFilterAnisotropic||console.log("Anisotropic texture filtering not supported."),this._glExtensionCompressedTextureS3TC||console.log("S3TC compressed textures not supported."),this._maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this._maxVertexTextures=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this._maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this._maxAnisotropy=this._glExtensionTextureFilterAnisotropic?e.getParameter(this._glExtensionTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._supportsVertexTextures=this._maxVertexTextures>0,this._supportsBoneTextures=this._supportsVertexTextures&&this._glExtensionTextureFloat,this._compressedTextureFormats=this._glExtensionCompressedTextureS3TC?e.getParameter(e.COMPRESSED_TEXTURE_FORMATS):[],this._vertexShaderPrecisionHighpFloat=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT),this._vertexShaderPrecisionMediumpFloat=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT),this._vertexShaderPrecisionLowpFloat=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.LOW_FLOAT),this._fragmentShaderPrecisionHighpFloat=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT),this._fragmentShaderPrecisionMediumpFloat=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT),this._fragmentShaderPrecisionLowpFloat=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.LOW_FLOAT),this._vertexShaderPrecisionHighpInt=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_INT),this._vertexShaderPrecisionMediumpInt=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_INT),this._vertexShaderPrecisionLowpInt=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.LOW_INT),this._fragmentShaderPrecisionHighpInt=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_INT),this._fragmentShaderPrecisionMediumpInt=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_INT),this._fragmentShaderPrecisionLowpInt=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.LOW_INT);var i=this._vertexShaderPrecisionHighpFloat.precision>0&&this._fragmentShaderPrecisionHighpFloat.precision>0,r=this._vertexShaderPrecisionMediumpFloat.precision>0&&this._fragmentShaderPrecisionMediumpFloat.precision>0,a=t._precision;"highp"===a&&!i&&(r?(a="mediump",console.log("highp not supported, using mediump")):(a="lowp",console.log("highp and mediump not supported, using lowp"))),"mediump"===a&&!r&&(a="lowp",console.log("mediump not supported, using lowp")),t._precision=a},Je.Program=function(t,e,i,r){this.entity=t,this.group=e,this.material=i,this.network=r},Je.Program.prototype.setEntity=function(){this.entity},Je.Program.prototype.buildGLProgram=function(){},Je.Uniform=function(t,i,r){this.id=t,this.type=i,this.value=r,this.location=e},Je.Uniform.prototype={constructor:Je.Uniform,setValue:function(t){this.value=t},getUniformLocation:function(t,e){return t.getUniformLocation(this.id)}},Je.Uniform.loadUniform=function(t,r,a){if(type=r.type,value=r.value,"i"===type)a.uniform1i(t,value);else if("f"===type)a.uniform1f(t,value);else if("v2"===type)a.uniform2f(t,value.x,value.y);else if("v3"===type)a.uniform3f(t,value.x,value.y,value.z);else if("v4"===type)a.uniform4f(t,value.x,value.y,value.z,value.w);else if("c"===type)a.uniform3f(t,value.r,value.g,value.b);else if("iv1"===type)a.uniform1iv(t,value);else if("iv"===type)a.uniform3iv(t,value);else if("fv1"===type)a.uniform1fv(t,value);else if("fv"===type)a.uniform3fv(t,value);else if("v2v"===type){for(r._array===e&&(r._array=new Float32Array(2*value.length)),i=0,il=value.length;i<il;i++)offset=2*i,r._array[offset]=value[i].x,r._array[offset+1]=value[i].y;a.uniform2fv(t,r._array)}else if("v3v"===type){for(r._array===e&&(r._array=new Float32Array(3*value.length)),i=0,il=value.length;i<il;i++)offset=3*i,r._array[offset]=value[i].x,r._array[offset+1]=value[i].y,r._array[offset+2]=value[i].z;a.uniform3fv(t,r._array)}else if("v4v"===type){for(r._array===e&&(r._array=new Float32Array(4*value.length)),i=0,il=value.length;i<il;i++)offset=4*i,r._array[offset]=value[i].x,r._array[offset+1]=value[i].y,r._array[offset+2]=value[i].z,r._array[offset+3]=value[i].w;a.uniform4fv(t,r._array)}else if("m4"===type)r._array===e&&(r._array=new Float32Array(16)),value.flattenToArray(r._array),a.uniformMatrix4fv(t,!1,r._array);else if("m4v"===type){for(r._array===e&&(r._array=new Float32Array(16*value.length)),i=0,il=value.length;i<il;i++)value[i].flattenToArrayOffset(r._array,16*i);a.uniformMatrix4fv(t,!1,r._array)}else if("t"===type)texture=value,textureUnit=getTextureUnit(),a.uniform1i(t,textureUnit),!texture||(texture.image instanceof Array&&6===texture.image.length?setCubeTexture(texture,textureUnit):texture instanceof $CubeRenderTargetCube?setCubeTextureDynamic(texture,textureUnit):_this.setTexture(texture,textureUnit));else if("tv"===type){for(r._array===e&&(r._array=[]),i=0,il=r.value.length;i<il;i++)r._array[i]=getTextureUnit();for(a.uniform1iv(t,r._array),i=0,il=r.value.length;i<il;i++)texture=r.value[i],textureUnit=r._array[i],texture&&_this.setTexture(texture,textureUnit)}},Je.Uniform.loadGeneralUniforms=function(t,e,i){var r,a,n,s;for(n=0,s=e.length;n<s;n++)a=t.uniforms[e[n][1]],a&&(r=e[n][0],Je.Uniform.loadUniform(r,i))},Je.ProgramManager=function(t){this.id=Je.ProgramManagerId++,Je.ProgramManagerCache.count++,this.network=t,this.gl=this.network._gl,this.gpu=this.network.gpu,this.programs=[],this.currentProgram=null,this.currentEntity=null,this.currentGroup=null,this.currentMaterial=null,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0},currentMaterialId:-1},this.textures=[],this.textureCount=0,this._lightNeedsUpdate=!0,this._lights={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}},this.gammaInput=!1,this.textureCount=0,this.programMap={},this.textureMap={},this.textureUpdateFlags={},this.glTextureMap={},this.textureMaterialMap={},this.unLoadedImage={},this.materialMap={},this.materialUpdateFlags={},this.handleTextureChange=function(t){if("image"===t.property||"loaded"===t.property){var e=t.source;this.changeTextureUpdateFlags(e,!0),delete this.unLoadedImage[e._image]}else if("disposed"===t.property){var e=t.source;this.deallocateTexture(e),e.removePropertyChangeListener(this.handleTextureChange),delete this.textureUpdateFlags[e.id],delete this.textureMap[e.id]}xi.getObjectCount(this.unLoadedImage)<=0&&this.network.dirtyNetwork()},this.handleMaterialChange=function(t){if("map"==t.property||t.property.endsWith("Map")||"needsUpdate"===t.property){var e=t.source;this.materialUpdateFlags[e.id]=!0}else if("disposed"===t.property){var e=t.source;this.deallocateMaterial(e),e.removePropertyChangeListener(this.handleMaterialChange),delete this.materialUpdateFlags[e.id],delete this.materialMap[e.id],delete this.programMap[e.id]}xi.getObjectCount(this.unLoadedImage)<=0&&this.network.dirtyNetwork()}},Je.ProgramManager.prototype.addMaterial=function(t){null==this.materialMap[t.id]&&(this.materialMap[t.id]=t,t.addPropertyChangeListener(this.handleMaterialChange,this))},Je.ProgramManager.prototype.needsUpdateMaterial=function(t){return this.materialUpdateFlags[t.id]===e||this.materialUpdateFlags[t.id]===!0||(t.map instanceof Mi||t.map instanceof Si)},Je.ProgramManager.prototype.changeMaterialUpdateFlags=function(t,e){this.materialUpdateFlags[t.id]=e},Je.ProgramManager.prototype.isLightMaterial=function(t){return t instanceof Je.LambertMaterial||t instanceof Je.PhongMaterial||t.lights||"lambert"===t._type||"phong"===t._type||"terrain"===t._type},Je.ProgramManager.prototype.changeAllMaterialUpdateFlags=function(t,e,i){for(var r in this.materialMap){var a=this.materialMap[r];(null==e||e.call(i,a))&&(this.materialUpdateFlags[a.id]=t)}},Je.ProgramManager.prototype.changeAllLightMaterialUpdateFlags=function(t){this.changeAllMaterialUpdateFlags(t,this.isLightMaterial,this)},Je.ProgramManager.prototype.addTexture=function(t){null!=t.id&&this.textureMap[t.id]===e&&(this.textureMap[t.id]=t,t.addPropertyChangeListener(this.handleTextureChange,this),t._image.loaded||(this.unLoadedImage[t._image]=1))},Je.ProgramManager.prototype.needsUpdateTexture=function(t){return this.textureUpdateFlags[t.id]===e||this.textureUpdateFlags[t.id]===!0},Je.ProgramManager.prototype.changeTextureUpdateFlags=function(t,e){this.textureUpdateFlags[t.id]=e;for(var i in this.materialMap){var r=this.materialMap[i];(r.map===t||r.lightMap===t||r.envMap===t||r.normalMap===t||r.specularMap===t)&&this.changeMaterialUpdateFlags(r,!0)}},Je.ProgramManager.prototype.buildProgram=function(t,e,i){this.currentEntity=t,this.currentGroup=e,this.currentMaterial=i,i.shaderID||i.setupMaterialShader();var r,a,n,s,o=new Je.GLParameters(this.currentMaterial,this.network,t),h=[];i.shaderID?h.push(i.shaderID):(h.push(i.vertexShader),h.push(i.fragmentShader));for(qi in o)"material"!==qi&&"network"!==qi&&"node"!==qi&&(h.push(qi),h.push(o[qi]));for(s=h.join(),r=0,a=this.programs.length;r<a;r++)if(this.programs[r].code===s){i.program=this.programs[r].program,i.uniformsList=[];for(p in i.uniforms)i.uniformsList.push([i.uniforms[p],p]);return this.programs[r].usedTimes++,this.programs[r].program}n=this.gl.createProgram();var c=o.getShaders(),u=c[1],f=c[0];this.gl.attachShader(n,l("fragment",u+i.fragmentShader,this.gl)),this.gl.attachShader(n,l("vertex",f+i.vertexShader,this.gl)),this.gl.linkProgram(n),this.gl.getProgramParameter(n,this.gl.LINK_STATUS)||console.log("Could not initialise shader\nVALIDATE_STATUS: "+this.gl.getProgramParameter(n,this.gl.VALIDATE_STATUS)+", gl error ["+this.gl.getError()+"]"),n.uniforms={},n.attributes={};var d,p,m,r;d=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","boneGlobalMatrices","morphTargetInfluences"];for(p in i.uniforms)d.push(p);for(this.attachGLLocations(n,d,"uniform"),d=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"],r=0;r<o.maxMorphTargets;r++)d.push("morphTarget"+r);for(r=0;r<o.maxMorphNormals;r++)d.push("morphNormal"+r);for(m in i.attributes)d.push(m);this.attachGLLocations(n,d,"attribute"),n.id=this.programs.length,this.programs.push({program:n,code:s,usedTimes:1}),this.info.memory.programCount=this.programs.length,i.program=n,i.uniformsList=[];for(p in i.uniforms)i.uniformsList.push([i.uniforms[p],p]);return n},Je.ProgramManager.prototype.enableAttribute=function(t,i){var r=i.program.attributes;if(r.position>=0&&_gl.enableVertexAttribArray(r.position),r.color>=0&&_gl.enableVertexAttribArray(r.color),r.normal>=0&&_gl.enableVertexAttribArray(r.normal),i.attributes)for(a in i.attributes)r[a]!==e&&r[a]>=0&&_gl.enableVertexAttribArray(r[a])},Je.ProgramManager.prototype.attachGLLocations=function(t,e,i){var r,a,n,s=this.gl;if("uniform"===i)for(r=0,a=e.length;r<a;r++)n=e[r],t.uniforms[n]=s.getUniformLocation(t,n);else if("attribute"===i)for(r=0,a=e.length;r<a;r++)n=e[r],t.attributes[n]=s.getAttribLocation(t,n)},Je.ProgramManager.prototype.getGLShaders=function(t,e){var i;return"fragment"===t?i=this.gl.createShader(this.gl.FRAGMENT_SHADER):"vertex"===tpye&&(i=this.gl.createShader(this.gl.VERTEX_SHADER)),this.gl.shaderSource(i,string),this.gl.compileShader(i),gl.getShaderParameter(i,gl.COMPILE_STATUS)?i:(console.log(gl.getShaderInfoLog(i)),console.log(string),null)},Je.ProgramManager.prototype.setProgram=function(t,e,i,r,a,l){if(this.textureCount=0,this.addMaterial(r),this.needsUpdateMaterial(r)){r.setupMaterialShader(),this.programMap[r.id]&&this.deallocateMaterial(r);var c=this.buildProgram(l,a,r);this.programMap[r.id]=c,this.changeMaterialUpdateFlags(r,!1)}var u=!1,f=this.programMap[r.id],d=f.uniforms,p=r.uniforms;return f!=this.currentProgram&&(this.gl.useProgram(f),this.currentProgram=f,u=!0),r.id!==this.currentMaterialId&&(this.currentMaterialId=r.id,u=!0),(u||t!==this.network._currentCamera)&&(this.gl.uniformMatrix4fv(d.projectionMatrix,!1,t.projectionMatrix.elements),t!==this.network._currentCamera&&(this.network._currentCamera=t)),i&&r.fog&&i.refreshUniforms(p),(r.lights||"phong"===r._type||"lambert"===r._type||"terrain"===r._type)&&(this._lightNeedsUpdate&&(this.setupLights(f,e),this._lightNeedsUpdate=!1),h(p,this._lights)),u&&r.refreshUniforms(!1,{camera:this.network._camera}),l.receiveShadow&&!r._shadowPass&&this.network.isShadowable()&&(n(p,e),s(p,e)),u&&this.loadUniformsGeneric(f,r.uniformsList,r),r.loadCameraPosition(d,t,this.gl),(r.skinning||"phong"===r._type||"lambert"===r._type||"terrain"===r._type||r instanceof Je.ShaderMaterial)&&null!==d.viewMatrix&&this.gl.uniformMatrix4fv(d.viewMatrix,!1,t.worldMatrixInverse.elements),o(d,l,this.gl),null!=d.modelMatrix&&this.gl.uniformMatrix4fv(d.modelMatrix,!1,l.worldMatrix.elements),this.network._baseRender&&this.loadSSAOUniforms(d,r,u),f},Je.ProgramManager.prototype.loadSSAOUniforms=function(t,e,i){if(null!=t.mapSSAO&&this.network._sSAOEnable){var r=t.mapSSAO,a=i?this.getTextureUnit():e._ssaoSlot;this.gl.uniform1i(r,a),this.setTexture(this.network.finalSSAOTarget,a),e._ssaoSlot=a}},Je.ProgramManager.prototype.onTextureDispose=function(t){var e=t.target;e.removeEventListener("dispose",onTextureDispose),deallocateTexture(e),this.info.memory.textures--},Je.ProgramManager.prototype.deallocateTexture=function(t){var e=this.gl;if(t._image&&t._image.__webglTextureCube)e.deleteTexture(t._image.__webglTextureCube);else{if(!t.__webglInit)return;t.__webglInit=!1,e.deleteTexture(t.__webglTexture)}},Je.ProgramManager.prototype.setTextureParameters=function(t,e,i,r){var a=this.gl,n=this.gpu,s=Je.Utils.paramToGL;i&&!r?(a.texParameteri(t,a.TEXTURE_WRAP_S,s(e.wrapS,a)),a.texParameteri(t,a.TEXTURE_WRAP_T,s(e.wrapT,a)),a.texParameteri(t,a.TEXTURE_MAG_FILTER,s(e.magFilter,a)),a.texParameteri(t,a.TEXTURE_MIN_FILTER,s(e.minFilter,a))):(a.texParameteri(t,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(t,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(t,a.TEXTURE_MAG_FILTER,this.filterFallback(e.magFilter)),a.texParameteri(t,a.TEXTURE_MIN_FILTER,this.filterFallback(e.minFilter))),n._glExtensionTextureFilterAnisotropic&&e.type!==Je.FloatType&&(e.anisotropy>1||e.__oldAnisotropy)&&(a.texParameterf(t,n._glExtensionTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e.anisotropy,n._maxAnisotropy)),e.__oldAnisotropy=e.anisotropy)},Je.ProgramManager.prototype.setCubeTexture=function(t,i){var r=this.gl;this.addTexture(t);var a=t.id;if(6===t._image.length){if(!t._image.loaded)return;var n=Je.Utils.isPowerOfTwo,s=Je.Utils.paramToGL;if(this.needsUpdateTexture(t)){this.glTextureMap[a]===e&&(this.glTextureMap[a]=r.createTexture(),this.info.memory.texture++),this.changeTextureUpdateFlags(t,!1),r.activeTexture(r.TEXTURE0+i),r.bindTexture(r.TEXTURE_CUBE_MAP,this.glTextureMap[a]),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var o=t instanceof Je.CompressedTexture,l=[],h=0;h<6;h++)this.autoScaleCubemaps&&!o?l[h]=clampToMaxSize(t._image[h],_maxCubemapSize):l[h]=t._image[h];var c=l[0],u=n(c.width)&&n(c.height),f=s(t.format,r),d=s(t.type,r);this.setTextureParameters(r.TEXTURE_CUBE_MAP,t,u);for(var h=0;h<6;h++)if(o)for(var p,m=l[h].mipmaps,g=0,y=m.length;g<y;g++)p=m[g],r.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+h,g,f,p.width,p.height,0,p.data);else r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,f,f,d,l[h]);t.generateMipmaps&&u&&r.generateMipmap(r.TEXTURE_CUBE_MAP),t.needsUpdate=!1,t.onUpdate&&t.onUpdate()}else r.activeTexture(r.TEXTURE0+i),r.bindTexture(r.TEXTURE_CUBE_MAP,this.glTextureMap[a])}},Je.ProgramManager.prototype.setCubeTextureDynamic=function(t,e){var i=this.gl;i.activeTexture(i.TEXTURE0+e),i.bindTexture(i.TEXTURE_CUBE_MAP,t.__webglTexture)},Je.ProgramManager.prototype.loadUniformsGeneric=function(t,i,r){var a,n,s,o,l,h,c,u,f,d,p,m=this.gl;for(f=0,d=i.length;f<d;f++)if(o=t.uniforms[i[f][1]])if(a=i[f][0],s=a.type,n=a.value,"i"===s)m.uniform1i(o,n);else if("f"===s)m.uniform1f(o,n);else if("v2"===s)m.uniform2f(o,n.x,n.y);else if("v3"===s)m.uniform3f(o,n.x,n.y,n.z);else if("v4"===s)m.uniform4f(o,n.x,n.y,n.z,n.w);else if("c"===s)m.uniform3f(o,n.r,n.g,n.b);else if("iv1"===s)m.uniform1iv(o,n);else if("iv"===s)m.uniform3iv(o,n);else if("fv1"===s)m.uniform1fv(o,n);else if("fv"===s)m.uniform3fv(o,n);else if("v2v"===s){for(a._array===e&&(a._array=new Float32Array(2*n.length)),c=0,u=n.length;c<u;c++)p=2*c,a._array[p]=n[c].x,a._array[p+1]=n[c].y;m.uniform2fv(o,a._array)}else if("v3v"===s){for(a._array===e&&(a._array=new Float32Array(3*n.length)),c=0,u=n.length;c<u;c++)p=3*c,n[c]instanceof Je.Color?(a._array[p]=n[c].r,a._array[p+1]=n[c].g,a._array[p+2]=n[c].b):(a._array[p]=n[c].x,a._array[p+1]=n[c].y,a._array[p+2]=n[c].z);m.uniform3fv(o,a._array)}else if("v4v"===s){for(a._array===e&&(a._array=new Float32Array(4*n.length)),c=0,u=n.length;c<u;c++)p=4*c,a._array[p]=n[c].x,a._array[p+1]=n[c].y,a._array[p+2]=n[c].z,a._array[p+3]=n[c].w;m.uniform4fv(o,a._array)}else if("m4"===s)a._array===e&&(a._array=new Float32Array(16)),n.flattenToArray(a._array),m.uniformMatrix4fv(o,!1,a._array);else if("m4v"===s){for(a._array===e&&(a._array=new Float32Array(16*n.length)),c=0,u=n.length;c<u;c++)n[c].flattenToArrayOffset(a._array,16*c);m.uniformMatrix4fv(o,!1,a._array)}else if("t"===s){if(l=n,h=this.getTextureUnit(),m.uniform1i(o,h),!l)continue;if(l._image instanceof Array&&6===l._image.length)this.setCubeTexture(l,h);else{var g=l._image;this.setTexture(l,h,!g||!g.loaded)}}else if("tv"===s){for(a._array===e&&(a._array=[]),c=0,u=a.value.length;c<u;c++)a._array[c]=this.getTextureUnit();for(m.uniform1iv(o,a._array),c=0,u=a.value.length;c<u;c++)if(l=a.value[c],h=a._array[c],l){var g=l._image;l instanceof Si?this.setCubeTextureDynamic(l,h):this.setTexture(l,h,!g||!g.loaded)}}},Je.ProgramManager.prototype.setTexture=function(t,i,r){var a=this.gl,n=Je.Utils.isPowerOfTwo,s=t.id;if(this.addTexture(t),!this.needsUpdateTexture(t)||t instanceof Mi)a.activeTexture(a.TEXTURE0+i),t instanceof Mi?a.bindTexture(a.TEXTURE_2D,t.__webglTexture):a.bindTexture(a.TEXTURE_2D,this.glTextureMap[s]);else{if(!t._image)return;this.glTextureMap[s]===e&&(this.glTextureMap[s]=a.createTexture(),this.info.memory.textures++),this.changeTextureUpdateFlags(t,!1),a.activeTexture(a.TEXTURE0+i),a.bindTexture(a.TEXTURE_2D,this.glTextureMap[s]),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!t.flipY),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),a.pixelStorei(a.UNPACK_ALIGNMENT,t.unpackAlignment);var o=Je.Utils.paramToGL,l=r?Je.ImageCache.Logo:t._image,h=n(l.width)&&n(l.height),c=o(t.format,a),u=o(t.type,a);this.setTextureParameters(a.TEXTURE_2D,t,h,r);var f,d=t.mipmaps;if(t instanceof Je.PixelsTexture)if(d.length>0&&h){for(var p=0,m=d.length;p<m;p++)f=d[p],a.texImage2D(a.TEXTURE_2D,p,c,f.width,f.height,0,c,u,f.data);t.generateMipmaps=!1}else a.texImage2D(a.TEXTURE_2D,0,c,l.width,l.height,0,c,u,l.data);else if(t instanceof Je.CompressedTexture)for(var p=0,m=d.length;p<m;p++)f=d[p],a.compressedTexImage2D(a.TEXTURE_2D,p,c,f.width,f.height,0,f.data);else if(d.length>0&&h){for(var p=0,m=d.length;p<m;p++)f=d[p],a.texImage2D(a.TEXTURE_2D,p,c,c,u,f);t.generateMipmaps=!1}else try{a.texImage2D(a.TEXTURE_2D,0,c,c,u,l)}catch(g){console.log(g)}t.generateMipmaps&&h&&a.generateMipmap(a.TEXTURE_2D),t.onUpdate&&t.onUpdate()}},Je.ProgramManager.prototype.getTextureUnit=function(){var t=this.textureCount;return t>=this.gpu._maxTextures&&console.warn("Network3D: trying to use "+t+" texture units while this GPU supports only "+this.gpu._maxTextures),this.textureCount++,t},Je.ProgramManager.prototype.deallocateMaterial=function(t){var i=t.program;if(i!==e){t.program=e;var r,a,n,s=!1;for(r=0,a=this.programs.length;r<a;r++)if(n=this.programs[r],n.program===i){n.usedTimes--,0===n.usedTimes&&(s=!0);break}if(s===!0){var o=[];for(r=0,a=this.programs.length;r<a;r++)n=this.programs[r],n.program!==i&&o.push(n);this.programs=o,this.gl.deleteProgram(i),this.info.memory.programs--}}},Je.ProgramManager.prototype.filterFallback=function(t){return t===Je.NearestFilter||t===Je.NearestMipMapNearestFilter||t===Je.NearestMipMapLinearFilter?this.gl.NEAREST:this.gl.LINEAR},Je.ProgramManager.prototype.setupLights=function(t,e){var i,r,a,n,s,o,l,h,c,u,p=0,m=0,g=0,y=this._lights,v=y.directional.colors,x=y.directional.positions,w=y.point.colors,_=y.point.positions,b=y.point.distances,M=y.spot.colors,S=y.spot.positions,A=y.spot.distances,P=y.spot.directions,T=y.spot.anglesCos,C=y.spot.exponents,z=y.hemi.skyColors,L=y.hemi.groundColors,E=y.hemi.positions,D=0,N=0,B=0,R=0,F=0,I=0,k=0,V=0,O=0,U=0,G=0,H=0,j=new Je.Vec3;for(i=0,r=e.size();i<r;i++)if(a=e.get(i),!a.onlyShadow)if(n=a.color,l=a.intensity*this.network.lightIntensityRatio,u=a.distance,a.updateWorldMatrix(!0),a instanceof Je.AmbientLight){if(!a._visible)continue;this.gammaInput?(p+=n.r*n.r,m+=n.g*n.g,g+=n.b*n.b):(p+=n.r,m+=n.g,g+=n.b)}else if(a instanceof Je.DirectionalLight){if(F+=1,!a._visible)continue;if(a.direction?j.copy(a.direction):(j.copy(a.worldMatrix.getPosition()),j.sub(a.target.worldMatrix.getPosition())),j.normalize(),0===j.x&&0===j.y&&0===j.z)continue;O=3*D,x[O]=j.x,x[O+1]=j.y,x[O+2]=j.z,this.gammaInput?d(v,O,n,l*l):f(v,O,n,l),D+=1}else if(a instanceof Je.PointLight){if(I+=1,!a._visible)continue;U=3*N,this.gammaInput?d(w,U,n,l*l):f(w,U,n,l),c=a.worldMatrix.getPosition(),_[U]=c.x,_[U+1]=c.y,_[U+2]=c.z,b[N]=u,N+=1}else if(a instanceof Je.SpotLight){if(k+=1,!a._visible)continue;G=3*B,this.gammaInput?d(M,G,n,l*l):f(M,G,n,l),c=a.worldMatrix.getPosition(),S[G]=c.x,S[G+1]=c.y,S[G+2]=c.z,A[B]=u,j.copy(c),j.sub(a.target.worldMatrix.getPosition()),j.normalize(),P[G]=j.x,P[G+1]=j.y,P[G+2]=j.z,T[B]=Math.cos(a.angle),C[B]=a.exponent,B+=1}else if(a instanceof Je.HemisphereLight){if(V+=1,!a._visible)continue;if(j.copy(a.worldMatrix.getPosition()),j.normalize(),0===j.x&&0===j.y&&0===j.z)continue;H=3*R,E[H]=j.x,E[H+1]=j.y,E[H+2]=j.z,s=a.color,o=a.groundColor,this.gammaInput?(h=l*l,d(z,H,s,h),d(L,H,o,h)):(f(z,H,s,l),f(L,H,o,l)),R+=1}for(i=3*D,r=Math.max(v.length,3*F);i<r;i++)v[i]=0;for(i=3*N,r=Math.max(w.length,3*I);i<r;i++)w[i]=0;for(i=3*B,r=Math.max(M.length,3*k);i<r;i++)M[i]=0;for(i=3*R,r=Math.max(z.length,3*V);i<r;i++)z[i]=0;for(i=3*R,r=Math.max(L.length,3*V);i<r;i++)L[i]=0;y.directional.length=D,y.point.length=N,y.spot.length=B,y.hemi.length=R,y.ambient[0]=p,y.ambient[1]=m,y.ambient[2]=g},Je.ProgramManagerId=0,Je.ProgramManagerCache={count:0};var Mi=function(t,i,r){this.width=t,this.height=i,r=r||{},this.wrapS=r.wrapS!==e?r.wrapS:Je.ClampToEdgeWrapping,this.wrapT=r.wrapT!==e?r.wrapT:Je.ClampToEdgeWrapping,this.magFilter=r.magFilter!==e?r.magFilter:Je.LinearFilter,this.minFilter=r.minFilter!==e?r.minFilter:Je.LinearMipMapLinearFilter,this.anisotropy=r.anisotropy!==e?r.anisotropy:1,this.offset=new Je.Vec2(0,0),this.repeat=new Je.Vec2(1,1),this.format=r.format!==e?r.format:Je.RGBAFormat,this.type=r.type!==e?r.type:Je.UnsignedByteType,this.depthBuffer=r.depthBuffer===e||r.depthBuffer,this.stencilBuffer=r.stencilBuffer===e||r.stencilBuffer,this.generateMipmaps=!0,this.shareDepthFrom=null};Mi.prototype={constructor:Mi,clone:function(){var t=new Mi(this.width,this.height);return t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.format=this.format,t.type=this.type,t.depthBuffer=this.depthBuffer,t.stencilBuffer=this.stencilBuffer,t.generateMipmaps=this.generateMipmaps,t.shareDepthFrom=this.shareDepthFrom,t},getUniqueCode:function(){return this._id},dispose:function(){this.dispatchEvent({type:"dispose"})}};var Si=function(t,e,i){Mi.call(this,t,e,i),this.activeCubeFace=0};Je.extend(Si,Mi,{}),Je.Network3D=function(i,r,a,n){Je.Element.call(this),this.id=Je.Network3DId++,this._interactionDispatcher=new Je.EventDispatcher,n=n||{},this.helperBox=new Je.DataBox,this.helperBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._rootView=ei.createView("hidden"),this._canvas=this.initCanvas(a),this._topCanvas=ei.createCanvas(this),this._bottomCanvas=ei.createCanvas(this);var s=this._canvas.parentNode;s&&(s.removeChild(this._canvas),s.appendChild(this._rootView),this.adjustRootViewBounds(0,0,this._canvas.width,this._canvas.height)),this._rootView.appendChild(this._bottomCanvas),this._rootView.appendChild(this._canvas),this._rootView.appendChild(this._topCanvas),this.setCanvasPropety(),this._camera=r||new Je.PerspectiveCamera,this._camera.addPropertyChangeListener(this.dirtyNetwork,this),this._clearColor=n.clearColor!==e?n.clearColor:new Je.Color(16777215),this._clearAlpha=n.clearAlpha!=e?n.clearAlpha:1,this._precision=n.precision!==e?n.precision:"mediump",this.__fog=new Je.FogExp2,this.devicePixelRatio=n.devicePixelRatio!==e?n.devicePixelRatio:t.devicePixelRatio!==e?t.devicePixelRatio:1,this._premultipliedAlpha=null==n.premultipliedAlpha||n.premultipliedAlpha,this.lightIntensityRatio=1,ii.isIOS||ii.isAndroid?(this._antialias=!1,this._preserveDrawingBuffer=!1,this.lightIntensityRatio=.1):(this._preserveDrawingBuffer=null==n.preserveDrawingBuffer||n.preserveDrawingBuffer,this._antialias=n.antialias==e||n.antialias),this._gl=this.initGL(),this._programs=[],this._currentProgram=null,this.overrideMaterial=null,this._maxLights=n.maxLights!==e?n.maxLights:4,this._projScreenMatrix=new ti,this._projScreenMatrixPS=new ti,this._frustum=new Je.Frustum,this._vector3=new Ke,this._oldDoubleSided=-1,this._oldFlipSided=-1,this._oldBlending=null,this._oldBlendEquation=null,this._oldBlendSrc=null,this._oldBlendDst=null,this._currentCamera=null,this._enabledAttributes={},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.gpu=new Je.GPU(this),this.pm=new Je.ProgramManager(this),this.setDefaultGLState(),this.paintSortFunction=Je.Defaults.paintSortFunction,this.sortNodes=!0,this.sortOpaqueOrderByMaterial=!0,this.glNodeList=[],this.helperGLNodeList=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0},currentMaterialId:-1},this.projector=new Je.Projector,this.up=new Je.Vec3(0,1,0),this.position=new Je.Vec3(0,0,0),this.seletionMaterial=new Je.BasicMaterial,this.seletionMaterial.wireframe=!0,this.seletionMaterial.wireframeLinewidth=1,this.seletionMaterial.color=new Je.Color(65280),this.selectionCube=new yi,this.selectionCube.material=this.seletionMaterial,this.outlineMaterialMap={},this.selectionCube._modelViewMatrix=new ti,this.selectionCube._normalMatrix=new $e,this.selectionCube.name="select",this.alarmMaterial=new Je.BasicMaterial,this.alarmMaterial.wireframe=!0,this.alarmMaterial.wireframeLinewidth=1,this.alarmMaterial.color=new Je.Color(16711680),this.alarmCube=new yi,this.alarmCube.material=this.alarmMaterial,this.alarmCube._modelViewMatrix=new ti,this.alarmCube._normalMatrix=new $e,this.alarmCube.name="alarm";var o=512;this._glowSurface=new Je.Plane(2,2),this._glowSurface2=new Je.Plane(o,o),this._glowSurface.target=new Mi(o,o,{type:Je.UnsignedByteType}),this._glowSurface.target1=new Mi(o,o,{type:Je.UnsignedByteType}),this._glowSurface.target2=new Mi(o,o,{type:Je.UnsignedByteType}),this._glowSurfaceMaterial=new Je.BlurMaterial,this._blurMaterialH=new Je.BlurMaterial,this._blurMaterialH.orientation=1,this._blurMaterialV=new Je.BlurMaterial,this.deferredPostionMaterial=new Je.DeferredMaterial,this.deferredNormalMaterial=new Je.DeferredMaterial({isNormal:1}),this.ssaoMaterial=new Je.SSAOMaterial,this.ssaoMaterial.map2=new Je.Texture(ui.ssaoNormalImage);var l=1024;this.deferredPostionTarget=new Mi(l,l,{type:Je.FloatType,magFilter:Je.NearestFilter,minFilter:Je.NearestFilter}),this.deferredNormalTarget=new Mi(l,l,{type:Je.FloatType,magFilter:Je.NearestFilter,minFilter:Je.NearestFilter,format:Je.RGBFormat}),this.ssaoTarget=new Mi(l,l,{type:Je.FloatType,magFilter:Je.NearestFilter,minFilter:Je.NearestFilter}),this.ssaoTarget1=new Mi(o,o,{type:Je.UnsignedByteType}),this.ssaoTarget2=new Mi(o,o,{type:Je.UnsignedByteType}),this.finalSSAOTarget=null,this._interactions=null,this.billboardRenderer=null,this._groupCounter=0,this.groupMap={},this.groupCountMap={},this.bufferNodeMap={},this.lineMap={},this.particleMap={},this.glInited={},this.glNodeMap={},this.normalNodeMap={},this.showAxis=!1,this.axisSize=20,this.axisPosition=new Je.Vec3(0,0,0),this.axis=new Je.Axis(this.axisSize),this.alarmBillboards=[],this.areaPickingRect={},this.setDataBox(i===e?new Je.DataBox:i),this.renderCallback=null,this.beforeRenderFunction=null,this.dirtyNetwork(),this.prepareData(),this.autoUpdateCameraAspect=!0,this.shadowMapRenderer=null,this.shadowMapType=Je.PCFSoftShadowMap,this.shadowMapCullFace=Je.CullFaceFront,this.adjustBounds(this._canvas.width,this._canvas.height,0,0);
var h=new Je.DefaultInteraction(this);h.panSpeed=3,h.zoomSpeed=10;var c=this;this.getRootView().addEventListener("mousedown",function(t){c.handleMouseDown(t)}),this.getRootView().addEventListener("mouseup",function(t){c.handleClick(t)});var u=[h,new Je.SelectionInteraction(this)];this.setInteractions(u),this.doubleClickToLookAtFunction=vi.doubleClickToLookAtFunction,p(this),this.initSurfaceGroup(),this.materialRenderListMap={},this._selectTransparencyThreshold=0,this._dynamicBatchDraw=!1,this._dynamicBatchDrawCountLimit=1024,this.needSmoothNormalFunction=vi.needSmoothNormalFunction,this._annotationMap={},this._activeAnnotation=null},Je.extend(Je.Network3D,Je.Data,{___accessor:["shadowMapEnable","editableFunction","keyboardRemoveEnabled","selectTransparencyThreshold","dynamicBatchDraw","showFps"],setUseFog:function(t){this._useFog=t,this._useFog?this._fog=this.__fog:this._fog=null},setOverloadMaterial:function(t){this._overloadMaterial=t},setFogColor:function(t){this.__fog.color=t},setFogDensity:function(t){this.__fog.density=t},setDataBox:function(t){if(!t)throw"DataBox can not be null";if(this.dataBox!==t){var e=this.dataBox;e&&(this._clearDataBox(e),e.removeDataBoxChangeListener(this.handleDataBoxChange,this),e.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),e.getAlarmBox().removeDataBoxChangeListener(this.dirtyNetwork,this),e.getSelectionModel().removeSelectionChangeListener(this.dirtyNetwork,this)),this.dataBox=t,this.dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this.dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this.dataBox.getAlarmBox().addDataBoxChangeListener(this.dirtyNetwork,this),this.dataBox.getSelectionModel().addSelectionChangeListener(this.dirtyNetwork,this),this.firePropertyChange("dataBox",e,this._box),this.glNodeList=[],this.dirtyNetwork(),this._clearNodeCache()}},setRenderCallback:function(t){this.renderCallback=t},setBeforeRenderFunction:function(t){this.beforeRenderFunction=t},getDataBox:function(){return this.dataBox},getClearColor:function(){return this._clearColor},setClearColor:function(t){3==arguments.length?(this._clearColor=new Je.Color,this._clearColor.setRGB(arguments[0],arguments[1],arguments[2])):(this._clearColor=t,this._clearColor instanceof Je.Color||(this._clearColor=new Je.Color(t))),this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.dirtyNetwork()},setClearAlpha:function(t){this._clearAlpha=t,this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.dirtyNetwork()},getClearAlpha:function(){return this._clearAlpha},getPrecision:function(){return this._precision},setPrecision:function(t){this._precesion=t},setSSAOBlur:function(t){this._ssaoBlur=t},setSSAOEnable:function(t){return!(t&&!this.isFloatTextureSupport())&&(this._sSAOEnable=t,this._dirty=!0,!0)},isSSAOEnable:function(){return this._sSAOEnable&&this._baseRender},setSSAOOccluderBias:function(t){this._occluderBias=t,this._dirty=!0},setSSAOSamplingRadius:function(t){this._samplingRadius=t,this._dirty=!0},setSSAOAttenuation:function(t){this._attenuation=t,this._dirty=!0},isFloatTextureSupport:function(){return null!=this._glExtensionTextureFloat},getCamera:function(){return this._camera},setCamera:function(t,e){if(this._camera!=t){var i=this._camera;if(i.removePropertyChangeListener(this.dirtyNetwork),this._camera=t,this._camera.addPropertyChangeListener(this.dirtyNetwork,this),this.autoUpdateCameraAspect){this._camera.setAspect(i.aspect);var r=this.getDefaultInteraction();r&&(r.object=this._camera)}e&&(this._camera.p(i.p()),this._camera.lookAt(i.getTarget())),this.dirtyNetwork()}},isVisible:function(t){if(t){if(t instanceof Je.Link||t instanceof Je.PathLink){if(!t.isVisible())return!1;if(!this.isVisible(t._fromNode))return!1;if(!this.isVisible(t._toNode))return!1}if(!t.isVisible())return!1;if(t._parent)return this.isVisible(t._parent);if(this.visibleFunction)return this.visibleFunction(t)}return!0},setCanvasPropety:function(){this._canvas&&(this._canvas.setAttribute("tabindex",this.id),this._canvas.style.outline="none",this._canvas.style.position="absolute")},initCanvas:function(t){return t===e?document.createElement("canvas"):("string"==typeof t&&(t=document.getElementById(t)),t)},initGL:function(){var t;try{t=this._canvas.getContext("webgl",{preserveDrawingBuffer:this._preserveDrawingBuffer,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:!0})||this._canvas.getContext("experimental-webgl",{preserveDrawingBuffer:this._preserveDrawingBuffer,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:!0})}catch(e){console.log(e)}return t||console.error("Can not init webgl context"),this._glExtensionTextureFloat=t.getExtension("OES_texture_float"),this._glExtensionStandardDerivatives=t.getExtension("OES_standard_derivatives"),this._glExtensionTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this._glExtensionCompressedTextureS3TC=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._glExtensionTextureFloat||console.log("TGL.Network3D: Float textures not supported."),this._glExtensionStandardDerivatives||console.log("TGL.Network3D: Standard derivatives not supported."),this._glExtensionTextureFilterAnisotropic||console.log("TGL.Network3D: Anisotropic texture filtering not supported."),this._glExtensionCompressedTextureS3TC||console.log("TGL.Network3D: S3TC compressed textures not supported."),t?t:void console.log("Error: Your browser does not support WebGL.")},resetRenderInfo:function(){this.info.render.calls=0,this.info.render.vertices=0,this.info.render.faces=0,this.info.render.points=0,this.info.currentMaterialId=-1},_clearDataBox:function(t){var e=null;e=t===this.helperBox?this.helperGLNodeList:this.glNodeList;for(var i=e.length-1;i>=0;i--){e[i];e.splice(i,1)}e=[],this.prepareData(),this.pm._lightNeedsUpdate=!0,this.pm.changeAllLightMaterialUpdateFlags(!0),this._clearNodeCache(),this.deleteCloneNode()},handleDataBoxChange:function(t){var e=t.kind,i=t.data,r=t.source,a=null;a=r===this.helperBox?this.helperGLNodeList:this.glNodeList,"add"===e?i instanceof Je.Light?(this.pm._lightNeedsUpdate=!0,this.pm.changeAllLightMaterialUpdateFlags(!0),this.prepareData()):i instanceof Je.Annotation?this._createAnnotationDiv(i):(this.addNodeMaterials(i),0===a.length?this.initWebGLNodes(r,a):this.addNode(i,a),i._alarmBillboard&&this.alarmBillboards.push(i._alarmBillboard)):"remove"===e?i instanceof Je.Light?(this.pm._lightNeedsUpdate=!0,this.pm.changeAllLightMaterialUpdateFlags(!0),this.prepareData()):i instanceof Je.Annotation?this._removeAnnotationDiv(i):(this.removeNode(i,a),this.deleteCloneNode(i)):"clear"===e&&this._clearDataBox(),this.boundingBox=null,this.dirtyNetwork()},removeNode:function(t,e){for(var i=e.length-1;i>=0;i--){var r=e[i];r.node===t&&e.splice(i,1)}this._clearNodeCache(t)},_clearNodeCache:function(t){if(t){if(t.oldGroups=t.groups||t.oldGroups,null!=t.oldGroups)for(var e in t.oldGroups){var i=t.oldGroups[e],r=this.groupCountMap[i.id];null!=r&&(r--,r<=0?(delete this.groupCountMap[i.id],delete this.groupMap[i.id]):this.groupCountMap[i.id]=r)}for(var a=0;a<this.alarmBillboards.length;a++){var n=this.alarmBillboards[a];n.getParent()===t&&(this.alarmBillboards.splice(a,1),a--)}t instanceof Je.Annotation&&this._removeAnnotationDiv(t)}else{for(var s in this.groupMap){var o=this.groupMap[s],l=o._nodeId;this.helperBox.containsById(l)||delete this.groupMap[s]}this.glInited=new Object,this.alarmBillboards.splice(0),this.glNodeList=[]}for(var s in this._annotationMap)this._removeAnnotationDiv(s)},addNode:function(t,e){for(var i=this.addWebGLNode(e,t),r=0;r<i.length;r++){var a=i[r];this.updateWebGLNode(a)}},addNodeMaterials:function(t){var e,i=t.material;if(i instanceof Je.Material)this.addMaterial(i);else if(i instanceof Je.ArrayMaterial){var r=i.materials,a=r.length;for(e=0;e<a;e++)this.addMaterial(r[e])}},addMaterial:function(t){this.pm.addMaterial(t),t.map&&this.pm.addTexture(t.map)},handleDataPropertyChange:function(t){var e=t.source;if(e instanceof Je.Node){var i=t.property;if(e.isSizeChangedProperty(i)||i===Je.Styles.MaterailType||i===Je.Styles.NormalType){if(e instanceof Je.Line){e.verticesNeedUpdate=!0;var r=this.lineMap[e._id];this.initLineBuffers(e),si.buildLineBufferData(e,this._gl.DYNAMIC_DRAW,this._gl,r)}else if(e.groups){e.verticesNeedUpdate=!0,i!==Je.Styles.MaterailType&&i!==Je.Styles.NormalType||(e.normalsNeedUpdate=!0);for(var a in e.groups){var n=e.groups[a],r=this.groupMap[n.id],s=si.getMaterial(e,n.materialIndex);e.normalsNeedUpdate&&this.initGroupBuffer(e,n,r,!0),si.buildGroupBufferData(n,e,this._gl.DYNAMIC_DRAW,!e.dynamic,s,this._gl,r,this)}}}else if("materialMapping"===i)this._currentGroupHash=null,this.glInited[e.getId()]=!1,this.removeNode(e,this.glNodeList),this.addNode(e,this.glNodeList);else if("alarmBillboard"===i){var o=t.oldValue,l=t.newValue;this._addNodeAlarmBillboard(e,o,l)}this.addNodeMaterials(e)}else e instanceof Je.Light&&(this.pm._lightNeedsUpdate=!0);(e.isSizeChangedProperty&&e.isSizeChangedProperty(i)||"parent"==i||e.isSpaceChangedProperty(i))&&(this.deleteCloneNode(e),this.boundingBox=null),this.dirtyNetwork()},deleteCloneNode:function(t){if(t){var e=t.getId?t.getId():t,i=this.normalNodeMap[e];if(null!=i){i.setParent(null);for(var r in i.groups){var a=i.groups[r];delete this.groupMap[a.id]}}delete this.normalNodeMap[e]}else for(var e in this.normalNodeMap)this.deleteCloneNode(e)},setBlurAmount:function(t){this._blurAmount=t},setBlurScale:function(t){this._blurScale=t},setBlurStrength:function(t){this._blurStrength=t},setBlurGlobalAlpha:function(t){this._blurGlobalAlpha=t},dirtyNetwork:function(t){this.dataBox.batch||(this._dirty=!0)},_addNodeAlarmBillboard:function(t,i,r){if(r===e&&(r=t._alarmBillboard),null!=i&&this.alarmBillboards.indexOf(i)!==-1){var a=this.alarmBillboards.indexOf(i);this.alarmBillboards.splice(a,1),i.removePropertyChangeListener(this.dirtyNetwork,this)}r&&this.alarmBillboards.indexOf(r)===-1&&(this.alarmBillboards.push(r),r.addPropertyChangeListener(this.dirtyNetwork,this))},initWebGLNodes:function(t,e){var i,r,a=t.getNodes();for(i=0,r=a.size();i<r;i++){var n=a.get(i);n.renderSelected=!1,this.addWebGLNode(e,n),this.glNodeMap[n.id]=n}for(i=0,r=e.length;i<r;i++)this.updateWebGLNode(e[i])},updateWebGLNode:function(t){var e,i,r=t.node;if(r instanceof Je.Entity){for(var a in r.groups)if(e=r.groups[a],i=si.getMaterial(r,e.materialIndex),r.buffersNeedUpdate){var n=this.groupMap[e.id];this.initGroupBuffer(r,e,n),si.buildGroupBufferData(e,r,this._gl.DYNAMIC_DRAW,!r.dynamic,i,this._gl,n,this)}r.setUpdateFlags(!1),r.buffersNeedUpdate=!1}else if(r instanceof Je.BufferNode)this.setBufferNodeData(r,this._gl.DYNAMIC_DRAW,!r.dynamic);else if(r instanceof Je.Line){var n=this.lineMap[r._id];si.buildLineBufferData(r,this._gl.DYNAMIC_DRAW,this._gl,n)}else if(r instanceof Je.Particle){var n=this.particleMap[r._id];li(r,this._gl.DYNAMIC_DRAW,this._gl,n)}},addWebGLNode:function(t,i){var r,a,n,s,o=[];if(this.glInited[i.getId()]||this._addNodeAlarmBillboard(i),!this.glInited[i.getId()])if(this.glInited[i.id]=!0,i._modelViewMatrix=new ti,i._normalMatrix=new $e,i instanceof Je.Entity){i.groups==e&&oi(i);for(r in i.groups){a=i.groups[r],a.id=a.id===e?Je.Network3D.GroupCache._groupCounter++:a.id;var l=this.groupCountMap[a.id]||0;l++,this.groupCountMap[a.id]=l,this.groupMap[a.id]===e&&(this.groupMap[a.id]={});var h=this.groupMap[a.id];h._nodeId=i.getId(),h.__webglVertexBuffer||(this.createGroupBuffer(a,h),this.initGroupBuffer(i,a,h),i.setUpdateFlags(!0))}}else if(i instanceof Je.Line){null==this.lineMap[i._id]&&(this.lineMap[i._id]={});var h=this.lineMap[i._id];h._nodeId=i.getId(),h.__webglVertexBuffer||(this.createLineBuffers(i),this.initLineBuffers(i),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0,i.lineDistancesNeedUpdate=!0)}else if(i instanceof Je.Particle){null==this.lineMap[i._id]&&(this.lineMap[i._id]={});var h=this.lineMap[i._id];h._nodeId=i.getId(),h.__webglVertexBuffer||(this.createParticleBuffers(i),this.initParticleBuffers(i),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0)}else i instanceof Je.BufferNode?this.initBufferNode(i):i instanceof Je.Annotation&&this._createAnnotationDiv(i);if(i instanceof Je.Entity){for(r in i.groups)a=i.groups[r],n=si.getMaterial(i,a.materialIndex),s={group:a,node:i,opaque:n.transparent?null:n,transparent:n.transparent?n:null},t.push(s),o.push(s);null===i.groups}else i instanceof Je.Line?(n=i.material,s={group:i,node:i,opaque:n.transparent?null:n,transparent:n.transparent?n:null},t.push(s),o.push(s)):i instanceof Je.Particle?(n=i.material,s={group:i,node:i,opaque:n.transparent?null:n,transparent:n.transparent?n:null},t.push(s),o.push(s)):i instanceof Je.BufferNode&&(n=i.material instanceof Je.ArrayMaterial?i.material.materials[0]:i.material,s={group:i,node:i,opaque:n.transparent?null:n,transparent:n.transparent?n:null},t.push(s),o.push(s));return i.glActive=!0,o},onElementDispose:function(t){var e=t.target;e.removeEventListener("dispose",this.onElementDispose),deallocateElement(e),this.info.memory.geometries--},deallocateElement:function(t){},_AK47:function(t,i,r,a,n,s){this._fog;t.parent===e&&t.updateWorldMatrix(!0,!1),t.worldMatrixInverse.getInverse(t.worldMatrix),this._projScreenMatrix.multiply(t.projectionMatrix,t.worldMatrixInverse),this._frustum.setFromMatrix(this._projScreenMatrix),0===r.length&&(this.initWebGLNodes(i,r),this.prepareData()),this.resetRenderInfo();var o,l,h,c;if(!s)for(o=0,l=r.length;o<l;o++)h=r[o],c=h.node,c.renderSelected=!1,h.render=!1,this.isVisible(c)&&(this.unrollBufferMaterial(h),this.setupMatrices(c,t),(c instanceof Je.Entity||c instanceof Je.Particle)&&c.frustumCulled&&!this._frustum.intersectsObject(c)||(h.render=!0,this.sortNodes&&(this._vector3.copy(c.worldMatrix.getPosition()),this._vector3.applyProjection(this._projScreenMatrix),null!=c.renderDepth?h.z=c.renderDepth+this._vector3.z:h.z=this._vector3.z)));var u=new ci;if(u.addAll(a),!n&&!s){for(var f=this.alarmBillboards.length-1;f>=0;f--){var d=this.alarmBillboards[f];null==d.getParent()&&this.alarmBillboards.splice(f,1)}u.addAll(this.alarmBillboards)}var p=this;!s&&u.forEach(function(t){t.renderDepth?t.z=t.renderDepth:(p._vector3.copy(t.worldMatrix.getPosition()),p._vector3.applyProjection(p._projScreenMatrix),t.z=p._vector3.z)}),u.size()>0&&!s&&null==this.billboardRenderer&&(this.billboardRenderer=new Je.BillboardRenderer);var m=[].concat(r).concat(u._as),g=this.sortNodesFunc(m);this.setBlending(Je.NoBlending),this.renderNodes(g,!1,"opaque",t,i.getLights(),!1,null,s,this.sortOpaqueOrderByMaterial),this.renderNodes(g,!0,"transparent",t,i.getLights(),!0,null,s),this.setDepthTest(!0),this.setDepthWrite(!0)},unrollBufferMaterial:function(t){var e,i,r,a=t.node,n=t.group;r=a.material,r instanceof Je.ArrayMaterial?(i=n.materialIndex||0,e=r.materials[i],e.transparent?(t.transparent=e,t.opaque=null):(t.opaque=e,t.transparent=null)):(e=r,e&&(e.transparent?(t.transparent=e,t.opaque=null):(t.opaque=e,t.transparent=null)))},renderLicense:function(){},isShadowable:function(){return this.isShadowMapEnable()&&(this.maxShadows>0||this.maxPointShadows>0)},render:function(){if(this._dirty&&(this._dirty=!1,null!=this.beforeRenderFunction&&this.beforeRenderFunction.call(this),!this.isShadowable()||(this.shadowMapRender(),this.setRenderTarget(e),!this.debugPointLight))){if(ji.twm(this),this.paintBottom(this._bottomCanvas),this.getShowFps()&&(this.__time=(new Date).getTime()),this.innerRender(this._camera,!0),this.renderAnnotations(this._camera),this.extendRender(this._camera),this.paintTopCanvas(),this.getShowFps()){this._tpf=(new Date).getTime()-this.__time;var t=this._topCanvas.getContext("2d"),i=(1e3/this._tpf).toFixed(0);i>500&&(i="> 500");var r="FPS:"+i+",TPF:"+this._tpf+" ms";t.font="20px Arial sans-serif",t.fontWeight="bold",t.lineWith=2,t.fillStyle="rgba(0, 0, 0, 1)",t.fillText(r,10,25)}if(this._xyz!=e){var a,n=this._xyz,s=n.markText,o=n.type,r=(n.expired,n.innerHTML),l=0,h=0,t=(this._topCanvas.getBoundingClientRect(),this._topCanvas.getContext("2d"));s!=e&&null!=s&&""!=s||"2"==o?(t.font="24px Arial sans-serif",a=ni.getTextSize(t.font,r),t.fillStyle="red",l=this._canvas.width-a.width-20,h=this._canvas.height-a.height-10):(t.font="15px Arial sans-serif",t.fillStyle="rgba(240, 120, 25, 0.6)",a=ni.getTextSize(t.font,r),l=this._canvas.width-a.width-20,h=this._canvas.height-a.height-10),t.fillText(r,l,h)}null!=this.renderCallback&&this.renderCallback.call(this)}},getTextSize:function(t,e){return ni.getTextSize(t,e)},shadowMapRender:function(){null==this.shadowMapRenderer&&(this.shadowMapRenderer=new tr,this.shadowMapRenderer.init(this)),0===this.glNodeList.length&&(this.initWebGLNodes(this.dataBox,this.glNodeList),this.prepareData()),this.shadowMapRenderer.render(this.dataBox,this._camera)},handleMouseDown:function(t){var e=t.target;this.lastX=t.clientX,this.lastY=t.clientY,"tgl_annotation"==e.getAttribute("class")&&"1"==e.style.opacity&&(t.stop=!0,t.stopPropagation())},handleClick:function(t){var e=t.clientX-this.lastX,i=t.clientY-this.lastY;if(Math.abs(e)<.1&&Math.abs(i)<.1){var r=t.target;if("tgl_annotation"!=r.getAttribute("clazz"))this._activeAnnotation&&(this._activeAnnotation=null,this.dirtyNetwork());else if("1"==r.style.opacity){var a=r.getAttribute("id"),n=this.getDataBox().getDataById(a),s=this._annotationMap[a];this.handleDefaultAnnotationClick(n,s),this.handleAnnotationClick(n,s),this.dirtyNetwork()}}},handleDefaultAnnotationClick:function(t,e){this._activeAnnotation!=t&&(this._activeAnnotation=t)},handleAnnotationClick:function(t,e){},renderAnnotations:function(t){var e=this.dataBox.getAnnotations(),i=this;if(e&&(e.forEach(function(e){i.renderAnnotation(t,e)}),this._createAnnotationStyle()),this._activeAnnotation){this._createAnnotationToolTipDiv();var r=this._annotationToolTipDiv;r.innerHTML=this._activeAnnotation.getText();var a=this._annotationMap[this._activeAnnotation.getId()];r.parentNode!=a&&a.appendChild(r),r.style.opacity=a.style.opacity}},getAnnotationDiv:function(t){return this._annotationMap[t.getId()]},renderAnnotation:function(t,e){var i=this._annotationMap[e.getId()];null==i&&(i=this._createAnnotationDiv(e)),i.innerHTML=e._label,e.updateWorldMatrix();var r=e.worldMatrix.getPosition(),a=e.getStyle("annotation.class");i.setAttribute("class",a);var n=this.getViewPosition(r);this._annotationToolTipDiv;i.style.left=n.x+"px",i.style.top=n.y+"px",i.style.opacity="1";var s=r.distanceTo(t.getPosition()),o=this.getElementByScreenPoint(n,!1);if(o&&o.length>0){var l=o[0];l.distance<s&&(i.style.opacity="0.03")}},_addCSSRule:function(t,e,i,r){r=r||(t.cssRules||t.rules).length,t.insertRule?t.insertRule(e+"{"+i+"}",r):t.addRule&&t.addRule(e,i,r)},_createAnnotationStyle:function(){if(!this._annotationStyle){var t=document.createElement("style");t.appendChild(document.createTextNode("")),document.head.appendChild(t);var e=t.sheet;this._addCSSRule(e,".tgl_annotation","cursor:pointer;font-family:微软雅黑;font-weight:bold;position:absolute;color:#fff;text-align:center;"),this._addCSSRule(e,".tgl_annotation:hover",""),this._annotationStyle=t}},_removeAnnotationDiv:function(t){var e=t.getId?t.getId():t,i=this._annotationMap[e];null!=i&&this.getRootView().removeChild(i)},_createAnnotationDiv:function(t){var e=document.createElement("div"),i=t.getStyle("annotation.class");return e.setAttribute("id",t.getId()),e.setAttribute("class",i),e.setAttribute("clazz","tgl_annotation"),this._annotationMap[t.getId()]=e,this.getRootView().appendChild(e),e},_createAnnotationToolTipDiv:function(){if(null==this._annotationToolTipDiv){var t=document.createElement("div");t.setAttribute("class","tgl_annotation_tooltip");var e=document.createElement("style");e.appendChild(document.createTextNode("")),document.head.appendChild(e);var i=e.sheet,r="font-family:微软雅黑;font-weight:normal;position: absolute;border: 3px solid #e96e3e; background-color: #e96e3e; padding: 3px;text-align: left;width: 220px;height: 'auto';border-radius: 10px;bottom:35px;left:-13px;";this._addCSSRule(i,".tgl_annotation_tooltip",r),r="content: ' ';position: absolute;top: 100%; border: 1px solid;",this._addCSSRule(i,".tgl_annotation_tooltip:after, .tgl_annotation_tooltip:before",r),r="border-color: #e96e3e transparent transparent transparent;border-width: 16px 17px 0 7px;left: 10px;",this._addCSSRule(i,".tgl_annotation_tooltip:before",r),r="border-color: #e96e3e transparent transparent transparent;border-width: 12px 11px 0 4px;left: 14px;",this._addCSSRule(i,".tgl_annotation_tooltip:after",r),this._annotationToolTipDiv=t}},extendRender:function(t){},innerRender:function(t,i){if(t===e&&(t=this._camera),null===t)return void console.log(" no camera");if(this.debug&&console.log("inner Render"),this.autoClear){var r=this._clearColor;this._gl.clearColor(r.r,r.g,r.b,this._clearAlpha),bi.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil,this)}if(i)for(var a=0;a<this._interactions.length;a++){var n=this._interactions[a];n.update&&n.update()}if(this.billboardRenderer&&this.billboardRenderer.disable(),this._gl.viewport(0,0,this._canvas.width,this._canvas.height),this._sSAOEnable){this.linearDepth=t.far-t.near,this.ssaoing=!0,this._renderDeferredTarget(t,this.deferredPostionMaterial,this.deferredPostionTarget),this._renderDeferredTarget(t,this.deferredNormalMaterial,this.deferredNormalTarget),this._setSSAOMaterial(),this._overloadMaterial=null,this._renderSurface(t,this.ssaoTarget,this.ssaoMaterial);var s=this._canvas.width/this._canvas.height;this._ssaoBlur?(this._renderBlurTarget(t,this._blurMaterialH,this.ssaoTarget,this.ssaoTarget1,s),this._renderBlurTarget(t,this._blurMaterialV,this.ssaoTarget1,this.ssaoTarget2,s),this.finalSSAOTarget=this.ssaoTarget2):this.finalSSAOTarget=this.ssaoTarget,this.setRenderTarget(e),this.ssaoing=!1}if(this.renderOutline=!1,this.renderOutlineGlow=!1,bi.enableStencil(this._gl),this._baseRender=!0,bi.r(this,t,this.dataBox,this.glNodeList,this.dataBox.getBillboards()),this._baseRender=!1,bi.stencilTest(this._gl),this.renderOutline&&bi.r(this,t,this.dataBox,this.glNodeList,this.dataBox.getBillboards(),!1,"stencil"),this.renderOutlineGlow){var o=this._glowSurface.target,l=this._glowSurface.target1,h=this._glowSurface.target2;bi.disableStencil(this._gl),this.setRenderTarget(o),o._id=o._id||(new Date).getTime()+"0",l._id=l._id||(new Date).getTime()+"1",h._id=h._id||(new Date).getTime()+"2",this._gl.viewport(0,0,o.width,o.height),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._gl.colorMask(!1,!1,!1,!1),bi.r(this,t,this.dataBox,this.glNodeList,this.dataBox.getBillboards(),!1,"glow.unselect"),this._gl.colorMask(!0,!0,!0,!0),bi.r(this,t,this.dataBox,this.glNodeList,this.dataBox.getBillboards(),!1,"glow.select");var c,u;this.setRenderTarget(l),this._gl.viewport(0,0,l.width,l.height),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialH.setMap(o);var s=this._canvas.width/this._canvas.height;this._blurMaterialH.texelSize=new Qe(o.width,o.height/s),this._blurMaterialH.blurAmount=this._blurAmount||5,this._blurMaterialH.blurScale=this._blurScale||1,this._blurMaterialH.blurStrength=this._blurStrength||1,this._blurMaterialH.orientation=1;for(c in this._glowSurface.groups)u=this._glowSurface.groups[c],this.renderGroup(t,[],this._blurMaterialH,u,this._glowSurface2);this.setRenderTarget(h),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialV.setMap(l),this._blurMaterialV.texelSize=new Qe(l.width,l.height/s),this._blurMaterialV.blurAmount=this._blurAmount||5,this._blurMaterialV.blurScale=this._blurScale||1,this._blurMaterialV.blurStrength=this._blurStrength||1,this._blurMaterialV.orientation=0;for(c in this._glowSurface.groups)u=this._glowSurface.groups[c],this.renderGroup(t,[],this._blurMaterialV,u,this._glowSurface2);this.setRenderTarget(e),this._glowSurface._modelViewMatrix=new ti,this._glowSurface._normalMatrix=new $e,this.setupMatrices(this._glowSurface,t),this._glowSurfaceMaterial.setMap(h),this._glowSurfaceMaterial.useBlur=0,this._glowSurfaceMaterial.blurGlobalAlpha=this._blurGlobalAlpha||1,bi.setBlending(this._glowSurfaceMaterial.blendMode,this._glowSurfaceMaterial.blendEquation,this._glowSurfaceMaterial.blendSrc,this._glowSurfaceMaterial.blendDst,this),this._gl.enable(this._gl.STENCIL_TEST);for(c in this._glowSurface.groups)u=this._glowSurface.groups[c],this.renderGroup(t,[],this._glowSurfaceMaterial,u,this._glowSurface);this.setRenderTarget(l),this._gl.viewport(0,0,l.width,l.height),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialH.setMap(o);var s=this._canvas.width/this._canvas.height;this._blurMaterialH.texelSize=new Qe(o.width,o.height/s),this._blurMaterialH.blurAmount=this._blurAmount||10,this._blurMaterialH.blurScale=this._blurScale||1,this._blurMaterialH.blurStrength=this._blurStrength||1,this._blurMaterialH.orientation=0;for(c in this._glowSurface.groups)u=this._glowSurface.groups[c],this.renderGroup(t,[],this._blurMaterialH,u,this._glowSurface2);this.setRenderTarget(h),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialV.setMap(l),this._blurMaterialV.texelSize=new Qe(l.width,l.height/s),this._blurMaterialV.blurAmount=this._blurAmount||10,this._blurMaterialV.blurScale=this._blurScale||1,this._blurMaterialV.blurStrength=this._blurStrength||1,this._blurMaterialV.orientation=1;for(c in this._glowSurface.groups)u=this._glowSurface.groups[c],this.renderGroup(t,[],this._blurMaterialV,u,this._glowSurface2);this.setRenderTarget(e),this._glowSurface._modelViewMatrix=new ti,this._glowSurface._normalMatrix=new $e,this.setupMatrices(this._glowSurface,t),this._glowSurfaceMaterial.setMap(h),this._glowSurfaceMaterial.useBlur=0,this._glowSurfaceMaterial.blurGlobalAlpha=this._blurGlobalAlpha||1,bi.setBlending(this._glowSurfaceMaterial.blendMode,this._glowSurfaceMaterial.blendEquation,this._glowSurfaceMaterial.blendSrc,this._glowSurfaceMaterial.blendDst,this),this._gl.enable(this._gl.STENCIL_TEST);for(c in this._glowSurface.groups)u=this._glowSurface.groups[c],this.renderGroup(t,[],this._glowSurfaceMaterial,u,this._glowSurface);this._gl.clearColor(0,0,0,0)}bi.disableStencil(this._gl),this.renderHelper(t)},_renderDeferredTarget:function(t,e,i,r){r=r||new Je.Vec4(0,0,0,0,0),e.linearDepth=this.linearDepth,this.setRenderTarget(i),this._overloadMaterial=e,this._gl.clearColor(r.x,r.y,r.z,r.w),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),bi.r(this,t,this.dataBox,this.glNodeList,this.dataBox.getBillboards())},_renderBlurTarget:function(t,e,i,r,a){clearColor=clearColor||new Je.Vec4(0,0,0,0,0),this.setRenderTarget(r),this._gl.viewport(0,0,r.width,r.height),this._gl.clearColor(clearColor.x,clearColor.y,clearColor.z,clearColor.w),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),e.setMap(i),e.texelSize=new Qe(i.width,i.height/a),e.blurAmount=this._blurAmount||5,e.blurScale=this._blurScale||1,e.blurStrength=this._blurStrength||1;var n,s;for(n in this._glowSurface.groups)s=this._glowSurface.groups[n],this.renderGroup(t,[],e,s,this._glowSurface2)},_setSSAOMaterial:function(){this.ssaoMaterial.map=this.deferredPostionTarget,this.ssaoMaterial.map1=this.deferredNormalTarget,this.ssaoMaterial.attenuation=this._attenuation||new Qe(1,.02),this.ssaoMaterial.occluderBias=this._occluderBias||.5,this.ssaoMaterial.samplingRadius=this._samplingRadius||20,this.ssaoMaterial.texelSize=new Qe(1/this.deferredPostionTarget.width,1/this.deferredPostionTarget.height)},_renderSurface:function(t,e,i,r){r=r||new Je.Vec4(1,1,1,1),this.setRenderTarget(e),this._gl.clearColor(r.x,r.y,r.z,r.w),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._glowSurface._modelViewMatrix=new ti,this._glowSurface._normalMatrix=new $e,this.setupMatrices(this._glowSurface,t);var a,n;for(n in this._glowSurface.groups)a=this._glowSurface.groups[n],this.renderGroup(t,[],i,a,this._glowSurface)},renderHelper:function(t){bi.r(this,t,this.helperBox,this.helperGLNodeList,this.helperBox.getBillboards(),"stencil")},initSurfaceGroup:function(){this._glowSurface.setUpdateFlags(!0),oi(this._glowSurface);for(var t in this._glowSurface.groups){var i=this._glowSurface.groups[t];i.id=i.id===e?Je.Network3D.GroupCache._groupCounter++:i.id,this.groupMap[i.id]===e&&(this.groupMap[i.id]={});var r=this.groupMap[i.id];this.createGroupBuffer(i,r),this.initGroupBuffer(this._glowSurface,i,r),si.buildGroupBufferData(i,this._glowSurface,this._gl.DYNAMIC_DRAW,!1,this._glowSurfaceMaterial,this._gl,r,this)}this._glowSurface2.setUpdateFlags(!0),oi(this._glowSurface2);for(var t in this._glowSurface2.groups){var i=this._glowSurface2.groups[t];i.id=i.id===e?Je.Network3D.GroupCache._groupCounter++:i.id,this.groupMap[i.id]===e&&(this.groupMap[i.id]={});var r=this.groupMap[i.id];this.createGroupBuffer(i,r),this.initGroupBuffer(this._glowSurface2,i,r),si.buildGroupBufferData(i,this._glowSurface2,this._gl.DYNAMIC_DRAW,!1,this._glowSurfaceMaterial,this._gl,r,this)}},getOutlineMaterial:function(t,e){var i=(e.getStyle("select.width")||1)+1+" "+new Je.Color(e.getStyle("select.color")).getUniqueCode()+t,r=this.outlineMaterialMap[i];return null==r&&(r=new Je.EntityMaterial,"outline.normal"==t?(r._type="outline",r.outline=e.getStyle("select.width")||1):"outline.glow"==t?r._type="basic":(r.wireframe=!0,r.wireframeLinewidth=(e.getStyle("select.width")||1)+1),r.color=new Je.Color(e.getStyle("select.color")),this.outlineMaterialMap[i]=r),r},renderNodes:function(t,e,i,r,a,n,s,o,l){var h,c,u,f,d,p,m;e?(d=t.length-1,p=-1,m=-1):(d=0,p=t.length,m=1);for(var g=d;g!==p;g+=m)if(h=t[g],f=h.node?h.transparent||h.opaque:h.material){this._overloadMaterial&&(f=this._overloadMaterial);var y=this.getOverLoadMaterial(h.node?h.node:h,f);if(y){var v=y.getUniqueCode(),x=Ki.getMaterial(v);x?f=x:(Ki.setMaterial(v,y),f=y)}if(!("opaque"==i&&1==f.transparent||"transparent"==i&&0==f.transparent)){if(n?(bi.setBlending(f.blendMode,f.blendEquation,f.blendSrc,f.blendDst,this),bi.setDepthWrite(!1,this)):bi.setDepthWrite(f.depthMask,this),h instanceof Je.Billboard){var w=h.material.transparent?"transparent":"opaque";i==w&&this.billboardRenderer.render(this,[h],r,2*this._canvas.width,2*this._canvas.height)}else if(h.render){if(this.billboardRenderer&&this.billboardRenderer.disable(),c=h.node,u=h.group,bi.setDepthTest(f.depthTest,this),bi.setPolygonOffset(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits,this),this.setGLFaces(f),c instanceof Je.Particle){if(c.verticesNeedUpdate||c.colorsNeedUpdate||c.sortParticles){var _=this.particleMap[c._id];li(c,this._gl.DYNAMIC_DRAW,this._gl,_)}c.verticesNeedUpdate=!1,c.colorsNeedUpdate=!1}var b=this.getSelectStyle(c);if("outline"==b&&(b="outline.normal"),o?"glow.unselect"===o&&(c.isSelected()||(c instanceof Je.BufferNode?this.renderBufferNode(r,a,f,u,c):bi.g(this,r,a,f,u,c))):(!c.isSelected()||"outline.normal"!==b&&"outline.wireframe"!==b&&"outline.glow"!==b?this.setStencilTest(!1):(this.setStencilTest(!0),"outline.glow"===b?this.renderOutlineGlow=!0:this.renderOutline=!0),c instanceof Je.BufferNode?this.renderBufferNode(r,a,f,u,c):bi.g(this,r,a,f,u,c)),c.isSelected()&&this.renderSelect(c))if("outline.normal"===b||"outline.wireframe"===b||"outline.glow"===b){if(null!=o&&"glow.unselect"!=o)if("outline.normal"===b){if(c.renderSelected===!1){var M=this.getOutlineMaterial(b,c),S=this.normalNodeMap[c.getId()];if(null==S){var S=this.cloneNode(c,M);this.normalNodeMap[c.getId()]=S}this.setupMatrices(S,r);for(var A in S.groups)bi.g(this,r,a,M,S.groups[A],S);c.renderSelected=!0}}else if("outline.normal"!==b){
var M=this.getOutlineMaterial(b,c);bi.g(this,r,a,M,u,c)}}else c.renderSelected===!1&&(this.renderNodeSelection(r,a,c),c.renderSelected=!0);c.getAlarmState().getPropagateSeverity()&&this.renderAlarmBorder(c)&&this.renderNodeAlarm(r,a,c)}c&&c.setUpdateFlags(!1)}}},cloneNode:function(t,e){var i,r,a=new Je.Entity,n={vertices:[],uvs:[],faces:[]};for(i=0,r=t.vertices.length;i<r;i++)n.vertices.push(t.vertices[i].clone());for(i=0,r=t.faces.length;i<r;i++)n.faces.push(t.faces[i].clone());for(i=0,r=t.uvs.lenght;i<r;i++){for(var s=uvs[i],o=[],l=0;l<s;l++)o.push(s[l].clone());n.uvs.push(o)}return Je.Node.prototype.mergeVertices.call(n),Je.Node.prototype.computeFaceNormals.call(n),Je.Node.prototype.computeVertexNormals.call(n,!0),a.setPosition(t.getPosition()),a.setScale(t.getScale()),a.setRotation(t.getRotation()),a.setParent(t.getParent()),a._modelViewMatrix=new ti,a._normalMatrix=new $e,a.data=n,a.vertices=n.vertices,a.uvs=n.uvs,a.faces=n.faces,a.material=e,a.primitive=new Je.Primitive(n),a.setUpdateFlags(!0),oi(a),this.buildNodeBufferData(a),a},buildNodeBufferData:function(t){for(var i in t.groups){var r=t.groups[i];r.id=r.id===e?Je.Network3D.GroupCache._groupCounter++:r.id,this.groupMap[r.id]===e&&(this.groupMap[r.id]={});var a=this.groupMap[r.id];this.createGroupBuffer(r,a),this.initGroupBuffer(t,r,a),si.buildGroupBufferData(r,t,this._gl.DYNAMIC_DRAW,!1,t.material,this._gl,a,this)}},needSmoothNormal:function(t,i){var r=i.normalType;return r!=e?r===Je.NormalTypeSmooth:!!this.needSmoothNormalFunction&&this.needSmoothNormalFunction(t)},renderNodeSelection:function(t,i,r){r.createSelectionCube(this.selectionCube),this.setupMatrices(this.selectionCube,t);var a=this.selectionCube.groups;this.selectionCube.material.needsUpdate=!0;for(var n in a){var s=a[n];s.id=s.id===e?Je.Network3D.GroupCache._groupCounter++:s.id,this.groupMap[s.id]===e&&(this.groupMap[s.id]={});var o=this.groupMap[s.id];o.__webglVertexBuffer||(this.createGroupBuffer(s,o),this.initGroupBuffer(r,s,o)),this.selectionCube.setUpdateFlags(!0),si.buildGroupBufferData(s,this.selectionCube,this._gl.DYNAMIC_DRAW,!1,this.selectionCube.material,this._gl,o,this),this.renderGroup(t,[],this.selectionCube.material,s,this.selectionCube)}},renderNodeAlarm:function(t,i,r){r.createPropagateAlarmCube(this.alarmCube),this.setupMatrices(this.alarmCube,t);var a=this.alarmCube.groups;this.alarmCube.material.needsUpdate=!0;for(var n in a){var s=a[n];s.id=s.id===e?Je.Network3D.GroupCache._groupCounter++:s.id,this.groupMap[s.id]===e&&(this.groupMap[s.id]={});var o=this.groupMap[s.id];o.__webglVertexBuffer||(this.createGroupBuffer(s,o),this.initGroupBuffer(r,s,o)),this.alarmCube.setUpdateFlags(!0),si.buildGroupBufferData(s,this.alarmCube,this._gl.DYNAMIC_DRAW,!1,this.alarmCube.material,this._gl,o,this),this.renderGroup(t,[],this.alarmCube.material,s,this.alarmCube)}},renderBufferNode:function(t,e,i,r,a,n){if(i.visible!==!1){var s,o;s=this.pm.setProgram(t,e,this._fog,i,r,a),o=s.attributes;var l=a,h=!1,c=i.wireframe?1:0,u=16777215*r._id+2*s.id+c;(u!==this._currentGroupHash||n)&&(this._currentGroupHash=u,h=!0),h&&this.disableAttributes();var f=this._gl,d=l.attributes.index,p=this.bufferNodeMap[a._id];if(d){var m=l.offsets;m.length>1&&(h=!0);for(var g=0,y=m.length;g<y;g++){var v=m[g].index;if(h){var x=l.attributes.position,w=x.itemSize;f.bindBuffer(f.ARRAY_BUFFER,p.position),this.enableAttribute(o.position),f.vertexAttribPointer(o.position,w,f.FLOAT,!1,0,v*w*4);var _=l.attributes.normal;if(o.normal>=0&&_){var b=_.itemSize;f.bindBuffer(f.ARRAY_BUFFER,p.normal),this.enableAttribute(o.normal),f.vertexAttribPointer(o.normal,b,f.FLOAT,!1,0,v*b*4)}var M=l.attributes.uv;if(o.uv>=0&&M){var S=M.itemSize;f.bindBuffer(f.ARRAY_BUFFER,p.uv),this.enableAttribute(o.uv),f.vertexAttribPointer(o.uv,S,f.FLOAT,!1,0,v*S*4)}var A=l.attributes.color;if(o.color>=0&&A){var P=A.itemSize;f.bindBuffer(f.ARRAY_BUFFER,p.color),this.enableAttribute(o.color),f.vertexAttribPointer(o.color,P,f.FLOAT,!1,0,v*P*4)}f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,p.index)}f.drawElements(f.TRIANGLES,m[g].count,f.UNSIGNED_SHORT,2*m[g].start),this.info.render.calls++,this.info.render.vertices+=m[g].count,this.info.render.faces+=m[g].count/3}}else{if(h){var x=l.attributes.position,w=x.itemSize;f.bindBuffer(f.ARRAY_BUFFER,x.buffer),this.enableAttribute(o.position),f.vertexAttribPointer(o.position,w,f.FLOAT,!1,0,0);var _=l.attributes.normal;if(o.normal>=0&&_){var b=_.itemSize;f.bindBuffer(f.ARRAY_BUFFER,_.buffer),this.enableAttribute(o.normal),f.vertexAttribPointer(o.normal,b,f.FLOAT,!1,0,0)}var M=l.attributes.uv;if(o.uv>=0&&M){var S=M.itemSize;f.bindBuffer(f.ARRAY_BUFFER,M.buffer),this.enableAttribute(o.uv),f.vertexAttribPointer(o.uv,S,f.FLOAT,!1,0,0)}var A=l.attributes.color;if(o.color>=0&&A){var P=A.itemSize;f.bindBuffer(f.ARRAY_BUFFER,A.buffer),this.enableAttribute(o.color),f.vertexAttribPointer(o.color,P,f.FLOAT,!1,0,0)}}var x=l.attributes.position;f.drawArrays(f.TRIANGLES,0,x.numItems/3),this.info.render.calls++,this.info.render.vertices+=x.numItems/3,this.info.render.faces+=x.numItems/3/3}}},getOverLoadMaterial:function(t,e){return null},renderGroup:function(t,e,i,r,a){if(null==i&&console.log("material is null"),i.visible!==!1){var n,s=this._gl;if(a instanceof Je.Entity?n=this.groupMap[r.id]:a instanceof Je.Line?n=this.lineMap[r._id]:a instanceof Je.Particle&&(n=this.particleMap[r._id]),null==n)return void(this.debug&&console.error("tempGroup for id:"+(r.id||r._id)+" is null,please check"));var o,l,h,c,u,f;o=this.pm.setProgram(t,e,this._fog,i,r,a),l=o.attributes;var d,p=!1,m=i.wireframe?1:0;if(d=null!=r.id?16777215*r.id+2*o.id+m:r._id+""+(2*o.id+m),d!==this._currentGroupHash&&(this._currentGroupHash=d,p=!0),p&&this.disableAttributes(),l.position>=0&&p&&(s.bindBuffer(s.ARRAY_BUFFER,n.__webglVertexBuffer),this.enableAttribute(l.position),s.vertexAttribPointer(l.position,3,s.FLOAT,!1,0,0)),p){if(r.__webglCustomAttributesList)for(u=0,f=r.__webglCustomAttributesList.length;u<f;u++)c=r.__webglCustomAttributesList[u],l[c.buffer.belongsToAttribute]>=0&&(s.bindBuffer(s.ARRAY_BUFFER,c.buffer),this.enableAttribute(l[c.buffer.belongsToAttribute]),s.vertexAttribPointer(l[c.buffer.belongsToAttribute],c.size,s.FLOAT,!1,0,0));l.color>=0&&(s.bindBuffer(s.ARRAY_BUFFER,n.__webglColorBuffer),this.enableAttribute(l.color),s.vertexAttribPointer(l.color,3,s.FLOAT,!1,0,0)),l.normal>=0&&(s.bindBuffer(s.ARRAY_BUFFER,n.__webglNormalBuffer),this.enableAttribute(l.normal),s.vertexAttribPointer(l.normal,3,s.FLOAT,!1,0,0)),l.uv>=0&&(s.bindBuffer(s.ARRAY_BUFFER,n.__webglUVBuffer),this.enableAttribute(l.uv),s.vertexAttribPointer(l.uv,2,s.FLOAT,!1,0,0)),l.uv2>=0&&(s.bindBuffer(s.ARRAY_BUFFER,n.__webglUV2Buffer),this.enableAttribute(l.uv2),s.vertexAttribPointer(l.uv2,2,s.FLOAT,!1,0,0)),l.lineDistance>=0&&(s.bindBuffer(s.ARRAY_BUFFER,n.__webglLineDistanceBuffer),this.enableAttribute(l.lineDistance),s.vertexAttribPointer(l.lineDistance,1,s.FLOAT,!1,0,0))}a instanceof Je.Entity?(i.wireframe?(this.setLineWidth(i.wireframeLinewidth),this._gl.lineJoin="round",p&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n.__webglLineBuffer),s.drawElements(s.LINES,n.__webglLineCount,s.UNSIGNED_SHORT,0)):(p&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n.__webglFaceBuffer),s.drawElements(s.TRIANGLES,n.__webglFaceCount,s.UNSIGNED_SHORT,0)),this.info.render.calls++,this.info.render.vertices+=r.__webglFaceCount,this.info.render.faces+=r.__webglFaceCount/3):a instanceof Je.Line?(h=a.type===Je.LineStrip?s.LINE_STRIP:s.LINES,this.setLineWidth(i.linewidth),s.drawArrays(h,0,n.__webglLineCount),this.info.render.calls++):a instanceof Je.Particle?(s.drawArrays(s.POINTS,0,n.__webglParticleCount),this.info.render.calls++,this.info.render.points+=n.__webglParticleCount):a instanceof Je.Ribbon&&(s.drawArrays(s.TRIANGLE_STRIP,0,r.__webglVertexCount),this.info.render.calls++)}},prepareData:function(){this.maxLightCount=this.dataBox.allocateLights(this._maxLights),this.maxShadows=this.dataBox.allocateShadows(),this.maxPointShadows=this.dataBox.allocatePointShadows()},wrapBillboardMaterial:function(t){t instanceof Je.Billboard&&t.material&&(t.opaque=t.material.transparent?null:t.material,t.transparent=t.material.transparent?t.material:null)},sortNodesFunc:function(t){if(this.sortNodes&&(null!==this.paintSortFunction||this.sortOpaqueOrderByMaterial)){var e=this;this.sortOpaqueOrderByMaterial?null==this.__st&&(this.__st=function(t,i){e.wrapBillboardMaterial(t),e.wrapBillboardMaterial(t);var r="opaque";if(t[r]&&i[r])return t[r].id-i[r].id;if(!t[r]&&i[r])return-1;if(t[r]&&!i[r])return 1;var a=t.node?t.node:t,n=i.node?i.node:i;return a.z=t.z,n.z=i.z,e.paintSortFunction?e.paintSortFunction(a,n):void 0}):null==this.__st&&(this.__st=function(t,i){var r=t.node?t.node:t,a=i.node?i.node:i;if(r.z=t.z,a.z=i.z,e.paintSortFunction)return e.paintSortFunction(r,a)}),t.sort(this.__st)}return t},renderNode:function(t,e){this.setupMatrices(t),t instanceof Je.Entity&&renderEntity(t)},paintTopCanvas:function(){var t=this._topCanvas.getContext("2d");t.clearRect(0,0,this._topCanvas.width,this._topCanvas.height);var e=this.areaPickingRect;e&&(t.beginPath(),t.lineStyle="#FFffff",t.rect(e.x,e.y,e.w,e.h),t.stroke()),this.renderLicense()},setBackgroundImage:function(t){if("string"==typeof t){var e=new Image;t.startsWith("data:image")||(e.crossOrigin="use-credentials"),e.src=t,this._backgroundImage=e;var i=this;e.onload=function(){i.dirtyNetwork()}}else this._backgroundImage=t,this.dirtyNetwork()},paintBottom:function(t){var e=t.getContext("2d");e.clearRect(0,0,t.width,t.height);var i=this._backgroundImage;i instanceof Image&&i.height&&e.drawImage(i,0,0,t.width,t.height)},initBufferNode:function(t){if(!this.bufferNodeMap[t._id]){var e={};this.bufferNodeMap[t._id]=e;var i,r,a,n=this._gl;for(i in t.attributes)a="index"===i?n.ELEMENT_ARRAY_BUFFER:n.ARRAY_BUFFER,r=t.attributes[i],e[i]=n.createBuffer(),n.bindBuffer(a,e[i]),n.bufferData(a,r.array,n.STATIC_DRAW)}},setBufferNodeData:function(t,i,r){var a=this.bufferNodeMap[t._id],n=t.attributes,s=n.index,o=n.position,l=n.normal,h=n.uv,c=n.color,u=n.tangent,f=this._gl;if(t.elementsNeedUpdate&&s!==e&&(f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,a.index),f.bufferData(f.ELEMENT_ARRAY_BUFFER,s.array,i)),t.verticesNeedUpdate&&o!==e&&(f.bindBuffer(f.ARRAY_BUFFER,a.position),f.bufferData(f.ARRAY_BUFFER,o.array,i)),t.normalsNeedUpdate&&l!==e&&(f.bindBuffer(f.ARRAY_BUFFER,a.normal),f.bufferData(f.ARRAY_BUFFER,l.array,i)),t.uvsNeedUpdate&&h!==e&&(f.bindBuffer(f.ARRAY_BUFFER,a.uv),f.bufferData(f.ARRAY_BUFFER,h.array,i)),t.colorsNeedUpdate&&c!==e&&(f.bindBuffer(f.ARRAY_BUFFER,a.color),f.bufferData(f.ARRAY_BUFFER,c.array,i)),t.tangentsNeedUpdate&&u!==e&&(f.bindBuffer(f.ARRAY_BUFFER,a.tangent),f.bufferData(f.ARRAY_BUFFER,u.array,i)),r)for(var d in t.attributes);},initGroupBuffer:function(t,i,r,a){var n=i.faces3,s=i.faces4,o=3*n.length+4*s.length,l=1*n.length+2*s.length,h=3*n.length+4*s.length,c=si.getMaterial(t,i.materialIndex?i.materialIndex:0),u=c.needUV(),f=c.getNormalType(),d=c.isVertexColor();if(r.__vertexArray=new Float32Array(3*o),f&&(r.__normalArray=new Float32Array(3*o)),!a){d&&(r.__colorArray=new Float32Array(3*o)),u&&(r.__uvArray=new Float32Array(2*o),t.uv2s&&(r.__uv2Array=new Float32Array(2*o))),r.__faceArray=new Uint16Array(3*l),r.__lineArray=new Uint16Array(2*h);var p,m;if(i.numMorphTargets)for(r.__morphTargetsArrays=[],p=0,m=i.numMorphTargets;p<m;p++)r.__morphTargetsArrays.push(new Float32Array(3*o));if(i.numMorphNormals)for(r.__morphNormalsArrays=[],p=0,m=i.numMorphNormals;p<m;p++)r.__morphNormalsArrays.push(new Float32Array(3*o));if(r.__webglFaceCount=3*l,r.__webglLineCount=2*h,c.attributes){r.__webglCustomAttributesList===e&&(r.__webglCustomAttributesList=[]);for(var g in c.attributes){var y=c.attributes[g],v={};for(var x in y)v[x]=y[x];if(!v.__webglInitialized||v.createUniqueBuffers){v.__webglInitialized=!0;var w=1;"v2"===v.type?w=2:"v3"===v.type?w=3:"v4"===v.type?w=4:"c"===v.type&&(w=3),v.size=w,v.array=new Float32Array(o*w),v.buffer=_gl.createBuffer(),v.buffer.belongsToAttribute=g,y.needsUpdate=!0,v.__original=y}r.__webglCustomAttributesList.push(v)}}r.__inittedArrays=!0}},createLineBuffers:function(t){null==this.lineMap[t._id]&&(this.lineMap[t._id]={});var e=this.lineMap[t._id],i=this._gl;e.__webglVertexBuffer=i.createBuffer(),e.__webglColorBuffer=i.createBuffer(),e.__webglLineDistanceBuffer=i.createBuffer(),this.info.memory.geometries++},initLineBuffers:function(t){null==this.lineMap[t._id]&&(this.lineMap[t._id]={});var e=this.lineMap[t._id],i=t.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__lineDistanceArray=new Float32Array(1*i),e.__webglLineCount=i},createParticleBuffers:function(t){null==this.particleMap[t._id]&&(this.particleMap[t._id]={});var e=this.particleMap[t._id],i=this._gl;e.__webglVertexBuffer=i.createBuffer(),e.__webglColorBuffer=i.createBuffer(),e.__webglNormalBuffer=i.createBuffer(),this.info.memory.geometries++},initParticleBuffers:function(t){null==this.particleMap[t._id]&&(this.particleMap[t._id]={});var e=this.particleMap[t._id],i=t.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__normalArray=new Float32Array(3*i),e.__sortArray=[],e.__webglParticleCount=i},createGroupBuffer:function(t,e){var i=this._gl;e.__webglVertexBuffer=i.createBuffer(),e.__webglNormalBuffer=i.createBuffer(),e.__webglTangentBuffer=i.createBuffer(),e.__webglColorBuffer=i.createBuffer(),e.__webglUVBuffer=i.createBuffer(),e.__webglUV2Buffer=i.createBuffer(),e.__webglSkinIndicesBuffer=i.createBuffer(),e.__webglSkinWeightsBuffer=i.createBuffer(),e.__webglFaceBuffer=i.createBuffer(),e.__webglLineBuffer=i.createBuffer(),this.info.memory.geometries++},setRenderTarget:function(t){var i=t instanceof Si,r=this._gl;if(t&&!t.__webglFramebuffer){t.depthBuffer===e&&(t.depthBuffer=!0),t.stencilBuffer===e&&(t.stencilBuffer=!0),t.__webglTexture=r.createTexture(),this.info.memory.textures++;var a=xi.isPowerOfTwo,n=a(t.width)&&a(t.height),s=xi.paramToGL(t.format,r),o=xi.paramToGL(t.type,r);t.type==Je.FloatType;var l=s;if(i){t.__webglFramebuffer=[],t.__webglRenderbuffer=[],r.bindTexture(r.TEXTURE_CUBE_MAP,t.__webglTexture),this.pm.setTextureParameters(r.TEXTURE_CUBE_MAP,t,n);for(var h=0;h<6;h++)t.__webglFramebuffer[h]=r.createFramebuffer(),t.__webglRenderbuffer[h]=r.createRenderbuffer(),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,l,t.width,t.height,0,s,o,null),this.setupFrameBuffer(t.__webglFramebuffer[h],t,r.TEXTURE_CUBE_MAP_POSITIVE_X+h),this.setupRenderBuffer(t.__webglRenderbuffer[h],t);n&&r.generateMipmap(r.TEXTURE_CUBE_MAP)}else t.__webglFramebuffer=r.createFramebuffer(),t.shareDepthFrom?t.__webglRenderbuffer=t.shareDepthFrom.__webglRenderbuffer:t.__webglRenderbuffer=r.createRenderbuffer(),r.bindTexture(r.TEXTURE_2D,t.__webglTexture),this.pm.setTextureParameters(r.TEXTURE_2D,t,n),r.texImage2D(r.TEXTURE_2D,0,l,t.width,t.height,0,s,o,null),this.setupFrameBuffer(t.__webglFramebuffer,t,r.TEXTURE_2D),t.shareDepthFrom?t.depthBuffer&&!t.stencilBuffer?r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,t.__webglRenderbuffer):t.depthBuffer&&t.stencilBuffer&&r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,t.__webglRenderbuffer):this.setupRenderBuffer(t.__webglRenderbuffer,t),n&&r.generateMipmap(r.TEXTURE_2D);i?r.bindTexture(r.TEXTURE_CUBE_MAP,null):r.bindTexture(r.TEXTURE_2D,null),r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null)}var c,u,f,d,p;t?(c=i?t.__webglFramebuffer[t.activeCubeFace]:t.__webglFramebuffer,u=t.width,f=t.height,d=0,p=0):(c=null,u=this._viewportWidth,f=this._viewportHeight,d=this._viewportX,p=this._viewportY),c!==this._currentFramebuffer&&(r.bindFramebuffer(r.FRAMEBUFFER,c),r.viewport(d,p,u,f),this._currentFramebuffer=c),this._currentWidth=u,this._currentHeight=f},setupFrameBuffer:function(t,e,i){var r=this._gl;r.bindFramebuffer(r.FRAMEBUFFER,t),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,i,e.__webglTexture,0)},setupRenderBuffer:function(t,e){var i=this._gl;i.bindRenderbuffer(i.RENDERBUFFER,t),e.depthBuffer&&!e.stencilBuffer?(i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,t)):e.depthBuffer&&e.stencilBuffer?(i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,t)):i.renderbufferStorage(i.RENDERBUFFER,i.RGBA4,e.width,e.height)},setLineWidth:function(t){t!==this._oldLineWidth&&(this._gl.lineWidth&&this._gl.lineWidth(t),this._oldLineWidth=t)},setupMatrices:function(t,e){t.fixSize(e),t.updateWorldMatrix(),t._modelViewMatrix.multiplyMatrices(e.worldMatrixInverse,t.worldMatrix),t._normalMatrix.getNormalMatrix(t._modelViewMatrix)},setDefaultGLState:function(){var t=this._gl,e=new Je.Color(this._clearColor);t.clearColor(e.r,e.g,e.b,this._clearAlpha),t.clearDepth(1),ii.isIE||t.clearStencil(0),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.frontFace(t.CCW),t.cullFace(t.BACK),t.enable(t.CULL_FACE),t.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA)},clear:function(t,i,r){var a=this._gl,n=0;(t===e||t)&&(n|=a.COLOR_BUFFER_BIT),(i===e||i)&&(n|=a.DEPTH_BUFFER_BIT),(r===e||r)&&(n|=a.STENCIL_BUFFER_BIT),a.clear(n)},setGLFaces:function(t){var e=this._gl,i=t.side===Je.DoubleSide,r=t.side===Je.BackSide;this._oldDoubleSided!==i&&(i?e.disable(e.CULL_FACE):e.enable(e.CULL_FACE),this._oldDoubleSided=i),this._oldFlipSided!==r&&(r?e.frontFace(e.CW):e.frontFace(e.CCW),this._oldFlipSided=r)},getView:function(){return this._canvas},getRootView:function(){return this._rootView},setBlending:function(t,e,i,r){bi.setBlending(t,e,i,r,this)},setDepthTest:function(t){bi.setDepthTest(t,this)},setStencilTest:function(t){this._oldStencilTest!=t&&(t?this._gl.enable(this._gl.STENCIL_TEST):this._gl.disable(this._gl.STENCIL_TEST),this._oldStencilTest=t)},setDepthWrite:function(t){bi.setDepthWrite(t,this)},getLineWidthRange:function(){var t=this._gl;return t.getParameter(t.ALIASED_LINE_WIDTH_RANGE)},setTexture:function(t,e){this.pm.setTexture(t,e)},disableAttributes:function(){for(var t in this._enabledAttributes)this._enabledAttributes[t]&&(this._gl.disableVertexAttribArray(t),this._enabledAttributes[t]=!1)},enableAttribute:function(t){this._enabledAttributes[t]||(this._gl.enableVertexAttribArray(t),this._enabledAttributes[t]=!0)},adjustRootViewBounds:function(t,e){var i=this._rootView;i.style.width=t+"px",i.style.height=e+"px"},adjustCanvasBounds:function(t,e,i,r,a){t.width=e*this.devicePixelRatio,t.height=i*this.devicePixelRatio,t.style.margin="0px",t.style.padding="0px",t.style.width=e+"px",t.style.height=i+"px"},adjustBounds:function(t,e,i,r){var a=this.getView();if(this.adjustRootViewBounds(t,e,i,r),this.adjustCanvasBounds(a,t,e,i,r),this.adjustCanvasBounds(this._topCanvas,t,e,i,r),this.adjustCanvasBounds(this._bottomCanvas,t,e,i,r),this.adjustCallback(t,e,i,r),this.setViewport(0,0,a.width,a.height),this.autoUpdateCameraAspect&&0!==e){var n=this._camera;n.aspect=t/e,n.updateProjectionMatrix(),this._currentCamera=null}this.dirtyNetwork()},adjustCallback:function(){},setViewport:function(t,i,r,a){this._viewportX=t!==e?t:0,this._viewportY=i!==e?i:0,this._viewportWidth=r!==e?r:_canvas.width,this._viewportHeight=a!==e?a:_canvas.height,this._gl.viewport(this._viewportX,this._viewportY,this._viewportWidth,this._viewportHeight)},setShowAxis:function(t){this.showAxis!==t&&(this.showAxis=t,this.showAxis&&(this.helperBox.contains(this.axis)||this.helperBox.addByDescendant(this.axis)),this.axis._visible=t,this.dirtyNetwork())},setShowAxisText:function(t){this.axis.showAxisText(t),this.dirtyNetwork()},setAxisSize:function(t){this.axis.setSize(t)},onSelect:function(t){null!=this.onSelectFunction&&this.onSelectFunction(t)},setOnSelectFunction:function(t){this.onSelectFunction=t},isSelectable:function(t){return!!t.isSelectable()&&(!this.selectableFunction||this.selectableFunction(t))},setSelectableFunction:function(t){this.selectableFunction=t},setRenderSelectFunction:function(t){this.renderSelectFunction=t},renderSelect:function(t){return!this.renderSelectFunction||this.renderSelectFunction(t)},renderAlarmBorder:function(t){return!this.renderAlarmBorderFunction||this.renderAlarmBorderFunction(t)},selectable:function(t){return t.element.isVisible()&&this.isSelectable(t.element)&&this.getDataBox().getSelectionModel().isSelectable(t.element)},editable:function(t){var e=this.selectable(t);return e&&null!=this.editableFunction?this.editableFunction(t.element):e},getFirstSelectElement:function(t){if(null==t)return null;for(var e,i=0;i<t.length;){var r=t[i];if(this.selectable(r)){e=r.element;break}i++}return e},getFirstEditElement:function(t){if(null==t)return null;for(var e,i=0;i<t.length;){var r=t[i];if(this.editable(r)){e=r.element;break}i++}return e},toImageData:function(t,e,i,r){return this.dirtyNetwork(),this.render(),t=t||"PNG",t.toUpperCase(),"PNG"===t?ri.saveAsPNG(this.getView(),e,!1,i,r):"JPEG"===t?ri.saveAsJPEG(this.getView(),e,!1,i,r):"BMP"===t?ri.saveAsBMP(this.getView(),e,!1,i,r):void console.log("Not surport type "+t)},getPickingByEvent:function(t){var e=this._camera,i={},r=this.getView(),a=r.getBoundingClientRect(),n=t.clientX,s=t.clientY;t.touches&&t.touches.length&&(n=t.touches[0].pageX,s=t.touches[0].pageY);var o=(n-a.left)/a.width,l=(s-a.top)/a.height;i.x=2*o-1,i.y=2*-l+1;var h=new Je.Vec3(i.x,i.y,.5);this.projector.unprojectVector(h,e);var c=null;if(e instanceof Je.PerspectiveCamera)c=new Je.Picking(e._position,h.sub(e._position).normalize(),e.up,null,null,this);else{var u=h.clone().sub(e._position),f=e.getTarget().clone().sub(e.p()).normalize(),d=f.multiplyScalar(u.clone().dot(f)),p=u.sub(d),m=(new Ke).addVectors(e._position,p);c=new Je.Picking(m,h.sub(m).normalize(),e.up,null,null,this)}return c},getElementsByMouseEvent:function(t,e,i){var r=this.getPickingByEvent(t),a=new ci;a.addAll(this.dataBox.getNodes()),a.addAll(this.dataBox.getBillboards()),i&&a.addAll(new ci(this.alarmBillboards));var n=r.intersectObjects(a.toArray(),!1,e);return n},getElementByScreenPoint:function(t,e,i){var r={},a=this.getView(),n=this._camera,s=a.getBoundingClientRect();t.x&&(i=e,e=t.y,t=t.x),t/=s.width,e/=s.height,r.x=2*t-1,r.y=2*-e+1;var o=new Je.Vec3(r.x,r.y,.5);this.projector.unprojectVector(o,n);var l=new Je.Picking(n._position,o.sub(n._position).normalize(),n.up,null,null,this),h=new ci;h.addAll(this.dataBox.getNodes()),h.addAll(this.dataBox.getBillboards());var c=l.intersectObjects(h.toArray(),!1,i);return c},getFirstElementByMouseEvent:function(t,e,i,r){var a=this.getElementsByMouseEvent(t,e,r);if(a.length)for(var n=0;n<a.length;n++){var s=a[n],o=s.element;if(null==i||i.call(null,o))return s}return null},getUnProjectVector:function(t){var e={},i=this.getView().getBoundingClientRect(),r=t.x/i.width,a=t.y/i.height;e.x=2*r-1,e.y=2*-a+1;var n=new Je.Vec3(e.x,e.y,.5);return this.projector.unprojectVector(n,this._camera),n},getFrustumByBounding:function(t){var e=t,i=this.getUnProjectVector(new Qe(e.x,e.y)),r=this.getUnProjectVector(new Qe(e.x+e.w,e.y)),a=this.getUnProjectVector(new Qe(e.x,e.y+e.h)),n=this.getUnProjectVector(new Qe(e.x+e.w,e.y+e.h)),s=this.getNearFarPoints(i),o=this.getNearFarPoints(r),l=this.getNearFarPoints(a),h=this.getNearFarPoints(n),c=new Je.math.Plane,u=new Je.math.Plane,f=new Je.math.Plane,d=new Je.math.Plane,p=new Je.math.Plane,m=new Je.math.Plane;c.setFromCoplanarPoints(s[0],o[0],l[0]),u.setFromCoplanarPoints(s[0],s[1],o[0]),f.setFromCoplanarPoints(s[0],l[0],s[1]),d.setFromCoplanarPoints(o[0],o[1],h[0]),p.setFromCoplanarPoints(l[0],h[0],l[1]),m.setFromCoplanarPoints(s[1],l[1],o[1]);var g=new Je.Frustum(c,u,f,d,p,m);return g.setPoints([s[0],o[0],l[0],h[0],s[1],o[1],l[1],h[1]]),g},getNearFarPoints:function(t){var e=this._camera,i=t.sub(e._position).normalize(),r=e.target.clone().sub(e._position),a=i.angleTo(r),n=e.getNear()/Math.acos(a),s=e.getFar()/Math.acos(a),o=e._position.clone().add(i.clone().multiplyScalar(n)),l=e._position.clone().add(i.clone().multiplyScalar(s));return[o,l]},getSpacePointOnPlane:function(t,e){var i={},r=this.getView(),a=this._camera,n=r.getBoundingClientRect(),s=t.clientX,o=t.clientY;t.touches&&t.touches.length&&(s=t.touches[0].pageX,o=t.touches[0].pageY);var l=(s-n.left)/n.width,h=(o-n.top)/n.height;i.x=2*l-1,i.y=2*-h+1;var c=new Je.Vec3(i.x,i.y,.5);this.projector.unprojectVector(c,a);var u=a._position,f=c.sub(a._position).normalize(),d=new Je.Ray(u,f),p=d.distanceToPlane(e);if(p<0||Math.abs(p)<Je.Picking.prototype.precision)return null;var m=d.at(p);return m},getElementsByBounding:function(t,e,i){var r=new ci;r.addAll(this.dataBox.getNodes()),r.addAll(this.dataBox.getBillboards());var a,n=this.getFrustumByBounding(t),s=[],o=new Ke,l=this._camera;return r.forEach(function(t){if(t instanceof Je.Billboard){o.setFromMatrixPosition(t.worldMatrix);var e=t.material,r=e.alignment;a=new Je.Plane(1,1),(r.x||r.y)&&(a.setPosition(r.x,r.y,0),a=Je.Utils.transformElement(a,!0)),a.setPosition(o);var h=(new Ke).getScaleFromMatrix(t.worldMatrix);a.setScale(h.x,h.y,1);var c=l.getTarget().clone(),u=l.getPosition();c.sub(u);var f=a.getPosition().clone();e&&e.vertical&&(c.y=0),f.sub(c),a.lookAt(f),a.updateWorldMatrix(!0),n.intersectsObjectAccurate(a,i)&&s.push({element:t})}else t instanceof Je.Line?n.intersectsObjectAccurate(t,i)&&s.push({element:t}):n.intersectsObjectAccurate(t,i)&&s.push({element:t})}),s},getViewPosition:function(t){var e=new Ke;e=this.projector.projectVector(t,this._camera,e),e.x=e.x/2+.5,e.y=-e.y/2+.5;var i={x:this._canvas.width*e.x/this.devicePixelRatio,y:this._canvas.height*e.y/this.devicePixelRatio,h:this._canvas.height};return i},setInteractions:function(t){var e,i,r=this._interactions;if(r)for(e=0;e<r.length;e++)i=r[e],i.tearDown();if(this._interactions=t,t)for(e=0;e<t.length;e++)i=t[e],i.setUp()},getDefaultInteraction:function(){if(this._interactions&&this._interactions.length>0)for(var t=0;t<this._interactions.length;t++){var e=this._interactions[t];if(e instanceof Je.DefaultInteraction)return e}return null},getInteractions:function(){return this._interactions},fireInteractionEvent:function(t){this._interactionDispatcher.fire(t)},addInteractionListener:function(t,e,i){this._interactionDispatcher.add(t,e,i)},removeInteractionListener:function(t,e){this._interactionDispatcher.remove(t,e)},dispose:function(){},setRenderInterval:function(t){(xi.isNaN(t)||t<=5)&&(t=5),this._renderInterval=t},_computeNetworkBoundingBox:function(){function t(t,e){t.applyMatrix4(e),o.push(t)}var e,i,r,a,n=this.getDataBox().size(),s=this.getDataBox().getDatas(),o=[];for(e=0;e<n;e++)if(i=s.get(e),i instanceof Je.Node){r=i.getBoundingBox(),a=i.worldMatrix;var l=r.min,h=r.max;t(l.clone(),a),t(h.clone(),a),t(new Ke(l.x,l.y,h.z),a),t(new Ke(l.x,h.y,l.z),a),t(new Ke(h.x,l.y,l.z),a),t(new Ke(h.x,h.y,l.z),a),t(new Ke(h.x,l.y,h.z),a),t(new Ke(l.x,h.y,h.z),a)}if(o.length<=1)return null;var c=new Je.BoundingBox;return c.setFromPoints(o),c},getNetworkBoundingBox:function(){return null==this.boundingBox&&(this.boundingBox=this._computeNetworkBoundingBox()),this.boundingBox},getSelectStyle:function(t){return t.getSelectStyle()},setZoomStandard:function(t){this._zoomStandard=t},getZoomStandard:function(){return this._zoomStandard},zoom:function(t,e){e=e||this._zoomStandard;var i=this._camera;i.zoom(t,e)},zoomIn:function(t){this.zoom(.9,t)},zoomOut:function(t){this.zoom(1.1,t)},move:function(t,e){var i=(new mono.Vec3((-t),(-e),0),this._camera.t()),r=this._camera.p();this._camera.translateX(-t),this._camera.translateY(-e);var a=this._camera.p();i.add(a.clone().sub(r)),this._camera.lookAt(i)},moveLeft:function(t){t=t||50,this.move(-t,0)},moveRight:function(t){t=t||50,this.move(t,0)},moveUp:function(t){t=t||30,this.move(0,t)},moveDown:function(t){t=t||30,this.move(0,-t)},zoomEstimateOverview:function(t){var e=this.getNetworkBoundingBox();if(null!=e){var i=e.center(),r=new Ke(0,e.max.y-e.min.y,e.max.z-e.min.z),a=new Ke(e.max.x-e.min.x,0,0,0),n=r.clone();n.length()<a.length()&&(n=a.clone());var s;if(t){var o=r.length();r.y=r.z*Math.tan(t/180*Math.PI),r.setLength(o)}s=(new Ke).addVectors(i,r.multiplyScalar(.5));var l=this._camera.fov,h=(this._camera.aspect,n.length()/2/Math.tan(l*Math.PI/180));s.add(r.normalize().multiplyScalar(h)),this._camera.setPosition(s),this._camera.lookAt(i),this._overviewDistance=this._camera.getDistance()}}}),Je.Network3DId=0,Je.Network3D.GroupCache={_groupCounter:0};var Ai=function(){function t(){if(c===b){var t=new $RenderObject;return _.push(t),b++,c++,t}return _[c++]}function i(){if(f===S){var t=new $RenderVertex;return M.push(t),S++,f++,t}return M[f++]}function r(){if(p===P){var t=new Je.RenderFace3;return A.push(t),P++,p++,t}return A[p++]}function a(){if(m===C){var t=new Je.RenderFace4;return T.push(t),C++,m++,t}return T[m++]}function n(){if(y===L){var t=new Je.RenderLine;return z.push(t),L++,y++,t}return z[y++]}function s(){if(x===D){var t=new Je.RenderableParticle;return E.push(t),D++,x++,t}return E[x++]}function o(t,e){return e.z-t.z}function l(t,e){var i=0,r=1,a=t.z+t.w,n=e.z+e.w,s=-t.z+t.w,o=-e.z+e.w;return a>=0&&n>=0&&s>=0&&o>=0||!(a<0&&n<0||s<0&&o<0)&&(a<0?i=Math.max(i,a/(a-n)):n<0&&(r=Math.min(r,a/(a-n))),s<0?i=Math.max(i,s/(s-o)):o<0&&(r=Math.min(r,s/(s-o))),!(r<i)&&(t.lerp(e,i),e.lerp(t,1-r),!0))}var h,c,u,f,d,p,m,g,y,v,x,w,_=[],b=0,M=[],S=0,A=[],P=0,T=[],C=0,z=[],L=0,E=[],D=0,N={objects:[],sprites:[],lights:[],elements:[]},B=new Je.Vec3,R=new Je.Vec4,F=new Je.BoundingBox(new Je.Vec3((-1),(-1),(-1)),new Je.Vec3(1,1,1)),I=new Je.BoundingBox,k=new Array(3),V=new Array(4),O=new Je.Mat4,U=new Je.Mat4,G=new Je.Mat4,H=new Je.Mat3,j=new Je.Mat3,X=new Je.Vec3,W=new Je.Frustum,Y=new Je.Vec4,q=new Je.Vec4;this.projectVector=function(t,i,r){return i.worldMatrixInverse.getInverse(i.worldMatrix),U.multiplyMatrices(i.projectionMatrix,i.worldMatrixInverse),r===e?t.applyProjection(U):(r.copy(t),r.applyProjection(U))},this.unprojectVector=function(t,e){return e.projectionMatrixInverse.getInverse(e.projectionMatrix),U.multiplyMatrices(e.worldMatrix,e.projectionMatrixInverse),t.applyProjection(U)},this.pickingRay=function(t,e){t.z=-1;var i=new Je.Vec3(t.x,t.y,1);return this.unprojectVector(t,e),this.unprojectVector(i,e),i.sub(t).normalize(),new Je.Picking(t,i)};var Z=function(e,i){c=0,N.objects.length=0,N.sprites.length=0,N.lights.length=0;var r=function(e){var i;i=e instanceof Je.DataBox?e.getRoots():e.getChildren(),i=i.toList();for(var a=0,n=i.size();a<n;a++){var s=i.get(a);s.isSelected()&&s instanceof Je.Node&&(i.add(s.createCanvasSelectionCube(),a),a++)}for(var a=0,n=i.size();a<n;a++){var s=i.get(a);s._visible!==!1&&(s instanceof Je.Light?N.lights.push(s):s instanceof Je.Entity||s instanceof Je.Line?s.frustumCulled!==!1&&W.intersectsObject(s)!==!0||(h=t(),h.object=s,null!==s.renderDepth?h.z=s.renderDepth:(B.copy(s.worldMatrix.getPosition()),B.applyProjection(U),h.z=B.z),N.objects.push(h)):s instanceof Je.Billboard||s instanceof Je.Particle?(h=t(),h.object=s,null!==s.renderDepth?h.z=s.renderDepth:(B.copy(s.worldMatrix.getPosition()),B.applyProjection(U),h.z=B.z),N.sprites.push(h)):(h=t(),h.object=s,null!==s.renderDepth?h.z=s.renderDepth:(B.copy(s.worldMatrix.getPosition()),B.applyProjection(U),h.z=B.z),N.objects.push(h)),r(s))}};return r(e),i===!0&&N.objects.sort(o),N};this.projectDataBox=function(t,h,c,_){var b,S,A,P,T,C,z,L,E,D,B,J,Q,K,$,tt,et,it,rt,at,nt,st,ot,lt=!1;p=0,m=0,y=0,x=0,N.elements.length=0;for(var ht=0;ht<t.getRoots().size();ht++){var ct=t.getRoots().get(ht);ct.updateWorldMatrix()}for(h.parent===e&&h.updateWorldMatrix(!0,!1),O.copy(h.worldMatrixInverse.getInverse(h.worldMatrix)),U.multiplyMatrices(h.projectionMatrix,O),j.getInverse(O),j.transpose(),W.setFromMatrix(U),N=Z(t,c),b=0,S=N.objects.length;b<S;b++)if(B=N.objects[b].object,w=B.worldMatrix,f=0,B instanceof Je.Entity){for(J=B,Q=J.vertices,K=J.faces,et=J.uvs,H.getInverse(w),H.transpose(),st=B.material instanceof Je.ArrayMaterial,
ot=st===!0?B.material:null,A=0,P=Q.length;A<P;A++)u=i(),u.positionWorld.copy(Q[A]).applyMatrix4(w),u.positionScreen.copy(u.positionWorld).applyMatrix4(U),u.positionScreen.x/=u.positionScreen.w,u.positionScreen.y/=u.positionScreen.w,u.positionScreen.z/=u.positionScreen.w,u.visible=!(u.positionScreen.x<-1||u.positionScreen.x>1||u.positionScreen.y<-1||u.positionScreen.y>1||u.positionScreen.z<-1||u.positionScreen.z>1);for(T=0,C=K.length;T<C;T++){$=K[T];var ut=st===!0?ot.materials[$.materialIndex]:B.material;if(ut!==e){var ft=ut.side;if($ instanceof Je.Face3){if(it=M[$.a],rt=M[$.b],at=M[$.c],k[0]=it.positionScreen,k[1]=rt.positionScreen,k[2]=at.positionScreen,it.visible!==!0&&rt.visible!==!0&&at.visible!==!0&&!F.isIntersectionBox(I.setFromPoints(k)))continue;if(lt=(at.positionScreen.x-it.positionScreen.x)*(rt.positionScreen.y-it.positionScreen.y)-(at.positionScreen.y-it.positionScreen.y)*(rt.positionScreen.x-it.positionScreen.x)<0,ft!==Je.DoubleSide&&lt!==(ft===Je.FrontSide))continue;d=r(),d.v1.copy(it),d.v2.copy(rt),d.v3.copy(at)}else if($ instanceof Je.Face4){if(it=M[$.a],rt=M[$.b],at=M[$.c],nt=M[$.d],V[0]=it.positionScreen,V[1]=rt.positionScreen,V[2]=at.positionScreen,V[3]=nt.positionScreen,it.visible!==!0&&rt.visible!==!0&&at.visible!==!0&&nt.visible!==!0&&!F.isIntersectionBox(I.setFromPoints(V)))continue;if(lt=(nt.positionScreen.x-it.positionScreen.x)*(rt.positionScreen.y-it.positionScreen.y)-(nt.positionScreen.y-it.positionScreen.y)*(rt.positionScreen.x-it.positionScreen.x)<0||(rt.positionScreen.x-at.positionScreen.x)*(nt.positionScreen.y-at.positionScreen.y)-(rt.positionScreen.y-at.positionScreen.y)*(nt.positionScreen.x-at.positionScreen.x)<0,ft!==Je.DoubleSide&&lt!==(ft===Je.FrontSide))continue;d=a(),d.v1.copy(it),d.v2.copy(rt),d.v3.copy(at),d.v4.copy(nt)}for(d.normalModel.copy($.normal),lt===!1&&(ft===Je.BackSide||ft===Je.DoubleSide)&&d.normalModel.negate(),d.normalModel.applyMatrix3(H).normalize(),d.normalModelView.copy(d.normalModel).applyMatrix3(j),d.centroidModel.copy($.centroid).applyMatrix4(w),tt=$.vertexNormals,z=0,L=tt.length;z<L;z++){var dt=d.vertexNormalsModel[z];dt.copy(tt[z]),lt===!1&&(ft===Je.BackSide||ft===Je.DoubleSide)&&dt.negate(),dt.applyMatrix3(H).normalize();var pt=d.vertexNormalsModelView[z];pt.copy(dt).applyMatrix3(j)}d.vertexNormalsLength=tt.length;var mt=et[T];for(E=0,D=mt.length;E<D;E++)d.uvs[0][E]=mt[E];d.color=$.color,d.material=ut,X.copy(d.centroidModel).applyProjection(U),d.z=X.z,N.elements.push(d)}}}else if(B instanceof Je.Line){G.multiplyMatrices(U,w),Q=B.vertices,it=i(),it.positionScreen.copy(Q[0]).applyMatrix4(G);var gt=B.type===Je.LinePieces?2:1;for(A=1,P=Q.length;A<P;A++)it=i(),it.positionScreen.copy(Q[A]).applyMatrix4(G),(A+1)%gt>0||(rt=M[f-2],Y.copy(it.positionScreen),q.copy(rt.positionScreen),l(Y,q)===!0&&(Y.multiplyScalar(1/Y.w),q.multiplyScalar(1/q.w),g=n(),g.v1.positionScreen.copy(Y),g.v2.positionScreen.copy(q),g.z=Math.max(Y.z,q.z),g.material=B.material,N.elements.push(g)))}for(b=0,S=N.sprites.length;b<S;b++)B=N.sprites[b].object,w=B.worldMatrix,B instanceof Je.Particle&&(R.set(w.elements[12],w.elements[13],w.elements[14],1),R.applyMatrix4(U),R.z/=R.w,R.z>0&&R.z<1&&(v=s(),v.object=B,v.x=R.x/R.w,v.y=R.y/R.w,v.z=R.z,v.rotation=B.rotation.z,v.scale.x=B.scale.x*Math.abs(v.x-(R.x+h.projectionMatrix.elements[0])/(R.w+h.projectionMatrix.elements[12])),v.scale.y=B.scale.y*Math.abs(v.y-(R.y+h.projectionMatrix.elements[5])/(R.w+h.projectionMatrix.elements[13])),v.material=B.material,N.elements.push(v)));return _===!0&&N.elements.sort(o),N}};Je.Projector=Ai,Je.Billboard=function(t){null!=t&&null!=t.id?this._id=t.id:this._id=t,Je.Element.call(this,this._id),this.material=new Je.BillboardMaterial,this.rotation3d=this._rotation,this.rotation=0,this.vertices=[new Ke((-.5),(-.5),0),new Ke(.5,(-.5),0),new Ke(.5,.5,0),new Ke((-.5),.5,0)]},Je.extend(Je.Billboard,Je.Element,{constructor:Je.Billboard,className:"TGL.Billboard",updateMatrix:function(){this.matrix.setPosition(this._position),this.rotation=this._rotation.z,this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(1!==this._scale.x||1!==this._scale.y)&&this.matrix.scale(this._scale),this.matrixWorldNeedsUpdate=!0},clone:function(t){return t===e&&(t=new Je.Billboard(this.material)),Je.Element.prototype.clone.call(this,t),t},setMaterialStyle:function(t,e){var i=this.material.clone();t=t.substr(t.indexOf(".")+1),this._A97(i,t,e);var r=i.getUniqueCode(),a=Ki.getMaterial(r);null!=a?(Ki.unUseMaterial(this.material),this.material=a,Ki.useMaterial(a)):(Ki.unUseMaterial(this.material),Ki.setMaterial(r,i),this.material=i)}}),Je.ShaderSprite={sprite:{vertexShader:["uniform int useScreenCoordinates;","uniform int sizeAttenuation;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","uniform bool vertical;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = (position + alignment) * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","vec4 upPosition;","vec4 rightPosition = vec4(scale.x,0.0,0.0,1.0);","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","if(vertical){","upPosition =  modelViewMatrix * vec4( 0.0, 1.0, 0.0, 1.0 ) - finalPosition;","normalize(upPosition);","}","if(vertical){","finalPosition.xyz += (rotatedPosition.x * rightPosition.xyz / scale.x) + (rotatedPosition.y * upPosition.xyz / scale.y);","}else{","finalPosition.xy += rotatedPosition;","}","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform int useMap;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","if(useMap > 0){","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","} else {","gl_FragColor = vec4( color, 1.0);","}","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")}},Je.BillboardRenderer=function(){function t(t,i){var r=e.createProgram(),a=e.createShader(e.FRAGMENT_SHADER),n=e.createShader(e.VERTEX_SHADER),s="precision "+i+" float;\n";return e.shaderSource(a,s+t.fragmentShader),e.shaderSource(n,s+t.vertexShader),e.compileShader(a),e.compileShader(n),e.attachShader(r,a),e.attachShader(r,n),e.linkProgram(r),r}var e,i,r,a={},n=(new Je.Billboard,new Je.BillboardMaterial({color:255}));this.init=function(n){this.enable=!0,n._currentGroupHash=null,e=n._gl,i=n,r=n.getPrecision(),a.vertices=new Float32Array(16),a.faces=new Uint16Array(6),a.lines=new Uint16Array(8);var s=0;a.vertices[s++]=-.5,a.vertices[s++]=-.5,a.vertices[s++]=0,a.vertices[s++]=0,a.vertices[s++]=.5,a.vertices[s++]=-.5,a.vertices[s++]=1,a.vertices[s++]=0,a.vertices[s++]=.5,a.vertices[s++]=.5,a.vertices[s++]=1,a.vertices[s++]=1,a.vertices[s++]=-.5,a.vertices[s++]=.5,a.vertices[s++]=0,a.vertices[s++]=1,s=0,a.faces[s++]=0,a.faces[s++]=1,a.faces[s++]=2,a.faces[s++]=0,a.faces[s++]=2,a.faces[s++]=3,s=0,a.lines[s++]=0,a.lines[s++]=1,a.lines[s++]=0,a.lines[s++]=3,a.lines[s++]=1,a.lines[s++]=2,a.lines[s++]=2,a.lines[s++]=3,a.vertexBuffer=e.createBuffer(),a.elementBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,a.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,a.vertices,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a.elementBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,a.faces,e.STATIC_DRAW),a.program=t(Je.ShaderSprite.sprite,r),a.attributes={},a.uniforms={},a.attributes.position=e.getAttribLocation(a.program,"position"),a.attributes.uv=e.getAttribLocation(a.program,"uv"),a.uniforms.uvOffset=e.getUniformLocation(a.program,"uvOffset"),a.uniforms.uvScale=e.getUniformLocation(a.program,"uvScale"),a.uniforms.rotation=e.getUniformLocation(a.program,"rotation"),a.uniforms.scale=e.getUniformLocation(a.program,"scale"),a.uniforms.alignment=e.getUniformLocation(a.program,"alignment"),a.uniforms.color=e.getUniformLocation(a.program,"color"),a.uniforms.useMap=e.getUniformLocation(a.program,"useMap"),a.uniforms.map=e.getUniformLocation(a.program,"map"),a.uniforms.opacity=e.getUniformLocation(a.program,"opacity"),a.uniforms.vertical=e.getUniformLocation(a.program,"vertical"),a.uniforms.useScreenCoordinates=e.getUniformLocation(a.program,"useScreenCoordinates"),a.uniforms.sizeAttenuation=e.getUniformLocation(a.program,"sizeAttenuation"),a.uniforms.screenPosition=e.getUniformLocation(a.program,"screenPosition"),a.uniforms.modelViewMatrix=e.getUniformLocation(a.program,"modelViewMatrix"),a.uniforms.projectionMatrix=e.getUniformLocation(a.program,"projectionMatrix"),a.uniforms.fogType=e.getUniformLocation(a.program,"fogType"),a.uniforms.fogDensity=e.getUniformLocation(a.program,"fogDensity"),a.uniforms.fogNear=e.getUniformLocation(a.program,"fogNear"),a.uniforms.fogFar=e.getUniformLocation(a.program,"fogFar"),a.uniforms.fogColor=e.getUniformLocation(a.program,"fogColor"),a.uniforms.alphaTest=e.getUniformLocation(a.program,"alphaTest"),this.inited=!0},this.render=function(t,r,s,o,l){this.inited||this.init(t);var h=new ci(r),c=h.size();if(c){var u=a.attributes,f=a.uniforms,d=!1;t.pm.currentProgram!=a.program&&(e.useProgram(a.program),t.pm.currentProgram=a.program,t._currentGroupHash=null,e.enableVertexAttribArray(u.position),e.enableVertexAttribArray(u.uv),e.disable(e.CULL_FACE),e.bindBuffer(e.ARRAY_BUFFER,a.vertexBuffer),e.vertexAttribPointer(u.position,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(u.uv,2,e.FLOAT,!1,16,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a.elementBuffer),this.enable=!0,d=!0),e.uniformMatrix4fv(f.projectionMatrix,!1,s.projectionMatrix.elements),d&&e.activeTexture(e.TEXTURE0),d&&e.uniform1i(f.map,0);var p=0,m=0,g=t.fog;g?(e.uniform3f(f.fogColor,g.color.r,g.color.g,g.color.b),g instanceof Je.Fog?(e.uniform1f(f.fogNear,g.near),e.uniform1f(f.fogFar,g.far),e.uniform1i(f.fogType,1),p=1,m=1):g instanceof Je.FogExp2&&(e.uniform1f(f.fogDensity,g.density),e.uniform1i(f.fogType,2),p=2,m=2)):(p=0,m=0);var y,v,x;for(y=0;y<c;y++)v=h.get(y),x=v.material,i.isVisible(v)&&0!==x.opacity&&(v.updateWorldMatrix(!0,!1),x.useScreenCoordinates?v.z=-v.position.z:(v._modelViewMatrix=new Je.Mat4,v._modelViewMatrix.multiplyMatrices(s.worldMatrixInverse,v.worldMatrix),v.z=-v._modelViewMatrix.elements[14]));for(y=0;y<c;y++)v=h.get(y),this.renderBillboard(v,f,t,p,m),v._selected&&(v._scale.x=1.01*v._scale.x,v._scale.y=1.01*v._scale.y,v.material.clone(n),n.map=null,n.color.set(65280),this.renderBillboard(v,f,t,p,m,n),v._scale.x=v._scale.x/1.01,v._scale.y=v._scale.y/1.01)}},this.disable=function(){if(this.enable){var t=a.attributes;a.uniforms;e.disableVertexAttribArray(t.position),e.disableVertexAttribArray(t.uv),i._oldDoubleSided||e.enable(e.CULL_FACE),i._oldBlending===Je.NoBlending&&e.disable(e.BLEND),bi.setDepthWrite(!0,i),this.enable=!1,this.lastMaterialId=null,i.pm.currentProgram=null}},this.renderBillboard=function(t,r,n,s,o,l){var h,c,u,f=[],d=new Ke;if(h=l?l:t.material,i.isVisible(t)&&0!==h.opacity){var p=h.id,m=p!=this.lastMaterialId;m&&e.uniform1f(r.alphaTest,h.alphaTest),m&&(h.useScreenCoordinates===!0?(e.uniform1i(r.useScreenCoordinates,1),e.uniform3f(r.screenPosition,(t.position.x*i.devicePixelRatio-halfViewportWidth)/halfViewportWidth,(halfViewportHeight-t.position.y*i.devicePixelRatio)/halfViewportHeight,Math.max(0,Math.min(1,t.position.z)))):(e.uniform1i(r.useScreenCoordinates,0),e.uniform1i(r.sizeAttenuation,h.sizeAttenuation?1:0))),h.useScreenCoordinates===!0?(f[0]=i.devicePixelRatio,f[1]=i.devicePixelRatio):(e.uniformMatrix4fv(r.modelViewMatrix,!1,t._modelViewMatrix.elements),f[0]=1,f[1]=1),u=n.fog&&h.fog?o:0,s!==u&&(e.uniform1i(r.fogType,u),s=u),c=1/(h.scaleByViewport?viewportHeight:1),d.getScaleFromMatrix(t.worldMatrix),f[0]*=c*d.x,f[1]*=c*d.y,m&&(e.uniform2f(r.uvScale,h.repeat.x,h.repeat.y),e.uniform2f(r.uvOffset,h.offset.x,h.offset.y),e.uniform2f(r.alignment,h.alignment.x,h.alignment.y),e.uniform1f(r.opacity,h.opacity),e.uniform1i(r.vertical,h.vertical),e.uniform3f(r.color,h.color.r,h.color.g,h.color.b),e.uniform1f(r.rotation,t.rotation)),e.uniform2fv(r.scale,f),m&&(i.setBlending(h.blending,h.blendEquation,h.blendSrc,h.blendDst),i.setDepthTest(h.depthTest),i.setDepthWrite(h.depthMask)),h.map&&h.map._image&&i.pm.addTexture(h.map),m=m||h.map&&i.pm.needsUpdateTexture(h.map),h.map&&h.map._image&&h.map._image.width?(m&&i.setTexture(h.map,0),m&&e.uniform1i(r.useMap,1)):m&&e.uniform1i(r.useMap,0),l?(m&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a.elementBuffer),m&&e.bufferData(e.ELEMENT_ARRAY_BUFFER,a.lines,e.STATIC_DRAW),m&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a.elementBuffer),e.drawElements(e.LINES,8,e.UNSIGNED_SHORT,0)):(m&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a.elementBuffer),m&&e.bufferData(e.ELEMENT_ARRAY_BUFFER,a.faces,e.STATIC_DRAW),m&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a.elementBuffer),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)),this.lastMaterialId=h.id}}};var Mi=function(t,i,r){this.width=t,this.height=i,r=r||{},this.wrapS=r.wrapS!==e?r.wrapS:Je.ClampToEdgeWrapping,this.wrapT=r.wrapT!==e?r.wrapT:Je.ClampToEdgeWrapping,this.magFilter=r.magFilter!==e?r.magFilter:Je.LinearFilter,this.minFilter=r.minFilter!==e?r.minFilter:Je.LinearMipMapLinearFilter,this.anisotropy=r.anisotropy!==e?r.anisotropy:1,this.offset=new Je.Vec2(0,0),this.repeat=new Je.Vec2(1,1),this.format=r.format!==e?r.format:Je.RGBAFormat,this.type=r.type!==e?r.type:Je.UnsignedByteType,this.depthBuffer=r.depthBuffer===e||r.depthBuffer,this.stencilBuffer=r.stencilBuffer===e||r.stencilBuffer,this.generateMipmaps=!0,this.shareDepthFrom=null};Mi.prototype={constructor:Mi,clone:function(){var t=new Mi(this.width,this.height);return t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.format=this.format,t.type=this.type,t.depthBuffer=this.depthBuffer,t.stencilBuffer=this.stencilBuffer,t.generateMipmaps=this.generateMipmaps,t.shareDepthFrom=this.shareDepthFrom,t},getUniqueCode:function(){return this._id},dispose:function(){this.dispatchEvent({type:"dispose"})}};var Si=function(t,e,i){Mi.call(this,t,e,i),this.activeCubeFace=0};Je.extend(Si,Mi,{});var Pi,Ti="l=1.0\ntype=1\ngis=0\n3d=1\nstart=2015-10-21\nend=2016-10-31\nnote=This license applies to the evaluation version of TWaver. The License is limited to noncommercial use. Noncommercial use relates only to educational, research, personal or evaluation purposes. Any other use is commercial use. You may not use the Software in connection with any business activities.And You are not permitted to modify the software or attempt to decipher, decompile, disassemble or reverse engineer this Software.\nsignature=69b57c46f9801b1ad4c0ec28e49fafd90df6bd4f63e42b019ff240736150c9a2070b4f2c7c1b2d94063a1402d811e757aa6aced3defef6ccafdf6f28b0dd4bc4e5ee9b033b9d9a12629329c76b5e22d608e561c8caa0dfeafb1cd9d1b1c988edf1b7a8d1d9520555f87e20626de98388c1bd30c0079ebacc6229b199648b774538a5abd45055658bcdf472770f1b7574d6ee17c0ec273ec2bcdd3053b24e7f547e93dbd4a180f9cd937541164297564dfa4d28ea4709ca165cbd515262976cc230459a86a7790be4f696b49f5b14e03b30abd94ca1f034c4376e1fad9ab7252c3e2930d2ac9383e84182683ac47ee29e109388c8165ea8001a0526dac643ac073edbb5038f065378dd77d69b22fc9716cc0a8c2adf4e090de8ebe24724d3a14ff73855193182c01cf7e5344e4400d9303f3e9a8d762862cab6ac4d8f37af59c1dcde69eb92a1b7b1a3493d63c1404b6f0c5c00975e9ab12daa68d7f4d3fe3b6863a72618ec0c6a6f6cb77a8476fd904cefcff326eaf2328c49b05c35898418ca2b974359d639f399a9a6f4cb14caf3af590753e67c52d44fed018fcb607a042ebecb4b6bb7d43ed364f76fbe47644c125e9cd97f393029e9cee49a910ae672041ec026ec55709c02662cccb62818dcd33e96a4c59d13995752636ae6ca2a7f961421adabf1277986ed03bdec170e1d00cb4c3668fb65bcc087996a7174163f63179507fc710fbf8697b7e8ddc5bbe5d54177a4dbe073ed1d90e6b842b42f04e6fd69f26a7dc3227f0189c21424b556ccdaa8d2b1829c35039670ea7663a8088220fffe99a530863fdff1ca18a468edd6adcc5a680e13c5a432096977d5b157ff5848f6bf464ca5dbf670f2cb090c3cbc4ccd8f8355b91505502e215b97646b86",Ci=0xdeadbeefcafe,zi=15715070==(16777215&Ci);zi&&"Microsoft Internet Explorer"==navigator.appName?(m.prototype.am=v,Pi=30):zi&&"Netscape"!=navigator.appName?(m.prototype.am=y,Pi=26):(m.prototype.am=x,Pi=28),m.prototype.DB=Pi,m.prototype.DM=(1<<Pi)-1,m.prototype.DV=1<<Pi;var Li=52;m.prototype.FV=Math.pow(2,Li),m.prototype.F1=Li-Pi,m.prototype.F2=2*Pi-Li;var Ei,Di,Ni="0123456789abcdefghijklmnopqrstuvwxyz",Bi=new Array;for(Ei="0".charCodeAt(0),Di=0;Di<=9;++Di)Bi[Ei++]=Di;for(Ei="a".charCodeAt(0),Di=10;Di<36;++Di)Bi[Ei++]=Di;for(Ei="A".charCodeAt(0),Di=10;Di<36;++Di)Bi[Ei++]=Di;H.prototype.convert=X,H.prototype.revert=W,H.prototype.reduce=Y,H.prototype.mulTo=q,H.prototype.sqrTo=Z,Q.prototype.convert=K,Q.prototype.revert=$,Q.prototype.reduce=tt,Q.prototype.mulTo=it,Q.prototype.sqrTo=et,m.prototype.copyTo=M,m.prototype.fromInt=S,m.prototype.fromString=P,m.prototype.clamp=T,m.prototype.dlShiftTo=B,m.prototype.drShiftTo=R,m.prototype.lShiftTo=F,m.prototype.rShiftTo=I,m.prototype.subTo=k,m.prototype.multiplyTo=V,m.prototype.squareTo=O,m.prototype.divRemTo=U,m.prototype.invDigit=J,m.prototype.isEven=rt,m.prototype.exp=at,m.prototype.toString=C,m.prototype.negate=z,m.prototype.abs=L,m.prototype.compareTo=E,m.prototype.bitLength=N,m.prototype.mod=G,m.prototype.modPowInt=nt,m.ZERO=A(0),m.ONE=A(1),Jt.prototype.convert=Qt,Jt.prototype.revert=Qt,Jt.prototype.mulTo=Kt,Jt.prototype.sqrTo=$t,re.prototype.convert=ae,re.prototype.revert=ne,re.prototype.reduce=se,re.prototype.mulTo=le,re.prototype.sqrTo=oe;var Ri=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Fi=(1<<26)/Ri[Ri.length-1];m.prototype.chunkSize=ct,m.prototype.toRadix=ft,m.prototype.fromRadix=dt,m.prototype.fromNumber=pt,m.prototype.bitwiseTo=xt,m.prototype.changeBit=Ft,m.prototype.addTo=Ot,m.prototype.dMultiply=qt,m.prototype.dAddOffset=Zt,m.prototype.multiplyLowerTo=ee,m.prototype.multiplyUpperTo=ie,m.prototype.modInt=ue,m.prototype.millerRabin=pe,m.prototype.clone=st,m.prototype.intValue=ot,m.prototype.byteValue=lt,m.prototype.shortValue=ht,m.prototype.signum=ut,m.prototype.toByteArray=mt,m.prototype.equals=gt,m.prototype.min=yt,m.prototype.max=vt,m.prototype.and=_t,m.prototype.or=Mt,m.prototype.xor=At,m.prototype.andNot=Tt,m.prototype.not=Ct,m.prototype.shiftLeft=zt,m.prototype.shiftRight=Lt,m.prototype.getLowestSetBit=Dt,m.prototype.bitCount=Bt,m.prototype.testBit=Rt,m.prototype.setBit=It,m.prototype.clearBit=kt,m.prototype.flipBit=Vt,m.prototype.add=Ut,m.prototype.subtract=Gt,m.prototype.multiply=Ht,m.prototype.divide=Xt,m.prototype.remainder=Wt,m.prototype.divideAndRemainder=Yt,m.prototype.modPow=he,m.prototype.modInverse=fe,m.prototype.pow=te,m.prototype.gcd=ce,m.prototype.isProbablePrime=de,m.prototype.square=jt,me.prototype.init=ge,me.prototype.next=ye;var Ii,ki,Vi,Oi=256;if(null==ki){ki=new Array,Vi=0;var Ui;if("Netscape"==navigator.appName&&navigator.appVersion<"5"&&t.crypto){var Gi=t.crypto.random(32);for(Ui=0;Ui<Gi.length;++Ui)ki[Vi++]=255&Gi.charCodeAt(Ui)}for(;Vi<Oi;)Ui=Math.floor(65536*Math.random()),ki[Vi++]=Ui>>>8,ki[Vi++]=255&Ui;Vi=0,we()}Me.prototype.nextBytes=be;Pe.prototype.doPublic=Ce,Pe.prototype.setPublic=Te,Pe.prototype.encrypt=ze,Pe.prototype.doPrivate=Ne,Pe.prototype.setPrivate=Ee,Pe.prototype.setPrivateEx=De,Pe.prototype.decrypt=Be;var Hi=function(){ji.v(Ti)},ji={},Xi="6a384c1259bdb5e731ec96b3174683f48a2c56a85e52e7a5bb20b58711ce50c1a294bd5e1d1752e766085e9ae94bae6d217c25dbb5fcdb86a8a9a7e180fa066723d00fcb85fcf7c9d29f8cc8859f53244a49c0bc30dcc45156daf8843ce1d24fe8ebc9a3c186bb26e9d0714041aef160304c1db8cc5728cf4acb39d29755f319",Wi="10001",Yi="61a921483dfa8f24e26204ace4d990b965d11e5bef5d8a5e768ebc5853a6bdd94b02369a3165207460fb91001d3fd83fbe69c6e51b8e40c8ae8a4e30a7c539dca98b44858bdc0b76f25af6803d4d13dacd9fa1a28f66cf561fa36309d4239a2cf50fe20ef0e99e01fc8701090f0685a524f411e00ca91f877d3b49d2d0052f9",qi="b881f568eb43e7a60c256a8a90e08b7c7638fd66ce3cded9005c72e283ca4f2b8601e2edc687d7f898348a05723b515d9edeb626af7b499a56ddaea93b0c2047";ji.cross=function(t){if(t){for(var e="",i=0;i<t.length;)i+1<t.length?(e+=t[i+1],e+=t[i]):e+=t[i],i+=2;return e}return null},ji.reverse=function(t){if(t){for(var e="",i=t.length;i>0;i--)e+=t[i-1];return e}return null},ji.v=function(t){if(t){var e=ji;if(e.start=null,e.beginDate=null,e.end=null,e.endDate=null,e.gis=null,e["3D"]=null,e["3d"]=null,e.l=null,e.__li__=null,t.indexOf("signature=")>0){var i=t.split("signature="),r=i[0],a=i[1],n=new Pe;n.setPublic(Xi,Wi);for(var s=a,o=s.length,l=256,h=0,c="",u="";h<o;)c=s.substr(h,l),u+=n.decrypt(c),h+=l;if(u===r)return e.i(t),!0}}return!1},ji.i=function(t){var i=ji;i.__li__=t;var r,a,n,s,o,l=t.split("\n");for(r=0;r<l.length;r++)a=l[r],o=a.split("="),n=o[0],s=o[1],i[n]=s;i.start!=e&&(i.beginDate=new Date(Date.parse(i.start.replace(/-/g,"/")))),i.end!=e&&(i.endDate=new Date(Date.parse(i.end.replace(/-/g,"/"))));var h=i.gis;h!=e&&(h=parseInt(h)),h&&(i._isPermissionGIS=!0);var c=i["3D"]||i["3d"];c!=e&&(c=parseInt(c)),c&&(i._isPermission3D=!0),i.l!=e&&(i.version=i.l)};var Zi=function(t){return t.__li__!==e&&t._isPermission3D},Ji=function(t){if(!Zi(t))return!0;var e=new Date;return null!=t.beginDate&&t.beginDate.getTime()-e.getTime()>=0||null!=t.endDate&&t.endDate.getTime()-e.getTime()<=0};ji.$z=function(t){var e=new Pe;e.setPublic(Xi,Wi);for(var i=t,r=i.length,a=256,n=0,s="",o="";n<r;)s=i.substr(n,a),o+=e.decrypt(s),n+=a;return o},ji.twm=function(t){var i=ji,r=i.$z("4cd18113d0c7046bfe51f7a3fbd41c2b7cf14dd785d6ea7cec9da17710d3acfb8ce0cb9cf10839f4bd51e88819de19cdc0db09278584396156fcb65abe0353ac49d01326b30efa0ea98a07da9f8ceeb7572fc1b37b5965ba6103ccba4913b62e36e49425c6ff21a2f008830c59cff8f29058769f858c8a9f0bab3eaea7fb8a9e"),a=this.type,n=this.markText,s=i.$z("648be38cd61c870e95ffc1ea0676af40736c1365015abc326e891a4de67b4de3d4b05da70b9aebedc83ec26ecf71eb74c72f42f6d9a4be2d507d2f67d2860b7b66e3ba1d565e15923f2db335ff922eef17c01b59818b583d5656412d6cc9d9ba70001c2c88e3efd492c6b13a07fda5f325b333138a2036f4696542ec137cc341");t[s]=i.__li__;var o=t;if(o._xyz=null,"3"!==a||Ji(ji)||n!==e){t.DEBUG&&(console.log("license: "+ji.__li__),console.log("license Type : "+a),console.log("beginDate: "+ji.beginDate),console.log("endDate: "+ji.endDate),console.log("mark: "+n)),t.__liLabel==e&&(t.__liLabel=document.createElement("div")),i.startDate===e&&(i.startDate=new Date);var l=(new Date).getTime()-i.startDate.getTime(),h="2"===a?7200:300;if(!(l<1e3*h)){var c=Ji(i)&&l>1e3*h,u=n;if(c?u=i.$z("0dd629dbd0ce341ecdd447e35ddc3135a0b46916f7571a687f38ae665cf0ae095fee885e14329caa75112d8787508da17285b0897845d8ccae73e6a2727dd19f1ca335fe139d0e60d240f9ececc78f81c2c5667f51aeed4135b9c4bb436b8acb7cd418eeeb404bc4f3bcdedb481ac0edff7644435ce2b9f2bda78c892bd56d73"):"2"!=a||u!==e&&""!=u?"1"==a&&!n&&(u=r):u=i.$z("644d54bf9c59afbd8a742a9e7e2731f23f149ccb7f04c3547548c50ac2d77faea108b55f1f6261e99869f1c06b84e8abdefdf45b5170048531421f3d528123972ba2f03d70f37c33f1341dc12f986e0089e42bab517e2a05b455d12d90991bbba9bc45c715a81943062ea5fa5408c8b1b9270d260cc5a67b38ecc4178ce512fc"),u!==e){var f=o.__liLabel;f.innerHTML=u,f.type=a,f.mark=n,f.expired=c,o._xyz=f,c&&(o.getView().style.opacity=.1)}}}},xi.validateLicense(Ti),Je.Material=function(t){Je.PropertyChangeDispatcher.call(this),this.id=Je.MaterialIdCount++,this.type="basic",this.shaderID="",this.uniforms=e,this.vertexShader="",this.fragmentShader="",this.alarmColor=null,this.name="",this.side=Je.FrontSide,this.fog=!0,this.normalType=e,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=Je.NoColors,this.blendMode=Je.NormalBlending,this.blendSrc=Je.SrcAlphaFactor,this.blendDst=Je.OneMinusSrcAlphaFactor,this.blendEquation=Je.AddEquation,this.depthTest=!0,this.depthMask=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.transparent=!1,this.opacity=1,this.visible=!0,this.needsUpdate=!0,this.setValues(t),this.useCount=0,this.styleMap={},this.offset=new Qe(0,0),this.repeat=new Qe(1,1),this.gradient={},this.gradientType=1,this.gradientCenter=new Qe(.5,.5),this.outline=0},Je.extend(Je.Material,Je.PropertyChangeDispatcher,{generateKey:function(){},setMap:function(t,e){if(null==e&&(e="map"),this[e]!==t){var i=this[e];this[e]=t,this.firePropertyChange(e,i,t),this.onMapChanged(i,t)}},handleTextureChange:function(t){if("image"===t.property){this.firePropertyChange("needsUpdate",!1,!0)}else"disposed"===t.property},onPropertyChange:function(t,e,i){},onMapChanged:function(t,e){},setColor:function(t){if(this.color!==t){var e=this.color.clone();t instanceof Je.Color?this.color.copy(t):this.color.set(t),this.firePropertyChange("color",e,t)}},setPropertyValue:function(t,e){if(this[t]!==e){var i=this[t];if(i instanceof Je.Color)null!=e&&(i=i.clone(),e instanceof Je.Color?this[t].copy(e):this[t].set(e));else if("gradient"==t){var r={};for(var a in e)e[a]instanceof Je.Color?r[a]=e[a]:r[a]=new Je.Color(e[a]);this[t]=r}else this[t]=e;this._uniqueCode=null,this.firePropertyChange(t,i,e)}},isTextureStyle:function(t){return"terrain"===this._type?t.startsWith("texture1.")||t.startsWith("texture2.")||t.startsWith("textureb.")||t.startsWith("texturen.")||t.startsWith("texturebp."):t.startsWith("texture.")||t.startsWith("lightmap")||t.startsWith("envmap")||t.startsWith("normalmap")||t.startsWith("specularmap")},setNeedsUpdate:function(t){},getShaderID:function(){return this instanceof Je.BasicMaterial&&(this.shaderID="basic"),this.shaderID},setupMaterialShader:function(){var t=this.getShaderID(),e=Je.ShaderLib[t];this.uniforms=Je.UniformsUtils.clone(e.uniforms),this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader},refreshUniforms:function(t,e){this.refreshUniformsCommon(t,e),this.refreshUniformsSpecific(t,e)},loadCameraPosition:function(t,e,i){if((this instanceof Je.ShaderMaterial||this instanceof Je.PhongMaterial||this.envMap||"phong"===this._type)&&null!=t.cameraPosition){var r=e.worldMatrix.getPosition();i.uniform3f(t.cameraPosition,r.x,r.y,r.z)}},loadViewMatrix:function(t,e,i){("lambert"===this.type||"phong"===this.type||material.skinning)&&null!==t.viewMatrix&&i.uniformMatrix4fv(p_uniforms.viewMatrix,!1,e.worldMatrixInverse.elements)},refreshUniformsSpecific:function(t){},refreshUniformsCommon:function(t){var i=this.uniforms,r=this;i.opacity.value=r.opacity;var a=xi.getObjectCount(this.gradient)>0;if(t?i.diffuse.value.copyGammaToLinear(this.alarmColor?this.alarmColor:this.color):i.diffuse.value=this.alarmColor?this.alarmColor:this.color,a){var n=[],s=[];for(var o in this.gradient)n.push(o);n.sort();for(var l=0;l<n.length;l++)s.push(this.gradient[n[l]]);i.gradientColor.value=s,i.gradientStop.value=n,i.gradientType.value=this.gradientType}i.map.value=r.map,i.lightMap.value=r.lightMap,i.specularMap.value=r.specularMap,r.bumpMap&&(i.bumpMap.value=r.bumpMap,i.bumpScale.value=r.bumpScale),r.normalMap&&"phong"===r._type&&(i.normalMap.value=r.normalMap,i.normalScale.value.copy(r.normalScale));var h;if(r.map?h=r.map:r.specularMap?h=r.specularMap:r.normalMap&&"phong"===r._type?h=r.normalMap:r.bumpMap&&"phong"===r._type&&(h=r.bumpMap),h!=e){var c=this.offset,u=this.repeat;i.offsetRepeat.value.set(c.x,c.y,u.x,u.y),i.flipX.value=h.flipX?1:0,i.mapLoaded.value=1,h._image&&!h._image.loaded&&i.offsetRepeat.value.set(0,0,1,1)}i.envMap.value=r.envMap,i.flipEnvMap.value=1,t?i.reflectivity.value=r.reflectRatio*r.reflectRatio:i.reflectivity.value=r.reflectRatio,i.refractionRatio.value=r.refractionRatio,i.combine.value=r.combine,i.useRefract.value=r.envMap&&r.envMap.mapping instanceof Je.CubeRefractionMapping},loadGeneralUniforms:function(){},getNormalType:function(){var t=this&&this.normalType!==e&&this.normalType===Je.NormalTypeSmooth;return t?Je.SmoothShading:Je.FlatShading},isVertexColor:function(){return!!this.vertexColors&&this.vertexColors},needUV:function(){return this.map||this.lightMap||this.bumpMap||this.normalMap||this.specularMap,!0},setValues:function(t){if(t!==e)for(var i in t){var r=t[i];if(r!==e){if(i in this){var a=this[i];a instanceof Je.Color&&r instanceof Je.Color?a.copy(r):a instanceof Je.Color?a.set(r):a instanceof Je.Vec3&&r instanceof Je.Vec3?a.copy(r):this[i]=r}}else console.warn("TGL.Material: '"+i+"' parameter is undefined.")}},isCustomAttributesNeedUpdate:function(){if(!this.attributes)return!1;for(var t in this.attributes)if(this.attributes[t].needsUpdate)return!0;return!1},clearCustomAttributes:function(){if(this.attributes)for(var t in this.attributes)this.attributes[t].needsUpdate=!1},clone:function(t){return t===e&&(t=new Je.Material),t.name=this.name,t.side=this.side,t.blendMode=this.blendMode,t.blendSrc=this.blendSrc,t.blendDst=this.blendDst,t.blendEquation=this.blendEquation,t.depthTest=this.depthTest,t.depthMask=this.depthMask,t.polygonOffset=this.polygonOffset,t.polygonOffsetFactor=this.polygonOffsetFactor,t.polygonOffsetUnits=this.polygonOffsetUnits,t.alphaTest=this.alphaTest,t.transparent=this.transparent,t.opacity=this.opacity,t.visible=this.visible,t.normalType=this.normalType,t.wireframe=this.wireframe,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.wireframeLinewidth=this.wireframeLinewidth,t.gradient=this.gradient,t.gradientType=this.gradientType,t.outline=this.outline,t},dispose:function(){this.firePropertyChange("disposed",!1,!0)}}),Je.MaterialIdCount=0,Je.EntityMaterial=function(t){Je.Material.call(this),this._type="basic",this.color=new Je.Color(16777215),this.map=null,this.ambient=new Je.Color(16777215),this.emissive=new Je.Color(0),this.specular=new Je.Color(1118481),this.specularStrength=1,this.shininess=30,this.wrapAround=!1,this.wrapRGB=new Je.Vec3(1,1,1),this.lightMap=null,this.specularMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Je.Vec2(1,1),this.envMap=null,this.combine=Je.MultiplyOperation,this.reflectRatio=1,this.refractionRatio=.98,this.fog=!0,this.shading=Je.SmoothShading,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.metal=!1,this.perPixel=!0,this.map1=null,this.map2=null,this.blendMap=null,this.detailMap=null,this.specularMap=null,this.blendRange=new Qe(0,1),this.setValues(t)},Je.extend(Je.EntityMaterial,Je.Material,{getShaderID:function(){return this.getType()},getUniqueCode:function(){if(null!=this._uniqueCode)return this._uniqueCode;var t=this._type+" "+this.color.r+this.color.g+this.color.b+" "+this.ambient.getUniqueCode()+" "+this.emissive.getUniqueCode()+this.specular.getUniqueCode()+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth+" "+this.polygonOffset+" "+this.polygonOffsetFactor+" "+this.polygonOffsetUnits+" "+this.overdraw+" "+this.shininess+" "+this.metal+" "+this.specularStrength;
if(this.alphaTest&&(t+=this.alphaTest),t+=" "+this.normalType+" ",t+=this.repeat.x+" "+this.repeat.y+this.offset.x+" "+this.offset.y,t+=" "+this.blendRange.x+" "+this.blendRange.y,t+=" "+this.normalScale.x+" "+this.normalScale.y,t+=" "+this.reflectRatio,this.map&&(t+=this.map.getUniqueCode()),this.map1&&(t+=this.map1.getUniqueCode()),this.map2&&(t+=this.map2.getUniqueCode()),this.blendMap&&(t+=this.blendMap.getUniqueCode()),this.normalMap&&(t+=this.normalMap.getUniqueCode()),this.lightMap&&(t+=this.lightMap.getUniqueCode()),this.envMap&&(t+=this.envMap.getUniqueCode()),this.specularMap&&(t+=this.specularMap.getUniqueCode()),this.alarmColor&&(t+=" "+this.alarmColor.getUniqueCode()),this.gradient)for(var e in this.gradient)t+=" "+e+":"+this.gradient[e].getUniqueCode();return t+=" "+this.gradientType,t+=" "+this.outline,t+=this.combine,this._uniqueCode=t,t},loadViewMatrix:function(t,e,i){("lambert"===this._type||"phong"===this._type||material.skinning)&&null!==t.viewMatrix&&i.uniformMatrix4fv(p_uniforms.viewMatrix,!1,e.worldMatrixInverse.elements)},onMapChanged:function(t,e){if(Je.TexturePool.useTexture(e),Je.TexturePool.unUseTexture(t),e){var i=e.getUniqueCode();null==Je.TexturePool.getTexture(i)&&Je.TexturePool.setTexture(i,e)}},setType:function(t){if(this._type!==t){var e=this._type;this._type=t,this.firePropertyChange("type",e,t),this.onTypeChanged(e,t)}},onTypeChanged:function(){},getType:function(){return this._type},setStyle:function(t,e){if(null!=t){null==this.styleMap&&(this.styleMap={});var i=this.styleMap[t];return null==e?delete this.styleMap[t]:this.styleMap[t]=e,this.firePropertyChange(Je.Styles.PREFIX_STYLE+t,i,e),this.onStyleChanged(t,i,e),this}},getStyle:function(t,e){null==e&&(e=!0);var i;return null!=this.styleMap&&(i=this.styleMap[t]),null==i&&e&&(i=Je.Styles.getStyle(t)),i},clone:function(t){return t=t||new Je.EntityMaterial,Je.Material.prototype.clone.call(this,t),t._type=this._type,t.color.copy(this.color),t.setMap(this.map,"map"),t.setMap(this.map1,"map1"),t.setMap(this.map2,"map2"),t.setMap(this.blendMap,"blendMap"),t.setMap(this.normalMap,"normalMap"),t.setMap(this.specularMap,"specularMap"),t.setMap(this.envMap,"envMap"),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.specular.copy(this.specular),t.shininess=this.shininess,t.metal=this.metal,t.perPixel=this.perPixel,t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.setMap(this.lightMap,"lightMap"),t.bumpMap=this.bumpMap,t.bumpScale=this.bumpScale,t.normalScale.copy(this.normalScale),t.combine=this.combine,t.reflectRatio=this.reflectRatio,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t.specularStrength=this.specularStrength,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.blendRange.copy(this.blendRange),t},refreshUniformsSpecific:function(t){var e=this.uniforms;"lambert"===this._type?(t?(e.ambient.value.copyGammaToLinear(this.ambient),e.emissive.value.copyGammaToLinear(this.emissive)):(e.ambient.value=this.ambient,e.emissive.value=this.emissive),this.wrapAround&&e.wrapRGB.value.copy(this.wrapRGB)):"phong"===this._type&&(e.shininess.value=this.shininess,t?(e.ambient.value.copyGammaToLinear(this.alarmColor?this.alarmColor:this.ambient),e.emissive.value.copyGammaToLinear(this.emissive),e.specular.value.copyGammaToLinear(this.specular)):(e.ambient.value=this.alarmColor?this.alarmColor:this.ambient,e.emissive.value=this.emissive,e.specular.value=this.specular),e.uspecularStrength.value=this.specularStrength,this.wrapAround&&e.wrapRGB.value.copy(this.wrapRGB))},refreshUniformsCommon:function(t){if("terrain"===this._type){var e=this.uniforms;e.enableDiffuse1.value=this.map?1:0,e.tDiffuse1.value=this.map,e.enableDiffuse2.value=this.map1?1:0,e.tDiffuse2.value=this.map1,e.enableDiffuse3.value=this.map2?1:0,e.tDiffuse3.value=this.map2,e.enableDisplacement.value=this.blendMap?1:0,e.tDisplacement.value=this.blendMap,e.uRepeatOverlay.value=this.repeat,null==this.blendRangeArray&&(this.blendRangeArray=[0,1]),this.blendRangeArray[0]=this.blendRange.x,this.blendRangeArray[1]=this.blendRange.y,e.blendRange.value=this.blendRangeArray}else if("outline"===this._type){var e=this.uniforms;e.diffuse.value=this.color,e.outline_offset.value=this.outline}else Je.Material.prototype.refreshUniformsCommon.call(this,t)}}),Je.BlurMaterial=function(){Je.Material.call(this),this.orientation=0,this.blurAmount=5,this.blurScale=1,this.blurStrength=1,this.useBlur=1,this.texelSize=new Qe(512,512),this.blurGlobalAlpha=1},Je.extend(Je.BlurMaterial,Je.Material,{refreshUniformsCommon:function(t){var e=this.uniforms;e.map.value=this.map,e.orientation.value=this.orientation,e.blurAmount.value=this.blurAmount,e.blurScale.value=this.blurScale,e.blurStrength.value=this.blurStrength,e.useBlur.value=this.useBlur,e.texelSize.value=this.texelSize,e.blurGlobalAlpha.value=this.blurGlobalAlpha},getShaderID:function(){return"blur"}}),Je.DeferredMaterial=function(t){t=t||{},Je.Material.call(this,t),this.linearDepth=30,this.isNormal=t.isNormal!==e?t.isNormal:0},Je.extend(Je.DeferredMaterial,Je.Material,{getShaderID:function(){return"deferred"},refreshUniformsCommon:function(t){var e=this.uniforms;e.linearDepth.value=this.linearDepth,e.isNormal.value=this.isNormal}}),Je.SSAOMaterial=function(t){Je.Material.call(this),this.map1=null,this.map2=null,this.occluderBias=.05,this.samplingRadius=20,this.attenuation=new Qe(1,.02),this.texelSize=new Qe(1/512,1/512)},Je.extend(Je.SSAOMaterial,Je.Material,{getShaderID:function(){return"ssao"},refreshUniformsCommon:function(t){var e=this.uniforms;e.map0.value=this.map,e.map1.value=this.map1,e.map2.value=this.map2,e.occluderBias.value=this.occluderBias,e.samplingRadius.value=this.samplingRadius,e.attenuation.value=this.attenuation,e.texelSize.value=this.texelSize}}),Je.BasicMaterial=function(t){Je.Material.call(this),this._type="basic",this.color=new Je.Color(16777215),this.map=null,this.setValues(t),this.offset=new Qe(0,0),this.repeat=new Qe(1,1)},Je.extend(Je.BasicMaterial,Je.Material,{getShaderID:function(){return"basic"},clone:function(){var t=new Je.BasicMaterial;return Je.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t},getUniqueCode:function(){var t=this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return t+=this.repeat.x+" "+this.repeat.y+this.offset.x+" "+this.offset.y,this.map&&(t+=this.map.getUniqueCode()),t}}),Je.LambertMaterial=function(t){Je.Material.call(this),this._type="basic",this.color=new Je.Color(16777215),this.ambient=new Je.Color(16777215),this.emissive=new Je.Color(0),this.wrapAround=!1,this.wrapRGB=new Je.Vec3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=Je.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=Je.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=Je.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)},Je.extend(Je.LambertMaterial,Je.Material,{clone:function(){var t=new Je.LambertMaterial;return Je.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.map=this.map,t.lightMap=this.lightMap,t.specularMap=this.specularMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},getShaderID:function(){return"lambert"},refreshUniformsSpecific:function(t){var e=this.uniforms;t?(e.ambient.value.copyGammaToLinear(this.ambient),e.emissive.value.copyGammaToLinear(this.emissive)):(e.ambient.value=this.ambient,e.emissive.value=this.emissive),this.wrapAround&&e.wrapRGB.value.copy(this.wrapRGB)}}),Je.PhongMaterial=function(t){Je.Material.call(this),this._type="basic",this.color=new Je.Color(16777215),this.ambient=new Je.Color(16777215),this.emissive=new Je.Color(0),this.specular=new Je.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new Je.Vec3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Je.Vec2(1,1),this.specularMap=null,this.envMap=null,this.combine=Je.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=Je.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=Je.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t),this.offset=new Qe(0,0),this.repeat=new Qe(1,1)},Je.extend(Je.PhongMaterial,Je.Material,{getUniqueCode:function(){var t="phong "+this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return t+=this.repeat.x+" "+this.repeat.y+this.offset.x+" "+this.offset.y,this.map&&(t+=this.map.getUniqueCode()),t},clone:function(){var t=new Je.PhongMaterial;return Je.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.specular.copy(this.specular),t.shininess=this.shininess,t.metal=this.metal,t.perPixel=this.perPixel,t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.map=this.map,t.lightMap=this.lightMap,t.bumpMap=this.bumpMap,t.bumpScale=this.bumpScale,t.normalMap=this.normalMap,t.normalScale.copy(this.normalScale),t.specularMap=this.specularMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},getShaderID:function(){return"phong"},refreshUniformsSpecific:function(t){var e=this.uniforms;e.shininess.value=this.shininess,t?(e.ambient.value.copyGammaToLinear(this.ambient),e.emissive.value.copyGammaToLinear(this.emissive),e.specular.value.copyGammaToLinear(this.specular)):(e.ambient.value=this.ambient,e.emissive.value=this.emissive,e.specular.value=this.specular),this.wrapAround&&e.wrapRGB.value.copy(material.wrapRGB)}}),Je.LineMaterial=function(t){Je.Material.call(this),this.color=new Je.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.dashed=!0,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(t)},Je.extend(Je.LineMaterial,Je.Material,{getUniqueCode:function(){return this.color.getUniqueCode+" "+this.linewidth+" "+this.dashed},clone:function(){var t=new Je.LineMaterial;return Je.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.linewidth=this.linewidth,t.linecap=this.linecap,t.linejoin=this.linejoin,t.dashed=this.dashed,t.scale=this.scale,t.dashSize=this.dashSize,t.gapSize=this.gapSize,t.vertexColors=this.vertexColors,t.fog=this.fog,t},getShaderID:function(){return this.dashed?"dashed":"basic"},refreshUniforms:function(t){Re(this.uniforms,this),this.dashed&&Fe(this.uniforms,this)}}),Je.ArrayMaterial=function(t){this.materials=t||[]},Je.extend(Je.ArrayMaterial,Object,{clone:function(){for(var t=new Je.ArrayMaterial,e=0;e<this.materials.length;e++){var i=this.materials[e],r=this.materials.indexOf(i);null!=t.materials[r]?t.materials.push(t.materials[r]):t.materials.push(i.clone())}return t}}),Je.BillboardMaterial=function(t){Je.Material.call(this),this.alignment=Je.BillboardAlignment.center.clone(),this.fog=!1,this.color=new Je.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.offset=new Je.Vec2(0,0),this.repeat=new Je.Vec2(1,1),this.transparent=!0,this.setValues(t),this.depthMask=!0,this.vertical=!1,this.alphaTest=0},Je.extend(Je.BillboardMaterial,Je.Material,{clone:function(t){return t=t?t:new Je.BillboardMaterial,Je.Material.prototype.clone.call(this,t),t.alignment.copy(this.alignment),t.color.copy(this.color),t.map=this.map,t.rotation=this.rotation,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.fog=this.fog,t.vertical=this.vertical,t.transparent=this.transparent,t.alphaTest=this.alphaTest,t},getUniqueCode:function(){var t="Billboard "+this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return t+=this.vertical+" "+this.alphaTest+" "+this.alignment.x+" "+this.alignment.y,t+=this.repeat.x+" "+this.repeat.y,t+=this.offset.x+" "+this.offset.y,this.map&&(t+=this.map.getUniqueCode()),t}}),Je.BillboardAlignment={},Je.BillboardAlignment.topLeft=new Je.Vec2(.5,(-.5)),Je.BillboardAlignment.topCenter=new Je.Vec2(0,(-.5)),Je.BillboardAlignment.topRight=new Je.Vec2((-.5),(-.5)),Je.BillboardAlignment.centerLeft=new Je.Vec2(.5,0),Je.BillboardAlignment.center=new Je.Vec2(0,0),Je.BillboardAlignment.centerRight=new Je.Vec2((-.5),0),Je.BillboardAlignment.bottomLeft=new Je.Vec2(.5,.5),Je.BillboardAlignment.bottomCenter=new Je.Vec2(0,.5),Je.BillboardAlignment.bottomRight=new Je.Vec2((-.5),.5);var Qi=function(t){Je.Material.call(this),this.fragmentShader="void main() {}",this.vertexShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shaderID=t.shaderID||"depth",this._type="shader",this.shading=Je.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=Je.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName="position",this.setValues(t)};Je.ShaderMaterial=Qi,Je.extend(Je.ShaderMaterial,Je.Material,{clone:function(){var t=new Je.ShaderMaterial;return Je.Material.prototype.clone.call(this,t),t.fragmentShader=this.fragmentShader,t.vertexShader=this.vertexShader,t.uniforms=Je.UniformsUtils.clone(this.uniforms),t.attributes=this.attributes,t.defines=this.defines,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.fog=this.fog,t.lights=this.lights,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},needUV:function(){return!0},getShaderID:function(){return null},refreshUniformsCommon:function(t,e){}}),Je.TransformGizmoMaterial=function(t){Je.BasicMaterial.call(this),this.depthTest=!1,this.depthMask=!1,this.side=Je.DoubleSide,this.transparent=!0,this.setValues(t)},Je.extend(Je.TransformGizmoMaterial,Je.BasicMaterial,{getUniqueCode:function(){var t=this.id+"TransformGizmo "+this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return this.map&&(t+=this.map.getUniqueCode()),t}});var Ki={pools:{},useTimes:{},size:0,getMaterial:function(t){return Ki.pools[t]},setMaterial:function(t,e){Ki.size++,Ki.pools[t]=e},useMaterial:function(t){if(t){var e=t.id,i=Ki.useTimes[e]||0;i++,Ki.useTimes[e]=i}},unUseMaterial:function(t){if(t){var e=t.id,i=Ki.useTimes[e]||0;if(i--,Ki.useTimes[e]=i,i<=0){var r=t.getUniqueCode();delete Ki.pools[r],Ki.size--,t.dispose()}}}};Je.MaterialPool=Ki,Ki.DefaultMaterial=new Je.EntityMaterial,Ki.TestMaterial=new Je.EntityMaterial,Ki.DefaultBillBoardMaterial=new Je.BillboardMaterial,Ki.DefaultLineMaterial=new Je.LineMaterial;Je.ParticleMaterial=function(t){Je.Material.call(this),this.color=new Je.Color(16777215),this.map=null,this.size=2,this.sizeAttenuation=!1,this.vertexColors=!1,this.fog=!0,this.setValues(t)},Je.extend(Je.ParticleMaterial,Je.Material,{clone:function(){var t=new Je.ParticleMaterial;return Je.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.size=this.size,t.sizeAttenuation=this.sizeAttenuation,t.vertexColors=this.vertexColors,t.fog=this.fog,t},getShaderID:function(){return this.shaderID="particle_basic",this.shaderID},refreshUniforms:function(t){Ie(this.uniforms,this)}}),Je.Light=function(t,e){Je.Element.call(this,e),this.color=new Je.Color(t),this.ambient=new Je.Color,this.diffuse=new Je.Color,this.specular=new Je.Color,this.castShadow=!1,this.onlyShadow=!1},Je.extend(Je.Light,Je.Element,{__accessor:["color","ambient","diffuse","specular"],constructor:Je.Light,className:"TGL.Light",setCastShadow:function(t){this.castShadow=t},setOnlyShadow:function(t){this.onlyShadow=t},refreshShadowUniforms:function(t,e){var i=this;if(t.shadowMatrix&&i.castShadow&&(i instanceof Je.SpotLight||i instanceof Je.DirectionalLight&&!i.shadowCascade))return t.shadowMap.value[e]=i.shadowMap,t.shadowMapSize.value[e]=i.shadowMapSize,t.shadowMatrix.value[e]=i.shadowMatrix,t.shadowDarkness.value[e]=i.shadowDarkness,t.shadowBias.value[e]=i.shadowBias,!0},refreshUniformsPointShadow:function(t,e){var i=this;if(t.pShadowMap&&i.castShadow&&i instanceof Je.PointLight)return t.pShadowMap.value[e]=i.shadowMap,t.pShadowMapSize.value[e]=i.shadowMapSize,t.pShadowDarkness.value[e]=i.shadowDarkness||.5,t.pPosition.value[e]=i.getPosition(),!0}}),Je.PositionLight=function(){},Je.PointLight=function(t,i,r,a){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var n=arguments[0];t=n.hex,i=n.intensity,r=n.intensity,a=n.id}Je.Light.call(this,t,a),this.position=new Je.Vec3(0,0,0),this.intensity=i!==e?i:1,this.distance=r!==e?r:0,this.shadowCameraNear=10,this.shadowCameraFar=1e4,this.shadowMapWidth=512,this.shadowMapHeight=512},Je.extend(Je.PointLight,Je.Light,{constructor:Je.PointLight,className:"TGL.PointLight",__accessor:["intensity","distance"]}),Je.SpotLight=function(t,i,r,a,n){Je.Light.call(this,t),this._position=new Je.Vec3(0,1,0),this.target=new Je.Element,this.intensity=i!==e?i:1,this.distance=r!==e?r:0,this.angle=a!==e?a:Math.PI/2,this.exponent=n!==e?n:10,this.shadowCameraNear=100,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},Je.extend(Je.SpotLight,Je.Light,{__accessor:["color","ambient","diffuse","specular","intensity","distance","angle","exponent"],constructor:Je.SpotLight,className:"TGL.SpotLight"}),Je.DirectionalLight=function(t,i,r){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var a=arguments[0];t=a.hex,i=a.intensity,r=a.id}Je.Light.call(this,t,r),this.direction=new Je.Vec3(0,1,0),this.position=new Je.Vec3(0,1,0),this.target=new Je.Element,this.intensity=i!==e?i:1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new Je.Vec3(0,0,(-1e3)),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},Je.extend(Je.DirectionalLight,Je.Light,{className:"TGL.DirectionalLight"}),Je.AmbientLight=function(t,e){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var i=arguments[0];t=i.hex,e=i.id}Je.Light.call(this,t,e)},Je.extend(Je.AmbientLight,Je.Light,{constructor:Je.AmbientLight,className:"TGL.AmbientLight",clone:function(){var t=new Je.AmbientLight;return Je.Light.prototype.clone.call(this,t),t}}),Je.Camera=function(){Je.Element.call(this),this.projectionMatrix=new Je.Mat4,this.projectionMatrixInverse=new Je.Mat4,this.worldMatrixInverse=new Je.Mat4,this.target=new Je.Vec3,this.setPosition(0,0,500),this.lookat=this.lookAt},Je.extend(Je.Camera,Je.Element,{constructor:Je.Camera,updateCameraMatrix:function(t){var e=this.matrix.clone();this.matrix.lookAt(this._position,this.target,this.up),this.rotationAutoUpdate&&this._rotation.setEulerFromRotationMatrix(this.matrix),!e.equals(this.matrix)&&t&&this.firePropertyChange("matrix",e,this.matrix)},lookAt:function(t,i){3===arguments.length&&t.x===e?(t=new mono.Vec3(arguments[0],arguments[1],arguments[2]),i=e):4===arguments.length&&t.x===e&&(t=new mono.Vec3(arguments[0],arguments[1],arguments[2]),i=arguments[4]),i===e&&(i=!0),this.target=t,this.updateCameraMatrix(i)},look:function(t){3===arguments.length&&t.x===e&&(t=new mono.Vec3(arguments[0],arguments[1],arguments[2])),this.lookAt(t,!0)},onUpChanged:function(t,e){this.updateCameraMatrix()},getTarget:function(){return this.target},t:function(){return this.getTarget()},getDistance:function(){return(new Ke).subVectors(this._position,this.target).length()},setDistance:function(t){var e=this.getDistance();this.zoom(t/e)},lookAtElement:function(t,e,i){e instanceof Ke?(i=e,e=this.getDistance()):i=i||new Ke(0,0,1),t instanceof Je.Element&&(e=e?e:this.getDistance(),this.setPosition(t.worldPosition(i,e)),this.look(t.getWorldPosition()))},zoomOut:function(t){this.zoom(1.1,t)},zoomIn:function(t){this.zoom(.9,t)},zoom:function(t,e){if(t>0){var i=e||this.getDistance();i*=t;var r=(new Ke).addVectors(this.target,(new Ke).subVectors(this._position,this.target).setLength(i));this.setPosition(r)}}}),Je.OrthoCamera=function(t,e,i,r){Je.Camera.call(this),this.width=t||1,this.aspect=e||1,this.near=i||.1,this.far=r||1e4,this.updateProjectionMatrix()},Je.extend(Je.OrthoCamera,Je.Camera,{constructor:Je.OrthoCamera,className:"TGL.OrthoCamera",__accessor:["width","aspect","near","far"],updateProjectionMatrix:function(){var t=this.getDistance(),e=t*this.width/2,i=-e,r=t/this.aspect*this.width/2,a=-r;this.projectionMatrix.makeOrthographic(i,e,r,a,this.near,this.far)},onPropertyChange:function(){this.updateProjectionMatrix()},updateCameraMatrix:function(t){Je.Camera.prototype.updateCameraMatrix.call(this,t),this.updateProjectionMatrix()}}),Je.PerspectiveCamera=function(t,i,r,a){Je.Camera.call(this),this.fov=t!==e?t:50,this.aspect=i!==e?i:1,this.near=r!==e?r:1,this.far=a!==e?a:5e4,this.updateProjectionMatrix()},Je.extend(Je.PerspectiveCamera,Je.Camera,{constructor:Je.PerspectiveCamera,className:"TGL.PerspectiveCamera",__accessor:["fov","aspect","near","far"],updateProjectionMatrix:function(){this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},onPropertyChange:function(){this.updateProjectionMatrix()}}),Je.CameraHelper=function(t){function i(t,e,i){r(t,i),r(e,i)}function r(t,i){a.vertices.push(new Je.Vec3),a.colors.push(new Je.Color(i)),s[t]===e&&(s[t]=[]),s[t].push(a.vertices.length-1)}var a=new Je.Entity,n=new Je.LineMaterial({color:16777215,vertexColors:Je.FaceColors}),s={},o=16755200,l=16711680,h=43775,c=16777215,u=3355443;i("n1","n2",o),i("n2","n4",o),i("n4","n3",o),i("n3","n1",o),i("f1","f2",o),i("f2","f4",o),i("f4","f3",o),i("f3","f1",o),i("n1","f1",o),i("n2","f2",o),i("n3","f3",o),i("n4","f4",o),i("p","n1",l),i("p","n2",l),i("p","n3",l),i("p","n4",l),i("u1","u2",h),i("u2","u3",h),i("u3","u1",h),i("c","t",c),i("p","c",u),i("cn1","cn2",u),i("cn3","cn4",u),i("cf1","cf2",u),i("cf3","cf4",u),Je.Line.call(this,a.vertices,a.colors,n,Je.LinePieces),this.camera=t,this.worldMatrix=t.worldMatrix,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()},Je.CameraHelper.prototype=Object.create(Je.Line.prototype),Je.CameraHelper.prototype.update=function(){var t=new Je.Vec3,i=new Je.Camera,r=new Je.Projector;return function(){function a(a,s,o,l){t.set(s,o,l),r.unprojectVector(t,i);var h=n.pointMap[a];if(h!==e)for(var c=0,u=h.length;c<u;c++)n.vertices[h[c]].copy(t)}var n=this,s=1,o=1;i.projectionMatrix.copy(this.camera.projectionMatrix),a("c",0,0,-1),a("t",0,0,1),a("n1",-s,-o,-1),a("n2",s,-o,-1),a("n3",-s,o,-1),a("n4",s,o,-1),a("f1",-s,-o,1),a("f2",s,-o,1),a("f3",-s,o,1),a("f4",s,o,1),a("u1",.7*s,1.1*o,-1),a("u2",.7*-s,1.1*o,-1),a("u3",0,2*o,-1),a("cf1",-s,0,1),a("cf2",s,0,1),a("cf3",0,-o,1),a("cf4",0,o,1),a("cn1",-s,0,-1),a("cn2",s,0,-1),a("cn3",0,-o,-1),a("cn4",0,o,-1),this.verticesNeedUpdate=!0}}();var $i=function(){Je.Element.call(this)};$i.prototype=Object.create(Je.Element.prototype),$i.prototype.updateworldMatrix=function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||t)&&(this._parent?(this.worldMatrix.multiplyMatrices(this._parent.worldMatrix,this.matrix),this.worldMatrix.decompose(this.translationWorld,this.QuatWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.QuatObject,this.scaleObject),this.worldMatrix.compose(this.translationWorld,this.QuatObject,this.scaleWorld)):this.worldMatrix.copy(this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0);for(var e=0,i=this.getChildren().size();e<i;e++)this.getChildren().get(e).updateworldMatrix(t)},$i.prototype.translationWorld=new Je.Vec3,$i.prototype.translationObject=new Je.Vec3,$i.prototype.QuatWorld=new Je.Quat,$i.prototype.QuatObject=new Je.Quat,$i.prototype.scaleWorld=new Je.Vec3,$i.prototype.scaleObject=new Je.Vec3;var tr=function(){function t(t,e){var i=new Je.DirectionalLight;i.isVirtual=!0,i.onlyShadow=!0,i.castShadow=!0,i.shadowCameraNear=t.shadowCameraNear,i.shadowCameraFar=t.shadowCameraFar,i.shadowCameraLeft=t.shadowCameraLeft,i.shadowCameraRight=t.shadowCameraRight,i.shadowCameraBottom=t.shadowCameraBottom,i.shadowCameraTop=t.shadowCameraTop,i.shadowCameraVisible=t.shadowCameraVisible,i.shadowDarkness=t.shadowDarkness,i.shadowBias=t.shadowCascadeBias[e],i.shadowMapWidth=t.shadowCascadeWidth[e],i.shadowMapHeight=t.shadowCascadeHeight[e],i.pointsWorld=[],i.pointsFrustum=[];for(var r=i.pointsWorld,a=i.pointsFrustum,n=0;n<8;n++)r[n]=new Je.Vec3,a[n]=new Je.Vec3;var s=t.shadowCascadeNearZ[e],o=t.shadowCascadeFarZ[e];return a[0].set(-1,-1,s),a[1].set(1,-1,s),a[2].set(-1,1,s),a[3].set(1,1,s),a[4].set(-1,-1,o),a[5].set(1,-1,o),a[6].set(-1,1,o),a[7].set(1,1,o),i}function i(t,e){var i=t.shadowCascadeArray[e];i.position.copy(t.position),i.target.position.copy(t.target.position),i.lookAt(i.target),i.shadowCameraVisible=t.shadowCameraVisible,i.shadowDarkness=t.shadowDarkness,i.shadowBias=t.shadowCascadeBias[e];var r=t.shadowCascadeNearZ[e],a=t.shadowCascadeFarZ[e],n=i.pointsFrustum;n[0].z=r,n[1].z=r,n[2].z=r,n[3].z=r,n[4].z=a,n[5].z=a,n[6].z=a,n[7].z=a}function r(t,e){var i=e.shadowCamera,r=e.pointsFrustum,a=e.pointsWorld;d.set(1/0,1/0,1/0),p.set(-(1/0),-(1/0),-(1/0));for(var n=0;n<8;n++){var s=a[n];s.copy(r[n]),tr.__projector.unprojectVector(s,t),s.applyMatrix4(i.worldMatrixInverse),s.x<d.x&&(d.x=s.x),s.x>p.x&&(p.x=s.x),s.y<d.y&&(d.y=s.y),s.y>p.y&&(p.y=s.y),s.z<d.z&&(d.z=s.z),s.z>p.z&&(p.z=s.z)}i.left=d.x,i.right=p.x,i.top=p.y,i.bottom=d.y,i.updateProjectionMatrix()}function a(t){return t.material instanceof Je.ArrayMaterial?t.material.materials[0]:t.material}var n,s,o,l,h,c,u=new Je.Frustum,f=new Je.Mat4,d=new Je.Vec3,p=new Je.Vec3,m=new Je.Vec3;this.init=function(t){n=t._gl,s=t;var e=Je.ShaderLib.depthRGBA,i=Je.UniformsUtils.clone(e.uniforms);o=new Qi({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:i}),_depthCubeMaterial=new Qi({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:i,refreshUniformsCommon:function(t){this.uniforms.isCube.value=1}}),l=new Qi({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:i,morphTargets:!0}),h=new Qi({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:i,skinning:!0}),c=new Qi({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:i,morphTargets:!0,skinning:!0}),o._shadowPass=!0,l._shadowPass=!0,h._shadowPass=!0,c._shadowPass=!0},this.render=function(t,e){s._shadowMapEnable&&this.update(t,e)},this.update=function(d,p){var g,y,v,x,w,_,b,M,S,A,P,T,C,z,L=[],E=0;n.clearColor(1,1,1,1),n.disable(n.BLEND),n.enable(n.CULL_FACE),n.frontFace(n.CCW),s.shadowMapCullFace===Je.CullFaceFront?n.cullFace(n.FRONT):n.cullFace(n.BACK),s.setDepthTest(!0);var D=d.getLights();for(g=0,y=D.size();g<y;g++)if(C=D.get(g),C.castShadow)if(C instanceof Je.DirectionalLight&&C.shadowCascade)for(w=0;w<C.shadowCascadeCount;w++){var N;if(C.shadowCascadeArray[w])N=C.shadowCascadeArray[w];else{N=t(C,w),N.originalCamera=p;var B=new $i;B.position=C.shadowCascadeOffset,B.add(N),B.add(N.target),p.add(B),C.shadowCascadeArray[w]=N}i(C,w),L[E]=N,E++}else L[E]=C,E++;for(g=0,y=L.length;g<y;g++){if(C=L[g],!C.shadowMap){var R=Je.LinearFilter;s.shadowMapType===Je.PCFSoftShadowMap&&(R=Je.NearestFilter);var F={minFilter:R,magFilter:R,format:Je.RGBAFormat};C instanceof Je.PointLight?(C.shadowMap=new Si(C.shadowMapWidth,C.shadowMapHeight,F),C.shadowMapSize=new Qe(C.shadowMapWidth,C.shadowMapHeight),C.shadowMatrix=new Je.Mat4):(C.shadowMap=new Mi(C.shadowMapWidth,C.shadowMapHeight,F),C.shadowMapSize=new Qe(C.shadowMapWidth,C.shadowMapHeight),C.shadowMatrix=new Je.Mat4)}if(!C.shadowCamera){if(C instanceof Je.SpotLight)C.shadowCamera=new Je.PerspectiveCamera(C.shadowCameraFov,C.shadowMapWidth/C.shadowMapHeight,C.shadowCameraNear,C.shadowCameraFar);else if(C instanceof Je.DirectionalLight)C.shadowCamera=new Je.OrthoCamera(C.shadowCameraLeft,C.shadowCameraRight,C.shadowCameraTop,C.shadowCameraBottom,C.shadowCameraNear,C.shadowCameraFar);else{if(!(C instanceof Je.PointLight)){console.error("Unsupported light type for shadow");continue}C.shadowCamera=new Je.PerspectiveCamera(90,1,C.shadowCameraNear,C.shadowCameraFar)}C.shadowCamera.updateWorldMatrix();for(var I,k=d.getRoots(),V=k.size(),O=0;O<V;O++)I=k.get(O),I.updateWorldMatrix()}C.shadowCameraVisible&&!C.cameraHelper&&(C.cameraHelper=new Je.CameraHelper(C.shadowCamera),C.shadowCamera.addChild(C.cameraHelper),C.shadowCamera.updateWorldMatrix(!0),s.helperBox.add(C.shadowCamera),s.helperBox.add(C.cameraHelper)),C.isVirtual&&N.originalCamera==p&&r(p,C);for(var U=C instanceof Je.PointLight?6:1,G=[new Ke(1,0,0),new Ke((-1),0,0),new Ke(0,1,0),new Ke(0,(-1),0),new Ke(0,0,1),new Ke(0,0,(-1))],E=0;E<U;E++)if(null==C.debugFace||E==C.debugFace){for(_=C.shadowMap,b=C.shadowMatrix,M=C.shadowCamera,M._position.setFromMatrixPosition(C.worldMatrix),C.target?m.setFromMatrixPosition(C.target.worldMatrix):m=M._position.clone().add(G[E]),M.lookAt(m),M.updateWorldMatrix(!0),M.worldMatrixInverse.getInverse(M.worldMatrix),C.cameraHelper&&(C.cameraHelper.visible=C.shadowCameraVisible),C.shadowCameraVisible&&C.cameraHelper.update(),b.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),b.multiply(M.projectionMatrix),b.multiply(M.worldMatrixInverse),f.multiplyMatrices(M.projectionMatrix,M.worldMatrixInverse),u.setFromMatrix(f),_.activeCubeFace=E,s.debugPointLight==e&&s.setRenderTarget(_),s.clear(),z=s.glNodeList,v=0,x=z.length;v<x;v++)P=z[v],T=P.node,P.render=!1,T._visible&&T.castShadow&&(!(T instanceof Je.Node||T instanceof Je.Particle)||!T.frustumCulled||u.intersectsObject(T))&&(T._modelViewMatrix.multiplyMatrices(M.worldMatrixInverse,T.worldMatrix),P.render=!0);var H,j,X;for(v=0,x=z.length;v<x;v++)P=z[v],P.render&&(T=P.node,S=P.group,H=a(T),j=!1,X=!1,A=T.customDepthMaterial?T.customDepthMaterial:X?j?c:h:j?l:1==U?o:_depthCubeMaterial,T instanceof Je.BufferNode||s.renderGroup(M,d.getLights(),A,S,T))}}var W=s.getClearColor(),Y=s.getClearAlpha();n.clearColor(W.r,W.g,W.b,Y),
n.enable(n.BLEND),s.shadowMapCullFace===Je.CullFaceFront&&n.cullFace(n.BACK)}};tr.__projector=new Je.Projector,Je.Picking=function(t,e,i,r,a,n){this.network=n,this.origin=t,this.cameraUp=i,this.direction=e,this.near=r||0,this.far=a||1/0,this.ray=new Je.Ray(t,e),this.ray.direction.length>0&&this.ray.direction.normalize()},Je.Picking.testPlane=new Je.Plane(1,1),Je.Picking.prototype={constructor:Je.Picking,precision:1e-4,linePrecision:2,matrixPosition:new Je.Vec3,set:function(t,e){this.origin=t,this.direction=e,this.ray.set(t,e),this.ray.direction.length>0&&this.ray.direction.normalize()},intersectObject:function(t,e,i){var r=[];return e===!0&&Oe(t,this,r,i),Ve(t,this,r,i),r.sort(ke),r},intersectObjects:function(t,e,i){t._as&&(t=t._as);for(var r=[],a=0,n=t.length;a<n;a++)Ve(t[a],this,r,i,this.network),e===!0&&Oe(t[a],this,r,i,this.network);return r.sort(ke),r}};var er=new Je.Ray,ir=new Je.Mat4,rr=new Je.math.Plane,ar=new Je.Vec3,nr=new Je.BoundingSphere,sr=function(t){arguments.length>0&&this.init(t)};sr.prototype.init=function(t){this.status=t,this.points=new Array},sr.prototype.appendPoint=function(t){this.points.push(t)},sr.prototype.appendPoints=function(t){this.points=this.points.concat(t)},sr.intersectShapes=function(t,e){var i,r=t.getIntersectionParams(),a=e.getIntersectionParams();if(null!=r&&null!=a)if("Path"==r.name)i=sr.intersectPathShape(t,e);else if("Path"==a.name)i=sr.intersectPathShape(e,t);else{var n,s;if(r.name<a.name?(n="intersect"+r.name+a.name,s=r.params.concat(a.params)):(n="intersect"+a.name+r.name,s=a.params.concat(r.params)),!(n in sr))throw new Error("Intersection not available: "+n);i=sr[n].apply(null,s)}else i=new sr("No Intersection");return i},sr.intersectPathShape=function(t,e){return t.intersectShape(e)},sr.intersectBezier2Bezier2=function(t,e,i,r,a,n){var s,o,l,h,c,u,f,d,p,m=new sr("No Intersection");if(s=e.multiply(-2),l=t.add(s.add(i)),s=t.multiply(-2),o=e.multiply(2),h=s.add(o),c=new Qe(t.x,t.y),s=a.multiply(-2),u=r.add(s.add(n)),s=r.multiply(-2),o=a.multiply(2),f=s.add(o),d=new Qe(r.x,r.y),0==l.y){var g=l.x*(c.y-d.y),y=g-h.x*h.y,v=g+y,x=h.y*h.y;p=new Polynomial(l.x*u.y*u.y,2*l.x*f.y*u.y,l.x*f.y*f.y-u.x*x-u.y*g-u.y*y,-f.x*x-f.y*g-f.y*y,(c.x-d.x)*x+(c.y-d.y)*y)}else{var g=l.x*u.y-l.y*u.x,y=l.x*f.y-f.x*l.y,v=h.x*l.y-h.y*l.x,x=c.y-d.y,w=l.y*(c.x-d.x)-l.x*x,_=-h.y*v+l.y*w,b=v*v;p=new Polynomial(g*g,2*g*y,(-u.y*b+l.y*y*y+l.y*g*w+g*_)/l.y,(-f.y*b+l.y*y*w+y*_)/l.y,(x*b+w*_)/l.y)}for(var M=p.getRoots(),S=0;S<M.length;S++){var A=M[S];if(0<=A&&A<=1){var P=new Polynomial(l.x,h.x,c.x-d.x-A*f.x-A*A*u.x).getRoots(),T=new Polynomial(l.y,h.y,c.y-d.y-A*f.y-A*A*u.y).getRoots();if(P.length>0&&T.length>0){var C=1e-4;t:for(var z=0;z<P.length;z++){var L=P[z];if(0<=L&&L<=1)for(var E=0;E<T.length;E++)if(Math.abs(L-T[E])<C){m.points.push(u.multiply(A*A).add(f.multiply(A).add(d)));break t}}}}}return m.points.length>0&&(m.status="$Intersection"),m},sr.intersectBezier2Bezier3=function(t,e,i,r,a,n,s){var o,l,h,c,u,f,d,p,m,g,y,v=new sr("No Intersection");o=e.multiply(-2),u=t.add(o.add(i)),o=t.multiply(-2),l=e.multiply(2),f=o.add(l),d=new Qe(t.x,t.y),o=r.multiply(-1),l=a.multiply(3),h=n.multiply(-3),c=o.add(l.add(h.add(s))),p=new Vector2D(c.x,c.y),o=r.multiply(3),l=a.multiply(-6),h=n.multiply(3),c=o.add(l.add(h)),m=new Vector2D(c.x,c.y),o=r.multiply(-3),l=a.multiply(3),h=o.add(l),g=new Vector2D(h.x,h.y),y=new Vector2D(r.x,r.y);for(var x=d.x*d.x,w=d.y*d.y,_=f.x*f.x,b=f.y*f.y,M=u.x*u.x,S=u.y*u.y,A=y.x*y.x,P=y.y*y.y,T=g.x*g.x,C=g.y*g.y,z=m.x*m.x,L=m.y*m.y,E=p.x*p.x,D=p.y*p.y,N=new Polynomial(-2*u.x*u.y*p.x*p.y+M*D+S*E,-2*u.x*u.y*m.x*p.y-2*u.x*u.y*m.y*p.x+2*S*m.x*p.x+2*M*m.y*p.y,-2*u.x*g.x*u.y*p.y-2*u.x*u.y*g.y*p.x-2*u.x*u.y*m.x*m.y+2*g.x*S*p.x+S*z+M*(2*g.y*p.y+L),2*d.x*u.x*u.y*p.y+2*d.y*u.x*u.y*p.x+f.x*f.y*u.x*p.y+f.x*f.y*u.y*p.x-2*y.x*u.x*u.y*p.y-2*u.x*y.y*u.y*p.x-2*u.x*g.x*u.y*m.y-2*u.x*u.y*g.y*m.x-2*d.x*S*p.x-2*d.y*M*p.y+2*y.x*S*p.x+2*g.x*S*m.x-b*u.x*p.x-_*u.y*p.y+M*(2*y.y*p.y+2*g.y*m.y),2*d.x*u.x*u.y*m.y+2*d.y*u.x*u.y*m.x+f.x*f.y*u.x*m.y+f.x*f.y*u.y*m.x-2*y.x*u.x*u.y*m.y-2*u.x*y.y*u.y*m.x-2*u.x*g.x*u.y*g.y-2*d.x*S*m.x-2*d.y*M*m.y+2*y.x*S*m.x-b*u.x*m.x-_*u.y*m.y+T*S+M*(2*y.y*m.y+C),2*d.x*u.x*u.y*g.y+2*d.y*u.x*g.x*u.y+f.x*f.y*u.x*g.y+f.x*f.y*g.x*u.y-2*y.x*u.x*u.y*g.y-2*u.x*y.y*g.x*u.y-2*d.x*g.x*S-2*d.y*M*g.y+2*y.x*g.x*S-b*u.x*g.x-_*u.y*g.y+2*M*y.y*g.y,-2*d.x*d.y*u.x*u.y-d.x*f.x*f.y*u.y-d.y*f.x*f.y*u.x+2*d.x*u.x*y.y*u.y+2*d.y*y.x*u.x*u.y+f.x*y.x*f.y*u.y+f.x*f.y*u.x*y.y-2*y.x*u.x*y.y*u.y-2*d.x*y.x*S+d.x*b*u.x+d.y*_*u.y-2*d.y*M*y.y-y.x*b*u.x-_*y.y*u.y+x*S+w*M+A*S+M*P),B=N.getRootsInInterval(0,1),R=0;R<B.length;R++){var F=B[R],I=new Polynomial(u.x,f.x,d.x-y.x-F*g.x-F*F*m.x-F*F*F*p.x).getRoots(),k=new Polynomial(u.y,f.y,d.y-y.y-F*g.y-F*F*m.y-F*F*F*p.y).getRoots();if(I.length>0&&k.length>0){var V=1e-4;t:for(var O=0;O<I.length;O++){var U=I[O];if(0<=U&&U<=1)for(var G=0;G<k.length;G++)if(Math.abs(U-k[G])<V){v.points.push(p.multiply(F*F*F).add(m.multiply(F*F).add(g.multiply(F).add(y))));break t}}}}return v.points.length>0&&(v.status="Intersection"),v},sr.intersectBezier2Circle=function(t,e,i,r,a){return sr.intersectBezier2Ellipse(t,e,i,r,a,a)},sr.intersectBezier2Ellipse=function(t,e,i,r,a,n){var s,o,l,h,c,u=new sr("No Intersection");s=e.multiply(-2),l=t.add(s.add(i)),s=t.multiply(-2),o=e.multiply(2),h=s.add(o),c=new Qe(t.x,t.y);for(var f=a*a,d=n*n,p=new Polynomial(d*l.x*l.x+f*l.y*l.y,2*(d*l.x*h.x+f*l.y*h.y),d*(2*l.x*c.x+h.x*h.x)+f*(2*l.y*c.y+h.y*h.y)-2*(d*r.x*l.x+f*r.y*l.y),2*(d*h.x*(c.x-r.x)+f*h.y*(c.y-r.y)),d*(c.x*c.x+r.x*r.x)+f*(c.y*c.y+r.y*r.y)-2*(d*r.x*c.x+f*r.y*c.y)-f*d).getRoots(),m=0;m<p.length;m++){var g=p[m];0<=g&&g<=1&&u.points.push(l.multiply(g*g).add(h.multiply(g).add(c)))}return u.points.length>0&&(u.status="Intersection"),u},sr.intersectBezier2Line=function(t,e,i,r,a){var n,s,o,l,h,c,u,f=r.min(a),d=r.max(a),p=new sr("No Intersection");n=e.multiply(-2),o=t.add(n.add(i)),n=t.multiply(-2),s=e.multiply(2),l=n.add(s),h=new Qe(t.x,t.y),u=new Vector2D(r.y-a.y,a.x-r.x),c=r.x*a.y-a.x*r.y,roots=new Polynomial(u.dot(o),u.dot(l),u.dot(h)+c).getRoots();for(var m=0;m<roots.length;m++){var g=roots[m];if(0<=g&&g<=1){var y=t.lerp(e,g),v=e.lerp(i,g),x=y.lerp(v,g);r.x==a.x?f.y<=x.y&&x.y<=d.y&&(p.status="Intersection",p.appendPoint(x)):r.y==a.y?f.x<=x.x&&x.x<=d.x&&(p.status="Intersection",p.appendPoint(x)):x.gte(f)&&x.lte(d)&&(p.status="Intersection",p.appendPoint(x))}}return p},sr.intersectBezier2Polygon=function(t,e,i,r){for(var a=new sr("No Intersection"),n=r.length,s=0;s<n;s++){var o=r[s],l=r[(s+1)%n],h=sr.intersectBezier2Line(t,e,i,o,l);a.appendPoints(h.points)}return a.points.length>0&&(a.status="Intersection"),a},sr.intersectBezier2Rectangle=function(t,e,i,r,a){var n=r.min(a),s=r.max(a),o=new Qe(s.x,n.y),l=new Qe(n.x,s.y),h=sr.intersectBezier2Line(t,e,i,n,o),c=sr.intersectBezier2Line(t,e,i,o,s),u=sr.intersectBezier2Line(t,e,i,s,l),f=sr.intersectBezier2Line(t,e,i,l,n),d=new sr("No Intersection");return d.appendPoints(h.points),d.appendPoints(c.points),d.appendPoints(u.points),d.appendPoints(f.points),d.points.length>0&&(d.status="Intersection"),d},sr.intersectBezier3Bezier3=function(t,e,i,r,a,n,s,o){var l,h,c,u,f,d,p,m,g,y,v,x,w=new sr("No Intersection");l=t.multiply(-1),h=e.multiply(3),c=i.multiply(-3),u=l.add(h.add(c.add(r))),f=new Vector2D(u.x,u.y),l=t.multiply(3),h=e.multiply(-6),c=i.multiply(3),u=l.add(h.add(c)),d=new Vector2D(u.x,u.y),l=t.multiply(-3),h=e.multiply(3),c=l.add(h),p=new Vector2D(c.x,c.y),m=new Vector2D(t.x,t.y),l=a.multiply(-1),h=n.multiply(3),c=s.multiply(-3),u=l.add(h.add(c.add(o))),g=new Vector2D(u.x,u.y),l=a.multiply(3),h=n.multiply(-6),c=s.multiply(3),u=l.add(h.add(c)),y=new Vector2D(u.x,u.y),l=a.multiply(-3),h=n.multiply(3),c=l.add(h),v=new Vector2D(c.x,c.y),x=new Vector2D(a.x,a.y);for(var _=m.x*m.x,b=m.x*m.x*m.x,M=m.y*m.y,S=m.y*m.y*m.y,A=p.x*p.x,P=p.x*p.x*p.x,T=p.y*p.y,C=p.y*p.y*p.y,z=d.x*d.x,L=d.x*d.x*d.x,E=d.y*d.y,D=d.y*d.y*d.y,N=f.x*f.x,B=f.x*f.x*f.x,R=f.y*f.y,F=f.y*f.y*f.y,I=x.x*x.x,k=x.x*x.x*x.x,V=x.y*x.y,O=x.y*x.y*x.y,U=v.x*v.x,G=v.x*v.x*v.x,H=v.y*v.y,j=y.x*y.x,X=y.x*y.x*y.x,W=y.y*y.y,Y=g.x*g.x,q=g.x*g.x*g.x,Z=g.y*g.y,J=g.y*g.y*g.y,Q=new Polynomial(-B*J+F*q-3*f.x*R*Y*g.y+3*N*f.y*g.x*Z,-6*f.x*y.x*R*g.x*g.y+6*N*f.y*y.y*g.x*g.y+3*y.x*F*Y-3*B*y.y*Z-3*f.x*R*y.y*Y+3*N*y.x*f.y*Z,-6*v.x*f.x*R*g.x*g.y-6*f.x*y.x*R*y.y*g.x+6*N*y.x*f.y*y.y*g.y+3*v.x*F*Y+3*j*F*g.x+3*v.x*N*f.y*Z-3*f.x*v.y*R*Y-3*f.x*j*R*g.y+N*f.y*g.x*(6*v.y*g.y+3*W)+B*(-v.y*Z-2*W*g.y-g.y*(2*v.y*g.y+W)),p.x*d.y*f.x*f.y*g.x*g.y-p.y*d.x*f.x*f.y*g.x*g.y+6*v.x*y.x*F*g.x+3*p.x*d.x*f.x*f.y*Z+6*m.x*f.x*R*g.x*g.y-3*p.x*d.x*R*g.x*g.y-3*p.y*d.y*f.x*f.y*Y-6*m.y*N*f.y*g.x*g.y-6*x.x*f.x*R*g.x*g.y+3*p.y*d.y*N*g.x*g.y-2*d.x*E*f.x*g.x*g.y-6*v.x*f.x*y.x*R*g.y-6*v.x*f.x*R*y.y*g.x-6*f.x*v.y*y.x*R*g.x+6*v.x*N*f.y*y.y*g.y+2*z*d.y*f.y*g.x*g.y+X*F-3*m.x*F*Y+3*m.y*B*Z+3*x.x*F*Y+D*f.x*Y-L*f.y*Z-3*m.x*N*f.y*Z+3*m.y*f.x*R*Y-2*p.x*d.y*N*Z+p.x*d.y*R*Y-p.y*d.x*N*Z+2*p.y*d.x*R*Y+3*x.x*N*f.y*Z-d.x*E*f.y*Y-3*x.y*f.x*R*Y+z*d.y*f.x*Z-3*f.x*j*R*y.y+N*f.y*g.x*(6*x.y*g.y+6*v.y*y.y)+N*y.x*f.y*(6*v.y*g.y+3*W)+B*(-2*v.y*y.y*g.y-x.y*Z-y.y*(2*v.y*g.y+W)-g.y*(2*x.y*g.y+2*v.y*y.y)),6*p.x*d.x*f.x*f.y*y.y*g.y+p.x*d.y*f.x*y.x*f.y*g.y+p.x*d.y*f.x*f.y*y.y*g.x-p.y*d.x*f.x*y.x*f.y*g.y-p.y*d.x*f.x*f.y*y.y*g.x-6*p.y*d.y*f.x*y.x*f.y*g.x-6*m.x*y.x*F*g.x+6*x.x*y.x*F*g.x+6*m.y*B*y.y*g.y+2*D*f.x*y.x*g.x-2*L*f.y*y.y*g.y+6*m.x*f.x*y.x*R*g.y+6*m.x*f.x*R*y.y*g.x+6*m.y*f.x*y.x*R*g.x-3*p.x*d.x*y.x*R*g.y-3*p.x*d.x*R*y.y*g.x+2*p.x*d.y*y.x*R*g.x+4*p.y*d.x*y.x*R*g.x-6*m.x*N*f.y*y.y*g.y-6*m.y*N*y.x*f.y*g.y-6*m.y*N*f.y*y.y*g.x-4*p.x*d.y*N*y.y*g.y-6*x.x*f.x*y.x*R*g.y-6*x.x*f.x*R*y.y*g.x-2*p.y*d.x*N*y.y*g.y+3*p.y*d.y*N*y.x*g.y+3*p.y*d.y*N*y.y*g.x-2*d.x*E*f.x*y.x*g.y-2*d.x*E*f.x*y.y*g.x-2*d.x*E*y.x*f.y*g.x-6*x.y*f.x*y.x*R*g.x-6*v.x*f.x*v.y*R*g.x-6*v.x*f.x*y.x*R*y.y+6*x.x*N*f.y*y.y*g.y+2*z*d.y*f.x*y.y*g.y+2*z*d.y*y.x*f.y*g.y+2*z*d.y*f.y*y.y*g.x+3*v.x*j*F+3*U*F*g.x-3*f.x*v.y*j*R-3*U*f.x*R*g.y+N*y.x*f.y*(6*x.y*g.y+6*v.y*y.y)+N*f.y*g.x*(6*x.y*y.y+3*H)+v.x*N*f.y*(6*v.y*g.y+3*W)+B*(-2*x.y*y.y*g.y-g.y*(2*x.y*y.y+H)-v.y*(2*v.y*g.y+W)-y.y*(2*x.y*g.y+2*v.y*y.y)),p.x*v.x*d.y*f.x*f.y*g.y+p.x*d.y*f.x*v.y*f.y*g.x+p.x*d.y*f.x*y.x*f.y*y.y-p.y*d.x*v.x*f.x*f.y*g.y-p.y*d.x*f.x*v.y*f.y*g.x-p.y*d.x*f.x*y.x*f.y*y.y-6*p.y*v.x*d.y*f.x*f.y*g.x-6*m.x*v.x*F*g.x+6*x.x*v.x*F*g.x+2*v.x*D*f.x*g.x+6*m.x*v.x*f.x*R*g.y+6*m.x*f.x*v.y*R*g.x+6*m.x*f.x*y.x*R*y.y+6*m.y*v.x*f.x*R*g.x-3*p.x*d.x*v.x*R*g.y-3*p.x*d.x*v.y*R*g.x-3*p.x*d.x*y.x*R*y.y+2*p.x*v.x*d.y*R*g.x+4*p.y*d.x*v.x*R*g.x-6*m.y*v.x*N*f.y*g.y-6*m.y*N*v.y*f.y*g.x-6*m.y*N*y.x*f.y*y.y-6*x.x*v.x*f.x*R*g.y-6*x.x*f.x*v.y*R*g.x-6*x.x*f.x*y.x*R*y.y+3*p.y*v.x*d.y*N*g.y-3*p.y*d.y*f.x*j*f.y+3*p.y*d.y*N*v.y*g.x+3*p.y*d.y*N*y.x*y.y-2*d.x*v.x*E*f.x*g.y-2*d.x*v.x*E*f.y*g.x-2*d.x*E*f.x*v.y*g.x-2*d.x*E*f.x*y.x*y.y-6*x.y*v.x*f.x*R*g.x-6*v.x*f.x*v.y*y.x*R+6*x.y*N*v.y*f.y*g.x+2*z*v.x*d.y*f.y*g.y+2*z*d.y*v.y*f.y*g.x+2*z*d.y*y.x*f.y*y.y-3*m.x*j*F+3*x.x*j*F+3*U*y.x*F+D*f.x*j+3*m.y*f.x*j*R+p.x*d.y*j*R+2*p.y*d.x*j*R-d.x*E*j*f.y-3*x.y*f.x*j*R-3*U*f.x*R*y.y+z*d.y*f.x*(2*v.y*g.y+W)+p.x*d.x*f.x*f.y*(6*v.y*g.y+3*W)+v.x*N*f.y*(6*x.y*g.y+6*v.y*y.y)+L*f.y*(-2*v.y*g.y-W)+m.y*B*(6*v.y*g.y+3*W)+p.y*d.x*N*(-2*v.y*g.y-W)+p.x*d.y*N*(-4*v.y*g.y-2*W)+m.x*N*f.y*(-6*v.y*g.y-3*W)+N*y.x*f.y*(6*x.y*y.y+3*H)+x.x*N*f.y*(6*v.y*g.y+3*W)+B*(-2*x.y*v.y*g.y-y.y*(2*x.y*y.y+H)-x.y*(2*v.y*g.y+W)-v.y*(2*x.y*g.y+2*v.y*y.y)),-m.x*p.x*d.y*f.x*f.y*g.y+m.x*p.y*d.x*f.x*f.y*g.y+6*m.x*p.y*d.y*f.x*f.y*g.x-6*m.y*p.x*d.x*f.x*f.y*g.y-m.y*p.x*d.y*f.x*f.y*g.x+m.y*p.y*d.x*f.x*f.y*g.x+p.x*p.y*d.x*d.y*f.x*g.y-p.x*p.y*d.x*d.y*f.y*g.x+p.x*x.x*d.y*f.x*f.y*g.y+p.x*x.y*d.y*f.x*f.y*g.x+p.x*v.x*d.y*f.x*f.y*y.y+p.x*d.y*f.x*v.y*y.x*f.y-x.x*p.y*d.x*f.x*f.y*g.y-6*x.x*p.y*d.y*f.x*f.y*g.x-p.y*d.x*x.y*f.x*f.y*g.x-p.y*d.x*v.x*f.x*f.y*y.y-p.y*d.x*f.x*v.y*y.x*f.y-6*p.y*v.x*d.y*f.x*y.x*f.y-6*m.x*x.x*F*g.x-6*m.x*v.x*y.x*F-2*m.x*D*f.x*g.x+6*x.x*v.x*y.x*F+2*x.x*D*f.x*g.x+2*v.x*D*f.x*y.x+2*m.y*L*f.y*g.y-6*m.x*m.y*f.x*R*g.x+3*m.x*p.x*d.x*R*g.y-2*m.x*p.x*d.y*R*g.x-4*m.x*p.y*d.x*R*g.x+3*m.y*p.x*d.x*R*g.x+6*m.x*m.y*N*f.y*g.y+6*m.x*x.x*f.x*R*g.y-3*m.x*p.y*d.y*N*g.y+2*m.x*d.x*E*f.x*g.y+2*m.x*d.x*E*f.y*g.x+6*m.x*x.y*f.x*R*g.x+6*m.x*v.x*f.x*R*y.y+6*m.x*f.x*v.y*y.x*R+4*m.y*p.x*d.y*N*g.y+6*m.y*x.x*f.x*R*g.x+2*m.y*p.y*d.x*N*g.y-3*m.y*p.y*d.y*N*g.x+2*m.y*d.x*E*f.x*g.x+6*m.y*v.x*f.x*y.x*R-3*p.x*x.x*d.x*R*g.y+2*p.x*x.x*d.y*R*g.x+p.x*p.y*E*f.x*g.x-3*p.x*d.x*x.y*R*g.x-3*p.x*d.x*v.x*R*y.y-3*p.x*d.x*v.y*y.x*R+2*p.x*v.x*d.y*y.x*R+4*x.x*p.y*d.x*R*g.x+4*p.y*d.x*v.x*y.x*R-2*m.x*z*d.y*f.y*g.y-6*m.y*x.x*N*f.y*g.y-6*m.y*x.y*N*f.y*g.x-6*m.y*v.x*N*f.y*y.y-2*m.y*z*d.y*f.x*g.y-2*m.y*z*d.y*f.y*g.x-6*m.y*N*v.y*y.x*f.y-p.x*p.y*z*f.y*g.y-2*p.x*T*f.x*f.y*g.x+3*x.x*p.y*d.y*N*g.y-2*x.x*d.x*E*f.x*g.y-2*x.x*d.x*E*f.y*g.x-6*x.x*x.y*f.x*R*g.x-6*x.x*v.x*f.x*R*y.y-6*x.x*f.x*v.y*y.x*R+3*p.y*x.y*d.y*N*g.x+3*p.y*v.x*d.y*N*y.y+3*p.y*d.y*N*v.y*y.x-2*d.x*x.y*E*f.x*g.x-2*d.x*v.x*E*f.x*y.y-2*d.x*v.x*E*y.x*f.y-2*d.x*E*f.x*v.y*y.x-6*x.y*v.x*f.x*y.x*R-T*d.x*d.y*f.x*g.x+2*x.x*z*d.y*f.y*g.y+6*x.y*N*v.y*y.x*f.y+2*A*p.y*f.x*f.y*g.y+A*d.x*d.y*f.y*g.y+2*z*x.y*d.y*f.y*g.x+2*z*v.x*d.y*f.y*y.y+2*z*d.y*v.y*y.x*f.y+G*F+3*_*F*g.x-3*M*B*g.y+3*I*F*g.x+C*N*g.x-P*R*g.y-p.x*T*N*g.y+A*p.y*R*g.x-3*_*f.x*R*g.y+3*M*N*f.y*g.x-A*E*f.x*g.y+T*z*f.y*g.x-3*U*f.x*v.y*R-3*I*f.x*R*g.y+3*V*N*f.y*g.x+p.x*d.x*f.x*f.y*(6*x.y*g.y+6*v.y*y.y)+L*f.y*(-2*x.y*g.y-2*v.y*y.y)+m.y*B*(6*x.y*g.y+6*v.y*y.y)+p.y*d.x*N*(-2*x.y*g.y-2*v.y*y.y)+z*d.y*f.x*(2*x.y*g.y+2*v.y*y.y)+p.x*d.y*N*(-4*x.y*g.y-4*v.y*y.y)+m.x*N*f.y*(-6*x.y*g.y-6*v.y*y.y)+x.x*N*f.y*(6*x.y*g.y+6*v.y*y.y)+v.x*N*f.y*(6*x.y*y.y+3*H)+B*(-2*x.y*v.y*y.y-V*g.y-v.y*(2*x.y*y.y+H)-x.y*(2*x.y*g.y+2*v.y*y.y)),-m.x*p.x*d.y*f.x*f.y*y.y+m.x*p.y*d.x*f.x*f.y*y.y+6*m.x*p.y*d.y*f.x*y.x*f.y-6*m.y*p.x*d.x*f.x*f.y*y.y-m.y*p.x*d.y*f.x*y.x*f.y+m.y*p.y*d.x*f.x*y.x*f.y+p.x*p.y*d.x*d.y*f.x*y.y-p.x*p.y*d.x*d.y*y.x*f.y+p.x*x.x*d.y*f.x*f.y*y.y+p.x*x.y*d.y*f.x*y.x*f.y+p.x*v.x*d.y*f.x*v.y*f.y-x.x*p.y*d.x*f.x*f.y*y.y-6*x.x*p.y*d.y*f.x*y.x*f.y-p.y*d.x*x.y*f.x*y.x*f.y-p.y*d.x*v.x*f.x*v.y*f.y-6*m.x*x.x*y.x*F-2*m.x*D*f.x*y.x+2*x.x*D*f.x*y.x+2*m.y*L*f.y*y.y-6*m.x*m.y*f.x*y.x*R+3*m.x*p.x*d.x*R*y.y-2*m.x*p.x*d.y*y.x*R-4*m.x*p.y*d.x*y.x*R+3*m.y*p.x*d.x*y.x*R+6*m.x*m.y*N*f.y*y.y+6*m.x*x.x*f.x*R*y.y-3*m.x*p.y*d.y*N*y.y+2*m.x*d.x*E*f.x*y.y+2*m.x*d.x*E*y.x*f.y+6*m.x*x.y*f.x*y.x*R+6*m.x*v.x*f.x*v.y*R+4*m.y*p.x*d.y*N*y.y+6*m.y*x.x*f.x*y.x*R+2*m.y*p.y*d.x*N*y.y-3*m.y*p.y*d.y*N*y.x+2*m.y*d.x*E*f.x*y.x-3*p.x*x.x*d.x*R*y.y+2*p.x*x.x*d.y*y.x*R+p.x*p.y*E*f.x*y.x-3*p.x*d.x*x.y*y.x*R-3*p.x*d.x*v.x*v.y*R+4*x.x*p.y*d.x*y.x*R-2*m.x*z*d.y*f.y*y.y-6*m.y*x.x*N*f.y*y.y-6*m.y*x.y*N*y.x*f.y-6*m.y*v.x*N*v.y*f.y-2*m.y*z*d.y*f.x*y.y-2*m.y*z*d.y*y.x*f.y-p.x*p.y*z*f.y*y.y-2*p.x*T*f.x*y.x*f.y+3*x.x*p.y*d.y*N*y.y-2*x.x*d.x*E*f.x*y.y-2*x.x*d.x*E*y.x*f.y-6*x.x*x.y*f.x*y.x*R-6*x.x*v.x*f.x*v.y*R+3*p.y*x.y*d.y*N*y.x+3*p.y*v.x*d.y*N*v.y-2*d.x*x.y*E*f.x*y.x-2*d.x*v.x*E*f.x*v.y-T*d.x*d.y*f.x*y.x+2*x.x*z*d.y*f.y*y.y-3*p.y*U*d.y*f.x*f.y+6*x.y*v.x*N*v.y*f.y+2*A*p.y*f.x*f.y*y.y+A*d.x*d.y*f.y*y.y+2*z*x.y*d.y*y.x*f.y+2*z*v.x*d.y*v.y*f.y-3*m.x*U*F+3*x.x*U*F+3*_*y.x*F-3*M*B*y.y+3*I*y.x*F+U*D*f.x+C*N*y.x-P*R*y.y+3*m.y*U*f.x*R-p.x*T*N*y.y+p.x*U*d.y*R+2*p.y*d.x*U*R+A*p.y*y.x*R-d.x*U*E*f.y-3*x.y*U*f.x*R-3*_*f.x*R*y.y+3*M*N*y.x*f.y-A*E*f.x*y.y+T*z*y.x*f.y-3*I*f.x*R*y.y+3*V*N*y.x*f.y+z*d.y*f.x*(2*x.y*y.y+H)+p.x*d.x*f.x*f.y*(6*x.y*y.y+3*H)+L*f.y*(-2*x.y*y.y-H)+m.y*B*(6*x.y*y.y+3*H)+p.y*d.x*N*(-2*x.y*y.y-H)+p.x*d.y*N*(-4*x.y*y.y-2*H)+m.x*N*f.y*(-6*x.y*y.y-3*H)+x.x*N*f.y*(6*x.y*y.y+3*H)+B*(-2*x.y*H-V*y.y-x.y*(2*x.y*y.y+H)),-m.x*p.x*d.y*f.x*v.y*f.y+m.x*p.y*d.x*f.x*v.y*f.y+6*m.x*p.y*v.x*d.y*f.x*f.y-6*m.y*p.x*d.x*f.x*v.y*f.y-m.y*p.x*v.x*d.y*f.x*f.y+m.y*p.y*d.x*v.x*f.x*f.y-p.x*p.y*d.x*v.x*d.y*f.y+p.x*p.y*d.x*d.y*f.x*v.y+p.x*x.x*d.y*f.x*v.y*f.y+6*p.x*d.x*x.y*f.x*v.y*f.y+p.x*x.y*v.x*d.y*f.x*f.y-x.x*p.y*d.x*f.x*v.y*f.y-6*x.x*p.y*v.x*d.y*f.x*f.y-p.y*d.x*x.y*v.x*f.x*f.y-6*m.x*x.x*v.x*F-2*m.x*v.x*D*f.x+6*m.y*x.y*B*v.y+2*x.x*v.x*D*f.x+2*m.y*L*v.y*f.y-2*L*x.y*v.y*f.y-6*m.x*m.y*v.x*f.x*R+3*m.x*p.x*d.x*v.y*R-2*m.x*p.x*v.x*d.y*R-4*m.x*p.y*d.x*v.x*R+3*m.y*p.x*d.x*v.x*R+6*m.x*m.y*N*v.y*f.y+6*m.x*x.x*f.x*v.y*R-3*m.x*p.y*d.y*N*v.y+2*m.x*d.x*v.x*E*f.y+2*m.x*d.x*E*f.x*v.y+6*m.x*x.y*v.x*f.x*R+4*m.y*p.x*d.y*N*v.y+6*m.y*x.x*v.x*f.x*R+2*m.y*p.y*d.x*N*v.y-3*m.y*p.y*v.x*d.y*N+2*m.y*d.x*v.x*E*f.x-3*p.x*x.x*d.x*v.y*R+2*p.x*x.x*v.x*d.y*R+p.x*p.y*v.x*E*f.x-3*p.x*d.x*x.y*v.x*R+4*x.x*p.y*d.x*v.x*R-6*m.x*x.y*N*v.y*f.y-2*m.x*z*d.y*v.y*f.y-6*m.y*x.x*N*v.y*f.y-6*m.y*x.y*v.x*N*f.y-2*m.y*z*v.x*d.y*f.y-2*m.y*z*d.y*f.x*v.y-p.x*p.y*z*v.y*f.y-4*p.x*x.y*d.y*N*v.y-2*p.x*T*v.x*f.x*f.y+3*x.x*p.y*d.y*N*v.y-2*x.x*d.x*v.x*E*f.y-2*x.x*d.x*E*f.x*v.y-6*x.x*x.y*v.x*f.x*R-2*p.y*d.x*x.y*N*v.y+3*p.y*x.y*v.x*d.y*N-2*d.x*x.y*v.x*E*f.x-T*d.x*v.x*d.y*f.x+6*x.x*x.y*N*v.y*f.y+2*x.x*z*d.y*v.y*f.y+2*A*p.y*f.x*v.y*f.y+A*d.x*d.y*v.y*f.y+2*z*x.y*v.x*d.y*f.y+2*z*x.y*d.y*f.x*v.y+3*_*v.x*F-3*M*B*v.y+3*I*v.x*F+C*v.x*N-P*v.y*R-3*V*B*v.y-p.x*T*N*v.y+A*p.y*v.x*R-3*_*f.x*v.y*R+3*M*v.x*N*f.y-A*E*f.x*v.y+T*z*v.x*f.y-3*I*f.x*v.y*R+3*V*v.x*N*f.y,m.x*m.y*p.x*d.y*f.x*f.y-m.x*m.y*p.y*d.x*f.x*f.y+m.x*p.x*p.y*d.x*d.y*f.y-m.y*p.x*p.y*d.x*d.y*f.x-m.x*p.x*x.y*d.y*f.x*f.y+6*m.x*x.x*p.y*d.y*f.x*f.y+m.x*p.y*d.x*x.y*f.x*f.y-m.y*p.x*x.x*d.y*f.x*f.y-6*m.y*p.x*d.x*x.y*f.x*f.y+m.y*x.x*p.y*d.x*f.x*f.y-p.x*x.x*p.y*d.x*d.y*f.y+p.x*p.y*d.x*x.y*d.y*f.x+p.x*x.x*x.y*d.y*f.x*f.y-x.x*p.y*d.x*x.y*f.x*f.y-2*m.x*x.x*D*f.x+2*m.y*L*x.y*f.y-3*m.x*m.y*p.x*d.x*R-6*m.x*m.y*x.x*f.x*R+3*m.x*m.y*p.y*d.y*N-2*m.x*m.y*d.x*E*f.x-2*m.x*p.x*x.x*d.y*R-m.x*p.x*p.y*E*f.x+3*m.x*p.x*d.x*x.y*R-4*m.x*x.x*p.y*d.x*R+3*m.y*p.x*x.x*d.x*R+6*m.x*m.y*x.y*N*f.y+2*m.x*m.y*z*d.y*f.y+2*m.x*p.x*T*f.x*f.y+2*m.x*x.x*d.x*E*f.y+6*m.x*x.x*x.y*f.x*R-3*m.x*p.y*x.y*d.y*N+2*m.x*d.x*x.y*E*f.x+m.x*T*d.x*d.y*f.x+m.y*p.x*p.y*z*f.y+4*m.y*p.x*x.y*d.y*N-3*m.y*x.x*p.y*d.y*N+2*m.y*x.x*d.x*E*f.x+2*m.y*p.y*d.x*x.y*N+p.x*x.x*p.y*E*f.x-3*p.x*x.x*d.x*x.y*R-2*m.x*z*x.y*d.y*f.y-6*m.y*x.x*x.y*N*f.y-2*m.y*x.x*z*d.y*f.y-2*m.y*A*p.y*f.x*f.y-m.y*A*d.x*d.y*f.y-2*m.y*z*x.y*d.y*f.x-2*p.x*x.x*T*f.x*f.y-p.x*p.y*z*x.y*f.y+3*x.x*p.y*x.y*d.y*N-2*x.x*d.x*x.y*E*f.x-x.x*T*d.x*d.y*f.x+3*M*p.x*d.x*f.x*f.y+3*p.x*d.x*V*f.x*f.y+2*x.x*z*x.y*d.y*f.y-3*_*p.y*d.y*f.x*f.y+2*A*p.y*x.y*f.x*f.y+A*d.x*x.y*d.y*f.y-3*I*p.y*d.y*f.x*f.y-b*F+S*B+k*F-O*B-3*m.x*I*F-m.x*C*N+3*_*x.x*F+m.y*P*R+3*m.y*V*B+x.x*C*N+_*D*f.x-3*M*x.y*B-M*L*f.y+I*D*f.x-P*x.y*R-L*V*f.y-m.x*A*p.y*R+m.y*p.x*T*N-3*m.x*M*N*f.y-m.x*T*z*f.y+m.y*A*E*f.x-p.x*T*x.y*N+3*_*m.y*f.x*R+_*p.x*d.y*R+2*_*p.y*d.x*R-2*M*p.x*d.y*N-M*p.y*d.x*N+A*x.x*p.y*R-3*m.x*V*N*f.y+3*m.y*I*f.x*R+p.x*I*d.y*R-2*p.x*V*d.y*N+x.x*T*z*f.y-p.y*d.x*V*N-_*d.x*E*f.y-3*_*x.y*f.x*R+3*M*x.x*N*f.y+M*z*d.y*f.x-A*x.y*E*f.x+2*I*p.y*d.x*R+3*x.x*V*N*f.y-I*d.x*E*f.y-3*I*x.y*f.x*R+z*V*d.y*f.x),K=Q.getRootsInInterval(0,1),$=0;$<K.length;$++){var tt=K[$],et=new Polynomial(f.x,d.x,p.x,m.x-x.x-tt*v.x-tt*tt*y.x-tt*tt*tt*g.x).getRoots(),it=new Polynomial(f.y,d.y,p.y,m.y-x.y-tt*v.y-tt*tt*y.y-tt*tt*tt*g.y).getRoots();if(et.length>0&&it.length>0){var rt=1e-4;t:for(var at=0;at<et.length;at++){var nt=et[at];if(0<=nt&&nt<=1)for(var st=0;st<it.length;st++)if(Math.abs(nt-it[st])<rt){w.points.push(g.multiply(tt*tt*tt).add(y.multiply(tt*tt).add(v.multiply(tt).add(x))));break t}}}}return w.points.length>0&&(w.status="Intersection"),w},sr.intersectBezier3Circle=function(t,e,i,r,a,n){return sr.intersectBezier3Ellipse(t,e,i,r,a,n,n)},sr.intersectBezier3Ellipse=function(t,e,i,r,a,n,s){var o,l,h,c,u,f,d,p,m=new sr("No Intersection");o=t.multiply(-1),l=e.multiply(3),h=i.multiply(-3),c=o.add(l.add(h.add(r))),u=new Vector2D(c.x,c.y),o=t.multiply(3),l=e.multiply(-6),h=i.multiply(3),c=o.add(l.add(h)),f=new Vector2D(c.x,c.y),o=t.multiply(-3),l=e.multiply(3),h=o.add(l),d=new Vector2D(h.x,h.y),p=new Vector2D(t.x,t.y);for(var g=n*n,y=s*s,v=new Polynomial(u.x*u.x*y+u.y*u.y*g,2*(u.x*f.x*y+u.y*f.y*g),2*(u.x*d.x*y+u.y*d.y*g)+f.x*f.x*y+f.y*f.y*g,2*u.x*y*(p.x-a.x)+2*u.y*g*(p.y-a.y)+2*(f.x*d.x*y+f.y*d.y*g),2*f.x*y*(p.x-a.x)+2*f.y*g*(p.y-a.y)+d.x*d.x*y+d.y*d.y*g,2*d.x*y*(p.x-a.x)+2*d.y*g*(p.y-a.y),p.x*p.x*y-2*p.y*a.y*g-2*p.x*a.x*y+p.y*p.y*g+a.x*a.x*y+a.y*a.y*g-g*y),x=v.getRootsInInterval(0,1),w=0;w<x.length;w++){var _=x[w];m.points.push(u.multiply(_*_*_).add(f.multiply(_*_).add(d.multiply(_).add(p))))}return m.points.length>0&&(m.status="Intersection"),m},sr.intersectBezier3Line=function(t,e,i,r,a,n){var s,o,l,h,c,u,f,d,p,m,g=a.min(n),y=a.max(n),v=new sr("No Intersection");s=t.multiply(-1),o=e.multiply(3),l=i.multiply(-3),h=s.add(o.add(l.add(r))),c=new Vector2D(h.x,h.y),s=t.multiply(3),o=e.multiply(-6),l=i.multiply(3),h=s.add(o.add(l)),u=new Vector2D(h.x,h.y),s=t.multiply(-3),o=e.multiply(3),l=s.add(o),f=new Vector2D(l.x,l.y),d=new Vector2D(t.x,t.y),m=new Vector2D(a.y-n.y,n.x-a.x),p=a.x*n.y-n.x*a.y,roots=new Polynomial(m.dot(c),m.dot(u),m.dot(f),m.dot(d)+p).getRoots();for(var x=0;x<roots.length;x++){var w=roots[x];if(0<=w&&w<=1){var _=t.lerp(e,w),b=e.lerp(i,w),M=i.lerp(r,w),S=_.lerp(b,w),A=b.lerp(M,w),P=S.lerp(A,w);a.x==n.x?g.y<=P.y&&P.y<=y.y&&(v.status="Intersection",v.appendPoint(P)):a.y==n.y?g.x<=P.x&&P.x<=y.x&&(v.status="Intersection",v.appendPoint(P)):P.gte(g)&&P.lte(y)&&(v.status="Intersection",v.appendPoint(P))}}return v},sr.intersectBezier3Polygon=function(t,e,i,r,a){for(var n=new sr("No Intersection"),s=a.length,o=0;o<s;o++){var l=a[o],h=a[(o+1)%s],c=sr.intersectBezier3Line(t,e,i,r,l,h);n.appendPoints(c.points)}return n.points.length>0&&(n.status="Intersection"),n},sr.intersectBezier3Rectangle=function(t,e,i,r,a,n){var s=a.min(n),o=a.max(n),l=new Qe(o.x,s.y),h=new Qe(s.x,o.y),c=sr.intersectBezier3Line(t,e,i,r,s,l),u=sr.intersectBezier3Line(t,e,i,r,l,o),f=sr.intersectBezier3Line(t,e,i,r,o,h),d=sr.intersectBezier3Line(t,e,i,r,h,s),p=new sr("No Intersection");return p.appendPoints(c.points),p.appendPoints(u.points),p.appendPoints(f.points),p.appendPoints(d.points),p.points.length>0&&(p.status="Intersection"),p},sr.intersectCircleCircle=function(t,e,i,r){var a,n=e+r,s=Math.abs(e-r),o=t.distanceFrom(i);if(o>n)a=new sr("Outside");else if(o<s)a=new sr("Inside");else{a=new sr("Intersection");var l=(e*e-r*r+o*o)/(2*o),h=Math.sqrt(e*e-l*l),c=t.lerp(i,l/o),u=h/o;a.points.push(new Qe(c.x-u*(i.y-t.y),c.y+u*(i.x-t.x))),a.points.push(new Qe(c.x+u*(i.y-t.y),c.y-u*(i.x-t.x)))}return a},sr.intersectCircleEllipse=function(t,e,i,r,a){return sr.intersectEllipseEllipse(t,e,e,i,r,a)},sr.intersectCircleLine=function(t,e,i,r){var a,n=(r.x-i.x)*(r.x-i.x)+(r.y-i.y)*(r.y-i.y),s=2*((r.x-i.x)*(i.x-t.x)+(r.y-i.y)*(i.y-t.y)),o=t.x*t.x+t.y*t.y+i.x*i.x+i.y*i.y-2*(t.x*i.x+t.y*i.y)-e*e,l=s*s-4*n*o;if(l<0)a=new sr("Outside");else if(0==l)a=new sr("Tangent");else{var h=Math.sqrt(l),c=(-s+h)/(2*n),u=(-s-h)/(2*n);(c<0||c>1)&&(u<0||u>1)?a=new sr(c<0&&u<0||c>1&&u>1?"Outside":"Inside"):(a=new sr("Intersection"),0<=c&&c<=1&&a.points.push(i.lerp(r,c)),0<=u&&u<=1&&a.points.push(i.lerp(r,u)))}return a},sr.intersectCirclePolygon=function(t,e,i){for(var r,a=new sr("No Intersection"),n=i.length,s=0;s<n;s++){var o=i[s],l=i[(s+1)%n];r=sr.intersectCircleLine(t,e,o,l),a.appendPoints(r.points)}return a.points.length>0?a.status="Intersection":a.status=r.status,a},sr.intersectCircleRectangle=function(t,e,i,r){var a=i.min(r),n=i.max(r),s=new Qe(n.x,a.y),o=new Qe(a.x,n.y),l=sr.intersectCircleLine(t,e,a,s),h=sr.intersectCircleLine(t,e,s,n),c=sr.intersectCircleLine(t,e,n,o),u=sr.intersectCircleLine(t,e,o,a),f=new sr("No Intersection");return f.appendPoints(l.points),f.appendPoints(h.points),f.appendPoints(c.points),f.appendPoints(u.points),f.points.length>0?f.status="Intersection":f.status=l.status,f},sr.intersectEllipseEllipse=function(t,e,i,r,a,n){for(var s=[i*i,0,e*e,-2*i*i*t.x,-2*e*e*t.y,i*i*t.x*t.x+e*e*t.y*t.y-e*e*i*i],o=[n*n,0,a*a,-2*n*n*r.x,-2*a*a*r.y,n*n*r.x*r.x+a*a*r.y*r.y-a*a*n*n],l=sr.bezout(s,o),h=l.getRoots(),c=.001,u=(s[0]*s[0]+2*s[1]*s[1]+s[2]*s[2])*c,f=(o[0]*o[0]+2*o[1]*o[1]+o[2]*o[2])*c,d=new sr("No Intersection"),p=0;p<h.length;p++)for(var m=new Polynomial(s[0],s[3]+h[p]*s[1],s[5]+h[p]*(s[4]+h[p]*s[2])),g=m.getRoots(),y=0;y<g.length;y++){var v=(s[0]*g[y]+s[1]*h[p]+s[3])*g[y]+(s[2]*h[p]+s[4])*h[p]+s[5];Math.abs(v)<u&&(v=(o[0]*g[y]+o[1]*h[p]+o[3])*g[y]+(o[2]*h[p]+o[4])*h[p]+o[5],Math.abs(v)<f&&d.appendPoint(new Qe(g[y],h[p])))}return d.points.length>0&&(d.status="Intersection"),d},sr.intersectEllipseLine=function(t,e,i,r,a){var n,s=new Vector2D(r.x,r.y),o=Vector2D.fromPoints(r,a),l=new Vector2D(t.x,t.y),h=s.subtract(l),c=new Vector2D(o.x/(e*e),o.y/(i*i)),u=new Vector2D(h.x/(e*e),h.y/(i*i)),f=o.dot(c),d=o.dot(u),t=h.dot(u)-1,p=d*d-f*t;if(p<0)n=new sr("Outside");else if(p>0){var m=Math.sqrt(p),g=(-d-m)/f,y=(-d+m)/f;(g<0||1<g)&&(y<0||1<y)?n=new sr(g<0&&y<0||g>1&&y>1?"Outside":"Inside"):(n=new sr("Intersection"),0<=g&&g<=1&&n.appendPoint(r.lerp(a,g)),0<=y&&y<=1&&n.appendPoint(r.lerp(a,y)))}else{var v=-d/f;0<=v&&v<=1?(n=new sr("Intersection"),n.appendPoint(r.lerp(a,v))):n=new sr("Outside")}return n},sr.intersectEllipsePolygon=function(t,e,i,r){for(var a=new sr("No Intersection"),n=r.length,s=0;s<n;s++){var o=r[s],l=r[(s+1)%n],h=sr.intersectEllipseLine(t,e,i,o,l);a.appendPoints(h.points)}return a.points.length>0&&(a.status="Intersection"),a},sr.intersectEllipseRectangle=function(t,e,i,r,a){var n=r.min(a),s=r.max(a),o=new Qe(s.x,n.y),l=new Qe(n.x,s.y),h=sr.intersectEllipseLine(t,e,i,n,o),c=sr.intersectEllipseLine(t,e,i,o,s),u=sr.intersectEllipseLine(t,e,i,s,l),f=sr.intersectEllipseLine(t,e,i,l,n),d=new sr("No Intersection");return d.appendPoints(h.points),d.appendPoints(c.points),d.appendPoints(u.points),d.appendPoints(f.points),d.points.length>0&&(d.status="Intersection"),d},sr.intersectLineLine=function(t,e,i,r){var a,n=(r.x-i.x)*(t.y-i.y)-(r.y-i.y)*(t.x-i.x),s=(e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x),o=(r.y-i.y)*(e.x-t.x)-(r.x-i.x)*(e.y-t.y);if(0!=o){var l=n/o,h=s/o;0<=l&&l<=1&&0<=h&&h<=1?(a=new sr("Intersection"),a.points.push(new Qe(t.x+l*(e.x-t.x),t.y+l*(e.y-t.y)))):a=new sr("No Intersection")}else a=new sr(0==n||0==s?"Coincident":"Parallel");return a},sr.intersectLinePolygon=function(t,e,i){for(var r=new sr("No Intersection"),a=i.length,n=0;n<a;n++){var s=i[n],o=i[(n+1)%a],l=sr.intersectLineLine(t,e,s,o);r.appendPoints(l.points)}return r.points.length>0&&(r.status="Intersection"),r},sr.intersectLineRectangle=function(t,e,i,r){var a=i.min(r),n=i.max(r),s=new Qe(n.x,a.y),o=new Qe(a.x,n.y),l=sr.intersectLineLine(a,s,t,e),h=sr.intersectLineLine(s,n,t,e),c=sr.intersectLineLine(n,o,t,e),u=sr.intersectLineLine(o,a,t,e),f=new sr("No Intersection");return f.appendPoints(l.points),f.appendPoints(h.points),f.appendPoints(c.points),f.appendPoints(u.points),f.points.length>0&&(f.status="Intersection"),f},sr.intersectPolygonPolygon=function(t,e){for(var i=new sr("No Intersection"),r=t.length,a=0;a<r;a++){var n=t[a],s=t[(a+1)%r],o=sr.intersectLinePolygon(n,s,e);i.appendPoints(o.points)}return i.points.length>0&&(i.status="Intersection"),i},sr.intersectPolygonRectangle=function(t,e,i){var r=e.min(i),a=e.max(i),n=new Qe(a.x,r.y),s=new Qe(r.x,a.y),o=sr.intersectLinePolygon(r,n,t),l=sr.intersectLinePolygon(n,a,t),h=sr.intersectLinePolygon(a,s,t),c=sr.intersectLinePolygon(s,r,t),u=new sr("No Intersection");return u.appendPoints(o.points),u.appendPoints(l.points),u.appendPoints(h.points),u.appendPoints(c.points),u.points.length>0&&(u.status="Intersection"),u},sr.intersectRayRay=function(t,e,i,r){var a,n=(r.x-i.x)*(t.y-i.y)-(r.y-i.y)*(t.x-i.x),s=(e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x),o=(r.y-i.y)*(e.x-t.x)-(r.x-i.x)*(e.y-t.y);if(0!=o){var l=n/o;a=new sr("Intersection"),a.points.push(new Qe(t.x+l*(e.x-t.x),t.y+l*(e.y-t.y)))}else a=new sr(0==n||0==s?"Coincident":"Parallel");return a},sr.intersectRectangleRectangle=function(t,e,i,r){var a=t.min(e),n=t.max(e),s=new Qe(n.x,a.y),o=new Qe(a.x,n.y),l=sr.intersectLineRectangle(a,s,i,r),h=sr.intersectLineRectangle(s,n,i,r),c=sr.intersectLineRectangle(n,o,i,r),u=sr.intersectLineRectangle(o,a,i,r),f=new sr("No Intersection");return f.appendPoints(l.points),f.appendPoints(h.points),f.appendPoints(c.points),f.appendPoints(u.points),f.points.length>0&&(f.status="Intersection"),f},sr.bezout=function(t,e){var i=t[0]*e[1]-e[0]*t[1],r=t[0]*e[2]-e[0]*t[2],a=t[0]*e[3]-e[0]*t[3],n=t[0]*e[4]-e[0]*t[4],s=t[0]*e[5]-e[0]*t[5],o=t[1]*e[2]-e[1]*t[2],l=t[1]*e[4]-e[1]*t[4],h=t[1]*e[5]-e[1]*t[5],c=t[2]*e[3]-e[2]*t[3],u=t[3]*e[4]-e[3]*t[4],f=t[3]*e[5]-e[3]*t[5],d=h+u,p=l-c;return new Polynomial(i*o-r*r,i*p+a*o-2*r*n,i*d+a*p-n*n-2*r*s,i*f+a*d-2*n*s,a*f-s*s)},Je.Intersection=sr,Je.AreaPicking=function(t,e){this.network=t,this.bounding=e,this.cache={}},Je.extend(Je.AreaPicking,Object,{intersectObjects:function(t){for(var e=[],i=0;i<t.length;i++){var r=t[i];this.intersectObject(r,e)}return e},getViewPoint:function(t,e){var i=e.vertices[t].clone(),r=this.cache[e.getId()][i.x+" "+i.y+" "+i.z];return r?r:(i.applyMatrix4(e.worldMatrix),r=this.network.getViewPosition(i),r.y=r.h-r.y,r)},intersectObject:function(t,e){if(t instanceof Je.Entity){this.cache[t.getId()]={};for(var i=0;i<t.vertices.length;i++){var r=t.vertices[i].clone();r.applyMatrix4(t.worldMatrix);var a=this.network.getViewPosition(r);if(a.y=a.h-a.y,this.cache[t.getId()][r.x+" "+r.y+" "+r.z]=a,a.x>this.bounding.x&&a.y>this.bounding.y&&a.x<this.bounding.x+this.bounding.w&&a.y<this.bounding.y+this.bounding.h){var n={element:t};return void e.push(n)}}}}}),Je.BaseInteraction=function(t){this.network=t,this.view=t.getView()||document},Je.addEventListener=function(t,e,i,r){var a="_"+t+"_";if(!r[a]){var n=function(t){r[e](t)};r[a]=n,i.addEventListener(t,n,!1)}},Je.removeEventListener=function(t,e,i){var r="_"+t+"_",a=i[r];a&&(e.removeEventListener(t,a,!1),delete i[r])},Je.extend(Je.BaseInteraction,Object,{onPropertyChange:function(){},firePropertyChange:function(){},setUp:function(){},tearDown:function(){},update:function(){},addListener:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];Je.addEventListener(e,"handle_"+e,this.network.getRootView(),this)}},removeListener:function(){for(var t=0;t<arguments.length;t++){arguments[t];Je.removeEventListener(arguments[t],this.network.getRootView(),this)}},isCtrlDown:function(t){return t.ctrlKey||t.metaKey},isFinished:function(){return!0}}),Je.DefaultInteraction=function(e){Je.BaseInteraction.call(this,e),this.screen={width:0,height:0,offsetLeft:0,offsetTop:0},this.radius=this.screen.width/4,this.domElement=this.network.getRootView(),this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.easing=!0,this.dynamicDampingFactor=.05,this.timeInterval=2e3,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.lastPosition=new Je.Vec3;var i,r,a=this.STATE.NONE,n=(this.STATE.NONE,new Je.Vec3),s=new Je.Vec3,o=new Je.Vec3,l=new Je.Vec2,h=new Je.Vec2,c=0,u=0,f=new Je.Vec2,d=new Je.Vec2;this.object=this.network._camera,this.object.target||(this.object.target=new Je.Vec3),this.movementSpeed=1,this.lookSpeed=.005,this.verticalLookRatio=.1,this.keyboardEnable=!0,this.lookVertical=!0,this.autoForward=!1,this.fpsMode=!1,this.dragMode=!0,this.activeLook=!1,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalFixed=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.freeze=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0,this.lastX=0,this.lastY=0,this.touchSeq=[1,2,3],this.network.getRootView().addEventListener("contextmenu",function(t){t.preventDefault()},!1),this.yRistrict=!0,this.yLowerLimitAngle=-Math.PI/2,this.yUpLimitAngle=Math.PI/2,this.updateIntervalTime=0;var p=null;this.handleResize=function(){this.screen.width=t.innerWidth,this.screen.height=t.innerHeight,this.screen.offsetLeft=0,this.screen.offsetTop=0,this.radius=(this.screen.width+this.screen.height)/4},this.handleResize(),this.handle_mousedown=function(t){if(!ei.isCtrlDown(t)){if(t.preventDefault(),this.fpsMode){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(t.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.lastX=t.pageX,this.lastY=t.pageY,
this.mouseDragOn=!0}else a===this.STATE.NONE&&(a=t.button),a!==this.STATE.ROTATE||this.noRotate?this.state!==this.STATE.ZOOM||this.noZoom?a===this.STATE.PAN&&!this.noPan&&(f=d=this.getMouseOnScreen(t.clientX,t.clientY)):l=h=this.getMouseOnScreen(t.clientX,t.clientY):(s=o=this.getMouseProjectionOnBall(t.clientX,t.clientY),i=r=this.getRotateY(t.clientX,t.clientY));this.beforeUpdate(),this.addListener("mousemove","mouseup")}},this.handle_mousemove=function(t){if(!t.stop){t.preventDefault(),this.fpsMode?this.dragMode?this.mouseDragOn?(this.mouseX=300*(t.pageX-this.lastX),this.mouseY=300*(t.pageY-this.lastY),this.lastX=t.pageX,this.lastY=t.pageY):(this.mouseX=0,this.mouseY=0):this.domElement===document?(this.mouseX=t.pageX-this.viewHalfX,this.mouseY=t.pageY-this.viewHalfY):(this.mouseX=t.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=t.pageY-this.domElement.offsetTop-this.viewHalfY):a!==this.STATE.ROTATE||this.noRotate?a!==this.STATE.ZOOM||this.noZoom?a===this.STATE.PAN&&!this.noPan&&(d=this.getMouseOnScreen(t.clientX,t.clientY)):h=this.getMouseOnScreen(t.clientX,t.clientY):(o=this.getMouseProjectionOnBall(t.clientX,t.clientY),r=this.getRotateY(t.clientX,t.clientY));var e=(new Date).getTime();if(null==this._lt)this.update();else{if(e-this._lt<this.updateIntervalTime)return;this.update()}this._lt=e}},this.handle_mouseup=function(t){if(t.preventDefault(),this.fpsMode){if(this.activeLook)switch(t.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.lastX=0,this.lastY=0,this.dragMode&&(this.mouseX=0,this.mouseY=0),this.mouseDragOn=!1}else a=this.STATE.NONE;this.removeListener("mousemove","mouseup"),this.update()},this.handle_touchstart=function(t){if(this.enabled!==!1){switch(t.touches.length){case this.touchSeq[0]:a=this.STATE.TOUCH_ROTATE,s=this.getMouseProjectionOnBall(t.touches[0].pageX,t.touches[0].pageY),i=r=this.getRotateY(t.touches[0].pageX,t.touches[0].pageY),o.copy(s);break;case this.touchSeq[1]:a=this.STATE.TOUCH_ZOOM;var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY;u=c=Math.sqrt(e*e+n*n);break;case this.touchSeq[2]:a=this.STATE.TOUCH_PAN,f.copy(this.getMouseOnScreen(t.touches[0].pageX,t.touches[0].pageY)),d.copy(f);break;default:a=this.STATE.NONE}this.update()}},this.handle_touchmove=function(t){if(this.enabled!==!1){switch(t.preventDefault(),t.touches.length){case this.touchSeq[0]:o=this.getMouseProjectionOnBall(t.touches[0].pageX,t.touches[0].pageY,o),r=this.getRotateY(t.touches[0].pageX,t.touches[0].pageY);break;case this.touchSeq[1]:var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;u=Math.sqrt(e*e+i*i);break;case this.touchSeq[2]:d=this.getMouseOnScreen(t.touches[0].pageX,t.touches[0].pageY,d);break;default:a=this.STATE.NONE}this.update()}},this.handle_touchend=function(t){if(this.enabled!==!1){switch(t.touches.length){case this.touchSeq[0]:s.copy(this.getMouseProjectionOnBall(t.touches[0].pageX,t.touches[0].pageY,o));break;case this.touchSeq[1]:c=u=0;break;case this.touchSeq[2]:d.copy(this.getMouseOnScreen(t.touches[0].pageX,t.touches[0].pageY)),f.copy(d)}a=this.STATE.NONE,this.update()}},this.handle_DOMMouseScroll=function(t){this.handle_mousewheel(t)},this.handle_mousewheel=function(t){t.preventDefault();var e=0;t.wheelDelta?e=t.wheelDelta%120===0?t.wheelDelta/40:t.wheelDelta:t.detail&&(e=-t.detail/3),e&&(l.y+=1/e*.01),this.mouseMoving=!0,this.update()},this.handle_dblclick=function(t){if(this.isCtrlDown(t)){var e=this.network.getElementsByMouseEvent(t);e.length>0&&(p=e[0]),this.update()}},this.getMouseOnScreen=function(t,e){return new Je.Vec2((t-this.screen.offsetLeft)/this.radius*.5,(e-this.screen.offsetTop)/this.radius*.5)},this.getRotateY=function(t,e){if(this.yRistrict){var i=(.5*this.screen.height+this.screen.offsetTop-e)/this.screen.height*2;return i}},this.handle_keydown=function(t){if(this.keyboardEnable){switch(t.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}this.update()}},this.handle_keyup=function(t){if(this.keyboardEnable){switch(t.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}this.update()}},this.getMouseProjectionOnBall=function(t,e){if(this.yRistrict){var i=new Je.Vec3((t-.5*this.screen.width-this.screen.offsetLeft)/(.5*this.screen.width),0,0),r=i.length();return r>1?i.normalize():i.z=Math.sqrt(1-r*r),i.normalize()}var i=new Je.Vec3((t-.5*this.screen.width-this.screen.offsetLeft)/this.radius,(.5*this.screen.height+this.screen.offsetTop-e)/this.radius,0),r=i.length();r>1?i.normalize():i.z=Math.sqrt(1-r*r),n.copy(this.object._position).sub(this.object.target);var a=this.object.up.clone().setLength(i.y);return a.add(this.object.up.clone().cross(n).setLength(i.x)),a.add(n.setLength(i.z)),a},this.rotateCamera=function(){var t=s.dot(o)/s.length()/o.length(),e=Math.acos(t),a=!this.easing||Math.abs(e)<1e-4,l=!1;if(e){var h=(new Je.Vec3).crossVectors(s,o).normalize(),c=new Je.Quat;c.setFromAxisAngle(h,-e*this.dynamicDampingFactor*this.rotateSpeed),a?(c.setFromAxisAngle(h,-e*this.rotateSpeed),n.applyQuaternion(c),this.object.up.applyQuaternion(c),s.copy(o)):(c.setFromAxisAngle(h,-e*this.dynamicDampingFactor*this.rotateSpeed),n.applyQuaternion(c),this.object.up.applyQuaternion(c),c.setFromAxisAngle(h,e*this.dynamicDampingFactor),s.applyQuaternion(c),l=!0)}var a=!this.easing||Math.abs(r-i)<1e-4,u=(r-i)*n.length();if(!xi.isNaN(u))if(a)u&&this.yRistrict&&this.limitY(u),i=r;else{var u=u*this.dynamicDampingFactor;u&&this.yRistrict&&this.limitY(u),i+=(r-i)*this.dynamicDampingFactor,l=!0}l&&this.network.dirtyNetwork()},this.limitY=function(t){var e=n.length();Math.abs(n.x)<=.1*e&&Math.abs(n.z)<=.1*e&&(n.x=.1*e);var i=n.x,r=n.z,a=Math.sqrt(i*i+r*r),s=Math.tan(this.yLowerLimitAngle)*a,o=Math.tan(this.yUpLimitAngle)*a;n.y-=t,n.y>o?n.y=o:n.y<s&&(n.y=s)},this.getValueByTime=function(t,e){var i=(new Date).getTime(),r=i-this._timeStart;return r>this.timeInterval?e:t+(e-t)*r/this.timeInterval},this.zoomCamera=function(){if(a===this.STATE.TOUCH_ZOOM){var t=c/u;c=u,n.multiplyScalar(t)}else{var e=this.zoomSpeed;this.easing||(e*=5);var t;t=1+(h.y-l.y)*e,1!==t&&t>0&&(n.multiplyScalar(t),!this.easing||Math.abs(h.y-l.y)<.001?l.copy(h):(l.y+=(h.y-l.y)*this.dynamicDampingFactor,this.network.dirtyNetwork()))}},this.panCamera=function(){var t=d.clone().sub(f);if(t.lengthSq()){t.multiplyScalar(n.length()*this.panSpeed);var e=n.clone().cross(this.object.up).setLength(t.x),i=(new ti).extractRotation(this.object.matrix),r=this.object.up.clone().applyMatrix4(i);e.add(r.setLength(t.y));var a=this.object.p().add(e);this.object.checkPosition(a)&&(this.object.p(a),this.object.target.add(e)),f=d,this.network.dirtyNetwork()}},this.checkAngles=function(){},this.checkDistances=function(){this.noZoom&&this.noPan||(n.lengthSq()>this.maxDistance*this.maxDistance&&this.object._position.addVectors(this.object.target,n.setLength(this.maxDistance)),n.lengthSq()<this.minDistance*this.minDistance&&this.object._position.addVectors(this.object.target,n.setLength(this.minDistance)))},this.updateFPS=function(){var t=2;if(!this.freeze){if(this.heightSpeed){var e=Je.Math.clamp(this.object._position.y,this.heightMin,this.heightMax),i=e-this.heightMin;this.autoSpeedFactor=t*i*this.heightCoef}else this.autoSpeedFactor=0;var r=t*this.movementSpeed;if(this.moveForward||this.autoForward&&!this.moveBackward){var a=this.object._position.clone();this.object.translateZ(-(r+this.autoSpeedFactor));var s=this.object.target;this.verticalFixed&&this.object.setY(a.y);var o=this.object._position,l=new Ke,h=new Ke;l.subVectors(o,s),h.subVectors(a,s),l.z*h.z<=this.minDistance*this.minDistance&&this.object.target.subVectors(this.object._position,n)}if(this.moveBackward){var a=this.object._position.clone();this.object.translateZ(r),this.verticalFixed&&this.object.setY(a.y)}this.moveLeft&&(this.object.translateX(-r),this.object.target.subVectors(this.object._position,n)),this.moveRight&&(this.object.translateX(r),this.object.target.subVectors(this.object._position,n)),this.moveUp&&(this.object.translateY(r),this.object.target.subVectors(this.object._position,n)),this.moveDown&&(this.object.translateY(-r),this.object.target.subVectors(this.object._position,n));var c=t*this.lookSpeed;!this.activeLook&&!this.dragMode&&(c=0);var u=this.verticalLookRatio;if(this.constrainVertical&&(u=Math.PI/(this.verticalMax-this.verticalMin)),this.lon+=this.mouseX*c,this.dragMode&&(this.mouseX=0),this.lookVertical&&(this.lat-=this.mouseY*c*u),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=Je.Math.degToRad(90-this.lat),this.theta=Je.Math.degToRad(this.lon),this.constrainVertical&&(this.phi=Je.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax)),this.fpsMode){var f=this.object.target,o=this.object._position;f.x=o.x+100*Math.sin(this.phi)*Math.sin(this.theta),f.y=o.y+100*Math.cos(this.phi),f.z=o.z-100*Math.sin(this.phi)*Math.cos(this.theta),this.object.look(f)}}},this.update=function(){if(n.subVectors(this.object._position,this.object.target),!this.noRotate&&!this.fpsMode&&this.rotateCamera(),this.noZoom||this.zoomCamera(),!this.noPan&&!this.fpsMode&&this.panCamera(),p&&p.element&&this.network.doubleClickToLookAtFunction(p.element)){this.object.target=p.point;var t=this.object._position.distanceTo(this.object.target),e=p.face.normal.clone();e=e.applyMatrix4((new Je.Mat4).extractRotation(p.element.worldMatrix)),e.normalize(),n=e.multiplyScalar(t),p=null}this.object.setPosition(this.object._position.clone().addVectors(this.object.target,n)),this.updateFPS(),this.fpsMode||(this.checkDistances(),this.object.look(this.object.target)),this.lastPosition.distanceToSquared(this.object._position)>0&&this.lastPosition.copy(this.object._position)}},Je.extend(Je.DefaultInteraction,Je.BaseInteraction,{STATE:{NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5},__accessor:["rotateSpeed","zoomSpeed","panSpeed","yLowerLimitAngle","yUpLimitAngle","minDistance","maxDistance","easing","touchSeq"],setUp:function(){this.addListener("mousedown","touchstart","touchend","touchmove","mousewheel","DOMMouseScroll","dblclick","keydown","keyup")},tearDown:function(){this.removeListener("mousedown","touchstart","touchend","touchmove","mousewheel","DOMMouseScroll","dblclick","keydown","keyup")},beforeUpdate:function(){},setUpdateIntervalTime:function(t){this.updateIntervalTime=t}}),Je.SelectionInteraction=function(t){Je.BaseInteraction.call(this,t),this.selectUnVisible=!0,this.ctrlDown=!1,this.deleteTimeoutId=null,this._areaPickingLevel=1},Je.extend(Je.SelectionInteraction,Je.BaseInteraction,{constructor:Je.SelectionInteraction,setAreaPickingLevel:function(t){this._areaPickingLevel=t},getAreaPickingLevel:function(){return this._areaPickingLevel},setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},setFocus:function(t){if(document.activeElement!==t){var e,i,r,a=document.documentElement;document.body;a&&(ii.isIE||ii.isOpera||a.scrollLeft||a.scrollTop)&&(e=a.scrollLeft,i=a.scrollTop,r=a),t.focus(),r&&(r.scrollLeft=e,r.scrollTop=i)}},handle_mousedown:function(t){if(1!=t.stop&&!ei.isRightClick(t)){this.setFocus(this.network.getView()),this.isCtrlDown(t)?(this.addListener("mousemove","mouseup"),this.ctrlDownEvent=t):this.network.getDataBox().clearSelection();var e=this.network.getElementsByMouseEvent(t,!0),i=this.network.getFirstSelectElement(e);this.network.getDataBox().getSelectionModel().appendSelection(i),this.network.onSelect(i)}},handle_mousemove:function(t){var e=this.getBoundingByMouseEvent(t,this.ctrlDownEvent,this.network.devicePixelRatio);this.mousemoved=!0,this.network.areaPickingRect=e,this.network.paintTopCanvas()},handle_mouseup:function(t){this.network.areaPickingRect=null,this.network.paintTopCanvas();var e=this.getBoundingByMouseEvent(t,this.ctrlDownEvent);if(this.removeListener("mousemove","mouseup"),this.ctrlDownEvent=null,e&&this.mousemoved){var i=this.network.getElementsByBounding(e,!0,this._areaPickingLevel),r=new ci;if(i.length>0)for(var a=0;a<i.length;a++){var n=i[a].element;this.network.selectable(i[a])&&r.add(n)}r.size()>0&&this.network.getDataBox().getSelectionModel().appendSelection(r)}},getBoundingByMouseEvent:function(t,e,i){if(t&&e){var r=this.network.getView().getBoundingClientRect(),a=t.clientX-r.left,n=t.clientY-r.top,s=e.clientX-r.left,o=e.clientY-r.top,l=i||1,h=Math.min(a,s)*l,c=Math.min(n,o)*l,u=Math.abs(a-s)*l,f=Math.abs(n-o)*l;return 0===u&&0===f?null:{x:h,y:c,w:u,h:f}}}}),Je.TransformGizmo=function(){var t=new Je.TransformGizmoMaterial({color:16711680}),i=new Je.TransformGizmoMaterial({color:65280}),r=new Je.TransformGizmoMaterial({color:255});this.handleGizmos={X:[new Je.Cylinder(t,.005,.005,1,4,1,(!1),(!1)),new Ke(.5,0,0),new Ke(0,0,-Math.PI/2)],Y:[new Je.Cylinder(i,.005,.005,1,4,1,(!1),(!1)),new Ke(0,.5,0)],Z:[new Je.Cylinder(r,.005,.005,1,4,1,(!1),(!1)),new Ke(0,0,.5),new Ke(Math.PI/2,0,0)]};var a=!1,n=!1;this.showHelpers=!0,this.showable=!0,this.init=function(){Je.Element.call(this),this.handles=new Je.Element,this.pickers=new Je.Element,this.planes=new Je.Element,this.addChild(this.handles),this.addChild(this.pickers),this.addChild(this.planes);var t=new Je.BasicMaterial({wireframe:!1,color:65535,side:Je.DoubleSide}),e=(new Je.Plane(t,5e4,5e4,2,2),{XY:new Je.Plane(t,5e4,5e4,2,2),YZ:new Je.Plane(t,5e4,5e4,2,2),XZ:new Je.Plane(t,5e4,5e4,2,2),XYZE:new Je.Plane(t,5e4,5e4,2,2)});e.YZ._rotation.set(0,Math.PI/2,0),e.XZ._rotation.set(-Math.PI/2,0,0);for(var i in e)e[i].name=i,this.planes.addChild(e[i]),this.planes[i]=e[i],e[i]._visible=!0;for(var i in this.handleGizmos){var r=this.handleGizmos[i][0];if(r.name=i,this.handleGizmos[i][1]&&r._position.set(this.handleGizmos[i][1].x,this.handleGizmos[i][1].y,this.handleGizmos[i][1].z),this.handleGizmos[i][2]&&r._rotation.set(this.handleGizmos[i][2].x,this.handleGizmos[i][2].y,this.handleGizmos[i][2].z),r.mode=this.mode,this.handles.addChild(r),this.pickerGizmos&&this.pickerGizmos[i]){var a=this.pickerGizmos[i][0];this.pickerGizmos[i][1]&&a._position.set(this.pickerGizmos[i][1].x,this.pickerGizmos[i][1].y,this.pickerGizmos[i][1].z),this.pickerGizmos[i][2]&&a._rotation.set(this.pickerGizmos[i][2].x,this.pickerGizmos[i][2].y,this.pickerGizmos[i][2].z)}else var a=r.clone();a.mode=this.mode,a.name=i,this.pickers.addChild(a)}this.iterator(function(t){t instanceof Je.Entity&&Je.Utils.transformElement(t)})},this.hide=function(){this.handles.getChildren().forEach(function(t){t._visible=!1}),this.pickers.getChildren().forEach(function(t){t._visible=!1}),this.planes.getChildren().forEach(function(t){t._visible=!1})},this.show=function(){var t=this;this.handles.getChildren().forEach(function(e){e._visible=t.showHelpers&&t.showable}),this.pickers.getChildren().forEach(function(t){t._visible=a}),this.activePlane&&(this.activePlane._visible=n)},this.highlight=function(t){var i;for(var r in this.handleGizmos)i=this.handleGizmos[r][0],i.oldColor&&(i.material instanceof Je.ArrayMaterial?(i.material.materials[0].color.copy(i.oldColor),i.material.materials[0].opacity=i.oldOpacity):(i.material.color.copy(i.oldColor),i.material.opacity=i.oldOpacity),i.oldColor=null);this.handleGizmos[t]&&(i=this.handleGizmos[t][0],i.material instanceof Je.ArrayMaterial?(i.oldColor=i.oldColor||i.material.materials[0].color.clone(),i.oldOpacity=i.oldOpacit!==e?i.oldOpacity:i.material.materials[0].opacity,i.material.materials[0].opacity=1):(i.oldColor=i.oldColor||i.material.color.clone(),i.oldOpacity=i.material.opacity,i.setStyle("material.opacity",1)))},this.init()},Je.TransformGizmo.prototype=Object.create(Je.Element.prototype),Je.TransformGizmo.prototype.update=function(t,e){for(var i=new Ke(0,0,0),r=new Ke(0,1,0),a=new ti,n=0;n<this.getChildren().size();n++)for(var s=0;s<this.getChildren().get(n).getChildren().size();s++){var o=this.getChildren().get(n).getChildren().get(s);o.name.search("E")!=-1?(o.quaternion.setFromRotationMatrix(a.lookAt(e,i,r)),o._rotation.setEulerFromQuaternion(o.quaternion)):(o.quaternion.setFromEuler(t),o._rotation.setEulerFromQuaternion(o.quaternion))}},Je.TransformGizmoTranslate=function(){Je.TransformGizmo.call(this);var t=new Je.TransformGizmoMaterial({color:16711680,opacity:.2}),e=new Je.TransformGizmoMaterial({color:65280,opacity:.2}),i=new Je.TransformGizmoMaterial({color:255,opacity:.2}),r=new Je.Arrow(t,1,.03,.2,.05,30),a=new Je.Arrow(e,1,.03,.2,.05,30),n=new Je.Arrow(i,1,.03,.2,.05,30),s=new Je.TransformGizmoMaterial({color:255,opacity:.5}),o=new Je.TransformGizmoMaterial({color:16711680,opacity:.5}),l=new Je.TransformGizmoMaterial({color:65280,opacity:.5}),h=new Je.TransformGizmoMaterial({color:16777215,opacity:.5}),c=new Je.Circle(s,.5,10,0,Math.PI/2),u=new Je.Circle(o,.5,10,0,Math.PI/2),f=new Je.Circle(l,.5,10,0,Math.PI/2),d=new Je.Octahedron(h,1e-4,0);this.handleGizmos={X:[r,new Ke(1.6,0,0),new Ke(0,0,-Math.PI/2)],Y:[a,new Ke(0,1.6,0)],Z:[n,new Ke(0,0,1.6),new Ke(Math.PI/2,0,0)],XYZ:[d],XY:[c,new Ke(0,0,0)],YZ:[u,new Ke(0,0,0),new Ke(Math.PI/2,Math.PI/2,0)],XZ:[f,new Ke(0,0,0),new Ke(Math.PI/2,0,0)]};var h=new Je.TransformGizmoMaterial({color:16711680,opacity:.25}),p=new Je.TransformGizmoMaterial({color:65280,opacity:.25}),m=new Je.TransformGizmoMaterial({color:255,opacity:.25}),g=new Je.Cylinder(h,.075,0,1.2,4,1,(!1)),y=new Je.Cylinder(p,.075,0,1.2,4,1,(!1)),v=new Je.Cylinder(m,.075,0,1.2,4,1,(!1)),d=new Je.Octahedron(h,1e-4,0);this.pickerGizmos={X:[g,new Ke(1.6,0,0),new Ke(0,0,-Math.PI/2)],Y:[y,new Ke(0,1.6,0)],Z:[v,new Ke(0,0,1.6),new Ke(Math.PI/2,0,0)],XYZ:[d]},this.setActivePlane=function(t,e){var i=new ti;e.applyProjection(i.getInverse(i.extractRotation(this.planes.XY.worldMatrix))),"X"==t&&(this.activePlane=this.planes.XY,Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"==t&&(this.activePlane=this.planes.XY,Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"==t&&(this.activePlane=this.planes.XZ,Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==t&&(this.activePlane=this.planes.XYZE),"XY"==t&&(this.activePlane=this.planes.XY),"YZ"==t&&(this.activePlane=this.planes.YZ),"XZ"==t&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()},Je.TransformGizmoTranslate.prototype=Object.create(Je.TransformGizmo.prototype),Je.TransformGizmoTranslate.prototype.mode="translate",Je.TransformGizmoRotate=function(){Je.TransformGizmo.call(this);var t=new Je.TransformGizmoMaterial({color:16711680,opacity:.2}),e=new Je.TransformGizmoMaterial({color:65280,opacity:.2}),i=new Je.TransformGizmoMaterial({color:255,opacity:.2}),r=new Je.TransformGizmoMaterial({color:16776960}),a=new Je.TransformGizmoMaterial({color:7895160,opacity:.25}),a=new Je.TransformGizmoMaterial({color:16711680}),n=new Je.Torus(t,1,.02,4,32,Math.PI),s=new Je.Torus(e,1,.02,4,32,Math.PI),o=new Je.Torus(i,1,.02,4,32,Math.PI);new Je.Torus(r,1.25,.01,4,64),new Je.Torus(a,1,.01,4,64);this.handleGizmos={X:[n,new Ke(0,0,0),new Ke(0,-Math.PI/2,-Math.PI/2)],Y:[s,new Ke(0,0,0),new Ke(Math.PI/2,0,0)],Z:[o,new Ke(0,0,0),new Ke(0,0,-Math.PI/2)]};var l=new Je.TransformGizmoMaterial({color:16711680,opacity:.25}),h=new Je.TransformGizmoMaterial({color:65280,opacity:.25}),c=new Je.TransformGizmoMaterial({color:255,opacity:.25}),u=new Je.TransformGizmoMaterial({color:983040,opacity:.25}),f=new Je.Torus(l,1,.05,4,12,Math.PI),d=new Je.Torus(h,1,.05,4,12,Math.PI),p=new Je.Torus(c,1,.05,4,12,Math.PI);new Je.Torus(u,1,.05,2,24);this.pickerGizmos={X:[f,new Ke(0,0,0),new Ke(0,-Math.PI/2,-Math.PI/2)],Y:[d,new Ke(0,0,0),new Ke(Math.PI/2,0,0)],Z:[p,new Ke(0,0,0),new Ke(0,0,-Math.PI/2)]},this.setActivePlane=function(t){"E"==t&&(this.activePlane=this.planes.XYZE),"X"==t&&(this.activePlane=this.planes.YZ),"Y"==t&&(this.activePlane=this.planes.XZ),"Z"==t&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(t,e){Je.TransformGizmo.prototype.update.apply(this,arguments);var i={handles:this.handles,pickers:this.pickers},r=new ti,a=new Je.Euler(0,0,1),n=new Je.Quat,s=new Ke(1,0,0),o=new Ke(0,1,0),l=new Ke(0,0,1),h=new Je.Quat,c=new Je.Quat,u=new Je.Quat,f=e.clone();a.copy(this.planes.XY._rotation),n.setFromEuler(a),r.makeRotationFromQuaternion(n).getInverse(r),f.applyProjection(r);for(var d in i)for(var p=0;p<i[d].getChildren().size;p++){var m=i[d].getChildren().get(p);n.setFromEuler(a),"X"==m.name&&(h.setFromAxisAngle(s,Math.atan2(-f.y,f.z)),n.multiplyQuaternions(n,h),m.quaternion.copy(n)),"Y"==m.name&&(c.setFromAxisAngle(o,Math.atan2(f.x,f.z)),n.multiplyQuaternions(n,c),m.quaternion.copy(n)),"Z"==m.name&&(u.setFromAxisAngle(l,Math.atan2(f.y,f.x)),n.multiplyQuaternions(n,u),m.quaternion.copy(n))}},this.init()},Je.TransformGizmoRotate.prototype=Object.create(Je.TransformGizmo.prototype),Je.TransformGizmoRotate.prototype.mode="rotate",Je.TransformGizmoScale=function(){Je.TransformGizmo.call(this);var t=new Je.TransformGizmoMaterial({color:11184810,opacity:1}),e=new Je.TransformGizmoMaterial({color:16711680,opacity:.2}),i=new Je.TransformGizmoMaterial({color:65280,opacity:.2}),r=new Je.TransformGizmoMaterial({color:255,opacity:.2}),a=new Je.Cube(t,.25,.25,.25),n=new Je.Cylinder(null,.1,.1,1,4,1,(!1)),s=new Je.Cube(t,.225,.225,.225),o=new Je.Cylinder(null,.1,0,1,20,1,(!0));o._position.y=.05;var o=Je.Utils.createElement(n,o,e),l=(Je.Utils.createElement(n,o,i),Je.Utils.createElement(n,o,r),new Je.Cylinder(e,.08,0,1,4,1,(!1))),h=new Je.Cylinder(i,.08,0,1,4,1,(!1)),c=new Je.Cylinder(r,.08,0,1,4,1,(!1)),u=new Je.Element;u.material=new Je.BasicMaterial;var f=new Je.Element;f.material=new Je.BasicMaterial;var d=new Je.Element;d.material=new Je.BasicMaterial,this.handleGizmos={X:[l,new Ke(.5,0,0),new Ke(0,0,-Math.PI/2)],Y:[h,new Ke(0,.5,0)],Z:[c,new Ke(0,0,.5),new Ke(Math.PI/2,0,0)],XY:[u],YZ:[f],XZ:[d],XYZ:[a]};var p=new Je.TransformGizmoMaterial({color:16711680,opacity:.25}),m=new Je.TransformGizmoMaterial({color:65280,opacity:.25}),g=new Je.TransformGizmoMaterial({color:255,opacity:.25}),y=new Je.Cylinder(p,.125,0,1,4,1,(!1)),v=new Je.Cylinder(m,.125,0,1,4,1,(!1)),x=new Je.Cylinder(g,.125,0,1,4,1,(!1));this.pickerGizmos={X:[y,new Ke(.6,0,0),new Ke(Math.PI/4,0,-Math.PI/2)],Y:[v,new Ke(0,.6,0),new Ke(0,Math.PI/4,0)],Z:[x,new Ke(0,0,.6),new Ke(Math.PI/2,Math.PI/4,0)],XYZ:[s]},this.setActivePlane=function(t,e){var i=new ti;e.applyProjection(i.getInverse(i.extractRotation(this.planes.XY.worldMatrix))),"X"==t?(this.activePlane=this.planes.XY,Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)):"Y"==t?(this.activePlane=this.planes.XY,Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)):"Z"==t?(this.activePlane=this.planes.XZ,Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ)):"XYZ"==t?this.activePlane=this.planes.XYZE:this.activePlane=this.planes[t],this.hide(),this.show()},this.init()},Je.TransformGizmoScale.prototype=Object.create(Je.TransformGizmo.prototype),Je.TransformGizmoScale.prototype.mode="scale",Je.EditInteraction=function(i){function r(e){if(y.network._keyboardRemoveEnabled&&46==e.keyCode&&i.getDataBox().getSelectionModel().size()>0){var r="Delete?";t.confirm(r)&&i.getDataBox().removeSelection()}}function a(e){1===e.touches.length&&(y.deleteTimeoutId=setTimeout(function(){var i=y.network.getElementsByMouseEvent(e,y.selectUnVisible);if(i.length>0){var r=i[0],a="Delete?";t.confirm(a)&&y.network.getDataBox().remove(r.element)}},300))}function n(t){clearTimeout(y.deleteTimeoutId)}function s(t){clearTimeout(y.deleteTimeoutId)}function o(t){y.update()}function l(t){if(y.object&&!v){t.preventDefault(),t.stopPropagation();var e=t.touches?t.touches[0]:t,i=d(e,y.filterIntersectPicker(y.pickers));if(i)y.axis=i.object.name,y.setMode(i.object.mode);else{var r=u(t);r===y.object||null!=r&&r.editTransformToParent&&r.isDescendantOf(y.object)?(y.axis=y.getAxis(),y.setMode(y.getMode())):y.axis=!1}y.update(!0)}}function h(t){if(!t.stop){if(J.set(t.clientX,t.clientY),y.showHelpers&&y.axis||(f(t),l(t)),!y.object||v)return void y.network.dirtyNetwork();t.preventDefault(),t.stopPropagation();var r=t.touches?t.touches[0]:t;if(0===r.button||r.button==e){var a=y.filterIntersectPicker(y.pickers),n=d(r,a),s=u(t);if(n||(s===y.object||null!=s&&s.editTransformToParent&&s.isDescendantOf(y.object))&&y.getDefaultPickers()&&(n={object:y.getDefaultPickers()}),n){y.axis=n.object.name,T.copy(Y).sub(j).normalize(),y.gizmo[x].setActivePlane(y.axis,T);var o=d(r,[y.gizmo[x].activePlane]);if(!o&&s&&(o=d(r,[s])),o){V.copy(y.object._position),O.copy(y.object._scale),U.extractRotation(y.object.matrix),W.extractRotation(y.object.worldMatrix);var h=y.object.getParent();h==e&&(h=i),G.extractRotation(h.worldMatrix),H.getScaleFromMatrix(C.getInverse(h.worldMatrix)),b.copy(o.point)}}}y.update(!0),v=!0}}function c(t){if(y.object&&y.axis&&v){t.preventDefault(),t.stopPropagation(),t.stop=!0;var e=t.touches?t.touches[0]:t,r=d(e,[y.gizmo[x].activePlane]);if(r||(r=d(e,[y.object])),r){if(y.moving?i.fireInteractionEvent({kind:"liveMoveBetween",event:Wi}):(i.fireInteractionEvent({kind:"liveMoveStart",event:Wi}),y.moving=!0),_.copy(r.point),"translate"==x&&y.translateable){if(_.sub(b),_.multiply(H),"local"==y.space&&(_.applyMatrix4(C.getInverse(W)),y.axis.search("X")==-1&&(_.x=0),y.axis.search("Y")==-1&&(_.y=0),y.axis.search("Z")==-1&&(_.z=0),_.applyMatrix4(U),y.object.setPosition(V.clone().add(_))),"world"==y.space||y.axis.search("XYZ")!=-1){y.axis.search("X")==-1&&(_.x=0),y.axis.search("Y")==-1&&(_.y=0),y.axis.search("Z")==-1&&(_.z=0),_.applyMatrix4(C.getInverse(G)),y.object._position.copy(V);var a=y.object._position.clone().add(_);y.snap&&(y.axis.search("X")!=-1&&(a.x=Math.round(y.object._position.x/y.snap)*y.snap),y.axis.search("Y")!=-1&&(a.y=Math.round(y.object._position.y/y.snap)*y.snap),y.axis.search("Z")!=-1&&(a.z=Math.round(y.object._position.z/y.snap)*y.snap)),y.object.setPosition(a)}}else if("scale"==x&&y.scaleable){_.sub(b),_.multiply(H);var n=y.object._scale.clone(),s=(y.scaleRate||1)/10;if("XYZ"==y.axis)h=1+_.y*s,n.x=O.x*h,n.y=O.y*h,n.z=O.z*h;else if("XY"===y.axis){var o=1+_.x*s,l=1+_.y*s;if(y.forceSameScale){var h=Math.max(o,l);n.x=O.x*h,n.y=O.y*h}else n.x=O.x*o,n.y=O.y*l}else if("YZ"===y.axis){var c=1+_.z*s,l=1+_.y*s;if(y.forceSameScale){var h=Math.max(c,l);n.z=O.z*h,n.y=O.y*h}else n.z=O.z*c,n.y=O.y*l}else if("XZ"===y.axis){var o=1+_.x*s,c=1+_.z*s;if(y.forceSameScale){var h=Math.max(o,l);n.x=O.x*h,n.z=O.z*h}else n.x=O.x*o,n.z=O.z*c}else _.applyMatrix4(C.getInverse(W)),"X"==y.axis&&(n.x=O.x*(1+_.x*s)),"Y"==y.axis&&(n.y=O.y*(1+_.y*s)),"Z"==y.axis&&(n.z=O.z*(1+_.z*s));y.object.setScale(n)}else if("rotate"==x&&y.rotateable)if(_.sub(j),_.multiply(H),z.copy(b).sub(j),z.multiply(H),"E"==y.axis)_.applyMatrix4(C.getInverse(P)),z.applyMatrix4(C.getInverse(P)),M.set(Math.atan2(_.z,_.y),Math.atan2(_.x,_.z),Math.atan2(_.y,_.x)),S.set(Math.atan2(z.z,z.y),Math.atan2(z.x,z.z),Math.atan2(z.y,z.x)),L.setFromRotationMatrix(C.getInverse(G)),k.setFromAxisAngle(T,M.z-S.z),B.setFromRotationMatrix(W),L.multiplyQuaternions(L,k),L.multiplyQuaternions(L,B),y.object.quaternion.copy(L);else if("XYZE"==y.axis)k.setFromEuler(_.clone().cross(z).normalize()),L.setFromRotationMatrix(C.getInverse(G)),R.setFromAxisAngle(k,-_.clone().angleTo(z)),B.setFromRotationMatrix(W),L.multiplyQuaternions(L,R),L.multiplyQuaternions(L,B),y.object.quaternion.copy(L);else if("local"==y.space){_.applyMatrix4(C.getInverse(W)),z.applyMatrix4(C.getInverse(W)),M.set(Math.atan2(_.z,_.y),Math.atan2(_.x,_.z),Math.atan2(_.y,_.x)),S.set(Math.atan2(z.z,z.y),Math.atan2(z.x,z.z),Math.atan2(z.y,z.x)),B.setFromRotationMatrix(U),R.setFromAxisAngle(E,M.x-S.x),F.setFromAxisAngle(D,M.y-S.y),I.setFromAxisAngle(N,M.z-S.z),"X"==y.axis&&B.multiplyQuaternions(B,R),"Y"==y.axis&&B.multiplyQuaternions(B,F),"Z"==y.axis&&B.multiplyQuaternions(B,I),y.object.quaternion.copy(B);var u=y.object._rotation.clone();u.setEulerFromQuaternion(B),y.object.setRotation(u)}else if("world"==y.space){M.set(Math.atan2(_.z,_.y),Math.atan2(_.x,_.z),Math.atan2(_.y,_.x)),S.set(Math.atan2(z.z,z.y),Math.atan2(z.x,z.z),Math.atan2(z.y,z.x)),L.setFromRotationMatrix(C.getInverse(G)),R.setFromAxisAngle(E,M.x-S.x),F.setFromAxisAngle(D,M.y-S.y),I.setFromAxisAngle(N,M.z-S.z),B.setFromRotationMatrix(W),"X"==y.axis&&L.multiplyQuaternions(L,R),"Y"==y.axis&&L.multiplyQuaternions(L,F),"Z"==y.axis&&L.multiplyQuaternions(L,I),L.multiplyQuaternions(L,B),y.object.quaternion.copy(L);var u=y.object._rotation.clone();u.setEulerFromQuaternion(L),y.object.setRotation(u)}y.changed=!0}y.update(!0),y.updateTextNote(t,y.object)}}function u(t){var e=y.network.getElementsByMouseEvent(t);return i.getFirstEditElement(e)}function f(t){if(null===Z&&(Z=new Qe),Z.set(t.clientX,t.clientY),i.getDataBox().clearEditing(),0===Z.distanceTo(J)){var e=y.network.getElementsByMouseEvent(t),r=i.getFirstEditElement(e);r&&(r!==y.object,y.object=r,y.translateable&&y.gizmo.translate.show(),y.rotateable&&y.gizmo.rotate.show(),y.scaleable&&y.gizmo.scale.show()),r||(y.gizmo[x].hide(),y.gizmo.translate.hide(),y.gizmo.rotate.hide(),y.gizmo.scale.hide(),y.object=null)}else y.changed&&y.onElementPropertyChanged&&(y.changed=!1,y.moving=!1,y.onElementPropertyChanged(t,y.object),i.fireInteractionEvent({kind:"liveMoveEnd",event:{e:t,source:y.object,time:(new Date).getTime()}}));y.axis=!1,v=!1,y.update(!0),y.hideTextNote()}function d(t,e){if(!e)return null;var i=y.network.getPickingByEvent(t),r=i.intersectObjects(e,!0,!0);return!!r[0]&&r[0]}Je.BaseInteraction.call(this,i);var p=new Je.Element,m=i.getCamera(),g=i.getRootView();g=g!==e?g:document,this.domElement=g,this.gizmo={},this.gizmo.translate=new Je.TransformGizmoTranslate,this.gizmo.rotate=new Je.TransformGizmoRotate,this.gizmo.scale=new Je.TransformGizmoScale,p.addChild(this.gizmo.translate),p.addChild(this.gizmo.rotate),p.addChild(this.gizmo.scale),this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide(),this.object=!1,this.snap=!1,this.space="local",this.size=1,this.axis=!1;var y=this;this.scaleable=!0,this.rotateable=!0,this.translateable=!0,this.setShowHelpers(!0);var v=!1,x="translate",w={type:"change"},_=(new Je.Picking,new Je.Projector,new Ke,new Ke),b=new Ke,M=new Ke,S=new Ke,A=1,P=new ti,T=new Ke,C=new ti,z=new Ke,L=new Je.Quat,E=new Ke(1,0,0),D=new Ke(0,1,0),N=new Ke(0,0,1),B=new Je.Quat,R=new Je.Quat,F=new Je.Quat,I=new Je.Quat,k=new Je.Quat,V=new Ke,O=new Ke,U=new ti,G=new ti,H=new Ke,j=new Ke,X=new Je.Euler,W=new ti,Y=new Ke,q=new Je.Euler;this.showNote=!0,this.handleDataBoxChange=function(t){"remove"==t.kind?t.data==y.object&&(y.gizmo.translate.hide(),y.gizmo.rotate.hide(),y.gizmo.scale.hide()):"clear"==t.kind&&(y.gizmo.translate.hide(),y.gizmo.rotate.hide(),y.gizmo.scale.hide())},this.network.getDataBox().addDataBoxChangeListener(this.handleDataBoxChange,this),this.network.addPropertyChangeListener(function(t){if("dataBox"==t.property){var e=t.oldValue,i=t.value;e.removeDataBoxChangeListener(this.handleDataBoxChange),i.addDataBoxChangeListener(this.handleDataBoxChange,this)}}),this.defaultMode="TranslateXY",this.pickers=[],this.gizmo.translate.pickers.getChildren().forEach(function(t){y.pickers.push(t)}),this.gizmo.rotate.pickers.getChildren().forEach(function(t){y.pickers.push(t)}),this.gizmo.scale.pickers.getChildren().forEach(function(t){y.pickers.push(t)}),this.attach=function(t){y.object=t,this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide(),this.gizmo[x].show(),y.update()},this.detach=function(t){y.object=!1,this.axis=!1,this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide()},this.setMode=function(t){x=t?t:x,this.update()},this.setUp=function(){g.addEventListener("mousedown",h,!1),g.addEventListener("touchstart",h,!1),g.addEventListener("mousemove",l,!1),g.addEventListener("touchmove",l,!1),
g.addEventListener("mousemove",c,!1),g.addEventListener("touchmove",c,!1),g.addEventListener("mouseup",f,!1),g.addEventListener("mouseout",f,!1),g.addEventListener("touchend",f,!1),g.addEventListener("touchcancel",f,!1),g.addEventListener("touchleave",f,!1),g.addEventListener("keydown",r,!1),g.addEventListener("touchstart",a,!1),g.addEventListener("touchmove",n,!1),g.addEventListener("touchend",s,!1),g.addEventListener("mousewheel",o,!1),y.network.helperBox.addByDescendant(p)},this.tearDown=function(){g.removeEventListener("mousedown",h,!1),g.removeEventListener("touchstart",h,!1),g.removeEventListener("mousemove",l,!1),g.removeEventListener("touchmove",l,!1),g.removeEventListener("mousemove",c,!1),g.removeEventListener("touchmove",c,!1),g.removeEventListener("mouseup",f,!1),g.removeEventListener("mouseout",f,!1),g.removeEventListener("touchend",f,!1),g.removeEventListener("touchcancel",f,!1),g.removeEventListener("touchleave",f,!1),g.removeEventListener("keydown",r,!1),g.removeEventListener("touchstart",a,!1),g.removeEventListener("touchmove",n,!1),g.removeEventListener("touchend",s,!1),g.removeEventListener("mousewheel",o,!1),y.gizmo.translate.hide(),y.gizmo.rotate.hide(),y.gizmo.scale.hide(),y.network.helperBox.removeByDescendant(p)},this.setSnap=function(t){y.snap=t},this.setSize=function(t){y.size=t,y.dispatchEvent(w),this.update()},this.setSpace=function(t){y.space=t,this.update()},this.update=function(t){y.object&&(y.object.updateWorldMatrix(),j.getPositionFromMatrix(y.object.worldMatrix),X.setFromRotationMatrix(C.extractRotation(y.object.worldMatrix)),m.updateWorldMatrix(),Y.getPositionFromMatrix(m.worldMatrix),q.setFromRotationMatrix(C.extractRotation(m.worldMatrix)),A=j.distanceTo(Y)/12*y.size,p.setPosition(j),p.setScale(A,A,A),T.copy(Y).sub(j).normalize(),this.gizmo.scale.update(X,T),"local"==y.space?(this.gizmo.translate.update(X,T),this.gizmo.rotate.update(X,T)):(this.gizmo.translate.update(new Je.Euler,T),this.gizmo.rotate.update(new Je.Euler,T)),this.gizmo.translate.highlight(null),this.gizmo.rotate.highlight(null),this.gizmo.scale.highlight(null),this.gizmo[x].highlight(y.axis),p.updateWorldMatrix(!0),t&&y.network.dirtyNetwork())},this.getDefaultPickers=function(){return"TranslateX"===this.defaultMode?y.gizmo.translate.pickers.getChildren().get(0):"TranslateY"===this.defaultMode?y.gizmo.translate.pickers.getChildren().get(1):"TranslateZ"===this.defaultMode?y.gizmo.translate.pickers.getChildren().get(2):"TranslateXY"===this.defaultMode?y.gizmo.translate.pickers.getChildren().get(4):"TranslateYZ"===this.defaultMode?y.gizmo.translate.pickers.getChildren().get(5):"TranslateXZ"===this.defaultMode?y.gizmo.translate.pickers.getChildren().get(6):"TranslateXYZ"===this.defaultMode?y.gizmo.translate.pickers.getChildren().get(3):"RotateX"===this.defaultMode?y.gizmo.rotate.pickers.getChildren().get(0):"RotateY"===this.defaultMode?y.gizmo.rotate.pickers.getChildren().get(1):"RotateZ"===this.defaultMode?y.gizmo.rotate.pickers.getChildren().get(2):"ScaleX"===this.defaultMode?y.gizmo.scale.pickers.getChildren().get(0):"ScaleY"===this.defaultMode?y.gizmo.scale.pickers.getChildren().get(1):"ScaleZ"===this.defaultMode?y.gizmo.scale.pickers.getChildren().get(2):"ScaleXYZ"===this.defaultMode?y.gizmo.scale.pickers.getChildren().get(6):"ScaleXY"===this.defaultMode?y.gizmo.scale.pickers.getChildren().get(3):"ScaleYZ"===this.defaultMode?y.gizmo.scale.pickers.getChildren().get(4):"ScaleXZ"===this.defaultMode?y.gizmo.scale.pickers.getChildren().get(5):null},this.getMode=function(){var t=this.defaultMode;return t.startsWith("Translate")?"translate":t.startsWith("Rotate")?"rotate":t.startsWith("Scale")?"scale":"translate"},this.getAxis=function(){var t=this.defaultMode;return t.endsWith("XYZ")?"XYZ":t.endsWith("XY")?"XY":t.endsWith("YZ")?"YZ":t.endsWith("XZ")?"XZ":t.endsWith("Y")?"X":t.endsWith("Y")?"Y":t.endsWith("Z")?"Z":""};var Z=null,J=new Qe;this.filterIntersectPicker=function(t){var e=[];if(!this.showHelpers)return e;for(var i=0;i<t.length;i++){var r=t[i];r.getParent()===this.gizmo.translate.pickers&&this.translateable&&e.push(r),r.getParent()===this.gizmo.rotate.pickers&&this.rotateable&&e.push(r),r.getParent()===this.gizmo.scale.pickers&&this.scaleable&&e.push(r)}return e}},Je.extend(Je.EditInteraction,Je.BaseInteraction,{setShowHelpers:function(t){this.showHelpers=t,this.gizmo.translate.showHelpers=t,this.gizmo.rotate.showHelpers=t,this.gizmo.scale.showHelpers=t,this.resetHelpers()},onElementPropertyChanged:function(t,e){},resetHelpers:function(){this.showHelpers&&this.translateable&&this.object?this.gizmo.translate.show():this.gizmo.translate.hide(),this.showHelpers&&this.rotateable&&this.object?this.gizmo.rotate.show():this.gizmo.rotate.hide(),this.showHelpers&&this.scaleable&&this.object?this.gizmo.scale.show():this.gizmo.scale.hide(),this.update(!0)},setShowNote:function(t){this.showNote=t},setScaleable:function(t){this.scaleable=t,this.gizmo.scale.showable=t,this.resetHelpers()},setRotateable:function(t){this.rotateable=t,this.gizmo.rotate.showable=t,this.resetHelpers()},setTranslateable:function(t){this.translateable=t,this.gizmo.translate.showable=t,this.resetHelpers()},setDefaultMode:function(t){this.defaultMode=t},setScaleRate:function(t){this.scaleRate=t||1},setForceSameScale:function(t){this.forceSameScale=t},setSpaceMode:function(t){"world"==t?this.space="world":this.space="local",this.update()},createTextNote:function(){this.textNote=document.createElement("div"),this.textNote.style.position="relative",this.textNote.style.color="black",this.textNote.style.height="0px",this.textNote.style.zIndex="1000",this.domElement.appendChild(this.textNote);var t=document.createElement("table");this.noteTable=t,this.textNote.appendChild(this.noteTable);t.createTHead();t.style.borderLeft="1px solid #ffa500",t.style.borderTop="1px solid #ffa500",t.style.fontSize="14px",t.style.backgroundColor="rgba(255, 170, 13, 0.5)",t.setAttribute("border",0),t.setAttribute("cellspacing",0),t.setAttribute("cellpadding",0);for(var e=0;e<4;e++){for(var i=document.createElement("tr"),r=0;r<4;r++){var a=document.createElement("td");a.style.borderRight="1px solid #ffa500",a.style.borderBottom="1px solid #ffa500",a.style.paddingLeft="5px",a.style.paddingRight="5px",a.style.paddingTop="2px",a.style.paddingBottom="2px",0==e&&r>0||e>0&&0==r?(a.style.textAlign="center",a.style.fontWeight="bold"):a.style.textAlign="right",i.appendChild(a)}t.appendChild(i)}},showTextNote:function(){this.showNote&&(null==this.textNote&&this.createTextNote(),this.textNote.style.display="")},hideTextNote:function(){this.textNote&&(this.textNote.style.display="none")},updateTextNote:function(t,e){if(null!=e&&this.showNote){var i=this.network.getRootView().getBoundingClientRect();this.showTextNote(),this.textNote.style.top=t.clientY-i.top+20+"px",this.textNote.style.left=t.clientX-i.left+20+"px";for(var r=e.getRotation(),a=e.getPosition(),n=e.getScale(),s=[[" ","x","y","z"],["p",a.x,a.y,a.z],["r",r.x,r.y,r.z],["s",n.x,n.y,n.z]],o=this.noteTable,l=0;l<4;l++)for(var h=0;h<4;h++){var c=s[l][h];l>0&&h>0&&(c=2==l?(180*c/Math.PI).toFixed(0)+"&deg;":c.toFixed(2)),o.rows[l].cells[h].innerHTML=""+c}}}});var or=1e-5,lr=0,hr=1,cr=2,ur=3;Je.CSG=function(t){var e,i,r,a,n,s,o,l=[];if(!(t instanceof Je.Element)){if(t instanceof pr)return this.tree=t,this.matrix=new ti,this;throw"TGL.CSG: Given geometry is unsupported"}for(t.computeNodeData&&t.computeNodeData(),t.updateWorldMatrix(!0),this.matrix=t.worldMatrix.clone(),e=0,i=t.faces.length;e<i;e++){if(r=t.faces[e],n=t.uvs[e],s=t.uv2s[e],o=new fr,r instanceof mi)a=t.vertices[r.a],a=new dr(a.x,a.y,a.z,r.vertexNormals[0],new Qe(n[0].x,n[0].y),s[0].clone()),a.materialIndex=r.materialIndex,a.applyMatrix4(this.matrix),o.vertices.push(a),a=t.vertices[r.b],a=new dr(a.x,a.y,a.z,r.vertexNormals[1],new Qe(n[1].x,n[1].y),s[1].clone()),a.materialIndex=r.materialIndex,a.applyMatrix4(this.matrix),o.vertices.push(a),a=t.vertices[r.c],a=new dr(a.x,a.y,a.z,r.vertexNormals[2],new Qe(n[2].x,n[2].y),s[2].clone()),a.applyMatrix4(this.matrix),a.materialIndex=r.materialIndex,o.vertices.push(a);else{if(!(r instanceof gi))throw"Invalid face type at index "+e;a=t.vertices[r.a],a=new dr(a.x,a.y,a.z,r.vertexNormals[0],new Qe(n[0].x,n[0].y),s[0].clone()),a.materialIndex=r.materialIndex,a.applyMatrix4(this.matrix),o.vertices.push(a),a=t.vertices[r.b],a=new dr(a.x,a.y,a.z,r.vertexNormals[1],new Qe(n[1].x,n[1].y),s[1].clone()),a.materialIndex=r.materialIndex,a.applyMatrix4(this.matrix),o.vertices.push(a),a=t.vertices[r.c],a=new dr(a.x,a.y,a.z,r.vertexNormals[2],new Qe(n[2].x,n[2].y),s[2].clone()),a.materialIndex=r.materialIndex,a.applyMatrix4(this.matrix),o.vertices.push(a),a=t.vertices[r.d],a=new dr(a.x,a.y,a.z,r.vertexNormals[3],new Qe(n[3].x,n[3].y),s[3].clone()),a.applyMatrix4(this.matrix),a.materialIndex=r.materialIndex,o.vertices.push(a)}isNaN(o.calculateProperties().w)?console.log("Not right polygon"):l.push(o)}if(this.tree=new pr(l),this.tree.materialSize=t.getMaterialSize?t.getMaterialSize():0,t.material instanceof Je.ArrayMaterial)this.tree.material=t.material;else{var h=new Je.ArrayMaterial;this.tree.material=h;for(var e=0;e<this.tree.materialSize;e++)h.push(t.material)}},Je.CSG.prototype.substract=function(t){var e=this.tree.clone(),i=t.tree.clone();return e.sumMateriaSize(i),e.invert(),e.clipTo(i),i.clipTo(e),i.invert(),i.clipTo(e),i.invert(),e.build(i.allPolygons()),e.invert(),e=new Je.CSG(e),e.matrix=this.matrix,e},Je.CSG.prototype.union=function(t){var e=this.tree.clone(),i=t.tree.clone();return e.sumMateriaSize(i),e.clipTo(i),i.clipTo(e),i.invert(),i.clipTo(e),i.invert(),e.build(i.allPolygons()),e=new Je.CSG(e),e.matrix=this.matrix,e},Je.CSG.prototype.intersect=function(t){var e=this.tree.clone(),i=t.tree.clone();return e.sumMateriaSize(i),e.invert(),i.clipTo(e),i.invert(),e.clipTo(i),i.clipTo(e),e.build(i.allPolygons()),e.invert(),e=new Je.CSG(e),e.matrix=this.matrix,e},Je.CSG.prototype.inverse=function(){var t=this.tree.clone();return t.polygons.map(function(t){t.flip()}),t=new Je.CSG(t)},Je.CSG.prototype.toGeometry=function(t){var e,i,r,a,n,s,o,l,h,c,u,f=((new ti).getInverse(this.matrix),new Je.Entity(this.tree.material,t)),d=this.tree.allPolygons(),p=d.length,m={};for(e=0;e<p;e++)for(r=d[e],a=r.vertices.length,i=2;i<a;i++){c=[],u=[],l=r.vertices[0],c.push(new Qe(l.uv.x,l.uv.y)),u.push(l.uv2.clone());var g=l.materialIndex;l=new Ke(l.x,l.y,l.z),"undefined"!=typeof m[l.x+","+l.y+","+l.z]?n=m[l.x+","+l.y+","+l.z]:(f.vertices.push(l),n=m[l.x+","+l.y+","+l.z]=f.vertices.length-1),l=r.vertices[i-1],c.push(new Qe(l.uv.x,l.uv.y)),u.push(l.uv2.clone()),l=new Ke(l.x,l.y,l.z),"undefined"!=typeof m[l.x+","+l.y+","+l.z]?s=m[l.x+","+l.y+","+l.z]:(f.vertices.push(l),s=m[l.x+","+l.y+","+l.z]=f.vertices.length-1),l=r.vertices[i],c.push(new Qe(l.uv.x,l.uv.y)),u.push(l.uv2.clone()),l=new Ke(l.x,l.y,l.z),"undefined"!=typeof m[l.x+","+l.y+","+l.z]?o=m[l.x+","+l.y+","+l.z]:(f.vertices.push(l),o=m[l.x+","+l.y+","+l.z]=f.vertices.length-1),h=new mi(n,s,o,new Ke(r.normal.x,r.normal.y,r.normal.z)),h.materialIndex=g||0,f.faces.push(h),f.uvs.push(c),f.uv2s.push(u)}return f},Je.CSG.prototype.toMesh=function(t){var e=this.toGeometry(t);return e.computeBoundingBox(),e};var fr=function(t,i,r){t instanceof Array||(t=[]),this.vertices=t,t.length>0?this.calculateProperties():this.normal=this.w=e};fr.prototype.calculateProperties=function(){var t=this.vertices[0],e=this.vertices[1],i=this.vertices[2],r=e.clone().subtract(t),a=i.clone().subtract(t);return this.normal=r.cross(a).normalize(),this.w=this.normal.clone().dot(t),this},fr.prototype.clone=function(){var t,e,i=new fr;for(t=0,e=this.vertices.length;t<e;t++)i.vertices.push(this.vertices[t].clone());return i.calculateProperties(),i},fr.prototype.flip=function(){var t,e=[];for(this.normal.multiplyScalar(-1),this.w*=-1,t=this.vertices.length-1;t>=0;t--)e.push(this.vertices[t]);return this.vertices=e,this},fr.prototype.classifyVertex=function(t){var e=this.normal.dot(t)-this.w;return e<-or?cr:e>or?hr:lr},fr.prototype.classifySide=function(t){var e,i,r,a=0,n=0,s=t.vertices.length;for(e=0;e<s;e++)i=t.vertices[e],r=this.classifyVertex(i),r===hr?a++:r===cr&&n++;return a>0&&0===n?hr:0===a&&n>0?cr:0===a&&0===n?lr:ur},fr.prototype.splitPolygon=function(t,e,i,r,a){var n=this.classifySide(t);if(n===lr)(this.normal.dot(t.normal)>0?e:i).push(t);else if(n===hr)r.push(t);else if(n===cr)a.push(t);else{var s,o,l,h,c,u,f,d,p,m=[],g=[];for(o=0,s=t.vertices.length;o<s;o++)l=(o+1)%s,u=t.vertices[o],f=t.vertices[l],h=this.classifyVertex(u),c=this.classifyVertex(f),h!=cr&&m.push(u),h!=hr&&g.push(u),(h|c)===ur&&(d=(this.w-this.normal.dot(u))/this.normal.dot(f.clone().subtract(u)),p=u.interpolate(f,d),m.push(p),g.push(p));m.length>=3&&r.push(new fr(m).calculateProperties()),g.length>=3&&a.push(new fr(g).calculateProperties())}},Je.CSG.Polygon=fr;var dr=function(t,e,i,r,a,n){this.x=t,this.y=e,this.z=i,this.normal=r||new Ke,this.uv=a||new Qe,this.uv2=n||new Qe};dr.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},dr.prototype.clone=function(){var t=new dr(this.x,this.y,this.z,this.normal.clone(),this.uv.clone(),this.uv2.clone());return t.materialIndex=this.materialIndex,t},dr.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},dr.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},dr.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this},dr.prototype.cross=function(t){var e=this.x,i=this.y,r=this.z;return this.x=i*t.z-r*t.y,this.y=r*t.x-e*t.z,this.z=e*t.y-i*t.x,this},dr.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return this.x/=t,this.y/=t,this.z/=t,this},dr.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},dr.prototype.lerp=function(t,e){return this.add(t.clone().subtract(this).multiplyScalar(e)),this.normal.add(t.normal.clone().sub(this.normal).multiplyScalar(e)),this.uv.add(t.uv.clone().sub(this.uv).multiplyScalar(e)),this.uv2.add(t.uv2.clone().sub(this.uv2).multiplyScalar(e)),this},dr.prototype.interpolate=function(t,e){return this.clone().lerp(t,e)},dr.prototype.applyMatrix4=function(t){var e=this.x,i=this.y,r=this.z,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*r+a[12],this.y=a[1]*e+a[5]*i+a[9]*r+a[13],this.z=a[2]*e+a[6]*i+a[10]*r+a[14],this},Je.CSG.Vertex=dr;var pr=function(t){var i,r,a=[],n=[];if(this.polygons=[],this.front=this.back=e,t instanceof Array&&0!==t.length){for(this.divider=t[0].clone(),i=0,r=t.length;i<r;i++)this.divider.splitPolygon(t[i],this.polygons,this.polygons,a,n);a.length>0&&(this.front=new pr(a)),n.length>0&&(this.back=new pr(n))}};pr.isConvex=function(t){var e,i;for(e=0;e<t.length;e++)for(i=0;i<t.length;i++)if(e!==i&&t[e].classifySide(t[i])!==cr)return!1;return!0},pr.prototype.build=function(t){var e,i,r=[],a=[];for(this.divider||(this.divider=t[0].clone()),e=0,i=t.length;e<i;e++)this.divider.splitPolygon(t[e],this.polygons,this.polygons,r,a);r.length>0&&(this.front||(this.front=new pr),this.front.build(r)),a.length>0&&(this.back||(this.back=new pr),this.back.build(a))},pr.prototype.allPolygons=function(){var t=this.polygons.slice();return this.front&&(t=t.concat(this.front.allPolygons())),this.back&&(t=t.concat(this.back.allPolygons())),t},pr.prototype.clone=function(){var t=new pr;if(this.divider&&(t.divider=this.divider.clone()),t.polygons=this.polygons.map(function(t){return t.clone()}),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t.materialSize=this.materialSize,t.material=new Je.ArrayMaterial,this.material)for(var e=0;e<this.material.materials.length;e++)t.material.materials.push(this.material.materials[e]);return t},pr.prototype.invert=function(){var t,e,i;for(t=0,e=this.polygons.length;t<e;t++)this.polygons[t].flip();return this.divider&&this.divider.flip(),this.front&&this.front.invert(),this.back&&this.back.invert(),i=this.front,this.front=this.back,this.back=i,this},pr.prototype.clipPolygons=function(t){var e,i,r,a;if(!this.divider)return t.slice();for(r=[],a=[],e=0,i=t.length;e<i;e++)this.divider.splitPolygon(t[e],r,a,r,a);return this.front&&(r=this.front.clipPolygons(r)),a=this.back?this.back.clipPolygons(a):[],r.concat(a)},pr.prototype.clipTo=function(t){this.polygons=t.clipPolygons(this.polygons),this.front&&this.front.clipTo(t),this.back&&this.back.clipTo(t)},pr.prototype.sumMateriaSize=function(t){t.changeMaterialIndex(this.materialSize),this.materialSize=this.materialSize+t.materialSize;for(var e=0;e<t.material.materials.length;e++)this.material.materials.push(t.material.materials[e])},pr.prototype.changeMaterialIndex=function(t){for(var e=0;e<this.polygons.length;e++)for(var i=this.polygons[e],r=0;r<i.vertices.length;r++){var a=i.vertices[r];a.materialIndex=a.materialIndex+t}this.front&&this.front.changeMaterialIndex(t),this.back&&this.back.changeMaterialIndex(t)},Je.CSG.Node=pr,Je.XmlSerializer=function(t,e,i){this.dataBox=t,this.settings=e?e:new Je.SerializationSettings,this.filterFunction=i,this.ref=0,this.refMap={},this.idMap={},this.xmlString=""},Je.extend(Je.XmlSerializer,Object,{serialize:function(){return this.xmlString="<TGL version='"+Je.version+"' platform='html5'>\n",this.serializeBody(),this.xmlString+="</TGL>\n",this.xmlString},serializeBody:function(){this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable&&(this.xmlString+="<dataBox class='"+this.dataBox.getClassName()+"'>\n",this.dataBox.serializeXml(this,this.dataBox.newInstance()),this.xmlString+="</dataBox>\n"),this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(t){this.refMap[t.getId()]=this.ref++,t.getChildren().forEach(this.initRefs,this)},isSerializable:function(t){return!!this.dataBox.contains(t)&&!(this.filterFunction&&!this.filterFunction(t))},getPropertyType:function(t,e){var i=this.settings.getPropertyType(e);return i||t.__SizePropeties&&t.__SizePropeties.indexOf(e)!=-1&&(i="number"),i},serializeData:function(t){if(this.isSerializable(t)){var e=t.newInstance(),i=this.refMap[t.getId()];this.xmlString+="<data class='"+t.getClassName()+"' ref='"+i+"'",null!=this.settings.getPropertyType("id")&&(this.xmlString+=" id='"+t.getId()+"'"),this.xmlString+=">\n",t.serializeXml(this,e),this.xmlString+="</data>\n"}t.getChildren().forEach(this.serializeData,this)},serializePropertyXml:function(t,e,i){var r=this.getPropertyType(t,e);if(r){var a=Je.getValue(t,e,r),n=Je.getValue(i,e,r);a!==n&&this.serializeValue("p",e,a,n,r)}},serializeStyleXml:function(t,e,i){var r=this.settings.getStyleType(e);if(r){var a=t.getStyle(e),n=i.getStyle(e);a!=n&&this.serializeValue("s",e,a,n,r)}},serializeClientXml:function(t,e,i){var r=this.settings.getClientType(e);if(null!=r){var a=t.getClient(e),n=i.getClient(e);a!=n&&this.serializeValue("c",e,a,n,r)}},serializeValue:function(t,e,i,r,a){if("s"===t&&(i=this.flattenArray(i),i instanceof Array&&"string"!==a&&"color"!==a&&"number"!==a&&(a="list."+a,i=new ci(i))),null==i)this.xmlString+="\t<"+t+" n='"+e+"' none=''/>\n";else if("cdata"===a)this.xmlString+="\t<"+t+" n='"+e+"'><![CDATA["+i+"]]></"+t+">\n";else if("data"===a){var n=this.refMap[i.getId()];null!=n&&(this.xmlString+="\t<"+t+" n='"+e+"' ref='"+n+"'/>\n")}else"vec2"===a?r&&i.x===r.x&&i.y===r.y||(this.xmlString+="\t<"+t+" n='"+e+"' x='"+i.x+"' y='"+i.y+"'/>\n"):"vec3"===a?r&&i.x===r.x&&i.y===r.y&&i.z==r.z||(this.xmlString+="\t<"+t+" n='"+e+"' x='"+i.x+"' y='"+i.y+"' z='"+i.z+"'/>\n"):"list.vec2"===a?(this.xmlString+="\t<"+t+" n='"+e+"'>\n",i instanceof Array&&(i=new ci(i)),i.forEach(function(e){if(e instanceof Array){this.xmlString+="\t<"+t+">\n";for(var i=0;i<e.length;i++){var r=e[i];this.xmlString+="\t\t<p x='"+r.x+"' y='"+r.y+"'/>\n"}this.xmlString+="\t</"+t+">\n"}else this.xmlString+="\t\t<p x='"+e.x+"' y='"+e.y+"'/>\n"},this),this.xmlString+="\t</"+t+">\n"):"list.vec3"===a?(this.xmlString+="\t<"+t+" n='"+e+"'>\n",i instanceof Array&&(i=new ci(i)),i.forEach(function(e){if(e instanceof Array){this.xmlString+="\t<"+t+">\n";for(var i=0;i<e.length;i++){var r=e[i];this.xmlString+="\t<"+t+"' x='"+r.x+"' y='"+r.y+"' z='"+r.z+"'/>\n"}this.xmlString+="\t</"+t+">\n"}else this.xmlString+="\t\t<"+t+"' x='"+e.x+"' y='"+e.y+"' z='"+e.z+"'/>\n"},this),this.xmlString+="\t</"+t+">\n"):"list.string"===a||"list.number"===a||"list.color"===a?(this.xmlString+="\t<"+t+" n='"+e+"'>\n",i.forEach(function(t){this.xmlString+="\t\t<s>"+t+"</s>\n"},this),this.xmlString+="\t</"+t+">\n"):this.xmlString+="\t<"+t+" n='"+e+"'>"+i+"</"+t+">\n"},flattenArray:function(t){if(t instanceof Array){for(var e=0;e<t.length-1;e++)if(t[e]!=t[e+1]){if(!t[e]||!t[e].equals)return t;if(!t[e].equals(t[e+1]))return t}return t[0]}return t},deserialize:function(t,e){Je.isDeserializing=!0,this.xmlString=t;var i=Je.xml(t).documentElement;this.refMap={},this.idMap={};var r,a,n,s=new ci,o=new ci,l=i.getElementsByTagName("data"),h=l.length;for(n=0;n<h;n++){a=l[n];var c=a.getAttribute("class"),u=this.settings.getPropertyType("id");if(u&&a.hasAttribute("id")){var f=null;if("string"===u)f=a.getAttribute("id");else if("int"===u)f=parseInt(a.getAttribute("id"));else{if("number"!==u)throw"Unsupported id type '"+u+"'";f=parseFloat(a.getAttribute("id"))}if("remove"===a.getAttribute("action")){this.dataBox.removeById(f);continue}r=this.dataBox.getDataById(f),r||(r=Je.newInstance(c,f))}else r=Je.newInstance(c);if(a.hasAttribute("ref")){var d=a.getAttribute("ref");this.refMap[d]=r}s.add(r),o.add(a),this.idMap[r.getId()]=r}for(this.dataBox.forEach(function(t){this.idMap[t.getId()]=t},this),h=s.size(),n=0;n<h;n++)r=s.get(n),this.dataBox.containsById(r.getId())||(e&&!r.getParent()&&r.setParent(e),this.dataBox.add(r));for(n=0;n<h;n++)r=s.get(n),a=o.get(n),r.deserializeXml(this,a);this.settings.isDataBoxSerializable&&1===i.getElementsByTagName("dataBox").length&&this.dataBox.deserializeXml(this,i.getElementsByTagName("dataBox")[0]),Je.isDeserializing=!1},deserializePropertyXml:function(t,e,i){var r=this.getPropertyType(t,i);r&&Je.setValue(t,i,this.deserializeValue(e,r))},deserializeStyleXml:function(t,e,i){var r=this.settings.getStyleType(i);r&&t.setStyle(i,this.deserializeValue(e,r))},deserializeClientXml:function(t,e,i){var r=this.settings.getClientType(i);r&&t.setClient(i,this.deserializeValue(e,r))},deserializePoint:function(t){var e=t.getAttribute("x")?parseFloat(t.getAttribute("x")):null,i=t.getAttribute("a")?parseFloat(t.getAttribute("a")):null;if(null!=e){var r=t.getAttribute("y")?parseFloat(t.getAttribute("y")):null,a=t.getAttribute("z")?parseFloat(t.getAttribute("z")):null,n=t.getAttribute("w")?parseFloat(t.getAttribute("w")):null;return null!=n?new Je.Vec4(e,r,a,n):null!=a?new Je.Vec3(e,r,a):new Je.Vec2(e,r)}if(null!=i){var s=t.getAttribute("b")?parseFloat(t.getAttribute("b")):null,o=t.getAttribute("c")?parseFloat(t.getAttribute("c")):null,l=t.getAttribute("d")?parseFloat(t.getAttribute("d")):null;return null!=l?new Je.Face4(i,s,o,l):new Je.Face3(i,s,o)}return null},arrayStyleValue:function(t,e){var i=[];if(t.indexOf(",")){if(i=t.split(","),"string"===e)return i;if("number"===e){for(var r=[],a=0;a<i.length;a++)r.push(parseFloat(i[a]));return r}if("color"===e){for(var n=[],a=0;a<i.length;a++)n.push(new Je.Color(i[a]));return n}}},deserializeValue:function(t,e,i){if(t.hasAttribute("@none"))return null;var r="s"===t.nodeName,a=r&&t.textContent.indexOf(",")!==-1;if("string"===e)return a?this.arrayStyleValue(t.textContent,e):t.textContent;if("color"===e)return a?this.arrayStyleValue(t.textContent,e):t.textContent;if("number"===e)return a?this.arrayStyleValue(t.textContent,e):parseFloat(t.textContent);if("boolean"===e)return"true"===t.textContent;if("int"===e)return parseInt(t.textContent);if("point"===e)return this.deserializePoint(t);if("vec2"===e){var n=parseFloat(t.getAttribute("x")),s=parseFloat(t.getAttribute("y"));if(!isNaN(n)&&!isNaN(s)||!r)return new Je.Vec2(n,s);e="list.point"}if("vec3"===e){var n=parseFloat(t.getAttribute("x")),s=parseFloat(t.getAttribute("y")),o=parseFloat(t.getAttribute("z"));return new Je.Vec3(n,s,o)}if("data"===e){var l=t.getAttribute("ref"),h=this.refMap[l];return h?h:this.idMap[l]}var c,u,f,d;if("list.point"===e){var p=new ci,m=t.getElementsByTagName("p");for(c=m.length,d=0;d<c;d++){var g=m[d];p.add(this.deserializePoint(g))}return r?p._as:p}if("list.string"===e){var y=new ci;for(f=t.getElementsByTagName("s"),c=f.length,d=0;d<c;d++)y.add(f[d].textContent);return y}if("list.number"===e){for(u=new ci,f=t.getElementsByTagName("s"),c=f.length,d=0;d<c;d++)u.add(parseFloat(f[d].textContent));return u}if("array.string"===e)return t.textContent.split(",");if("array.number"===e){for(u=t.textContent.split(","),c=u.length,d=0;d<c;d++)u[d]=parseFloat(u[d]);return u}return"rectangle"===e?{x:parseFloat(t.getAttribute("x")),y:parseFloat(t.getAttribute("y")),width:parseFloat(t.getAttribute("w")),height:parseFloat(t.getAttribute("h"))}:t.textContent}}),Je.addMethod(Je.Data,{serializeXml:function(t,e){if(this.__SizePropeties&&this.__SizePropeties.length){var i,r;for(i=0,r=this.__SizePropeties.length;i<r;i++)this.serializePropertyXml(t,this.__SizePropeties[i],e)}else this.serializePropertyXml(t,"materialSize",e),this.vertices&&this.vertices.length&&this.serializePropertyXml(t,"vertices",e),this.faces&&this.faces.length&&this.serializePropertyXml(t,"faces",e),this.uvs&&this.uvs.length&&this.serializePropertyXml(t,"uvs",e);if(t.settings.isClientSerializable&&this._clientMap)for(var a in this._clientMap)this.serializeClientXml(t,a,e);this.serializePropertyXml(t,"name",e),this.serializePropertyXml(t,"parent",e)},serializePropertyXml:function(t,e,i){t.serializePropertyXml(this,e,i)},serializeClientXml:function(t,e,i){t.serializeClientXml(this,e,i)},deserializeXml:function(t,e){var i,r,a,n,s=e.getElementsByTagName("p"),o=s.length;for(i=0;i<o;i++)r=s[i],r.hasAttribute("n")&&this.deserializePropertyXml(t,r,r.getAttribute("n"));if(t.settings.isClientSerializable)for(a=e.getElementsByTagName("c"),o=a.length,i=0;i<o;i++)n=a[i],n.hasAttribute("n")&&this.deserializeClientXml(t,n,n.getAttribute("n"))},deserializePropertyXml:function(t,e,i){t.deserializePropertyXml(this,e,i)},deserializeClientXml:function(t,e,i){t.deserializeClientXml(this,e,i)}}),Je.addMethod(Je.Element,{serializeXml:function(t,e){if(t.settings.isStyleSerializable&&this.styleMap)for(var i in this.styleMap)this.isSideStyle(i)||this.serializeStyleXml(t,i,e);this.serializePropertyXml(t,"position",e),this.serializePropertyXml(t,"rotation",e),this.serializePropertyXml(t,"scale",e),Je.Element.superClass.serializeXml.call(this,t,e),this._alarmState.getHighestNativeAlarmSeverity()&&"alarmstate"===t.settings.getPropertyType("alarmState")&&(t.xmlString+="\t<p n='alarmState'>\n",Je.AlarmSeverity.forEach(function(e){var i=this.getNewAlarmCount(e);i>0&&(t.xmlString+="\t\t<n n='"+e.name+"' c='"+i+"'/>\n")},this._alarmState),Je.AlarmSeverity.forEach(function(e){var i=this.getAcknowledgedAlarmCount(e);i>0&&(t.xmlString+="\t\t<a n='"+e.name+"' c='"+i+"'/>\n")},this._alarmState),t.xmlString+="\t</p>\n")},serializeStyleXml:function(t,e,i){t.serializeStyleXml(this,e,i)},deserializeXml:function(t,e){if(Je.Element.superClass.deserializeXml.call(this,t,e),t.settings.isStyleSerializable){var i,r,a=e.getElementsByTagName("s"),n=a.length;for(i=0;i<n;i++)r=a[i],r.hasAttribute("n")&&this.deserializeStyleXml(t,r,r.getAttribute("n"))}},deserializeStyleXml:function(t,e,i){t.deserializeStyleXml(this,e,i)},deserializePropertyXml:function(t,e,i){if("alarmState"===i){if("alarmstate"===t.settings.getPropertyType("alarmState")){var r,a,n,s=e.getElementsByTagName("n");for(a=0;a<s.length;a++)n=s[a],r=twaver.AlarmSeverity.getByName(n.getAttribute("n")),this._alarmState.setNewAlarmCount(r,parseInt(n.getAttribute("c")));for(s=e.getElementsByTagName("a"),a=0;a<s.length;a++)n=s[a],r=twaver.AlarmSeverity.getByName(n.getAttribute("n")),this._alarmState.setAcknowledgedAlarmCount(r,parseInt(n.getAttribute("c")))}}else Je.Element.superClass.deserializePropertyXml.call(this,t,e,i)}}),Je.addMethod(Je.DataBox,{serializeXml:function(t,e){if(t.settings.isClientSerializable&&this._clientMap)for(var i in this._clientMap)this.serializeClientXml(t,i,e);this.serializePropertyXml(t,"name",e)},serializePropertyXml:function(t,e,i){t.serializePropertyXml(this,e,i)},serializeClientXml:function(t,e,i){t.serializeClientXml(this,e,i)},deserializeXml:function(t,e){var i,r,a,n,s=e.getElementsByTagName("p"),o=s.length;for(i=0;i<o;i++)r=s[i],r.hasAttribute("n")&&this.deserializePropertyXml(t,r,r.getAttribute("n"));if(t.settings.isClientSerializable)for(a=e.getElementsByTagName("c"),o=a.length,i=0;i<o;i++)n=a[i],n.hasAttribute("n")&&this.deserializeClientXml(t,n,n.getAttribute("n"))},deserializePropertyXml:function(t,e,i){t.deserializePropertyXml(this,e,i)},deserializeClientXml:function(t,e,i){t.deserializeClientXml(this,e,i)}}),Je.JsonSerializer=function(t,e,i){this.dataBox=t,this.settings=e?e:new Je.SerializationSettings,this.filterFunction=i,this.ref=0,this.refMap={},this.idMap={},this.jsonObject={}},Je.extend(Je.JsonSerializer,Object,{constructor:Je.JsonSerializer,className:"TGL.JsonSerializer",serialize:function(){return this.jsonObject={v:Je.version,platform:"html5"},this.serializeBody(),JSON.stringify(this.jsonObject)},serializeBody:function(){if(this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable){var t={"class":this.dataBox.getClassName(),p:{},s:{},c:{}};this.jsonObject.dataBox=t,this.dataBox.serializeJson(this,this.dataBox.newInstance(),t),xi.isEmptyObject(t.p)&&delete t.p,xi.isEmptyObject(t.s)&&delete t.s,xi.isEmptyObject(t.c)&&delete t.c}this.jsonObject.datas=[],this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(t){if(this.refMap[t.getId()]=this.ref++,t.getChildren().forEach(this.initRefs,this),t instanceof Je.ComboNode)for(var e=0;e<t.combos.length;e++){var i=t.combos[e];this.refMap[i.getId()]||(this.refMap[i.getId()]=this.ref++)}},isSerializable:function(t){return!!this.dataBox.contains(t)&&!(this.filterFunction&&!this.filterFunction(t))},serializeData:function(t){if(this.isSerializable(t)){var e=t.newInstance(),i=this.refMap[t.getId()],r={"class":t.getClassName(),ref:i,p:{},s:{},c:{}};this.settings.getPropertyType("id")&&(this.jsonObject.id=t.getId()),this.jsonObject.datas.push(r),t.serializeJson(this,e,r),xi.isEmptyObject(r.p)&&delete r.p,xi.isEmptyObject(r.s)&&delete r.s,xi.isEmptyObject(r.c)&&delete r.c}t.getChildren().forEach(this.serializeData,this)},serializeDataValue:function(t){var e=t.newInstance(),i=this.refMap[t.getId()],r={"class":t.getClassName(),ref:i,p:{},s:{},c:{}};return t.serializeJson(this,e,r),xi.isEmptyObject(r.p)&&delete r.p,xi.isEmptyObject(r.s)&&delete r.s,xi.isEmptyObject(r.c)&&delete r.c,r},getPropertyType:function(t,e){var i=this.settings.getPropertyType(e);return i||(t.__bool&&t.__bool.indexOf(e)!=-1?i="boolean":t.__SizePropeties&&t.__SizePropeties.indexOf(e)!=-1&&(i="number")),i},getStyleType:function(t,e){t.isSideStyle(e)&&(e=e.substr(e.indexOf(".")+1));var i=this.settings.getStyleType(e);return i},serializePropertyJson:function(t,e,i,r){var a=this.getPropertyType(t,e);if(a){var n=Je.getValue(t,e,a),s=Je.getValue(i,e,a);n!==s&&(n&&n.equals?!n.equals(s)&&this.serializeValue(e,n,s,a,r.p):this.serializeValue(e,n,s,a,r.p))}},serializeStyleJson:function(t,e,i,r){var a=this.getStyleType(t,e);if(a){var n=t.getStyle(e),s=i.getStyle(e);e.startsWith("m.")&&(n=this.flattenArray(n),s=this.flattenArray(s)),e.endsWith(".image")&&(n=this.encodeURI(n),s=this.encodeURI(s)),n!=s&&(n&&n.equals?!n.equals(s)&&this.serializeValue(e,n,s,a,r.s):this.serializeValue(e,n,s,a,r.s))}},serializeClientJson:function(t,e,i,r){var a=this.settings.getClientType(e);if(null!=a){var n=t.getClient(e),s=i.getClient(e);n!=s&&(n&&n.equals?!n.equals(s)&&this.serializeValue(e,n,s,a,r.c):this.serializeValue(e,n,s,a,r.c))}},serializeValue:function(t,e,i,r,a){if(null==e)a[t]=null;else if(e instanceof ci)a[t]=e._as;else if("data"===r){var n=this.refMap[e.getId()];
null!=n&&(a[t]=n)}else if("data.list"===r){for(var s=[],o=0;o<e.length;o++)s.push(this.serializeDataValue(e[o]));a[t]=s}else if("serializeabe.list"===r){for(var s=[],o=0;o<e.length;o++)s.push(e[o].serializeJsonValue());a[t]=s}else e.serializeJsonValue?a[t]=e.serializeJsonValue():a[t]=e},deserialize:function(t,e){Je.isDeserializing=!0,this.jsonObject=JSON.parse(t),this.refMap={},this.idMap={};var i,r=new ci,a=new ci,n=this.jsonObject.datas.length;null!=this.deserializeStartCreateData&&this.deserializeStartCreateData(n);for(var s=0;s<n;s++){var o=this.jsonObject.datas[s],l=o["class"],h=this.settings.getPropertyType("id");if(h&&null!=o.id){if("remove"===o.action){this.dataBox.removeById(o.id);continue}i=this.dataBox.getDataById(o.id),i||(i=Je.newInstance(l,o.id))}else{i=Je.newInstance(l)}null!=o.ref&&(this.refMap[o.ref]=i),r.add(i),a.add(o),this.idMap[i.getId()]=i,this.deserializeCreateData&&this.deserializeCreateData(s,n)}for(this.dataBox.forEach(function(t){this.idMap[t.getId()]=t},this),n=r.size(),this.deserializeStartFillData&&this.deserializeStartFillData(n),s=0;s<n;s++)i=r.get(s),i.deserializeJson(this,a.get(s)),this.deserializeFillData&&this.deserializeFillData(s,n);for(this.deserializeStartAddData&&this.deserializeStartAddData(n),s=0;s<n;s++)i=r.get(s),this.dataBox.containsById(i.getId())||(e&&!i.getParent()&&i.setParent(e),"TGL.Entity"===i.getClassName()&&(i.computed=!1,i.computeNodeData()),this.dataBox.add(i),this.deserializeAddData&&this.deserializeAddData(s,n));this.settings.isDataBoxSerializable&&this.jsonObject.dataBox&&this.dataBox.deserializeJson(this,this.jsonObject.dataBox),Je.isDeserializing=!1},deserializePropertyJson:function(t,e,i){var r=this.getPropertyType(t,i);r&&Je.setValue(t,i,this.deserializeValue(e,r))},deserializeStyleJson:function(t,e,i){var r=this.getStyleType(t,i);if(r){var a=this.deserializeValue(e,r);a._as&&(a=a._as),t.setStyle(i,a)}},deserializeClientJson:function(t,e,i){var r=this.settings.getClientType(i);r&&t.setClient(i,this.deserializeValue(e,r))},getClassName:function(t){if(null!=t)return t["class"]?t["class"]:t.w!==e&&t.x!==e&&t.y!==e&&t.z!==e?"TGL.Vec4":t.x!==e&&t.y!==e&&t.z!==e?"TGL.Vec3":t.x!==e&&t.y!==e?"TGL.Vec2":t.a!==e&&t.b!==e&&t.c!==e&&t.d!==e?"TGL.Face4":t.a!==e&&t.b!==e&&t.c!==e?"TGL.Face3":void 0},translateJson:function(t){if(null!=t){if(null!=this.getClassName(t)){var e=Je.newInstance(this.getClassName(t));if(e.deserializeJsonValue)e.deserializeJsonValue(t);else for(var i in t)e[i]=t[i];return e}if(t instanceof Array)for(var r=0;r<t.length;r++)t[r]=this.translateJson(t[r]);return t}},isChinese:function(t){return t=t||"",escape(t).indexOf("%u")>0},encodeURI:function(t){if(t instanceof Array){for(var e=0;e<t.length;e++)t[e]=this.encodeURI(t[e]);return t}return"string"==typeof t&&this.isChinese(t)?encodeURI(t):t},flattenArray:function(t){if(t instanceof Array){for(var e=0;e<t.length-1;e++)if(t[e]!=t[e+1]){if(!t[e]||!t[e].equals)return t;if(!t[e].equals(t[e+1]))return t}return t[0]}return t},deserializeValue:function(t,i){if("data"===i){var r=this.refMap[t];return r?r:this.idMap[t]}if("data.list"===i){for(var a,n,s=[],o=0;o<t.length;o++)a=t[o],n=Je.newInstance(a["class"]),null!=a.ref&&(this.refMap[a.ref]=n),n.deserializeJson(this,a),s.push(n);return s}if("color"===i&&t.r!=e){var l=new Je.Color;return l.setRGB(t.r,t.g,t.b),l}if("TGL.Path"===t["class"]){var h=new Je.Path;return h.deserializeJsonValue(t),h}if(t instanceof Array){for(var o=0;o<t.length;o++)t[o]=this.translateJson(t[o]);return t}return null!=this.getClassName(t)?this.translateJson(t):t}}),Je.addMethod(Je.DataBox,{serializeJson:function(t,e,i){if(t.settings.isClientSerializable&&this._clientMap)for(var r in this._clientMap)this.serializeClientJson(t,r,e,i);this.serializePropertyJson(t,"name",e,i)},serializePropertyJson:function(t,e,i,r){t.serializePropertyJson(this,e,i,r)},serializeClientJson:function(t,e,i,r){t.serializeClientJson(this,e,i,r)},deserializeJson:function(t,e){var i;for(i in e.p)this.deserializePropertyJson(t,e.p[i],i);if(t.settings.isClientSerializable)for(i in e.c)this.deserializeClientJson(t,e.c[i],i)},deserializePropertyJson:function(t,e,i){t.deserializePropertyJson(this,e,i)},deserializeClientJson:function(t,e,i){t.deserializeClientJson(this,e,i)}}),Je.addMethod(Je.Data,{serializeJson:function(t,e,i){if(this.__SizePropeties&&this.__SizePropeties.length){var r,a;for(r=0,a=this.__SizePropeties.length;r<a;r++)this.serializePropertyJson(t,this.__SizePropeties[r],e,i)}else this.materialSize&&this.serializePropertyJson(t,"materialSize",e,i),this instanceof Je.Entity&&(this.vertices&&this.vertices.length&&this.serializePropertyJson(t,"vertices",e,i),this.faces&&this.faces.length&&this.serializePropertyJson(t,"faces",e,i),this.uvs&&this.uvs.length&&this.serializePropertyJson(t,"uvs",e,i),this.uv2s&&this.uv2s.length&&this.serializePropertyJson(t,"uv2s",e,i));if(t.settings.isClientSerializable&&this._clientMap)for(var n in this._clientMap)this.serializeClientJson(t,n,e,i);this.serializePropertyJson(t,"name",e,i),this.serializePropertyJson(t,"parent",e,i)},serializePropertyJson:function(t,e,i,r){t.serializePropertyJson(this,e,i,r)},serializeClientJson:function(t,e,i,r){t.serializeClientJson(this,e,i,r)},deserializeJson:function(t,e){var i;for(i in e.p)this.deserializePropertyJson(t,e.p[i],i);if(t.settings.isClientSerializable)for(i in e.c)this.deserializeClientJson(t,e.c[i],i)},deserializePropertyJson:function(t,e,i){t.deserializePropertyJson(this,e,i)},deserializeClientJson:function(t,e,i){t.deserializeClientJson(this,e,i)}}),Je.addMethod(Je.Element,{serializeJson:function(t,e,i){if(t.settings.isStyleSerializable&&this.styleMap)for(var r in this.styleMap)this.isSideStyle(r)||this.serializeStyleJson(t,r,e,i);if(Je.Element.superClass.serializeJson.call(this,t,e,i),this.serializePropertyJson(t,"position",e,i),this.serializePropertyJson(t,"rotation",e,i),this.serializePropertyJson(t,"scale",e,i),this._alarmState.getHighestNativeAlarmSeverity()&&"alarmstate"===t.settings.getPropertyType("alarmState")){var a={n:{},a:{}};i.p.alarmState=a,Je.AlarmSeverity.forEach(function(t){var e=this.getNewAlarmCount(t);e>0&&(a.n[t.name]=e)},this._alarmState),Je.AlarmSeverity.forEach(function(t){var e=this.getAcknowledgedAlarmCount(t);e>0&&(a.a[t.name]=e)},this._alarmState),xi.isEmptyObject(a.n)&&delete a.n,xi.isEmptyObject(a.a)&&delete a.a,xi.isEmptyObject(a)&&delete i.p.alarmState}},serializeStyleJson:function(t,e,i,r){t.serializeStyleJson(this,e,i,r)},deserializeJson:function(t,e){if(Je.Element.superClass.deserializeJson.call(this,t,e),t.settings.isStyleSerializable)for(var i in e.s)this.deserializeStyleJson(t,e.s[i],i)},deserializeStyleJson:function(t,e,i){t.deserializeStyleJson(this,e,i)},deserializePropertyJson:function(t,e,i){if("alarmState"===i){if("alarmstate"===t.settings.getPropertyType("alarmState")){var r;for(r in e.n)this._alarmState.setNewAlarmCount(twaver.AlarmSeverity.getByName(r),e.n[r]);for(r in e.a)this._alarmState.setAcknowledgedAlarmCount(twaver.AlarmSeverity.getByName(r),e.a[r])}}else Je.Element.superClass.deserializePropertyJson.call(this,t,e,i)}}),Je.addMethod(Je.Light,{serializeJson:function(t,e,i){if(Je.Light.superClass.serializeJson.call(this,t,e,i),this.serializePropertyJson(t,"color",e,i),this.serializePropertyJson(t,"ambient",e,i),this.serializePropertyJson(t,"diffuse",e,i),this.serializePropertyJson(t,"specular",e,i),this.serializePropertyJson(t,"castShadow",e,i),this.serializePropertyJson(t,"onlyShadow",e,i),e.__accessor&&e.__accessor.length)for(var r=0;r<e.__accessor.length;r++)this.serializePropertyJson(t,e.__accessor[r],e,i)}});var mr=Je.Animate=function(t){var e=this;e.type=null==t.type?"number":t.type,e.delay=null==t.delay?0:t.delay,e.dur=null==t.dur?1e3:t.dur,e.interval=null==t.interval?0:t.interval,e.finish=null==t.finish?e.delay+e.dur+e.interval:t.finish,e.repeat=null==t.repeat?1:t.repeat,e.reverse=null==t.reverse||t.reverse,e.easing=null==t.easing?"easeNone":t.easing,e.onUpdate=t.onUpdate,e.onDone=t.onDone,e.onStop=t.onStop,e.onPlay=t.onPlay,e.attr=t.attr,e.source=t.source,e.filter=t.filter,e.from=t.from,e.to=t.to,e.start=null,e.time=0,e.total=0,e.count=0,e.started=!1,e.stopped=!1,e.id=yr++};Je.extend(Je.Animate,Object,{play:function(){return Ge(this)},stop:function(t){return Xe(this,t)},clone:function(){return new mr(this)},chain:function(t){var e,i=this;return i.onDone?(e=i.onDone,i.onDone=function(){e.call(i),t.play()}):i.onDone=function(){t.play()},i}});var gr={},yr=1,vr=!1;!function xr(t){requestAnimationFrame(xr),vr&&(vr=!1,Ye(t))}(0)}(window);