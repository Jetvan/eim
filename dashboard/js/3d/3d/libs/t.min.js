!function(t,e){function n(t,e,i,n,s,r){var a=s.realSize?s.realSize:s;e=e||"",e=String(e),t.font=i,t.fillStyle=n,t.strokeStyle="gray",t.textBaseline="middle",t.textAlign="center";for(var o=e.split("\n"),h=o.length,l=a.height/h,c=(s.height-a.height)/2,u=0;u<h;u++){var d=ri.getTextSize(i,o[u]).width,f=(s.height,d/2);"right"==r?(f=s.width-d/2,t.textAlign="center"):"left"==r?(f=d/2,t.textAlign="center",t.textBaseline="middle"):"center"==r&&(f=s.width/2),t.strokeText(o[u],f,l/2+u*l+c),t.fillText(o[u],f,l/2+u*l+c)}}function s(t,e){var i=0;if(t.shadowMatrix)for(var n=0,s=e.size();n<s;n++){var r=e.get(n);r.refreshShadowUniforms(t,i)&&i++}}function r(t,e){var i=0;if(t.pShadowMap)for(var n=0,s=e.size();n<s;n++){var r=e.get(n);r.refreshUniformsPointShadow(t,i)&&i++}}function o(t,e,i){e._modelViewMatrix||(e._modelViewMatrix=new ti),i.uniformMatrix4fv(t.modelViewMatrix,!1,e._modelViewMatrix.elements),t.normalMatrix&&i.uniformMatrix3fv(t.normalMatrix,!1,e._normalMatrix.elements)}function h(t,e,i){var n;return"fragment"===t?n=i.createShader(i.FRAGMENT_SHADER):"vertex"===t&&(n=i.createShader(i.VERTEX_SHADER)),i.shaderSource(n,e),i.compileShader(n),i.getShaderParameter(n,i.COMPILE_STATUS)?n:(console.log(i.getShaderInfoLog(n)),console.error(e),null)}function l(t,e){t.ambientLightColor.value=e.ambient,t.directionalLightColor.value=e.directional.colors,t.directionalLightDirection.value=e.directional.positions,t.pointLightColor.value=e.point.colors,t.pointLightPosition.value=e.point.positions,t.pointLightDistance.value=e.point.distances,t.spotLightColor.value=e.spot.colors,t.spotLightPosition.value=e.spot.positions,t.spotLightDistance.value=e.spot.distances,t.spotLightDirection.value=e.spot.directions,t.spotLightAngleCos.value=e.spot.anglesCos,t.spotLightExponent.value=e.spot.exponents,t.hemisphereLightSkyColor.value=e.hemi.skyColors,t.hemisphereLightGroundColor.value=e.hemi.groundColors,t.hemisphereLightDirection.value=e.hemi.positions}function d(t,e,i,n){t[e]=i.r*n,t[e+1]=i.g*n,t[e+2]=i.b*n}function f(t,e,i,n){t[e]=i.r*i.r*n,t[e+1]=i.g*i.g*n,t[e+2]=i.b*i.b*n}function g(t){var e=t;yi.isNaN(e._renderInterval)&&(e._renderInterval=10),e.__timeOutFunc||(e.__timeOutFunc=function(){requestAnimationFrame(e.__timeOutFunc),e.render()}),setTimeout(e.__timeOutFunc,e._renderInterval)}function _(t,e,i){null!=t&&("number"==typeof t?this.fromNumber(t,e,i):null==e&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,e))}function p(){return new _(null)}function v(t,e,i,n,s,r){for(;--r>=0;){var a=e*this[t++]+i[n]+s;s=Math.floor(a/67108864),i[n++]=67108863&a}return s}function m(t,e,i,n,s,r){for(var a=32767&e,o=e>>15;--r>=0;){var h=32767&this[t],l=this[t++]>>15,c=o*h+l*a;h=a*h+((32767&c)<<15)+i[n]+(1073741823&s),s=(h>>>30)+(c>>>15)+o*l+(s>>>30),i[n++]=1073741823&h}return s}function y(t,e,i,n,s,r){for(var a=16383&e,o=e>>14;--r>=0;){var h=16383&this[t],l=this[t++]>>14,c=o*h+l*a;h=a*h+((16383&c)<<14)+i[n]+s,s=(h>>28)+(c>>14)+o*l,i[n++]=268435455&h}return s}function A(t){return Ri.charAt(t)}function x(t,e){var i=Di[t.charCodeAt(e)];return null==i?-1:i}function w(t){for(var e=this.t-1;e>=0;--e)t[e]=this[e];t.t=this.t,t.s=this.s}function S(t){this.t=1,this.s=t<0?-1:0,t>0?this[0]=t:t<-1?this[0]=t+DV:this.t=0}function C(t){var e=p();return e.fromInt(t),e}function T(t,e){var i;if(16==e)i=4;else if(8==e)i=3;else if(256==e)i=8;else if(2==e)i=1;else if(32==e)i=5;else{if(4!=e)return void this.fromRadix(t,e);i=2}this.t=0,this.s=0;for(var n=t.length,s=!1,r=0;--n>=0;){var a=8==i?255&t[n]:x(t,n);a<0?"-"==t.charAt(n)&&(s=!0):(s=!1,0==r?this[this.t++]=a:r+i>this.DB?(this[this.t-1]|=(a&(1<<this.DB-r)-1)<<r,this[this.t++]=a>>this.DB-r):this[this.t-1]|=a<<r,r+=i,r>=this.DB&&(r-=this.DB))}8==i&&0!=(128&t[0])&&(this.s=-1,r>0&&(this[this.t-1]|=(1<<this.DB-r)-1<<r)),this.clamp(),s&&_.ZERO.subTo(this,this)}function E(){for(var t=this.s&this.DM;this.t>0&&this[this.t-1]==t;)--this.t}function L(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var i,n=(1<<e)-1,s=!1,r="",a=this.t,o=this.DB-a*this.DB%e;if(a-- >0)for(o<this.DB&&(i=this[a]>>o)>0&&(s=!0,r=A(i));a>=0;)o<e?(i=(this[a]&(1<<o)-1)<<e-o,i|=this[--a]>>(o+=this.DB-e)):(i=this[a]>>(o-=e)&n,o<=0&&(o+=this.DB,--a)),i>0&&(s=!0),s&&(r+=A(i));return s?r:"0"}function M(){var t=p();return _.ZERO.subTo(this,t),t}function P(){return this.s<0?this.negate():this}function k(t){var e=this.s-t.s;if(0!=e)return e;var i=this.t;if(e=i-t.t,0!=e)return e;for(;--i>=0;)if(0!=(e=this[i]-t[i]))return e;return 0}function I(t){var e,i=1;return 0!=(e=t>>>16)&&(t=e,i+=16),0!=(e=t>>8)&&(t=e,i+=8),0!=(e=t>>4)&&(t=e,i+=4),0!=(e=t>>2)&&(t=e,i+=2),0!=(e=t>>1)&&(t=e,i+=1),i}function R(){return this.t<=0?0:this.DB*(this.t-1)+I(this[this.t-1]^this.s&this.DM)}function D(t,e){var i;for(i=this.t-1;i>=0;--i)e[i+t]=this[i];for(i=t-1;i>=0;--i)e[i]=0;e.t=this.t+t,e.s=this.s}function B(t,e){for(var i=t;i<this.t;++i)e[i-t]=this[i];e.t=Math.max(this.t-t,0),e.s=this.s}function N(t,e){var i,n=t%this.DB,s=this.DB-n,r=(1<<s)-1,a=Math.floor(t/this.DB),o=this.s<<n&this.DM;for(i=this.t-1;i>=0;--i)e[i+a+1]=this[i]>>s|o,o=(this[i]&r)<<n;for(i=a-1;i>=0;--i)e[i]=0;e[a]=o,e.t=this.t+a+1,e.s=this.s,e.clamp()}function z(t,e){e.s=this.s;var i=Math.floor(t/this.DB);if(i>=this.t)return void(e.t=0);var n=t%this.DB,s=this.DB-n,r=(1<<n)-1;e[0]=this[i]>>n;for(var a=i+1;a<this.t;++a)e[a-i-1]|=(this[a]&r)<<s,e[a-i]=this[a]>>n;n>0&&(e[this.t-i-1]|=(this.s&r)<<s),e.t=this.t-i,e.clamp()}function O(t,e){for(var i=0,n=0,s=Math.min(t.t,this.t);i<s;)n+=this[i]-t[i],e[i++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n-=t.s;i<this.t;)n+=this[i],e[i++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;i<t.t;)n-=t[i],e[i++]=n&this.DM,n>>=this.DB;n-=t.s}e.s=n<0?-1:0,n<-1?e[i++]=this.DV+n:n>0&&(e[i++]=n),e.t=i,e.clamp()}function F(t,e){var i=this.abs(),n=t.abs(),s=i.t;for(e.t=s+n.t;--s>=0;)e[s]=0;for(s=0;s<n.t;++s)e[s+i.t]=i.am(0,n[s],e,s,0,i.t);e.s=0,e.clamp(),this.s!=t.s&&_.ZERO.subTo(e,e)}function V(t){for(var e=this.abs(),i=t.t=2*e.t;--i>=0;)t[i]=0;for(i=0;i<e.t-1;++i){var n=e.am(i,e[i],t,2*i,0,1);(t[i+e.t]+=e.am(i+1,2*e[i],t,2*i+1,n,e.t-i-1))>=e.DV&&(t[i+e.t]-=e.DV,t[i+e.t+1]=1)}t.t>0&&(t[t.t-1]+=e.am(i,e[i],t,2*i,0,1)),t.s=0,t.clamp()}function U(t,e,i){var n=t.abs();if(!(n.t<=0)){var s=this.abs();if(s.t<n.t)return null!=e&&e.fromInt(0),void(null!=i&&this.copyTo(i));null==i&&(i=p());var r=p(),a=this.s,o=t.s,h=this.DB-I(n[n.t-1]);h>0?(n.lShiftTo(h,r),s.lShiftTo(h,i)):(n.copyTo(r),s.copyTo(i));var l=r.t,c=r[l-1];if(0!=c){var u=c*(1<<this.F1)+(l>1?r[l-2]>>this.F2:0),d=this.FV/u,f=(1<<this.F1)/u,g=1<<this.F2,v=i.t,m=v-l,y=null==e?p():e;for(r.dlShiftTo(m,y),i.compareTo(y)>=0&&(i[i.t++]=1,i.subTo(y,i)),_.ONE.dlShiftTo(l,y),y.subTo(r,r);r.t<l;)r[r.t++]=0;for(;--m>=0;){var A=i[--v]==c?this.DM:Math.floor(i[v]*d+(i[v-1]+g)*f);if((i[v]+=r.am(0,A,i,m,0,l))<A)for(r.dlShiftTo(m,y),i.subTo(y,i);i[v]<--A;)i.subTo(y,i)}null!=e&&(i.drShiftTo(l,e),a!=o&&_.ZERO.subTo(e,e)),i.t=l,i.clamp(),h>0&&i.rShiftTo(h,i),a<0&&_.ZERO.subTo(i,i)}}}function H(t){var e=p();return this.abs().divRemTo(t,null,e),this.s<0&&e.compareTo(_.ZERO)>0&&t.subTo(e,e),e}function W(t){this.m=t}function X(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t}function G(t){return t}function Z(t){t.divRemTo(this.m,null,t)}function Y(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function q(t,e){t.squareTo(e),this.reduce(e)}function K(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var e=3&t;return e=e*(2-(15&t)*e)&15,e=e*(2-(255&t)*e)&255,e=e*(2-((65535&t)*e&65535))&65535,e=e*(2-t*e%this.DV)%this.DV,e>0?this.DV-e:-e}function Q(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function J(t){var e=p();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&e.compareTo(_.ZERO)>0&&this.m.subTo(e,e),e}function $(t){var e=p();return t.copyTo(e),this.reduce(e),e}function tt(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var i=32767&t[e],n=i*this.mpl+((i*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(i=e+this.m.t,t[i]+=this.m.am(0,n,t,e,0,this.m.t);t[i]>=t.DV;)t[i]-=t.DV,t[++i]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)}function et(t,e){t.squareTo(e),this.reduce(e)}function it(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function nt(){return 0==(this.t>0?1&this[0]:this.s)}function st(t,e){if(t>4294967295||t<1)return _.ONE;var i=p(),n=p(),s=e.convert(this),r=I(t)-1;for(s.copyTo(i);--r>=0;)if(e.sqrTo(i,n),(t&1<<r)>0)e.mulTo(n,s,i);else{var a=i;i=n,n=a}return e.revert(i)}function rt(t,e){var i;return i=t<256||e.isEven()?new W(e):new Q(e),this.exp(t,i)}function at(){var t=p();return this.copyTo(t),t}function ot(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function ht(){return 0==this.t?this.s:this[0]<<24>>24}function lt(){return 0==this.t?this.s:this[0]<<16>>16}function ct(t){return Math.floor(Math.LN2*this.DB/Math.log(t))}function ut(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function dt(t){if(null==t&&(t=10),0==this.signum()||t<2||t>36)return"0";var e=this.chunkSize(t),i=Math.pow(t,e),n=C(i),s=p(),r=p(),a="";for(this.divRemTo(n,s,r);s.signum()>0;)a=(i+r.intValue()).toString(t).substr(1)+a,s.divRemTo(n,s,r);return r.intValue().toString(t)+a}function ft(t,e){this.fromInt(0),null==e&&(e=10);for(var i=this.chunkSize(e),n=Math.pow(e,i),s=!1,r=0,a=0,o=0;o<t.length;++o){var h=x(t,o);h<0?"-"==t.charAt(o)&&0==this.signum()&&(s=!0):(a=e*a+h,++r>=i&&(this.dMultiply(n),this.dAddOffset(a,0),r=0,a=0))}r>0&&(this.dMultiply(Math.pow(e,r)),this.dAddOffset(a,0)),s&&_.ZERO.subTo(this,this)}function gt(t,e,i){if("number"==typeof e)if(t<2)this.fromInt(1);else for(this.fromNumber(t,i),this.testBit(t-1)||this.bitwiseTo(_.ONE.shiftLeft(t-1),wt,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(_.ONE.shiftLeft(t-1),this);else{var n=new Array,s=7&t;n.length=(t>>3)+1,e.nextBytes(n),s>0?n[0]&=(1<<s)-1:n[0]=0,this.fromString(n,256)}}function _t(){var t=this.t,e=new Array;e[0]=this.s;var i,n=this.DB-t*this.DB%8,s=0;if(t-- >0)for(n<this.DB&&(i=this[t]>>n)!=(this.s&this.DM)>>n&&(e[s++]=i|this.s<<this.DB-n);t>=0;)n<8?(i=(this[t]&(1<<n)-1)<<8-n,i|=this[--t]>>(n+=this.DB-8)):(i=this[t]>>(n-=8)&255,n<=0&&(n+=this.DB,--t)),0!=(128&i)&&(i|=-256),0==s&&(128&this.s)!=(128&i)&&++s,(s>0||i!=this.s)&&(e[s++]=i);return e}function pt(t){return 0==this.compareTo(t)}function vt(t){return this.compareTo(t)<0?this:t}function mt(t){return this.compareTo(t)>0?this:t}function yt(t,e,i){var n,s,r=Math.min(t.t,this.t);for(n=0;n<r;++n)i[n]=e(this[n],t[n]);if(t.t<this.t){for(s=t.s&this.DM,n=r;n<this.t;++n)i[n]=e(this[n],s);i.t=this.t}else{for(s=this.s&this.DM,n=r;n<t.t;++n)i[n]=e(s,t[n]);i.t=t.t}i.s=e(this.s,t.s),i.clamp()}function At(t,e){return t&e}function xt(t){var e=p();return this.bitwiseTo(t,At,e),e}function wt(t,e){return t|e}function bt(t){var e=p();return this.bitwiseTo(t,wt,e),e}function St(t,e){return t^e}function Ct(t){var e=p();return this.bitwiseTo(t,St,e),e}function Tt(t,e){return t&~e}function Et(t){var e=p();return this.bitwiseTo(t,Tt,e),e}function Lt(){for(var t=p(),e=0;e<this.t;++e)t[e]=this.DM&~this[e];return t.t=this.t,t.s=~this.s,t}function Mt(t){var e=p();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e}function Pt(t){var e=p();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e}function kt(t){if(0==t)return-1;var e=0;return 0==(65535&t)&&(t>>=16,e+=16),0==(255&t)&&(t>>=8,e+=8),0==(15&t)&&(t>>=4,e+=4),0==(3&t)&&(t>>=2,e+=2),0==(1&t)&&++e,e}function It(){for(var t=0;t<this.t;++t)if(0!=this[t])return t*this.DB+kt(this[t]);return this.s<0?this.t*this.DB:-1}function Rt(t){for(var e=0;0!=t;)t&=t-1,++e;return e}function Dt(){for(var t=0,e=this.s&this.DM,i=0;i<this.t;++i)t+=Rt(this[i]^e);return t}function Bt(t){var e=Math.floor(t/this.DB);return e>=this.t?0!=this.s:0!=(this[e]&1<<t%this.DB)}function Nt(t,e){var i=_.ONE.shiftLeft(t);return this.bitwiseTo(i,e,i),i}function zt(t){return this.changeBit(t,wt)}function Ot(t){return this.changeBit(t,Tt)}function Ft(t){return this.changeBit(t,St)}function Vt(t,e){for(var i=0,n=0,s=Math.min(t.t,this.t);i<s;)n+=this[i]+t[i],e[i++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n+=t.s;i<this.t;)n+=this[i],e[i++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;i<t.t;)n+=t[i],e[i++]=n&this.DM,n>>=this.DB;n+=t.s}e.s=n<0?-1:0,n>0?e[i++]=n:n<-1&&(e[i++]=this.DV+n),e.t=i,e.clamp()}function Ut(t){var e=p();return this.addTo(t,e),e}function Ht(t){var e=p();return this.subTo(t,e),e}function Wt(t){var e=p();return this.multiplyTo(t,e),e}function Xt(){var t=p();return this.squareTo(t),t}function Gt(t){var e=p();return this.divRemTo(t,e,null),e}function Zt(t){var e=p();return this.divRemTo(t,null,e),e}function Yt(t){var e=p(),i=p();return this.divRemTo(t,e,i),new Array(e,i)}function jt(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()}function qt(t,e){if(0!=t){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=t;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}}function Kt(){}function Qt(t){return t}function Jt(t,e,i){t.multiplyTo(e,i)}function $t(t,e){t.squareTo(e)}function te(t){return this.exp(t,new Kt)}function ee(t,e,i){var n=Math.min(this.t+t.t,e);for(i.s=0,i.t=n;n>0;)i[--n]=0;var s;for(s=i.t-this.t;n<s;++n)i[n+this.t]=this.am(0,t[n],i,n,0,this.t);for(s=Math.min(t.t,e);n<s;++n)this.am(0,t[n],i,n,0,e-n);i.clamp()}function ie(t,e,i){--e;var n=i.t=this.t+t.t-e;for(i.s=0;--n>=0;)i[n]=0;for(n=Math.max(e-this.t,0);n<t.t;++n)i[this.t+n-e]=this.am(e-n,t[n],i,0,0,this.t+n-e);i.clamp(),i.drShiftTo(1,i)}function ne(t){this.r2=p(),this.q3=p(),_.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}function se(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=p();return t.copyTo(e),this.reduce(e),e}function re(t){return t}function ae(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)}function oe(t,e){t.squareTo(e),this.reduce(e)}function he(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function le(t,e){var i,n,s=t.bitLength(),r=C(1);if(s<=0)return r;i=s<18?1:s<48?3:s<144?4:s<768?5:6,n=s<8?new W(e):e.isEven()?new ne(e):new Q(e);var a=new Array,o=3,h=i-1,l=(1<<i)-1;if(a[1]=n.convert(this),i>1){var c=p();for(n.sqrTo(a[1],c);o<=l;)a[o]=p(),n.mulTo(c,a[o-2],a[o]),o+=2}var u,d,f=t.t-1,g=!0,_=p();for(s=I(t[f])-1;f>=0;){for(s>=h?u=t[f]>>s-h&l:(u=(t[f]&(1<<s+1)-1)<<h-s,f>0&&(u|=t[f-1]>>this.DB+s-h)),o=i;0==(1&u);)u>>=1,--o;if((s-=o)<0&&(s+=this.DB,--f),g)a[u].copyTo(r),g=!1;else{for(;o>1;)n.sqrTo(r,_),n.sqrTo(_,r),o-=2;o>0?n.sqrTo(r,_):(d=r,r=_,_=d),n.mulTo(_,a[u],r)}for(;f>=0&&0==(t[f]&1<<s);)n.sqrTo(r,_),d=r,r=_,_=d,--s<0&&(s=this.DB-1,--f)}return n.revert(r)}function ce(t){var e=this.s<0?this.negate():this.clone(),i=t.s<0?t.negate():t.clone();if(e.compareTo(i)<0){var n=e;e=i,i=n}var s=e.getLowestSetBit(),r=i.getLowestSetBit();if(r<0)return e;for(s<r&&(r=s),r>0&&(e.rShiftTo(r,e),i.rShiftTo(r,i));e.signum()>0;)(s=e.getLowestSetBit())>0&&e.rShiftTo(s,e),(s=i.getLowestSetBit())>0&&i.rShiftTo(s,i),e.compareTo(i)>=0?(e.subTo(i,e),e.rShiftTo(1,e)):(i.subTo(e,i),i.rShiftTo(1,i));return r>0&&i.lShiftTo(r,i),i}function ue(t){if(t<=0)return 0;var e=this.DV%t,i=this.s<0?t-1:0;if(this.t>0)if(0==e)i=this[0]%t;else for(var n=this.t-1;n>=0;--n)i=(e*i+this[n])%t;return i}function de(t){var e=t.isEven();if(this.isEven()&&e||0==t.signum())return _.ZERO;for(var i=t.clone(),n=this.clone(),s=C(1),r=C(0),a=C(0),o=C(1);0!=i.signum();){for(;i.isEven();)i.rShiftTo(1,i),e?(s.isEven()&&r.isEven()||(s.addTo(this,s),r.subTo(t,r)),s.rShiftTo(1,s)):r.isEven()||r.subTo(t,r),r.rShiftTo(1,r);for(;n.isEven();)n.rShiftTo(1,n),e?(a.isEven()&&o.isEven()||(a.addTo(this,a),o.subTo(t,o)),a.rShiftTo(1,a)):o.isEven()||o.subTo(t,o),o.rShiftTo(1,o);i.compareTo(n)>=0?(i.subTo(n,i),e&&s.subTo(a,s),r.subTo(o,r)):(n.subTo(i,n),e&&a.subTo(s,a),o.subTo(r,o))}return 0!=n.compareTo(_.ONE)?_.ZERO:o.compareTo(t)>=0?o.subtract(t):o.signum()<0?(o.addTo(t,o),o.signum()<0?o.add(t):o):o}function fe(t){var e,i=this.abs();if(1==i.t&&i[0]<=Bi[Bi.length-1]){for(e=0;e<Bi.length;++e)if(i[0]==Bi[e])return!0;return!1}if(i.isEven())return!1;for(e=1;e<Bi.length;){for(var n=Bi[e],s=e+1;s<Bi.length&&n<Ni;)n*=Bi[s++];for(n=i.modInt(n);e<s;)if(n%Bi[e++]==0)return!1}return i.millerRabin(t)}function ge(t){var e=this.subtract(_.ONE),i=e.getLowestSetBit();if(i<=0)return!1;var n=e.shiftRight(i);t=t+1>>1,t>Bi.length&&(t=Bi.length);for(var s=p(),r=0;r<t;++r){s.fromInt(Bi[Math.floor(Math.random()*Bi.length)]);var a=s.modPow(n,this);if(0!=a.compareTo(_.ONE)&&0!=a.compareTo(e)){for(var o=1;o++<i&&0!=a.compareTo(e);)if(a=a.modPowInt(2,this),0==a.compareTo(_.ONE))return!1;if(0!=a.compareTo(e))return!1}}return!0}function _e(){this.i=0,this.j=0,this.S=new Array}function pe(t){var e,i,n;for(e=0;e<256;++e)this.S[e]=e;for(i=0,e=0;e<256;++e)i=i+this.S[e]+t[e%t.length]&255,n=this.S[e],this.S[e]=this.S[i],this.S[i]=n;this.i=0,this.j=0}function ve(){var t;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,t=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=t,this.S[t+this.S[this.i]&255]}function me(){return new _e}function ye(t){Oi[Fi++]^=255&t,Oi[Fi++]^=t>>8&255,Oi[Fi++]^=t>>16&255,Oi[Fi++]^=t>>24&255,Fi>=Vi&&(Fi-=Vi)}function Ae(){ye((new Date).getTime())}function xe(){if(null==zi){for(Ae(),zi=me(),zi.init(Oi),Fi=0;Fi<Oi.length;++Fi)Oi[Fi]=0;Fi=0}return zi.next()}function we(t){var e;for(e=0;e<t.length;++e)t[e]=xe()}function be(){}function Se(t,e){return new _(t,e)}function Ce(t,e){if(e<t.length+11)return null;for(var i=new Array,n=t.length-1;n>=0&&e>0;){var s=t.charCodeAt(n--);s<128?i[--e]=s:s>127&&s<2048?(i[--e]=63&s|128,i[--e]=s>>6|192):(i[--e]=63&s|128,i[--e]=s>>6&63|128,i[--e]=s>>12|224)}i[--e]=0;for(var r=new be,a=new Array;e>2;){for(a[0]=0;0==a[0];)r.nextBytes(a);i[--e]=a[0]}return i[--e]=2,i[--e]=0,new _(i)}function Te(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function Ee(t,e){this.n=Se(t,16),this.e=parseInt(e,16)}function Le(t){return t.modPowInt(this.e,this.n)}function Me(t){var e=Ce(t,this.n.bitLength()+7>>3);if(null==e)return null;var i=this.doPrivate(e);if(null==i)return null;var n=i.toString(16);return 0==(1&n.length)?n:"0"+n}function Pe(t,e){for(var i=t.toByteArray(),n=0;n<i.length&&0==i[n];)++n;if(i.length-n!=e-1||2!=i[n])return null;for(++n;0!=i[n];)if(++n>=i.length)return null;for(var s="";++n<i.length;){var r=255&i[n];r<128?s+=String.fromCharCode(r):r>191&&r<224?(s+=String.fromCharCode((31&r)<<6|63&i[n+1]),++n):(s+=String.fromCharCode((15&r)<<12|(63&i[n+1])<<6|63&i[n+2]),n+=2)}return s}function ke(t,e,i){this.n=Se(t,16),this.e=parseInt(e,16),this.d=Se(i,16)}function Ie(t,e,i,n,s,r,a,o){this.n=Se(t,16),this.e=parseInt(e,16),this.d=Se(i,16),this.p=Se(n,16),this.q=Se(s,16),this.dmp1=Se(r,16),this.dmq1=Se(a,16),this.coeff=Se(o,16)}function Re(t){if(null==this.p||null==this.q)return t.modPow(this.d,this.n);for(var e=t.mod(this.p).modPow(this.dmp1,this.p),i=t.mod(this.q).modPow(this.dmq1,this.q);e.compareTo(i)<0;)e=e.add(this.p);return e.subtract(i).multiply(this.coeff).mod(this.p).multiply(this.q).add(i)}function De(t){var e=Se(t,16),i=this.doPublic(e);return null==i?null:Pe(i,this.n.bitLength()+7>>3)}function Be(t,e){t.diffuse.value=e.color,t.opacity.value=e.opacity}function Ne(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}function ze(t,e){t.psColor.value=e.color,t.opacity.value=e.opacity,t.size.value=e.size,t.scale.value=e.scale||1,t.map.value=e.map}function Oe(t,e){return t.distance-e.distance}function Fe(t,e,i,n,s){(t instanceof Ke.Node||t instanceof Ke.Billboard)&&Ue(t,e,i,n,s)}function Ve(t,i,n,s,r){if(t!==e)for(var a=t.getDescendants(),o=0,h=a.length;o<h;o++)Fe(a[o],i,n,s,r)}function Ue(t,i,n,s,r){if(s||0!=r.isVisible(t)){if(t instanceof Ke.Billboard){var a=i.matrixPosition;a.setFromMatrixPosition(t.worldMatrix);var o=i.ray.distanceToPoint(a),h=t.material.alignment,l=new Ke.Plane(1,1);(h.x||h.y)&&(l.setPosition(h.x,h.y,0),l=Ke.Utils.transformElement(l,!0)),l.setPosition(a);var c=(new Je).getScaleFromMatrix(t.worldMatrix);l.setScale(c.x,c.y,1);var u=i.direction.clone(),d=l.getPosition().clone(),f=t.material;f&&f.vertical&&(u.y=0),d.sub(u),l.lookAt(d),l.updateWorldMatrix(!0);var g=[];return Ue(l,i,g,!0,r),0===g.length?n:(n.push({distance:g[0].distance,point:t._position,face:null,object:t,element:t}),n)}if(t instanceof Ke.Line){var _=1;_-=1;var p=Math.sqrt(i.linePrecision+_),v=p*p,m=t;if(null==m.boundingSphere&&m.computeBoundingSphere(),an.copy(m.boundingSphere),an.applyMatrix4(t.worldMatrix),i.ray.isIntersectionSphere(an)===!1)return n;nn.getInverse(t.worldMatrix),en.copy(i.ray).transform(nn);for(var y=m.vertices,A=y.length,x=new Je,w=new Je,b=t.type===Ke.LineStrip?1:2,S=0;S<A-1;S+=b){var C=en.distanceSqToSegment(y[S],y[S+1],w,x);if(!(C>v)){var o=en.origin.distanceTo(w);o<i.near||o>i.far||n.push({distance:o,point:x.clone().applyMatrix4(t.worldMatrix),face:null,faceIndex:null,element:t,object:t})}}return n}if(null===t.boundingSphere&&t.computeBoundingSphere(),an.set(t.worldMatrix.getPosition(),t.boundingSphere.radius*t.worldMatrix.getMaxScaleOnAxis()),!i.ray.isIntersectionSphere(an))return n;var T,E,L,M,m=t,y=m.vertices,P=t.material instanceof Ke.ArrayMaterial,k=P===!0?t.material.materials:null,I=t.material.side,p=i.precision;t.rotationWorldMatrix.extractRotation(t.worldMatrix),nn.getInverse(t.worldMatrix),en.copy(i.ray).transform(nn);for(var R=0,D=m.faces.length;R<D;R++){var B=m.faces[R],N=P===!0?k[B.materialIndex]:t.material,z=r.getOverLoadMaterial(t,N);if(z&&(N=z),N!==e&&N.visible!==!1&&(m.visible!==!1||s)&&(!N.transparent||0!=N.opacity)){sn.setFromNormalAndCoplanarPoint(B.normal,y[B.a]);var O=en.distanceToPlane(sn);if(!(Math.abs(O)<p||O<0)){I=N.side;var F=en.direction.dot(sn.normal);if((I===Ke.DoubleSide||(I===Ke.FrontSide?F<0:F>0))&&!(O<i.near||O>i.far)){rn=en.at(O,rn);var V,U=new Je,H=(B.materialIndex,!1);if(r&&r._selectTransparencyThreshold>0&&(H=1==N.transparent||N.alphaTest>0),B instanceof Ke.Face3){if(T=y[B.a],E=y[B.b],L=y[B.c],!Ke.Triangle.containsPoint(rn,T,E,L))continue;U=Ke.Triangle.barycoordFromPoint(rn,T,E,L)}else{if(!(B instanceof Ke.Face4))throw Error("face type not supported");T=y[B.a],E=y[B.b],L=y[B.c],M=y[B.d];var W=Ke.Triangle.containsPoint(rn,T,E,M),X=Ke.Triangle.containsPoint(rn,E,L,M);if(!W&&!X)continue;W?U=Ke.Triangle.barycoordFromPoint(rn,T,E,M):(U=Ke.Triangle.barycoordFromPoint(rn,E,L,M),V=!0)}var G=new Qe,Z=U.z,Y=U.x,j=U.y;if(m.uvs&&m.uvs[R]){var q=m.uvs[R];B instanceof Ke.Face3?(G.x=q[0].x*Y+q[1].x*j+q[2].x*Z,G.y=q[0].y*Y+q[1].y*j+q[2].y*Z):V?(G.x=q[1].x*Y+q[2].x*j+q[3].x*Z,G.y=q[1].y*Y+q[2].y*j+q[3].y*Z):(G.x=q[0].x*Y+q[1].x*j+q[3].x*Z,G.y=q[0].y*Y+q[1].y*j+q[3].y*Z)}var K,Q=1;if(G=r.debugUV||G,H){if(N.opacity<r._selectTransparencyThreshold)continue;if(null==N.map)Q=N.opacity;else{K=N.map._image;var J=yi.getPixelFromImage(K,G.x,G.y);Q=J[3]/255*(null==N.opacity?1:N.opacity)}Q<N.alphaTest?Q=0:0==N.transparent&&(Q=1)}Q<r._selectTransparencyThreshold||n.push({distance:O,point:i.ray.at(O),face:B,uv:G,faceIndex:R,element:t,object:t,side:F>0?1:-1})}}}}}}function He(t){if(!vn[t.id]){if(yn=!0,vn[t.id]=t,t.finish=null==t.finish?t.delay+t.dur+t.interval:t.finish,null==t.from&&t.attr&&t.source){var e;(e=t.attr.match(/^S[:@](.*)/i))?t.from=t.source.getStyle(e[1]):(e=t.attr.match(/^C[:@](.*)/i))?t.from=t.source.getClient(e[1]):t.from=twaver.Util.getValue(t.source,t.attr)}We(t),Xe(t)}return t}function We(t){var e=t.type,i=t.from,n=t.to;"number"===e?(t.from=i||0,t.to=n||0):"point"===e?(i?i.length&&(t.from={x:i[0],y:i[1]}):t.from="scale"===t.attr?{x:1,y:1}:{x:0,y:0},n?n.length&&(t.to={x:n[0],y:n[1]}):t.to="scale"===t.attr?{x:1,y:1}:{x:0,y:0}):"rect"===e?(i?i.length&&(t.from={x:i[0],y:i[1],w:i[2],h:i[3]}):t.from={x:0,y:0,w:0,h:0},n?n.length&&(t.to={x:n[0],y:n[1],w:n[2],h:n[3]}):t.to={x:0,y:0,w:0,h:0}):"color"===e?(t.from=getColorValue(i),t.to=getColorValue(n)):"set"!==e&&"group_set"===e,t.current=t.from}function Xe(t){var e=t.type,i=t.from,n=t.to;"number"===e?t.delta=n-i:"point"===e?t.delta={x:n.x-i.x,y:n.y-i.y}:"rect"===e?t.delta={x:n.x-i.x,y:n.y-i.y,w:n.w-i.w,h:n.h-i.h}:"color"===e?t.delta={r:n.r-i.r,g:n.g-i.g,b:n.b-i.b,a:n.a-i.a}:"set"!==e&&"group_set"===e}function Ge(t,e){return vn[t.id]&&(null==e&&(e=!0),e&&qe(t,t.to),t.onStop&&t.onStop(),t.time=0,t.total=0,t.start=null,t.count=0,t.started=!1,t.stopped=!1,delete vn[t.id]),t}function Ze(t){null==t&&(t=!0),Object.keys(vn).forEach(function(e){var i=vn[e];t&&qe(i,i.to),i.onStop&&i.onStop()}),vn={}}function Ye(t){Object.keys(vn).forEach(function(e){var i=vn[e];if(i){if(null==i.start&&(i.start=t),i.total=t-i.start,i.total>i.delay){i.time=i.total-i.delay;var n=!1;if(i.time>=i.dur&&(i.time=i.dur,n=!0),!i.stopped&&qe(i,je(i)),i.stopped=n,i.total>=i.finish)if(i.count++,i.count>=i.repeat)Ge(i,!1),i.onDone&&i.onDone();else if(i.time=0,i.total=0,i.start=null,i.stopped=!1,i.reverse){var s=i.from;i.from=i.to,i.to=s,Xe(i)}}!yn&&(yn=!0)}})}function je(t,e){var i=t.type,n=t.delta,s=t.from,r=t.time,a=t.dur,o=li[t.easing||"easeNone"];return o||(o=li.easeNone),"number"===i?e=o(r,s,n,a):"point"===i?e={x:o(r,s.x,n.x,a),y:o(r,s.y,n.y,a)}:"rect"===i?e={x:o(r,s.x,n.x,a),y:o(r,s.y,n.y,a),w:o(r,s.w,n.w,a),h:o(r,s.h,n.h,a)}:"color"===i?e="rgba("+Math.floor(o(r,s.r,n.r,a))+","+Math.floor(o(r,s.g,n.g,a))+","+Math.floor(o(r,s.b,n.b,a))+","+Math.floor(o(r,s.a,n.a,a))+")":"set"===i?t.time&&(e=t.to):"group_set"===i&&(e=t.to[t.groupIndex]),t.current=e,e}function qe(t,e){if(t.started||(t.started=!0,t.onPlay&&t.onPlay()),t.filter&&(e=t.filter(e)),t.attr&&t.source){var i;(i=t.attr.match(/^S[:@](.*)/i))?t.source.setStyle(i[1],e):(i=t.attr.match(/^C[:@](.*)/i))?t.source.setClient(i[1],e):twaver.Util.setValue(t.source,t.attr,e)}t.onUpdate&&t.onUpdate(e)}self.Int32Array=self.Int32Array||Array,self.Float32Array=self.Float32Array||Array,Object.create=Object.create||function(t){var e=function(){};return e.prototype=t,new e};var Ke={version:"2.0.6",_id:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],id:function(t){t=null==t?"":t;for(var e=[],i=0;i<32;i++)e[i]=this._id[Math.floor(16*Math.random())];return e[12]="4",e[16]=this._id[3&e[16]|8],t+e.join("")},ip:function(t,e,i,n){var s=i+e;t[Ke.getter(e,n)]=function(){return this[s]},t[Ke.setter(e)]=function(t){var i=this[s];i!==t&&(this.setPropertyValue?this.setPropertyValue(s,t)&&(this.onPropertyChange(e,i,t),this.firePropertyChange(e,i,t)):(this[s]=t,this.onPropertyChange(e,i,t),this.firePropertyChange(e,i,t)))}},getter:function(t,e){var i=t.charAt(0).toUpperCase()+t.slice(1),n=/ble$/.test(t)||/ed$/.test(t)?"is":"get";return e&&e.indexOf(t)!=-1&&(n="is"),n+i},setter:function(t){var e=t.charAt(0).toUpperCase()+t.slice(1);return"set"+e},getValue:function(t,e,i){var n=e.charAt(0).toUpperCase()+e.slice(1),s="get"+n,r="is"+n;return i?"boolean"===i?t[r]():(null==t[s]&&console.log("get Function "+s+" not exist"),t[s]()):t[s]?t[s]():t[r]?t[r]():t[e]},setValue:function(t,e,i){t["set"+e.charAt(0).toUpperCase()+e.slice(1)](i)},clone:function(t){if(!t)return null;var e={};for(var i in t)e[i]=t[i];return e},addMethod:function(t,e){var i=t.prototype;for(var n in e)i[n]=e[n]},classCache:{},getClass:function(e){var i=Ke.classCache[e];if(!i){var n=e.split("."),s=n.length;i=t;for(var r=0;r<s;r++)i=i[n[r]];Ke.classCache[e]=i}return i},newInstance:function(t){"string"==typeof t&&(t=Ke.getClass(t),t=t.prototype);var e=t.constructor;if(!e)return null;var i=arguments.length,n=arguments;if(1===i)return new e;if(2===i)return new e(n[1]);if(3===i)return new e(n[1],n[2]);if(4===i)return new e(n[1],n[2],n[3]);if(5===i)return new e(n[1],n[2],n[3],n[4]);if(6===i)return new e(n[1],n[2],n[3],n[4],n[5]);if(7===i)return new e(n[1],n[2],n[3],n[4],n[5],n[6]);if(8===i)return new e(n[1],n[2],n[3],n[4],n[5],n[6],n[7]);throw"don't support args more than 7"},xml:function(e){if(t.DOMParser)return(new DOMParser).parseFromString(e,"text/xml");var i=new ActiveXObject("Microsoft.XmlDOM");return i.async=!1,i.loadXml(e),i}};t.TGL=Ke,t.mono=Ke;Ke.extend=function(t,e,i){if(e){var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.superClass=e.prototype,e.prototype.constructor==Object.prototype.constructor&&(e.prototype.constructor=e)}var s=t.prototype;if(i){s.getClassName=function(){return i.className};for(var r in i){if("__accessor"===r)for(var a=i.__accessor,o=i.__bool,h=0;h<a.length;h++){var l=a[h];Ke.ip(s,l,"",o)}else if("___accessor"===r)for(var a=i.___accessor,h=0;h<a.length;h++){var l=a[h];Ke.ip(s,l,"_",o)}s[r]=i[r]}i.constructor&&(s.newInstance=function(){return Ke.newInstance(this)})}},Ke.defaultEulerOrder="XYZ",String.prototype.startsWith=String.prototype.startsWith||function(t){return this.slice(0,t.length)===t},String.prototype.endsWith=String.prototype.endsWith||function(t){var e=String(t),i=this.lastIndexOf(e);return(-1<i&&i)===this.length-e.length},String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},function(){for(var i=0,n=["ms","moz","webkit","o"],s=0;s<n.length&&!t.requestAnimationFrame;++s)t.requestAnimationFrame=t[n[s]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[n[s]+"CancelAnimationFrame"]||t[n[s]+"CancelRequestAnimationFrame"];t.requestAnimationFrame===e&&(t.requestAnimationFrame=function(e,n){var s=Date.now(),r=Math.max(0,16-(s-i)),a=t.setTimeout(function(){e(s+r)},r);return i=s+r,a}),t.cancelAnimationFrame=t.cancelAnimationFrame||function(e){t.clearTimeout(e)}}(),Ke.CullFaceNone=0,Ke.CullFaceBack=1,Ke.CullFaceFront=2,Ke.CullFaceFrontBack=3,Ke.FrontFaceDirectionCW=0,Ke.FrontFaceDirectionCCW=1,Ke.BasicShadowMap=0,Ke.PCFShadowMap=1,Ke.PCFSoftShadowMap=2,Ke.FrontSide="front",Ke.BackSide="back",Ke.DoubleSide="both",Ke.BothSide="both",Ke.NoShading=0,Ke.FlatShading=1,Ke.SmoothShading=2,Ke.NormalTypeFlat="flat",Ke.NormalTypeSmooth="smooth",Ke.NoColors=0,Ke.FaceColors=1,Ke.VertexColors=2,Ke.NoBlending=0,Ke.NormalBlending=1,Ke.AdditiveBlending=2,Ke.SubtractiveBlending=3,Ke.MultiplyBlending=4,Ke.CustomBlending=5,Ke.AddEquation=100,Ke.SubtractEquation=101,Ke.ReverseSubtractEquation=102,Ke.ZeroFactor=200,Ke.OneFactor=201,Ke.SrcColorFactor=202,Ke.OneMinusSrcColorFactor=203,Ke.SrcAlphaFactor=204,Ke.OneMinusSrcAlphaFactor=205,Ke.DstAlphaFactor=206,Ke.OneMinusDstAlphaFactor=207,Ke.DstColorFactor=208,Ke.OneMinusDstColorFactor=209,Ke.SrcAlphaSaturateFactor=210,Ke.MultiplyOperation=0,Ke.MixOperation=1,Ke.AddOperation=2,Ke.UVMapping=function(){},Ke.CubeReflectionMapping=function(){},Ke.CubeRefractionMapping=function(){},Ke.SphericalReflectionMapping=function(){},Ke.SphericalRefractionMapping=function(){},Ke.RepeatWrapping="repeat",Ke.ClampToEdgeWrapping="clamp",Ke.MirroredRepeatWrapping="mirrored",Ke.NearestFilter=1003,Ke.NearestMipMapNearestFilter=1004,Ke.NearestMipMapLinearFilter=1005,Ke.LinearFilter=1006,Ke.LinearMipMapNearestFilter=1007,Ke.LinearMipMapLinearFilter=1008,Ke.UnsignedByteType=1009,Ke.ByteType=1010,Ke.ShortType=1011,Ke.UnsignedShortType=1012,Ke.IntType=1013,Ke.UnsignedIntType=1014,Ke.FloatType=1015,Ke.UnsignedShort4444Type=1016,Ke.UnsignedShort5551Type=1017,Ke.UnsignedShort565Type=1018,Ke.AlphaFormat=1019,Ke.RGBFormat=1020,Ke.RGBAFormat=1021,Ke.LuminanceFormat=1022,Ke.LuminanceAlphaFormat=1023,Ke.RGB_S3TC_DXT1_Format=2001,Ke.RGBA_S3TC_DXT1_Format=2002,Ke.RGBA_S3TC_DXT3_Format=2003,Ke.RGBA_S3TC_DXT5_Format=2004,Ke.Gradient_Linear_U=1,Ke.Gradient_Linear_V=2,Ke.Gradient_Linear_UV=3,Ke.Gradient_Linear_NUV=4,Ke.Gradient_Linear_Radial=5,Ke.Gradient_Linear_Sweep=6,Ke.Math={clamp:function(t,e,i){
return t<e?e:t>i?i:t},isConcave:function(t,e,i){var n=i?1:-1;return(t.x*e.y-e.x*t.y)*n<0},area:function(t,i,n,s){var r=s?1:-1;if(!t||!i||!n)return e;var a=-t.x*i.y-i.x*n.y-n.x*t.y+n.x*i.y+i.x*t.y+t.x*n.y;return a*r},isClockwise:function(t,e,i){e=e||"x",i=i||"y";for(var n=0,s=t.length,r=0;r<s;r++){var a=t[r],o=t[r+1===s?0:r+1];n+=(o[e]-a[e])*(o[i]+a[i])}return n<0},isClockwise3:function(t,e,i){(new mono.Vec3).crossVectors(t,e),(new mono.Vec3).subVectors(e,t),(new mono.Vec3).subVectors(e,t)},clampBottom:function(t,e){return t<e?e:t},mapLinear:function(t,e,i,n,s){return n+(t-e)*(s-n)/(i-e)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},sign:function(t){return t<0?-1:t>0?1:0},degToRad:function(t){return t*Ke.Math.__d2r},radToDeg:function(t){return t*Ke.Math.__r2d},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*(3-2*t))},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*t*(t*(6*t-15)+10))},PI2:2*Math.PI,generateUUID:function(){var t,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),n=0;return function(){for(var s=0;s<36;s++)8==s||13==s||18==s||23==s?i[s]="-":14==s?i[s]="4":(n<=2&&(n=33554432+16777216*Math.random()|0),t=15&n,n>>=4,i[s]=e[19==s?3&t|8:t]);return i.join("")}}()},Ke.Math.__d2r=Math.PI/180,Ke.Math.__r2d=180/Math.PI,Ke.Quat=function(t,i,n,s){this.x=t||0,this.y=i||0,this.z=n||0,this.w=s!==e?s:1},Ke.Quat.prototype={constructor:Ke.Quat,set:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},setFromEuler:function(t,i){var n=Math.cos(t.x/2),s=Math.cos(t.y/2),r=Math.cos(t.z/2),a=Math.sin(t.x/2),o=Math.sin(t.y/2),h=Math.sin(t.z/2);return i===e||"XYZ"===i?(this.x=a*s*r+n*o*h,this.y=n*o*r-a*s*h,this.z=n*s*h+a*o*r,this.w=n*s*r-a*o*h):"YXZ"===i?(this.x=a*s*r+n*o*h,this.y=n*o*r-a*s*h,this.z=n*s*h-a*o*r,this.w=n*s*r+a*o*h):"ZXY"===i?(this.x=a*s*r-n*o*h,this.y=n*o*r+a*s*h,this.z=n*s*h+a*o*r,this.w=n*s*r-a*o*h):"ZYX"===i?(this.x=a*s*r-n*o*h,this.y=n*o*r+a*s*h,this.z=n*s*h-a*o*r,this.w=n*s*r+a*o*h):"YZX"===i?(this.x=a*s*r+n*o*h,this.y=n*o*r+a*s*h,this.z=n*s*h-a*o*r,this.w=n*s*r-a*o*h):"XZY"===i&&(this.x=a*s*r-n*o*h,this.y=n*o*r-a*s*h,this.z=n*s*h+a*o*r,this.w=n*s*r+a*o*h),this},setFromAxisAngle:function(t,e){var i=e/2,n=Math.sin(i);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(i),this},setFromRotationMatrix:function(t){var e,i=t.elements,n=i[0],s=i[4],r=i[8],a=i[1],o=i[5],h=i[9],l=i[2],c=i[6],u=i[10],d=n+o+u;return d>0?(e=.5/Math.sqrt(d+1),this.w=.25/e,this.x=(c-h)*e,this.y=(r-l)*e,this.z=(a-s)*e):n>o&&n>u?(e=2*Math.sqrt(1+n-o-u),this.w=(c-h)/e,this.x=.25*e,this.y=(s+a)/e,this.z=(r+l)/e):o>u?(e=2*Math.sqrt(1+o-n-u),this.w=(r-l)/e,this.x=(s+a)/e,this.y=.25*e,this.z=(h+c)/e):(e=2*Math.sqrt(1+u-n-o),this.w=(a-s)/e,this.x=(r+l)/e,this.y=(h+c)/e,this.z=.25*e),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var t=this.length();return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(t=1/t,this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t),this},multiply:function(t,i){return i!==e?(console.warn("DEPRECATED: Quat's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,i)):this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,e){var i=t.x,n=t.y,s=t.z,r=t.w,a=e.x,o=e.y,h=e.z,l=e.w;return this.x=i*l+r*a+n*h-s*o,this.y=n*l+r*o+s*a-i*h,this.z=s*l+r*h+i*o-n*a,this.w=r*l-i*a-n*o-s*h,this},multiplyVector3:function(t){return console.warn("DEPRECATED: Quat's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( Quat ) instead."),t.applyQuaternion(this)},slerp:function(t,e){var i=this.x,n=this.y,s=this.z,r=this.w,a=r*t.w+i*t.x+n*t.y+s*t.z;if(a<0?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,a=-a):this.copy(t),a>=1)return this.w=r,this.x=i,this.y=n,this.z=s,this;var o=Math.acos(a),h=Math.sqrt(1-a*a);if(Math.abs(h)<.001)return this.w=.5*(r+this.w),this.x=.5*(i+this.x),this.y=.5*(n+this.y),this.z=.5*(s+this.z),this;var l=Math.sin((1-e)*o)/h,c=Math.sin(e*o)/h;return this.w=r*l+this.w*c,this.x=i*l+this.x*c,this.y=n*l+this.y*c,this.z=s*l+this.z*c,this},toEuler:function(){var t=this.w*this.w,e=this.x*this.x,i=this.y*this.y,n=this.z*this.z,s=180/Math.PI*Math.atan2(2*(this.y*this.z+this.x*this.w),-e-i+n+t),r=180/Math.PI*Math.asin(-2*(this.x*this.z-this.y*this.w)),a=180/Math.PI*Math.atan2(2*(this.x*this.y+this.z*this.w),e-i-n+t);return[s,r,a]},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},clone:function(){return new Ke.Quat(this.x,this.y,this.z,this.w)}},Ke.Quat.slerp=function(t,e,i,n){return i.copy(t).slerp(e,n)};var Qe=function(t,e){this.x=t||0,this.y=e||0};Qe.prototype={constructor:Qe,set:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,i){return i!==e?(console.warn("DEPRECATED: Vec2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this)},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScalar:function(t){return this.x+=t,this.y+=t,this},sub:function(t,i){return i!==e?(console.warn("DEPRECATED: Vec2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this)},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},divideScalar:function(t){return 0!==t?(this.x/=t,this.y/=t):this.set(0,0),this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this},clamp:function(t,e){return this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x),this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},setLength:function(t){var e=this.length();return 0!==e&&t!==e&&this.multiplyScalar(t/e),this},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},equals:function(t){return null!=t&&(t.x===this.x&&t.y===this.y)},clone:function(){return new Qe(this.x,this.y)}},Ke.Vec2=Qe;var Je=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0};Ke.Vec3=Je,Je.prototype={set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},center:function(t,e){return this.x=(t.x+e.x)/2,this.y=(t.y+e.y)/2,this.z=(t.z+e.z)/2,this},copy:function(t){return(null==this||null==t)&&console.log("TGL.Vec3.copy this : "+this+" v : "+t),this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t){return(!this||!t)&&console.log("TGL.Vec3.add this : "+this+" v : "+t),this.x+=t.x,this.y+=t.y,this.z+=t.z,this},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return(!t||!e)&&console.log("TGL.Vec3.addVectors a : "+t+" b : "+e),this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},subVectors:function(t,e){return(null==t||null==e)&&console.log("null"),this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyMatrix3:function(t){var e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6]*n,this.y=s[1]*e+s[4]*i+s[7]*n,this.z=s[2]*e+s[5]*i+s[8]*n,this},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n+s[12],this.y=s[1]*e+s[5]*i+s[9]*n+s[13],this.z=s[2]*e+s[6]*i+s[10]*n+s[14],this},applyProjection:function(t){var e=this.x,i=this.y,n=this.z,s=t.elements,r=1/(s[3]*e+s[7]*i+s[11]*n+s[15]);return this.x=(s[0]*e+s[4]*i+s[8]*n+s[12])*r,this.y=(s[1]*e+s[5]*i+s[9]*n+s[13])*r,this.z=(s[2]*e+s[6]*i+s[10]*n+s[14])*r,this},applyQuaternion:function(t){var e=this.x,i=this.y,n=this.z,s=t.x,r=t.y,a=t.z,o=t.w,h=o*e+r*n-a*i,l=o*i+a*e-s*n,c=o*n+s*i-r*e,u=-s*e-r*i-a*n;return this.x=h*o+u*-s+l*-a-c*-r,this.y=l*o+u*-r+c*-s-h*-a,this.z=c*o+u*-a+h*-r-l*-s,this},applyEuler:function(t,e){var i=Je.__q1.setFromEuler(t,e);return this.applyQuaternion(i),this},applyAxisAngle:function(t,e){var i=Je.__q1.setFromAxisAngle(t,e);return this.applyQuaternion(i),this},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return 0!==t?(this.x/=t,this.y/=t,this.z/=t):(this.x=0,this.y=0,this.z=0),this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this.z>t.z&&(this.z=t.z),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this.z<t.z&&(this.z=t.z),this},clamp:function(t,e){return this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x),this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y),this.z<t.z?this.z=t.z:this.z>e.z&&(this.z=e.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){var e=this.length();return 0!==e&&t!==e&&this.multiplyScalar(t/e),this},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this},cross:function(t){var e=this.x,i=this.y,n=this.z;return this.x=i*t.z-n*t.y,this.y=n*t.x-e*t.z,this.z=e*t.y-i*t.x,this},crossVectors:function(t,e){return this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x,this},angleTo:function(t){return Math.acos(this.dot(t)/this.length()/t.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n},getPositionFromMatrix:function(t){return this.x=t.elements[12],this.y=t.elements[13],this.z=t.elements[14],this},setEulerFromRotationMatrix:function(t,i){function n(t){return Math.min(Math.max(t,-1),1)}var s=t.elements,r=s[0],a=s[4],o=s[8],h=s[1],l=s[5],c=s[9],u=s[2],d=s[6],f=s[10];return i===e||"XYZ"===i?(this.y=Math.asin(n(o)),Math.abs(o)<.99999?(this.x=Math.atan2(-c,f),this.z=Math.atan2(-a,r)):(this.x=Math.atan2(d,l),this.z=0)):"YXZ"===i?(this.x=Math.asin(-n(c)),Math.abs(c)<.99999?(this.y=Math.atan2(o,f),this.z=Math.atan2(h,l)):(this.y=Math.atan2(-u,r),this.z=0)):"ZXY"===i?(this.x=Math.asin(n(d)),Math.abs(d)<.99999?(this.y=Math.atan2(-u,f),this.z=Math.atan2(-a,l)):(this.y=0,this.z=Math.atan2(h,r))):"ZYX"===i?(this.y=Math.asin(-n(u)),Math.abs(u)<.99999?(this.x=Math.atan2(d,f),this.z=Math.atan2(h,r)):(this.x=0,this.z=Math.atan2(-a,l))):"YZX"===i?(this.z=Math.asin(n(h)),Math.abs(h)<.99999?(this.x=Math.atan2(-c,l),this.y=Math.atan2(-u,r)):(this.x=0,this.y=Math.atan2(o,f))):"XZY"===i&&(this.z=Math.asin(-n(a)),Math.abs(a)<.99999?(this.x=Math.atan2(d,l),this.y=Math.atan2(o,r)):(this.x=Math.atan2(-c,f),this.y=0)),this},setEulerFromQuaternion:function(t,i){function n(t){return Math.min(Math.max(t,-1),1)}var s=t.x*t.x,r=t.y*t.y,a=t.z*t.z,o=t.w*t.w;return i===e||"XYZ"===i?(this.x=Math.atan2(2*(t.x*t.w-t.y*t.z),o-s-r+a),this.y=Math.asin(n(2*(t.x*t.z+t.y*t.w))),this.z=Math.atan2(2*(t.z*t.w-t.x*t.y),o+s-r-a)):"YXZ"===i?(this.x=Math.asin(n(2*(t.x*t.w-t.y*t.z))),this.y=Math.atan2(2*(t.x*t.z+t.y*t.w),o-s-r+a),this.z=Math.atan2(2*(t.x*t.y+t.z*t.w),o-s+r-a)):"ZXY"===i?(this.x=Math.asin(n(2*(t.x*t.w+t.y*t.z))),this.y=Math.atan2(2*(t.y*t.w-t.z*t.x),o-s-r+a),this.z=Math.atan2(2*(t.z*t.w-t.x*t.y),o-s+r-a)):"ZYX"===i?(this.x=Math.atan2(2*(t.x*t.w+t.z*t.y),o-s-r+a),this.y=Math.asin(n(2*(t.y*t.w-t.x*t.z))),this.z=Math.atan2(2*(t.x*t.y+t.z*t.w),o+s-r-a)):"YZX"===i?(this.x=Math.atan2(2*(t.x*t.w-t.z*t.y),o-s+r-a),this.y=Math.atan2(2*(t.y*t.w-t.x*t.z),o+s-r-a),this.z=Math.asin(n(2*(t.x*t.y+t.z*t.w)))):"XZY"===i&&(this.x=Math.atan2(2*(t.x*t.w+t.y*t.z),o-s+r-a),this.y=Math.atan2(2*(t.x*t.z+t.y*t.w),o+s-r-a),this.z=Math.asin(n(2*(t.z*t.w-t.x*t.y)))),this},getScaleFromMatrix:function(t){var e=this.set(t.elements[0],t.elements[1],t.elements[2]).length(),i=this.set(t.elements[4],t.elements[5],t.elements[6]).length(),n=this.set(t.elements[8],t.elements[9],t.elements[10]).length();return this.x=e,this.y=i,this.z=n,this},toString:function(){return this.x+"_"+this.y+"_"+this.z},equals:function(t){return null!=t&&(t.x===this.x&&t.y===this.y&&t.z===this.z)},clone:function(){return new Je(this.x,this.y,this.z)},setFromMatrixPosition:function(t){return this.x=t.elements[12],this.y=t.elements[13],this.z=t.elements[14],this},rotateFromAxisAndCenter:function(t,e,i){var n=(new Ke.Mat4).makeRotationAxisAndCenter(t,e,i);return this.applyMatrix4(n),this},rotationTowards:function(t,e){var i=(new Ke.Mat4).rotationTowards(t,e);return this.setEulerFromRotationMatrix(i),this},constructor:Ke.Vec3},Je.__q1=new Ke.Quat,Ke.Vec4=function(t,i,n,s){this.x=t||0,this.y=i||0,this.z=n||0,this.w=s!==e?s:1},Ke.Vec4.prototype={constructor:Ke.Vec4,set:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==e?t.w:1,this},add:function(t,i){return i!==e?(console.warn("DEPRECATED: Vec4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},sub:function(t,i){return i!==e?(console.warn("DEPRECATED: Vec4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z,s=this.w,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n+r[12]*s,this.y=r[1]*e+r[5]*i+r[9]*n+r[13]*s,this.z=r[2]*e+r[6]*i+r[10]*n+r[14]*s,this.w=r[3]*e+r[7]*i+r[11]*n+r[15]*s,this},divideScalar:function(t){return 0!==t?(this.x/=t,this.y/=t,this.z/=t,this.w/=t):(this.x=0,this.y=0,this.z=0,this.w=1),this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this.z>t.z&&(this.z=t.z),this.w>t.w&&(this.w=t.w),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this.z<t.z&&(this.z=t.z),this.w<t.w&&(this.w=t.w),this},clamp:function(t,e){return this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x),this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y),this.z<t.z?this.z=t.z:this.z>e.z&&(this.z=e.z),this.w<t.w?this.w=t.w:this.w>e.w&&(this.w=e.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){var e=this.length();return 0!==e&&t!==e&&this.multiplyScalar(t/e),this},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},clone:function(){return new Ke.Vec4(this.x,this.y,this.z,this.w)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,i,n,s,r=.01,a=.1,o=t.elements,h=o[0],l=o[4],c=o[8],u=o[1],d=o[5],f=o[9],g=o[2],_=o[6],p=o[10];if(Math.abs(l-u)<r&&Math.abs(c-g)<r&&Math.abs(f-_)<r){if(Math.abs(l+u)<a&&Math.abs(c+g)<a&&Math.abs(f+_)<a&&Math.abs(h+d+p-3)<a)return this.set(1,0,0,0),this;e=Math.PI;var v=(h+1)/2,m=(d+1)/2,y=(p+1)/2,A=(l+u)/4,x=(c+g)/4,w=(f+_)/4;return v>m&&v>y?v<r?(i=0,n=.707106781,s=.707106781):(i=Math.sqrt(v),n=A/i,s=x/i):m>y?m<r?(i=.707106781,n=0,s=.707106781):(n=Math.sqrt(m),i=A/n,s=w/n):y<r?(i=.707106781,n=.707106781,s=0):(s=Math.sqrt(y),i=x/s,n=w/s),this.set(i,n,s,e),this}var b=Math.sqrt((_-f)*(_-f)+(c-g)*(c-g)+(u-l)*(u-l));return Math.abs(b)<.001&&(b=1),this.x=(_-f)/b,this.y=(c-g)/b,this.z=(u-l)/b,this.w=Math.acos((h+d+p-1)/2),this}};var $e=function(t,i,n,s,r,a,o,h,l){this.elements=new Float32Array(9),this.set(t!==e?t:1,i||0,n||0,s||0,r!==e?r:1,a||0,o||0,h||0,l!==e?l:1)};$e.prototype={constructor:$e,set:function(t,e,i,n,s,r,a,o,h){var l=this.elements;return l[0]=t,l[3]=e,l[6]=i,l[1]=n,l[4]=s,l[7]=r,l[2]=a,l[5]=o,l[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(t){var e=t.elements;return this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]),this},multiplyVector3:function(t){return console.warn("DEPRECATED: Mat3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){var t=new Je;return function(e){for(var i=0,n=e.length;i<n;i+=3)t.x=e[i],t.y=e[i+1],t.z=e[i+2],t.applyMatrix3(this),e[i]=t.x,e[i+1]=t.y,e[i+2]=t.z;return e}}(),multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],a=t[5],o=t[6],h=t[7],l=t[8];return e*r*l-e*a*h-i*s*l+i*a*o+n*s*h-n*r*o},getInverse:function(t,e){var i=t.elements,n=this.elements;n[0]=i[10]*i[5]-i[6]*i[9],n[1]=-i[10]*i[1]+i[2]*i[9],n[2]=i[6]*i[1]-i[2]*i[5],n[3]=-i[10]*i[4]+i[6]*i[8],n[4]=i[10]*i[0]-i[2]*i[8],n[5]=-i[6]*i[0]+i[2]*i[4],n[6]=i[9]*i[4]-i[5]*i[8],n[7]=-i[9]*i[0]+i[1]*i[8],n[8]=i[5]*i[0]-i[1]*i[4];var s=i[0]*n[0]+i[1]*n[3]+i[2]*n[6];if(0===s){var r="Mat3.getInverse(): can't invert matrix, determinant is 0";if(e)throw new Error(r);return console.warn(r),this.identity(),this}return this.multiplyScalar(1/s),this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.getInverse(t).transpose(),this},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},clone:function(){var t=this.elements;return new $e(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])}},Ke.Mat3=$e;var ti=function(t,i,n,s,r,a,o,h,l,c,u,d,f,g,_,p){this.elements=new Float32Array(16),this.set(t!==e?t:1,i||0,n||0,s||0,r||0,a!==e?a:1,o||0,h||0,l||0,c||0,u!==e?u:1,d||0,f||0,g||0,_||0,p!==e?p:1)};ti.prototype={constructor:ti,set:function(t,e,i,n,s,r,a,o,h,l,c,u,d,f,g,_){var p=this.elements;return p[0]=t,p[4]=e,p[8]=i,p[12]=n,p[1]=s,p[5]=r,p[9]=a,p[13]=o,p[2]=h,p[6]=l,p[10]=c,p[14]=u,p[3]=d,p[7]=f,p[11]=g,p[15]=_,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),this},setRotationFromEuler:function(t,i){var n=this.elements,s=t.x,r=t.y,a=t.z,o=Math.cos(s),h=Math.sin(s),l=Math.cos(r),c=Math.sin(r),u=Math.cos(a),d=Math.sin(a);if(i===e||"XYZ"===i){var f=o*u,g=o*d,_=h*u,p=h*d;n[0]=l*u,n[4]=-l*d,n[8]=c,n[1]=g+_*c,n[5]=f-p*c,n[9]=-h*l,n[2]=p-f*c,n[6]=_+g*c,n[10]=o*l}else if("YXZ"===i){var v=l*u,m=l*d,y=c*u,A=c*d;n[0]=v+A*h,n[4]=y*h-m,n[8]=o*c,n[1]=o*d,n[5]=o*u,n[9]=-h,n[2]=m*h-y,n[6]=A+v*h,n[10]=o*l}else if("ZXY"===i){var v=l*u,m=l*d,y=c*u,A=c*d;n[0]=v-A*h,n[4]=-o*d,n[8]=y+m*h,n[1]=m+y*h,n[5]=o*u,n[9]=A-v*h,n[2]=-o*c,n[6]=h,n[10]=o*l}else if("ZYX"===i){var f=o*u,g=o*d,_=h*u,p=h*d;n[0]=l*u,n[4]=_*c-g,n[8]=f*c+p,n[1]=l*d,n[5]=p*c+f,n[9]=g*c-_,n[2]=-c,n[6]=h*l,n[10]=o*l}else if("YZX"===i){var x=o*l,w=o*c,b=h*l,S=h*c;n[0]=l*u,n[4]=S-x*d,n[8]=b*d+w,n[1]=d,n[5]=o*u,n[9]=-h*u,n[2]=-c*u,n[6]=w*d+b,n[10]=x-S*d}else if("XZY"===i){var x=o*l,w=o*c,b=h*l,S=h*c;n[0]=l*u,n[4]=-d,n[8]=c*u,n[1]=x*d+S,n[5]=o*u,n[9]=w*d-b,n[2]=b*d-w,n[6]=h*u,n[10]=S*d+x}return this},setRotationFromQuaternion:function(t){var e=this.elements,i=t.x,n=t.y,s=t.z,r=t.w,a=i+i,o=n+n,h=s+s,l=i*a,c=i*o,u=i*h,d=n*o,f=n*h,g=s*h,_=r*a,p=r*o,v=r*h;return e[0]=1-(d+g),e[4]=c-v,e[8]=u+p,e[1]=c+v,e[5]=1-(l+g),e[9]=f-_,e[2]=u-p,e[6]=f+_,e[10]=1-(l+d),this},lookAt:function(t,e,i){var n=this.elements,s=ti.__v1,r=ti.__v2,a=ti.__v3;return a.subVectors(t,e).normalize(),0===a.length()&&(a.z=1),s.crossVectors(i,a).normalize(),0===s.length()&&(a.x+=1e-4,s.crossVectors(i,a).normalize()),r.crossVectors(a,s),n[0]=s.x,n[1]=s.y,n[2]=s.z,n[4]=r.x,n[5]=r.y,n[6]=r.z,n[8]=a.x,n[9]=a.y,n[10]=a.z,this},multiply:function(t,i){return i!==e?this.multiplyMatrices(t,i):this.multiplyMatrices(this,t)},multiplyMatrices:function(t,e){var i=t.elements,n=e.elements,s=this.elements,r=i[0],a=i[4],o=i[8],h=i[12],l=i[1],c=i[5],u=i[9],d=i[13],f=i[2],g=i[6],_=i[10],p=i[14],v=i[3],m=i[7],y=i[11],A=i[15],x=n[0],w=n[4],b=n[8],S=n[12],C=n[1],T=n[5],E=n[9],L=n[13],M=n[2],P=n[6],k=n[10],I=n[14],R=n[3],D=n[7],B=n[11],N=n[15];return s[0]=r*x+a*C+o*M+h*R,s[4]=r*w+a*T+o*P+h*D,s[8]=r*b+a*E+o*k+h*B,s[12]=r*S+a*L+o*I+h*N,s[1]=l*x+c*C+u*M+d*R,s[5]=l*w+c*T+u*P+d*D,s[9]=l*b+c*E+u*k+d*B,s[13]=l*S+c*L+u*I+d*N,s[2]=f*x+g*C+_*M+p*R,s[6]=f*w+g*T+_*P+p*D,s[10]=f*b+g*E+_*k+p*B,s[14]=f*S+g*L+_*I+p*N,s[3]=v*x+m*C+y*M+A*R,s[7]=v*w+m*T+y*P+A*D,s[11]=v*b+m*E+y*k+A*B,s[15]=v*S+m*L+y*I+A*N,this},multiplyToArray:function(t,e,i){var n=this.elements;return this.multiplyMatrices(t,e),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},multiplyVector3:function(t){return t.applyProjection(this)},multiplyVector4:function(t){return t.applyMatrix4(this)},multiplyVector3Array:function(t){for(var e=ti.__v1,i=0,n=t.length;i<n;i+=3)e.x=t[i],e.y=t[i+1],e.z=t[i+2],e.applyProjection(this),t[i]=e.x,t[i+1]=e.y,t[i+2]=e.z;return t},rotateAxis:function(t){var e=this.elements,i=t.x,n=t.y,s=t.z;return t.x=i*e[0]+n*e[4]+s*e[8],t.y=i*e[1]+n*e[5]+s*e[9],t.z=i*e[2]+n*e[6]+s*e[10],t.normalize(),t},crossVector:function(t){var e=this.elements,i=new Ke.Vector4;return i.x=e[0]*t.x+e[4]*t.y+e[8]*t.z+e[12]*t.w,i.y=e[1]*t.x+e[5]*t.y+e[9]*t.z+e[13]*t.w,i.z=e[2]*t.x+e[6]*t.y+e[10]*t.z+e[14]*t.w,i.w=t.w?e[3]*t.x+e[7]*t.y+e[11]*t.z+e[15]*t.w:1,i},determinant:function(){var t=this.elements,e=t[0],i=t[4],n=t[8],s=t[12],r=t[1],a=t[5],o=t[9],h=t[13],l=t[2],c=t[6],u=t[10],d=t[14],f=t[3],g=t[7],_=t[11],p=t[15];return f*(+s*o*c-n*h*c-s*a*u+i*h*u+n*a*d-i*o*d)+g*(+e*o*d-e*h*u+s*r*u-n*r*d+n*h*l-s*o*l)+_*(+e*h*c-e*a*d-s*r*c+i*r*d+s*a*l-i*h*l)+p*(-n*a*l-e*o*c+e*a*u+n*r*c-i*r*u+i*o*l)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},flattenToArrayOffset:function(t,e){var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t},getPosition:function(){var t=this.elements;return(new Je).set(t[12],t[13],t[14])},setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getColumnX:function(){var t=this.elements;return ti.__v1.set(t[0],t[1],t[2])},getColumnY:function(){var t=this.elements;return ti.__v1.set(t[4],t[5],t[6])},getColumnZ:function(){var t=this.elements;return ti.__v1.set(t[8],t[9],t[10])},getInverse:function(t,e){var i=this.elements,n=t.elements,s=n[0],r=n[4],a=n[8],o=n[12],h=n[1],l=n[5],c=n[9],u=n[13],d=n[2],f=n[6],g=n[10],_=n[14],p=n[3],v=n[7],m=n[11],y=n[15];i[0]=c*_*v-u*g*v+u*f*m-l*_*m-c*f*y+l*g*y,i[4]=o*g*v-a*_*v-o*f*m+r*_*m+a*f*y-r*g*y,i[8]=a*u*v-o*c*v+o*l*m-r*u*m-a*l*y+r*c*y,i[12]=o*c*f-a*u*f-o*l*g+r*u*g+a*l*_-r*c*_,i[1]=u*g*p-c*_*p-u*d*m+h*_*m+c*d*y-h*g*y,i[5]=a*_*p-o*g*p+o*d*m-s*_*m-a*d*y+s*g*y,i[9]=o*c*p-a*u*p-o*h*m+s*u*m+a*h*y-s*c*y,i[13]=a*u*d-o*c*d+o*h*g-s*u*g-a*h*_+s*c*_,i[2]=l*_*p-u*f*p+u*d*v-h*_*v-l*d*y+h*f*y,i[6]=o*f*p-r*_*p-o*d*v+s*_*v+r*d*y-s*f*y,i[10]=r*u*p-o*l*p+o*h*v-s*u*v-r*h*y+s*l*y,i[14]=o*l*d-r*u*d-o*h*f+s*u*f+r*h*_-s*l*_,i[3]=c*f*p-l*g*p-c*d*v+h*g*v+l*d*m-h*f*m,i[7]=r*g*p-a*f*p+a*d*v-s*g*v-r*d*m+s*f*m,i[11]=a*l*p-r*c*p-a*h*v+s*c*v+r*h*m-s*l*m,i[15]=r*c*d-a*l*d+a*h*f-s*c*f-r*h*g+s*l*g;var A=n[0]*i[0]+n[1]*i[4]+n[2]*i[8]+n[3]*i[12];if(0==A){var x="Mat4.getInverse(): can't invert matrix, determinant is 0";if(e)throw new Error(x);return console.warn(x),this.identity(),this}return this.multiplyScalar(1/A),this},compose:function(t,e,i){var n=this.elements,s=ti.__m1,r=ti.__m2;return s.identity(),s.setRotationFromQuaternion(e),r.makeScale(i.x,i.y,i.z),this.multiplyMatrices(s,r),n[12]=t.x,n[13]=t.y,n[14]=t.z,this},decompose:function(t,e,i){var n=this.elements,s=ti.__v1,r=ti.__v2,a=ti.__v3;s.set(n[0],n[1],n[2]),r.set(n[4],n[5],n[6]),a.set(n[8],n[9],n[10]),t=t instanceof Je?t:new Je,e=e instanceof Ke.Quat?e:new Ke.Quat,i=i instanceof Je?i:new Je,i.x=s.length(),i.y=r.length(),i.z=a.length(),t.x=n[12],t.y=n[13],t.z=n[14];var o=ti.__m1;return o.copy(this),o.elements[0]/=i.x,o.elements[1]/=i.x,o.elements[2]/=i.x,o.elements[4]/=i.y,o.elements[5]/=i.y,o.elements[6]/=i.y,o.elements[8]/=i.z,o.elements[9]/=i.z,o.elements[10]/=i.z,e.setFromRotationMatrix(o),[t,e,i]},extractPosition:function(t){var e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this},extractRotation:function(t){var e=this.elements,i=t.elements,n=ti.__v1,s=1/n.set(i[0],i[1],i[2]).length(),r=1/n.set(i[4],i[5],i[6]).length(),a=1/n.set(i[8],i[9],i[10]).length();return e[0]=i[0]*s,e[1]=i[1]*s,e[2]=i[2]*s,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[8]=i[8]*a,e[9]=i[9]*a,e[10]=i[10]*a,this},translate:function(t){var e=this.elements,i=t.x,n=t.y,s=t.z;return e[12]=e[0]*i+e[4]*n+e[8]*s+e[12],e[13]=e[1]*i+e[5]*n+e[9]*s+e[13],e[14]=e[2]*i+e[6]*n+e[10]*s+e[14],e[15]=e[3]*i+e[7]*n+e[11]*s+e[15],this},rotateX:function(t){var e=this.elements,i=e[4],n=e[5],s=e[6],r=e[7],a=e[8],o=e[9],h=e[10],l=e[11],c=Math.cos(t),u=Math.sin(t);return e[4]=c*i+u*a,e[5]=c*n+u*o,e[6]=c*s+u*h,e[7]=c*r+u*l,e[8]=c*a-u*i,e[9]=c*o-u*n,e[10]=c*h-u*s,e[11]=c*l-u*r,this},rotateY:function(t){var e=this.elements,i=e[0],n=e[1],s=e[2],r=e[3],a=e[8],o=e[9],h=e[10],l=e[11],c=Math.cos(t),u=Math.sin(t);return e[0]=c*i-u*a,e[1]=c*n-u*o,e[2]=c*s-u*h,e[3]=c*r-u*l,e[8]=c*a+u*i,e[9]=c*o+u*n,e[10]=c*h+u*s,e[11]=c*l+u*r,this},rotateZ:function(t){var e=this.elements,i=e[0],n=e[1],s=e[2],r=e[3],a=e[4],o=e[5],h=e[6],l=e[7],c=Math.cos(t),u=Math.sin(t);return e[0]=c*i+u*a,e[1]=c*n+u*o,e[2]=c*s+u*h,e[3]=c*r+u*l,e[4]=c*a-u*i,e[5]=c*o-u*n,e[6]=c*h-u*s,e[7]=c*l-u*r,this},rotateByAxis:function(t,e){var i=this.elements;if(1===t.x&&0===t.y&&0===t.z)return this.rotateX(e);if(0===t.x&&1===t.y&&0===t.z)return this.rotateY(e);if(0===t.x&&0===t.y&&1===t.z)return this.rotateZ(e);var n=t.x,s=t.y,r=t.z,a=Math.sqrt(n*n+s*s+r*r);n/=a,s/=a,r/=a;var o=n*n,h=s*s,l=r*r,c=Math.cos(e),u=Math.sin(e),d=1-c,f=n*s*d,g=n*r*d,_=s*r*d,p=n*u,v=s*u,m=r*u,y=o+(1-o)*c,A=f+m,x=g-v,w=f-m,b=h+(1-h)*c,S=_+p,C=g+v,T=_-p,E=l+(1-l)*c,L=i[0],M=i[1],P=i[2],k=i[3],I=i[4],R=i[5],D=i[6],B=i[7],N=i[8],z=i[9],O=i[10],F=i[11];i[12],i[13],i[14],i[15];return i[0]=y*L+A*I+x*N,i[1]=y*M+A*R+x*z,i[2]=y*P+A*D+x*O,i[3]=y*k+A*B+x*F,i[4]=w*L+b*I+S*N,i[5]=w*M+b*R+S*z,i[6]=w*P+b*D+S*O,i[7]=w*k+b*B+S*F,i[8]=C*L+T*I+E*N,i[9]=C*M+T*R+E*z,i[10]=C*P+T*D+E*O,i[11]=C*k+T*B+E*F,this},scale:function(t){var e=this.elements,i=t.x,n=t.y,s=t.z;return e[0]*=i,e[4]*=n,e[8]*=s,e[1]*=i,e[5]*=n,e[9]*=s,e[2]*=i,e[6]*=n,e[10]*=s,e[3]*=i,e[7]*=n,e[11]*=s,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,Math.max(i,n)))},makeTranslation:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var i=Math.cos(e),n=Math.sin(e),s=1-i,r=t.x,a=t.y,o=t.z,h=s*r,l=s*a;return this.set(h*r+i,h*a-n*o,h*o+n*a,0,h*a+n*o,l*a+i,l*o-n*r,0,h*o-n*a,l*o+n*r,s*o*o+i,0,0,0,0,1),this},makeScale:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},makeFrustum:function(t,e,i,n,s,r){var a=this.elements,o=2*s/(e-t),h=2*s/(n-i),l=(e+t)/(e-t),c=(n+i)/(n-i),u=-(r+s)/(r-s),d=-2*r*s/(r-s);return a[0]=o,a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=h,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(t,e,i,n){var s=i*Math.tan(Ke.Math.degToRad(.5*t)),r=-s,a=r*e,o=s*e;return this.makeFrustum(a,o,r,s,i,n);
},makeOrthographic:function(t,e,i,n,s,r){var a=this.elements,o=e-t,h=i-n,l=r-s,c=(e+t)/o,u=(i+n)/h,d=(r+s)/l;return a[0]=2/o,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2/h,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2/l,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},clone:function(){var t=this.elements;return new ti(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])},makeRotationFromQuaternion:function(t){var e=this.elements,i=t.x,n=t.y,s=t.z,r=t.w,a=i+i,o=n+n,h=s+s,l=i*a,c=i*o,u=i*h,d=n*o,f=n*h,g=s*h,_=r*a,p=r*o,v=r*h;return e[0]=1-(d+g),e[4]=c-v,e[8]=u+p,e[1]=c+v,e[5]=1-(l+g),e[9]=f-_,e[2]=u-p,e[6]=f+_,e[10]=1-(l+d),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},getEulerAngles:function(){var t=(new ti).extractRotation(this).elements,e=t[0],i=t[1],n=t[2],s=t[5],r=t[6],a=t[10],o=Math.atan2(r,a),h=Math.atan2(-n,Math.sqrt(e*e+i*i)),l=Math.sin(o),c=Math.cos(o),u=Math.atan2(l*t[8]-c*t[4],c*s-l*t[9]);return new Je(o,h,u)},makeRotationAxisAndCenter:function(t,e,i){var n=Math.cos(e),s=Math.sin(e),r=1-n,a=t.x,o=t.y,h=t.z,l=r*a,c=r*o,u=i.x,d=i.y,f=i.z,g=this,_=new Float32Array(16);return _[0]=l*a+n,_[4]=l*o-s*h,_[8]=l*h+s*o,_[12]=u-u*(l*a+n)-d*(l*o-s*h)-f*(l*h+s*o),_[1]=l*o+s*h,_[5]=c*o+n,_[9]=c*h-s*a,_[13]=d-u*(l*o+s*h)-d*(c*o+n)-f*(c*h-s*a),_[2]=l*h-s*o,_[6]=c*h+s*a,_[10]=r*h*h+n,_[14]=f-u*(l*h-s*o)-d*(c*h+s*a)-f*(r*h*h+n),_[3]=0,_[7]=0,_[11]=0,_[15]=1,g.elements=_,g},rotationTowards:function(t,e){var i=Math.acos(e.dot(t)/e.length()/t.length()),n=(new Ke.Vec3).crossVectors(e,t).normalize();return this.makeRotationAxis(n,-i),this},equals:function(t){if(t instanceof ti){for(var e=0;e<this.elements.length;e++)if(Math.abs(this.elements[e]-t.elements[e])>1e-4)return!1;return!0}}},ti.__v1=new Je,ti.__v2=new Je,ti.__v3=new Je,ti.__m1=new ti,ti.__m2=new ti,Ke.Mat4=ti,Ke.Euler=function(t,e,i,n){this._x=t||0,this._y=e||0,this._z=i||0,this._order=n||Ke.Euler.DefaultOrder},Ke.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Ke.Euler.DefaultOrder="XYZ",Ke.Euler.prototype={constructor:Ke.Euler,_x:0,_y:0,_z:0,_order:Ke.Euler.DefaultOrder,_quaternion:e,_updateQuaternion:function(){this._quaternion!==e&&this._quaternion.setFromEuler(this,!1)},get x(){return this._x},set x(t){this._x=t,this._updateQuaternion()},get y(){return this._y},set y(t){this._y=t,this._updateQuaternion()},get z(){return this._z},set z(t){this._z=t,this._updateQuaternion()},get order(){return this._order},set order(t){this._order=t,this._updateQuaternion()},set:function(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._order=n||this._order,this._updateQuaternion(),this},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._updateQuaternion(),this},setFromRotationMatrix:function(t,e){function i(t){return Math.min(Math.max(t,-1),1)}var n=t.elements,s=n[0],r=n[4],a=n[8],o=n[1],h=n[5],l=n[9],c=n[2],u=n[6],d=n[10];return e=e||this._order,"XYZ"===e?(this._y=Math.asin(i(a)),Math.abs(a)<.99999?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-r,s)):(this._x=Math.atan2(u,h),this._z=0)):"YXZ"===e?(this._x=Math.asin(-i(l)),Math.abs(l)<.99999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,h)):(this._y=Math.atan2(-c,s),this._z=0)):"ZXY"===e?(this._x=Math.asin(i(u)),Math.abs(u)<.99999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-r,h)):(this._y=0,this._z=Math.atan2(o,s))):"ZYX"===e?(this._y=Math.asin(-i(c)),Math.abs(c)<.99999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,s)):(this._x=0,this._z=Math.atan2(-r,h))):"YZX"===e?(this._z=Math.asin(i(o)),Math.abs(o)<.99999?(this._x=Math.atan2(-l,h),this._y=Math.atan2(-c,s)):(this._x=0,this._y=Math.atan2(a,d))):"XZY"===e?(this._z=Math.asin(-i(r)),Math.abs(r)<.99999?(this._x=Math.atan2(u,h),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-l,d),this._y=0)):console.warn("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+e),this._order=e,this._updateQuaternion(),this},setFromQuaternion:function(t,e,i){function n(t){return Math.min(Math.max(t,-1),1)}var s=t.x*t.x,r=t.y*t.y,a=t.z*t.z,o=t.w*t.w;return e=e||this._order,"XYZ"===e?(this._x=Math.atan2(2*(t.x*t.w-t.y*t.z),o-s-r+a),this._y=Math.asin(n(2*(t.x*t.z+t.y*t.w))),this._z=Math.atan2(2*(t.z*t.w-t.x*t.y),o+s-r-a)):"YXZ"===e?(this._x=Math.asin(n(2*(t.x*t.w-t.y*t.z))),this._y=Math.atan2(2*(t.x*t.z+t.y*t.w),o-s-r+a),this._z=Math.atan2(2*(t.x*t.y+t.z*t.w),o-s+r-a)):"ZXY"===e?(this._x=Math.asin(n(2*(t.x*t.w+t.y*t.z))),this._y=Math.atan2(2*(t.y*t.w-t.z*t.x),o-s-r+a),this._z=Math.atan2(2*(t.z*t.w-t.x*t.y),o-s+r-a)):"ZYX"===e?(this._x=Math.atan2(2*(t.x*t.w+t.z*t.y),o-s-r+a),this._y=Math.asin(n(2*(t.y*t.w-t.x*t.z))),this._z=Math.atan2(2*(t.x*t.y+t.z*t.w),o+s-r-a)):"YZX"===e?(this._x=Math.atan2(2*(t.x*t.w-t.z*t.y),o-s+r-a),this._y=Math.atan2(2*(t.y*t.w-t.x*t.z),o+s-r-a),this._z=Math.asin(n(2*(t.x*t.y+t.z*t.w)))):"XZY"===e?(this._x=Math.atan2(2*(t.x*t.w+t.y*t.z),o-s+r-a),this._y=Math.atan2(2*(t.x*t.z+t.y*t.w),o+s-r-a),this._z=Math.asin(n(2*(t.z*t.w-t.x*t.y)))):console.warn("WARNING: Euler.setFromQuaternion() given unsupported order: "+e),this._order=e,i!==!1&&this._updateQuaternion(),this},reorder:function(){var t=new Ke.Quat;return function(e){t.setFromEuler(this),this.setFromQuaternion(t,e)}}(),fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==e&&(this._order=t[3]),this._updateQuaternion(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},clone:function(){return new Ke.Euler(this._x,this._y,this._z,this._order)}},Ke.math={},Ke.math.Plane=function(t,i){this.normal=t!==e?t:new Je(1,0,0),this.constant=i!==e?i:0},Ke.math.Plane.prototype={constructor:Ke.math.Plane,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(t,e,i){var n=Ke.math.Plane.__v1.subVectors(i,e).cross(Ke.math.Plane.__v2.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return this.orthoPoint(t,e).sub(t).negate()},orthoPoint:function(t,e){var i=this.distanceToPoint(t),n=e||new Je;return n.copy(this.normal).multiplyScalar(i)},isIntersectionLine:function(t,e){var i=this.distanceToPoint(t),n=this.distanceToPoint(e);return i<0&&n>0||n<0&&i>0},isIntersectionFace:function(t,e){var i=[];i.push(e[t.a]),i.push(e[t.b]),i.push(e[t.c]),null!=t.d&&i.push(e[t.d]);var n,s,r,a=[];for(n=0;n<i.length;n++)a.push(this.distanceToPoint(i[n]));for(n=0;n<a.length;n++)if(0==n)s=r=a[n];else{if(r=a[n],s<0&&r>0||r<0&&s>0)return"intersect";s=r}return r>0?"in":"out"},intersectLine:function(t,i,n){var s=n||new Je,r=Ke.math.Plane.__v1.subVectors(i,t),a=this.normal.dot(r);if(0==a)return 0==this.distanceToPoint(t)?s.copy(t):e;var o=-(t.dot(this.normal)+this.constant)/a;return o<0||o>1?e:s.copy(r).multiplyScalar(o).add(t)},coplanarPoint:function(t){var e=t||new Je;return e.copy(this.normal).multiplyScalar(-this.constant)},transform:function(t,e){e=e||(new Ke.Mat3).getInverse(t).transpose();var i=Ke.math.Plane.__v1.copy(this.normal).applyMatrix3(e),n=this.coplanarPoint(Ke.math.Plane.__v2);return n.applyMatrix4(t),this.setFromNormalAndCoplanarPoint(i,n),this},translate:function(t){return this.constant=this.constant-t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant==this.constant},clone:function(){return(new Ke.math.Plane).copy(this)}},Ke.math.Plane.__vZero=new Je(0,0,0),Ke.math.Plane.__v1=new Je,Ke.math.Plane.__v2=new Je,Ke.Frustum=function(t,i,n,s,r,a){this.planes=[t!==e?t:new Ke.math.Plane,i!==e?i:new Ke.math.Plane,n!==e?n:new Ke.math.Plane,s!==e?s:new Ke.math.Plane,r!==e?r:new Ke.math.Plane,a!==e?a:new Ke.math.Plane]},Ke.Frustum.prototype={set:function(t,e,i,n,s,r){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(i),a[3].copy(n),a[4].copy(s),a[5].copy(r),this},setPoints:function(t){this.points=t},copy:function(t){for(var e=this.planes,i=0;i<6;i++)e[i].copy(t.planes[i]);return this},setFromMatrix:function(t){var e=this.planes,i=t.elements,n=i[0],s=i[1],r=i[2],a=i[3],o=i[4],h=i[5],l=i[6],c=i[7],u=i[8],d=i[9],f=i[10],g=i[11],_=i[12],p=i[13],v=i[14],m=i[15];return e[0].setComponents(a-n,c-o,g-u,m-_).normalize(),e[1].setComponents(a+n,c+o,g+u,m+_).normalize(),e[2].setComponents(a+s,c+h,g+d,m+p).normalize(),e[3].setComponents(a-s,c-h,g-d,m-p).normalize(),e[4].setComponents(a-r,c-l,g-f,m-v).normalize(),e[5].setComponents(a+r,c+l,g+f,m+v).normalize(),this},intersectsObjectAccurate:function(t,e){if(0==e)return this.intersectsObject(t);var i,n,s=t.worldMatrix,r=(this.planes,t.vertices),a=[],o=r.length;for(n=0;n<o;n++)if(i=r[n].clone(),i.applyMatrix4(s),a.push(i),this.containsPoint(i))return!0;if(2==e)if(t instanceof Ke.Line)for(n=0,o=a.length;n<o-1;n++){var h=a[n],l=a[n+1];if(this.containsLine(h,l))return!0}else{var c,u=t.faces;for(n=0,o=u.length;n<o;n++){if(c=u[n],this.containsLine(a[c.a],a[c.b]))return!0;if(this.containsLine(a[c.b],a[c.c]))return!0;if(null!=c.d){if(this.containsLine(a[c.c],a[c.d]))return!0;if(this.containsLine(a[c.d],a[c.a]))return!0}else if(this.containsLine(a[c.a],a[c.c]))return!0}}return!1},intersectsObject:function(t){var e=t.worldMatrix,i=this.planes,n=e.getPosition();if(!t.computeBoundingSphere)return!1;t.boundingSphere||t.computeBoundingSphere();for(var s=-t.boundingSphere.radius*e.getMaxScaleOnAxis(),r=0;r<6;r++){var a=i[r].distanceToPoint(n);if(a<s)return!1}return!0},intersectsSphere:function(t){for(var e=this.planes,i=t.center,n=-t.radius,s=0;s<6;s++){var r=e[s].distanceToPoint(i);if(r<n)return!1}return!0},intersectsBox:function(t){for(var e=new Je,i=new Je,n=this.planes,s=0;s<6;s++){var r=n[s];e.x=r.normal.x>0?t.min.x:t.max.x,i.x=r.normal.x>0?t.max.x:t.min.x,e.y=r.normal.y>0?t.min.y:t.max.y,i.y=r.normal.y>0?t.max.y:t.min.y,e.z=r.normal.z>0?t.min.z:t.max.z,i.z=r.normal.z>0?t.max.z:t.min.z;var a=r.distanceToPoint(e),o=r.distanceToPoint(i);if(a<0&&o<0)return!1}return!0},containsLine:function(t,e){for(var i=this.planes,n=new Je,s=0;s<6;s++)if(n=i[s].intersectLine(t,e,n),n&&this.containsPoint(n))return!0;return!1},containsPoint:function(t){for(var e=this.planes,i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0},clone:function(){return(new Ke.Frustum).copy(this)}},Ke.Ray=function(t,i){this.origin=t!==e?t:new Je,this.direction=i!==e?i:new Je},Ke.Ray.prototype={constructor:Ke.Ray,set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){var i=e||new Je;return i.copy(this.direction).multiplyScalar(t).add(this.origin)},recast:function(t){return this.origin.copy(this.at(t,Ke.Ray.__v1)),this},closestPointToPoint:function(t,e){var i=e||new Je;i.subVectors(t,this.origin);var n=i.dot(this.direction);return i.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(t){var e=Ke.Ray.__v1.subVectors(t,this.origin).dot(this.direction);return Ke.Ray.__v1.copy(this.direction).multiplyScalar(e).add(this.origin),Ke.Ray.__v1.distanceTo(t)},isIntersectionSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},isIntersectionPlane:function(t){var e=t.normal.dot(this.direction);return 0!=e||0==t.distanceToPoint(this.origin)},distanceToPlane:function(t){var i=t.normal.dot(this.direction);if(0==i)return 0==t.distanceToPoint(this.origin)?0:e;var n=-(this.origin.dot(t.normal)+t.constant)/i;return n},intersectPlane:function(t,i){var n=this.distanceToPlane(t);return n===e?e:this.at(n,i)},transform:function(t){return this.direction.add(this.origin).applyMatrix4(t),this.origin.applyMatrix4(t),this.direction.sub(this.origin),this},distanceSqToSegment:function(t,e,i,n){var s,r,a,o,h=t.clone().add(e).multiplyScalar(.5),l=e.clone().sub(t).normalize(),c=.5*t.distanceTo(e),u=this.origin.clone().sub(h),d=-this.direction.dot(l),f=u.dot(this.direction),g=-u.dot(l),_=u.lengthSq(),p=Math.abs(1-d*d);if(p>=0)if(s=d*g-f,r=d*f-g,o=c*p,s>=0)if(r>=-o)if(r<=o){var v=1/p;s*=v,r*=v,a=s*(s+d*r+2*f)+r*(d*s+r+2*g)+_}else r=c,s=Math.max(0,-(d*r+f)),a=-s*s+r*(r+2*g)+_;else r=-c,s=Math.max(0,-(d*r+f)),a=-s*s+r*(r+2*g)+_;else r<=-o?(s=Math.max(0,-(-d*c+f)),r=s>0?-c:Math.min(Math.max(-c,-g),c),a=-s*s+r*(r+2*g)+_):r<=o?(s=0,r=Math.min(Math.max(-c,-g),c),a=r*(r+2*g)+_):(s=Math.max(0,-(d*c+f)),r=s>0?c:Math.min(Math.max(-c,-g),c),a=-s*s+r*(r+2*g)+_);else r=d>0?-c:c,s=Math.max(0,-(d*r+f)),a=-s*s+r*(r+2*g)+_;return i&&i.copy(this.direction.clone().multiplyScalar(s).add(this.origin)),n&&n.copy(l.clone().multiplyScalar(r).add(h)),a},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)},clone:function(){return(new Ke.Ray).copy(this)}},Ke.Ray.__v1=new Je,Ke.Ray.__v2=new Je,Ke.Triangle=function(t,i,n){this.a=t!==e?t:new Je,this.b=i!==e?i:new Je,this.c=n!==e?n:new Je},Ke.Triangle.normal=function(t,e,i,n){var s=n||new Je;s.subVectors(i,e),Ke.Triangle.__v0.subVectors(t,e),s.cross(Ke.Triangle.__v0);var r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)},Ke.Triangle.barycoordFromPoint=function(t,e,i,n,s){Ke.Triangle.__v0.subVectors(n,e),Ke.Triangle.__v1.subVectors(i,e),Ke.Triangle.__v2.subVectors(t,e);var r=Ke.Triangle.__v0.dot(Ke.Triangle.__v0),a=Ke.Triangle.__v0.dot(Ke.Triangle.__v1),o=Ke.Triangle.__v0.dot(Ke.Triangle.__v2),h=Ke.Triangle.__v1.dot(Ke.Triangle.__v1),l=Ke.Triangle.__v1.dot(Ke.Triangle.__v2),c=r*h-a*a,u=s||new Je;if(0==c)return u.set(-2,-1,-1);var d=1/c,f=(h*o-a*l)*d,g=(r*l-a*o)*d;return u.set(1-f-g,g,f)},Ke.Triangle.containsPoint=function(t,e,i,n){var s=Ke.Triangle.barycoordFromPoint(t,e,i,n,Ke.Triangle.__v3);return s.x>=0&&s.y>=0&&s.x+s.y<=1},Ke.Triangle.prototype={constructor:Ke.Triangle,set:function(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this},setFromPointsAndIndices:function(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},area:function(){return Ke.Triangle.__v0.subVectors(this.c,this.b),Ke.Triangle.__v1.subVectors(this.a,this.b),.5*Ke.Triangle.__v0.cross(Ke.Triangle.__v1).length()},midpoint:function(t){var e=t||new Je;return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(t){return Ke.Triangle.normal(this.a,this.b,this.c,t)},plane:function(t){var e=t||new Ke.math.Plane;return e.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(t,e){return Ke.Triangle.barycoordFromPoint(t,this.a,this.b,this.c,e)},containsPoint:function(t){return Ke.Triangle.containsPoint(t,this.a,this.b,this.c)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)},clone:function(){return(new Ke.Triangle).copy(this)},intersectLine:function(t,e){var i=this.plane(),n=i.intersectLine(t,e);return null!=n&&this.containsPoint(n)}},Ke.Triangle.__v0=new Je,Ke.Triangle.__v1=new Je,Ke.Triangle.__v2=new Je,Ke.Triangle.__v3=new Je;var ei={getLogicalPoint:function(t,e){var i,n=t.getBoundingClientRect();if(ii.isTouchable&&e.changedTouches&&e.changedTouches.length>0){var s=e.changedTouches[0],r=ii.isAndroid?0:$touch.scrollLeft(),a=ii.isAndroid?0:$touch.scrollTop();i={x:s.clientX+t.scrollLeft-n.left-r,y:s.clientY+t.scrollTop-n.top-a}}else{if(!ei.isValidEvent(t,e))return null;i={x:e.clientX-n.left+t.scrollLeft,y:e.clientY-n.top+t.scrollTop}}return i},isValidEvent:function(t,e){if(!e)return!1;if(e.target===t)if(ii.isFirefox){if(t.clientHeight<t.scrollHeight&&e.layerX<25)return!1;if(t.clientWidth<t.scrollWidth&&e.layerY<25)return!1}else if(e.offsetX>t.clientWidth||e.offsetY>t.clientHeight)return!1;return!0},isImage:function(t){return t&&t.nodeName&&"img"===t.nodeName.toLowerCase()},isCanvas:function(t){return t&&t.nodeName&&"canvas"===t.nodeName.toLowerCase()},createView:function(t,e){var i=document.createElement("div");return i.style.position=mi.VIEW_POSITION,i.style.fontSize=mi.VIEW_FONT_SIZE,i.style.fontFamily=mi.VIEW_FONT_FAMILY,i.style.cursor="default",i.style.outline="none",i.style.textAlign="left",i.style.msTouchAction="none",i.tabIndex=0,e||(i.onmousedown=ei.preventDefault),i.style.setProperty&&(i.style.setProperty("-khtml-user-select","none",null),i.style.setProperty("-webkit-user-select","none",null),i.style.setProperty("-moz-user-select","none",null),i.style.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null)),t&&(i.style.overflow=t),i},preventDefault:function(t){mi.KEEP_DEFAULT_FUNCTION(t)||(t.preventDefault?t.preventDefault():t.preventManipulation?t.preventManipulation():t.returnValue=!1)},createCanvas:function(t){var e=document.createElement("canvas"),i=t.getView();return e.width=i.width,e.height=i.height,e.style.msTouchAction="none",e.style.position="absolute",e},isCtrlDown:function(t){return t.ctrlKey||t.metaKey},getScrollTop:function(t){if(!t)return 0;var e=t.scrollTop,i=t.parentElement;return e+this.getScrollTop(i)},getScrollLeft:function(t){if(!t)return 0;var e=t.scrollLeft,i=t.parentElement;return e+this.getScrollLeft(i)},debug:function(t,e){try{t.call(e)}catch(i){alert(i)}},setFocus:function(t){if(document.activeElement!==t){var e,i,n,s=document.documentElement;document.body;s&&(ii.isIE||ii.isOpera||s.scrollLeft||s.scrollTop)&&(e=s.scrollLeft,i=s.scrollTop,n=s),t.focus(),n&&(n.scrollLeft=e,n.scrollTop=i)}},isRightClick:function(e){var i;if(!e)var e=t.event;return e.which?i=3==e.which:e.button&&(i=2==e.button),i}};Ke.html=ei;var ii=function(){var t={},e=navigator.userAgent.toLowerCase();return t.isOpera=/opera/.test(e),t.isIE=/msie/.test(e)||/trident/.test(e),t.isFirefox=/firefox/i.test(e),t.isChrome=/chrome/i.test(e),t.isSafari=!t.isChrome&&/safari/i.test(e),t.isIPhone=/iphone/.test(e),t.isIPod=/ipod/.test(e),t.isIPad=/ipad/.test(e),t.isAndroid=/android/i.test(e),t.isWebOS=/webos/i.test(e),t.isMSToucheable=navigator.msMaxTouchPoints&&navigator.msMaxTouchPoints>1,t.isTouchable="ontouchend"in document||t.isMSToucheable,t.isIOS=t.isIPhone||t.isIPod||t.isIPad,t}();Ke.ua=ii,function(){function e(t){var e,i,s,r,a,o;for(s=t.length,i=0,e="";i<s;){if(r=255&t.charCodeAt(i++),i==s){e+=n.charAt(r>>2),e+=n.charAt((3&r)<<4),e+="==";break}if(a=t.charCodeAt(i++),i==s){e+=n.charAt(r>>2),e+=n.charAt((3&r)<<4|(240&a)>>4),e+=n.charAt((15&a)<<2),e+="=";break}o=t.charCodeAt(i++),e+=n.charAt(r>>2),e+=n.charAt((3&r)<<4|(240&a)>>4),e+=n.charAt((15&a)<<2|(192&o)>>6),e+=n.charAt(63&o)}return e}function i(t){var e,i,n,r,a,o,h;for(o=t.length,a=0,h="";a<o;){do e=s[255&t.charCodeAt(a++)];while(a<o&&e==-1);if(e==-1)break;do i=s[255&t.charCodeAt(a++)];while(a<o&&i==-1);if(i==-1)break;h+=String.fromCharCode(e<<2|(48&i)>>4);do{if(n=255&t.charCodeAt(a++),61==n)return h;n=s[n]}while(a<o&&n==-1);if(n==-1)break;h+=String.fromCharCode((15&i)<<4|(60&n)>>2);do{if(r=255&t.charCodeAt(a++),61==r)return h;r=s[r]}while(a<o&&r==-1);if(r==-1)break;h+=String.fromCharCode((3&n)<<6|r)}return h}var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=new Array((-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),62,(-1),(-1),(-1),63,52,53,54,55,56,57,58,59,60,61,(-1),(-1),(-1),(-1),(-1),(-1),(-1),0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,(-1),(-1),(-1),(-1),(-1),(-1),26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,(-1),(-1),(-1),(-1),(-1));t.btoa||(t.btoa=e),t.atob||(t.atob=i)}();var ni=function(){var e=!1,i=document.createElement("canvas");if(i.getContext("2d")&&(e=!0),!e)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};var n=!!i.getContext("2d").getImageData,s=!!i.toDataURL,r=!!t.btoa,a=function(t){var e=parseInt(t.width),i=parseInt(t.height);return t.getContext("2d").getImageData(0,0,e,i)},o=function(t){var e="";if("string"==typeof t)e=t;else for(var i=t,n=0;n<i.length;n++)e+=String.fromCharCode(i[n]);return btoa(e)},h=function(t){var e=[],i=t.width,n=t.height;e.push(66),e.push(77);var s=i*n*3+54;e.push(s%256),s=Math.floor(s/256),e.push(s%256),s=Math.floor(s/256),e.push(s%256),s=Math.floor(s/256),e.push(s%256),e.push(0),e.push(0),e.push(0),e.push(0),e.push(54),e.push(0),e.push(0),e.push(0);var r=[];r.push(40),r.push(0),r.push(0),r.push(0);var a=i;r.push(a%256),a=Math.floor(a/256),r.push(a%256),a=Math.floor(a/256),r.push(a%256),a=Math.floor(a/256),r.push(a%256);var h=n;r.push(h%256),h=Math.floor(h/256),r.push(h%256),h=Math.floor(h/256),r.push(h%256),h=Math.floor(h/256),r.push(h%256),r.push(1),r.push(0),r.push(24),r.push(0),r.push(0),r.push(0),r.push(0),r.push(0);var l=i*n*3;r.push(l%256),l=Math.floor(l/256),r.push(l%256),l=Math.floor(l/256),r.push(l%256),l=Math.floor(l/256),r.push(l%256);for(var c=0;c<16;c++)r.push(0);var u=(4-3*i%4)%4,d=t.data,f="",g=n;do{for(var _=i*(g-1)*4,p="",v=0;v<i;v++){var m=4*v;p+=String.fromCharCode(d[_+m+2]),p+=String.fromCharCode(d[_+m+1]),p+=String.fromCharCode(d[_+m])}for(var y=0;y<u;y++)p+=String.fromCharCode(0);f+=p}while(--g);var A=o(e.concat(r))+o(f);return A},l=function(t,e){return"data:"+e+";base64,"+t},c=function(t){var e=document.createElement("img");return e.src=t,e},u=function(t,e,i,n,s){i=i||(e?e.w:t.width),n=n||(e?e.h:t.height);var r=document.createElement("canvas");r.width=i,r.height=n,r.style.width=i+"px",r.style.height=n+"px";var a=r.getContext("2d"),a=r.getContext("2d"),o=t.style.backgroundColor;return o||(o="PNG"===s?"rgba(255,255,255,0.0)":"BMP"===s?"rgba(255,255,255,0.01)":"#FFFFFF"),a.fillStyle=o,a.fillRect(0,0,i,n),e=e?e:{x:0,y:0,w:t.width,h:t.height},a.drawImage(t,e.x,e.y,e.w,e.h,0,0,i,n),r};return{saveAsPNG:function(t,e,i,n,r){if(!s)return!1;var a=u(t,e,n,r,"PNG"),o=a.toDataURL("image/png");return i?c(o):o},saveAsJPEG:function(t,e,i,n,r){if(!s)return!1;var a=u(t,e,n,r,"JPEG"),o="image/jpeg",h=a.toDataURL(o);return 5==h.indexOf(o)&&(i?c(h):h)},saveAsBMP:function(t,e,i,s,o){if(!n||!r)return!1;var d=u(t,e,s,o,"BMP"),f=a(d),g=h(f);return i?c(l(g,"image/bmp")):l(g,"image/bmp")}}}(),si={},ri={cache:{},g:document.createElement("canvas").getContext("2d"),getTextSize:function(t,e){ri.g.font=t?t:mi.FONT;var i=ri.cache[ri.g.font];return i||(i=2*ri.g.measureText("e").width+4,ri.cache[ri.g.font]=i),{width:ri.g.measureText(e).width+4,height:i}}};si.g=ri,Ke.g=ri;var ai={};setTimeout;ai.bcld=function(t,e,i,n,s,r,a,o,h){var l,c,u=t/2,d=[],f=[],g={vertices:[],faces:[],uvs:[],uv2s:[]};for(c=0;c<=e;c++){var _=[],p=[],v=c/e,m=v*(i-n)+n;for(l=0;l<=s;l++){var y=l/s,A=new Je;A.x=m*Math.sin(y*o+h),A.y=-v*t+u,A.z=m*Math.cos(y*o+h),g.vertices.push(A),_.push(g.vertices.length-1),p.push(new Qe(y,1-v))}d.push(_),f.push(p)}var x,w,b=(i-n)/t;for(l=0;l<s;l++)for(0!==n?(x=g.vertices[d[0][l]].clone(),w=g.vertices[d[0][l+1]].clone()):(x=g.vertices[d[1][l]].clone(),w=g.vertices[d[1][l+1]].clone()),x.setY(Math.sqrt(x.x*x.x+x.z*x.z)*b).normalize(),w.setY(Math.sqrt(w.x*w.x+w.z*w.z)*b).normalize(),c=0;c<e;c++){var S=d[c][l],C=d[c+1][l],T=d[c+1][l+1],E=d[c][l+1],L=x.clone(),M=x.clone(),P=w.clone(),k=w.clone(),I=f[c][l].clone(),R=f[c+1][l].clone(),D=f[c+1][l+1].clone(),B=f[c][l+1].clone();g.faces.push(new _i(S,C,E,[L,M,k],null,0)),g.uvs.push([I,R,B]),g.uv2s.push([I.clone(),R.clone(),B.clone()]),g.faces.push(new _i(C,T,E,[M,P,k],null,0)),g.uvs.push([R,D,B]),g.uv2s.push([R.clone(),D.clone(),B.clone()])}var N=!1;if(r===!1&&n>0)for(g.vertices.push(new Je(0,u,0)),N=!0,l=0;l<s;l++){var S=d[0][l],C=d[0][l+1],T=g.vertices.length-1,L=new Je(0,1,0),M=new Je(0,1,0),P=new Je(0,1,0),z=g.vertices[S],O=g.vertices[C],I=new Qe((z.x/n+1)/2,1-(z.z/n+1)/2),R=new Qe((O.x/n+1)/2,1-(O.z/n+1)/2),D=new Qe(.5,.5);g.faces.push(new _i(S,C,T,[L,M,P],null,1)),g.uvs.push([I,R,D]),g.uv2s.push([I.clone(),R.clone(),D.clone()])}var F=!1;if(a===!1&&i>0)for(g.vertices.push(new Je(0,(-u),0)),F=!0,l=0;l<s;l++){var S=d[c][l+1],C=d[c][l],T=g.vertices.length-1,L=new Je(0,(-1),0),M=new Je(0,(-1),0),P=new Je(0,(-1),0),z=g.vertices[S],O=g.vertices[C],I=new Qe((z.x/i+1)/2,(z.z/i+1)/2),R=new Qe((O.x/i+1)/2,(O.z/i+1)/2),D=new Qe(.5,.5);g.faces.push(new _i(S,C,T,[L,M,P],null,2)),g.uvs.push([I,R,D]),g.uv2s.push([I.clone(),R.clone(),D.clone()])}if(o!==2*Math.PI){!N&&g.vertices.push(new Je(0,u,0)),!F&&g.vertices.push(new Je(0,(-u),0));var S=d[0][0],C=d[e][0],T=g.vertices.length-1,E=g.vertices.length-2,I=new Qe(0,0),R=new Qe(0,1),D=new Qe(1,1),B=new Qe(1,0);g.faces.push(new _i(S,T,C)),g.uvs.push([I,D,R]),g.uv2s.push([I.clone(),D.clone(),R.clone()]),g.faces.push(new _i(E,T,S)),g.uvs.push([B,D,I]),g.uv2s.push([B.clone(),D.clone(),I.clone()]),S=d[0][s],C=d[e][s];var I=new Qe(0,0),R=new Qe(0,1),D=new Qe(1,1),B=new Qe(1,0);g.faces.push(new _i(S,C,E)),g.uvs.push([I,R,B]),g.uv2s.push([I.clone(),R.clone(),B.clone()]),g.faces.push(new _i(C,T,E)),g.uvs.push([R,D,B]),g.uv2s.push([R.clone(),D.clone(),B.clone()])}return g},ai.buildCubeData=function(t,e,i,n,s,r,a,o){function h(h){var g,_,p,v,m,y,A,x,w,b;l=c.length;var S,C="six-each"==a||"front-other"==a||"back-other"==a||"left-other"==a||"right-other"==a||"top-other"==a||"bottom-other"==a,T=new Qe(0,0),E=C?new Qe(1/3,.5):new Qe(1,1),L=a.split("-")[0];"six"==L?L=null:E=new Qe(.5,1),"right"==h?(g="z",_="y",p="x",v=-1,m=-1,y=t/2,A=i,x=e,w=r,b=s,S=0,T=new Qe(2/3,0)):"left"==h?(g="z",_="y",p="x",v=1,m=-1,y=-t/2,A=i,x=e,w=r,b=s,S=1):"top"==h?(g="x",_="z",p="y",v=1,m=1,y=e/2,A=t,x=i,w=n,b=r,S=2,T=new Qe(1/3,.5)):"bottom"==h?(g="x",_="z",p="y",v=1,m=-1,y=-e/2,A=t,x=i,w=n,b=r,S=3,T=new Qe(0,.5)):"front"==h?(g="x",_="y",p="z",v=1,m=-1,y=i/2,A=t,x=e,w=n,b=s,S=4,T=new Qe(1/3,0)):"back"==h&&(g="x",_="y",p="z",v=-1,m=-1,y=-i/2,A=t,x=e,w=n,b=s,S=5,T=new Qe(2/3,.5)),L&&(T=L==h?new Qe(0,0):new Qe(.5,0));var M,P,k=w+1,I=b+1;for(P=0;P<I;P++)for(M=0;M<k;M++){var R=new Je;R[g]=(M/w*A-A/2)*v+o[g],R[_]=(P/b*x-x/2)*m+o[_],R[p]=y+o[p],c.push(R)}C&&(S=0);var D=new Je;for(D[p]=y>0?1:-1,P=0;P<b;P++)for(M=0;M<w;M++){var B=M+k*P,N=M+k*(P+1),z=M+1+k*(P+1),O=M+1+k*P,F=[new Qe(M/w,1-P/b),new Qe(M/w,1-(P+1)/b),new Qe((M+1)/w,1-(P+1)/b),new Qe((M+1)/w,1-P/b)];if(C)for(var V=0;V<F.length;V++)F[V].multiply(E).add(T);var U=new pi(B+l,N+l,z+l,O+l);U.normal.copy(D),U.vertexNormals.push(D.clone(),D.clone(),D.clone(),D.clone()),U.materialIndex=S,u.push(U),d.push([F[0],F[1],F[2],F[3]]),f.push([F[0].clone(),F[1].clone(),F[2].clone(),F[3].clone()])}}var l,c=[],u=[],d=[],f=[];h("right"),h("left"),h("top"),h("bottom"),h("front"),h("back");var g={vertices:c,faces:u,uvs:d,uv2s:f};return g},ai.bsd=function(t,e,i,n,s,r,a){var o,h,l=[],c=[],u=[],d=[],f=[],g=[];for(h=0;h<=i;h++){var _=[],p=[];for(o=0;o<=e;o++){var v=o/e,m=h/i,y=new Je;y.x=-t*Math.cos(n+v*s)*Math.sin(r+m*a),y.y=t*Math.cos(r+m*a),y.z=t*Math.sin(n+v*s)*Math.sin(r+m*a),l.push(y),_.push(l.length-1),p.push(new Qe(v,1-m))}f.push(_),g.push(p)}for(h=0;h<i;h++)for(o=0;o<e;o++){var A=f[h][o+1],x=f[h][o],w=f[h+1][o],b=f[h+1][o+1],S=l[A].clone().normalize(),C=l[x].clone().normalize(),T=l[w].clone().normalize(),E=l[b].clone().normalize(),L=g[h][o+1].clone(),M=g[h][o].clone(),P=g[h+1][o].clone(),k=g[h+1][o+1].clone();Math.abs(l[A].y)===t?(u.push(new _i(A,w,b,[S,T,E])),c.push([L,P,k]),d.push([L.clone(),P.clone(),k.clone()])):Math.abs(l[w].y)===t?(u.push(new _i(A,x,w,[S,C,T])),c.push([L,M,P]),d.push([L.clone(),M.clone(),P.clone()])):(u.push(new _i(A,x,b,[S,C,E])),c.push([L,M,k]),d.push([L.clone(),M.clone(),k.clone()]),u.push(new _i(x,w,b,[C.clone(),T,E.clone()])),c.push([M.clone(),P,k.clone()]),d.push([M.clone(),P.clone(),k.clone()]))}return{vertices:l,faces:u,uvs:c,uv2s:d}};var oi=function(t){var i,n,s,r,a,o,h,l={},c=t.primitive;if(c.groups)return t.groups=c.groups,void(t.groupList=c.groupList);c.groups={};var u=t.material,d=t.getMaterialMapping();for(i=0,n=c.faces.length;i<n;i++)s=c.faces[i],r=u instanceof Ke.ArrayMaterial?s.materialIndex:0,r=d[r],o=r!==e?r:-1,l[o]===e&&(l[o]={hash:o,counter:0}),h=l[o].hash+"_"+l[o].counter,c.groups[h]===e&&(c.groups[h]={faces3:[],faces4:[],materialIndex:r,vertices:0}),a=s instanceof _i?3:4,c.groups[h].vertices+a>65535&&(l[o].counter+=1,h=l[o].hash+"_"+l[o].counter,c.groups[h]===e&&(c.groups[h]={faces3:[],faces4:[],materialIndex:r,vertices:0})),s instanceof _i?c.groups[h].faces3.push(i):c.groups[h].faces4.push(i),c.groups[h].vertices+=a;c.groupsList=[];for(var f in t.groups)c.groupsList.push(t.groups[f]);t.groups=c.groups,t.groupList=c.groupsList},hi=function(t,i,n,s){var r,a,o,h,l,c,u,d,f,g,_,p,v,m,y=t,A=y,x=A.vertices,w=x.length,b=A.colors,S=b.length,C=A.sizes,T=C.length,E=s.__vertexArray,L=s.__colorArray,M=s.__normalArray,P=s.__sortArray,k=A.verticesNeedUpdate,I=(A.elementsNeedUpdate,A.normalsNeedUpdate),R=A.colorsNeedUpdate,D=A.__webglCustomAttributesList;if(T<w&&(T=w),y.sortParticles){for(_projScreenMatrixPS.copy(_projScreenMatrix),_projScreenMatrixPS.multiply(y.matrixWorld),r=0;r<w;r++)h=x[r],_vector3.copy(h),_vector3.applyProjection(_projScreenMatrixPS),P[r]=[_vector3.z,r];for(P.sort(numericalSort),r=0;r<w;r++)h=x[P[r][1]],l=3*r,E[l]=h.x,E[l+1]=h.y,E[l+2]=h.z;for(a=0;a<S;a++)l=3*a,u=b[P[a][1]],L[l]=u.r,L[l+1]=u.g,L[l+2]=u.b;for(o=0;o<T;o++)l=3*o,d=C[P[o][1]],d=null==d?1:d,M[l]=null==d.x?d||1:d.x,M[l+1]=0,M[l+2]=0;if(D)for(f=0,g=D.length;f<g;f++)if(m=D[f],m.boundTo===e||"vertices"===m.boundTo)if(l=0,p=m.value.length,1===m.size)for(_=0;_<p;_++)c=P[_][1],m.array[_]=m.value[c];else if(2===m.size)for(_=0;_<p;_++)c=P[_][1],v=m.value[c],m.array[l]=v.x,m.array[l+1]=v.y,l+=2;else if(3===m.size)if("c"===m.type)for(_=0;_<p;_++)c=P[_][1],v=m.value[c],m.array[l]=v.r,m.array[l+1]=v.g,m.array[l+2]=v.b,l+=3;else for(_=0;_<p;_++)c=P[_][1],v=m.value[c],m.array[l]=v.x,m.array[l+1]=v.y,m.array[l+2]=v.z,l+=3;else if(4===m.size)for(_=0;_<p;_++)c=P[_][1],v=m.value[c],m.array[l]=v.x,m.array[l+1]=v.y,m.array[l+2]=v.z,m.array[l+3]=v.w,l+=4}else{if(k)for(r=0;r<w;r++)h=x[r],l=3*r,E[l]=h.x,E[l+1]=h.y,E[l+2]=h.z;if(R)for(a=0;a<S;a++)u=b[a],l=3*a,L[l]=u.r,L[l+1]=u.g,L[l+2]=u.b;if(I)for(o=0;o<T;o++)d=null==C[o]?1:C[o],l=3*o,M[l]=null==d.x?d||1:d.x,M[l+1]=0,M[l+2]=0;if(D)for(f=0,g=D.length;f<g;f++)if(m=D[f],m.needsUpdate&&(m.boundTo===e||"vertices"===m.boundTo))if(p=m.value.length,l=0,1===m.size)for(_=0;_<p;_++)m.array[_]=m.value[_];else if(2===m.size)for(_=0;_<p;_++)v=m.value[_],m.array[l]=v.x,m.array[l+1]=v.y,l+=2;else if(3===m.size)if("c"===m.type)for(_=0;_<p;_++)v=m.value[_],m.array[l]=v.r,m.array[l+1]=v.g,m.array[l+2]=v.b,l+=3;else for(_=0;_<p;_++)v=m.value[_],m.array[l]=v.x,m.array[l+1]=v.y,m.array[l+2]=v.z,l+=3;else if(4===m.size)for(_=0;_<p;_++)v=m.value[_],m.array[l]=v.x,m.array[l+1]=v.y,m.array[l+2]=v.z,m.array[l+3]=v.w,l+=4}if((k||y.sortParticles)&&(n.bindBuffer(n.ARRAY_BUFFER,s.__webglVertexBuffer),n.bufferData(n.ARRAY_BUFFER,E,i)),(R||y.sortParticles)&&(n.bindBuffer(n.ARRAY_BUFFER,s.__webglColorBuffer),n.bufferData(n.ARRAY_BUFFER,L,i)),(I||y.sortParticles)&&(n.bindBuffer(n.ARRAY_BUFFER,s.__webglNormalBuffer),n.bufferData(n.ARRAY_BUFFER,M,i)),D)for(f=0,g=D.length;f<g;f++)m=D[f],(m.needsUpdate||y.sortParticles)&&(n.bindBuffer(n.ARRAY_BUFFER,m.buffer),n.bufferData(n.ARRAY_BUFFER,m.array,i))};ai.buildGroupBufferData=function(t,i,n,s,r,a,o,h){var l="basic"!=r._type,c=r.isVertexColor(),u=r.needUV();l=!0;var d,f,g,_,p,v,m,y,A,x,w,b,S,C,T,E,L,M,P,k,I,R,D,B,N,z=h.needSmoothNormal(i,r),O=0,F=0,V=0,U=0,H=0,W=0,X=0,G=0,Z=0,Y=0,j=o.__vertexArray,q=o.__uvArray,K=o.__uv2Array,Q=o.__normalArray,J=o.__colorArray,$=o.__webglCustomAttributesList,tt=o.__faceArray,et=o.__lineArray,it=i,nt=it.verticesNeedUpdate,st=it.elementsNeedUpdate,rt=it.uvsNeedUpdate,at=it.normalsNeedUpdate,ot=(it.tangentsNeedUpdate,
it.colorsNeedUpdate),ht=(it.morphTargetsNeedUpdate,it.vertices),lt=t.faces3,ct=t.faces4,ut=it.faces,dt=it.uvs,ft=it.uv2s;it.colors,it.skinIndices,it.skinWeights,it.morphTargets,it.morphNormals;if(nt){for(d=0,f=lt.length;d<f;d++)_=ut[lt[d]],w=ht[_.a],b=ht[_.b],S=ht[_.c],j[F]=w.x,j[F+1]=w.y,j[F+2]=w.z,j[F+3]=b.x,j[F+4]=b.y,j[F+5]=b.z,j[F+6]=S.x,j[F+7]=S.y,j[F+8]=S.z,F+=9;for(d=0,f=ct.length;d<f;d++)_=ut[ct[d]],w=ht[_.a],b=ht[_.b],S=ht[_.c],C=ht[_.d],j[F]=w.x,j[F+1]=w.y,j[F+2]=w.z,j[F+3]=b.x,j[F+4]=b.y,j[F+5]=b.z,j[F+6]=S.x,j[F+7]=S.y,j[F+8]=S.z,j[F+9]=C.x,j[F+10]=C.y,j[F+11]=C.z,F+=12;a.bindBuffer(a.ARRAY_BUFFER,o.__webglVertexBuffer),a.bufferData(a.ARRAY_BUFFER,j,n),o.__vertexArray=j}if(ot&&c){for(d=0,f=lt.length;d<f;d++)_=ut[lt[d]],m=_.vertexColors,y=_.color,3===m.length&&c===Ke.VertexColors?(T=m[0],E=m[1],L=m[2]):(T=y,E=y,L=y),J[G]=T.r,J[G+1]=T.g,J[G+2]=T.b,J[G+3]=E.r,J[G+4]=E.g,J[G+5]=E.b,J[G+6]=L.r,J[G+7]=L.g,J[G+8]=L.b,G+=9;for(d=0,f=ct.length;d<f;d++)_=ut[ct[d]],m=_.vertexColors,y=_.color,4===m.length&&c===Ke.VertexColors?(T=m[0],E=m[1],L=m[2],M=m[3]):(T=y,E=y,L=y,M=y),J[G]=T.r,J[G+1]=T.g,J[G+2]=T.b,J[G+3]=E.r,J[G+4]=E.g,J[G+5]=E.b,J[G+6]=L.r,J[G+7]=L.g,J[G+8]=L.b,J[G+9]=M.r,J[G+10]=M.g,J[G+11]=M.b,G+=12;G>0&&(a.bindBuffer(a.ARRAY_BUFFER,o.__webglColorBuffer),a.bufferData(a.ARRAY_BUFFER,J,n))}if(at&&l){for(d=0,f=lt.length;d<f;d++)if(_=ut[lt[d]],p=_.vertexNormals,v=_.normal,3===p.length&&z)for(P=0;P<3;P++)I=p[P],Q[W]=I.x,Q[W+1]=I.y,Q[W+2]=I.z,W+=3;else for(P=0;P<3;P++)Q[W]=v.x,Q[W+1]=v.y,Q[W+2]=v.z,W+=3;for(d=0,f=ct.length;d<f;d++)if(_=ut[ct[d]],p=_.vertexNormals,v=_.normal,4===p.length&&z)for(P=0;P<4;P++)I=p[P],null==Q&&console.log("normal array is null"),Q[W]=I.x,Q[W+1]=I.y,Q[W+2]=I.z,W+=3;else for(P=0;P<4;P++)Q[W]=v.x,Q[W+1]=v.y,Q[W+2]=v.z,W+=3;a.bindBuffer(a.ARRAY_BUFFER,o.__webglNormalBuffer),a.bufferData(a.ARRAY_BUFFER,Q,n),o.__normalArray=Q}if(rt&&dt&&u){for(d=0,f=lt.length;d<f;d++)if(g=lt[d],A=dt[g],A!==e)for(P=0;P<3;P++)R=A[P],q[V]=R.x,q[V+1]=R.y,V+=2;for(d=0,f=ct.length;d<f;d++)if(g=ct[d],A=dt[g],A!==e)for(P=0;P<4;P++)R=A[P],q[V]=R.x,q[V+1]=R.y,V+=2;V>0&&(a.bindBuffer(a.ARRAY_BUFFER,o.__webglUVBuffer),a.bufferData(a.ARRAY_BUFFER,q,n),o.uvArray=q)}if(rt&&ft&&u){for(d=0,f=lt.length;d<f;d++)if(g=lt[d],x=ft[g],x!==e)for(P=0;P<3;P++)D=x[P],K[U]=D.x,K[U+1]=D.y,U+=2;for(d=0,f=ct.length;d<f;d++)if(g=ct[d],x=ft[g],x!==e)for(P=0;P<4;P++)D=x[P],K[U]=D.x,K[U+1]=D.y,U+=2;U>0&&(a.bindBuffer(a.ARRAY_BUFFER,o.__webglUV2Buffer),a.bufferData(a.ARRAY_BUFFER,K,n))}if(st){for(d=0,f=lt.length;d<f;d++)tt[H]=O,tt[H+1]=O+1,tt[H+2]=O+2,H+=3,et[X]=O,et[X+1]=O+1,et[X+2]=O,et[X+3]=O+2,et[X+4]=O+1,et[X+5]=O+2,X+=6,O+=3;for(d=0,f=ct.length;d<f;d++)tt[H]=O,tt[H+1]=O+1,tt[H+2]=O+3,tt[H+3]=O+1,tt[H+4]=O+2,tt[H+5]=O+3,H+=6,et[X]=O,et[X+1]=O+1,et[X+2]=O,et[X+3]=O+3,et[X+4]=O+1,et[X+5]=O+2,et[X+6]=O+2,et[X+7]=O+3,X+=8,O+=4;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,tt,n),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,et,n),o.__lineArray=et}if($)for(P=0,k=$.length;P<k;P++)if(N=$[P],N.__original.needsUpdate){if(Z=0,Y=0,1===N.size){if(N.boundTo===e||"vertices"===N.boundTo){for(d=0,f=lt.length;d<f;d++)_=ut[lt[d]],N.array[Z]=N.value[_.a],N.array[Z+1]=N.value[_.b],N.array[Z+2]=N.value[_.c],Z+=3;for(d=0,f=ct.length;d<f;d++)_=ut[ct[d]],N.array[Z]=N.value[_.a],N.array[Z+1]=N.value[_.b],N.array[Z+2]=N.value[_.c],N.array[Z+3]=N.value[_.d],Z+=4}else if("faces"===N.boundTo){for(d=0,f=lt.length;d<f;d++)B=N.value[lt[d]],N.array[Z]=B,N.array[Z+1]=B,N.array[Z+2]=B,Z+=3;for(d=0,f=ct.length;d<f;d++)B=N.value[ct[d]],N.array[Z]=B,N.array[Z+1]=B,N.array[Z+2]=B,N.array[Z+3]=B,Z+=4}}else if(2===N.size){if(N.boundTo===e||"vertices"===N.boundTo){for(d=0,f=lt.length;d<f;d++)_=ut[lt[d]],w=N.value[_.a],b=N.value[_.b],S=N.value[_.c],N.array[Z]=w.x,N.array[Z+1]=w.y,N.array[Z+2]=b.x,N.array[Z+3]=b.y,N.array[Z+4]=S.x,N.array[Z+5]=S.y,Z+=6;for(d=0,f=ct.length;d<f;d++)_=ut[ct[d]],w=N.value[_.a],b=N.value[_.b],S=N.value[_.c],C=N.value[_.d],N.array[Z]=w.x,N.array[Z+1]=w.y,N.array[Z+2]=b.x,N.array[Z+3]=b.y,N.array[Z+4]=S.x,N.array[Z+5]=S.y,N.array[Z+6]=C.x,N.array[Z+7]=C.y,Z+=8}else if("faces"===N.boundTo){for(d=0,f=lt.length;d<f;d++)B=N.value[lt[d]],w=B,b=B,S=B,N.array[Z]=w.x,N.array[Z+1]=w.y,N.array[Z+2]=b.x,N.array[Z+3]=b.y,N.array[Z+4]=S.x,N.array[Z+5]=S.y,Z+=6;for(d=0,f=ct.length;d<f;d++)B=N.value[ct[d]],w=B,b=B,S=B,C=B,N.array[Z]=w.x,N.array[Z+1]=w.y,N.array[Z+2]=b.x,N.array[Z+3]=b.y,N.array[Z+4]=S.x,N.array[Z+5]=S.y,N.array[Z+6]=C.x,N.array[Z+7]=C.y,Z+=8}}else if(3===N.size){var gt;if(gt="c"===N.type?["r","g","b"]:["x","y","z"],N.boundTo===e||"vertices"===N.boundTo){for(d=0,f=lt.length;d<f;d++)_=ut[lt[d]],w=N.value[_.a],b=N.value[_.b],S=N.value[_.c],N.array[Z]=w[gt[0]],N.array[Z+1]=w[gt[1]],N.array[Z+2]=w[gt[2]],N.array[Z+3]=b[gt[0]],N.array[Z+4]=b[gt[1]],N.array[Z+5]=b[gt[2]],N.array[Z+6]=S[gt[0]],N.array[Z+7]=S[gt[1]],N.array[Z+8]=S[gt[2]],Z+=9;for(d=0,f=ct.length;d<f;d++)_=ut[ct[d]],w=N.value[_.a],b=N.value[_.b],S=N.value[_.c],C=N.value[_.d],N.array[Z]=w[gt[0]],N.array[Z+1]=w[gt[1]],N.array[Z+2]=w[gt[2]],N.array[Z+3]=b[gt[0]],N.array[Z+4]=b[gt[1]],N.array[Z+5]=b[gt[2]],N.array[Z+6]=S[gt[0]],N.array[Z+7]=S[gt[1]],N.array[Z+8]=S[gt[2]],N.array[Z+9]=C[gt[0]],N.array[Z+10]=C[gt[1]],N.array[Z+11]=C[gt[2]],Z+=12}else if("faces"===N.boundTo){for(d=0,f=lt.length;d<f;d++)B=N.value[lt[d]],w=B,b=B,S=B,N.array[Z]=w[gt[0]],N.array[Z+1]=w[gt[1]],N.array[Z+2]=w[gt[2]],N.array[Z+3]=b[gt[0]],N.array[Z+4]=b[gt[1]],N.array[Z+5]=b[gt[2]],N.array[Z+6]=S[gt[0]],N.array[Z+7]=S[gt[1]],N.array[Z+8]=S[gt[2]],Z+=9;for(d=0,f=ct.length;d<f;d++)B=N.value[ct[d]],w=B,b=B,S=B,C=B,N.array[Z]=w[gt[0]],N.array[Z+1]=w[gt[1]],N.array[Z+2]=w[gt[2]],N.array[Z+3]=b[gt[0]],N.array[Z+4]=b[gt[1]],N.array[Z+5]=b[gt[2]],N.array[Z+6]=S[gt[0]],N.array[Z+7]=S[gt[1]],N.array[Z+8]=S[gt[2]],N.array[Z+9]=C[gt[0]],N.array[Z+10]=C[gt[1]],N.array[Z+11]=C[gt[2]],Z+=12}else if("faceVertices"===N.boundTo){for(d=0,f=lt.length;d<f;d++)B=N.value[lt[d]],w=B[0],b=B[1],S=B[2],N.array[Z]=w[gt[0]],N.array[Z+1]=w[gt[1]],N.array[Z+2]=w[gt[2]],N.array[Z+3]=b[gt[0]],N.array[Z+4]=b[gt[1]],N.array[Z+5]=b[gt[2]],N.array[Z+6]=S[gt[0]],N.array[Z+7]=S[gt[1]],N.array[Z+8]=S[gt[2]],Z+=9;for(d=0,f=ct.length;d<f;d++)B=N.value[ct[d]],w=B[0],b=B[1],S=B[2],C=B[3],N.array[Z]=w[gt[0]],N.array[Z+1]=w[gt[1]],N.array[Z+2]=w[gt[2]],N.array[Z+3]=b[gt[0]],N.array[Z+4]=b[gt[1]],N.array[Z+5]=b[gt[2]],N.array[Z+6]=S[gt[0]],N.array[Z+7]=S[gt[1]],N.array[Z+8]=S[gt[2]],N.array[Z+9]=C[gt[0]],N.array[Z+10]=C[gt[1]],N.array[Z+11]=C[gt[2]],Z+=12}}else if(4===N.size)if(N.boundTo===e||"vertices"===N.boundTo){for(d=0,f=lt.length;d<f;d++)_=ut[lt[d]],w=N.value[_.a],b=N.value[_.b],S=N.value[_.c],N.array[Z]=w.x,N.array[Z+1]=w.y,N.array[Z+2]=w.z,N.array[Z+3]=w.w,N.array[Z+4]=b.x,N.array[Z+5]=b.y,N.array[Z+6]=b.z,N.array[Z+7]=b.w,N.array[Z+8]=S.x,N.array[Z+9]=S.y,N.array[Z+10]=S.z,N.array[Z+11]=S.w,Z+=12;for(d=0,f=ct.length;d<f;d++)_=ut[ct[d]],w=N.value[_.a],b=N.value[_.b],S=N.value[_.c],C=N.value[_.d],N.array[Z]=w.x,N.array[Z+1]=w.y,N.array[Z+2]=w.z,N.array[Z+3]=w.w,N.array[Z+4]=b.x,N.array[Z+5]=b.y,N.array[Z+6]=b.z,N.array[Z+7]=b.w,N.array[Z+8]=S.x,N.array[Z+9]=S.y,N.array[Z+10]=S.z,N.array[Z+11]=S.w,N.array[Z+12]=C.x,N.array[Z+13]=C.y,N.array[Z+14]=C.z,N.array[Z+15]=C.w,Z+=16}else if("faces"===N.boundTo){for(d=0,f=lt.length;d<f;d++)B=N.value[lt[d]],w=B,b=B,S=B,N.array[Z]=w.x,N.array[Z+1]=w.y,N.array[Z+2]=w.z,N.array[Z+3]=w.w,N.array[Z+4]=b.x,N.array[Z+5]=b.y,N.array[Z+6]=b.z,N.array[Z+7]=b.w,N.array[Z+8]=S.x,N.array[Z+9]=S.y,N.array[Z+10]=S.z,N.array[Z+11]=S.w,Z+=12;for(d=0,f=ct.length;d<f;d++)B=N.value[ct[d]],w=B,b=B,S=B,C=B,N.array[Z]=w.x,N.array[Z+1]=w.y,N.array[Z+2]=w.z,N.array[Z+3]=w.w,N.array[Z+4]=b.x,N.array[Z+5]=b.y,N.array[Z+6]=b.z,N.array[Z+7]=b.w,N.array[Z+8]=S.x,N.array[Z+9]=S.y,N.array[Z+10]=S.z,N.array[Z+11]=S.w,N.array[Z+12]=C.x,N.array[Z+13]=C.y,N.array[Z+14]=C.z,N.array[Z+15]=C.w,Z+=16}else if("faceVertices"===N.boundTo){for(d=0,f=lt.length;d<f;d++)B=N.value[lt[d]],w=B[0],b=B[1],S=B[2],N.array[Z]=w.x,N.array[Z+1]=w.y,N.array[Z+2]=w.z,N.array[Z+3]=w.w,N.array[Z+4]=b.x,N.array[Z+5]=b.y,N.array[Z+6]=b.z,N.array[Z+7]=b.w,N.array[Z+8]=S.x,N.array[Z+9]=S.y,N.array[Z+10]=S.z,N.array[Z+11]=S.w,Z+=12;for(d=0,f=ct.length;d<f;d++)B=N.value[ct[d]],w=B[0],b=B[1],S=B[2],C=B[3],N.array[Z]=w.x,N.array[Z+1]=w.y,N.array[Z+2]=w.z,N.array[Z+3]=w.w,N.array[Z+4]=b.x,N.array[Z+5]=b.y,N.array[Z+6]=b.z,N.array[Z+7]=b.w,N.array[Z+8]=S.x,N.array[Z+9]=S.y,N.array[Z+10]=S.z,N.array[Z+11]=S.w,N.array[Z+12]=C.x,N.array[Z+13]=C.y,N.array[Z+14]=C.z,N.array[Z+15]=C.w,Z+=16}a.bindBuffer(a.ARRAY_BUFFER,N.buffer),a.bufferData(a.ARRAY_BUFFER,N.array,n)}s&&ai.deleteGroupBufferData(t)},ai.buildLineBufferData=function(t,i,n,s){var r,a,o,h,l,c,u,d,f,g,_,p,v=t,m=v.vertices,y=v.colors,A=v.lineDistances,x=m.length,w=y.length,b=A.length,S=s.__vertexArray,C=s.__colorArray,T=s.__lineDistanceArray,E=v.verticesNeedUpdate,L=v.colorsNeedUpdate,M=v.lineDistancesNeedUpdate,P=v.__webglCustomAttributesList;if(E){for(r=0;r<x;r++)h=m[r],l=3*r,S[l]=h.x,S[l+1]=h.y,S[l+2]=h.z;n.bindBuffer(n.ARRAY_BUFFER,s.__webglVertexBuffer),n.bufferData(n.ARRAY_BUFFER,S,i)}if(L){for(a=0;a<w;a++)c=y[a],l=3*a,C[l]=c.r,C[l+1]=c.g,C[l+2]=c.b;n.bindBuffer(n.ARRAY_BUFFER,s.__webglColorBuffer),n.bufferData(n.ARRAY_BUFFER,C,i)}if(M){for(o=0;o<b;o++)T[o]=A[o];n.bindBuffer(n.ARRAY_BUFFER,s.__webglLineDistanceBuffer),n.bufferData(n.ARRAY_BUFFER,T,i)}if(P)for(u=0,d=P.length;u<d;u++)if(p=P[u],p.needsUpdate&&(p.boundTo===e||"vertices"===p.boundTo)){if(l=0,g=p.value.length,1===p.size)for(f=0;f<g;f++)p.array[f]=p.value[f];else if(2===p.size)for(f=0;f<g;f++)_=p.value[f],p.array[l]=_.x,p.array[l+1]=_.y,l+=2;else if(3===p.size)if("c"===p.type)for(f=0;f<g;f++)_=p.value[f],p.array[l]=_.r,p.array[l+1]=_.g,p.array[l+2]=_.b,l+=3;else for(f=0;f<g;f++)_=p.value[f],p.array[l]=_.x,p.array[l+1]=_.y,p.array[l+2]=_.z,l+=3;else if(4===p.size)for(f=0;f<g;f++)_=p.value[f],p.array[l]=_.x,p.array[l+1]=_.y,p.array[l+2]=_.z,p.array[l+3]=_.w,l+=4;n.bindBuffer(n.ARRAY_BUFFER,p.buffer),n.bufferData(n.ARRAY_BUFFER,p.array,i)}},ai.buildLineBufferData=function(t,i,n,s){var r,a,o,h,l,c,u,d,f,g,_,p,v=t,m=v.vertices,y=v.colors,A=v.lineDistances,x=m.length,w=y.length,b=A.length,S=s.__vertexArray,C=s.__colorArray,T=s.__lineDistanceArray,E=v.verticesNeedUpdate,L=v.colorsNeedUpdate,M=v.lineDistancesNeedUpdate,P=v.__webglCustomAttributesList;if(E){for(r=0;r<x;r++)h=m[r],l=3*r,S[l]=h.x,S[l+1]=h.y,S[l+2]=h.z;n.bindBuffer(n.ARRAY_BUFFER,s.__webglVertexBuffer),n.bufferData(n.ARRAY_BUFFER,S,i)}if(L){for(a=0;a<w;a++)c=y[a],l=3*a,C[l]=c.r,C[l+1]=c.g,C[l+2]=c.b;n.bindBuffer(n.ARRAY_BUFFER,s.__webglColorBuffer),n.bufferData(n.ARRAY_BUFFER,C,i)}if(M){for(o=0;o<b;o++)T[o]=A[o];n.bindBuffer(n.ARRAY_BUFFER,s.__webglLineDistanceBuffer),n.bufferData(n.ARRAY_BUFFER,T,i)}if(P)for(u=0,d=P.length;u<d;u++)if(p=P[u],p.needsUpdate&&(p.boundTo===e||"vertices"===p.boundTo)){if(l=0,g=p.value.length,1===p.size)for(f=0;f<g;f++)p.array[f]=p.value[f];else if(2===p.size)for(f=0;f<g;f++)_=p.value[f],p.array[l]=_.x,p.array[l+1]=_.y,l+=2;else if(3===p.size)if("c"===p.type)for(f=0;f<g;f++)_=p.value[f],p.array[l]=_.r,p.array[l+1]=_.g,p.array[l+2]=_.b,l+=3;else for(f=0;f<g;f++)_=p.value[f],p.array[l]=_.x,p.array[l+1]=_.y,p.array[l+2]=_.z,l+=3;else if(4===p.size)for(f=0;f<g;f++)_=p.value[f],p.array[l]=_.x,p.array[l+1]=_.y,p.array[l+2]=_.z,p.array[l+3]=_.w,l+=4;n.bindBuffer(n.ARRAY_BUFFER,p.buffer),n.bufferData(n.ARRAY_BUFFER,p.array,i)}},ai.deleteGroupBufferData=function(t){delete t.__inittedArrays,delete t.__colorArray,delete t.__normalArray,delete t.__tangentArray,delete t.__uvArray,delete t.__uv2Array,delete t.__faceArray,delete t.__vertexArray,delete t.__lineArray,delete t.__skinIndexArray,delete t.__skinWeightArray},ai.getMaterial=function(t,e){var i=t.material;return i instanceof Ke.ArrayMaterial?(e>i.materials.length-1&&(e=i.materials.length-1),i.materials[e]):i},Ke.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(t){var e=t.familyName.toLowerCase(),i=this;i.faces[e]=i.faces[e]||{},i.faces[e][t.cssFontWeight]=i.faces[e][t.cssFontWeight]||{},i.faces[e][t.cssFontWeight][t.cssFontStyle]=t;i.faces[e][t.cssFontWeight][t.cssFontStyle]=t;return t},drawText:function(t){var e,i=this.getFace(),n=this.size/i.resolution,s=0,r=String(t).split(""),a=r.length,o=[];for(e=0;e<a;e++){var h=new Ke.Path,l=this.extractGlyphPoints(r[e],i,n,s,h);s+=l.offset,o.push(l.path)}var c,u,d,f=s/2;for(e=0;e<a;e++){var h=o[e];for(d=0;d<h.actions.length;d++){var c=h.actions[d].args;for(u=0;u<c.length;u++)u%3===0&&(c[u]-=f)}}return{paths:o,offset:f}},extractGlyphPoints:function(t,e,i,n,s,r){var a,o,h,l,c,u,d,f,g,_,p,v,m,y,A,x,w,b,S,C=[],T=e.glyphs[t]||e.glyphs["?"],E=0;if(T){if(T.o)for(l=T._cachedOutline||(T._cachedOutline=T.o.split(" ")),u=l.length,d=i,f=i,a=0;a<u;)switch(c=l[a++]){case"m":g=l[a++]*d+n,_=l[a++]*f-E,s.moveTo(g,_,0);break;case"l":g=l[a++]*d+n,_=l[a++]*f-E,s.lineTo(g,_,0);break;case"q":if(p=l[a++]*d+n,v=l[a++]*f-E,A=l[a++]*d+n,x=l[a++]*f-E,s.quadraticCurveTo(A,x,0,p,v,0),S=C[C.length-1],S)for(m=S.x,y=S.y,o=1,h=this.divisions;o<=h;o++){var L=o/h;Ke.Shape.Utils.b2(L,m,A,p),Ke.Shape.Utils.b2(L,y,x,v)}break;case"b":if(p=l[a++]*d+n,v=l[a++]*f-E,A=l[a++]*d+n,x=l[a++]*-f-E,w=l[a++]*d+n,b=l[a++]*-f-E,s.bezierCurveTo(p,v,0,A,x,0,w,b,0),S=C[C.length-1],S)for(m=S.x,y=S.y,o=1,h=this.divisions;o<=h;o++){var L=o/h;Ke.Shape.Utils.b3(L,m,A,w,p),Ke.Shape.Utils.b3(L,y,x,b,v)}}return{offset:T.ha*i,path:s}}}},Ke.FontUtils.generateShapes=function(t,i){i=i||{};var n=i.size!==e?i.size:100,s=i.curveSegments!==e?i.curveSegments:4,r=i.font!==e?i.font:"helvetiker",a=i.weight!==e?i.weight:"normal",o=i.style!==e?i.style:"normal";Ke.FontUtils.size=n,Ke.FontUtils.divisions=s,Ke.FontUtils.face=r,Ke.FontUtils.weight=a,Ke.FontUtils.style=o;for(var h=Ke.FontUtils.drawText(t),l=h.paths,c=[],u=0,d=l.length;u<d;u++)Array.prototype.push.apply(c,l[u].toShapes());return c},function(t){var e=1e-10,i=function(t,e){var i=t.length;if(i<3)return null;var r,a,o,h=[],l=[],c=[];if(n(t)>0)for(a=0;a<i;a++)l[a]=a;else for(a=0;a<i;a++)l[a]=i-1-a;var u=i,d=2*u;for(a=u-1;u>2;){if(d--<=0)return console.log("Warning, unable to triangulate polygon!"),e?c:h;if(r=a,u<=r&&(r=0),a=r+1,u<=a&&(a=0),o=a+1,u<=o&&(o=0),s(t,r,a,o,u,l)){var f,g,_,p,v;for(f=l[r],g=l[a],_=l[o],h.push([t[f],t[g],t[_]]),c.push([l[r],l[a],l[o]]),p=a,v=a+1;v<u;p++,v++)l[p]=l[v];u--,d=2*u}}return e?c:h},n=function(t){for(var e=t.length,i=0,n=e-1,s=0;s<e;n=s++)i+=t[n].x*t[s].y-t[s].x*t[n].y;return.5*i},s=function(t,i,n,s,r,a){var o,h,l,c,u,d,f,g,_;if(h=t[a[i]].x,l=t[a[i]].y,c=t[a[n]].x,u=t[a[n]].y,d=t[a[s]].x,f=t[a[s]].y,e>(c-h)*(f-l)-(u-l)*(d-h))return!1;var p,v,m,y,A,x,w,b,S,C,T,E,L,M,P;for(p=d-c,v=f-u,m=h-d,y=l-f,A=c-h,x=u-l,o=0;o<r;o++)if(o!==i&&o!==n&&o!==s&&(g=t[a[o]].x,_=t[a[o]].y,w=g-h,b=_-l,S=g-c,C=_-u,T=g-d,E=_-f,P=p*C-v*S,L=A*b-x*w,M=m*E-y*T,P>=-e&&M>=-e&&L>=-e))return!1;return!0};return t.Triangulate=i,t.Triangulate.area=n,t}(Ke.FontUtils),self._typeface_js={faces:Ke.FontUtils.faces,loadFace:Ke.FontUtils.loadFace},Ke.typeface_js=self._typeface_js;var li={easeNone:function(t,e,i,n){return i*t/n+e},easeIn:function(t,e,i,n){return i*(t/=n)*t+e},easeOut:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeBoth:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInStrong:function(t,e,i,n){return i*(t/=n)*t*t*t+e},easeOutStrong:function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},easeBothStrong:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},elasticIn:function(t,e,i,n,s,r){var a;return 0===t?e:1===(t/=n)?e+i:(r||(r=.3*n),!s||s<Math.abs(i)?(s=i,a=r/4):a=r/(2*Math.PI)*Math.asin(i/s),-(s*Math.pow(2,10*(t-=1))*Math.sin(2*(t*n-a)*Math.PI/r))+e)},elasticOut:function(t,e,i,n,s,r){var a;return 0===t?e:1===(t/=n)?e+i:(r||(r=.3*n),!s||s<Math.abs(i)?(s=i,a=r/4):a=r/(2*Math.PI)*Math.asin(i/s),s*Math.pow(2,-10*t)*Math.sin(2*(t*n-a)*Math.PI/r)+i+e)},elasticBoth:function(t,e,i,n,s,r){var a;return 0===t?e:2===(t/=n/2)?e+i:(r||(r=.3*n*1.5),!s||s<Math.abs(i)?(s=i,a=r/4):a=r/(2*Math.PI)*Math.asin(i/s),t<1?-.5*s*Math.pow(2,10*(t-=1))*Math.sin(2*(t*n-a)*Math.PI/r)+e:s*Math.pow(2,-10*(t-=1))*Math.sin(2*(t*n-a)*Math.PI/r)*.5+i+e)},backIn:function(t,i,n,s,r){return r===e&&(r=1.70158),t===s&&(t-=.001),n*(t/=s)*t*((r+1)*t-r)+i},backOut:function(t,e,i,n,s){return"undefined"==typeof s&&(s=1.70158),i*((t=t/n-1)*t*((s+1)*t+s)+1)+e},backBoth:function(t,e,i,n,s){return"undefined"==typeof s&&(s=5.70158),(t/=n/2)<1?i/2*t*t*(((s*=1.525)+1)*t-s)+e:i/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+e},bounceIn:function(t,e,i,n){return i-li.bounceOut(n-t,0,i,n)+e},bounceOut:function(t,e,i,n){return(t/=n)<1/2.75?7.5625*i*t*t+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},bounceBoth:function(t,e,i,n){return t<n/2?.5*li.bounceIn(2*t,0,i,n)+e:.5*li.bounceOut(2*t-n,0,i,n)+.5*i+e}},ci=function(){if(this._as=[],1===arguments.length){var t=arguments[0];if(t instanceof ci&&(t=t._as),t instanceof Array)for(var e=t.length,i=0;i<e;i++)this._as.push(t[i]);else null!=t&&this._as.push(t)}else if(arguments.length>1)for(e=arguments.length,i=0;i<e;i++)this._as.push(arguments[i])};Ke.List=ci,Ke.extend(Ke.List,Object,{size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(t,i){return i===e?this._as.push(t):this._as.splice(i,0,t)},addAll:function(t){if(t instanceof ci&&(t=t._as),t instanceof Array)for(var e=t.length,i=0;i<e;i++)this._as.push(t[i]);else this._as.push(t)},get:function(t){return this._as[t]},remove:function(t){var e=this._as.indexOf(t);return e>=0&&e<this._as.length&&this.removeAt(e),e},removeAt:function(t){return this._as.splice(t,1)[0]},set:function(t,e){return this._as[t]=e},clear:function(){return this._as.splice(0,this._as.length)},contains:function(t){return this.indexOf(t)>=0},indexOf:function(t){return this._as.indexOf(t)},forEach:function(t,e){for(var i=this._as.length,n=0;n<i;n++){var s=this._as[n];e?t.call(e,s):t(s)}},forEachReverse:function(t,e){for(var i=this._as.length,n=i-1;n>=0;n--){var s=this._as[n];e?t.call(e,s):t(s)}},toArray:function(t,e){if(t){for(var i=[],n=this._as.length,s=0;s<n;s++){var r=this._as[s];e?t.call(e,r)&&i.push(r):t(r)&&i.push(r)}return i}return this._as.concat()},toList:function(t,e){if(t){for(var i=new ci,n=this._as.length,s=0;s<n;s++){var r=this._as[s];e?t.call(e,r)&&i.add(r):t(r)&&i.add(r)}return i}return new ci(this)},sort:function(t){return t?this._as.sort(t):this._as.sort(),this},toString:function(){return this._as.toString()}}),Ke.ImageCache=function(){};var ui=Ke.ImageCache;ui.AlarmBillboardImage=new Image,ui.AlarmBillboardImage.src="data:image/png;base64,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",ui.Logo=new Image,ui.Logo.src="data:image/png;base64,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",
Ke.ImageUtils={},Ke.ImageUtils.registerDefaultImage=function(t){null!=t.src?ui.Logo.src=t.src:ui.Logo.src=t},Ke.ImageUtils.registerAlarmImage=function(t){null!=t.src?ui.AlarmBillboardImage.src=t.src:ui.AlarmBillboardImage.src=t},ui.ssaoNormalImage=new Image,ui.ssaoNormalImage.src="data:image/png;base64,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",ui.ssaoNormalImage.loaded=!0,Ke.EventDispatcher=function(){this.listeners={}},Ke.extend(Ke.EventDispatcher,null,{constructor:Ke.EventDispatcher,addEventListener:function(t,i){this.listeners[t]===e&&(this.listeners[t]=[]),this.listeners[t].indexOf(i)===-1&&this.listeners[t].push(i)},removeEventListener:function(t,e){var i=this.listeners[t].indexOf(e);i!==-1&&this.listeners[t].splice(i,1)},dispatchEvent:function(t){var i=this.listenters[t.type];if(i!=e){t.target=this;for(var n=0;n<i.length;n++){var s=i[n];s.call(this,t)}}},contains:function(t,e){if(this._ls)for(var i,n=0,s=this._ls.size();n<s;n++)if(i=this._ls.get(n),t===i.l&&e===i.s)return!0;return!1},add:function(t,e,i){if(null==t)return void console.error("TGL.EventDispatcher#add:listener is null");var n={l:t,s:e,a:i};this._ls||(this._ls=new ci),this._f?(this._addPendings||(this._addPendings=new ci),this._addPendings.add(n)):n.a?this._ls.add(n,0):this._ls.add(n)},remove:function(t,e){this._ls&&(this._f?(this._removePendings||(this._removePendings=new ci),this._removePendings.add({l:t,s:e})):this._remove(t,e))},_remove:function(t,e){for(var i,n=0,s=this._ls.size();n<s;n++)if(i=this._ls.get(n),i.l===t&&i.s===e)return void this._ls.removeAt(n)},fire:function(t){if(this._ls){var e,i,n=this._ls.size();for(this._f=!0,e=0;e<n;e++)i=this._ls.get(e),i.s?i.l.call(i.s,t):i.l(t);if(this._f=!1,this._removePendings){for(n=this._removePendings.size(),e=0;e<n;e++)i=this._removePendings.get(e),this._remove(i.l,i.s);delete this._removePendings}if(this._addPendings){for(n=this._addPendings.size(),e=0;e<n;e++)i=this._addPendings.get(e),i.a?this._ls.add(i,0):this._ls.add(i);delete this._addPendings}}}}),Ke.PropertyChangeDispatcher=function(){this._dispatcher=new Ke.EventDispatcher},Ke.extend(Ke.PropertyChangeDispatcher,Object,{addPropertyChangeListener:function(t,e,i){this._dispatcher.add(t,e,i)},removePropertyChangeListener:function(t,e){this._dispatcher.remove(t,e)},firePropertyChange:function(t,e,i){if(e==i)return!1;var n={property:t,oldValue:e,newValue:i,source:this};return this._dispatcher.fire(n),this.onPropertyChanged(n),!0},onPropertyChanged:function(t){}}),Ke.Texture=function(t,i,n,s,r,a,o,h,l){Ke.PropertyChangeDispatcher.call(this),this.id=Ke.TextureIdCount++,this.name="",null!=t&&this.setImage(t),this.mipmaps=[],this.mapping=i!==e?i:new Ke.UVMapping,this.wrapS=n!==e?n:Ke.RepeatWrapping,this.wrapT=s!==e?s:Ke.RepeatWrapping,this.magFilter=r!==e?r:Ke.LinearFilter,this.minFilter=a!==e?a:Ke.LinearMipMapLinearFilter,this.anisotropy=l!==e?l:1,this.format=o!==e?o:Ke.RGBAFormat,this.type=h!==e?h:Ke.UnsignedByteType,this.repeatX=1,this.repeatY=1,this.offsetX=0,this.offsetY=0,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!1,this.flipX=!1,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},Ke.extend(Ke.Texture,Ke.PropertyChangeDispatcher,{getUniqueCode:function(){if(ei.isImage(this._image)||"string"==typeof this._image||yi.isArray(this._image))return this._imageSrc+" "+this.format+" "+this.type+"  "+this.wrapS+" "+this.wrapT+" "+this.magFilter+" "+this.minFilter+" "+this.flipY+" "+this.flipX+this.anisotropy;if(ei.isCanvas(this._image)){var t=this._image;return t.__uniqueCode||(t.__uniqueCode=Ke.id("texture")),t.__uniqueCode+" "+this.format+" "+this.type+" "+this.wrapS+" "+this.wrapT+" "+this.magFilter+" "+this.minFilter+" "+this.flipY+" "+this.flipX+this.anisotropy}},resetValue:function(){this.name="",this._image=null,this.mipmaps=[],this.mapping=new Ke.UVMapping,this.wrapS=Ke.RepeatWrapping,this.wrapT=Ke.RepeatWrapping,this.magFilter=Ke.LinearFilter,this.minFilter=Ke.LinearMipMapLinearFilter,this.anisotropy=1,this.format=Ke.RGBAFormat,this.type=Ke.UnsignedByteType,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!1,this.flipX=!1,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},clone:function(t,i){return t===e&&(t=new Ke.Texture),null==i||i?t.setImage(this._image):t._image=this._image,t._imageSrc=this._imageSrc,t.mipmaps=this.mipmaps.slice(0),t.mapping=this.mapping,t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.format=this.format,t.type=this.type,t.generateMipmaps=this.generateMipmaps,t.premultiplyAlpha=this.premultiplyAlpha,t.flipY=this.flipY,t.flipX=this.flipX,t.unpackAlignment=this.unpackAlignment,t},onloadTexture:function(){},setImageSrc:function(t){if("string"==typeof t)this._imageSrc=t;else if(yi.isArray(t)){for(var e="",i=0;i<t.length;i++)e+="string"==typeof t[i]?t:t[i].src;this._imageSrc=e}else this._imageSrc=t.src},loadAllImages:function(t,e){function i(i){i.onload=function(){i.loaded=!0,i.onload=null,s++,s==n&&(r.onloadTexture(),r.firePropertyChange("image",e,r._image),t.loaded=!0)}}for(var n=t.length,s=0,r=this,a=0;a<n;a++)i(t[a])},setImage:function(t){var e=this._image;if(yi.isArray(t)){for(var i,n="",s=[],r=0;r<t.length;r++)"string"==typeof t[r]?(n+=t,i=new Image,t[r].startsWith("data:image")||(i.crossOrigin="use-credentials"),i.src=t[r],s.push(i)):(n+=t[r].src,s.push(t[r]));this._imageSrc=n,this.loadAllImages(s,e),this._image=s}else if("string"==typeof t){if(this._image&&this._image.src===t)return;this._imageSrc=t;var a=new Image;t.startsWith("data:image")||(a.crossOrigin="use-credentials"),a.src=t;var o=this;o._image=a,a.onload=function(t){a.loaded=!0,a.onload=null,o.onloadTexture(),o.firePropertyChange("image",e,a)}}else{if(this._image===t)return;this._imageSrc=t.src;var e=this._image;if(ei.isCanvas(t)&&(t.loaded=!0),t&&!t.loaded){var o=this;o._image=t;var h=t.onload;t.onload=function(i){h&&h.call(null,i),t.loaded=!0,t.onload=null,o.onloadTexture(),o.firePropertyChange("image",e,t)}}else this._image=t,this.firePropertyChange("image",e,t)}},getImage:function(){return this._image},dispose:function(){this.firePropertyChange("disposed",!1,!0)}}),Ke.TextureIdCount=0,Ke.PixelsTexture=function(t,e,i,n,s,r,a,o,h,l,c){Ke.Texture.call(this,null,r,a,o,h,l,n,s,c),this.image={data:t,width:e,height:i}},Ke.PixelsTexture.prototype=Object.create(Ke.Texture.prototype),Ke.PixelsTexture.prototype.clone=function(){var t=new Ke.PixelsTexture;return Ke.Texture.prototype.clone.call(this,t),t},Ke.CompressedTexture=function(t,e,i,n,s,r,a,o,h,l,c){Ke.Texture.call(this,null,r,a,o,h,l,n,s,c),this.image={width:e,height:i},this.mipmaps=t,this.generateMipmaps=!1},Ke.CompressedTexture.prototype=Object.create(Ke.Texture.prototype),Ke.CompressedTexture.prototype.clone=function(){var t=new Ke.CompressedTexture;return Ke.Texture.prototype.clone.call(this,t),t};var di={pools:{},useTimes:{},size:0,setTexture:function(t,e){di.size++,di.pools[t]=e},getTexture:function(t){return di.pools[t]},useTexture:function(t){if(t){var e=t.id,i=di.useTimes[e]||0;i++,di.useTimes[e]=i}},unUseTexture:function(t){if(t){var e=t.id,i=di.useTimes[e]||0;if(i--,di.useTimes[e]=i,i<=0){var n=t.getUniqueCode();delete di.pools[n],di.size--,t.dispose()}}}};Ke.TexturePool=di,Ke.TexturePool.TestTexture=new Ke.Texture,Ke.SerializationSettings=function(){var t=Ke.SerializationSettings;this.isDataBoxSerializable=t.isDataBoxSerializable,this.isStyleSerializable=t.isStyleSerializable,this.isClientSerializable=t.isClientSerializable,this.encodeURI=t.encodeURI,this._pm=Ke.clone(t._pm),this._sm=Ke.clone(t._sm),this._cm=Ke.clone(t._cm)},function(){var t=Ke.SerializationSettings;t.isDataBoxSerializable=!0,t.isStyleSerializable=!0,t.isClientSerializable=!0,t.encodeURI=!0,t._pm={},t._sm={},t._cm={},t.setPropertyType=function(e,i){t._pm[e]=i},t.getPropertyType=function(e){return t._pm[e]},t.setStyleType=function(e,i){t._sm[e]=i},t.getStyleType=function(e){return t._sm[e]},t.setClientType=function(e,i){t._cm[e]=i},t.getClientType=function(e){return t._cm[e]}}(),Ke.extend(Ke.SerializationSettings,Object,{setPropertyType:function(t,e){this._pm[t]=e},getPropertyType:function(t){return this._pm[t]},setStyleType:function(t,e){this._sm[t]=e},getStyleType:function(t){return this._sm[t]},setClientType:function(t,e){this._cm[t]=e},getClientType:function(t){return this._cm[t]}}),Ke.Styles={_m:{},setStyle:function(t,e){return null==e?delete Ke.Styles._m[t]:Ke.Styles._m[t]=e,Ke.Styles},getStyle:function(t){return Ke.Styles._m[t]}},Ke.Styles.MaterailType="S:m.type",Ke.Styles.NormalType="S:m.normalType",Ke.Styles.PREFIX_STYLE="S:",function(){var t=function(t,e){Ke.SerializationSettings.setPropertyType(t,e)};t("combos","data.list"),t("name","cdata"),t("toolTip","cdata"),t("parent","data"),t("fromNode","data"),t("toNode","data"),t("alarmState","alarmstate"),t("vertices","list.vec3"),t("faces","serializeabe.list"),t("uvs","list.vec2"),t("position","vec3"),t("rotation","vec3"),t("scale","vec3"),t("location","point"),t("materialSize","number"),t("color","color"),t("ambient","color"),t("diffuse","color"),t("specular","color"),t("intensity","number"),t("distance","number"),t("type","number"),t("startClosed","boolean"),t("endClosed","boolean"),t("curveSegments","number"),t("amount","number"),t("vertical","boolean"),t("repeat","number"),t("centralized","boolean"),t("visible","boolean"),t=function(t,e,i){null==i&&(i=null!=e?e instanceof Ke.Vec2?"vec2":e instanceof Ke.Vec3?"vec3":typeof e:"string"),Ke.Styles.setStyle(t,e),Ke.SerializationSettings.setStyleType(t,i)},t("select.style","border"),t("select.width",1),t("select.color",65280),t("select.offset",0),t("outer.width",1),t("outer.offset",0),t("outer.color",null,"color"),t("m.type","basic"),t("m.color",16777215,"color"),t("m.side","front"),t("m.alphaTest",0),t("m.polygonOffset",!1),t("m.polygonOffsetFactor",0),t("m.polygonOffsetUnits",0),t("m.wireframe",!1),t("m.wireframeLinewidth",1),t("m.gradient",{}),t("m.gradientType",1),t("m.transparent",!1),t("m.opacity",1),t("m.visible",!0),t("m.depthTest",!0),t("m.depthMask",!0),t("m.alignment",new Ke.Vec2(0,0)),t("m.linewidth",1),t("m.texture.image",null),t("m.texture.offset",new Ke.Vec2(0,0)),t("m.texture.repeat",new Ke.Vec2(1,1)),t("m.texture.wrapS",Ke.RepeatWrapping),t("m.texture.wrapT",Ke.RepeatWrapping),t("m.texture.flipX",!1),t("m.texture.flipY",!1),t("m.normalmap.image",null),t("m.envmap.image",null),t("m.specularmap.image",null),t("right.m.type","basic"),t("left.m.type","basic"),t("top.m.type","basic"),t("bottom.m.type","basic"),t("front.m.type","basic"),t("back.m.type","basic"),t("side.m.type","basic"),t("alarm.billboard.scale",null),t("alarm.billboard.position","top"),t("alarm.billboard.vertical",!1),t("annotation.class","tgl_annotation")}(),Ke.extend(Ke.Styles,Object,{});var fi=function(t,i){this.min=t!==e?t:new Qe(1/0,1/0),this.max=i!==e?i:new Qe((-(1/0)),(-(1/0)))};Ke.Box2=fi,fi.prototype={constructor:Ke.Box2,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){if(t.length>0){var e=t[0];this.min.copy(e),this.max.copy(e);for(var i=1,n=t.length;i<n;i++)e=t[i],e.x<this.min.x?this.min.x=e.x:e.x>this.max.x&&(this.max.x=e.x),e.y<this.min.y?this.min.y=e.y:e.y>this.max.y&&(this.max.y=e.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var t=new Qe;return function(e,i){var n=t.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(t){var e=t||new Qe;return e.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){var e=t||new Qe;return e.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){var i=e||new Qe;return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){var i=e||new Qe;return i.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new Qe;return function(e){var i=t.copy(e).clamp(this.min,this.max);return i.sub(e).length()}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},clone:function(){return(new fi).copy(this)}},Ke.BoundingBox=function(t,i){this.min=t!==e?t:new Je(1/0,1/0,1/0),this.max=i!==e?i:new Je((-(1/0)),(-(1/0)),(-(1/0)))},Ke.BoundingBox.prototype={constructor:Ke.BoundingBox,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){if(t.length>0){var e=t[0];this.min.copy(e),this.max.copy(e);for(var i=1,n=t.length;i<n;i++)e=t[i],e.x<this.min.x?this.min.x=e.x:e.x>this.max.x&&(this.max.x=e.x),e.y<this.min.y?this.min.y=e.y:e.y>this.max.y&&(this.max.y=e.y),e.z<this.min.z?this.min.z=e.z:e.z>this.max.z&&(this.max.z=e.z)}else this.makeEmpty();return this},setFromCenterAndSize:function(t,e){var i=Ke.BoundingBox.__v1.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(t){var e=t||new Je;return e.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){var e=t||new Je;return e.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t){return new Je((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},clampPoint:function(t,e){e||new Je;return(new Je).copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){var e=Ke.BoundingBox.__v1.copy(t).clamp(this.min,this.max);return e.sub(t).length()},getBoundingSphere:function(t){var e=t||new Ke.Sphere;return e.center=this.center(),e.radius=.5*this.size(Ke.BoundingBox.__v0).length(),e},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},transform:function(t){var e=[Ke.BoundingBox.__v0.set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Ke.BoundingBox.__v0.set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Ke.BoundingBox.__v1.set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Ke.BoundingBox.__v2.set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Ke.BoundingBox.__v3.set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Ke.BoundingBox.__v4.set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Ke.BoundingBox.__v5.set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Ke.BoundingBox.__v6.set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Ke.BoundingBox.__v7.set(this.max.x,this.max.y,this.max.z).applyMatrix4(t)];return this.makeEmpty(),this.setFromPoints(e),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},clone:function(){return(new Ke.BoundingBox).copy(this)}},Ke.BoundingBox.__v0=new Je,Ke.BoundingBox.__v1=new Je,Ke.BoundingBox.__v2=new Je,Ke.BoundingBox.__v3=new Je,Ke.BoundingBox.__v4=new Je,Ke.BoundingBox.__v5=new Je,Ke.BoundingBox.__v6=new Je,Ke.BoundingBox.__v7=new Je,Ke.BoundingSphere=function(t,i){this.center=t!==e?t:new Je,this.radius=i!==e?i:0},Ke.BoundingSphere.prototype={constructor:Ke.BoundingSphere,set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromCenterAndPoints:function(t,e){for(var i=0,n=0,s=e.length;n<s;n++){var r=t.distanceToSquared(e[n]);i=Math.max(i,r)}return this.center=t,this.radius=Math.sqrt(i),this},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsBoundingSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},clampPoint:function(t,e){var i=this.center.distanceToSquared(t),n=e||new Je;return n.copy(t),i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n},getBoundingBox:function(t){var e=t||new Ke.Box3;return e.set(this.center,this.center),e.expandByScalar(this.radius),e},transform:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius},clone:function(){return(new Ke.BoundingSphere).copy(this)}},Ke.Primitive=function(t,e){t=t||{},this.data=t,this.vertices=t.vertices,this.faces=t.faces,this.uvs=t.uvs,this.uv2s=t.uv2s,this.uniqueCode=e},Ke.extend(Ke.Primitive,Object,{clone:function(t){if(t){var e,i={};for(i.vertices=[],e=0;e<this.vertices.length;e++)i.vertices.push(this.vertices[e].clone());for(i.faces=[],e=0;e<this.faces.length;e++)i.faces.push(this.faces[e].clone());for(i.uvs=[],e=0;e<this.uvs.length;e++){for(var n=this.uvs[e],s=[],r=0;r<n.length;r++)s.push(n[r].clone);i.uvs.push(s)}for(i.uv2s=[],e=0;e<this.uv2s.length;e++)i.uv2s.push(this.uv2s[e].clone());return new Ke.Primitive(i)}return new Ke.Primitvie(this.data)}}),Ke.PrimitiveCache={_cache:{},_useCount:{},getPrimitive:function(t){return t?Ke.PrimitiveCache._cache[t]:null},setPrimitive:function(t,e){t&&(Ke.PrimitiveCache._cache[t]=e)},usePrimitive:function(t){var e=Ke.PrimitiveCache._useCount[t]||0;e++,Ke.PrimitiveCache._useCount[t]=e},unUsePrimitive:function(t){var e=Ke.PrimitiveCache._useCount[t]||0;e--,e<=0&&delete Ke.PrimitiveCache._useCount[t]}},Ke.PrimitiveGroupCache={},Ke.Color=function(t){return t!==e&&this.set(t),this},Ke.extend(Ke.Color,Object,{r:1,g:1,b:1,getUniqueCode:function(){return""+this.r+this.g+this.b},set:function(t){switch(typeof t){case"number":this.setHex(t);break;case"string":this.setStyle(t)}},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,i){return this.r=t,this.g=e,this.b=i,this},setHSV:function(t,e,i){var n,s,r,a,o;return 0===i?this.r=this.g=this.b=0:(n=Math.floor(6*t),s=6*t-n,r=i*(1-e),a=i*(1-e*s),o=i*(1-e*(1-s)),0===n?(this.r=i,this.g=o,this.b=r):1===n?(this.r=a,this.g=i,this.b=r):2===n?(this.r=r,this.g=i,this.b=o):3===n?(this.r=r,this.g=a,this.b=i):4===n?(this.r=o,this.g=r,this.b=i):5===n&&(this.r=i,this.g=r,this.b=a)),this},setStyle:function(t){if(/^rgb\((\d+),(\d+),(\d+)\)$/i.test(t)){var e=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(t);return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,this}if(/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.test(t)){var e=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.exec(t);return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(t)){var e=/^\#([0-9a-f]{6})$/i.exec(t);return this.setHex(parseInt(e[1],16)),
this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(t)){var e=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(t);return this.setHex(parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3],16)),this}if(/^(\w+)$/i.test(t))return this.setHex(Ke.ColorKeywords[t]),this},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t){return this.r=t.r*t.r,this.g=t.g*t.g,this.b=t.b*t.b,this},copyLinearToGamma:function(t){return this.r=Math.sqrt(t.r),this.g=Math.sqrt(t.g),this.b=Math.sqrt(t.b),this},convertGammaToLinear:function(){var t=this.r,e=this.g,i=this.b;return this.r=t*t,this.g=e*e,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},getHSV:function(t){var i,n,s=this.r,r=this.g,a=this.b,o=Math.max(Math.max(s,r),a),h=Math.min(Math.min(s,r),a),l=o;if(h===o)i=0,n=0;else{var c=o-h;n=c/o,i=s===o?(r-a)/c:r===o?2+(a-s)/c:4+(s-r)/c,i/=6,i<0&&(i+=1),i>1&&(i-=1)}return t===e&&(t={h:0,s:0,v:0}),t.h=i,t.s=n,t.v=l,t},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},clone:function(){return(new Ke.Color).setRGB(this.r,this.g,this.b)}}),Ke.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ke.Data=function(t){Ke.PropertyChangeDispatcher.call(this),this._childList=new ci,this._childMap={},this._clientMap={},this._id=t},Ke.extend(Ke.Data,Ke.PropertyChangeDispatcher,{___accessor:["name"],constructor:Ke.Data,getId:function(){return this._id},onAlarmChange:function(){},onPropertyChange:function(t,e,i){},setGroupId:function(t){if(this._groupId!==t){var e=this._groupId;this._groupId=t,this.firePropertyChange("groupId",e,t)}},getGroupId:function(){return this._groupId},hasChildren:function(){return this._childList.size()>0},getChildren:function(){return this._childList},isDescendantOf:function(t){if(!t)return!1;if(!t.hasChildren())return!1;for(var e=this._parent;e;){if(t===e)return!0;e=e.getParent()}return!1},getParent:function(){return this._parent},getRoot:function(){var t=this._parent;return t&&null==t._parent?t:t&&null!=t._parent?t.getRoot(t):arguments[0]},setParent:function(t){if(!(this._isUpdatingParent||this._parent===t||this===t||t&&t.isDescendantOf(this))){var e=this._parent;this._parent=t,this._isUpdatingParent=!0,e&&e.removeChild(this),t&&t.addChild(this),delete this._isUpdatingParent,this.firePropertyChange("parent",e,t),this.onParentChanged(e,t)}},onParentChanged:function(t,e){},addChild:function(t,i){return i===e&&(i=this._childList.size()),!(!t||t===this)&&(!this._childMap[t.getId()]&&(!this.isDescendantOf(t)&&(t.getParent()&&t.getParent().removeChild(t),(i<0||i>this._childList.size())&&(i=this._childList.size()),this._childList.add(t,i),this._childMap[t._id]=t,t.setParent(this),this.firePropertyChange("children",null,t),this.onChildAdded(t,i),!0)))},onChildAdded:function(t,e){},clearChildren:function(){if(null!=this._childList&&this._childList.size()>0){var t=this._childList.toList(),e=this;t.forEach(function(t){e.removeChild(t)})}},removeChild:function(t){if(!t)return!1;if(!this._childMap[t._id])return!1;var e=this._childList.remove(t);return delete this._childMap[t._id],this.firePropertyChange("children",t,null),t.setParent(null),this.onChildRemoved(t,e),!0},onChildRemoved:function(t,e){},c:function(t){if(t)for(var e in t)this.setClient(e,t[e])},setClient:function(t,e){if(null==t)return this;null==this._clientMap&&(this._clientMap=new Object);var i=this._clientMap[t];if(i!==e)return null==e?delete this._clientMap[t]:this._clientMap[t]=e,this._clientMap[t]=e,this.firePropertyChange("C:"+t,i,e),this.onClientChanged(t,i,e),this},getClient:function(t){return this._clientMap[t]},onClientChanged:function(t,e,i){},setPropertyValue:function(t,e){if(this[t]===e)return!1;var i=this[t];return i instanceof Ke.Color&&null!=e?(i=i.clone(),e instanceof Ke.Color?this[t].copy(e):this[t].set(e)):this[t]=e,!0}}),Ke.Element=function(t){Ke.Data.call(this,t),this._id=t||Ke.id("E"),this.styleMap={},this._visible=!0,this._selected=!1,this._selectable=!0,this._editable=!0,this.editing=!1,this.up=new Je(0,1,0),this._position=new Je(0,0,0),this._rotation=new Je(0,0,0),this._scale=new Je(1,1,1),this.eulerOrder=Ke.defaultEulerOrder,this.rotationAutoUpdate=!0,this.matrix=new ti,this.worldMatrix=new ti,this.rotationWorldMatrix=new ti,this.matrixAutoUpdate=!1,this.worldMatrixNeedsUpdate=!0,this.quaternion=new Ke.Quat,this.useQuaternion=!1,this._sizeFixed=!1,this._fixedSize=108,this.castShadow=!0,this.receiveShadow=!0,this.frustumCulled=!0,this._vector=new Je,this.renderDepth=null,this._attachId="",this._groupId=null,this.editTransformToParent=!1,this._alarmState=new Ke.AlarmState(this),this.colors=[]},Ke.Element.__m1=new ti,Ke.ElementIdCount=0,Ke.extend(Ke.Element,Ke.Data,{IStyle:!0,___accessor:["visible","selected","selectable","editable","sizeFixed"],constructor:Ke.Element,getAlarmState:function(){return this._alarmState},onAlarmChange:function(t,e){var i=this._alarmState.getHighestNativeAlarmSeverity();i?this.setStyle("m.alarmColor",new Ke.Color(i.color)):this.setStyle("m.alarmColor",null)},getDefaultInstance:function(){return this.constructor.defaultInstance===e&&(this.constructor.defaultInstance=new this.constructor),this.constructor.defaultInstance},onParentChanged:function(t,e){this.updateWorldMatrix(!0,!1)},onChildAdded:function(t,e){t.updateWorldMatrix(!0,!1)},onChildRemoved:function(t,e){t.updateWorldMatrix(!0,!1)},generatePrimitiveKey:function(){return null},serializeProperty:function(){},clear:function(t){},getSelectStyle:function(){return this.getStyle("select.style")},isSpaceChangedProperty:function(t){return"scale"===t||"position"===t||"rotation"===t},isStyleEquals:function(t,e,i){return null==e&&null==i||e===i},setStyle:function(t,e){if(null==t)return this;null==this.styleMap&&(this.styleMap={});var i=this.styleMap[t];return this.isStyleEquals(t,i,e)?this:(null==e?delete this.styleMap[t]:this.styleMap[t]=e,this.onStyleChanged(t,i,e),this.firePropertyChange(Ke.Styles.PREFIX_STYLE+t,i,e),this)},c:function(t){if(t)for(var e in t)this.setClient(e,t[e])},s:function(t){if(null!=t){null==this.styleMap&&(this.styleMap={});var e,i,n,s={},r={};for(e in t)i=t[e],n=this.styleMap[e],this.isStyleEquals(e,n,i)||(null==i?delete this.styleMap[e]:this.styleMap[e]=i,r[e]=n,this.isMaterialStyle(e)&&(s[e]=[i,n]));this.onMaterialStylesChanged(s);for(e in t)this.firePropertyChange(Ke.Styles.PREFIX_STYLE+e,r[e],this.styleMap[e]);return this}},getStyle:function(t,e,i){null==i&&(i=!0);var n;return null!=this.styleMap&&(n=this.styleMap[t]),e&&(n=this.getCloneObject(n)),null==n&&i&&(n=this.getDefaultStyle(t,e)),n},getCloneObject:function(t){if(null==t)return null;if(Ke.Utils.isArray(t)){for(var e=[],i=0;i<t.length;i++)e.push(this.getCloneObject(t[i]));return e}return t.clone?t.clone():t},getSideIndexMapping:function(){},setMaterialStyle:function(t,e){},setMaterialStyles:function(t){var e,n,s,r;for(var a in t){if(a.startsWith("m."))e=a.substr(a.indexOf(".")+1);else if(this.getSideIndexMapping()&&this.isSideStyle(s)){var o=s.substr(0,s.indexOf(".")),h=this.getSideMaterialIndex(o);if(h!=i)continue;s=s.substr(s.indexOf(".")+1),e=s.substr(a.indexOf(".")+1)}else a.startsWith("alarm.billboard.")&&(r=!0);var l=t[a];n=l[0],null==n?n=Ke.Styles.getStyle(a):yi.isArray(n)&&(n=n[i]),this._A97(this.material,e,n)}r&&this._alarmBillboard&&this._setAlarmBillboardPositionAndSize(this._alarmBillboard)},onMaterialStylesChanged:function(t){this.setMaterialStyles(t)},isMaterialStyle:function(t){return!!t.startsWith("m.")||!(!this.getSideIndexMapping()||!this.isSideStyle(t))},onStyleChanged:function(t,e,i){if(t.startsWith("m."))this.setMaterialStyle(t,i);else if(this.getSideIndexMapping()&&this.isSideStyle(t)){var n=t.substr(0,t.indexOf("."));t=t.substr(t.indexOf(".")+1);var s=this.getSideMaterialIndex(n);this.setMaterialStyle(t,i,s)}else t.startsWith("alarm.billboard.")&&this._alarmBillboard&&this._setAlarmBillboardPositionAndSize(this._alarmBillboard)},textureMapping:{texture:"map",texture1:"map1",texture2:"map2",textureb:"blendMap",texturebp:"bumpMap",lightMap:"lightMap",lightmap:"lightMap",normalmap:"normalMap",envmap:"envMap",specularmap:"specularMap"},_A97:function(t,e,i){if(e.startsWith("texture.")||e.startsWith("texture1.")||e.startsWith("texture2.")||e.startsWith("textureb.")||e.startsWith("texturen.")||e.startsWith("texturebp.")||e.startsWith("lightmap")||e.startsWith("envmap")||e.startsWith("normalmap")||e.startsWith("specularmap")){var n=e.substr(0,e.indexOf(".")),s=e.substr(e.indexOf(".")+1);if("offset"===s||"repeat"===s)return void t.setPropertyValue(s,this.getCloneObject(i));var r=this.textureMapping[n],a=t[r],o=Ke.TexturePool.TestTexture;if("image"===s){var h=i;if(e.startsWith("envmap")&&yi.isArray(h))for(var l=0;l<h.length;l++)if(null==h[l]){h=null;break}if(null==a&&null!=h){o.resetValue(),o._image=h,o.setImageSrc(h);var c=o.getUniqueCode(),u=Ke.TexturePool.getTexture(c);null==u&&(u=new Ke.Texture(h),Ke.TexturePool.setTexture(c,u)),t.setMap(u,r)}else if(null==h)t.setMap(null,r);else{a.clone(o,!1),o._image=h,o.setImageSrc(h);var c=o.getUniqueCode(),u=Ke.TexturePool.getTexture(c);u!==a&&(null==u&&(u=new Ke.Texture,a.clone(u,!1),u.setImage(h),Ke.TexturePool.setTexture(c,u)),t.setMap(u,r))}}else if(null!=a){a.clone(o,!1),o[s]=this.getCloneObject(i);var c=o.getUniqueCode(),u=Ke.TexturePool.getTexture(c);u!=a&&(null==u&&(u=new Ke.Texture,a.clone(u),u[s]=i),t.setMap(u,r))}}else"type"===e&&t.setType?t.setType(i):t.setPropertyValue(e,this.getCloneObject(i))},getDefaultStyle:function(t,e){if(null==t)return null;if(t.startsWith("m.")){var i=[],n=t.substr(t.indexOf(".")+1);if(this.material.materials){var s=this.material.materials;s=s||[this.material];for(var r=0;r<s.length;r++){var a=s[r];if(n.startsWith("texture.")||n.startsWith("texture1.")||n.startsWith("texture2.")||n.startsWith("textureb.")||n.startsWith("texturen.")||n.startsWith("texturebp.")||n.startsWith("lightmap")||n.startsWith("envmap")||n.startsWith("normalmap")||n.startsWith("specularmap")){var o=n.substr(0,n.indexOf(".")),h=n.substr(n.indexOf(".")+1),l=(n.substr(n.indexOf(".")+1),this.textureMapping[o]),c=a[l];if(c)if("image"===h)if(yi.isArray(c._image)){var u=[];i.push(u);for(var d=0;d<c._image.length;d++)u.push(c._image[d].src)}else i.push(c._image.src);else"offset"===h||"repeat"===h?i.push(a[h]):i.push(a.map[h]);else i.push(Ke.Styles.getStyle(t))}else i.push(a[n])}}e&&(i=this.getCloneObject(i));for(var f=!0,r=0;r<i.length;r++)if(0!=i.indexOf(i[r])){f=!1;break}return f?i[0]:i}if(this.isSideStyle(t)){var g=t.substr(0,t.indexOf("."));t=t.substr(t.indexOf(".")+1);var n=t.substr(t.indexOf(".")+1),_=this.getSideMaterialIndex(g);if(null!=_){var p,a=this.material.materials[_];return n.startsWith("texture.")?a.map&&(p="texture.image"===n?a.map._image.src:a.map[n]):p=a[n],e&&(p=this.getCloneObject(p)),p}}return Ke.Styles.getStyle(t)},isSideStyle:function(t){if(t.indexOf(".")===-1)return!1;var i=this.getSideIndexMapping();if(!i)return!1;var n=t.substr(0,t.indexOf("."));return i[n]!==e},setUp:function(t,e,i){var n;if(3===arguments.length){if(this.up.x===t&&this.up.y===e&&this.up.z===i)return;n=new Je(t,e,i)}else{if(this.up.x===t.x&&this.up.y===t.y&&this.up.z===t.z)return;n=t}var s=this.up;this.up=n,this.onUpChanged(s,newValue),this.firePropertyChange("up",s,n)},getUp:function(){return this.up},onUpChanged:function(t,e){},checkNumber:function(t,e,i,n){yi.isNaN(t)&&console.error(n+",x is not a number"),yi.isNaN(e)&&console.error(n+",y is not a number"),yi.isNaN(i)&&console.error(n+",z is not a number")},invalidateTexture:function(t){var e,i,n,s=this.material;if(null!=t&&s instanceof Ke.ArrayMaterial){if("string"==typeof t){var r=this.getSideIndexMapping();if(null!=r&&(t=r[t]),null==t)return}if("number"!=typeof t)return;n=s instanceof Ke.ArrayMaterial?s.materials[t]:materail,this._dirtyMaterialTexture(n)}else if(s instanceof Ke.ArrayMaterial)for(i=s.materials,e=0;e<i.length;e++)n=i[e],this._dirtyMaterialTexture(n);else this._dirtyMaterialTexture(s)},_dirtyMaterialTexture:function(t){null!=t&&t.map&&t.map instanceof Ke.Texture&&this._dirtyTexture(t.map)},_dirtyTexture:function(t){var e=t._image;t.firePropertyChange("image",null,e)},p:function(t,e,i){return 0===arguments.length?this.getPosition():void(3===arguments.length?this.setPosition(t,e,i):this.setPosition(t))},checkPosition:function(t){return!0},setPosition:function(t,e,i){var n;if(3===arguments.length){if(this._position.x===t&&this._position.y===e&&this._position.z===i)return;this.checkNumber(t,e,i,"setPosition"),n=new Je(t,e,i)}else{if(this._position.x===t.x&&this._position.y===t.y&&this._position.z===t.z)return;if(!(t instanceof Je))throw"Element.setPosition : position is not instanceof TGL.Vec3";n=t}if(this.checkPosition(n)){var s=this._position;this._position=n,this.updateWorldMatrix(!0,!1),this.firePropertyChange("position",s,n)}},getPosition:function(t){return t==e&&(t=!0),t?this._position.clone():this._position},setPositionX:function(t){if(this._position.x!==t){this.checkNumber(t,0,0,"setPositionX");var e=this._position.x,i=this._position.clone();return i.x=t,!!this.checkPosition(i)&&(this._position.x=t,this.updateWorldMatrix(!0,!1),this.firePropertyChange("positionX",e,t),void 0)}},setX:function(t){this.setPositionX(t)},getPositionX:function(){return this._position.x},getX:function(){return this.getPositionX()},setPositionY:function(t){if(this._position.y!==t){this.checkNumber(0,t,0,"setPositionY");var e=this._position.y,i=this._position.clone();return i.y=t,!!this.checkPosition(i)&&(this._position.y=t,this.updateWorldMatrix(!0,!1),this.firePropertyChange("positionY",e,t),void 0)}},setY:function(t){this.setPositionY(t)},getPositionY:function(){return this._position.y},getY:function(){return this.getPositionY()},setPositionZ:function(t){if(this._position.z!==t){this.checkNumber(0,0,t,"setPositionZ");var e=this._position.z,i=this._position.clone();return i.z=t,!!this.checkPosition(i)&&(this._position.z=t,this.updateWorldMatrix(!0,!1),this.firePropertyChange("positionZ",e,t),void 0)}},setZ:function(t){this.setPositionZ(t)},getPositionZ:function(){return this._position.z},getZ:function(){return this.getPositionZ()},setScale:function(t,e,i){var n;if(3===arguments.length){if(this._scale.x===t&&this._scale.y===e&&this._scale.z===i)return;this.checkNumber(t,e,i,"setScale"),n=new Je(t,e,i)}else{if(this._scale.x===t.x&&this._scale.y===t.y&&this._scale.z===t.z)return;if(!(t instanceof Je))throw"Element.setScale : scale is not instanceof TGL.Vec3";n=t}var s=this._scale;n.x=n.x||1,n.y=n.y||1,n.z=n.z||1,this._scale=n,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scale",s,n)},getScale:function(t){return t==e&&(t=!0),t?this._scale.clone():this._scale},setScaleX:function(t){if(this._scale.x!==t){this.checkNumber(t,0,0,"setScalX");var e=this._scale.x;this._scale.x=t,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scaleX",e,t)}},getScaleX:function(){return this._scale.x},setScaleY:function(t){if(this._scale.y!==t){this.checkNumber(0,t,0,"setScaleY");var e=this._scale.y;this._scale.y=t,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scaleY",e,t)}},getScaleY:function(){return this._scale.y},setScaleZ:function(t){if(this._scale.z!==t){this.checkNumber(0,0,t,"setScaleZ");var e=this._scale.z;this._scale.z=t,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scaleZ",e,t)}},getScaleZ:function(){return this._scale.z},setRotation:function(t,e,i){var n;if(3===arguments.length){if(this._rotation.x===t&&this._rotation.y===e&&this._rotation.z===i)return;this.checkNumber(t,e,i,"setRotation"),n=new Je(t,e,i)}else{if(this._rotation.x===t.x&&this._rotation.y===t.y&&this._rotation.z===t.z)return;if(!(t instanceof Je))throw"Element.setRotation : rotation is not instanceof TGL.Vec3";n=t}var s=this._rotation;this._rotation=n,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotation",s,n)},getRotation:function(t){return t==e&&(t=!0),t?this._rotation.clone():this._rotation},setRotationX:function(t){if(this._rotation.x!==t){this.checkNumber(t,0,0,"setRotationX");var e=this._rotation.x;this._rotation.x=t,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotationX",e,t)}},getRotationX:function(){return this._rotation.x},setRotationY:function(t){if(this._rotation.y!==t){this.checkNumber(0,t,0,"setRotationY");var e=this._rotation.y;this._rotation.y=t,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotationY",e,t)}},getRotationY:function(){return this._rotation.y},setRotationZ:function(t){if(this._rotation.z!==t){this.checkNumber(0,0,t,"setRotationZ");var e=this._rotation.z;this._rotation.z=t,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotationZ",e,t)}},getRotationZ:function(){return this._rotation.z},applyMatrix:function(t){var e=this.matrix.clone();this.matrix.multiplyMatrices(t,this.matrix),this._scale.getScaleFromMatrix(this.matrix);var i=(new ti).extractRotation(this.matrix);this._rotation.setEulerFromRotationMatrix(i,this.eulerOrder),this._position.getPositionFromMatrix(this.matrix),this.updateWorldMatrix(!0,!1),this.firePropertyChange("matrix",e,this.matrix)},translate:function(t,e){this.matrix.rotateAxis(e),this.setPosition(this._position.clone().add(e.multiplyScalar(t)))},translateX:function(t){this.translate(t,this._vector.set(1,0,0))},translateY:function(t){this.translate(t,this._vector.set(0,1,0))},translateZ:function(t){this.translate(t,this._vector.set(0,0,1))},rotateFromAxis:function(t,e,i){e=e.clone().applyMatrix4(this.matrix),t=t.clone().normalize().applyMatrix4((new ti).extractRotation(this.matrix));var n=(new ti).makeRotationAxisAndCenter(t,i,e);this.applyMatrix(n)},rotateFromWorldAxis:function(t,e){var i=new ti;i.makeRotationAxis(t.normalize(),e),i.multiply(this.matrix),this.matrix=i;var n=(new ti).extractRotation(this.matrix),s=new Je;s.setEulerFromRotationMatrix(n,this.eulerOrder),this.setRotation(s)},getEulerAngles:function(){return this.matrix.getEulerAngles()},rotateFromWorldXAxis:function(t){this.rotateFromWorldAxis(new Je(1,0,0),t)},rotateFromWorldYAxis:function(t){this.rotateFromWorldAxis(new Je(0,1,0),t)},rotateFromWorldZAxis:function(t){this.rotateFromWorldAxis(new Je(0,0,1),t)},getRelativeTransform:function(t){if(t instanceof Ke.Element){var e=(new ti).getInverse(t.matrix.clone()),i=(new ti).multiplyMatrices(e,this.matrix.clone()),n=(new Je).getPositionFromMatrix(i),s=(new Je).setEulerFromRotationMatrix(i),r=(new Je).getScaleFromMatrix(i),a={position:n,rotation:s,scale:r,matrix:i};return a}return null},localToWorld:function(t){return null==this._parent?t:t.clone().applyMatrix4(this._parent.worldMatrix)},localToWorld2:function(t){return t.clone().applyMatrix4(this.worldMatrix)},getWorldPosition:function(){return this.worldMatrix.getPosition()},direction:function(t){var e=t.applyMatrix4((new ti).extractRotation(this.worldMatrix));return e.normalize(),e},frontDirection:function(){var t=new Je(0,0,1);return t=t.applyMatrix4((new ti).extractRotation(this.worldMatrix)),t.normalize(),t},worldPosition:function(t,e){e=e>0?e:t.length();var i=this.worldMatrix.getPosition();return i.add(this.direction(t).multiplyScalar(e))},frontWorldPosition:function(t){t=t>0?t:1;var e=this.worldMatrix.getPosition();return e.add(this.frontDirection().multiplyScalar(t))},worldToLocal:function(t){return t.clone().applyMatrix4(Ke.Element.__m1.getInverse(this.worldMatrix))},lookAt:function(t,e){this.matrix.lookAt(t,this._position,e?e:this.up),this.rotationAutoUpdate&&(this.useQuaternion===!1?this._rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):this.quaternion.copy(this.matrix.decompose()[1])),this.worldMatrixNeedsUpdate=!0},iterator:function(t){t(this),this._childList&&this._childList.forEach(function(e){e.iterator(t)})},getChildByName:function(t,i){for(var n=0,s=this.children.length;n<s;n++){var r=this.children[n];if(r.name===t)return r;if(i===!0&&(r=r.getChildByName(t,i),r!==e))return r}return e},getDescendants:function(t){t===e&&(t=[]);var i=this.getChildren().toArray();Array.prototype.push.apply(t,i);for(var n=0,s=i.length;n<s;n++)i[n].getDescendants(t);return t},fixSize:function(t){if(this._sizeFixed){this.updateWorldMatrix();var e=new Je,i=new Je;e.getPositionFromMatrix(this.worldMatrix),t.updateWorldMatrix(),i.getPositionFromMatrix(t.worldMatrix),scale=e.distanceTo(i)/this._fixedSize,0===scale&&(scale=1e-5),this.setScale(scale,scale,scale)}},updateMatrix:function(){this.matrix.setPosition(this._position),this.useQuaternion===!1?this.matrix.setRotationFromEuler(this._rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),(1!==this._scale.x||1!==this._scale.y||1!==this._scale.z)&&this.matrix.scale(this._scale),this.worldMatrixNeedsUpdate=!0},updateWorldMatrix:function(t,i){if(i=i==e||i,this.matrixAutoUpdate===!0&&this.updateMatrix(),this.worldMatrixNeedsUpdate===!0||t===!0){this.matrixAutoUpdate===!1&&this.updateMatrix();var n=this.worldMatrix.clone();this._parent==e?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiplyMatrices(this._parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0,n.equals(this.worldMatrix)||(i&&this.firePropertyChange("worldMatrix",n,this.worldMatrix),this.updateCameraMatrix&&this.updateCameraMatrix(!1))}this._childList.forEach(function(e){e.updateWorldMatrix(t)})},cloneCallback:function(t){},clonePrefab:function(t){var i=new mono.Entity;t===e&&(t=!0),i.name=this.name,null==i.up&&(i.up=new Je(0,1,0)),i.up.copy(this.up),i._position.copy(this._position),i._rotation.copy(this._rotation),i.eulerOrder=this.eulerOrder,i._scale.copy(this._scale),i.renderDepth=this.renderDepth,i.rotationAutoUpdate=this.rotationAutoUpdate,i.matrix.copy(this.matrix),i.worldMatrix.copy(this.worldMatrix),i.rotationWorldMatrix.copy(this.rotationWorldMatrix),i.matrixAutoUpdate=this.matrixAutoUpdate,i.worldMatrixNeedsUpdate=this.worldMatrixNeedsUpdate,i.quaternion.copy(this.quaternion),i.useQuaternion=this.useQuaternion,i._visible=this._visible,i.castShadow=this.castShadow,i.receiveShadow=this.receiveShadow,i.frustumCulled=this.frustumCulled,i.styleMap=i.styleMap||{},t&&this._childList&&this._childList.forEach(function(e){i.addChild(e.clonePrefab(t))}),i.vertices=this.vertices,i.faces=this.faces,i.uvs=this.uvs,i.uv2s=this.uv2s,i.primitive=this.primitive,i.data=this.primitive.data,i.computed=!0;for(var n in this.styleMap)i.styleMap[n]=this.getCloneObject(this.styleMap[n]);if(null!=this._clientMap)for(var s in this._clientMap)i.setClient(s,this._clientMap[s]);if(i.material=this.material,this.material instanceof Ke.ArrayMaterial){i.material=new Ke.ArrayMaterial,i.material.materials=[];for(var r=0;r<this.material.materials.length;r++)i.material.materials.push(this.material.materials[r])}return i.materialSize=this.getMaterialSize(),i},createCloneObject:function(){return this.constructor?object=new this.constructor:object=new Ke.Element,object},clone:function(t,i,n){if("boolean"==typeof t&&(n=i,i=t,t=e),t==e&&(t=this.createCloneObject()),n===e&&(n=!0),t.name=this.name,null==t.up&&(t.up=new Je(0,1,0)),t.up.copy(this.up),t._position.copy(this._position),t._rotation.copy(this._rotation),t.eulerOrder=this.eulerOrder,t._scale.copy(this._scale),t.renderDepth=this.renderDepth,t.rotationAutoUpdate=this.rotationAutoUpdate,t.matrix.copy(this.matrix),t.worldMatrix.copy(this.worldMatrix),t.rotationWorldMatrix.copy(this.rotationWorldMatrix),t.matrixAutoUpdate=this.matrixAutoUpdate,t.worldMatrixNeedsUpdate=this.worldMatrixNeedsUpdate,t.quaternion.copy(this.quaternion),t.useQuaternion=this.useQuaternion,t._visible=this._visible,t.castShadow=this.castShadow,t.receiveShadow=this.receiveShadow,t.frustumCulled=this.frustumCulled,t.styleMap=t.styleMap||{},n&&this._childList&&this._childList.forEach(function(e){t.addChild(e.clone(i,n))}),this.constructor){var s=this.constructor.prototype.__accessor,r=this.constructor.prototype.__bool;if(s&&s.length>0)for(var a=0;a<s.length;a++){var o=s[a],h=Ke.getter(o,r),l=Ke.setter(o);"vertices"===o?t.vertices=this.vertices:"faces"===o?t.faces=this.faces:t[l]&&t[l](this[h]())}}if(i&&this.vertices){var c=t,u=this.vertices;c.vertices=[],c.faces=[],c.uvs=[];for(var a=0,d=u.length;a<d;a++)c.vertices.push(u[a].clone());for(var f=this.faces,a=0,d=f.length;a<d;a++)c.faces.push(f[a].clone());for(var g=this.uvs,a=0,d=g.length;a<d;a++){for(var _=g[a],p=[],v=0,m=_.length;v<m;v++)p.push(new Ke.Vec2(_[v].x,_[v].y));c.uvs.push(p)}}for(var y in this.styleMap)t.setStyle(y,this.getCloneObject(this.styleMap[y]));if(null!=this._clientMap)for(var A in this._clientMap)t.setClient(A,this._clientMap[A]);return t.cloneCallback(i),t}}),Ke.Annotation=function(t,e,i,n){Ke.Element.call(this,n),this._label=t,this._text=e,this.buttons=i,this._cameraPosition=null},Ke.extend(Ke.Annotation,Ke.Element,{___accessor:["label","text","cameraPosition"]}),Ke.Node=function(t){Ke.Element.call(this,t),this.name="",this.computed=!1,this.selectionData=null,this.stylesMap=new Object,this.renderGroup=[],this.primitive=null,this.vertices=[],this.faces=[],this.uvs=[],this.uv2s=[],this.colors=[],this.normals=[],this.faces=[],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.morphTargetsNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1,this.computeNodeData(),this._alarmBillboard=null},Ke.extend(Ke.Node,Ke.Element,{__accessor:["vertices","faces","uvs","linkAgent"],__SizePropeties:[],setUpdateFlags:function(t){this.verticesNeedUpdate=t,this.morphTargetsNeedUpdate=t,this.elementsNeedUpdate=t,this.uvsNeedUpdate=t,this.normalsNeedUpdate=t,this.tangentsNeedUpdate=t,this.colorsNeedUpdate=t},getLinks:function(){return this._links},getFromLinks:function(){return this._fromLinks},getToLinks:function(){return this._toLinks},_addFromLink:function(t){this._allLinks||(this._allLinks=new ci),this._fromLinks||(this._fromLinks=new ci),this._allLinks.add(t),this._fromLinks.add(t),this._resetLinkSet()},_addToLink:function(t){this._allLinks||(this._allLinks=new ci),this._toLinks||(this._toLinks=new ci),this._allLinks.add(t),this._toLinks.add(t),this._resetLinkSet()},_removeFromLink:function(t){this._allLinks.remove(t),this._fromLinks.remove(t),0===this._allLinks.size()&&delete this._allLinks,0===this._fromLinks.size()&&delete this._fromLinks,this._resetLinkSet()},_removeToLink:function(t){this._allLinks.remove(t),this._toLinks.remove(t),0===this._allLinks.size()&&delete this._allLinks,0===this._toLinks.size()&&delete this._toLinks,this._resetLinkSet()},_resetLinkSet:function(){if(delete this._loopedLinks,!this._allLinks||0===this._allLinks.size())return void delete this._links;var t;this._allLinks.forEach(function(e){e.isLooped()&&(t||(t={}),t[e._id]||(this._loopedLinks||(this._loopedLinks=new ci),this._loopedLinks.add(e),t[e._id]=e))},this),t?(this._links=new ci,this._allLinks.forEach(function(e){t[e._id]?t[e._id]!==!1&&(t[e._id]=!1,this._links.add(e)):this._links.add(e)},this)):this._links=this._allLinks},onAlarmChange:function(t,e){Ke.Element.prototype.onAlarmChange.call(this,t,e);var i=this;setTimeout(function(){var t=i._alarmState.getPropagateSeverity();t||(t=i._alarmState.getHighestNativeAlarmSeverity());var e=i._parent,n=!1;if(null!=e&&e._alarmState){var s=e._alarmState.getPropagateSeverity();s||(n=!0)}else n=!0;t&&n?(null==i._alarmBillboard&&i.setAlarmBillboard(new Ke.Billboard),i._alarmBillboard.setStyle("m.texture.image",Ke.ImageCache.AlarmBillboardImage),i._alarmBillboard.setStyle("m.color",t.color),i._alarmBillboard.setStyle("m.alignment",Ke.BillboardAlignment.bottomCenter)):i.setAlarmBillboard(null)},10)},_setAlarmBillboardPositionAndSize:function(t){var e=this.getStyle("alarm.billboard.position"),i=this.getBoundingBox(),n=i.min,s=i.max,r=i.center(),a=i.size();"topLeft"===e?t._position.set(n.x,s.y,r.z+1):"topRight"===e?t._position.set(s.x,s.y,r.z+1):"topBack"===e?t._position.set(r.x,s.y,n.z-1):"topFront"===e?t._position.set(r.x,s.y,s.z+1):t._position.set(r.x,s.y,r.z+1);var o=this.getStyle("alarm.billboard.scale");o instanceof Je?t._scale.copy(o):t._scale.set(a.x/2,a.x/2,1);var h=this.getStyle("alarm.billboard.vertical");t.setStyle("m.vertical",h)},getLinkOffset:function(t){return new mono.Vec3(0,0,0)},getLinkExtend:function(t){return new mono.Vec3(0,0,0)},clearLinkOrthogonal:function(t,e){return!1},clearLinkExtend:function(t,e){return!1},setAlarmBillboard:function(t){if(this._alarmBillboard!=t){var e=this._alarmBillboard;t?(this._alarmBillboard=t,t.setParent(this),t.setClient("alarmBillboard",!0),this._setAlarmBillboardPositionAndSize(t)):(this._alarmBillboard.setParent(null),
delete this._alarmBillboard),this.firePropertyChange("alarmBillboard",e,t)}},needUpdate:function(){return this.verticesNeedUpdate||this.morphTargetsNeedUpdate||this.elementsNeedUpdate||this.uvsNeedUpdate||this.normalsNeedUpdate||this.tangentsNeedUpdate||this.colorsNeedUpdate},getVerticesWithChildren:function(t,e){function i(i){i.applyMatrix4(t),e.push(i)}null==e&&(e=[]),null==t&&(t=new ti);var n;if(this instanceof Ke.Node){if(null!=this.vertices&&0!=this.vertices.length){var s=this.getBoundingBox(),r=s.min,a=s.max;i(r.clone()),i(a.clone()),i(new Je(r.x,r.y,a.z)),i(new Je(r.x,a.y,r.z)),i(new Je(a.x,r.y,r.z)),i(new Je(a.x,a.y,r.z)),i(new Je(a.x,r.y,a.z)),i(new Je(r.x,a.y,a.z))}for(var n=0;n<(this._childList?this._childList.size():0);n++){var o=this._childList.get(n),h=new ti;h.multiplyMatrices(t,o.matrix.clone()),o.getVerticesWithChildren&&o.getVerticesWithChildren(h,e)}}return e},getBoundingBoxWithChildren:function(t){var e=this.getVerticesWithChildren();if(t)for(var i=0;i<t.length;i++){var n=t[i];if(n.getParent()===this.getParent()&&n!==this){var s=(new ti).getInverse(this.matrix.clone()),r=(new ti).multiplyMatrices(s,n.matrix.clone());e=e.concat(n.getVerticesWithChildren(r))}}var a=new Ke.BoundingBox;return a.setFromPoints(e),a},getWorldBoundingBox:function(){for(var t=[],e=0;e<this.vertices.length;e++){var i=this.vertices[e].clone();i.applyMatrix4(this.worldMatrix),t.push(i)}var n=new Ke.BoundingBox;return n.setFromPoints(t),n},getBoundingBox:function(){return null==this.boundingBox&&this.computeBoundingBox(),this.boundingBox},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ke.BoundingBox),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Ke.BoundingSphere),this.boundingSphere.setFromCenterAndPoints(this.boundingSphere.center,this.vertices)},createPropagateAlarmCube:function(t){if(null==this.boundingBox&&this.computeBoundingBox(),t._attachId=this._id,null==this.propagateAlarmData){var e=this.getStyle("outer.offset"),i=this.boundingBox.min,n=this.boundingBox.max;t.width=n.x-i.x+e,t.height=n.y-i.y+e,t.depth=n.z-i.z+e,t.computed=!1,t.computeNodeData(),this.propagateAlarmData=t.data,oi(t,!0),this.propagateAlarmData.primitive=t.primitive,this.propagateAlarmData.groups=t.groups;for(var s=(new Je).center(i,n),r=0;r<t.vertices.length;r++){var a=t.vertices[r];a.add(s)}this.propagateAlarmData.vertices=t.vertices}else{var o=this.propagateAlarmData;t.primitive=o.primitive,t.data=o,t.vertices=o.vertices,t.uvs=o.uvs,t.faces=o.faces,t.groups=o.groups}this.updateMatrix(!0),t._position.copy(this._position),t._scale.copy(this._scale),t._rotation.copy(this._rotation),t.useQuaternion=this.useQuaternion,t.quaternion=this.quaternion,t.worldMatrix=this.worldMatrix,t._parent=this.getParent(),t.updateMatrix(!0);var h=t.material;h.wireframeLinewidth=this.getStyle("outer.width");var l=this.getAlarmState().getPropagateSeverity();return h.color.set(l.color),t},createCanvasSelectionCube:function(){return null==this._csc&&(this._csc=new vi,this._csc.material=new Ke.EntityMaterial,this._csc.material.wireframe=!0),this.createSelectionCube(this._csc),this._csc},createSelectionCube:function(t){if(null==this.boundingBox&&this.computeBoundingBox(),t._attachId=this._id+"_selection",null==this.selectionData){var e=this.getStyle("select.offset"),i=this.boundingBox.min,n=this.boundingBox.max,s=(new Je).center(i,n);t.width=n.x-i.x+e,t.height=n.y-i.y+e,t.depth=n.z-i.z+e,t.offset=s,t.computed=!1;t.computeNodeData();this.selectionData=t.data,oi(t,!0),this.selectionData.primitive=t.primitive,this.selectionData.groups=t.groups,this.selectionData.vertices=t.vertices}else{var r=this.selectionData;t.primitive=r.primitive,t.data=r,t.vertices=r.vertices,t.uvs=r.uvs,t.faces=r.faces,t.groups=r.groups}this.updateMatrix(!0),t._position.copy(this._position),t._scale.copy(this._scale),t._rotation.copy(this._rotation),t.useQuaternion=this.useQuaternion,t.quaternion=this.quaternion,t.worldMatrix=this.worldMatrix,t._parent=this.getParent(),t.updateMatrix(!0);var a=t.material;return a.wireframeLinewidth=this.getStyle("select.width"),a.color.set(this.getStyle("select.color")),t},mergeVertices:function(){var t,i,n,s,r,a,o,h={},l=[],c=[],u=4,d=Math.pow(10,u);for(this.__tmpVertices=e,null==this.vertices&&console.log("vertices is null"),n=0,s=this.vertices.length;n<s;n++)t=this.vertices[n],i=[Math.round(t.x*d),Math.round(t.y*d),Math.round(t.z*d)].join("_"),h[i]===e?(h[i]=n,l.push(this.vertices[n]),c[n]=l.length-1):c[n]=c[h[i]];var f=[];for(n=0,s=this.faces.length;n<s;n++)if(r=this.faces[n],r instanceof _i){r.a=c[r.a],r.b=c[r.b],r.c=c[r.c],a=[r.a,r.b,r.c];for(var g=-1,_=0;_<3;_++)if(a[_]==a[(_+1)%3]){g=_,f.push(n);break}}else if(r instanceof pi){r.a=c[r.a],r.b=c[r.b],r.c=c[r.c],r.d=c[r.d],a=[r.a,r.b,r.c,r.d];for(var g=-1,_=0;_<4;_++)a[_]==a[(_+1)%4]&&(g>=0&&f.push(n),g=_);if(g>=0){a.splice(g,1);var p=new _i(a[0],a[1],a[2],r.normal,r.color,r.materialIndex);o=this.uvs[n],o&&o.splice(g,1),r.vertexNormals&&r.vertexNormals.length>0&&(p.vertexNormals=r.vertexNormals,p.vertexNormals.splice(g,1)),r.vertexColors&&r.vertexColors.length>0&&(p.vertexColors=r.vertexColors,p.vertexColors.splice(g,1)),this.faces[n]=p}}for(n=f.length-1;n>=0;n--);var v=this.vertices.length-l.length;return this.vertices=l,v},computeVertexNormals:function(t){var i,n,s,r,a,o;if(this.__tmpVertices===e){for(this.__tmpVertices=new Array(this.vertices.length),o=this.__tmpVertices,i=0,n=this.vertices.length;i<n;i++)o[i]=new Ke.Vec3;for(s=0,r=this.faces.length;s<r;s++)a=this.faces[s],a.vertexNormals=[new Ke.Vec3,new Ke.Vec3,new Ke.Vec3]}else for(o=this.__tmpVertices,i=0,n=this.vertices.length;i<n;i++)o[i].set(0,0,0);if(t){var h,l,c,u=new Ke.Vec3,d=new Ke.Vec3;new Ke.Vec3,new Ke.Vec3,new Ke.Vec3;for(s=0,r=this.faces.length;s<r;s++)a=this.faces[s],h=this.vertices[a.a],l=this.vertices[a.b],c=this.vertices[a.c],u.subVectors(c,l),d.subVectors(h,l),u.cross(d),o[a.a].add(u),o[a.b].add(u),o[a.c].add(u),a.d!=e&&o[a.d].add(u)}else for(s=0,r=this.faces.length;s<r;s++)a=this.faces[s],o[a.a].add(a.normal),o[a.b].add(a.normal),o[a.c].add(a.normal);for(i=0,n=this.vertices.length;i<n;i++)o[i].normalize();for(s=0,r=this.faces.length;s<r;s++)a=this.faces[s],a.vertexNormals[0].copy(o[a.a]),a.vertexNormals[1].copy(o[a.b]),a.vertexNormals[2].copy(o[a.c]),a.d!=e&&(a.vertexNormals[3]=o[a.d].clone())},computeCentroids:function(){var t,e,i;for(t=0,e=this.faces.length;t<e;t++)i=this.faces[t],i.centroid=i.centroid||new Je,null==i.centroid&&console.log("fdasfdsa"),i.centroid.set||(i.centroid=new Je),i.centroid.set(0,0,0),i instanceof _i?(i.centroid.add(this.vertices[i.a]),i.centroid.add(this.vertices[i.b]),i.centroid.add(this.vertices[i.c]),i.centroid.divideScalar(3)):i instanceof pi&&(i.centroid.add(this.vertices[i.a]),i.centroid.add(this.vertices[i.b]),i.centroid.add(this.vertices[i.c]),i.centroid.add(this.vertices[i.d]),i.centroid.divideScalar(4))},computeFaceNormals:function(){var t,e,i,n,s,r,a=new Je,o=new Je;for(t=0,e=this.faces.length;t<e;t++)i=this.faces[t],n=this.vertices[i.a],s=this.vertices[i.b],r=this.vertices[i.c],a.subVectors(r,s),o.subVectors(n,s),a.cross(o),a.normalize(),i.normal.copy||(i.normal=new Je),i.normal.copy(a)},computeVertex:function(){},computePrimitive:function(){},generalteGroup:function(){},getMatetial:function(){return this.material},computeNodeMaterial:function(t){},cacheNodeMaterial:function(t){},needComputeVertexNormal:function(){return!0},computeNodeData:function(t){if(this.computed===!1){var e=this.generatePrimitiveKey();this._attachId&&(e+="_"+this._attachId);var i=Ke.PrimitiveCache.getPrimitive(e),n=!1;if(i)this.primitive&&Ke.PrimitiveCache.unUsePrimitive(i),this.computeNodeMaterial(i);else{var s=this.computeData();if(this.needComputeVertexNormal()&&(Ke.Node.prototype.mergeVertices.call(s),Ke.Node.prototype.computeFaceNormals.call(s),Ke.Node.prototype.computeVertexNormals.call(s,!0)),(null==s.uv2s||0==s.uv2s.length)&&(s.uv2s=[],null!=s.uvs&&s.uvs.length>0))for(var r=0;r<s.uvs.length;r++){for(var a=[],o=s.uvs[r],h=0;h<o.length;h++)a.push(o[h].clone());s.uv2s.push(a)}i=new Ke.Primitive(s,e),Ke.PrimitiveCache.setPrimitive(e,i),this.cacheNodeMaterial(i),n=!0}return Ke.PrimitiveCache.usePrimitive(i),this.primitive=i,this.data=i.data,this.vertices=i.vertices,this.faces=i.faces,this.uvs=i.uvs,this.uv2s=i.uv2s,this.computed=!0,n}},computeData:function(){var t={vertices:[],faces:[],uv2s:[],uvs:[]};return this.vertices=t.vertices,this.uvs=t.uvs,this.faces=t.faces,this.data=t,t},setMaterial:function(t,e,i){var n=e.getUniqueCode?e.getUniqueCode():null,s=Ji.getMaterial(n);s?(this.material.materials[t]=s,Ji.useMaterial(s)):(this.material.materials[t]=e,Ji.setMaterial(n,e),Ji.useMaterial(e)),Ji.unUseMaterial(i)},onMaterialMapping:function(){this.groups=e},getMaterialSize:function(){return this.materialSize||1},startBatch:function(){this.batch=!0},endBatch:function(){this.materialMappingChanges!==e&&(this.onSizeChanged(),this.onMaterialMapping(),this.firePropertyChange("materialMapping",this.materialMappingChanges[0],this.materialMappingChanges[1]),this.materialMappingChanges=e),this.batch=!1},compareAndSetMaterial:function(t,e,i){this.setMaterial(i,e,t)},cloneStyle:function(t){if(this.getClassName()!=t.getClassName())return void console.warn("ApplyStyle fail, the source with not the same class");for(var e=this.getMaterialMapping(),i=0;i<this.getMaterialSize();i++){var n=this.material.materials[i],s=t.material.materials[i];this.compareAndSetMaterial(n,s,i)}var r=this.getMaterialMapping();Ke.Utils.isSame(e,r)||(this.batch?this.materialMappingChanges=[e,r]:(this.onSizeChanged(),this.onMaterialMapping(),this.firePropertyChange("materialMapping",e,r)))},_considerArray:function(t,e){if(!t.startsWith("envmap.image"))return yi.isArray(e);var i=!1;if(yi.isArray(e))for(var n=0;n<e.length;n++)if(yi.isArray(e[n])){i=!0;break}return i},setMaterialStyles:function(t){var e,i,n,s,r,a,o=this.getMaterialMapping(),o=this.getMaterialMapping();for(var h in t)var l=t[h];for(var c=0;c<this.getMaterialSize();c++){i=this.material.materials[c],n=i.clone();var u=!1;for(var h in t){var d=!1;if(h.startsWith("m."))s=h.substr(h.indexOf(".")+1);else if(this.getSideIndexMapping()&&this.isSideStyle(h)){var f=h.substr(0,h.indexOf(".")),r=this.getSideMaterialIndex(f);if(r!=c)continue;d=!0,a=h.substr(h.indexOf(".")+1),s=a.substr(a.indexOf(".")+1)}var l=t[h];e=l[0],null==e?e=Ke.Styles.getStyle(h):this._considerArray(s,e)&&(e=e[c]),this._A97(n,s,e),u=!0}u&&this.compareAndSetMaterial(i,n,c)}this.changeMapping(o)},setMaterialStyle:function(t,e,i){var e,n,s,r,a,o=t;if(t.startsWith("m.")&&(o=t.substr(t.indexOf(".")+1)),null==i&&!Ke.Utils.isArray(e)){var h=[];for(c=0;c<this.getMaterialSize();c++)h.push(e);this.styleMap[t]=h,e=h}var l=!1;if(o.startsWith("envmap.image")&&e&&yi.isArray(e))for(var c=0;c<e.length;c++){if(yi.isArray(e[c])){l=!1;break}l=!0}var u=this.getMaterialMapping();if(null!=i||Ke.Utils.isArray(e)&&!l){if(Ke.Utils.isArray(e)){n=e;for(var c=0;c<this.getMaterialSize();c++)s=n[c],r=this.material.materials[c],a=r.clone(),null==s&&(s=Ke.Styles.getStyle(t)),this._A97(a,o,s),this.compareAndSetMaterial(r,a,c)}else if(null!=i){var u=this.getMaterialMapping();r=this.material.materials[i],a=r.clone(),this._A97(a,o,e),this.compareAndSetMaterial(r,a,i),this.synchronizeIndexStyle(t,i,e)}}else for(var d=[],c=0;c<this.getMaterialSize();c++)d[c]!==!0&&(s=e,r=this.material.materials[c],a=r.clone(),null==s&&(s=Ke.Styles.getStyle(t)),this._A97(a,o,s),this.compareAndSetMaterial(r,a,c));this.changeMapping(u)},changeMapping:function(t){var e=this.getMaterialMapping();Ke.Utils.isSame(t,e)||(this.batch?this.materialMappingChanges=[t,e]:(this.onSizeChanged(),this.onMaterialMapping(),this.firePropertyChange("materialMapping",t,e)))},synchronizeSideStyle:function(t,e,i){var n=this.getMaterialIndexSide(e);n&&null!=this.styleMap[n+"."+t]&&(this.styleMap[n+"."+t]=i)},synchronizeIndexStyle:function(t,e,n){var s=this.styleMap[t];if(null==s&&(s=this.getStyle(t),this.styleMap[t]=s),Ke.Utils.isArray(s))s[e]=n;else{var r=[];for(i=0;i<this.getMaterialSize();i++)r.push(s);r[e]=n,this.styleMap[t]=r}},getDefaultMaterial:function(t,e){return t?t instanceof Ke.ArrayMaterial?0===t.materials.length?Ji.DefaultMaterial:(e>=t.materials.length&&(e=t.materials.length-1),t.materials[e]):t:Ji.DefaultMaterial},createMaterial:function(t){var e=new Ke.ArrayMaterial;this.material=e;for(var i=this.getMaterialSize(),n=0;n<i;n++)this.setMaterial(n,this.getDefaultMaterial(t,n))},onPropertyChange:function(t,e,i){this.changeProperty=t,this.oldGroups=this.groups;var n=this.isSizeChangedProperty(t);n&&this.onSizeChanged(),n&&this.onMaterialMapping(),n&&this.firePropertyChange("materialMapping",0,1)},onSizeChanged:function(){this.computed=!1,this.computeNodeData(),this.computeCentroids(),this.computeFaceNormals(),this.computeBoundingBox(),this.selectionData=null,this.boundingSphere=null,this.changeProperty=null},isSizeChangedProperty:function(t){return this.__SizePropeties.indexOf(t)!==-1||"vertices"==t||"faces"==t||"uvs"==t},isGroupChangedProperty:function(t){},getMaterialMapping:function(){var t={},e=this.material.materials;for(var i in e)t[i]=e.indexOf(e[i]);return t},getSideMaterialIndex:function(t){var e=this.getSideIndexMapping();if(e)return e[t]},getMaterialIndexSide:function(t){var e=this.getIndexSideMapping();if(e)return e[t]},getIndexSideMapping:function(){var t=this.getSideIndexMapping();if(t&&!this.IndexSideMapping){this.IndexSideMapping={};var e,i;for(e in t)i=t[e],this.IndexSideMapping[i]=e}return this.IndexSideMapping},getSideIndexMapping:function(){},disposeMaterial:function(){},getMaterial:function(){return this.material}});var gi=function(t,e,i){this.normal=t instanceof Ke.Vec3?t:new Ke.Vec3,this.vertexNormals=t instanceof Array?t:[],this.color=e instanceof Ke.Color?e:new Ke.Color,this.vertexColors=e instanceof Array?e:[],this.materialIndex=i?i:0,this.centroid=new Ke.Vec3,this.needVertexNormal=!1};Ke.Face=gi,gi.prototype={constructor:Ke.Face,subClone:function(){},clone:function(){var t=this.subClone();t.normal.copy(this.normal),t.color.copy(this.color),t.centroid.copy(this.centroid),t.materialIndex=this.materialIndex;var e,i;for(e=0,i=this.vertexNormals.length;e<i;e++)t.vertexNormals.push(this.vertexNormals[e]);for(e=0,i=this.vertexColors.length;e<i;e++)t.vertexColors.push(this.vertexColors[e]);return t}};var _i=function(t,e,i,n,s,r){Ke.Face.call(this,n,s,r),this.a=t,this.b=e,this.c=i};Ke.Face3=_i,_i.prototype=Object.create(Ke.Face.prototype),_i.prototype.constructor=Ke.Face3,_i.prototype.subClone=function(){var t=new _i(this.a,this.b,this.c);return t},_i.prototype.vertexCount=3,_i.prototype.serializeJsonValue=function(){return{a:this.a,b:this.b,c:this.c}};var pi=function(t,e,i,n,s,r,a){Ke.Face.call(this,s,r,a),this.a=t,this.b=e,this.c=i,this.d=n};Ke.Face4=pi,pi.prototype=Object.create(Ke.Face.prototype),pi.prototype.constructor=Ke.Face4,pi.prototype.subClone=function(){var t=new pi(this.a,this.b,this.c,this.d);return t},pi.prototype.splitToFace3s=function(){var t=new _i(this.a,this.b,this.d,this.normal,this.color,this.materialIndex),e=new _i(this.d,this.b,this.c,this.normal,this.color,this.materialIndex);return[t,e]},pi.prototype.vertexCount=4,pi.prototype.serializeJsonValue=function(){return{a:this.a,b:this.b,c:this.c,d:this.d}},Ke.Entity=function(t,i){t instanceof Ke.ArrayMaterial?(this.material=t,this.materialSize=this.material.materials.length||1):t instanceof Ke.Material?(this.material=t,this.materialSize=1):t&&(this.materialSize=t),this.materialSize=this.materialSize||1,this.createMaterial(this.material),i!=e&&null==this._id&&(this._id=i),Ke.Node.call(this,this._id),this.groups=null},Ke.extend(Ke.Entity,Ke.Node,{constructor:Ke.Entity,className:"TGL.Entity",__accessor:["computeVertexNormal"],__SizePropeties:["computeVertexNormal"],setUpdateFlags:function(t){this.verticesNeedUpdate=t,this.morphTargetsNeedUpdate=t,this.elementsNeedUpdate=t,this.uvsNeedUpdate=t,this.normalsNeedUpdate=t,this.colorsNeedUpdate=t,this.tangentsNeedUpdate=t,this.buffersNeedUpdate=t},cloneCallback:function(t){t&&"TGL.Entity"===this.className&&(this.computed=!1,this.computeNodeData())},needComputeVertexNormal:function(){return this.computeVertexNormal},computeData:function(){var t={vertices:this.vertices,faces:this.faces,uvs:this.uvs,uv2s:this.uv2s};return t},createCloneObject:function(){return this.constructor===Ke.Entity?new Ke.Entity(this.materialSize):Ke.Element.prototype.createCloneObject.call(this)},getMaterialSize:function(){return this.materialSize},setMaterialSize:function(t){"number"==typeof t&&(this.materialSize=t,this.createMaterial(this.material))}});var vi=function(){var t,e,i,n,s,r,a,o;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(a=arguments[0],t=a.width,e=a.height,i=a.depth,n=a.segmentsW,s=a.segmentsH,r=a.segmentsD,o=a.wrapMode,this._id=a.id):arguments[0]instanceof Ke.Material?(this.material=arguments[0],t=arguments[1],e=arguments[2],i=arguments[3],n=arguments[4],s=arguments[5],r=arguments[6],o=arguments[7]):(t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3],s=arguments[4],r=arguments[5],o=arguments[6]),this.width=t||1,this.height=e||1,this.depth=i||1,this.segmentsW=n||1,this.segmentsH=s||1,this.segmentsD=r||1,this.wrapMode=(o||"").toLowerCase(),this.materialSize=null==this.wrapMode||""==this.wrapMode?6:1,this.offset=new Je(0,0,0),Ke.Entity.call(this)};Ke.Cube=vi,Ke.extend(Ke.Cube,Ke.Entity,{__accessor:["width","height","depth","wrapMode"],__SizePropeties:["width","height","depth","wrapMode"],className:"TGL.Cube",getUVs:function(){return this.uvs},setPropertyValue:function(t,e){var i=this[t];if(i===e)return!1;if(this[t]=e,"wrapMode"===t){var n=this.wrapMode,s="six-each"==n||"front-other"==n||"back-other"==n||"left-other"==n||"right-other"==n||"top-other"==n||"bottom-other"==n;this.materialSize=null==this.wrapMode||""==this.wrapMode?6:1,s||(this[t]="")}return!0},getLinkOffset:function(t){t.length();t.normalize();var e=t.x/this.getWidth(),i=t.y/this.getHeight(),n=t.z/this.getDepth(),s=Math.max(Math.abs(e),Math.abs(i),Math.abs(n));return s==Math.abs(e)?new Je(this.getWidth()/2*(e<0?-1:1),0,0):s==Math.abs(i)?new Je(0,this.getHeight()/2*(i<0?-1:1),0):new Je(0,0,this.getDepth()/2*(n<0?-1:1))},getLinkExtend:function(t){var e=this.worldMatrix.clone();return e=(new mono.Mat4).extractRotation(e),this.getLinkOffset(t.applyMatrix4((new ti).getInverse(e)))},computeData:function(){var t=ai.buildCubeData(this.width,this.height,this.depth,this.segmentsW,this.segmentsH,this.segmentsD,this.wrapMode,this.offset||new Je(0,0,0));return this.vertices=t.vertices,this.uvs=t.uvs,this.faces=t.faces,this.data=t,t},getSideIndexMapping:function(){return this.wrapMap?null:Ke.Cube.SideIndexMapping},generatePrimitiveKey:function(){return"cube_"+this.width+"_"+this.height+"_"+this.depth+"_"+this.segmentsW+"_"+this.segmentsH+"_"+this.segmentsD+"_"+(this.material instanceof Ke.ArrayMaterial?1:0)+"_"+this.wrapMode+"_"+this.offset.x+"_"+this.offset.y+"_ "+this.offset.z+"_"+Ke.Utils.toString(this.getMaterialMapping())},serialize:function(t){var e=t;1!==this.width&&e.serializeSimple("p","width",this.width,"number"),1!==this.height&&e.serializeSimple("p","height",this.height,"number"),1!==this.depth&&e.serializeSimple("p","depth",this.depth,"number"),1!==this.widthSegemtns&&e.serializeSimple("p","widthSegemtns",this.widthSegemtns,"number"),1!==this.heightSegments&&e.serializeSimple("p","heightSegments",this.heightSegments,"number"),1!==this.depthSegments&&e.serializeSimple("p","depthSegments",this.depthSegments,"number"),Ke.Element.serialize.call(this,e)}}),vi.SideIndexMapping={right:0,left:1,top:2,bottom:3,front:4,back:5},Ke.Sphere=function(){var t,i,n,s,r,a,o;if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var h=arguments[0];t=h.radius,i=h.segmentsW,n=h.segmentsH,s=h.longitudeStart,r=h.longitudeLength,a=h.latitudeStart,this._id=h.id}else arguments[0]instanceof Ke.Material?(this.material=arguments[0],t=arguments[1],i=arguments[2],n=arguments[3],s=arguments[4],r=arguments[5],a=arguments[6],o=arguments[7]):(t=arguments[0],i=arguments[1],n=arguments[2],s=arguments[3],r=arguments[4],a=arguments[5],o=arguments[6]);this.radius=t||50,this.segmentsW=Math.max(3,Math.floor(i)||22),this.segmentsH=Math.max(2,Math.floor(n)||15),this.longitudeStart=s!==e?s:0,this.longitudeLength=r!==e?r:2*Math.PI,this.latitudeStart=a!==e?a:0,this.latitudeLength=o!==e?o:Math.PI,this.materialSize=1,Ke.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},Ke.extend(Ke.Sphere,Ke.Entity,{constructor:Ke.Sphere,__accessor:["radius","segmentsW","segmentsH","latitudeStart","latitudeLength","longitudeStart","longitudeLength"],__SizePropeties:["radius","segmentsW","segmentsH","latitudeStart","latitudeLength","longitudeStart","longitudeLength"],className:"TGL.Sphere",computeData:function(){var t=ai.bsd(this.radius,this.segmentsW,this.segmentsH,this.longitudeStart,this.longitudeLength,this.latitudeStart,this.latitudeLength);return this.vertices=t.vertices,this.uvs=t.uvs,this.faces=t.faces,this.data=t,t},setWidthSegments:function(t){console.log("TGL.Sphere.setWidthSegments has deprecated,please use setSegmentsW"),this.setSegmentsW(t)},setHeightSegments:function(t){console.log("TGL.Sphere.setHeightSegments has deprecated,please use setSegmentsW"),this.setSegmentsH(t)},generatePrimitiveKey:function(){return"sphere_"+this.radius+"_"+this.segmentsW+"_"+this.segmentsH+"_"+this.longitudeStart+"_"+this.longitudeLength+"_"+this.latitudeStart+"_"+this.latitudeLength},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Ke.BoundingSphere(new Ke.Vec3,this.radius))},getLinkOffset:function(t){t.length();return t.normalize(),t.multiplyScalar(this.radius)},serialize:function(t){var e=t;50!==this.radius&&e.serializeSimple(ji,"radius",this.radius,"number"),24!==this.widthSegments&&e.serializeSimple(ji,"widthSegments",this.widthSegments,"number"),18!==this.heightSegments&&e.serializeSimple(ji,"heightSegments",this.heightSegments,"number"),0!==this.phiStart&&e.serializeSimple(ji,"phiStart",this.phiStart,"number"),this.phiLength!==2*Math.PI&&e.serializeSimple(ji,"phiLength",this.phiLength,"number"),0!==this.thetaStart&&e.serializeSimple(ji,"thetaStart",this.thetaStart,"number"),this.thetaLength!==Math.PI&&e.serializeSimple(ji,"thetaLength",this.thetaLength,"number")}}),Ke.Plane=function(){var t,e,i,n;arguments[0]instanceof Ke.Material?(this.material=arguments[0],t=arguments[1],e=arguments[2],i=arguments[3],n=arguments[4]):(t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3]),this.width=t||5,this.height=e||5,this.segmentsW=i||1,this.segmentsH=n||1,this.vertices=[],this.faces=[],this.uvs=[],this.uv2s=[],this.materialSize=1,this.computeData=function(){var t,e,i=this.width/2,n=this.height/2,s=this.segmentsW,r=this.segmentsH,a=s+1,o=r+1,h=this.width/s,l=this.height/r,c=new Ke.Vec3(0,0,1),u={vertices:[],faces:[],uvs:[]};for(e=0;e<o;e++)for(t=0;t<a;t++){var d=t*h-i,f=e*l-n;u.vertices.push(new Ke.Vec3(d,(-f),0))}for(e=0;e<r;e++)for(t=0;t<s;t++){var g=t+a*e,_=t+a*(e+1),p=t+1+a*(e+1),v=t+1+a*e,m=new Ke.Vec2(t/s,1-e/r),y=new Ke.Vec2(t/s,1-(e+1)/r),A=new Ke.Vec2((t+1)/s,1-(e+1)/r),x=new Ke.Vec2((t+1)/s,1-e/r),w=new Ke.Face4(g,_,p,v);w.normal.copy(c),w.vertexNormals.push(c.clone(),c.clone(),c.clone(),c.clone()),u.faces.push(w),u.uvs.push([m,y,A,x])}return u},Ke.Entity.call(this),this.computeCentroids()},Ke.extend(Ke.Plane,Ke.Entity,{constructor:Ke.Plane,className:"TGL.Plane",__accessor:["width","height","segmentsW","segmentsH"],__SizePropeties:["width","height","segmentsW","segmentsH"],clone:function(){var t=new Ke.Plane(this.material,this.width,this.height,this.segmentsW,this.segmentsH);return this.superClass.clone.call(this,t),t},getSelectStyle:function(){var t=this.getStyle("select.style");return"outline.normal"!=t&&"outline"!=t||(t="outline.wireframe"),t}}),Ke.Cylinder=function(){var t,i,n,s,r,a,o,h,l;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(options=arguments[0],t=options.radiusTop,i=options.radiusBottom,n=options.height,s=options.segmentsR,r=options.segmentsH,a=options.openTop,o=options.openBottom,h=options.arcLength,l=options.arcStart,this._id=options.id):arguments[0]instanceof Ke.Material?(this.material=arguments[0],t=arguments[1],i=arguments[2],n=arguments[3],s=arguments[4],r=arguments[5],a=arguments[6],o=arguments[7],h=arguments[8],l=arguments[9]):(t=arguments[0],i=arguments[1],n=arguments[2],s=arguments[3],r=arguments[4],a=arguments[5],o=arguments[6],h=arguments[7],l=arguments[8]),this.radiusTop=t=t!==e?t:20,this.radiusBottom=i=i!==e?i:20,this.height=n=n!==e?n:100,this.segmentsR=s=s||20,this.segmentsH=r=r||1,this.openTop=a!==e&&a,this.openBottom=o!=e&&o,this.arcLength=h!==e?h:2*Math.PI,this.arcStart=l!==e?l:0,this.materialSize=3,Ke.Entity.call(this),this.computeNodeData(),this.computeCentroids(),this.computeFaceNormals()},Ke.extend(Ke.Cylinder,Ke.Entity,{constructor:Ke.Cylinder,__accessor:["radiusTop","radiusBottom","height","segmentsR","segmentsH","openTop","openBottom","arcLength","arcStart"],__bool:["openTop","openBottom"],__SizePropeties:["radiusTop","radiusBottom","height","segmentsR","segmentsH","openTop","openBottom","arcLength","arcStart"],className:"TGL.Cylinder",computeData:function(){return ai.bcld(this.height,this.segmentsH,this.radiusBottom,this.radiusTop,this.segmentsR,this.openTop,this.openBottom,this.arcLength,this.arcStart)},getLinkOffset:function(t){var e=t.length();t.normalize();var i=t.x,n=t.y,s=t.z,r=Math.sqrt(i*i+s*s),a=n>0?this.radiusTop:this.radiusBottom;if(Math.abs(n/r)>this.height/2/a&&e>0){var o=new Je(0,this.height/2*(n>0?1:-1),0);return o}return new Je(i,0,s).normalize().multiplyScalar((this.radiusTop+this.radiusBottom)/2)},getLinkExtend:function(t){var e=this.worldMatrix.clone();return e=(new mono.Mat4).extractRotation(e),this.getLinkOffset(t.applyMatrix4((new ti).getInverse(e)))},clearLinkOrthogonal:function(t,e,i,n){n=n||0;var s=this.getHeight()/2+n,r=(this.radiusTop+this.radiusBottom)/2+n;return"orthogonal.x"==i||"orthogonal.x.n"==i?!(Math.abs(t.y-e.y)>s||Math.abs(t.z-e.z)>r):"orthogonal.y"==i||"orthogonal.y.n"==i?!(Math.abs(t.x-e.x)>r||Math.abs(t.z-e.z)>r):("orthogonal.z"==i||"orthogonal.z.n"==i)&&!(Math.abs(t.y-e.y)>s||Math.abs(t.z-e.z)>r)},clearLinkExtend:function(t,e){return"extend.x"!==e&&"extend.y"===e&&t>this.getHeight()/2},getSideIndexMapping:function(){return Ke.Cylinder.SideIndexMapping},generatePrimitiveKey:function(){return"cylinder_"+this.height+"_"+this.segmentsH+"_"+this.radiusTop+"_"+this.radiusBottom+"_"+this.segmentsR+"_"+this.openTop+"_"+this.openBottom+"_"+this.arcLength+"_"+this.arcStart+Ke.Utils.toString(this.getMaterialMapping())},needComputeVertexNormal:function(){return!1}}),Ke.Cylinder.SideIndexMapping={side:0,top:1,bottom:2},Ke.Circle=function(){var t,i,n,s;4===arguments.length?(t=arguments[0],i=arguments[1],n=arguments[2],s=arguments[3]):(this.material=arguments[0],t=arguments[1],i=arguments[2],n=arguments[3],s=arguments[4]),this.radius=t=t||50,this.segments=i=i!==e?Math.max(3,i):8,this.thetaStart=n=n!==e?n:0,this.thetaLength=s=s!==e?s:2*Math.PI,this.materialSize=1,Ke.Entity.call(this),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new Ke.BoundingSphere(new Ke.Vec3,t)},Ke.extend(Ke.Circle,Ke.Entity,{clone:function(){var t=new Ke.Circle(this.material,this.radius,this.segments,this.thetaStart,this.thetaLength);return this.constructor.superClass.clone.call(this,t),t},computeData:function(){var t,e=this.segments,i=[],n=new Ke.Vec3,s=new Ke.Vec2(.5,.5),r={vertices:[],faces:[],uvs:[],uv2s:[]};for(r.vertices.push(n),i.push(s),t=0;t<=e;t++){var a=new Ke.Vec3,o=this.thetaStart+t/e*this.thetaLength;a.x=this.radius*Math.cos(o),a.y=this.radius*Math.sin(o),r.vertices.push(a),i.push(new Ke.Vec2((a.x/this.radius+1)/2,(a.y/this.radius+1)/2))}var h=new Ke.Vec3(0,0,1);for(t=1;t<=e;t++){var l=t,c=t+1,u=0;r.faces.push(new Ke.Face3(l,c,u,[h,h,h])),r.uvs.push([i[t],i[t+1],s])}return r}}),Ke.Torus=function(){var t,e,i,n,s;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(options=arguments[0],t=options.radius,e=options.tube,i=options.segmentsR,n=options.segmentsT,s=options.arc,this._id=options.id):arguments[0]instanceof Ke.Material?(this.material=arguments[0],t=arguments[1],e=arguments[2],i=arguments[3],n=arguments[4],s=arguments[5]):(t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3],s=arguments[4]),this.materialSize=1,this.radius=t||100,this.tube=e||40,this.segmentsR=i||8,this.segmentsT=n||6,this.arc=s||2*Math.PI,Ke.Entity.call(this),this.computeNodeData(),this.computeCentroids()},Ke.extend(Ke.Torus,Ke.Entity,{__accessor:["radius","tube","segmentsR","segmentsT","arc"],__SizePropeties:["radius","tube","segmentsR","segmentsT","arc"],className:"TGL.Torus",generatePrimitiveKey:function(){return"torus_"+this.radius+"_"+this.tube+"_"+this.segmentsR+"_"+this.segmentsT+"_"+this.arc},computeData:function(){for(var t=new Ke.Vec3,e=[],i=[],n={vertices:[],faces:[],uvs:[],uv2s:[]},s=0;s<=this.segmentsR;s++)for(var r=0;r<=this.segmentsT;r++){var a=r/this.segmentsT*this.arc,o=s/this.segmentsR*Math.PI*2;t.x=this.radius*Math.cos(a),t.y=this.radius*Math.sin(a);var h=new Ke.Vec3;h.x=(this.radius+this.tube*Math.cos(o))*Math.cos(a),h.y=(this.radius+this.tube*Math.cos(o))*Math.sin(a),h.z=this.tube*Math.sin(o),n.vertices.push(h),e.push(new Ke.Vec2(r/this.segmentsT,s/this.segmentsR)),i.push(h.clone().sub(t).normalize())}for(var s=1;s<=this.segmentsR;s++)for(var r=1;r<=this.segmentsT;r++){var l=(this.segmentsT+1)*s+r-1,c=(this.segmentsT+1)*(s-1)+r-1,u=(this.segmentsT+1)*(s-1)+r,d=(this.segmentsT+1)*s+r,f=new Ke.Face3(l,c,d,[i[l],i[c],i[d]]);f.normal.add(i[l]),f.normal.add(i[c]),f.normal.add(i[d]),f.normal.normalize(),n.faces.push(f),n.uvs.push([e[l].clone(),e[c].clone(),e[d].clone()]),f=new Ke.Face3(c,u,d,[i[c],i[u],i[d]]),f.normal.add(i[c]),f.normal.add(i[u]),f.normal.add(i[d]),f.normal.normalize(),n.faces.push(f),n.uvs.push([e[c].clone(),e[u].clone(),e[d].clone()])}return n}}),Ke.Arrow=function(){var t,e,i,n,s;arguments[0]instanceof Ke.Material?(this.material=arguments[0],t=arguments[1],e=arguments[2],i=arguments[3],n=arguments[4],s=arguments[5]):(t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3],s=arguments[4]),this.materialSize=1,this.tailHeight=t||100,this.tailRadius=e||20,this.headHeight=i||20,this.headRadius=n||30,this.radiusSegments=s||30,this.computeData=function(){var r=2;this.headRadius<this.tailRadius&&(this.headRadius=this.tailRadius);var a,o,h=t+i,l=h/2,c=[],u=[],d=[],f=[];for(o=0;o<=r;o++){var g=[],_=[],p=o/r,v=p*n;for(a=0;a<=s;a++){var m=a/s,y=new Ke.Vec3;y.x=v*Math.sin(m*Math.PI*2),y.y=-p*i+l,y.z=v*Math.cos(m*Math.PI*2),this.vertices.push(y),g.push(this.vertices.length-1),_.push(new Ke.Vec2(m,1-p))}c.push(g),d.push(_)}for(this.vertices.push(new Ke.Vec3(0,l-i,0)),o=0;o<=r;o++){var g=[],_=[],p=o/r,v=e;for(a=0;a<=s;a++){var m=a/s,y=new Ke.Vec3;y.x=v*Math.sin(m*Math.PI*2),y.y=-p*t+l-i,y.z=v*Math.cos(m*Math.PI*2),this.vertices.push(y),g.push(this.vertices.length-1),_.push(new Ke.Vec2(m,1-p))}u.push(g),f.push(_)}this.vertices.push(new Ke.Vec3(0,(-l),0));var A,x,w=this.headRadius/h;for(a=0;a<s;a++)for(A=this.vertices[c[0][a]].clone(),x=this.vertices[c[0][a+1]].clone(),A.setY(Math.sqrt(A.x*A.x+A.z*A.z)*w).normalize(),x.setY(Math.sqrt(x.x*x.x+x.z*x.z)*w).normalize(),o=0;o<r;o++){var b=c[o][a],S=c[o+1][a],C=c[o+1][a+1],T=c[o][a+1],E=A.clone(),L=A.clone(),M=x.clone(),P=x.clone(),k=d[o][a].clone(),I=d[o+1][a].clone(),R=d[o+1][a+1].clone(),D=d[o][a+1].clone();this.faces.push(new Ke.Face3(b,S,T,[E,L,P])),this.uvs.push([k,I,D]),this.faces.push(new Ke.Face3(S,C,T,[L,M,P])),this.uvs.push([I,R,D])}for(a=0;a<s;a++){var b=c[o][a+1],S=c[o][a],C=c.length-1,E=new Ke.Vec3(0,(-1),0),L=new Ke.Vec3(0,(-1),0),M=new Ke.Vec3(0,(-1),0),k=d[o][a+1].clone(),I=d[o][a].clone(),R=new Ke.Vec2(I.u,1);this.faces.push(new Ke.Face3(b,S,C,[E,L,M])),
this.uvs.push([k,I,R])}var A,x,w=0;for(a=0;a<s;a++)for(A=this.vertices[u[1][a]].clone(),x=this.vertices[u[1][a+1]].clone(),A.setY(Math.sqrt(A.x*A.x+A.z*A.z)*w).normalize(),x.setY(Math.sqrt(x.x*x.x+x.z*x.z)*w).normalize(),o=0;o<r;o++){var b=u[o][a],S=u[o+1][a],C=u[o+1][a+1],T=u[o][a+1],E=A.clone(),L=A.clone(),M=x.clone(),P=x.clone(),k=d[o][a].clone(),I=d[o+1][a].clone(),R=d[o+1][a+1].clone(),D=d[o][a+1].clone();this.faces.push(new Ke.Face3(b,S,T,[E,L,P])),this.uvs.push([k,I,D]),this.faces.push(new Ke.Face3(S,C,T,[L,M,P])),this.uvs.push([I,R,D])}for(a=0;a<s;a++){var b=u[o][a+1],S=u[o][a],C=u.length-1,E=new Ke.Vec3(0,(-1),0),L=new Ke.Vec3(0,(-1),0),M=new Ke.Vec3(0,(-1),0),k=f[o][a+1].clone(),I=f[o][a].clone(),R=new Ke.Vec2(I.u,1);this.faces.push(new Ke.Face3(b,S,C,[E,L,M])),this.uvs.push([k,I,R])}return this},Ke.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},Ke.extend(Ke.Arrow,Ke.Entity,{}),Ke.BufferNode=function(){this.uuid=Ke.Math.generateUUID(),this.name="",this.attributes={},this.dynamic=!0,this.offsets=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.morphTargets=[],this.materialSize=1,this.createMaterial(),Ke.Node.call(this)},Ke.extend(Ke.BufferNode,Ke.Node,{constructor:Ke.BufferNode,compuateBufferData:function(){if(!this.computed){var t=this.attributes.position;t&&t.array&&(t.itemSize=3,t.numItems=t.array.length,this.verticesNeedUpdate=!0);var e=this.attributes.uv;e&&e.array&&(e.itemSize=2,e.numItems=e.array.length,this.uvsNeedUpdate=!0);var i=this.attributes.index;i&&i.array&&(this.offsets=[{index:0,start:0,count:i.array.length}]),this.computed=!0}},applyMatrix:function(t){var i,n;if(this.attributes.position&&(i=this.attributes.position.array),this.attributes.normal&&(n=this.attributes.normal.array),i!==e&&(t.multiplyVec3Array(i),this.verticesNeedUpdate=!0),n!==e){var s=(new Ke.Matrix3).getNormalMatrix(t);s.multiplyVec3Array(n),this.normalizeNormals(),this.normalsNeedUpdate=!0}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ke.BoundingBox);var t=this.attributes.position.array;if(t){var i,n,s,r=this.boundingBox;t.length>=3&&(r.min.x=r.max.x=t[0],r.min.y=r.max.y=t[1],r.min.z=r.max.z=t[2]);for(var a=3,o=t.length;a<o;a+=3)i=t[a],n=t[a+1],s=t[a+2],i<r.min.x?r.min.x=i:i>r.max.x&&(r.max.x=i),n<r.min.y?r.min.y=n:n>r.max.y&&(r.max.y=n),s<r.min.z?r.min.z=s:s>r.max.z&&(r.max.z=s)}t!==e&&0!==t.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){var t=new Ke.BoundingBox,e=new Ke.Vec3;return function(){null===this.boundingSphere&&(this.boundingSphere=new Ke.BoundingSphere);var i=this.attributes.position.array;if(i){for(var n=this.boundingSphere.center,s=[],r=0,a=i.length;r<a;r+=3)e.set(i[r],i[r+1],i[r+2]),s.push(e);t.setFromPoints(s),t.center(n);for(var o=0,r=0,a=i.length;r<a;r+=3)e.set(i[r],i[r+1],i[r+2]),o=Math.max(o,n.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(o)}}}(),computeVertexNormals:function(){if(this.attributes.position){var t,i,n,s,r=this.attributes.position.array.length;if(this.attributes.normal===e)this.attributes.normal={itemSize:3,array:new Float32Array(r)};else for(t=0,i=this.attributes.normal.array.length;t<i;t++)this.attributes.normal.array[t]=0;var a,o,h,l,c,u,d=this.attributes.position.array,f=this.attributes.normal.array,g=new Ke.Vec3,_=new Ke.Vec3,p=new Ke.Vec3,v=new Ke.Vec3,m=new Ke.Vec3;if(this.attributes.index){var y=this.attributes.index.array,A=this.offsets;for(n=0,s=A.length;n<s;++n){var x=A[n].start,w=A[n].count,b=A[n].index;for(t=x,i=x+w;t<i;t+=3)a=b+y[t],o=b+y[t+1],h=b+y[t+2],l=d[3*a],c=d[3*a+1],u=d[3*a+2],g.set(l,c,u),l=d[3*o],c=d[3*o+1],u=d[3*o+2],_.set(l,c,u),l=d[3*h],c=d[3*h+1],u=d[3*h+2],p.set(l,c,u),v.subVectors(p,_),m.subVectors(g,_),v.cross(m),f[3*a]+=v.x,f[3*a+1]+=v.y,f[3*a+2]+=v.z,f[3*o]+=v.x,f[3*o+1]+=v.y,f[3*o+2]+=v.z,f[3*h]+=v.x,f[3*h+1]+=v.y,f[3*h+2]+=v.z}}else for(t=0,i=d.length;t<i;t+=9)l=d[t],c=d[t+1],u=d[t+2],g.set(l,c,u),l=d[t+3],c=d[t+4],u=d[t+5],_.set(l,c,u),l=d[t+6],c=d[t+7],u=d[t+8],p.set(l,c,u),v.subVectors(p,_),m.subVectors(g,_),v.cross(m),f[t]=v.x,f[t+1]=v.y,f[t+2]=v.z,f[t+3]=v.x,f[t+4]=v.y,f[t+5]=v.z,f[t+6]=v.x,f[t+7]=v.y,f[t+8]=v.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var t,e,i,n,s=this.attributes.normal.array,r=0,a=s.length;r<a;r+=3)t=s[r],e=s[r+1],i=s[r+2],n=1/Math.sqrt(t*t+e*e+i*i),s[r]*=n,s[r+1]*=n,s[r+2]*=n},computeTangents:function(){function t(t,e,i){f=s[3*t],g=s[3*t+1],_=s[3*t+2],p=s[3*e],v=s[3*e+1],m=s[3*e+2],y=s[3*i],A=s[3*i+1],x=s[3*i+2],w=a[2*t],b=a[2*t+1],S=a[2*e],C=a[2*e+1],T=a[2*i],E=a[2*i+1],L=p-f,M=y-f,P=v-g,k=A-g,I=m-_,R=x-_,D=S-w,B=T-w,N=C-b,z=E-b,O=1/(D*z-B*N),Z.set((z*L-N*M)*O,(z*P-N*k)*O,(z*I-N*R)*O),Y.set((D*M-B*L)*O,(D*k-B*P)*O,(D*R-B*I)*O),c[t].add(Z),c[e].add(Z),c[i].add(Z),u[t].add(Y),u[e].add(Y),u[i].add(Y)}function i(t){nt.x=r[3*t],nt.y=r[3*t+1],nt.z=r[3*t+2],st.copy(nt),$=c[t],et.copy($),et.sub(nt.multiplyScalar(nt.dot($))).normalize(),it.crossVectors(st,$),tt=it.dot(u[t]),J=tt<0?-1:1,l[4*t]=et.x,l[4*t+1]=et.y,l[4*t+2]=et.z,l[4*t+3]=J}if(this.attributes.index===e||this.attributes.position===e||this.attributes.normal===e||this.attributes.uv===e)return void console.warn("Missing required attributes (index, position, normal or uv) in BufferNode.computeTangents()");var n=this.attributes.index.array,s=this.attributes.position.array,r=this.attributes.normal.array,a=this.attributes.uv.array,o=s.length/3;if(this.attributes.tangent===e){var h=4*o;this.attributes.tangent={itemSize:4,array:new Float32Array(h)}}for(var l=this.attributes.tangent.array,c=[],u=[],d=0;d<o;d++)c[d]=new Ke.Vec3,u[d]=new Ke.Vec3;var f,g,_,p,v,m,y,A,x,w,b,S,C,T,E,L,M,P,k,I,R,D,B,N,z,O,F,V,U,H,W,X,G,Z=new Ke.Vec3,Y=new Ke.Vec3,j=this.offsets;for(U=0,H=j.length;U<H;++U){var q=j[U].start,K=j[U].count,Q=j[U].index;for(F=q,V=q+K;F<V;F+=3)W=Q+n[F],X=Q+n[F+1],G=Q+n[F+2],t(W,X,G)}var J,$,tt,et=new Ke.Vec3,it=new Ke.Vec3,nt=new Ke.Vec3,st=new Ke.Vec3;for(U=0,H=j.length;U<H;++U){var q=j[U].start,K=j[U].count,Q=j[U].index;for(F=q,V=q+K;F<V;F+=3)W=Q+n[F],X=Q+n[F+1],G=Q+n[F+2],i(W),i(X),i(G)}this.hasTangents=!0,this.tangentsNeedUpdate=!0},clone:function(){var t=new Ke.BufferNode,e=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var i in this.attributes){for(var n=this.attributes[i],s=n.array,r={itemSize:n.itemSize,numItems:n.numItems,array:null},a=0,o=e.length;a<o;a++){var h=e[a];if(s instanceof h){r.array=new h(s);break}}t.attributes[i]=r}for(var a=0,o=this.offsets.length;a<o;a++){var l=this.offsets[a];t.offsets.push({start:l.start,index:l.index,count:l.count})}return t},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Ke.Particle=function(t,e,i){var n;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])&&(n=arguments[0],this._id=n.id),Ke.Node.call(this,this._id),this.material=new Ke.ParticleMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.frustumCulled=!1,this.vertices=(n?n.vertices:t)||[],this.colors=(n?n.colors:e)||[],this.sizes=(n?n.sizes:i)||[],this.setUpdateFlags(!0)},Ke.extend(Ke.Particle,Ke.Node,{clone:function(t){return t===e&&(t=new Ke.Particle(this.material)),t.sortParticles=this.sortParticles,t.frustumCulled=this.frustumCulled,Ke.Element.prototype.clone.call(this,t),t},needUpdate:function(){return!1},setUpdateFlags:function(t){this.verticesNeedUpdate=t,this.dirtyColors=t,this.normalsNeedUpdate=t},setMaterialStyle:function(t,e){t=t.substr(t.indexOf(".")+1),this._A97(this.material,t,e)}}),Ke.Line=function(){var t,i,n;if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var s=arguments[0];t=s.vertices,i=s.colors,n=s.type,this._id=s.id||this._id}else t=arguments[0],i=arguments[1],n=arguments[2];Ke.Node.call(this,this._id),this.material=new Ke.LineMaterial({color:16777215}),this.type=n!==e?n:Ke.LineStrip,this.vertices=t||[],this.colors=i||[]},Ke.LineStrip=0,Ke.LinePieces=1,Ke.extend(Ke.Line,Ke.Node,{className:"TGL.Line",__accessor:["vertices","type"],__SizePropeties:["vertices","type"],clone:function(t){return t===e&&(t=new Ke.Line(this.material,this.type)),Ke.Element.prototype.clone.call(this,t,!0),t},onPropertyChange:function(){},setMaterialStyle:function(t,e){t=t.substr(t.indexOf(".")+1),this._A97(this.material,t,e)},setMaterialStyles:function(t){Ke.Element.prototype.setMaterialStyles.call(this,t)}}),Ke.Line.createEllipse=function(t,e,i,n,s,r,a){"number"==typeof t?(a=r,r=s,s=n,n=i,i=e,e=t,t=new Ke.Line):null==t&&(t=new Ke.Line);for(var o=new Ke.EllipseCurve(0,0,e,i,s,r,a),h=[],l=n||50,c=0;c<=l;c++){var u=o.getPoint(c/l);h.push(u)}return t.setVertices(h),t},Ke.Line.createHelix=function(t,e,i,n,s,r){"number"==typeof t?(r=s,s=n,n=i,i=e,e=t,t=new Ke.Line):null==t&&(t=new Ke.Line);var a=[],o=r||50;s=s||1;for(var h,l,c,u,d=0;d<=o;d++)h=(i*d+e*(o-d))/o,c=s*Math.PI*2*d/o,l=n*(.5-d/o),u=new Je(h*Math.sin(c),l,h*Math.cos(c)),a.push(u);return t.setVertices(a),t},Ke.Line.createRectangle=function(t,e,i,n){"number"==typeof t?(n=i,i=e,e=t,t=new Ke.Line):null==t&&(t=new Ke.Line);var s=n||50,r=2*(e+i)/s,a=[];if(r>Math.min(e,i))a.push(new Je(-e/2,-i/2,0)),a.push(new Je(-e/2,i/2,0)),a.push(new Je(e/2,i/2,0)),a.push(new Je(e/2,-i/2,0)),a.push(new Je(-e/2,-i/2,0));else for(var o,h=-e/2,l=-i/2,c=0;c<=s;c++)h==-e/2&&l<i/2?l+r<=i/2?l+=r:(a.push(new Je(-e/2,i/2,0)),a.push(new Je(-e/2,i/2,0)),h+=l+r-i/2,l=i/2):l==i/2&&h<=e/2?h+r<=e/2?h+=r:(a.push(new Je(e/2,i/2,0)),a.push(new Je(e/2,i/2,0)),l-=h+r-e/2,h=e/2):h==e/2&&l>-i/2?l-r>=-i/2?l-=r:(a.push(new Je(e/2,-i/2,0)),a.push(new Je(e/2,-i/2,0)),h-=-i/2-l+r,l=-i/2):l==-i/2&&h>=-e/2&&(h-r>=-e/2?h-=r:(l+=-e/2-h+r,h=-e/2)),o=new Je(h,l,0),a.push(o);return t.setVertices(a),t},Ke.PathLine=function(){var t,e,i;if(1===arguments.length&&arguments[0]instanceof Object&&!(arguments[0]instanceof Ke.Path)){var n=arguments[0];t=n.path,e=n.segments,i=n.type,this._id=n.id||this._id}else t=arguments[0],e=arguments[1],i=arguments[2],this._id=arguments[3];Ke.Line.call(this,{vertices:[],colors:[],type:i,id:this._id}),this.segments=e||20,this.setPath(t)},Ke.extend(Ke.PathLine,Ke.Line,{constructor:Ke.PathLine,className:"TGL.PathLine",__accessor:["path","segments"],__SizePropeties:["path","segments"],onPropertyChange:function(){this.computeNodeData()},computeNodeData:function(){this.computeData()},adjustPath:function(t){return t},computeData:function(){var t=this.path;if(t){t=this.adjustPath(t);var e,i,n,s,r=t.curves.length,a=t.curves,o=[],h=t.getLength(),l=0,c=this.segments;for(_=0;_<r;_++){if(i=a[_],n=i.getLength(),i instanceof Ke.LineCurve3){var u=l/h,d=(n+l)/h;o.push(u),o.push(d)}else for(s=_>0?1:0;s<=c;s++){var f=(n*s/c+l)/h;o.push(f)}l+=n}for(var g=[],_=0;_<o.length;_++)e=o[_],pos=t.getPointAt(e),g.push(pos);return this.vertices=g,[]}}}),Ke.Polyhedron=function(){function t(t){var e=t.normalize().clone();e.index=c.vertices.push(e)-1;var i=n(t)/2/Math.PI+.5,r=s(t)/Math.PI+.5;return e.uv=new Ke.Vec3(i,1-r),e}function e(t,e,i){var s=new Ke.Face3(t.index,e.index,i.index,[t.clone(),e.clone(),i.clone()]);s.centroid.add(t).add(e).add(i).divideScalar(3),c.faces.push(s);var a=n(s.centroid);c.uvs.push([r(t.uv,t,a),r(e.uv,e,a),r(i.uv,i,a)])}function i(i,n){for(var s=Math.pow(2,n),r=(Math.pow(4,n),t(c.vertices[i.a])),a=t(c.vertices[i.b]),o=t(c.vertices[i.c]),h=[],l=0;l<=s;l++){h[l]=[];for(var u=t(r.clone().lerp(o,l/s)),d=t(a.clone().lerp(o,l/s)),f=s-l,g=0;g<=f;g++)0==g&&l==s?h[l][g]=u:h[l][g]=t(u.clone().lerp(d,g/f))}for(var l=0;l<s;l++)for(var g=0;g<2*(s-l)-1;g++){var _=Math.floor(g/2);g%2==0?e(h[l][_+1],h[l+1][_],h[l][_]):e(h[l][_+1],h[l+1][_+1],h[l+1][_])}}function n(t){return Math.atan2(t.z,-t.x)}function s(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}function r(t,e,i){return i<0&&1===t.x&&(t=new Ke.Vec3(t.x-1,t.y)),0===e.x&&0===e.z&&(t=new Ke.Vec3(i/2/Math.PI+.5,t.y)),t.clone()}var a,o,h,l;arguments[0]instanceof Ke.Material?(this.material=arguments[0],a=arguments[1],o=arguments[2],h=arguments[3],l=arguments[4]):(a=arguments[0],o=arguments[1],h=arguments[2],l=arguments[3]),this.materialSize=1,Ke.Entity.call(this),h=h||1,l=l||0;for(var c=this,u=0,d=a.length;u<d;u++)t(new Ke.Vec3(a[u][0],a[u][1],a[u][2]));for(var f=this.vertices,g=[],u=0,d=o.length;u<d;u++){var _=f[o[u][0]],p=f[o[u][1]],v=f[o[u][2]];g[u]=new Ke.Face3(_.index,p.index,v.index,[_.clone(),p.clone(),v.clone()])}for(var u=0,d=g.length;u<d;u++)i(g[u],l);for(var u=0,d=this.uvs.length;u<d;u++){var m=this.uvs[u],y=m[0].x,A=m[1].x,x=m[2].x,w=Math.max(y,Math.max(A,x)),b=Math.min(y,Math.min(A,x));w>.9&&b<.1&&(y<.2&&(m[0].x+=1),A<.2&&(m[1].x+=1),x<.2&&(m[2].x+=1))}for(var u=0,d=this.vertices.length;u<d;u++)this.vertices[u].multiplyScalar(h);this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new Ke.BoundingSphere(new Ke.Vec3,h)},Ke.extend(Ke.Polyhedron,Ke.Entity,{}),Ke.Octahedron=function(t,e,i){var n=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],s=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];Ke.Polyhedron.call(this,t,n,s,e,i)},Ke.extend(Ke.Octahedron,Ke.Polyhedron,{clone:function(){return new Ke.Octahedron(this.material,this.radius,this.detail)}}),Ke.Axis=function(t){t=t||1;var e=[],i=[];e.push(new Ke.Vec3,new Ke.Vec3(t,0,0),new Ke.Vec3,new Ke.Vec3(0,t,0),new Ke.Vec3,new Ke.Vec3(0,0,t)),i.push(new Ke.Color(16711680),new Ke.Color(16711680),new Ke.Color(65280),new Ke.Color(65280),new Ke.Color(255),new Ke.Color(255));var n=new Ke.LineMaterial({vertexColors:Ke.VertexColors,depthTest:!1,depthMask:!1});Ke.Line.call(this,e,i,Ke.LinePieces),this.material=n,this.xAxisText=this.makeAxisText("X",16711680),this.yAxisText=this.makeAxisText("Y",65280),this.zAxisText=this.makeAxisText("Z",255),this.xAxisText.setParent(this),this.yAxisText.setParent(this),this.zAxisText.setParent(this),this.setSize(t),this._sizeFixed=!0},Ke.extend(Ke.Axis,Ke.Line,{showAxisText:function(t){this.xAxisText._visible=t,this.yAxisText._visible=t,this.zAxisText._visible=t},setSize:function(t){this.vertices[1].x=t,this.vertices[3].y=t,this.vertices[5].z=t,this.xAxisText.setPosition(t,0,0),this.yAxisText.setPosition(0,t,0),this.zAxisText.setPosition(0,0,t)},fixSize:function(t){Ke.Element.prototype.fixSize.call(this,t);this._scale.x,this._scale.y,this._scale.z;this.xAxisText.setScale(3,3,1),this.yAxisText.setScale(3,3,1),this.zAxisText.setScale(3,3,1)},makeAxisText:function(t,e){var i="Arial",n=36,s=Ke.BillboardAlignment.topLeft,r=document.createElement("canvas"),a=r.getContext("2d");a.font="Bold "+n+"px "+i,e instanceof Ke.Color||(e=new Ke.Color(e));var o=a.measureText(t),h=o.width;r.width=yi.nextPowerOfTwo(h),r.height=yi.nextPowerOfTwo(2*a.measureText("e").width+4),a.fillStyle="rgba("+255*e.r+", "+255*e.g+", "+255*e.b+", 1.0)",a.fillText(t,0,10);var l=new Ke.Texture(r),c=new Ke.BillboardMaterial({map:l,useScreenCoordinates:!1,alignment:s,depthTest:!1,depthMask:!1}),u=new Ke.Billboard;return u.material=c,u}}),Ke.Curve=function(){},Ke.Curve.prototype.getPoint=function(t){return console.log("Warning, getPoint() not implemented!"),null},Ke.Curve.prototype.getPointAt=function(t){var e=this.getUtoTmapping(t);return this.getPoint(e)},Ke.Curve.prototype.getPoints=function(t){t||(t=5);var e,i=[];for(e=0;e<=t;e++)i.push(this.getPoint(e/t));return i},Ke.Curve.prototype.getSpacedPoints=function(t){t||(t=5);var e,i=[];for(e=0;e<=t;e++)i.push(this.getPointAt(e/t));return i},Ke.Curve.prototype.getLength=function(){var t=this.getLengths();return t[t.length-1]},Ke.Curve.prototype.getLengths=function(t){if(t||(t=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,i,n=[],s=this.getPoint(0),r=0;for(n.push(0),i=1;i<=t;i++)e=this.getPoint(i/t),r+=e.distanceTo(s),n.push(r),s=e;return this.cacheArcLengths=n,n},Ke.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},Ke.Curve.prototype.getUtoTmapping=function(t,e){var i,n=this.getLengths(),s=0,r=n.length;i=e?e:t*n[r-1];for(var a,o=0,h=r-1;o<=h;)if(s=Math.floor(o+(h-o)/2),a=n[s]-i,a<0)o=s+1;else{if(!(a>0)){h=s;break}h=s-1}if(s=h,n[s]==i){var l=s/(r-1);return l}var c=n[s],u=n[s+1],d=u-c,f=(i-c)/d,l=(s+f)/(r-1);return l},Ke.Curve.prototype.getTangent=function(t){var e=1e-4,i=t-e,n=t+e;i<0&&(i=0),n>1&&(n=1);var s=this.getPoint(i),r=this.getPoint(n),a=r.clone().sub(s);return a.normalize()},Ke.Curve.prototype.getTangentAt=function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},Ke.Curve.Utils={tangentQuadraticBezier:function(t,e,i,n){return 2*(1-t)*(i-e)+2*t*(n-i)},tangentCubicBezier:function(t,e,i,n,s){return-3*e*(1-t)*(1-t)+3*i*(1-t)*(1-t)-6*t*i*(1-t)+6*t*n*(1-t)-3*t*t*n+3*t*t*s},tangentSpline:function(t,e,i,n,s){var r=6*t*t-6*t,a=3*t*t-4*t+1,o=-6*t*t+6*t,h=3*t*t-2*t;return r+a+o+h},interpolate:function(t,e,i,n,s){var r=.5*(i-t),a=.5*(n-e),o=s*s,h=s*o;return(2*e-2*i+r+a)*h+(-3*e+3*i-2*r-a)*o+r*s+e}},Ke.Curve.create=function(t,e){return t.prototype=Object.create(Ke.Curve.prototype),t.prototype.getPoint=e,t},Ke.LineCurve=function(t,e){this.v1=t,this.v2=e},Ke.LineCurve.prototype=Object.create(Ke.Curve.prototype),Ke.LineCurve.prototype.getPoint=function(t){var e=this.v2.clone().sub(this.v1);return e.multiplyScalar(t).add(this.v1),e},Ke.LineCurve.prototype.getPointAt=function(t){return this.getPoint(t)},Ke.LineCurve.prototype.getTangent=function(t){var e=this.v2.clone().sub(this.v1);return e.normalize()},Ke.LineCurve3=function(t,e){this.v1=t,this.v2=e,this.getPoint=function(t){var e=new Ke.Vec3;return e.subVectors(this.v2,this.v1),e.multiplyScalar(t),e.add(this.v1),e}},Ke.extend(Ke.LineCurve3,Ke.Curve,{}),Ke.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},Ke.CurvePath.prototype=Object.create(Ke.Curve.prototype),Ke.CurvePath.prototype.add=function(t){this.curves.push(t)},Ke.CurvePath.prototype.checkConnection=function(){},Ke.CurvePath.prototype.closePath=function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Ke.LineCurve3(e,t))},Ke.CurvePath.prototype.getPoint=function(t){for(var e,i,n=t*this.getLength(),s=this.getCurveLengths(),r=0;r<s.length;){if(s[r]>=n){e=s[r]-n,i=this.curves[r];var a=1-e/i.getLength();return i.getPointAt(a)}r++}return null},Ke.CurvePath.prototype.getLength=function(){var t=this.getCurveLengths();return t[t.length-1]},Ke.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var t,e=[],i=0,n=this.curves.length;for(t=0;t<n;t++)i+=this.curves[t].getLength(),e.push(i);return this.cacheLengths=e,e},Ke.CurvePath.prototype.getBoundingBox=function(){var t,e,i,n,s,r,a=this.getPoints();t=e=Number.NEGATIVE_INFINITY,n=s=Number.POSITIVE_INFINITY;var o,h,l,c,u=a[0]instanceof Ke.Vec3;for(c=u?new Ke.Vec3:new Ke.Vec2,h=0,l=a.length;h<l;h++)o=a[h],o.x>t?t=o.x:o.x<n&&(n=o.x),o.y>e?e=o.y:o.y<s&&(s=o.y),u&&(o.z>i?i=o.z:o.z<r&&(r=o.z)),c.add(o);var d={minX:n,minY:s,maxX:t,maxY:e,centroid:c.divideScalar(l)};return u&&(d.maxZ=i,d.minZ=r),d},Ke.CurvePath.prototype.createPointsGeometry=function(t){var e=this.getPoints(t,!0);return this.createGeometry(e)},Ke.CurvePath.prototype.createSpacedPointsGeometry=function(t){var e=this.getSpacedPoints(t,!0);return this.createGeometry(e)},Ke.CurvePath.prototype.createGeometry=function(t){for(var e=new Ke.Geometry,i=0;i<t.length;i++)e.vertices.push(new Ke.Vec3(t[i].x,t[i].y,t[i].z||0));return e},Ke.CurvePath.prototype.addWrapPath=function(t){this.bends.push(t)},Ke.CurvePath.prototype.getTransformedPoints=function(t,e){var i,n,s=this.getPoints(t);for(e||(e=this.bends),i=0,n=e.length;i<n;i++)s=this.getWrapPoints(s,e[i]);return s},Ke.CurvePath.prototype.getTransformedSpacedPoints=function(t,e){var i,n,s=this.getSpacedPoints(t);for(e||(e=this.bends),i=0,n=e.length;i<n;i++)s=this.getWrapPoints(s,e[i]);return s},Ke.CurvePath.prototype.getWrapPoints=function(t,e){var i,n,s,r,a,o,h=this.getBoundingBox();for(i=0,n=t.length;i<n;i++){s=t[i],r=s.x,a=s.y,o=r/h.maxX,o=e.getUtoTmapping(o,r);var l=e.getPoint(o),c=e.getTangent(o);c.set(-c.y,c.x).multiplyScalar(a),s.x=l.x+c.x,s.y=l.y+c.y}return t},Ke.EllipseCurve=function(t,e,i,n,s,r,a){this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=s||0,this.aEndAngle=r||2*Math.PI,this.aClockwise=a},Ke.EllipseCurve.prototype=Object.create(Ke.Curve.prototype),Ke.EllipseCurve.prototype.getPoint=function(t){var e,i=this.aEndAngle-this.aStartAngle;i<0&&(i+=2*Math.PI),i>2*Math.PI&&(i-=2*Math.PI),e=this.aClockwise===!0?this.aEndAngle+(1-t)*(2*Math.PI-i):this.aStartAngle+t*i;var n=this.aX+this.xRadius*Math.cos(e),s=this.aY+this.yRadius*Math.sin(e);return new Ke.Vec3(n,s,0)},Ke.ArcCurve=function(t,e,i,n,s,r){Ke.EllipseCurve.call(this,t,e,i,i,n,s,r)},Ke.ArcCurve.prototype=Object.create(Ke.EllipseCurve.prototype),Ke.Path=function(t){Ke.CurvePath.call(this),this.actions=[],this.points=[],t&&this.fromPoints(t)},Ke.extend(Ke.Path,Ke.CurvePath,{constructor:Ke.Path,className:"TGL.Path",serializeJsonValue:function(){return{actions:this.actions,"class":"TGL.Path"}},deserializeJsonValue:function(t){var e,i,n,s;for(s=0;s<t.actions.length;s++)i=t.actions[s],e=i.action,n=i.args,this[e].apply(this,n)}}),Ke.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"curveTo",BEZIER_CURVE_TO:"bCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},Ke.Path.prototype.fromPoints=function(t){this.moveTo(t[0].x,t[0].y,t[0].z);for(var e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y,t[e].z)},Ke.Path.prototype.closePath=function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.lineTo(t.x,t.y,t.z)},Ke.Path.prototype.reverse=function(){var t,e,i,n,s,r=new Ke.Path,a=this.actions.length;for(t=a-1;t>=0;t--){if(e=this.actions[t].args,i=e.length,t===a-1&&r.moveTo(e[i-3],e[i-2],e[i-1]),null!=n)switch(s){case Ke.PathActions.MOVE_TO:r.moveTo(e[i-3],e[i-2],e[i-1]);break;case Ke.PathActions.LINE_TO:r.lineTo(e[i-3],e[i-2],e[i-1]);break;case Ke.PathActions.QUADRATIC_CURVE_TO:r.quadraticCurveTo(n[0],n[1],n[2],e[i-3],e[i-2],e[i-1]);break;case Ke.PathActions.BEZIER_CURVE_TO:r.bezierCurveTo(n[3],n[4],n[5],n[0],n[1],n[2],e[i-3],e[i-2],e[i-1])}n=e,s=this.actions[t].action}return r},Ke.Path.prototype.moveTo=function(t,e,i){t=t||0,e=e||0,i=i||0;var n=Array.prototype.slice.call(arguments);this.actions.push({action:Ke.PathActions.MOVE_TO,args:n}),this.points.push(new Je(t,e,i))},Ke.Path.prototype.lineTo=function(t,e,i){if(t=t||0,e=e||0,i=i||0,this.actions&&1===this.actions.length){var n=this.actions[0].args;n[0]===t&&n[1]===e&&n[2]===i&&(console.log("TGL.Path:lineTo the same point of moveTo"),t+=.01)}var n=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,r=s[s.length-3],a=s[s.length-2],o=s[s.length-1],h=new Ke.LineCurve3(new Ke.Vec3(r,a,o),new Ke.Vec3(t,e,i));this.curves.push(h),this.actions.push({action:Ke.PathActions.LINE_TO,args:n}),this.points.push(new Je(t,e,i))},Ke.Path.prototype.quadraticCurveTo=function(t,e,i,n,s,r){if(t=t||0,e=e||0,i=i||0,n=n||0,s=s||0,r=r||0,this.actions&&1===this.actions.length){var a=this.actions[0].args;a[0]===n&&a[1]===s&&a[2]===r&&(console.log("TGL.Path:quadraticCurveTo the same point of moveTo"),n=.01)}var a=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,h=o[o.length-3],l=o[o.length-2],c=o[o.length-1],u=new Ke.QuadraticBezierCurve3(new Ke.Vec3(h,l,c),new Ke.Vec3(t,e,i),new Ke.Vec3(n,s,r));this.curves.push(u),this.actions.push({action:Ke.PathActions.QUADRATIC_CURVE_TO,args:a}),this.points.push(new Je(n,s,r))},Ke.Path.prototype.curveTo=Ke.Path.prototype.quadraticCurveTo,Ke.Path.prototype.bezierCurveTo=function(t,e,i,n,s,r,a,o,h){var l=Array.prototype.slice.call(arguments),c=this.actions[this.actions.length-1].args,u=c[c.length-3],d=c[c.length-2],f=c[c.length-1],g=new Ke.CubicBezierCurve3(new Ke.Vec3(u,d,f),new Ke.Vec3(t,e,i),new Ke.Vec3(n,s,r),new Ke.Vec3(a,o,h));this.curves.push(g),this.actions.push({action:Ke.PathActions.BEZIER_CURVE_TO,args:l}),this.points.push(new Je(a,o,h))},Ke.Path.prototype.isClockwise=function(){if(this.points.length<2)return e;if(this.points.length<3){var t=this.points[0],i=this.points[1];return i.x>t.x}return Ke.Math.isClockwise(this.points)},Ke.Path.prototype.bCurveTo=Ke.Path.prototype.bezierCurveTo,Ke.Path.prototype.splineThru=function(t){var e=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,n=i[i.length-2],s=i[i.length-1],r=[new Ke.Vec2(n,s)];Array.prototype.push.apply(r,t);var a=new Ke.SplineCurve(r);this.curves.push(a),this.actions.push({action:Ke.PathActions.CSPLINE_THRU,args:e})},Ke.Path.prototype.arc=function(t,e,i,n,s,r){var a=this.actions[this.actions.length-1].args,o=a[a.length-2],h=a[a.length-1];this.absarc(t+o,e+h,i,n,s,r)},Ke.Path.prototype.absarc=function(t,e,i,n,s,r){this.absellipse(t,e,i,i,n,s,r)},Ke.Path.prototype.ellipse=function(t,e,i,n,s,r,a){var o=this.actions[this.actions.length-1].args,h=o[o.length-2],l=o[o.length-1];this.absellipse(t+h,e+l,i,n,s,r,a)},Ke.Path.prototype.absellipse=function(t,e,i,n,s,r,a){var o=Array.prototype.slice.call(arguments),h=new Ke.EllipseCurve(t,e,i,n,s,r,a);this.curves.push(h);var l=h.getPoint(1);o.push(l.x),o.push(l.y),this.actions.push({action:Ke.PathActions.ELLIPSE,args:o})},Ke.Path.prototype.toArray=function(){var t,e=this.actions.length,i=[];for(t=0;t<e;t++){var n=this.actions[t];"moveTo"===n.action?(i.push("m"),i.push(n.args[0]),i.push(n.args[1]),i.push(n.args[2])):"lineTo"===n.action?(i.push("l"),i.push(n.args[0]),i.push(n.args[1]),i.push(n.args[2])):"curveTo"===n.action&&(i.push("c"),i.push(n.args[0]),i.push(n.args[1]),i.push(n.args[2]),i.push(n.args[3]),i.push(n.args[4]),i.push(n.args[5]))}return i},Ke.Path.prototype.getSpacedPoints=function(t,e){t||(t=40);for(var i=[],n=0;n<t;n++)i.push(this.getPoint(n/t));return i},Ke.Path.prototype.getPoints=function(t,e){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(t,e);t=t||12;var i,n,s,r,a,o,h,l,c,u,d,f,g,_,p,v,m,y,A,x,w,b,S=[];for(i=0,n=this.actions.length;i<n;i++)switch(s=this.actions[i],r=s.action,a=s.args,r){case Ke.PathActions.MOVE_TO:S.push(new Ke.Vec3(a[0],a[1],a[2]));break;case Ke.PathActions.LINE_TO:S.push(new Ke.Vec3(a[0],a[1],a[2]));break;case Ke.PathActions.QUADRATIC_CURVE_TO:for(o=a[3],h=a[4],l=a[5],f=a[0],g=a[1],_=a[2],S.length>0?(y=S[S.length-1],p=y.x,v=y.y,m=y.z):(y=this.actions[i-1].args,p=y[y.length-3],v=y[y.length-2],m=y[y.length-1]),A=1;A<=t;A++)x=A/t,w=Ke.Shape.Utils.b2(x,p,f,o),b=Ke.Shape.Utils.b2(x,v,g,h),tz=Ke.Shape.Utils.b2(x,m,_,l),S.push(new Ke.Vec3(w,b,tz));break;case Ke.PathActions.BEZIER_CURVE_TO:for(o=a[6],h=a[7],l=a[8],f=a[0],g=a[1],_=a[2],c=a[3],u=a[4],d=a[5],S.length>0?(y=S[S.length-1],p=y.x,v=y.y,m=y.z):(y=this.actions[i-1].args,p=y[y.length-3],v=y[y.length-2],m=y[y.length-1]),A=1;A<=t;A++)x=A/t,w=Ke.Shape.Utils.b3(x,p,f,c,o),b=Ke.Shape.Utils.b3(x,v,g,u,h),tz=Ke.Shape.Utils.b3(x,m,_,d,l),S.push(new Ke.Vec3(w,b,tz));break;case Ke.PathActions.CSPLINE_THRU:y=this.actions[i-1].args;var C=new Ke.Vec2(y[y.length-2],y[y.length-1]),T=[C],E=t*a[0].length;T=T.concat(a[0]);var L=new Ke.SplineCurve(T);for(A=1;A<=E;A++)S.push(L.getPointAt(A/E));break;case Ke.PathActions.ARC:var M,P=a[0],k=a[1],I=a[2],R=a[3],D=a[4],B=!!a[5],N=D-R,z=2*t;for(A=1;A<=z;A++)x=A/z,B||(x=1-x),M=R+x*N,w=P+I*Math.cos(M),b=k+I*Math.sin(M),S.push(new Ke.Vec3(w,b));break;case Ke.PathActions.ELLIPSE:var M,P=a[0],k=a[1],O=a[2],F=a[3],R=a[4],D=a[5],B=!!a[6],N=D-R,z=2*t;for(A=1;A<=z;A++)x=A/z,B||(x=1-x),M=R+x*N,w=P+O*Math.cos(M),b=k+F*Math.sin(M),S.push(new Ke.Vec3(w,b))}var V=S[S.length-1],U=1e-10;return Math.abs(V.x-S[0].x)<U&&Math.abs(V.y-S[0].y)<U&&S.splice(S.length-1,1),e&&S.push(S[0]),S},Ke.Path.prototype.toShapes=function(t){var i,n,s,r,a,o=[],h=new Ke.Path;for(i=0,n=this.actions.length;i<n;i++)s=this.actions[i],a=s.args,r=s.action,r==Ke.PathActions.MOVE_TO&&0!=h.actions.length&&(o.push(h),h=new Ke.Path),h[r].apply(h,a);if(0!=h.actions.length&&o.push(h),0==o.length)return[];var l,c,u,d=[];if(1==o.length)return c=o[0],u=new Ke.Shape,u.actions=c.actions,u.curves=c.curves,d.push(u),d;var f=!Ke.Shape.Utils.isClockWise(o[0].getPoints());if(f=t?!f:f)for(u=new Ke.Shape,i=0,n=o.length;i<n;i++)c=o[i],l=Ke.Shape.Utils.isClockWise(c.getPoints()),l=t?!l:l,l?(u.actions=c.actions,u.curves=c.curves,d.push(u),u=new Ke.Shape):u.holes.push(c);else{for(u=e,i=0,n=o.length;i<n;i++)c=o[i],l=Ke.Shape.Utils.isClockWise(c.getPoints()),l=t?!l:l,l?(u&&d.push(u),u=new Ke.Shape,u.actions=c.actions,u.curves=c.curves):u.holes.push(c);d.push(u)}return d},Ke.Shape=function(){Ke.Path.apply(this,arguments),this.holes=[]},Ke.Shape.prototype=Object.create(Ke.Path.prototype),Ke.Shape.prototype.extrude=function(t){var e=new Ke.ShapeNode(this,t);return e},Ke.Shape.prototype.makeGeometry=function(t){var e=new Ke.ShapeGeometry(this,t);return e},Ke.Shape.prototype.getPointsHoles=function(t){var e,i=this.holes.length,n=[];for(e=0;e<i;e++)n[e]=this.holes[e].getTransformedPoints(t,this.bends);return n},Ke.Shape.prototype.getSpacedPointsHoles=function(t){var e,i=this.holes.length,n=[];for(e=0;e<i;e++)n[e]=this.holes[e].getTransformedSpacedPoints(t,this.bends);return n},Ke.Shape.prototype.extractAllPoints=function(t){return{shape:this.getTransformedPoints(t),holes:this.getPointsHoles(t)}},Ke.Shape.prototype.extractPoints=function(t){return this.useSpacedPoints?this.extractAllSpacedPoints(t):this.extractAllPoints(t)},Ke.Shape.prototype.extractAllSpacedPoints=function(t){return{shape:this.getTransformedSpacedPoints(t),holes:this.getSpacedPointsHoles(t)}},Ke.Shape.Utils={removeHoles:function(t,e){var i,n,s,r,a,o,h,l,c,u,d,f,g,_,p,v,m=t.concat(),y=m.concat(),A=[];for(a=0;a<e.length;a++){for(h=e[a],Array.prototype.push.apply(y,h),l=Number.POSITIVE_INFINITY,o=0;o<h.length;o++){d=h[o];var x=[];for(u=0;u<m.length;u++)f=m[u],c=d.distanceToSquared(f),x.push(c),c<l&&(l=c,s=o,r=u)}i=r-1>=0?r-1:m.length-1,n=s-1>=0?s-1:h.length-1;var w=[h[s],m[r],m[i]],b=Ke.FontUtils.Triangulate.area(w),S=[h[s],h[n],m[r]],C=Ke.FontUtils.Triangulate.area(S),T=1,E=-1,L=r,M=s;r+=T,s+=E,r<0&&(r+=m.length),r%=m.length,s<0&&(s+=h.length),s%=h.length,i=r-1>=0?r-1:m.length-1,n=s-1>=0?s-1:h.length-1,w=[h[s],m[r],m[i]];var P=Ke.FontUtils.Triangulate.area(w);S=[h[s],h[n],m[r]];var k=Ke.FontUtils.Triangulate.area(S);b+C>P+k&&(r=L,s=M,r<0&&(r+=m.length),r%=m.length,s<0&&(s+=h.length),s%=h.length,i=r-1>=0?r-1:m.length-1,n=s-1>=0?s-1:h.length-1),g=m.slice(0,r),_=m.slice(r),p=h.slice(s),v=h.slice(0,s);var I=[h[s],m[r],m[i]],R=[h[s],h[n],m[r]];A.push(I),A.push(R),m=g.concat(p).concat(v).concat(_)}return{shape:m,isolatedPts:A,allpoints:y}},triangulateShape:function(t,i){var n,s,r,a,o,h,l=Ke.Shape.Utils.removeHoles(t,i),c=l.shape,u=l.allpoints,d=l.isolatedPts,f=Ke.FontUtils.Triangulate(c,!1),g={};for(n=0,s=u.length;n<s;n++)o=u[n].x+":"+u[n].y,g[o]!==e&&console.log("Duplicate point",o),g[o]=n;for(n=0,s=f.length;n<s;n++)for(a=f[n],r=0;r<3;r++)o=a[r].x+":"+a[r].y,h=g[o],h!==e&&(a[r]=h);for(n=0,s=d.length;n<s;n++)for(a=d[n],r=0;r<3;r++)o=a[r].x+":"+a[r].y,h=g[o],h!==e&&(a[r]=h);return f.concat(d)},isClockWise:function(t){return Ke.FontUtils.Triangulate.area(t)<0},b2p0:function(t,e){var i=1-t;return i*i*e},b2p1:function(t,e){return 2*(1-t)*t*e},b2p2:function(t,e){return t*t*e},b2:function(t,e,i,n){return this.b2p0(t,e)+this.b2p1(t,i)+this.b2p2(t,n)},b3p0:function(t,e){var i=1-t;return i*i*i*e},b3p1:function(t,e){var i=1-t;return 3*i*i*t*e},b3p2:function(t,e){var i=1-t;return 3*i*t*t*e},b3p3:function(t,e){return t*t*t*e},b3:function(t,e,i,n,s){return this.b3p0(t,e)+this.b3p1(t,i)+this.b3p2(t,n)+this.b3p3(t,s)}},Ke.CubicBezierCurve3=Ke.Curve.create(function(t,e,i,n){this.v0=t,this.v1=e,this.v2=i,this.v3=n},function(t){var e,i,n;return e=Ke.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=Ke.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),n=Ke.Shape.Utils.b3(t,this.v0.z,this.v1.z,this.v2.z,this.v3.z),
new Ke.Vec3(e,i,n)}),Ke.QuadraticBezierCurve3=Ke.Curve.create(function(t,e,i){this.v0=t,this.v1=e,this.v2=i},function(t){var e,i,n;return e=Ke.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x),i=Ke.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y),n=Ke.Shape.Utils.b2(t,this.v0.z,this.v1.z,this.v2.z),new Ke.Vec3(e,i,n)}),Ke.PathNode=function(t,i,n,s,r,a,o,h,l,c){this.materialSize=1,this.closed=!1;var u;1===arguments.length&&arguments[0]instanceof Object&&!(arguments[0]instanceof Ke.Path)?(u=arguments[0],this.path=u.path,this.segments=u.segments||20,this.radius=u.radius||1,this.segmentsR=u.segmentsR||8,this.shape=u.shape,this.startCap=u.startCap||"plain",this.endCap=u.endCap||"plain",this.arc=u.arc!=e?u.arc:2*Math.PI,this.arcStart=u.arcStart!=e?u.arcStart:0,this.cutSurface=u.cutSurface||"none",this.startCapR=u.startCapR,this.endCapR=u.endCapR,this.startCapSize=u.startCapSize,this.endCapSize=u.endCapSize,this.binormal=u.binormal,this.startCapExtend=u.startCapExtend===e?1:u.startCapExtend,this.endCapExtend=u.endCapExtend===e?1:u.endCapExtend,this._id=u.id):(this.path=t,this.segments=i||20,this.radius=n||1,this.segmentsR=s||8,this.shape=o,this.startCap=r||"plain",this.endCap=a||"plain",this.arc=h!=e?h:2*Math.PI,this.arcStart=l!=e?l:0,this.cutSurface=c||"none"),this.shape instanceof Array&&(this.segmentsR=this.shape.length),this.startCapSize=this.startCapSize||1,this.endCapSize=this.endCapSize||1,this.segmentsCap=20,this.arc===2*Math.PI&&(this.cutSurface="none"),Ke.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},Ke.extend(Ke.PathNode,Ke.Entity,{constructor:Ke.PathNode,className:"TGL.PathNode",__accessor:["path","segments","radius","segmentsR","startCap","endCap","shape","startCapSize","endCapSize","segmentsCap","arc","arcStart","cutSurface","startCapR","endCapR","startCapExtend","endCapExtend","binormal"],__SizePropeties:["path","segments","radius","segmentsR","startCap","endCap","shape","startCapSize","endCapSize","segmentsCap","arc","arcStart","cutSurface","startCapR","endCapR","startCapExtend","endCapExtend","binormal"],getCrossSectionPoint:function(){},needComputeVertexNormal:function(){return!0},adjustPath:function(t,e,i){e=e||this.radius,i=i||1;var n,s,r,a,o,h,l,c,u,d,f,g,_=new Ke.Path,p=new Je,v=new Je,m=new Je,y=new Je,A=t.actions.length;for(g=0;g<A;g++)r=t.actions[g],o=g+1===A?null:t.actions[g+1],a=r.args,"moveTo"===r.action?_.moveTo(a[0],a[1],a[2]):"lineTo"===r.action?o&&"lineTo"===o.action?(n=t.actions[g-1],s=n.args,h=o.args,l=new Je(s[0],s[1],s[2]),c=new Je(a[0],a[1],a[2]),u=new Je(h[0],h[1],h[2]),p.subVectors(c,l),v.subVectors(c,u),d=p.angleTo(v),f=Math.min(p.length()/2,v.length()/2),f=Math.min(e*i,f),m.addVectors(c,p.normalize().multiplyScalar(-f)),y.addVectors(c,v.normalize().multiplyScalar(-f)),_.lineTo(m.x,m.y,m.z),_.curveTo(c.x,c.y,c.z,y.x,y.y,y.z)):_.lineTo(a[0],a[1],a[2]):"quadraticCurveTo"===r.action&&_.curveTo(a[0],a[1],a[2],a[3],a[4],a[5]);return _},_resetPath:function(){return this.path},getPointAt:function(t){return this._realPath?this._realPath.getPoint(t):null},getTangentAt:function(t){if(this._realPath){var e=this._realPath.getPoint(t),i=this._realPath.getPoint(t-.001);return e.sub(i).normalize()}return null},computeData:function(){function t(t,e,i,n){return n.vertices.push(new Ke.Vec3(t,e,i))-1}this.grid=[],this.startGrid=[],this.endGrid=[];var e,i,n,s,r,a,o,h,l,c,u,d,f,g,_,p,v,m,y,A,x=this.segmentsCap,w=new Ke.Vec3,b={};if(b.faces=[],b.uvs=[],b.vertices=[],null==this.path)return b;var S=this._resetPath(),C=this.startCap,T=this.endCap,E=this.cutSurface;this._realPath=S,1==this._autoAjust&&(S=this.adjustPath(S));var _,L,c,M=S.curves.length,P=S.curves,k=[],I=S.getLength(),R=0,D=this.segments;for(l=0;l<M;l++){if(_=P[l],L=_.getLength(),_ instanceof Ke.LineCurve3){var B=(.001*L+R)/I,N=(.999*L+R)/I;k.push(B),k.push(N)}else{var z=.998*L;for(c=0;c<=D;c++){var O=(.001*L+z*c/D+R)/I;k.push(O)}}R+=L}var F=this.frenetFrames(S,k,this.closed,this.binormal),V=F.tangents,U=F.normals,H=F.binormals;this.tangents=V,this.normals=U,this.binormals=H;var W,X=0,G=k.length-1,Z=G+1,Y=0,j=0;for(l=0;l<Z;l++){if(this.grid[l]=[],s=k[l],h=S.getPointAt(s),e=V[l],i=U[l],n=H[l],"none"!==C&&0===l)if("round"===C||"arrow"===C){var q,K;Y+=this.radius*this.startCapSize;for(var Q=h.clone().add(e.clone().multiplyScalar(-this.radius*this.startCapSize)),J=0;J<=x;J++){this.startGrid[J]=[];var $=J/x*Math.PI/2;q="round"===C?Q.clone().add(e.clone().multiplyScalar(this.radius*this.startCapSize*(1-Math.cos($)))):Q.clone().add(e.clone().multiplyScalar(this.radius*this.startCapSize*J/x));for(var c=0;c<this.segmentsR;c++)r=c/this.segmentsR*this.arc+this.arcStart,"round"===C?(a=-this.radius*Math.cos(r)*Math.sin($),o=this.radius*Math.sin(r)*Math.sin($)):(a=-this.radius*Math.cos(r)*J/x,o=this.radius*Math.sin(r)*J/x,a*=this.startCapR||1.3,o*=this.startCapR||1.3),K=q.clone(),K.x+=a*i.x+o*n.x,K.y+=a*i.y+o*n.y,K.z+=a*i.z+o*n.z,this.startGrid[J][c]=b.vertices.push(K)-1;"center"===E&&(this.startGrid[J][this.segmentsR]=b.vertices.push(q.clone())-1)}}else X=b.vertices.push(h);for(c=0;c<this.segmentsR;c++){if(W=c/(this.segmentsR-1),this.shape instanceof Array)a=-this.shape[c].x,o=this.shape[c].y;else if(this.shape instanceof Ke.Path){var tt=this.shape.getPointAt(W);a=-tt.x,o=-tt.y}else r=c/this.segmentsR*this.arc+this.arcStart,a=-this.radius*Math.cos(r),o=this.radius*Math.sin(r);w.copy(h),w.x+=a*i.x+o*n.x,w.y+=a*i.y+o*n.y,w.z+=a*i.z+o*n.z,this.grid[l][c]=t(w.x,w.y,w.z,b)}if("center"===E&&(this.grid[l][this.segmentsR]=b.vertices.push(h.clone())-1),"none"!==T&&l===Z-1)if("round"===T||"arrow"===T){j+=this.radius*this.endCapSize;for(var q,K,Q=h.clone().add(e.clone().multiplyScalar(this.radius*this.endCapSize)),J=0;J<=x;J++){this.endGrid[J]=[];var $=(1-J/x)*Math.PI/2;q="round"===T?Q.clone().add(e.clone().multiplyScalar(-this.radius*this.endCapSize*(1-Math.cos($)))):Q.clone().add(e.clone().multiplyScalar(-this.radius*this.endCapSize*(1-J/x)));for(var c=0;c<this.segmentsR;c++)r=c/this.segmentsR*this.arc+this.arcStart,"round"===T?(a=-this.radius*Math.cos(r)*Math.sin($),o=this.radius*Math.sin(r)*Math.sin($)):(a=-this.radius*Math.cos(r)*(1-J/x),o=this.radius*Math.sin(r)*(1-J/x),a*=this.endCapR||1.3,o*=this.endCapR||1.3),K=q.clone(),K.x+=a*i.x+o*n.x,K.y+=a*i.y+o*n.y,K.z+=a*i.z+o*n.z,this.endGrid[J][c]=b.vertices.push(K)-1;"center"===E&&(this.endGrid[J][this.segmentsR]=b.vertices.push(q)-1)}}else b.vertices.push(h)}var et=this.segmentsR,it=this.segmentsR;this.arc!==2*Math.PI&&("center"===E?(et++,it++):"none"===E&&et--);var nt=this.arc/Math.PI/2,st=S.getLength(),rt=st+Y+j,at=0,ot=Y/rt,ht=ot,lt=st/rt,ct=ot+lt,ut=j/rt;if("none"!==C)if("plain"===C)for(f=0,c=0;c<this.segmentsR;c++){d=(c+1)%this.segmentsR,g=this.grid[0][c],_=this.grid[0][d],b.faces.push(new Ke.Face3(f,g,_)),r=c/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),o=this.radius*Math.sin(r);var v=new Qe(.5,.5);r=c/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),o=this.radius*Math.sin(r);var m=new Qe((a/this.radius+1)/2,(o/this.radius+1)/2);r=d/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),o=this.radius*Math.sin(r);var y=new Qe((a/this.radius+1)/2,(o/this.radius+1)/2);b.uvs.push([v,m,y])}else for(l=0;l<=x;l++)for(c=0;c<et;c++){if(u=l+1,d=(c+1)%it,f=this.startGrid[l][c],u===x+1?(g=this.grid[0][c],_=this.grid[0][d]):(g=this.startGrid[u][c],_=this.startGrid[u][d]),p=this.startGrid[l][d],c>=this.segmentsR-1){var J=this.segmentsR-1,s=J/this.segmentsR*nt;et===this.segmentsR?(v=new Ke.Vec2(l/x*ot+at,s),m=new Ke.Vec2((l+1)/x*ot+at,s),y=new Ke.Vec2((l+1)/x*ot+at,1),A=new Ke.Vec2(l/x*ot+at,1)):c>this.segmentsR-1?(v=new Ke.Vec2(l/x*ot+at,(1+s)/2),m=new Ke.Vec2((l+1)/x*ot+at,(1+s)/2),y=new Ke.Vec2((l+1)/x*ot+at,1),A=new Ke.Vec2(l/x*ot+at,1)):(v=new Ke.Vec2(l/x*ot+at,s),m=new Ke.Vec2((l+1)/x*ot+at,s),y=new Ke.Vec2((l+1)/x*ot+at,(1+s)/2),A=new Ke.Vec2(l/x*ot+at,(1+s)/2))}else v=new Ke.Vec2(l/x*ot+at,c/this.segmentsR*nt),m=new Ke.Vec2((l+1)/x*ot+at,c/this.segmentsR*nt),y=new Ke.Vec2((l+1)/x*ot+at,(c+1)/this.segmentsR*nt),A=new Ke.Vec2(l/x*ot+at,(c+1)/this.segmentsR*nt);0!==l&&(b.faces.push(new Ke.Face3(f,g,p,X-1)),b.uvs.push([v,m,A])),b.faces.push(new Ke.Face3(g,_,p,X-1)),b.uvs.push([m.clone(),y,A.clone()])}for(l=0;l<G;l++)for(c=0;c<et;c++){if(u=this.closed?(l+1)%G:l+1,d=(c+1)%it,f=this.grid[l][c],g=this.grid[u][c],_=this.grid[u][d],p=this.grid[l][d],c>=this.segmentsR-1){var J=this.segmentsR-1,s=J/this.segmentsR*nt;et===this.segmentsR?(v=new Ke.Vec2(k[l]*lt+ht,s),m=new Ke.Vec2(k[l+1]*lt+ht,s),y=new Ke.Vec2(k[l+1]*lt+ht,1),A=new Ke.Vec2(k[l]*lt+ht,1)):c>this.segmentsR-1?(v=new Ke.Vec2(k[l]*lt+ht,(s+1)/2),m=new Ke.Vec2(k[l+1]*lt+ht,(s+1)/2),y=new Ke.Vec2(k[l+1]*lt+ht,1),A=new Ke.Vec2(k[l]*lt+ht,1)):(v=new Ke.Vec2(k[l]*lt+ht,s),m=new Ke.Vec2(k[l+1]*lt+ht,s),y=new Ke.Vec2(k[l+1]*lt+ht,(s+1)/2),A=new Ke.Vec2(k[l]*lt+ht,(s+1)/2))}else v=new Ke.Vec2(k[l]*lt+ht,c/this.segmentsR*nt),m=new Ke.Vec2(k[l+1]*lt+ht,c/this.segmentsR*nt),y=new Ke.Vec2(k[l+1]*lt+ht,(c+1)/this.segmentsR*nt),A=new Ke.Vec2(k[l]*lt+ht,(c+1)/this.segmentsR*nt);b.faces.push(new Ke.Face3(f,g,p)),b.uvs.push([v,m,A]),b.faces.push(new Ke.Face3(g,_,p)),b.uvs.push([m.clone(),y,A.clone()])}if("none"!==T){f=b.vertices.length-1;var M=this.grid.length;if("plain"===T)for(c=0;c<this.segmentsR;c++){d=(c+1)%this.segmentsR,g=this.grid[M-1][c],_=this.grid[M-1][d],b.faces.push(new Ke.Face3(f,_,g)),r=c/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),o=this.radius*Math.sin(r);var v=new Qe(.5,.5);r=c/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),o=this.radius*Math.sin(r);var m=new Qe((a/this.radius+1)/2,(o/this.radius+1)/2);r=d/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),o=this.radius*Math.sin(r);var y=new Qe((a/this.radius+1)/2,(o/this.radius+1)/2);b.uvs.push([v,y,m])}else for(l=-1;l<x;l++)for(c=0;c<et;c++){if(u=l+1,d=(c+1)%it,l===-1?(f=this.grid[M-1][c],p=this.grid[M-1][d]):(f=this.endGrid[l][c],p=this.endGrid[l][d]),g=this.endGrid[u][c],_=this.endGrid[u][d],c>=this.segmentsR-1){var J=this.segmentsR-1,s=J/this.segmentsR*nt;et===this.segmentsR?(v=new Ke.Vec2(l/x*ut+ct,s),m=new Ke.Vec2((l+1)/x*ut+ct,s),y=new Ke.Vec2((l+1)/x*ut+ct,1),A=new Ke.Vec2(l/x*ut+ct,1)):c>this.segmentsR-1?(v=new Ke.Vec2(l/x*ut+ct,(1+s)/2),m=new Ke.Vec2((l+1)/x*ut+ct,(1+s)/2),y=new Ke.Vec2((l+1)/x*ut+ct,1),A=new Ke.Vec2(l/x*ut+ct,1)):(v=new Ke.Vec2(l/x*ut+ct,s),m=new Ke.Vec2((l+1)/x*ut+ct,s),y=new Ke.Vec2((l+1)/x*ut+ct,(1+s)/2),A=new Ke.Vec2(l/x*ut+ct,(1+s)/2))}else v=new Ke.Vec2(l/x*ut+ct,c/this.segmentsR*nt),m=new Ke.Vec2((l+1)/x*ut+ct,c/this.segmentsR*nt),y=new Ke.Vec2((l+1)/x*ut+ct,(c+1)/this.segmentsR*nt),A=new Ke.Vec2(l/x*ut+ct,(c+1)/this.segmentsR*nt);b.faces.push(new Ke.Face3(f,g,p)),b.uvs.push([v,m,A]),b.faces.push(new Ke.Face3(g,_,p)),b.uvs.push([m.clone(),y,A.clone()])}}return b},frenetFrames:function(t,e,i,n){function s(){_[0]=new Ke.Vec3,p[0]=new Ke.Vec3,a=Number.MAX_VALUE,o=Math.abs(g[0].x),h=Math.abs(g[0].y),l=Math.abs(g[0].z),h<=a&&(a=h,f.set(0,1,0)),o<=a&&(a=o,f.set(1,0,0)),l<=a&&f.set(0,0,1),n&&(f=n.clone()),v.crossVectors(g[0],f).normalize(),_[0].crossVectors(g[0],v),p[0].crossVectors(g[0],_[0])}var r,a,o,h,l,c,u,d,f=(new Ke.Vec3,new Ke.Vec3),g=(new Ke.Vec3,[]),_=[],p=[],v=new Ke.Vec3,m=new Ke.Mat4,y=e.length-1,A=y+1,x=1e-4,w=[];for(w.tangents=g,w.normals=_,w.binormals=p,c=0;c<A;c++){u=e[c];var d=t.getTangentAt(u);g[c]=new Ke.Vec3(d.x,d.y,d.z?d.z:0),g[c].normalize()}for(s(),c=1;c<A;c++)_[c]=_[c-1].clone(),p[c]=p[c-1].clone(),v.crossVectors(g[c-1],g[c]),v.length()>x&&(v.normalize(),r=Math.acos(Ke.Math.clamp(g[c-1].dot(g[c]),-1,1)),_[c].applyMatrix4(m.makeRotationAxis(v,r))),p[c].crossVectors(g[c],_[c]);if(i)for(r=Math.acos(Ke.Math.clamp(_[0].dot(_[A-1]),-1,1)),r/=A-1,g[0].dot(v.crossVectors(_[0],_[A-1]))>0&&(r=-r),c=1;c<A;c++)_[c].applyMatrix4(m.makeRotationAxis(g[c],r*c)),p[c].crossVectors(g[c],_[c]);return w}}),Ke.PathCube=function(t,e,i,n,s){var r;1===arguments.length&&arguments[0]instanceof Object&&!(arguments[0]instanceof Ke.Path)?(r=arguments[0],this.path=r.path,this.width=r.width||50,this.height=r.height||100,this.curveSegements=r.curveSegements||32,this.repeat=r.repeat||20,this._id=r.id):(this.path=t,this.width=e||50,this.height=i||100,this.curveSegements=n||32,this.repeat=s||20),this.materialSize=6,Ke.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},Ke.PathCube.SideIndexMapping={bottom:0,outside:1,inside:2,top:3,aside:4,zside:5},Ke.extend(Ke.PathCube,Ke.Entity,{__accessor:["path","width","height","curveSegements","repeat"],__SizePropeties:["path","width","height","curveSegements","repeat"],constructor:Ke.PathCube,className:"TGL.PathCube",getSideIndexMapping:function(){return Ke.PathCube.SideIndexMapping},computeData:function(){var t={};if(t.vertices=[],t.faces=[],t.uvs=[],t.uv2s=[],null==this.path)return t;var e,i=this.computePoints(this.path,this.width,this.curveSegements),n=i[0],s=i[1],r=n.length,a=i[2],o=this.height,h=this.repeat,l=[],c=[],u=[],d=[],f=this.path.isClockwise();for(this.innerPoints=this.clonePoints(n),this.outerPoints=this.clonePoints(s),e=0;e<r;e++)this.exchangeYZ(n[e]),this.exchangeYZ(s[e]),l[e]=t.vertices.push(n[e])-1,c[e]=t.vertices.push(s[e])-1,u[e]=t.vertices.push(n[e].clone().setY(o))-1,d[e]=t.vertices.push(s[e].clone().setY(o))-1;var g=a?r:r-1;for(e=0;e<g;e++)this.generateTop(t,e,r,u,d,!0,h),this.generateBottom(t,e,r,l,c,h),this.generateSideWall(t,e,r,d,c,!0,h,f),this.generateSideWall(t,e,r,u,l,!1,h,f);return a||(this.generateEnd(t,u,l,c,d,h,!0),this.generateEnd(t,u,l,c,d,h,!1)),this.clockwise=f,t},clonePoints:function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].clone());return e},getInsidePoints:function(){var t=[];return t=this.clockwise?this.innerPoints:this.outerPoints},generateEnd:function(t,e,i,n,s,r,a){var o,h,l,c,u,d,f,g,_,p,v,m,y,A,x,y,w,b,S,C,T=a?0:i.length-1;o=e[T],h=i[T],l=n[T],c=s[T],w=t.vertices[o],b=t.vertices[h],S=t.vertices[l],C=t.vertices[c],u=w.x,d=w.y,f=w.z,g=b.x,_=b.y,p=b.z,v=S.x,m=S.y,y=S.z,A=C.x,x=C.y,dz=C.z;var E=Math.abs(f-y),L=Math.abs(u-v);a?(t.faces.push(new Ke.Face3(o,h,c,null,null,4)),E<L?t.uvs.push([new Ke.Vec2(u/r,d/r),new Ke.Vec2(g/r,_/r),new Ke.Vec2(A/r,x/r)]):t.uvs.push([new Ke.Vec2(f/r,d/r),new Ke.Vec2(p/r,_/r),new Ke.Vec2(dz/r,x/r)]),t.uv2s.push([new Qe(0,1),new Qe(0,0),new Qe(1,1)]),t.faces.push(new Ke.Face3(h,l,c,null,null,4)),E<L?t.uvs.push([new Ke.Vec2(g/r,_/r),new Ke.Vec2(v/r,m/r),new Ke.Vec2(A/r,x/r)]):t.uvs.push([new Ke.Vec2(p/r,_/r),new Ke.Vec2(y/r,m/r),new Ke.Vec2(dz/r,x/r)]),t.uv2s.push([new Qe(0,0),new Qe(1,0),new Qe(1,1)])):(t.faces.push(new Ke.Face3(h,o,c,null,null,5)),E<L?t.uvs.push([new Ke.Vec2(g/r,_/r),new Ke.Vec2(u/r,d/r),new Ke.Vec2(A/r,x/r)]):t.uvs.push([new Ke.Vec2(p/r,_/r),new Ke.Vec2(f/r,d/r),new Ke.Vec2(dz/r,x/r)]),t.uv2s.push([new Qe(0,0),new Qe(0,1),new Qe(1,1)]),t.faces.push(new Ke.Face3(l,h,c,null,null,5)),E<L?t.uvs.push([new Ke.Vec2(v/r,m/r),new Ke.Vec2(g/r,_/r),new Ke.Vec2(A/r,x/r)]):t.uvs.push([new Ke.Vec2(y/r,m/r),new Ke.Vec2(p/r,_/r),new Ke.Vec2(dz/r,x/r)]),t.uv2s.push([new Qe(1,0),new Qe(0,0),new Qe(1,1)]))},generateSideWall:function(t,e,i,n,s,r,a,o){var h,l,c,u,d,f,g,_,p,v,m,y,A,x,w,A,b,S,C,T,E;b=(e+1)%i,h=n[e],l=s[e],c=s[b],u=n[b],S=t.vertices[h],C=t.vertices[l],T=t.vertices[c],E=t.vertices[u],d=S.x,f=S.y,g=S.z,_=C.x,p=C.y,v=C.z,m=T.x,y=T.y,A=T.z,x=E.x,w=E.y,dz=E.z;var L,M=Math.abs(g-A),P=Math.abs(d-m);r?(L=o?1:2,t.faces.push(new Ke.Face3(h,l,u,null,null,L)),M<P?t.uvs.push([new Ke.Vec2(d/a,f/a),new Ke.Vec2(_/a,p/a),new Ke.Vec2(x/a,w/a)]):t.uvs.push([new Ke.Vec2(g/a,f/a),new Ke.Vec2(v/a,p/a),new Ke.Vec2(dz/a,w/a)]),t.uv2s.push([new Qe(0,1),new Qe(0,0),new Qe(1,1)]),t.faces.push(new Ke.Face3(l,c,u,null,null,L)),M<P?t.uvs.push([new Ke.Vec2(_/a,p/a),new Ke.Vec2(m/a,y/a),new Ke.Vec2(x/a,w/a)]):t.uvs.push([new Ke.Vec2(v/a,p/a),new Ke.Vec2(A/a,y/a),new Ke.Vec2(dz/a,w/a)]),t.uv2s.push([new Qe(0,0),new Qe(1,0),new Qe(1,1)])):(L=o?2:1,t.faces.push(new Ke.Face3(l,h,u,null,null,L)),M<P?t.uvs.push([new Ke.Vec2(_/a,p/a),new Ke.Vec2(d/a,f/a),new Ke.Vec2(x/a,w/a)]):t.uvs.push([new Ke.Vec2(v/a,p/a),new Ke.Vec2(g/a,f/a),new Ke.Vec2(dz/a,w/a)]),t.uv2s.push([new Qe(0,0),new Qe(0,1),new Qe(1,1)]),t.faces.push(new Ke.Face3(c,l,u,null,null,L)),M<P?t.uvs.push([new Ke.Vec2(m/a,y/a),new Ke.Vec2(_/a,p/a),new Ke.Vec2(x/a,w/a)]):t.uvs.push([new Ke.Vec2(A/a,y/a),new Ke.Vec2(v/a,p/a),new Ke.Vec2(dz/a,w/a)]),t.uv2s.push([new Qe(1,0),new Qe(0,0),new Qe(1,1)]))},generateBottom:function(t,e,i,n,s,r){this.generateTop(t,e,i,n,s,!1,r)},generateTop:function(t,e,i,n,s,r,a){var o,h,l,c,u,d,f,g,_,p,v,m,y,A,x,y,w,b,S,C,T;w=(e+1)%i,o=n[e],h=s[e],l=s[w],c=n[w],b=t.vertices[o],S=t.vertices[h],C=t.vertices[l],T=t.vertices[c],u=b.x,d=b.y,f=b.z,g=S.x,_=S.y,p=S.z,v=C.x,m=C.y,y=C.z,A=T.x,x=T.y,dz=T.z,r?(t.faces.push(new Ke.Face3(o,h,c,null,null,3)),t.uvs.push([new Ke.Vec2(u/a,f/a),new Ke.Vec2(g/a,p/a),new Ke.Vec2(A/a,dz/a)]),t.uv2s.push([new Qe(0,1),new Qe(0,0),new Qe(1,1)]),t.faces.push(new Ke.Face3(h,l,c,null,null,3)),t.uvs.push([new Ke.Vec2(g/a,p/a),new Ke.Vec2(v/a,y/a),new Ke.Vec2(A/a,dz/a)]),t.uv2s.push([new Qe(0,0),new Qe(1,0),new Qe(1,1)])):(t.faces.push(new Ke.Face3(h,o,c,null,null,0)),t.uvs.push([new Ke.Vec2(g/a,p/a),new Ke.Vec2(u/a,f/a),new Ke.Vec2(A/a,dz/a)]),t.uv2s.push([new Qe(0,0),new Qe(0,1),new Qe(1,1)]),t.faces.push(new Ke.Face3(l,h,c,null,null,0)),t.uvs.push([new Ke.Vec2(v/a,y/a),new Ke.Vec2(g/a,p/a),new Ke.Vec2(A/a,dz/a)]),t.uv2s.push([new Qe(1,0),new Qe(0,0),new Qe(1,1)]))},exchangeYZ:function(t){var e=t.y;t.y=t.z,t.z=-e},addPoints:function(t,e,i,n,s){e.multiplyScalar(.5),i.push((new Ke.Vec3).subVectors(t,e)),n.push((new Ke.Vec3).addVectors(t,e))},computeCurvePoint:function(t,e,i,n,s,r,a,o,h){var l,c,d,f,g=n?0:1,_=new Ke.Vec3,p=o;if(t){c=t.getTangentAt(1),d=e.getTangentAt(0),concave=Ke.Math.isConcave(c,d,!1),d.multiplyScalar(-1),angle=c.angleTo(d),f=Math.sin(angle/2),l=e.getPoint(0),f=0==f?.1:f;var v=concave?i/f:-i/f;1==f?_.crossVectors(d,new Je(0,0,1)).normalize().multiplyScalar(v):_.addVectors(c,d).normalize().multiplyScalar(v),this.addPoints(l,_,r,a,h)}else d=e.getTangentAt(g),l=e.getPoint(g),_.crossVectors(d,new Ke.Vec3(0,0,1)).normalize().multiplyScalar(i),this.addPoints(l,_,r,a,h);if(!(e instanceof Ke.LineCurve3)&&s){var m=p+1;for(j=0;j<m-2;j++)u=j/(m-1),d=e.getTangentAt(u),l=e.getPointAt(u),_.crossVectors(d,new Ke.Vec3(0,0,1)).normalize().multiplyScalar(i),j*e.getLength()/p>i/Math.abs(f)&&this.addPoints(l,_,r,a,h)}},computePoints:function(t,e,i){var n,s,r,a=(new Ke.Vec3,t.isClockwise()),o=t.curves[0].getPoint(0),h=t.curves[t.curves.length-1].getPoint(1);r=o.equals(h),s=t.curves.length;var l=[],c=[];new Ke.Path,t.getLength();for(n=0;n<s;n++){var u=n-1;r&&u===-1&&(u=s-1);var d=t.curves[u],f=t.curves[n];this.computeCurvePoint(d,f,e,!0,!0,l,c,i,a),n===s-1&&!r&&this.computeCurvePoint(null,f,e,!1,!1,l,c,i,a)}return[l,c,r]}}),Ke.ShapeNode=function(t,e,i,n,s){if(null==t)return t=[],this.materialSize=3,Ke.Entity.call(this),void 0;var r;if(!(1===arguments.length&&arguments[0]instanceof Object)||arguments[0]instanceof Ke.Shape||arguments[0]instanceof Ke.Path&&!Array.isArray(arguments[0]))this.options={curveSegments:e,amount:i,vertical:n,zMinusHalfAmount:this.zMinusHalfAmount,repeat:s||20};else{if(r=arguments[0],t=r.path,null==t)return t=[],this.materialSize=3,Ke.Entity.call(this),void 0;e=r.curveSegments,i=r.amount,n=r.vertical,s=r.repeat,this.options={curveSegments:r.curveSegments,amount:r.amount,vertical:r.vertical,zMinusHalfAmount:this.zMinusHalfAmount,repeat:r.repeat||20},this._id=r.id}var a=[];t instanceof Ke.Path?(a=t.toShapes(),this.path=t):a=t,this.curveSegments=e,this.amount=i,this.vertical=n,this.repeat=s||20,a=a instanceof Array?a:[a],this.shapes=a,this.shapebb=a[a.length-1].getBoundingBox(),this.materialSize=3,Ke.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},Ke.ShapeNode.SideIndexMapping={bottom:0,side:1,top:2},Ke.extend(Ke.ShapeNode,Ke.Entity,{constructor:Ke.ShapeNode,className:"TGL.ShapeNode",__accessor:["path","curveSegments","amount","vertical","repeat"],__bool:["vertical"],__SizePropeties:["path","curveSegments","amount","vertical","repeat"],computeData:function(){return this.options={curveSegments:this.curveSegments,amount:this.amount,vertical:this.vertical,zMinusHalfAmount:this.zMinusHalfAmount,repeat:this.repeat||20},this.addShapes(this.path,this.options)},getSideIndexMapping:function(){return Ke.ShapeNode.SideIndexMapping},addShapes:function(t,e){var i=[];i=t instanceof Ke.Path?t.toShapes():t;var n={};if(n.vertices=[],n.uvs=[],n.faces=[],!i)return n;for(var s=i.length,r=0;r<s;r++){var a=i[r];this.addShape(a,e,n)}var o=new Ke.BoundingBox;o.setFromPoints(n.vertices);var h=(o.max.y-o.min.y)/2;if(e.zMinusHalfAmount)for(var l=0;l<n.vertices.length;l++)n.vertices[l].y-=h;if(e.vertical)for(var l=0;l<n.vertices.length;l++){var c=n.vertices[l].y;n.vertices[l].y=n.vertices[l].z,n.vertices[l].z=-c}return n}}),Ke.ShapeNode.prototype.addShape=function(t,i,n){function s(t,e,i){return e||console.log("die"),e.clone().multiplyScalar(i).add(t)}function r(t,e,i){return o(t,e,i)}function a(t,e,i){var n=Math.atan2(e.y-t.y,e.x-t.x),s=Math.atan2(i.y-t.y,i.x-t.x);n>s&&(s+=2*Math.PI);var r=(n+s)/2,a=-Math.cos(r),o=-Math.sin(r),h=new Ke.Vec2(a,o);return h}function o(t,e,i){var n,s,r,o,h,l,c=Ke.ShapeNode.__v1,u=Ke.ShapeNode.__v2,d=Ke.ShapeNode.__v3,f=Ke.ShapeNode.__v4,g=Ke.ShapeNode.__v5,_=Ke.ShapeNode.__v6;return c.set(t.x-e.x,t.y-e.y),u.set(t.x-i.x,t.y-i.y),n=c.normalize(),s=u.normalize(),d.set(-n.y,n.x),f.set(s.y,-s.x),g.copy(t).add(d),_.copy(t).add(f),g.equals(_)?f.clone():(g.copy(e).add(d),_.copy(i).add(f),r=n.dot(f),o=_.sub(g).dot(f),0===r&&(console.log("Either infinite or no solutions!"),0===o?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),h=o/r,h<0?a(t,e,i):(l=n.multiplyScalar(h).add(g),l.sub(t).clone()))}function h(){if(A){var t=0,e=Y*t;for(K=0;K<j;K++)Z=F[K],d(Z[2]+e,Z[1]+e,Z[0]+e,!0);for(t=w+2*y,e=Y*t,K=0;K<j;K++)Z=F[K],d(Z[0]+e,Z[1]+e,Z[2]+e,!1)}else{for(K=0;K<j;K++)Z=F[K],d(Z[2],Z[1],Z[0],!0);for(K=0;K<j;K++)Z=F[K],d(Z[0]+Y*w,Z[1]+Y*w,Z[2]+Y*w,!1)}}function l(){var t=0;for(c(V,t),t+=V.length,I=0,R=z.length;I<R;I++)k=z[I],c(k,t),t+=k.length}function c(t,e){var i,n;for(K=t.length;--K>=0;){i=K,n=K-1,n<0&&(n=t.length-1);var s=0,r=w+2*y;for(s=0;s<r;s++){var a=Y*s,o=Y*(s+1),h=e+i+a,l=e+n+a,c=e+n+o,u=e+i+o;f(h,l,c,u,t,s,r,i,n)}}}function u(t,e,i){n.vertices.push(new Ke.Vec3(t,e,i-(p?_/2:0)))}function d(e,s,r,a){e+=D,s+=D,r+=D;var o=a?0:2;if(Ke.Math.isClockwise([n.vertices[e],n.vertices[s],n.vertices[r]]),"z"){n.faces.push(new Ke.Face3(e,s,r,null,null,o));var h=a?T.generateBottomUV(n,t,i,e,s,r):T.generateTopUV(n,t,i,e,s,r);n.uvs.push(h)}else{n.faces.push(new Ke.Face3(e,r,s,null,null,o));var h=a?T.generateBottomUV(n,t,i,e,r,s):T.generateTopUV(n,t,i,e,r,s);n.uvs.push(h)}}function f(e,s,r,a,o,h,l,c,u){if(e+=D,s+=D,r+=D,a+=D,Ke.Math.isClockwise([n.vertices[e],n.vertices[s],n.vertices[a]]),"z"){n.faces.push(new Ke.Face3(e,s,a,null,null,C)),n.faces.push(new Ke.Face3(s,r,a,null,null,C));var d=T.generateSideWallUV(n,t,o,i,e,s,r,a,h,l,c,u);n.uvs.push([d[0],d[1],d[3]]),n.uvs.push([d[1],d[2],d[3]])}else{n.faces.push(new Ke.Face3(e,a,s,null,null,C)),n.faces.push(new Ke.Face3(s,a,r,null,null,C));var d=T.generateSideWallUV(n,t,o,i,e,s,r,a,h,l,c,u);n.uvs.push([d[0],d[3],d[1]]),n.uvs.push([d[1],d[3],d[2]])}}var g,_=i.amount!==e?i.amount:100,p=i.zMinusHalfAmount!==e&&i.zMinusHalfAmount,v=i.bevelThickness!==e?i.bevelThickness:6,m=i.bevelSize!==e?i.bevelSize:v-2,y=i.bevelSegments!==e?i.bevelSegments:3,A=i.bevelEnabled!==e&&i.bevelEnabled,x=i.curveSegments!==e?i.curveSegments:12,w=i.steps!==e?i.steps:1,b=i.extrudePath,S=!1,C=(i.material||0,i.extrudeMaterial||1),T=i.UVGenerator!==e?i.UVGenerator:Ke.ShapeNode.WorldUVGenerator;T.repeat=i.repeat;var E,L,M,P;this.shapebb;b&&(g=b.getSpacedPoints(w),S=!0,A=!1,E=i.frames!==e?i.frames:Ke.PathNode.prototype.frenetFrames(b,w,!1),L=new Ke.Vec3,M=new Ke.Vec3,P=new Ke.Vec3),A||(y=0,v=0,m=0);var k,I,R,D=n.vertices.length,B=t.extractPoints(x),N=B.shape,z=B.holes,O=!Ke.Shape.Utils.isClockWise(N);if(O){for(N=N.reverse(),I=0,R=z.length;I<R;I++)k=z[I],Ke.Shape.Utils.isClockWise(k)&&(z[I]=k.reverse());O=!1}var F=Ke.Shape.Utils.triangulateShape(N,z),V=N;for(I=0,R=z.length;I<R;I++)k=z[I],N=N.concat(k);for(var U,H,W,X,G,Z,Y=N.length,j=F.length,q=(V.length,180/Math.PI,[]),K=0,Q=V.length,J=Q-1,$=K+1;K<Q;K++,J++,$++){J===Q&&(J=0),$===Q&&($=0);V[K],V[J],V[$];q[K]=r(V[K],V[J],V[$])}var tt,et=[],it=q.concat();for(I=0,R=z.length;I<R;I++){for(k=z[I],tt=[],K=0,Q=k.length,J=Q-1,$=K+1;K<Q;K++,J++,$++)J===Q&&(J=0),$===Q&&($=0),tt[K]=r(k[K],k[J],k[$]);et.push(tt),it=it.concat(tt)}for(U=0;U<y;U++){for(W=U/y,X=v*(1-W),H=m*Math.sin(W*Math.PI/2),K=0,Q=V.length;K<Q;K++)G=s(V[K],q[K],H),u(G.x,G.y,-X);for(I=0,R=z.length;I<R;I++)for(k=z[I],tt=et[I],K=0,Q=k.length;K<Q;K++)G=s(k[K],tt[K],H),u(G.x,G.y,-X)}for(H=m,K=0;K<Y;K++)G=A?s(N[K],it[K],H):N[K],S?(M.copy(E.normals[0]).multiplyScalar(G.x),L.copy(E.binormals[0]).multiplyScalar(G.y),P.copy(g[0]).add(M).add(L),u(P.x,P.y,P.z)):u(G.x,G.y,0);var nt;for(nt=1;nt<=w;nt++)for(K=0;K<Y;K++)G=A?s(N[K],it[K],H):N[K],S?(M.copy(E.normals[nt]).multiplyScalar(G.x),L.copy(E.binormals[nt]).multiplyScalar(G.y),P.copy(g[nt]).add(M).add(L),u(P.x,P.y,P.z)):u(G.x,G.y,_/w*nt);for(U=y-1;U>=0;U--){for(W=U/y,X=v*(1-W),H=m*Math.sin(W*Math.PI/2),K=0,Q=V.length;K<Q;K++)G=s(V[K],q[K],H),u(G.x,G.y,_+X);for(I=0,R=z.length;I<R;I++)for(k=z[I],tt=et[I],K=0,Q=k.length;K<Q;K++)G=s(k[K],tt[K],H),S?u(G.x,G.y+g[w-1].y,g[w-1].x+X):u(G.x,G.y,_+X)}h(),l()},Ke.ShapeNode.WorldUVGenerator={generateTopUV:function(t,e,i,n,s,r){var a=t.vertices[n].x,o=t.vertices[n].y,h=t.vertices[s].x,l=t.vertices[s].y,c=t.vertices[r].x,u=t.vertices[r].y;return[new Ke.Vec2(a/this.repeat,o/this.repeat),new Ke.Vec2(h/this.repeat,l/this.repeat),new Ke.Vec2(c/this.repeat,u/this.repeat)]},generateBottomUV:function(t,e,i,n,s,r){return this.generateTopUV(t,e,i,n,s,r)},uv:function(t,e,i){return new Qe(Math.sqrt(t*t+e*e)/this.repeat,(1-i)/this.repeat)},generateSideWallUV:function(t,e,i,n,s,r,a,o,h,l,c,u){var d=t.vertices[s].x,f=t.vertices[s].y,g=t.vertices[s].z,_=t.vertices[r].x,p=t.vertices[r].y,v=t.vertices[r].z,m=t.vertices[a].x,y=t.vertices[a].y,A=t.vertices[a].z,x=t.vertices[o].x,w=t.vertices[o].y,b=t.vertices[o].z,S=Math.abs(f-p),C=Math.abs(d-_);return S<C?[new Ke.Vec2(d/this.repeat,(1-g)/this.repeat),new Ke.Vec2(_/this.repeat,(1-v)/this.repeat),new Ke.Vec2(m/this.repeat,(1-A)/this.repeat),new Ke.Vec2(x/this.repeat,(1-b)/this.repeat)]:[new Ke.Vec2(f/this.repeat,(1-g)/this.repeat),new Ke.Vec2(p/this.repeat,(1-v)/this.repeat),new Ke.Vec2(y/this.repeat,(1-A)/this.repeat),new Ke.Vec2(w/this.repeat,(1-b)/this.repeat)]}},Ke.ShapeNode.__v1=new Ke.Vec2,Ke.ShapeNode.__v2=new Ke.Vec2,Ke.ShapeNode.__v3=new Ke.Vec2,Ke.ShapeNode.__v4=new Ke.Vec2,Ke.ShapeNode.__v5=new Ke.Vec2,Ke.ShapeNode.__v6=new Ke.Vec2,Ke.TextNode=function(t,i,n,s,r,a,o){var h;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(h=arguments[0],t=h.text,this.font=h.font||"helvetiker",this.size=h.size||150,this.weight=h.weight||"normal",this.fontStyle=h.fontStyle||"normal",this.height=h.height||50,this._id=h.id,this.curveSegments=h.curveSegments):(this.font=s||"helvetiker",this.size=i||150,this.weight=r||"normal",this.fontStyle=a||"normal",this.height=n||50,this.curveSegments=o);var l={size:this.size,height:this.height,font:this.font,weight:this.weight,style:this.fontStyle,curveSegments:this.curveSegments||30,bevelEnabled:!1,zMinusHalfAmount:!0};this.text=t;var c=Ke.FontUtils.generateShapes(t,l);l.amount=l.height!==e?l.height:50,l.bevelThickness===e&&(l.bevelThickness=10),l.bevelSize===e&&(l.bevelSize=8),l.bevelEnabled===e&&(l.bevelEnabled=!1),Ke.ShapeNode.call(this,c,l.curveSegments,this.height,!1,50,!0)},Ke.extend(Ke.TextNode,Ke.ShapeNode,{constructor:Ke.TextNode,className:"TGL.TextNode",__accessor:["text","size","height","font","weight","fontStyle"],__SizePropeties:["text","size","height","font","weight","fontStyle"],computeData:function(){var t={size:this.size,height:this.height,font:this.font,weight:this.weight,style:this.fontStyle,curveSegments:this.curveSegments||30,bevelEnabled:!1,zMinusHalfAmount:!0},e={curveSegments:this.curveSegments,amount:this.height,vertical:!1,zMinusHalfAmount:!0,repeat:20},i=Ke.FontUtils.generateShapes(this.text,t);return Ke.ShapeNode.prototype.addShapes.call(this,i,e)}}),Ke.LatheNode=function(t,i,n,s,r,a){this.materialSize=3;var o;1===arguments.length&&arguments[0]instanceof Object&&!(arguments[0]instanceof Ke.Path)?(o=arguments[0],this.path=o.path,this.segmentsH=o.segmentsH||64,this.segmentsR=o.segmentsR||20,this.arc=o.arc!=e?o.arc:2*Math.PI,this.startClosed=o.startClosed,this.endClosed=o.endClosed,this._id=o.id):(this.path=t,this.segmentsH=i||64,this.segmentsR=n||20,this.arc=s!=e?s:2*Math.PI,this.startClosed=r,this.endClosed=a),Ke.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},Ke.extend(Ke.LatheNode,Ke.Entity,{constructor:Ke.LatheNode,className:"TGL.LatheNode",__accessor:["path","segmentsH","segmentsR","arc","startClosed","endClosed"],__SizePropeties:["path","segmentsH","segmentsR","arc","startClosed","endClosed"],computeData:function(){function t(t){var e=t.x,i=t.z,n=((0===i?e/Math.abs(e):e/Math.abs(i))+1)/2;n=Ke.Math.clamp(n,0,1);var s=((0===e?i/Math.abs(i):i/Math.abs(e))+1)/2;return s=Ke.Math.clamp(s,0,1),new Ke.Vec2(n,s)}var e={},e={};if(e.faces=[],e.uvs=[],e.vertices=[],null==this.path)return e;var i,n,s,r,o,h,l,u=[],d=this.path,f=this.segmentsH,g=this.segmentsR;for(Ke.Shape.Utils.isClockWise(d.getPoints())||(d=d.reverse()),n=0;n<=f;n++){for(i=d.getPoint(n/f),u[n]=[],r=Math.abs(i.x),o=i.y,this.startClosed&&0===n&&e.vertices.push(new Ke.Vec3(0,o,0)),s=0;s<g;s++)l=s/g*this.arc,h=new Ke.Vec3(r*Math.cos(l),o,r*Math.sin(l)),u[n][s]=e.vertices.push(h)-1;this.endClosed&&n===f&&e.vertices.push(new Ke.Vec3(0,o,0))}var _=this.arc==2*Math.PI;if(this.startClosed)for(a=0,s=0;s<(_?g:g-1);s++)jp=(s+1)%g,b=u[0][s],c=u[0][jp],uva=new Ke.Vec2(.5,.5),uvb=t(e.vertices[b]),uvc=t(e.vertices[c]),e.faces.push(new Ke.Face3(a,b,c)),e.uvs.push([uva,uvb,uvc]);for(n=0;n<f;n++)for(s=0;s<(_?g:g-1);s++)ip=n+1,jp=(s+1)%g,a=u[n][s],b=u[ip][s],c=u[ip][jp],Yi=u[n][jp],uva=new Ke.Vec2(n/f,s/g),uvb=new Ke.Vec2((n+1)/f,s/g),uvc=new Ke.Vec2((n+1)/f,(s+1)/g),uvd=new Ke.Vec2(n/f,(s+1)/g),e.faces.push(new Ke.Face3(a,b,Yi)),e.uvs.push([uva,uvb,uvd]),e.faces.push(new Ke.Face3(b,c,Yi)),e.uvs.push([uvb.clone(),uvc,uvd.clone()]);if(this.endClosed)for(a=e.vertices.length-1,s=0;s<(_?g:g-1);s++)jp=(s+1)%g,b=u[u.length-1][s],c=u[u.length-1][jp],uva=new Ke.Vec2(0,0),uvb=new Ke.Vec2(1,s/g),uvc=new Ke.Vec2(1,(s+1)/g),e.faces.push(new Ke.Face3(a,b,c)),e.uvs.push([uva,uvb,uvc]);return e}}),Ke.CurvePlane=function(t,e,i,n){this.pathH=t,this.pathV=e,this.segmentsH=i||20,this.segmentsV=n||20,Ke.Entity.call(this)},Ke.extend(Ke.CurvePlane,Ke.Entity,{constructor:Ke.CurvePlane,className:"TGL.CurvePlane",computeData:function(){var t={};if(t.faces=[],t.uvs=[],t.vertices=[],null==this.pathV||null==this.pathH)return t;var e,i,n,s,r,a,o,h,l,c=this.pathV,u=this.pathH,d=this.segmentsV,f=this.segmentsH,g=d+1,_=f+1;for(this.grid=[],e=0;e<_;e++){this.grid[e]=[];var p=u.getPointAt(e/_);for(i=0;i<g;i++){var v=c.getPointAt(i/g);this.grid[e][i]=t.vertices.push(new Je(p.x,v.y,p.z+v.z))-1}}for(e=0;e<f;e++)for(i=0;i<d;i++)n=this.grid[e][i],s=this.grid[e][i+1],r=this.grid[e+1][i+1],a=this.grid[e+1][i],o=new Qe(e/_,i/g),h=new Qe(e/_,(i+1)/g),uvc=new Qe((e+1)/_,(i+1)/g),l=new Qe((e+1)/_,i/g),t.faces.push(new _i(n,r,s)),t.uvs.push([o,uvc,h]),t.faces.push(new _i(n,a,r)),t.uvs.push([o.clone(),l.clone(),uvc]);return t}}),Ke.ComboNode=function(t,e,i,n,s){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var r=t;this.combos=r.combos||[],this.operators=r.operators,this.centralized=i,this.names=s,this._id=r.id}else this.combos=t||[],this.operators=e,this.centralized=i,this._id=n,this.names=s;this.csgs=[],Ke.Entity.call(this)},Ke.extend(Ke.ComboNode,Ke.Entity,{constructor:Ke.ComboNode,className:"TGL.ComboNode",__accessor:["combos","operators","centralized","names"],
__SizePropeties:["combos","operators","centralized"],getOffsetPosition:function(){return this._offsetPosition},getSideIndexMapping:function(){var t,e,i,n,s=this.combos,r=this.names||[],a={},o=0;if(s&&s.length)for(i=0;i<s.length;i++){t=s[i],e=r[i],e||(n=t.getClassName(),n&&n.indexOf(".")>0&&(n=n.substr(n.lastIndexOf(".")+1)),e=n+""+i,e=e.toLowerCase());var h=t.getSideIndexMapping();if(h)for(var l in h)a[e+"-"+l]=o++;else a[e]=o++}return a},computeData:function(){this.csgs=[];var t={vertices:[],faces:[],uvs:[],uv2s:[]};if(!this.combos)return t;if(null==this.operators||0==this.operators.length){var i=yi.mergeElements(this.combos);if(this.materialSize=i.material.materials.length,this.material=i.material,this.orgMaterial=i.material,t={vertices:i.vertices,faces:i.faces,uvs:i.uvs,uv2s:i.uv2s||[]},this.centralized&&t.vertices){var n=new Ke.BoundingBox;n.setFromPoints(t.vertices);var s=n.center();for(a=0;a<t.vertices.length;a++){var r=t.vertices[a];r.sub(s)}this._offsetPosition=s}return t}this.operators=this.operators||[];var a,o,h,l,c=this.combos.length;for(a=0;a<c;a++)this.csgs.push(new Ke.CSG(this.combos[a]));for(a=0;a<c;a++)null==o?o=this.csgs[a]:(h=this.operators[a-1],"+"===h||h==e?o=o.union(this.csgs[a]):"-"===h?o=o.substract(this.csgs[a]):"^"===h&&(o=o.intersect(this.csgs[a])));if(!o)return t;if(l=o.toMesh(),"centralized"==this.changeProperty&&null!=this.material||(this.materialSize=l.material.materials.length,this.material=l.material,this.orgMaterial=l.material),t={vertices:l.vertices,faces:l.faces,uvs:l.uvs,uv2s:l.uv2s},this.centralized&&t.vertices){var n=new Ke.BoundingBox;n.setFromPoints(t.vertices);var s=n.center();for(a=0;a<t.vertices.length;a++){var r=t.vertices[a];r.sub(s)}this._offsetPosition=s}return l=e,t},computeNodeMaterial:function(t){this.material=t.material,this.materialSize=t.materialSize},cacheNodeMaterial:function(t){t.material=this.material,t.materialSize=this.materialSize},needComputeVertexNormal:function(){return!0},generatePrimitiveKey:function(){return null},changeMapping:function(t){var e=this.getMaterialMapping();Ke.Utils.isSame(t,e)||(this.batch?this.materialMappingChanges=[t,e]:(this.onMaterialMapping(),this.firePropertyChange("materialMapping",t,e)))},isStyleEquals:function(t,e,i){return!1},getSelectStyle:function(){var t=this.getStyle("select.style");return"outline.normal"!=t&&"outline"!=t||(t="outline.wireframe"),t},onMaterialMapping:function(){this.groups=e,this.primitive.groups=e}}),Ke.Terrain=function(t){if(t=t||{},this._id=t.id,this.width=t.width,this.depth=t.depth,this.segmentsW=t.segmentsW||30,this.segmentsD=t.segmentsD||30,this.heightMap=t.heightMap,this.heightUnit=t.heightUnit||1,this.maxHeight=t.maxHeight||255,this.minHeight=t.minHeight||0,this.baseLayerHeight=t.baseLayerHeight||0,"string"==typeof this.heightMap?(this.image=new Image,this.image.src=this.heightMap):ei.isCanvas(this.heightMap)?this.canvas=this.heightMap:ei.isImage(this.heightMap)&&(this.image=this.heightMap),this.image){var e=this;this.image.onload=function(t){var i=document.createElement("canvas");i.width=e.image.width,i.height=e.image.height;var n=i.getContext("2d");n.drawImage(e.image,0,0),e.canvas=i,e.computed=!1,e.computeNodeData(),e.firePropertyChange("width",0,1)}}this.materialSize=2,Ke.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},Ke.extend(Ke.Terrain,Ke.Entity,{constructor:Ke.Terrain,className:"TGL.Terrain",__accessor:["width","heightUnit","depth","segmentsW","segmentsD","heightMap","heightUnit","maxHeight","minHeight","baseLayerHeight","smooth"],__SizePropeties:["width","heightUnit","depth","segmentsW","segmentsD","heightMap","heightUnit","maxHeight","minHeight","baseLayerHeight","smooth"],__bool:["smooth"],computeLayerData:function(t,e,i){var n,s,r=this.width/2,a=this.depth/2,o=i?this.segmentsW:1,h=i?this.segmentsD:1,l=o+1,c=h+1,u=this.width/o,d=this.depth/h,f=new Ke.Vec3(0,0,1),g=t.vertices.length;for(s=0;s<c;s++)for(n=0;n<l;n++){var _=n*u-r,p=s*d-a,v=0;v=i?i.call(this,n/l,s/c):this.baseLayerHeight*this.heightUnit,t.vertices.push(new Ke.Vec3(_,v,p))}for(s=0;s<h;s++)for(n=0;n<o;n++){var m=n+l*s+g,y=n+l*(s+1)+g,A=n+1+l*(s+1)+g,x=n+1+l*s+g,w=new Ke.Vec2(n/o,1-s/h),b=new Ke.Vec2(n/o,1-(s+1)/h),S=new Ke.Vec2((n+1)/o,1-(s+1)/h),C=new Ke.Vec2((n+1)/o,1-s/h);if(i){var T=new Ke.Face3(m,y,x);T.materialIndex=e,t.faces.push(T),t.uvs.push([w,b,C]),T=new Ke.Face3(y,A,x),T.materialIndex=e,t.faces.push(T),t.uvs.push([b.clone(),S,C.clone()])}else{var T=new Ke.Face4(m,y,A,x);T.normal.copy(f),T.vertexNormals.push(f.clone(),f.clone(),f.clone(),f.clone()),T.materialIndex=e,t.faces.push(T),t.uvs.push([w,b,S,C])}}},computeData:function(){var t={};return t.vertices=[],t.faces=[],t.uvs=[],this.computeLayerData(t,0),this.computeLayerData(t,1,this.getHeight),t},getFaceNormal:function(t,e){this.computeFaceNormals();var i=this.segmentsW*t,n=this.segmentsD*e,s=Math.floor(i),r=Math.floor(n),a=r*this.segmentsW+s;a=2*a+1,s!=Math.round(i)&&r!=Math.round(n)&&a++;var o=this.faces[a];this.vertices[o.a],this.vertices[o.b],this.vertices[o.c];return o.normal.clone()},setHeightMap:function(t){if(this.heightMap=t,"string"==typeof this.heightMap?(this.image=new Image,this.image.src=this.heightMap):ei.isCanvas(this.heightMap)?this.canvas=this.heightMap:ei.isImage(this.heightMap)&&(this.image=this.heightMap),this.image){var e=this;if(this.image.width){var i=document.createElement("canvas");i.width=e.image.width,i.height=e.image.height;var n=i.getContext("2d");n.drawImage(e.image,0,0),e.canvas=i,e.computed=!1,e.computeNodeData(),e.firePropertyChange("width",0,1)}else this.image.onload=function(t){var i=document.createElement("canvas");i.width=e.image.width,i.height=e.image.height;var n=i.getContext("2d");n.drawImage(e.image,0,0),e.canvas=i,e.computed=!1,e.computeNodeData(),e.firePropertyChange("width",0,1)}}},getHeight:function(t,e){if(null==this.canvas)return 0;var i=this.canvas;if(null==this.heightData){for(var n=i.width*i.height,s=new Float32Array(n),r=0;r<n;r++)s[r]=0;for(var a=i.getContext("2d"),o=a.getImageData(0,0,i.width,i.height),h=o.data,l=0,r=0,c=h.length;r<c;r+=4){var u=h[r]+h[r+1]+h[r+2];s[l++]=u/3}this.heightData=s}var d=t*i.width,f=e*i.height,g=Math.floor(d),_=Math.floor(f),p=[],v=[];p.push(g),d!=g&&p.push(g+1),v.push(_),f!=_&&v.push(_+1);var r,l,m,y=p.length*v.length,A=0;for(r=0;r<p.length;r++)for(l=0;l<v.length;l++)m=v[l]*i.width+p[r],A+=this.heightData[m];return A/=y,A=Ke.Math.clamp(A,this.minHeight,this.maxHeight),A*=this.heightUnit},getSideIndexMapping:function(){return Ke.Terrain.SideIndexMapping},refreshUniforms:function(t){t.heightUnit&&(t.heightUnit.value=this.heightUnit)}}),Ke.Terrain.SideIndexMapping={layer0:0,layer1:1},Ke.Link=function(t,e,i){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var n=arguments[0];t=n.fromNode,e=n.toNode,this._id=n.id}else this._id=i;Ke.Line.call(this),this.setFromNode(t),this.setToNode(e),this._editable=!1},Ke.extend(Ke.Link,Ke.Line,{className:"TGL.Link",___accessor:["linkType","extend","controls"],__SizePropeties:["fromNode","toNode","linkType","extend","controls"],setFromNode:function(t){if(this._fromNode!=t){var e=this._fromNode;this._fromNode=t,this.onPropertyChange(),this.firePropertyChange("fromNode",e,t),this._fromNode=t,e&&(e._removeFromLink(this),e.removePropertyChangeListener(this.handleNodePropertyChange)),this._fromNode&&(this._fromNode._addFromLink(this),this._fromNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getFromNode:function(){return this._fromNode},setToNode:function(t){if(this._toNode!=t){var e=this._toNode;this._toNode=t,this.onPropertyChange(),this.firePropertyChange("toNode",e,t),e&&(e.removePropertyChangeListener(this.handleNodePropertyChange),e._removeToLink(this)),this._toNode&&(this._toNode._addToLink(this),this._toNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getToNode:function(){return this._toNode},isLooped:function(){return this._fromNode===this._toNode&&null!=this._fromNode&&null!=this._toNode},handleNodePropertyChange:function(t){if(t.property.startsWith("position")||"worldMatrix"==t.property){var e=this.vertices;this.onPropertyChange(),this.firePropertyChange("vertices",e,this.vertices)}},computeNodeData:function(){this.computeData()},updateMatrix:function(){},updateWorldMatrix:function(){},computeData:function(){if(null!=this._fromNode&&null!=this._toNode){null==this._extend&&(this._extend=0);var t=this._fromNode.worldMatrix.getPosition(),e=this._toNode.worldMatrix.getPosition(),i=[];if(i.push(t.clone()),"orthogonal.x"==this._linkType){var n=Math.max(t.x,e.x),s=new Je(n+this._extend,t.y,t.z);i.push(s),s=new Je(n+this._extend,e.y,e.z),i.push(s)}else if("orthogonal.x.n"==this._linkType){var r=Math.min(t.x,e.x),s=new Je(r-this._extend,t.y,t.z);i.push(s),s=new Je(r-this._extend,e.y,e.z),i.push(s)}else if("orthogonal.y"==this._linkType){var a=Math.max(t.y,e.y),s=new Je(t.x,a+this._extend,t.z);i.push(s),s=new Je(e.x,a+this._extend,e.z),i.push(s)}else if("orthogonal.y.n"==this._linkType){var o=Math.min(t.y,e.y),s=new Je(t.x,o-this._extend,t.z);i.push(s),s=new Je(e.x,o-this._extend,e.z),i.push(s)}else if("orthogonal.z"==this._linkType){var h=Math.max(t.z,e.z),s=new Je(t.x,t.y,h+this._extend);i.push(s),s=new Je(e.x,e.y,h+this._extend),i.push(s)}else if("orthogonal.z.n"==this._linkType){var l=Math.min(t.z,e.z),s=new Je(t.x,t.y,l-this._extend);i.push(s),s=new Je(e.x,e.y,l-this._extend),i.push(s)}else if("control"==this._linkType){var c=this._controls;if(c&&c.length>0)for(var u=0;u<c.length;u++)c[u]instanceof Je&&i.push(c[u].clone())}i.push(e.clone()),this.vertices=i}},onPropertyChange:function(){this.vertices=this.vertices||[],this.computeData(),this.computeBoundingBox(),this.selectionData=null,this.boundingSphere=null}}),Ke.PathLink=function(t,e,i){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var n=arguments[0];t=n.fromNode,e=n.toNode,this._id=n.id}else this._id=i;Ke.PathNode.call(this),this._autoAjust=!0,this.setFromNode(t),this.setToNode(e)},Ke.PathLink.allLinkTypes=["extend.x","extend.y","extend.z","extend.x.n","extend.y.n","extend.z.n","orthogonal.x","orthogonal.y","orthogonal.z","orthogonal.x.n","orthogonal.y.n","orthogonal.z.n","flex.x","flex.y","flex.z","flex.yz","flex.xz","flex.xy"],Ke.extend(Ke.PathLink,Ke.PathNode,{className:"TGL.PathLink",___accessor:["linkType","extend","controls","fromOffset","toOffset"],__SizePropeties:["fromOffset","toOffset","path","segments","radius","segmentsR","startCap","endCap","shape","startCapSize","endCapSize","segmentsCap","arc","arcStart","cutSurface","startCapR","endCapR","startCapExtend","endCapExtend","fromNode","toNode","linkType","extend","controls"],setFromNode:function(t){if(this._fromNode!=t){var e=this._fromNode;this._fromNode=t,this._dirtyPath=!0,this.onPropertyChange("fromNode",e,t),this.firePropertyChange("fromNode",e,t),this._fromNode=t,e&&(e._removeFromLink(this),e.removePropertyChangeListener(this.handleNodePropertyChange)),this._fromNode&&(this._fromNode._addFromLink(this),this._fromNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getFromNode:function(){return this._fromNode},setToNode:function(t){if(this._toNode!=t){var e=this._toNode;this._toNode=t,this.onPropertyChange("toNode",e,t),this.firePropertyChange("toNode",e,t),e&&(e.removePropertyChangeListener(this.handleNodePropertyChange),e._removeToLink(this)),this._toNode&&(this._toNode._addToLink(this),this._toNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getToNode:function(){return this._toNode},isLooped:function(){return this._fromNode===this._toNode&&null!=this._fromNode&&null!=this._toNode},handleNodePropertyChange:function(t){var e=t.source,i=t.property;if(i.startsWith("position")||i.startsWith("rotation")||i.startsWith("scale")||"worldMatrix"==i||"linkAgent"===i||e.isSizeChangedProperty(i)||"parent"===i){this.vertices;this._dirtyPath=!0;var n=this;mi.PATH_LINK_COMPUTE_DELAY?setTimeout(function(){n._computePath()},10):n._computePath()}},_resetPath:function(){if(this.path){var t=!1;if("arrow"!==this.endCap)return this.path;if(this.endCapExtend*this.endCapR>1)return this.path;t=!0;var e,i,n,s=this.path,r=new Ke.Path,a=s.actions.length,o=null;for(i=0;i<a-1;i++)e=s.actions[i],n=e.args,o=new Ke.Vec3(n[0],n[1],n[2]),"moveTo"===e.action?r.moveTo(n[0],n[1],n[2]):"lineTo"===e.action?r.lineTo(n[0],n[1],n[2]):"quadraticCurveTo"===e.action&&(r.curveTo(n[0],n[1],n[2],n[3],n[4],n[5]),o=new Ke.Vec3(n[3],n[4],n[5]));if(i=a-1,e=s.actions[i],n=e.args,"lineTo"===e.action){var h=new Ke.Vec3(n[0],n[1],n[2]),l=(new Je).subVectors(h,o).normalize(),a=this.radius*this.endCapSize,c=null;c=(new Je).subVectors(h,o).length()<a?o.add(l.multiplyScalar(.1)):h.clone().sub(l.multiplyScalar(a)),r.lineTo(c.x,c.y,c.z)}return r}},_getNodeOffset:function(t,e,i){e=t.worldToLocal(e.clone()),i=t.worldToLocal(i.clone());var n=(new Je).subVectors(i,e),s=n.length(),r=t.getLinkOffset(n);return r&&r.length()>s&&r.normalize().multiplyScalar(s-.1),r||new Je(0,0,0)},updateMatrix:function(){},updateWorldMatrix:function(t,e){},onPropertyChange:function(t,e,i){"fromNode"!==t&&"toNode"!==t&&"linkType"!==t&&"extend"!==t&&"controls"!==t&&"fromOffset"!==t&&"toOffset"!==t||(this._dirtyPath=!0),Ke.Node.prototype.onPropertyChange.call(this,t,e,i)},computeData:function(){return this._computePath(),Ke.PathNode.prototype.computeData.call(this)},_clearFromNodeExtend:function(t,e,i){},_flex:function(t,e,i,n,s){t=t.substr(t.indexOf(".")+1);for(var r,a=["x","y","z"],o=new Je,h=new Je,l=0;l<3;l++)r=a[l],o[r]=r===t?n[r]:e[r],h[r]=r===t?n[r]:i[r];s.push(o,h)},_flex2:function(t,e,i,n){t=t.substr(t.indexOf(".")+1);var s=["x","y","z"],r=t[0],a=t[1];if(e[r]!=i[r]){for(var o=new mono.Vec3,h=0;h<s.length;h++)o[s[h]]=s[h]==r?i[s[h]]:e[s[h]];n.push(o)}if(e[a]!=i[a]){for(var l=new mono.Vec3,h=0;h<s.length;h++)l[s[h]]=s[h]==r||s[h]==a?i[s[h]]:e[s[h]];n.push(l)}},_orthogonal:function(t,e,i,n){t=t.substr(t.indexOf(".")+1);var s,r=!1,a=["x","y","z"],o=new Je,h=0;t.endsWith(".n")&&(r=!0,t=t[0]);for(var l=r?e[t]:i[t],c=0;c<a.length;c++)s=a[c],s!==t&&e[s]==i[s]&&h++;if(2!==h){for(var c=0;c<a.length;c++)s=a[c],s!==t?o[s]=l:o[s]=r?i[s]:e[s];n.push(o)}},_removeSamePoint:function(t){},_computePath:function(){if(this._dirtyPath&&(this._dirtyPath=!1,null!=this._fromNode&&null!=this._toNode)){null==this._extend&&(this._extend=0);var t=this._fromNode.getLinkAgent()||this._fromNode,e=this._toNode.getLinkAgent()||this._toNode,i=t.localToWorld2(new Je(0,0,0)),n=e.localToWorld2(new Je(0,0,0));if(t==e){var s=new mono.Path;return s.moveTo(i.x,i.y,i.z),s.lineTo(i.x,i.y+200,i.z),s.lineTo(i.x+200,i.y+200,i.z),s.lineTo(i.x+200,i.y,i.z),s.lineTo(i.x,i.y,i.z),this.setPath(s),s}if(i.equals(n))return void this.setPath(null);var s,r,a=[],o=this.radius*this.endCapSize;if(this._linkType&&this._linkType.startsWith("extend")){var i,n,h,l,c,u,d;if("extend.x"===this._linkType){h=new Je(1,0,0);var i=t.localToWorld2(t.getLinkExtend(h.clone())),n=e.localToWorld2(e.getLinkExtend(h));d=Math.max(i.x,n.x),u=d+this._extend+o+.1,l=new Je(u,i.y,i.z),c=new Je(u,n.y,n.z)}else if("extend.y"===this._linkType){h=new Je(0,1,0);var i=t.localToWorld2(t.getLinkExtend(h.clone())),n=e.localToWorld2(e.getLinkExtend(h));d=Math.max(i.y,n.y),u=d+this._extend+o+.1,l=new Je(i.x,u,i.z),c=new Je(n.x,u,n.z)}else if("extend.z"===this._linkType){h=new Je(0,0,1);var i=t.localToWorld2(t.getLinkExtend(h.clone())),n=e.localToWorld2(e.getLinkExtend(h));d=Math.max(i.z,n.z),u=d+this._extend+o+.1,l=new Je(i.x,i.y,u),c=new Je(n.x,n.y,u)}else if("extend.x.n"===this._linkType){h=new Je((-1),0,0);var i=t.localToWorld2(t.getLinkExtend(h.clone())),n=e.localToWorld2(e.getLinkExtend(h));d=Math.min(i.x,n.x),u=d-this._extend-o-.1,l=new Je(u,i.y,i.z),c=new Je(u,n.y,n.z)}else if("extend.y.n"===this._linkType){h=new Je(0,(-1),0);var i=t.localToWorld2(t.getLinkExtend(h.clone())),n=e.localToWorld2(e.getLinkExtend(h));d=Math.min(i.y,n.y),u=d-this._extend-o-.1,l=new Je(i.x,u,i.z),c=new Je(n.x,u,n.z)}else if("extend.z.n"===this._linkType){h=new Je(0,0,(-1));var i=t.localToWorld2(t.getLinkExtend(h.clone())),n=e.localToWorld2(e.getLinkExtend(h));d=Math.min(i.z,n.z),u=d-this._extend-o-.1,l=new Je(i.x,i.y,u),c=new Je(n.x,n.y,u)}l?a.push(i,l,c,n):a.push(i,n)}else{if(a.push(i),"orthogonal.x"===this._linkType){if(i.y!=n.y||i.z!=n.z){var f=n.x,g=new Je(f,i.y,i.z);a.push(g)}}else if("orthogonal.x.n"===this._linkType){var f=i.x,g=new Je(f,n.y,n.z);a.push(g)}else if("orthogonal.y"===this._linkType){var _=n.y,g=new Je(i.x,_,i.z);a.push(g)}else if("orthogonal.y.n"===this._linkType){var _=i.y,g=new Je(n.x,_,n.z);a.push(g)}else if("orthogonal.z"===this._linkType){var g=new Je(i.x,i.y,n.z);a.push(g)}else if("orthogonal.z.n"===this._linkType){var g=new Je(n.x,n.y,i.z);a.push(g)}var p=new Je(i.x+n.x,i.y+n.y,i.z+n.z).multiplyScalar(.5);if(("flex.x"===this._linkType||"flex.y"===this._linkType||"flex.z"===this._linkType)&&this._flex(this._linkType,i,n,p,a),("flex.yz"===this._linkType||"flex.zy"===this._linkType||"flex.xy"===this._linkType||"flex.yx"===this._linkType||"flex.xz"===this._linkType||"flex.zx"===this._linkType)&&this._flex2(this._linkType,i,n,a),"control"===this._linkType){var v=this.getControls();yi.isArray(v)&&(a=a.concat(v))}a.push(n),r=a.length;var m=this._getNodeOffset(t,a[0].clone(),a[1].clone()),y=this._getNodeOffset(e,a[r-1].clone(),a[r-2].clone());i=t.localToWorld2(m),n=e.localToWorld2(y),a[0]=i,a[r-1]=n}var r=a.length,A=this.getFromOffset(),x=this.getToOffset();A&&a[0].add(A),x&&a[r-1].add(x);for(var w,s=new Ke.Path,b=0;b<r;b++)w=a[b],0===b?s.moveTo(w.x,w.y,w.z):s.lineTo(w.x,w.y,w.z);return this.setPath(s),s}}}),mono.LoadingManager=function(t,i,n){var s=this,r=0,a=0;this.onLoad=t,this.onProgress=i,this.onError=n,this.itemStart=function(t){a++},this.itemEnd=function(t){r++,s.onProgress!==e&&s.onProgress(t,r,a),r===a&&s.onLoad!==e&&s.onLoad()}},mono.DefaultLoadingManager=new mono.LoadingManager,mono.ImageLoader=function(t){this.manager=t!==e?t:mono.DefaultLoadingManager},mono.ImageLoader.prototype={constructor:mono.ImageLoader,load:function(t,i,n,s){var r=this,a=document.createElement("img");return i!==e&&a.addEventListener("load",function(e){r.manager.itemEnd(t),i(this)},!1),n!==e&&a.addEventListener("progress",function(t){n(t)},!1),s!==e&&a.addEventListener("error",function(t){s(t)},!1),this.crossOrigin!==e&&(a.crossOrigin=this.crossOrigin),a.src=t,r.manager.itemStart(t),a},loadFile:function(t,i,n,s){var r=this,a=new FileReader;i!==e&&(a.onload=function(){i(a.result),r.manager.itemEnd(t.name)}),n!==e&&a.addEventListener("progress",function(t){n(t)},!1),s!==e&&a.addEventListener("error",function(t){s(t)},!1),a.readAsDataURL(t),r.manager.itemStart(t.name)},setCrossOrigin:function(t){this.crossOrigin=t}},mono.XHRLoader=function(t){this.manager=t!==e?t:mono.DefaultLoadingManager},mono.XHRLoader.prototype={constructor:mono.XHRLoader,load:function(t,i,n,s){var r=this,a=new XMLHttpRequest;i!==e&&a.addEventListener("load",function(e){i(e.target.responseText),r.manager.itemEnd(t)},!1),n!==e&&a.addEventListener("progress",function(t){n(t)},!1),s!==e&&a.addEventListener("error",function(t){s(t)},!1),this.crossOrigin!==e&&(a.crossOrigin=this.crossOrigin),a.open("GET",t,!0),a.send(null),r.manager.itemStart(t)},loadFile:function(t,i,n,s){if(t){var r=this,a=new FileReader;i!==e&&(a.onload=function(){i(a.result),r.manager.itemEnd(t.name)}),n!==e&&a.addEventListener("progress",function(t){n(t)},!1),s!==e&&a.addEventListener("error",function(t){s(t)},!1),a.readAsText(t),r.manager.itemStart(t.name)}},setCrossOrigin:function(t){this.crossOrigin=t}},mono.MTLLoader=function(t,e,i){this.baseUrl=t,this.options=e,this.crossOrigin=i},mono.extend(mono.MTLLoader,null,{constructor:mono.MTLLoader,load:function(t,e,i,n){var s=this,r=new mono.XHRLoader;r.setCrossOrigin(this.crossOrigin),r.load(t,function(t){e(s.parse(t))})},loadFile:function(t,e,i,n){var s=this,r=new mono.XHRLoader;r.loadFile(t,function(t){e(s.parse(t))})},loadText:function(t,e){e(this.parse(t))},parse:function(t){var e=t.split("\n"),i={},n=/\s+/,s={};this.baseUrl||(this.baseUrl={});for(var r=0;r<e.length;r++){var a=e[r];if(a=a.trim(),0!==a.length&&"#"!==a.charAt(0)){var o=a.indexOf(" "),h=o>=0?a.substring(0,o):a;h=h.toLowerCase();var l=o>=0?a.substring(o+1):"";if(l=l.trim(),"newmtl"===h)i={name:l},s[l]=i;else if(i)if("ka"===h||"kd"===h||"ks"===h){var c=l.split(n,3);i[h]=[parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2])]}else if("map_kd"===h||"map_ka"===h){var u=l;if(l.indexOf(".")>0){l=l.substring(0,l.lastIndexOf(".")).toLowerCase();var d={};if(/\-s/.test(l)){var f=/\-s( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;d=f.exec(l);var g=l.split(d[0]);l=g[g.length-1].trim();var _=u.split(d[0]);u=_[_.length-1].trim()}if(/\-t/.test(l)){var f=/\-t( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;d=f.exec(l);var g=l.split(d[0]);l=g[g.length-1].trim();var _=u.split(d[0]);u=_[_.length-1].trim()}}this.baseUrl[l]=u,i[h]=u}else i[h]=l}}var p=new mono.MTLLoader.MaterialCreator(this.baseUrl,this.options);return p.setMaterials(s),p}}),mono.MTLLoader.MaterialCreator=function(t,e){this.baseUrl=t,this.options=e,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:mono.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:mono.RepeatWrapping},mono.extend(mono.MTLLoader.MaterialCreator,mono.EventDispatcher,{constructor:mono.MTLLoader.MaterialCreator,setMaterials:function(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(t){if(!this.options)return t;var e={};for(var i in t){var n=t[i],s={};e[i]=s;for(var r in n){var a=!0,o=n[r],h=r.toLowerCase();switch(h){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(o=[o[0]/255,o[1]/255,o[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===o[0]&&0===o[1]&&0===o[1]&&(a=!1);break;case"d":this.options&&this.options.invertTransparency&&(o=1-o)}a&&(s[h]=o)}}return e},preload:function(){for(var t in this.materialsInfo)this.create(t)},getIndex:function(t){return this.nameLookup[t]},getAsArray:function(){var t=0;for(var e in this.materialsInfo)this.materialsArray[t]=this.create(e),this.nameLookup[e]=t,t++;return this.materialsArray},create:function(t){return this.materials[t]===e&&this.createMaterial_(t),this.materials[t]},createMaterial_:function(t){var e=this,i=this.materialsInfo[t],n={name:t,side:this.side};for(var s in i){var r=i[s];switch(s.toLowerCase()){case"kd":n.diffuse=(new mono.Color).setRGB(r[0],r[1],r[2]);break;case"ka":n.ambient=(new mono.Color).setRGB(r[0],r[1],r[2]);break;case"ks":n.specular=(new mono.Color).setRGB(r[0],r[1],r[2]);break;case"map_kd":if("string"==typeof this.baseUrl)n.map={},n.map.img=this.baseUrl+r,n.map.wrapS=this.wrap,n.map.wrapT=this.wrap;else if("object"==typeof this.baseUrl&&r.indexOf(".")>0){r=r.substring(0,r.lastIndexOf(".")).toLowerCase();var a={};if(/\-s/.test(r)){var o=/\-s( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;a=o.exec(r);var h=r.split(a[0]);r=h[h.length-1].trim(),a.repeatR=parseInt(a[1]),a.repeatC=parseInt(a[2])}if(/\-t/.test(r)){var o=/\-t( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;a=o.exec(r);var h=r.split(a[0]);r=h[h.length-1].trim(),a.repeatR=parseInt(a[1]),a.repeatC=parseInt(a[2])}this.baseUrl[r]&&(n.map={},n.map.img=this.baseUrl[r],n.map.wrapS=e.wrap,n.map.wrapT=e.wrap,n.map.repeatR=a.repeatR||1,n.map.repeatC=a.repeatC||1)}break;case"ns":n.shininess=r;break;case"d":r<1&&(n.transparent=!0,n.opacity=r)}}return n.diffuse&&(n.ambient||(n.ambient=n.diffuse),n.color=n.diffuse),this.materials[t]=n,this.materials[t]},loadTexture:function(t,e,i,n){var s=/\.dds$/i.test(t);if(s)var r=mono.ImageUtils.loadCompressedTexture(t,e,i,n);else{var a=new Image,r=new mono.Texture(a,e),o=new mono.ImageLoader;o.crossOrigin=this.crossOrigin,o.load(t,function(t){r.image=mono.MTLLoader.ensurePowerOfTwo_(t),r.needsUpdate=!0,i&&i(r)})}return r}}),mono.MTLLoader.ensurePowerOfTwo_=function(t){if(!mono.MTLLoader.isPowerOfTwo_(t.width)||!mono.MTLLoader.isPowerOfTwo_(t.height)){var e=document.createElement("canvas");e.width=mono.MTLLoader.nextHighestPowerOfTwo_(t.width),e.height=mono.MTLLoader.nextHighestPowerOfTwo_(t.height);var i=e.getContext("2d");return i.drawImage(t,0,0,t.width,t.height,0,0,e.width,e.height),e}return t},mono.MTLLoader.isPowerOfTwo_=function(t){return 0===(t&t-1)},mono.MTLLoader.nextHighestPowerOfTwo_=function(t){--t;for(var e=1;e<32;e<<=1)t|=t>>e;return t+1},mono.OBJLoader=function(t){this.manager=t!==e?t:mono.DefaultLoadingManager},mono.extend(mono.OBJLoader,Object,{constructor:mono.ObJLoader,load:function(t,e,i,n){var s=this,r=new mono.XHRLoader(s.manager);r.setCrossOrigin(this.crossOrigin),r.load(t,function(t){e(s.parse(t))})},parse:function(t){function i(t,e,i){return new mono.Vec3(t,e,i)}function n(t,e){return new mono.Vec2(t,e)}function s(t,e,i,n){return new mono.Face3(t,e,i,n)}function r(t,i,n,r){r===e?h.faces.push(s(parseInt(t)-(u+1),parseInt(i)-(u+1),parseInt(n)-(u+1))):h.faces.push(s(parseInt(t)-(u+1),parseInt(i)-(u+1),parseInt(n)-(u+1),[f[parseInt(r[0])-1].clone(),f[parseInt(r[1])-1].clone(),f[parseInt(r[2])-1].clone()]))}function a(t,e,i){h.uvs.push([g[parseInt(t)-1].clone(),g[parseInt(e)-1].clone(),g[parseInt(i)-1].clone()])}function o(t,i,n){t[3]===e?(r(t[0],t[1],t[2],n),i!==e&&i.length>0&&a(i[0],i[1],i[2])):(n!==e&&n.length>0?(r(t[0],t[1],t[3],[n[0],n[1],n[3]]),r(t[1],t[2],t[3],[n[1],n[2],n[3]])):(r(t[0],t[1],t[3]),r(t[1],t[2],t[3])),i!==e&&i.length>0&&(a(i[0],i[1],i[3]),a(i[1],i[2],i[3])))}var h,l,c=new mono.Element,u=0;/^o /gm.test(t)===!1&&(h=new mono.Entity,l=new mono.BasicMaterial,h.setStyle("m.type","phong"),c.addChild(h));for(var d=0,f=[],g=[],_=/v( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,p=/vn( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,v=/vt( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,m=/f( +\d+)( +\d+)( +\d+)( +\d+)?/,y=/f( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))?/,A=/f( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))?/,x=/f( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))?/,w=t.split("\n"),b=0;b<w.length;b++){var S=w[b];S=S.trim();var C;if(0!==S.length&&"#"!==S.charAt(0))if(null!==(C=_.exec(S)))h.vertices.push(i(parseFloat(C[1]),parseFloat(C[2]),parseFloat(C[3])));else if(null!==(C=p.exec(S)))f.push(i(parseFloat(C[1]),parseFloat(C[2]),parseFloat(C[3])));else if(null!==(C=v.exec(S)))g.push(n(parseFloat(C[1]),parseFloat(C[2])));else if(null!==(C=m.exec(S)))o([C[1],C[2],C[3],C[4]]);else if(null!==(C=y.exec(S)))o([C[2],C[5],C[8],C[11]],[C[3],C[6],C[9],C[12]]);else if(null!==(C=A.exec(S)))o([C[2],C[6],C[10],C[14]],[C[3],C[7],C[11],C[15]],[C[4],C[8],C[12],C[16]]);else if(null!==(C=x.exec(S)))o([C[2],C[5],C[8],C[11]],[],[C[3],C[6],C[9],C[12]]);else if(/^o /.test(S))h!==e&&(u+=h.vertices.length),h=new mono.Entity,l=new mono.BasicMaterial,h.setStyle("m.type","phong"),h._name=S.substring(2).trim(),c.addChild(h),d=0;else if(!/^g /.test(S))if(/^usemtl /.test(S)){S.substring(7).trim()}else/^mtllib /.test(S)||/^s /.test(S)}for(var b=0,T=c._childList._as.length;b<T;b++){var h=c._childList._as[b];h.computed=!1,h.computeNodeData(),h.computeCentroids(),h.computeFaceNormals(),h.computeBoundingSphere()}return c}}),mono.OBJMTLLoader=function(){},mono.extend(mono.OBJMTLLoader,mono.MTLLoader,{constructor:mono.OBJMTLLoader,load:function(t,e,i,n,s,r){var a=this,o=new mono.MTLLoader(i);o.load(e,function(e){var s=e;s.preload();var r=new mono.XHRLoader(a.manager);r.setCrossOrigin(this.crossOrigin),r.load(t,function(e){var r=a.parse(e),o="";!i&&t.lastIndexOf("/")>0&&(o=t.substring(0,t.lastIndexOf("/")+1));for(var h=0;h<r._childList._as.length;h++){var l=r._childList._as[h];if(l.mname){var c=s.create(l.mname);a.setGeometryStyle(l,c,o)}for(var u=0;u<l._childList._as.length;u++){var d=l._childList._as[u];if(d.mname){var f=s.create(d.mname);a.setGeometryStyle(d,f,o)}}}n(r)})})},setGeometryStyle:function(t,e,i){if(e.map){this.loadTexture(t,i+e.map.img);var n=e.map.repeatR,s=e.map.repeatC;n&&s&&t.setStyle("m.texture.repeat",new mono.Vec2(n,s))}t.setStyle("m.ambient",e.ambient),t.setStyle("m.specular",e.specular),t.setStyle("m.color",e.color),e.transparent&&(t.setStyle("m.transparent",!0),t.setStyle("m.opacity",e.opacity))},loadBase64:function(t,e,i,n,s,r){var a=this,o=mono.base64decode(e),h=mono.base64decode(t),l=new mono.MTLLoader(i);l.loadText(o,function(t){var e=t;e.preload();var s=a.parse(h),r="";!i&&url.lastIndexOf("/")>0&&(r=url.substring(0,url.lastIndexOf("/")+1));for(var o=0;o<s._childList._as.length;o++){var l=s._childList._as[o];if(l.mname){var c=e.create(l.mname);a.setGeometryStyle(l,c,r)}for(var u=0;u<l._childList._as.length;u++){var d=l._childList._as[u];if(d.mname){var f=e.create(d.mname);a.setGeometryStyle(d,f,r)}}}n(s)})},loadFiles:function(t,e,i,n,s,r){var a=this,o=new mono.MTLLoader(i);o.loadFile(e,function(e){var i=e;i.preload();var s=new mono.XHRLoader(a.manager);s.loadFile(t,function(t){for(var e=a.parse(t),s=0;s<e._childList._as.length;s++){var r=e._childList._as[s];if(r.mname){var o=i.create(r.mname);a.setGeometryStyle(r,o)}for(var h=0;h<r._childList._as.length;h++){var l=r._childList._as[h];if(l.mname){var c=i.create(l.mname);a.setGeometryStyle(l,c)}}}n(e)})})},loadTexture:function(t,e){if("string"==typeof e)t.setStyle("m.texture.image",e);else if(t&&e){var i=new mono.ImageLoader;i.loadFile(e,function(e){t.setStyle("m.texture.image",e)})}},parse:function(t,i){function n(t,e,i){return new mono.Vec3(t,e,i)}function s(t,e){return new mono.Vec2(t,e)}function r(t,e,i,n,s){return new mono.Face3(t,e,i,n,null,s)}function a(t,i){if(g.length>0&&(f.vertices=g,m.length>0&&(f.setMaterialSize(m.length),f.setStyle("m.normalType",Ke.NormalTypeSmooth)),f.computed=!1,f.computeCentroids(),f.computeFaceNormals(),f.computeBoundingSphere(),f.faces.length>0)){var n=f._name;d.addChild(f),f=new mono.Entity,f._name=n,f.setStyle("m.type","phong"),_=0}t!==e&&(f._name=t),i!==e&&(f.mname=i)}function o(t,i,n,s,a){s===e?f.faces.push(r(parseInt(t)-(c+1),parseInt(i)-(c+1),parseInt(n)-(c+1))):f.faces.push(r(parseInt(t)-(c+1),parseInt(i)-(c+1),parseInt(n)-(c+1),[p[parseInt(s[0])-1].clone(),p[parseInt(s[1])-1].clone(),p[parseInt(s[2])-1].clone()],a))}function h(t,e,i){f.uvs.push([v[parseInt(t)-1].clone(),v[parseInt(e)-1].clone(),v[parseInt(i)-1].clone()])}function l(t,i,n){var s=m.length>0?m.indexOf(y):0;t[3]===e?(o(t[0],t[1],t[2],n,s),i!==e&&i.length>0&&h(i[0],i[1],i[2])):(n!==e&&n.length>0?(o(t[0],t[1],t[3],[n[0],n[1],n[3]],s),o(t[1],t[2],t[3],[n[1],n[2],n[3]],s)):(o(t[0],t[1],t[3]),o(t[1],t[2],t[3])),i!==e&&i.length>0&&(h(i[0],i[1],i[3]),h(i[1],i[2],i[3])))}var c=0,u=new mono.Entity,d=u,f=new mono.Entity;f.setStyle("m.type","phong");for(var g=[],_=0,p=[],v=[],m=[],y=0,A=/v( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,x=/vn( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,w=/vt( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,b=/f( +\d+)( +\d+)( +\d+)( +\d+)?/,S=/f( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))?/,C=/f( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))?/,T=/f( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))?/,E=/s( +(\d))?/,L=t.split("\n"),M=0;M<L.length;M++){var P=L[M];P=P.trim();var k;if(0!==P.length&&("#"!==P.charAt(0)||"o"==P.charAt(2)))if(null!==(k=A.exec(P)))g.push(n(parseFloat(k[1]),parseFloat(k[2]),parseFloat(k[3])));else if(null!==(k=x.exec(P)))p.push(n(parseFloat(k[1]),parseFloat(k[2]),parseFloat(k[3])));else if(null!==(k=w.exec(P)))v.push(s(parseFloat(k[1]),parseFloat(k[2])));else if(null!==(k=b.exec(P)))l([k[1],k[2],k[3],k[4]]);else if(null!==(k=S.exec(P)))l([k[2],k[5],k[8],k[11]],[k[3],k[6],k[9],k[12]]);else if(null!==(k=C.exec(P)))l([k[2],k[6],k[10],k[14]],[k[3],k[7],k[11],k[15]],[k[4],k[8],k[12],k[16]]);else if(null!==(k=T.exec(P)))l([k[2],k[5],k[8],k[11]],[],[k[3],k[6],k[9],k[12]]);else if("#"===P.charAt(0)&&"o"===P.charAt(2))a(),
c+=g.length,g=[],d=new mono.Entity,d._name=P.substring(2).trim(),u.addChild(d);else if(/^g /.test(P))a(P.substring(2).trim(),e);else if(/^usemtl /.test(P))a(e,P.substring(7).trim());else if(/^mtllib /.test(P)){if(i){var I=P.substring(7);I=I.trim(),i(I)}}else/^s /.test(P)&&(k=E.exec(P),m.indexOf(k[2])<0&&m.push(k[2]),y=k[2])}return a(e,e),u}}),DaeAdapter=mono.DaeAdapter=function(){function t(t,n,s){var r=0;if(t!==e){var a=t.split("/");a.pop(),K=(a.length<1?".":a.join("/"))+"/"}var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState){if(0==o.status||200==o.status)if(o.responseXML)i(o.responseXML,n,t);else if(o.responseText){var e=new DOMParser,a=e.parseFromString(o.responseText,"application/xml");i(a,n,t)}else console.error("ColladaLoader: Empty or non-existing file ("+t+")")}else 3==o.readyState&&s&&(0==r&&(r=o.getResponseHeader("Content-Length")),s({total:r,loaded:o.responseText.length}))},o.open("GET",t,!0),o.send(null)}function i(t,e,i){H=t,L(),Y=d(),G=new o,G.parse();var r=V();if(q=P(),j=I(),J=s(),G)for(var a=0;a<G.nodes.length;a++)n(G.nodes[a]);var h={lights:r,visualScenes:G,images:q,materials:J,geometries:Y,entityies:Q};e&&e(h)}function n(t,e){if(t){for(var i={},s=0;s<t.geometries.length;s++){var r,a=t.geometries[s],o=a.instance_material,h=Y[a.url],l={},c=[],u=0;if(h){if(!h.mesh||!h.mesh.primitives)continue;if(o)for(var d=0;d<o.length;d++){var f=o[d],g=J[f.target],_=g.instance_effect.url,p=j[_].shader,v=p.material;if(h.doubleSided){if(!(f.symbol in i)){var m=v.clone();m.side=mono.DoubleSide,i[f.symbol]=m}v=i[f.symbol]}v.opacity=v.opacity?v.opacity:1,l[f.symbol]=u,c.push(v),r=v,r.name=null==g.name||""===g.name?g.id:g.name,u++}var y=r||new mono.LambertMaterial({color:14540253,shading:mono.FlatShading,side:h.doubleSided?mono.DoubleSide:mono.FrontSide}),A=h.mesh.node3D;if(u>1)for(y=new mono.ArrayMaterial(c),d=0;d<A.faces.length;d++){var x=A.faces[d];x.materialIndex=l[x.daeMaterial]}y instanceof mono.ArrayMaterial&&A.setMaterialSize(y.materials.length),A.createMaterial(y),A.matrix=t.matrix,A.matrix.decompose(A._position,A.quaternion,A.scale);var w=A.quaternion;if(w){var b=w.x*w.x,S=w.y*w.y,C=w.z*w.z,T=w.w*w.w;A._rotation.x=Math.atan2(2*(w.x*w.w-w.y*w.z),T-b-S+C),A._rotation.y=Math.asin(mono.Math.clamp(2*(w.x*w.z+w.y*w.w),-1,1)),A._rotation.z=Math.atan2(2*(w.z*w.w-w.x*w.y),T+b-S-C)}Q.push(A)}}for(var d=0;d<t.nodes.length;d++)n(t.nodes[d],t)}}function s(){var t=H.querySelectorAll("library_materials material"),e={};if(t&&t.length>0)for(var i=0;i<t.length;i++){var n=t[i];if(n){var s=(new r).parse(n);s&&(e[s.id]=s)}}return e}function r(){this.id="",this.name="",this.instance_effect=null}function a(){this.url=""}function o(){this.nodes=[],this.id="",this.name=""}function h(){this.nodes=[],this.id="",this.name="",this.sid="",this.type="",this.controllers=[],this.geometries=[],this.type="",this.layer="",this.matrix=new mono.Mat4,this.transforms=[]}function l(){this.sid="",this.type="",this.data=[]}function c(){this.url="",this.instance_material=[]}function u(){this.symbol="",this.target=""}function d(){var t={};t.entity=[];var e=H.querySelectorAll("library_geometries geometry");if(e&&e.length>0)for(var i=0;i<e.length;i++){var n=(new f).parse(e[i]);n&&(t[n.id]=n,t.entity.push(n))}return t}function f(){this.id="",this.mesh=null}function g(){this.sources={},this.primitives=[],this.vertices=null,this.node3D=null}function _(t,e){var i=[t[e],t[e+1],t[e+2]];return p(i,-1),new mono.Vec3(i[0],i[1],i[2])}function p(t,e){if($.convertUpAxis===!0&&W!==$.upAxis)switch(X){case"XtoY":var i=t[0];t[0]=e*t[1],t[1]=i;break;case"XtoZ":var i=t[2];t[2]=t[1],t[1]=t[0],t[0]=i;break;case"YtoX":var i=t[0];t[0]=t[1],t[1]=e*i;break;case"YtoZ":var i=t[1];t[1]=e*t[2],t[2]=i;break;case"ZtoX":var i=t[0];t[0]=t[1],t[1]=t[2],t[2]=i;break;case"ZtoY":var i=t[1];t[1]=t[2],t[2]=e*i}}function v(){this.id="",this.input={}}function m(){this.semantic="",this.offset=0,this.source="",this.set=0}function y(){this.inputs=[],this.count=0,this.p=[],this.material=""}function A(){y.call(this),this.vcount=3}function x(){this.id,this.dataType,this.technique_common={},this.accessor=null,this.data=[]}function w(){this.source="",this.count=0,this.stride=0,this.params=[]}function b(t){return t?parseInt(t,10):0}function S(t){return t.replace(/^\s+/,"").replace(/\s+$/,"")}function C(t){var i=[];if(!t)return t;if(t=S(t),t.length>0)for(var n=t.split(/\s+/),s=0;s<n.length;s++){var r=n[s];r!=e&&null!=r&&null!=parseFloat(r)&&i.push(parseFloat(r))}return i}function T(t){var i=[];if(!t)return[];if(t=S(t),t.length>0)for(var n=t.split(/\s+/),s=0;s<n.length;s++){var r=n[s];r!=e&&null!=r&&null!=parseInt(r)&&i.push(parseInt(r))}return i}function E(t){var e=[];if(!t)return[];if(t=S(t),t.length>0)for(var i=t.split(/\s+/),n=0;n<i.length;n++)e.push("true"==i[n]||"1"==i[n]);return e}function L(){if($.convertUpAxis!==!0||W===$.upAxis)X=null;else switch(W){case"X":X="Y"===$.upAxis?"XtoY":"XtoZ";break;case"Y":X="X"===$.upAxis?"YtoX":"YtoZ";break;case"Z":X="X"===$.upAxis?"ZtoX":"ZtoY"}}function M(t){if($.convertUpAxis){var e=[t[0],t[4],t[8]];p(e,-1),t[0]=e[0],t[4]=e[1],t[8]=e[2],e=[t[1],t[5],t[9]],p(e,-1),t[1]=e[0],t[5]=e[1],t[9]=e[2],e=[t[2],t[6],t[10]],p(e,-1),t[2]=e[0],t[6]=e[1],t[10]=e[2],e=[t[0],t[1],t[2]],p(e,-1),t[0]=e[0],t[1]=e[1],t[2]=e[2],e=[t[4],t[5],t[6]],p(e,-1),t[4]=e[0],t[5]=e[1],t[6]=e[2],e=[t[8],t[9],t[10]],p(e,-1),t[8]=e[0],t[9]=e[1],t[10]=e[2],e=[t[3],t[7],t[11]],p(e,-1),t[3]=e[0],t[7]=e[1],t[11]=e[2]}return new mono.Mat4(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function P(){var t=H.querySelectorAll("library_images image"),e={};if(t&&t.length>0)for(var i=0;i<t.length;i++){var n=t[i];if(n){var s=(new k).parse(n);e[s.id]=s}}return e}function k(){this.id="",this.init_from=""}function I(){var t=H.querySelectorAll("library_effects effect"),e={};if(t&&t.length>0)for(var i=0;i<t.length;i++){var n=t[i];if(n){var s=(new R).parse(n);e[s.id]=s}}return e}function R(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function D(t,e){this.type=t,this.effect=e,this.material=null}function B(){this.color=new mono.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function N(t){this.effect=t,this.init_from=null,this.format=null}function z(t){this.effect=t,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function O(t){for(var i=H.querySelectorAll("library_nodes node"),n=0;n<i.length;n++){var s=i[n].attributes.getNamedItem("id");if(s&&s.value===t)return i[n]}return e}function F(t,e){t.doubleSided=!1;var i=e.querySelectorAll("extra double_sided")[0];i&&i&&1===parseInt(i.textContent,10)&&(t.doubleSided=!0)}function V(){var t=[],e=H.querySelectorAll("library_lights light");if(e&&e.length>0)for(var i=0;i<e.length;i++){var n=(e[i],(new U).parse(e));t.push(n)}return t}function U(){this.id="",this.name="",this.technique=""}this.id="",this.name="",this.type="";var H=null,W="Y",X=null,G=null,Z={},Y={},j={},q={},K="",Q=[],J={},$={};return r.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");for(var e=0;e<t.childNodes.length;e++)if("instance_effect"==t.childNodes[e].nodeName){this.instance_effect=(new a).parse(t.childNodes[e]);break}return this},a.prototype.parse=function(t){return this.url=t.getAttribute("url").replace(/^#/,""),this},o.prototype.parse=function(){var t=H.querySelectorAll("library_visual_scenes visual_scene");if(!t||t.length<0)return this;this.id="",this.name="";for(var e=0;e<t.length;e++){var i=t[e];if(i&&i.childNodes&&i.childNodes.length>0)for(var n=0;n<i.childNodes.length;n++){var s=i.childNodes[n];if(s&&s.nodeName)switch(s.nodeName){case"node":this.nodes.push((new h).parse(s))}}}return this},h.prototype.parse=function(t){if(!t)return this;if(this.id=t.getAttribute("id"),this.sid=t.getAttribute("sid"),this.name=t.getAttribute("name"),this.type=t.getAttribute("type"),this.layer=t.getAttribute("layer"),this.type="JOINT"==this.type?this.type:"NODE",t.childNodes.length>0)for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(i&&i.nodeName)switch(i.nodeName){case"node":this.nodes.push((new h).parse(i));break;case"instance_camera":break;case"instance_controller":break;case"instance_geometry":this.geometries.push((new c).parse(i));break;case"instance_light":break;case"instance_node":var n=i.getAttribute("url").replace(/^#/,""),s=O(n);s&&this.nodes.push((new h).parse(s));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new l).parse(i));break;case"extra":break;default:console.log(i.nodeName)}}return this.updateMatrix(),this},h.prototype.updateMatrix=function(){this.matrix.identity();for(var t=0;t<this.transforms.length;t++)this.transforms[t].apply(this.matrix)},l.prototype.parse=function(t){return this.sid=t.getAttribute("sid"),this.type=t.nodeName,this.data=C(t.textContent),this.convert(),this},l.prototype.convert=function(){switch(this.type){case"matrix":this.obj=M(this.data);break;case"rotate":this.angle=mono.Math.degToRad(this.data[3]);case"translate":p(this.data,-1),this.obj=new mono.Vec3(this.data[0],this.data[1],this.data[2]);break;case"scale":p(this.data,1),this.obj=new mono.Vec3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},l.prototype.apply=function(){var t=new mono.Mat4;return function(e){switch(this.type){case"matrix":e.multiply(this.obj);break;case"translate":e.multiply(t.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":e.multiply(t.makeRotationAxis(this.obj,this.angle));break;case"scale":e.scale(this.obj)}}}(),l.prototype.update=function(t,e){var i=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(e)if(1===e.length)switch(e[0]){case 0:this.obj.n11=t[0],this.obj.n21=t[1],this.obj.n31=t[2],this.obj.n41=t[3];break;case 1:this.obj.n12=t[0],this.obj.n22=t[1],this.obj.n32=t[2],this.obj.n42=t[3];break;case 2:this.obj.n13=t[0],this.obj.n23=t[1],this.obj.n33=t[2],this.obj.n43=t[3];break;case 3:this.obj.n14=t[0],this.obj.n24=t[1],this.obj.n34=t[2],this.obj.n44=t[3]}else if(2===e.length){var n="n"+(e[0]+1)+(e[1]+1);this.obj[n]=t}else console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(t);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(e)&&(e=i[e[0]]),e){case"X":this.obj.x=t;break;case"Y":this.obj.y=t;break;case"Z":this.obj.z=t;break;default:this.obj.x=t[0],this.obj.y=t[1],this.obj.z=t[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(e)&&(e=i[e[0]]),e){case"X":this.obj.x=t;break;case"Y":this.obj.y=t;break;case"Z":this.obj.z=t;break;case"ANGLE":this.angle=mono.Math.degToRad(t);break;default:this.obj.x=t[0],this.obj.y=t[1],this.obj.z=t[2],this.angle=mono.Math.degToRad(t[3])}}},c.prototype.parse=function(t){this.url=t.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType&&"bind_material"==i.nodeName){for(var n=i.querySelectorAll("instance_material"),s=0;s<n.length;s++){var r=n[s];this.instance_material.push((new u).parse(r))}break}}return this},u.prototype.parse=function(t){return this.symbol=t.getAttribute("symbol"),this.target=t.getAttribute("target").replace(/^#/,""),this},f.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(i&&"mesh"==i.nodeName){var n=new g,s=n.parse(i);s&&(this.mesh=s)}}return this},g.prototype.parse=function(t){if(t&&t.childNodes&&t.childNodes.length>0)for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];switch(i.nodeName){case"source":var n=i.getAttribute("id");this.sources[n]=(new x).parse(i);break;case"vertices":var s=new v;this.vertices=s.parse(i);break;case"polygons":var r=(new y).parse(i);r&&this.primitives.push(r);break;case"triangles":var a=(new A).parse(i);a&&this.primitives.push(a);break;case"polylist":var o=null;this.primitives.push(o)}}this.node3D=new mono.Entity;var h=null;for(this.vertices&&this.vertices.input&&this.vertices.input.POSITION&&(h=this.sources[this.vertices.input.POSITION.source].data),e=0;e<this.primitives.length;e++){var l=this.primitives[e];l.setVertices(this.vertices),this.handlePrimitive(l,this.node3D)}for(e=0;e<h.length;e+=3)this.node3D.vertices.push(_(h,e).clone());return this.node3D.computeFaceNormals(),this},g.prototype.handlePrimitive=function(t,i){var n,s,r,a,o,h,l,c=t.p,u=t.inputs,d=0,f=3,g=0,p=[];for(n=0;n<u.length;n++){r=u[n];var v=r.offset+1;switch(g=g<v?v:g,r.semantic){case"TEXCOORD":p.push(r.set)}}for(var m=0;m<c.length;++m)for(var y=c[m],A=0;A<y.length;){var x=[],w=[],b=null,S=[];for(f=t.vcount?t.vcount.length?t.vcount[d++]:t.vcount:y.length/g,n=0;n<f;n++)for(s=0;s<u.length;s++)switch(r=u[s],h=this.sources[r.source],a=y[A+n*g+r.offset],l=h.accessor.params.length,o=a*l,r.semantic){case"VERTEX":x.push(a);break;case"NORMAL":w.push(_(h.data,o));break;case"TEXCOORD":b=b||{},b[r.set]===e&&(b[r.set]=[]),b[r.set].push(new mono.Vec2(h.data[o],h.data[o+1]));break;case"COLOR":S.push((new mono.Color).setRGB(h.data[o],h.data[o+1],h.data[o+2]))}if(0==w.length)if(r=this.vertices.input.NORMAL){h=h[r.source],l=h.accessor.params.length;for(var C=0,T=x.length;C<T;C++)w.push(_(h.data,x[C]*l))}else i.calcNormals=!0;if(!b&&(b={},r=this.vertices.input.TEXCOORD)){p.push(r.set),h=sources[r.source],l=h.accessor.params.length;for(var C=0,T=x.length;C<T;C++)o=x[C]*l,b[r.set]===e&&(b[r.set]=[]),b[r.set].push(new mono.Vec2(h.data[o],1-h.data[o+1]))}if(0==S.length&&(r=this.vertices.input.COLOR)){h=sources[r.source],l=h.accessor.params.length;for(var C=0,T=x.length;C<T;C++)o=x[C]*l,S.push((new mono.Color).setRGB(h.data[o],h.data[o+1],h.data[o+2]))}var E,L,M=null,P=[];if(3===f)P.push(new mono.Face3(x[0],x[1],x[2],w,S.length?S:new mono.Color(16711680)));else if(4===f)P.push(new mono.Face3(x[0],x[1],x[3],[w[0],w[1],w[3]],S.length?[S[0],S[1],S[3]]:new mono.Color(16711680))),P.push(new mono.Face3(x[1],x[2],x[3],[w[1],w[2],w[3]],S.length?[S[1],S[2],S[3]]:new mono.Color(16711680)));else if(f>4&&$.subdivideFaces){var k=S.length?S:new mono.Color;for(s=1;s<f-1;)P.push(new mono.Face3(x[0],x[s],x[s+1],[w[0],w[s++],w[s]],k))}if(P.length)for(var C=0,T=P.length;C<T;C++)for(M=P[C],M.daeMaterial=t.material,i.faces.push(M),s=0;s<p.length;s++)E=b[p[s]],L=f>4?[E[0],E[C+1],E[C+2]]:4===f?0===C?[E[0],E[1],E[3]]:[E[1].clone(),E[2],E[3].clone()]:[E[0],E[1],E[2]],i.uvs===e&&(i.uvs=[]),i.uvs.push(L);else console.log("dropped face with vcount "+f+" for geometry with id: "+i.id);A+=g*f}},v.prototype.parse=function(t){if(t&&(this.id=t.getAttribute("id"),t.childNodes.length>0))for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(i&&i.nodeName)switch(i.nodeName){case"input":var n=(new m).parse(i);this.input[n.semantic]=n}}return this},m.prototype.parse=function(t){return t&&(this.semantic=t.getAttribute("semantic"),this.offset=b(t.getAttribute("offset")),this.set=b(t.getAttribute("set")),this.source=t.getAttribute("source").replace(/^#/,""),"TEXCOORD"==this.semantic&&this.set<0&&(this.set=0)),this},y.prototype.parse=function(t){if(t&&(this.count=t.getAttribute("count"),this.material=t.getAttribute("material"),t.childNodes.length>0))for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(i&&i.nodeName)switch(i.nodeName){case"input":var n=(new m).parse(i);n&&this.inputs.push(n);break;case"p":this.p.push(T(i.textContent))}}return this},y.prototype.setVertices=function(t){for(var e=0;e<this.inputs.length;e++)this.inputs[e].source==t.id&&(this.inputs[e].source=t.input.POSITION.source)},A.prototype=Object.create(y.prototype),x.prototype.parse=function(t){if(!t)return this;if(this.id=t.getAttribute("id"),t.childNodes.length>0)for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(i&&i.nodeName)switch(i.nodeName){case"float_array":this.dataType=i.nodeName,this.data=C(i.textContent);break;case"bool_array":this.dataType=i.nodeName,this.data=E(i.textContent);break;case"int_array":this.data=T(i.textContent),this.dataType=i.nodeName;break;case"technique_common":if(i.childNodes&&i.childNodes.length>0)for(var n=0;n<i.childNodes.length;n++){var s=i.childNodes[n];if(s&&s.nodeName)switch(s.nodeName){case"accessor":var r=(new w).parse(s);r.source&&(this.technique_common[r.source]=r,this.accessor=r)}}}}return this},x.prototype.read=function(){var t=[],e=this.accessor.params[0];switch(e.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var i=0;i<this.data.length;i+=16){var n=this.data.slice(i,i+16),s=M(n);t.push(s)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+e.type+".")}return t},w.prototype.parse=function(t){if(!t)return this;if(this.source=t.getAttribute("source"),this.count=b(t.getAttribute("count")),this.stride=b(t.getAttribute("stride")),t.childNodes.length>0)for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(i&&i.nodeName)switch(i.nodeName){case"param":var n={};n.name=i.getAttribute("name"),n.type=i.getAttribute("type"),this.params.push(n)}}return this},k.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];"init_from"==i.nodeName&&(this.init_from=i.textContent)}return this},R.prototype.create=function(){if(null==this.shader)return null},R.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),F(this,t),this.shader=null;for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(i))}}return this},R.prototype.parseNewparam=function(t){for(var e=t.getAttribute("sid"),i=0;i<t.childNodes.length;i++){var n=t.childNodes[i];if(1==n.nodeType)switch(n.nodeName){case"surface":this.surface[e]=new N(this).parse(n);break;case"sampler2D":this.sampler[e]=new z(this).parse(n);break;case"extra":break;default:console.log(n.nodeName)}}},R.prototype.parseProfileCOMMON=function(t){for(var e,i=0;i<t.childNodes.length;i++){var n=t.childNodes[i];if(1==n.nodeType)switch(n.nodeName){case"profile_COMMON":this.parseProfileCOMMON(n);break;case"technique":e=n;break;case"newparam":this.parseNewparam(n);break;case"image":var s=(new k).parse(n);q[s.id]=s;break;case"extra":break;default:console.log(n.nodeName)}}return e},R.prototype.parseTechnique=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new D(i.nodeName,this).parse(i);break;case"extra":this.parseExtra(i)}}},R.prototype.parseExtra=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"technique":this.parseExtraTechnique(i)}}},R.prototype.parseExtraTechnique=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"bump":this.shader.parse(i)}}},D.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[i.nodeName]=(new B).parse(i);break;case"bump":var n=i.getAttribute("bumptype");n?"heightfield"===n.toLowerCase()?this.bump=(new B).parse(i):"normalmap"===n.toLowerCase()?this.normal=(new B).parse(i):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+n+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new B).parse(i)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new B).parse(i));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var s=i.querySelectorAll("float");s.length>0&&(this[i.nodeName]=parseFloat(s[0].textContent))}}return this.create(),this},D.prototype.create=function(){var t={},i=!1;if(this.transparency!==e&&this.transparent!==e){var n=(this.transparent,(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency);n>0&&(i=!0,t.transparent=!0,t.opacity=1-n)}var s={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var r in this)switch(r){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var a=this[r];if(a instanceof B)if(a.isTexture()){var o=a.texture,h=this.effect.sampler[o],l=null;if(h!==e&&h.source!==e){var c=this.effect.surface[h.source];l=q[c.init_from]}else l=q[o];if(l){var u=K+l.init_from,d=new Image;d.loaded=!1;var f=new mono.Texture;f._imageSrc=u,f._image=d,f.setImage(u),f.wrapS=a.texOpts.wrapU?mono.RepeatWrapping:mono.ClampToEdgeWrapping,f.wrapT=a.texOpts.wrapV?mono.RepeatWrapping:mono.ClampToEdgeWrapping,f.offsetX=a.texOpts.offsetU,f.offsetY=a.texOpts.offsetV,f.repeatX=a.texOpts.repeatU,f.repeatY=a.texOpts.repeatV,t[s[r]]=f,"emission"===r&&(t.emissive=16777215)}}else"diffuse"!==r&&i||("emission"===r?t.emissive=a.color.getHex():t[r]=a.color.getHex());break;case"shininess":t[r]=this[r];break;case"reflectivity":t[r]=this[r],t[r]>0&&(t.envMap=$.defaultEnvMap),t.combine=mono.MixOperation;break;case"index_of_refraction":t.refractionRatio=this[r],1!==this[r]&&(t.envMap=$.defaultEnvMap);break;case"transparency":}switch(t.shading=mono.SmoothShading,t.side=this.effect.doubleSided?mono.DoubleSide:mono.FrontSide,this.type){case"constant":t.emissive!=e&&(t.color=t.emissive),this.material=new mono.EntityMaterial(t);break;case"phong":case"blinn":t.diffuse!=e&&(t.color=t.diffuse),this.material=new mono.EntityMaterial(t);break;case"lambert":default:t.diffuse!=e&&(t.color=t.diffuse),this.material=new mono.LambertMaterial(t)}return this.material},B.prototype.isColor=function(){return null==this.texture},B.prototype.isTexture=function(){return null!=this.texture},B.prototype.parse=function(t){"transparent"==t.nodeName&&(this.opaque=t.getAttribute("opaque"));for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"color":var n=C(i.textContent);this.color=new mono.Color,this.color.setRGB(n[0],n[1],n[2]),this.color.a=n[3];break;case"texture":this.texture=i.getAttribute("texture"),this.texcoord=i.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(i)}}return this},B.prototype.parseTexture=function(t){if(!t.childNodes)return this;t.childNodes[1]&&"extra"===t.childNodes[1].nodeName&&(t=t.childNodes[1],t.childNodes[1]&&"technique"===t.childNodes[1].nodeName&&(t=t.childNodes[1]));for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];switch(i.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?this.texOpts[i.nodeName]=1:this.texOpts[i.nodeName]=parseInt(i.textContent);break;default:this.texOpts[i.nodeName]=i.textContent}}return this},N.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"init_from":this.init_from=i.textContent;break;case"format":this.format=i.textContent;break;default:console.log("unhandled Surface prop: "+i.nodeName)}}return this},z.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"source":this.source=i.textContent;break;case"minfilter":this.minfilter=i.textContent;break;case"magfilter":this.magfilter=i.textContent;break;case"mipfilter":this.mipfilter=i.textContent;break;case"wrap_s":this.wrap_s=i.textContent;break;case"wrap_t":this.wrap_t=i.textContent;break;default:console.log("unhandled Sampler2D prop: "+i.nodeName)}}return this},U.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"technique_common":this.parseCommon(i);break;case"technique":this.parseTechnique(i)}}return this},U.prototype.parseCommon=function(t){for(var e=0;e<t.childNodes.length;e++)switch(t.childNodes[e].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=t.childNodes[e].nodeName;for(var i=t.childNodes[e],n=0;n<i.childNodes.length;n++){var s=i.childNodes[n];switch(s.nodeName){case"color":var r=C(s.textContent);this.color=new mono.Color(0),this.color.setRGB(r[0],r[1],r[2]),this.color.a=r[3];break;case"falloff_angle":this.falloff_angle=parseFloat(s.textContent);break;case"quadratic_attenuation":var a=parseFloat(s.textContent);this.distance=a?Math.sqrt(1/a):0}}}return this},U.prototype.parseTechnique=function(t){this.profile=t.getAttribute("profile");for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];switch(i.nodeName){case"intensity":this.intensity=parseFloat(i.textContent)}}return this},{load:t,parse:i,geometries:Z,options:$}},Ke.DataBox=function(t){Ke.DataBox.superClass.constructor.apply(this,arguments),1===arguments.length&&(this._name=t),this._dataList=new ci,this._dataMap={},this._rootList=new ci,this._rootMap={},this._clientMap={},this._lightList=new ci,this._billboardList=new ci,this._nodeList=new ci,this._annotationList=new ci,this._particleList=new ci,this.nodes=[],this.particles=[],this.billboards=[],this._dataBoxChangeDispatcher=new Ke.EventDispatcher,this._dataPropertyChangeDispatcher=new Ke.EventDispatcher,this._groupLists={},this.selection=new ci,this instanceof Ke.AlarmBox||(this._selectionModel=new Ke.SelectionModel(this),this._alarmBox=new Ke.AlarmBox(this),this._alarmStatePropagator=new Ke.AlarmStatePropagator(this),this._alarmStatePropagator.setEnable(!0)),this.batch=!1,this._clientMap={}},Ke.extend(Ke.DataBox,Ke.PropertyChangeDispatcher,{constructor:Ke.DataBox,className:"TGL.DataBox",___accessor:["name"],add:function(t,e){if(t){1===arguments.length&&(e=-1);var i=t.getId();if(this._dataMap.hasOwnProperty(i)){if(this._dataMap[i]!==t)throw"Data with ID '"+i+"' already exists"}else this._dataMap[i]=t,this._dataList.add(t),t.getParent()||(this._rootMap[i]=t,e>=0?this._rootList.add(t,e):this._rootList.add(t)),t instanceof Ke.Billboard?this._billboardList.add(t):t instanceof Ke.Node?this._nodeList.add(t):t instanceof Ke.Particle?this._particleList.add(t):t instanceof Ke.Annotation?this._annotationList.add(t):t instanceof Ke.Light&&this._lightList.add(t),this._dataBoxChangeDispatcher.fire({kind:"add",data:t,source:this}),t.getGroupId()&&this.groupElements(t,null,t.getGroupId()),t.addPropertyChangeListener(this.handleDataPropertyChange,this),t._selected=!1}},onPropertyChange:function(){},firePropertyChange:function(){},addByDescendant:function(t,e){e&&0==e(t)||t&&(this.add(t),t.getChildren().size()>0&&t.getChildren().forEach(function(t){this.addByDescendant(t,e)},this))},getAlarmBox:function(){return this._alarmBox},removeById:function(t,e){var i=this.getDataById(t);this.remove(i,e)},remove:function(t,e){if(t&&this._dataMap.hasOwnProperty(t.getId())){t instanceof Ke.Link&&(t.setFromNode(null),t.setToNode(null)),t instanceof Ke.Node&&t.getLinks()&&t.getLinks().toList().forEach(function(t){this.remove(t)},this),e&&(t.getChildren().forEach(function(e){t.removeChild(e)},this),t.getParent()&&t.getParent().removeChild(t)),this._dataList.remove(t);var i=t._id;delete this._dataMap[i],this._rootMap[i]&&(delete this._rootMap[i],this._rootList.remove(t)),t instanceof Ke.Billboard?this._billboardList.remove(t):t instanceof Ke.Node?this._nodeList.remove(t):t instanceof Ke.Particle?this._particleList.remove(t):t instanceof Ke.Annotation?this._annotationList.remove(t):t instanceof Ke.Light&&this._lightList.remove(t),t.getGroupId()&&this.groupElements(t,t.getGroupId(),null),t.removePropertyChangeListener(this.handleDataPropertyChange,this),this._dataBoxChangeDispatcher.fire({kind:"remove",data:t,source:this}),this._selectionModel&&this._selectionModel.removeSelection(t)}},removeByDescendant:function(t,e,i){if(t){var n=this;t.hasChildren()&&t.getChildren().forEachReverse(function(t){n.removeByDescendant(t,e,i)}),i&&0==i(t)||this.remove(t,e)}},containsById:function(t){return this._dataMap.hasOwnProperty(t)},contains:function(t){return!!t&&this._dataMap[t._id]===t},lightsSize:function(){return this._lightList.size()},getLights:function(){return this._lightList},getLightsArray:function(){return this._lightList.toArray()},getAnnotations:function(){return this._annotationList},clear:function(t){if(this._dataList.size()>0){var e=this._dataList.toList(function(e){return!this._lightList.contains(e)||t},this);if(e.forEach(function(t){t.removePropertyChangeListener(this.handleDataPropertyChange,this)},this),this._dataList.clear(),this._dataMap={},this._rootList.clear(),this._rootMap={},this._nodeList.clear(),this._billboardList.clear(),t)this._lightList.clear();else{var i=this;this._lightList.forEach(function(t){i._dataList.add(t);var e=t.getId();i._dataMap[e]=t,null==t.getParent()&&(i._rootList.add(t),i._rootMap[e]=t)})}this._dataBoxChangeDispatcher.fire({kind:"clear",datas:e}),this.clearSelection()}},startBatch:function(){this.batch=!0},endBatch:function(){this.batch=!1,this._dataBoxChangeDispatcher.fire({kind:"batchEnd"})},removeSelection:function(){var t=this._selectionModel.toSelection();t.forEach(function(t){this.remove(t)},this)},clearSelection:function(){this._selectionModel&&this._selectionModel.clearSelection()},clearEditing:function(){this._nodeList.forEach(function(t){t.editing=!1}),this._billboardList.forEach(function(t){t.editing=!1})},getDataById:function(t){return this._dataMap[t]},groupElements:function(t,e,i){var n;e&&(n=this._groupLists[e],n&&(n.remove(t),n.isEmpty()&&delete this._groupLists[e])),i&&(n=this._groupLists[i],null==n&&(n=new ci,this._groupLists[i]=n),n.contains(t)||n.add(t))},synchronizeGroup:function(t,e,i,n){if(!this.isAdjustingGroup){this.isAdjustingGroup=!0;var s=t.getGroupId(),r=new Ke.Vec3;if(s){var a=this._groupLists[s];a&&a.size()>1&&a.forEach(function(s){s!==t&&!s.isDescendantOf(t)&&!t.isDescendantOf(s)&&(r.subVectors(i,e),s[Ke.setter(n)](s[Ke.getter(n)]().clone().add(r)))})}this.isAdjustingGroup=!1}},handleDataPropertyChange:function(t){var e=t.source;if("parent"===t.property){var i=e.getId();e.getParent()?this._rootMap[i]&&(delete this._rootMap[i],this._rootList.remove(e)):this._rootMap[i]||(this._rootMap[i]=e,this._rootList.add(e))}else if("groupId"===t.property){var n=t.oldValue,s=t.newValue;this.groupElements(e,n,s)}else"position"===t.property||"scale"===t.property||"rotation"===t.property?this.synchronizeGroup(e,t.oldValue,t.newValue,t.property):"selected"===t.property&&(e._selected?this._selectionModel.appendSelection(e):this._selectionModel.removeSelection(e));this.onDataPropertyChanged(e,t),this._dataPropertyChangeDispatcher.fire(t)},onDataPropertyChanged:function(t,e){},addDataBoxChangeListener:function(t,e,i){this._dataBoxChangeDispatcher.add(t,e,i)},removeDataBoxChangeListener:function(t,e){this._dataBoxChangeDispatcher.remove(t,e)},addDataPropertyChangeListener:function(t,e,i){this._dataPropertyChangeDispatcher.add(t,e,i)},removeDataPropertyChangeListener:function(t,e){this._dataPropertyChangeDispatcher.remove(t,e)},allocateLights:function(){var t,e,i,n,s,r,a,i;n=s=r=a=0;var o=this._lightList;for(t=0,e=o.size();t<e;t++)i=o.get(t),i.onlyShadow||(i instanceof Ke.DirectionalLight&&n++,i instanceof Ke.PointLight&&s++,i instanceof Ke.SpotLight&&r++);return{directional:n,point:s,spot:r,hemi:a}},allocateShadows:function(){var t,e,i,n=0,s=this._lightList;for(t=0,e=s.size();t<e;t++)i=s.get(t),i.castShadow&&(i instanceof Ke.SpotLight&&n++,i instanceof Ke.DirectionalLight&&!i.shadowCascade&&n++);return n},allocatePointShadows:function(){var t,e,i,n=0,s=this._lightList;for(t=0,e=s.size();t<e;t++)i=s.get(t),i.castShadow&&i instanceof Ke.PointLight&&n++;return n},getSelectionModel:function(){
return this._selectionModel},size:function(){return this._dataList.size()},isEmpty:function(){return this._dataList.isEmpty()},getLimit:function(){return this._limit},setLimit:function(t){var e=this._limit;this._limit=t,this.firePropertyChange("limit",e,t),this._checkLimit()},_checkLimit:function(){this._limit>=0&&this.size()>this._limit&&this.removeFirst(this.size()-this._limit)},removeFirst:function(t){for(0===arguments.length&&(t=1);t>0&&this._dataList.size()>0;){var e=this._dataList.get(0);this.remove(e),t--}},getSiblings:function(t){if(!this.contains(t))throw t+" dosen't belong to this dataBox";var e=t.getParent();return e?e.getChildren():this._rootList},getRoots:function(){return this._rootList},getSiblingIndex:function(t){return t.getParent()?t.getParent().getChildren().indexOf(t):this._rootList.indexOf(t)},getNodes:function(){return this._nodeList},getBillboards:function(){return this._billboardList},getDatas:function(){return this._dataList},getDataAt:function(t){return this._dataList.get(t)},toDatas:function(t,e){return this._dataList.toList(t,e)},forEach:function(t,e){this._dataList.forEach(t,e)},forEachReverse:function(t,e){this._dataList.forEachReverse(t,e)},forEachByDepthFirst:function(t,e,i){if(e)this._depthFirst(t,e,i);else for(var n=this._rootList.size(),s=0;s<n;s++){var r=this._rootList.get(s);if(this._depthFirst(t,r,i)===!1)return}},_depthFirst:function(t,e,i){for(var n=e.getChildrenSize(),s=0;s<n;s++){var r=e.getChildAt(s);if(this._depthFirst(t,r,i)===!1)return!1}if(i){if(t.call(i,e)===!1)return!1}else if(t(e)===!1)return!1},forEachByBreadthFirst:function(t,e,i){var n=new ci;for(e?n.add(e):this._rootList.forEach(n.add,n);n.size()>0;)if(e=n.removeAt(0),e.getChildren().forEach(n.add,n),i){if(t.call(i,e)===!1)return}else if(t(e)===!1)return},getAlarmStatePropagator:function(){return this._alarmStatePropagator},setAlarmStatePropagator:function(t){this._alarmStatePropagator!=t&&(this._alarmStatePropagator&&this._alarmStatePropagator.setEnable(!1),this._alarmStatePropagator=t,this._alarmStatePropagator.setEnable(!0))},setClient:function(t,e){if(null==t)return this;null==this._clientMap&&(this._clientMap=new Object);var i=this._clientMap[t];if(i!==e)return null==e?delete this._clientMap[t]:this._clientMap[t]=e,this._clientMap[t]=e,this.firePropertyChange("C:"+t,i,e),this},getClient:function(t){return this._clientMap[t]}}),Ke.QuickFinder=function(t,e,i,n,s){if(this._map={},!t)throw"dataBox can not be null";if(!e)throw"propertyName can not be null";this._dataBox=t,this._propertyName=e,this._propertyType=i||"accessor","accessor"===this._propertyType&&(this._getter=Ke.getter(e)),this._valueFunction=n||this.getValue,this._filterFunction=s||this.isInterested,this._dataBox.forEach(this._addData,this),this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this,!0)},Ke.extend(Ke.QuickFinder,Object,{_NULL_:"mono-null-key",getValueFunction:function(){return this._valueFunction},getFilterFunction:function(){return this._filterFunction},handleDataBoxChange:function(t){"add"===t.kind?this._addData(t.data):"remove"===t.kind?this._removeData(t.data):"clear"===t.kind&&(this._map={})},handleDataPropertyChange:function(t){if(this._filterFunction.call(this,t.source)&&("accessor"===this._propertyType&&this._propertyName===t.property||"style"===this._propertyType&&t.source.IStyle&&"S:"+this._propertyName===t.property||"client"===this._propertyType&&"C:"+this._propertyName===t.property)){var e=this._getMap(t.oldValue);e&&e.remove(t.source),this._addData(t.source)}},_getMap:function(t){return t=null==t?this._NULL_:t,this._map[t]},find:function(t){var e=this._getMap(t);return e?e.toList():new ci},findFirst:function(t){var e=this._getMap(t);return!e||e.isEmpty()?null:e.get(0)},_addData:function(t){if(this._filterFunction.call(this,t)){var e=this._valueFunction.call(this,t),i=this._getMap(e);i||(i=new ci,e=null==e?this._NULL_:e,this._map[e]=i),i.add(t)}},_removeData:function(t){if(this._filterFunction.call(this,t)){var e=this._valueFunction.call(this,t),i=this._getMap(e);i&&(i.remove(t),i.isEmpty()&&(e=null==e?this._NULL_:e,delete this._map[e]))}},dispose:function(){this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),delete this._dataBox},getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isInterested:function(t){return!("style"===this._propertyType&&!t.IStyle)&&!("accessor"===this._propertyType&&this._valueFunction===this.getValue&&!t[this._getter])},getValue:function(t){return"accessor"===this._propertyType?t[this._getter]():"style"===this._propertyType&&t.getStyle?t.getStyle(this._propertyName):"client"===this._propertyType&&t.getClient?t.getClient(this._propertyName):null}}),Ke.SelectionModel=function(t){Ke.SelectionModel.superClass.constructor.apply(this,arguments),this._selectionMode="multipleSelection",this._selectionList=new ci,this._selectionChangeDispatcher=new Ke.EventDispatcher,this._selectionMap={},this._setDataBox(t)},Ke.extend(Ke.SelectionModel,Ke.PropertyChangeDispatcher,{getSelectionMode:function(){return this._selectionMode},setSelectionMode:function(t){if(this._selectionMode!==t&&("noneSelection"===t||"singleSelection"===t||"multipleSelection"===t)){this.clearSelection();var e=this._selectionMode;this._selectionMode=t,this.firePropertyChange("selectionMode",e,this._selectionMode)}},getDataBox:function(){return this._dataBox},_setDataBox:function(t){if(!t)throw"dataBox can not be null";if(this._dataBox!==t){this._dataBox&&(this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this));var e=this._dataBox;this._dataBox=t,this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this.firePropertyChange("dataBox",e,this._dataBox)}},dispose:function(){this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this)},handleDataBoxChange:function(t){if("remove"===t.kind){var e=t.data;this.contains(e)&&(this._selectionList.remove(e),delete this._selectionMap[e.getId()],this.fireSelectionChange("remove",new ci(e))),e._selected=!1}else"clear"===t.kind&&this.clearSelection()},getFilterFunction:function(){return this._filterFunction},setFilterFunction:function(t){if(this._filterFunction!==t){this.clearSelection();var e=this._filterFunction;this._filterFunction=t,this.firePropertyChange("filterFunction",e,this._filterFunction)}},fireSelectionChange:function(t,e,i){i&&(this._selectionList.forEach(function(t){i.contains(t)?i.remove(t):i.add(t)}),e=i.toList()),this._selectionChangeDispatcher.fire({kind:t,datas:new ci(e)})},addSelectionChangeListener:function(t,e,i){this._selectionChangeDispatcher.add(t,e,i)},removeSelectionChangeListener:function(t,e){this._selectionChangeDispatcher.remove(t,e)},_filterList:function(t,e){for(var i=new ci(t),n=0;n<i.size();n++){var s=i.get(n);(this._filterFunction&&!this._filterFunction(s)||e&&this.contains(s)||!e&&!this.contains(s)||!this._dataBox.contains(s))&&(i.removeAt(n),n--)}return i},appendSelection:function(t){if("noneSelection"!==this._selectionMode){var e=this._filterList(t,!0);if(!e.isEmpty()){var i=null;"singleSelection"===this._selectionMode&&(i=new ci(this._selectionList),this._selectionList.forEach(function(t){t._selected=!1}),this._selectionList.clear(),this._selectionMap={},e=new ci(e.get(e.size()-1)));for(var n=0;n<e.size();n++){var s=e.get(n);s._selected=!0,this._selectionList.add(s),this._selectionMap[s._id]=s}this.fireSelectionChange("append",e,i)}}},removeSelection:function(t){var e=this._filterList(t);if(0!==e.size()){for(var i=0;i<e.size();i++){var n=e.get(i);n._selected=!1,this._selectionList.remove(n),delete this._selectionMap[n.getId()]}this.fireSelectionChange("remove",e)}},toSelection:function(t,e){return this._selectionList.toList(t,e)},getSelection:function(){return this._selectionList},setSelection:function(t){if("noneSelection"!==this._selectionMode&&(0!==this._selectionList.size()||null!=t)){var e=new ci(this._selectionList);this._selectionList.clear(),this._selectionMap={};var i=this._filterList(t,!0);"singleSelection"===this._selectionMode&&i.size()>1&&(i=new ci(i.get(i.size()-1)));for(var n=0;n<i.size();n++){var s=i.get(n);s._selected=!0,this._selectionList.add(s),this._selectionMap[s.getId()]=s}this.fireSelectionChange("set",null,e)}},clearSelection:function(){if(this._selectionList.size()>0){var t=this._selectionList.toList();this._selectionList.forEach(function(t){t._selected=!1}),this._selectionList.clear(),this._selectionMap={},this.fireSelectionChange("clear",t)}},selectAll:function(){if("noneSelection"!==this._selectionMode){var t=this._dataBox.toDatas(),e=0,i=null;if(this._filterFunction)for(e=0;e<t.size();e++)i=t.get(e),this._filterFunction(i)||(t.removeAt(e),e--);var n=new ci(this._selectionList);for(this._selectionList.clear(),this._selectionMap={},"singleSelection"===this._selectionMode&&t.size()>1&&(t=new ci(t.get(t.size()-1))),e=0;e<t.size();e++)i=t.get(e),this._selectionList.add(i),this._selectionMap[i.getId()]=i;this.fireSelectionChange("all",null,n)}},size:function(){return this._selectionList.size()},contains:function(t){return!!t&&null!=this._selectionMap[t._id]},getLastData:function(){return this._selectionList.size()>0?this._selectionList.get(this._selectionList.size()-1):null},getFirstData:function(){return this._selectionList.size()>0?this._selectionList.get(0):null},isSelectable:function(t){return!!t&&("noneSelection"!==this._selectionMode&&!(this._filterFunction&&!this._filterFunction(t)))}}),Ke.AlarmSeverity=function(t,e,i,n,s){this.value=t,this.name=e,this.nickName=i,this.color=n,this.displayName=s},Ke.extend(Ke.AlarmSeverity,Object,{toString:function(){return this.displayName?this.displayName:this.name}}),function(){var t=Ke.AlarmSeverity;t.severities=new ci,t._vm={},t._nm={},t._cp=function(t,e){if(t&&e){var i=t.value-e.value;return i>0?1:i<0?-1:0}return t&&!e?1:!t&&e?-1:0},t.forEach=function(e,i){t.severities.forEach(e,i)},t.getSortFunction=function(){return t._cp},t.setSortFunction=function(e){t._cp=e,t.severities.sort(e)},t.add=function(e,i,n,s,r){var a=new t(e,i,n,s,r);return t._vm[e]=a,t._nm[i]=a,t.severities.add(a),t.severities.sort(t._cp),a},t.remove=function(e){var i=t._nm[e];return i&&(delete t._nm[e],delete t._vm[i.value],t.severities.remove(i)),i},t.CRITICAL=t.add(500,"Critical","C","#FF0000"),t.MAJOR=t.add(400,"Major","M","#FFA000"),t.MINOR=t.add(300,"Minor","m","#FFFF00"),t.WARNING=t.add(200,"Warning","W","#00FFFF"),t.INDETERMINATE=t.add(100,"Indeterminate","N","#C800FF"),t.CLEARED=t.add(0,"Cleared","R","#00FF00"),t.isClearedAlarmSeverity=function(t){return!!t&&0===t.value},t.getByName=function(e){return t._nm[e]},t.getByValue=function(e){return t._vm[e]},t.clear=function(){t.severities.clear(),t._vm={},t._nm={}},t.compare=function(e,i){return t._cp(e,i)}}(),Ke.AlarmState=function(t){this._e=t,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0},Ke.extend(Ke.AlarmState,Object,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._e.firePropertyChange("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var t=null;for(var e in this._am)e=Ke.AlarmSeverity.getByName(e),Ke.AlarmSeverity.isClearedAlarmSeverity(e)||0!==this.getAcknowledgedAlarmCount(e)&&(t=t&&Ke.AlarmSeverity.compare(t,e)>0?t:e);this._haa=t},_c2:function(){var t=null;for(var e in this._nm)e=Ke.AlarmSeverity.getByName(e),Ke.AlarmSeverity.isClearedAlarmSeverity(e)||0!==this.getNewAlarmCount(e)&&(t=t&&Ke.AlarmSeverity.compare(t,e)>0?t:e);this._hna=t},_c3:function(){if(!this._hna)return void(this._hls=!1);for(var t in this._nm)if(t=Ke.AlarmSeverity.getByName(t),!Ke.AlarmSeverity.isClearedAlarmSeverity(t)&&0!==this.getNewAlarmCount(t)&&Ke.AlarmSeverity.compare(this._hna,t)>0)return void(this._hls=!0);this._hls=!1},_c4:function(){var t=this._haa,e=this._hna,i=this._ps;this._hoa=t,Ke.AlarmSeverity.compare(e,this._hoa)>0&&(this._hoa=e),Ke.AlarmSeverity.compare(i,this._hoa)>0&&(this._hoa=i)},_c5:function(){var t=this._haa,e=this._hna;this._hta=t,Ke.AlarmSeverity.compare(e,this._hta)>0&&(this._hta=e)},increaseAcknowledgedAlarm:function(t,e){if(null==e&&(e=1),0!==e){var i=this._am[t.name];null==i&&(i=0),i+=e,this._am[t.name]=i,this._f(),this._e.onAlarmChange()}},increaseNewAlarm:function(t,e){if(null==e&&(e=1),0!==e){var i=this._nm[t.name];null==i&&(i=0),i+=e,this._nm[t.name]=i,this._f(),this._e.onAlarmChange()}},decreaseAcknowledgedAlarm:function(t,e){if(null==e&&(e=1),0!==e){var i=this._am[t.name];if(null==i&&(i=0),i-=e,i<0)throw"Alarm count can not be negative";this._am[t.name]=i,this._f(),this._e.onAlarmChange()}},decreaseNewAlarm:function(t,e){if(null==e&&(e=1),0!==e){var i=this._nm[t.name];if(null==i&&(i=0),i-=e,i<0)throw"Alarm count can not be negative";this._nm[t.name]=i,this._f(),this._e.onAlarmChange()}},acknowledgeAlarm:function(t){this.decreaseNewAlarm(t,1),this.increaseAcknowledgedAlarm(t,1)},acknowledgeAllAlarms:function(t){if(t){var e=this.getNewAlarmCount(t);this.decreaseNewAlarm(t,e),this.increaseAcknowledgedAlarm(t,e)}else for(var i in this._nm)this.acknowledgeAllAlarms(Ke.AlarmSeverity.getByName(i))},_c6:function(){this._aac=0;for(var t in this._am)t=Ke.AlarmSeverity.getByName(t),this._aac+=this.getAcknowledgedAlarmCount(t)},getAcknowledgedAlarmCount:function(t){if(t){var e=this._am[t.name];return null==e?0:e}return this._aac},getAlarmCount:function(t){return this.getAcknowledgedAlarmCount(t)+this.getNewAlarmCount(t)},_c7:function(){this._nac=0;for(var t in this._nm)t=Ke.AlarmSeverity.getByName(t),this._nac+=this.getNewAlarmCount(t)},getNewAlarmCount:function(t){if(t){var e=this._nm[t.name];return null==e?0:e}return this._nac},setNewAlarmCount:function(t,e){this._nm[t.name]=e,this._f()},removeAllNewAlarms:function(t){t?delete this._nm[t]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(t,e){this._am[t.name]=e,this._f()},removeAllAcknowledgedAlarms:function(t){t?delete this._am[t.name]:this._am={},this._f()},isEmpty:function(){return null==this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(t){if(this._ep||(t=null),this._ps!==t){var e=this._ps;this._ps=t,this._f(),this._e.onAlarmChange(),this._e.firePropertyChange("propagateSeverity",e,t)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(t){var e=this._ep;this._ep=t,this._e.firePropertyChange("enablePropagation",e,t)&&(t||this.setPropagateSeverity(null))}}),Ke.Alarm=function(t,e,i,n,s){Ke.Data.call(this,t),this._id=null!=t?t:Ke.id("A"),this._elementId=e,this._alarmSeverity=i,this._acked=n||!1,this._cleared=s||!1},Ke.extend(Ke.Alarm,Ke.Data,{IAlarm:!0,getElementId:function(){return this._elementId},___accessor:["acked","cleared","alarmSeverity"]}),Ke.AlarmBox=function(t){if(!t)throw"elementBox can not be null.";Ke.AlarmBox.superClass.constructor.call(this),this._elementBox=t,this._alarmElementMapping=new Ke.AlarmElementMapping(this,t),this._elementBox.addDataBoxChangeListener(this.handleElementBoxChange,this,!0),this.addDataBoxChangeListener(this.handleAlarmBoxChange,this,!0),this.addDataPropertyChangeListener(this.handleAlarmPropertyChange,this,!0)},Ke.extend(Ke.AlarmBox,Ke.DataBox,{__accessor:["removeAlarmWhenElementIsRemoved"],_name:"AlarmBox",_removeAlarmWhenAlarmIsCleared:!1,_removeAlarmWhenElementIsRemoved:!0,getElementBox:function(){return this._elementBox},isRemoveAlarmWhenAlarmIsCleared:function(){return this._removeAlarmWhenAlarmIsCleared},setRemoveAlarmWhenAlarmIsCleared:function(t){var e=this._removeAlarmWhenAlarmIsCleared;if(this._removeAlarmWhenAlarmIsCleared=t,this.firePropertyChange("removeAlarmWhenAlarmIsCleared",e,t),t)for(var i in this.datas){var n=this.datas[i];n.isCleard()&&this.remove(n)}},getAlarmElementMapping:function(){return this._alarmElementMapping},setAlarmElementMapping:function(t){if(!t)throw"alarmElementMapping can not be null";if(this._alarmElementMapping!==t){var e=this._alarmElementMapping;this.getDatas().forEach(this._decreaseAlarmState,this),this._alarmElementMapping=t,this.getDatas().forEach(this._increaseAlarmState,this),this.firePropertyChange("alarmElementMapping",e,t)}},handleElementBoxChange:function(t){"add"===t.kind?this.handleElementAdded(t.data):"remove"===t.kind?(this.handleElementRemoved(t.data),this._removeAlarmWhenElementIsRemoved&&this.removeAlarmsByElement(t.data)):"clear"===t.kind&&(t.datas.forEach(this.handleElementRemoved,this),this._removeAlarmWhenElementIsRemoved&&this.clear())},handleAlarmBoxChange:function(t){"add"===t.kind?this._increaseAlarmState(t.data):"remove"===t.kind?this._decreaseAlarmState(t.data):"clear"===t.kind&&t.datas.forEach(this._decreaseAlarmState,this)},handleAlarmPropertyChange:function(t){var e=t.source;e.isCleared()||("alarmSeverity"===t.property?this.handleAlarmSeverityChange(e,t):"acked"===t.property&&this.handleAckedChange(e,t)),"cleared"===t.property&&(e.isCleared()?(this._decreaseAlarmState(e,!0),this._removeAlarmWhenAlarmIsCleared&&this.remove(e)):this._increaseAlarmState(e,!0))},handleAckedChange:function(t,e){if(t.getAlarmSeverity()){var i=this.getCorrespondingElements(t);if(i)for(var n=0;n<i.size();n++){var s=i.get(n);e.oldValue?s.getAlarmState().decreaseAcknowledgedAlarm(t.getAlarmSeverity()):s.getAlarmState().decreaseNewAlarm(t.getAlarmSeverity()),e.newValue?s.getAlarmState().increaseAcknowledgedAlarm(t.getAlarmSeverity()):s.getAlarmState().increaseNewAlarm(t.getAlarmSeverity())}}},handleAlarmSeverityChange:function(t,e){var i=e.oldValue,n=e.newValue,s=this.getCorrespondingElements(t);if(s)for(var r=0;r<s.size();r++){var a=s.get(r);i&&(t.isAcked()?a.getAlarmState().decreaseAcknowledgedAlarm(i):a.getAlarmState().decreaseNewAlarm(i)),n&&(t.isAcked()?a.getAlarmState().increaseAcknowledgedAlarm(n):a.getAlarmState().increaseNewAlarm(n))}},getCorrespondingAlarms:function(t){return this._alarmElementMapping.getCorrespondingAlarms(t)},getCorrespondingElements:function(t){return this._alarmElementMapping.getCorrespondingElements(t)},handleElementAdded:function(t){var e=this.getCorrespondingAlarms(t);if(e)for(var i=0;i<e.size();i++){var n=e.get(i);if(!n.isCleared()){var s=n.getAlarmSeverity();s&&(n.isAcked()?t.getAlarmState().increaseAcknowledgedAlarm(s):t.getAlarmState().increaseNewAlarm(s))}}},_increaseAlarmState:function(t,e){if(!t.isCleared()||e){var i=t.getAlarmSeverity();if(i){var n=this.getCorrespondingElements(t);if(n)for(var s=0;s<n.size();s++){var r=n.get(s);t.isAcked()?r.getAlarmState().increaseAcknowledgedAlarm(i):r.getAlarmState().increaseNewAlarm(i)}}}},_decreaseAlarmState:function(t,e){if(t.isCleared||console.log(),!t.isCleared()||e){var i=t.getAlarmSeverity();if(i){var n=this.getCorrespondingElements(t);if(n)for(var s=0;s<n.size();s++){var r=n.get(s);t.isAcked()?r.getAlarmState().decreaseAcknowledgedAlarm(i):r.getAlarmState().decreaseNewAlarm(i)}}}},handleElementRemoved:function(t){var e=this.getCorrespondingAlarms(t);e&&e.forEach(function(e){!e.isCleared()&&e.getAlarmSeverity()&&(e.isAcked()?t.getAlarmState().decreaseAcknowledgedAlarm(e.getAlarmSeverity()):t.getAlarmState().decreaseNewAlarm(e.getAlarmSeverity()))})},removeAlarmsByElement:function(t){var e=this.getCorrespondingAlarms(t);e&&e.forEach(this.remove,this)},add:function(t,e){if(!t.IAlarm)throw"Only IAlarm can be added into AlarmBox";this._removeAlarmWhenAlarmIsCleared&&t.isCleared()||Ke.AlarmBox.superClass.add.apply(this,arguments)}}),Ke.AlarmElementMapping=function(t,e){if(!e)throw"ElementBox can not be null";if(!t)throw"AlarmBox can not be null";this._elementBox=e,this._alarmBox=t,this._alarmsFinder=new Ke.QuickFinder(t,"elementId")},Ke.extend(Ke.AlarmElementMapping,Object,{getCorrespondingAlarms:function(t){return this._alarmsFinder.find(t.getId())},getCorrespondingElements:function(t){var e=this._elementBox.getDataById(t.getElementId());return new ci(e)},dispose:function(){delete this._elementBox,delete this._alarmBox,delete this._alarmsFinder}}),Ke.PropertyPropagator=function(t,e,i){if(!t)throw"dataBox can not be null";if(!e)throw"propertyName can not be null";this._dataBox=t,this._propertyName=e,this._propertyType=i||"accessor","accessor"===this._propertyType&&(this._getter=Ke.getter(e),this._setter=Ke.setter(e)),this._enable=!1,this._isPropagating=!1},Ke.extend(Ke.PropertyPropagator,Object,{getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isEnable:function(){return this._enable},setEnable:function(t){if(this._enable!==t)if(this._enable=t,this._enable){this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this);for(var e in this._dataBox.datas)this.propagate(this._dataBox.datas[e])}else this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this)},handleDataBoxChange:function(t){t.data&&this.propagate(t.data)},handleDataPropertyChange:function(t){if(this.isInterestedProperty(t))this.propagate(t.source);else if("parent"===t.property){var e=t.oldValue;e&&this.propagate(e),this.propagate(t.source)}},isInterestedProperty:function(t){return"accessor"===this._propertyType&&this._propertyName===t.property||(!("style"!==this._propertyType||!t.IElement||"S:"+this._propertyName!==t.property)||"client"===this._propertyType&&"C:"+this._propertyName===t.property)},propagate:function(t){t&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(t),this._isPropagating=!1)},propagateToTop:function(t){for(this.propagateToParent(null,t);t&&t.getParent();)this.propagateToParent(t,t.getParent()),t=t.getParent()},propagateToParent:function(t,e){}}),Ke.AlarmStatePropagator=function(t){Ke.AlarmStatePropagator.superClass.constructor.call(this,t,"alarmState")},Ke.extend(Ke.AlarmStatePropagator,Ke.PropertyPropagator,{handleDataPropertyChange:function(t){"enablePropagation"===t.property?this.propagate(t.source):Ke.AlarmStatePropagator.superClass.handleDataPropertyChange.call(this,t)},propagateToParent:function(t,e){var i=null;e.getChildren().forEach(function(t){var e=t.getAlarmState().getHighestOverallAlarmSeverity();Ke.AlarmSeverity.compare(e,i)>0&&(i=e)}),e.getAlarmState&&e.getAlarmState().setPropagateSeverity(i)}});var mi={KEEP_DEFAULT_FUNCTION:function(t){return!(!t.target.keepDefault&&!t.target.getAttribute("keepDefault"))||(!(!t.target.parentNode||!t.target.parentNode.keepDefault&&!t.target.parentNode.getAttribute("keepDefault"))||!!t.shiftKey)}};mi.paintSortFunction=function(t,e){return t.z!==e.z?t.z-e.z:0},mi.doubleClickToLookAtFunction=function(t){return!0},mi.needSmoothNormalFunction=function(t){var e=t instanceof vi||t instanceof Ke.TextNode||t instanceof Ke.PathCube||t instanceof Ke.ShapeNode||t instanceof Ke.ComboNode||"TGL.Entity"==t.getClassName();return!e},mi.PATH_LINK_COMPUTE_DELAY=!1,Ke.Defaults=mi,Ke.BasicShader={vertex_shader:"",fragment_shader:""},Ke.ShaderUtil={},Ke.ShaderUtil.getShader=function(t){},Ke.ShaderChunk={gradient_parts_fragment:["#ifdef MAX_GRADIENT","uniform vec3 gradientColor[MAX_GRADIENT];","uniform float gradientStop[MAX_GRADIENT];","uniform int gradientType;","#endif"].join("\n"),gradient_basic_fragment:["#ifdef MAX_GRADIENT","float gradientUV = 1.0;","float PI = 3.14;","if(gradientType == 1){","gradientUV = oUv.x;","} else if(gradientType == 2){","gradientUV = oUv.y;","} else if(gradientType == 3){","gradientUV = (oUv.x + oUv.y)/2.0;","} else if(gradientType == 4){","gradientUV = (oUv.x + 1.0 - oUv.y)/2.0;","} else if(gradientType == 5){","gradientUV = 1.414 * sqrt((oUv.x - 0.5) * (oUv.x - 0.5) + (oUv.y - 0.5) * (oUv.y - 0.5));","} else if(gradientType == 6){","gradientUV = (atan(oUv.y - 0.5,oUv.x - 0.5)) / (2.0 * PI);","if(gradientUV < 0.0){","gradientUV = 1.0 + gradientUV;","}","}","for( int i = 1; i < MAX_GRADIENT; i ++ ){","if(gradientStop[i - 1] <= gradientUV){","if((gradientStop[i] >= gradientUV)){","vec3 color1 = gradientColor[i-1];","vec3 color2 = gradientColor[i];","float stop1 = gradientStop[i-1];","float stop2 =gradientStop[i]; ","gl_FragColor = vec4( (color1 * (stop2 - gradientUV )  + color2 * (gradientUV - stop1))/(stop2 - stop1),opacity);","break;","}","}","}","#endif"].join("\n"),gradient_phong_fragment:["#ifdef MAX_GRADIENT","float gradientUV = 1.0;","float PI = 3.14;","if(gradientType == 1){","gradientUV = oUv.x;","} else if(gradientType == 2){","gradientUV = oUv.y;","} else if(gradientType == 3){","gradientUV = (oUv.x + oUv.y)/2.0;","} else if(gradientType == 4){","gradientUV = (oUv.x + 1.0 - oUv.y)/2.0;","} else if(gradientType == 5){","gradientUV = 1.414 * sqrt((oUv.x - 0.5) * (oUv.x - 0.5) + (oUv.y - 0.5) * (oUv.y - 0.5));","} else if(gradientType == 6){","gradientUV = (atan(oUv.y - 0.5,oUv.x - 0.5)) / (2.0 * PI);","if(gradientUV < 0.0){","gradientUV = 1.0 + gradientUV;","}","}","for( int i = 1; i < MAX_GRADIENT; i ++ ){","if(gradientStop[i - 1] < gradientUV){","if((gradientStop[i] > gradientUV)){","vec3 color1 = gradientColor[i-1];","vec3 color2 = gradientColor[i];","float stop1 = gradientStop[i-1];","float stop2 = gradientStop[i]; ","tempDiffuse = (color1 * (stop2 - gradientUV )  + color2 * (gradientUV - stop1))/(stop2 - stop1);","break;","}","}","}","#endif"].join("\n"),fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( reflectVec.x*flipEnvMap,  reflectVec.y,reflectVec.z) );","#else","vec4 cubeColor = textureCube( envMap, vec3(reflectVec.x*flipEnvMap,  reflectVec.y,reflectVec.z) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","#ifdef PHONG","#else","float specularStrength = 1.0;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP ) ","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined(MAX_GRADIENT)","varying vec2 vUv;","varying vec2 oUv;","uniform vec4 offsetRepeat;","uniform bool flipX; ","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined(MAX_GRADIENT)","varying vec2 vUv;","varying vec2 oUv;","#endif","#ifdef USE_MAP","uniform bool mapLoaded;","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined(MAX_GRADIENT)","if(flipX){","vUv.x = uv.x * offsetRepeat.z * (-1.0) + offsetRepeat.x + offsetRepeat.z;","vUv.y = uv.y * offsetRepeat.w  + offsetRepeat.y;","}else{","vUv = uv * offsetRepeat.zw  + offsetRepeat.xy;","}","oUv = uv;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","if(mapLoaded){","vec4 texelColor = texture2D( map, vUv );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = texelColor * gl_FragColor;","}","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),
specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = uspecularStrength;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0 ","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","vSpotLight[ i ] = vec4( lVector, lDistance );","}","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#else","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#else","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -viewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vPointLight[ i ].xyz );","float lDistance = vPointLight[ i ].w;","#endif","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += tempDiffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","#else","pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vSpotLight[ i ].xyz );","float lDistance = vSpotLight[ i ].w;","#endif","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ]) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += tempDiffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","#else","spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += tempDiffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += tempDiffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","float ssao = 1.0;","#ifdef USE_SSAO","ssao = clamp(1.0 - texture2D(mapSSAO, (finalPosition.xy / finalPosition.w / 2.0 + vec2(0.5,0.5))).x,0.0,1.0);","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + (ambientLightColor * ambient * ssao) + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + (ambientLightColor * ambient) * ssao ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, opacity );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, N_BONE_PIXEL_X );","float y = floor( j / N_BONE_PIXEL_X );","const float dx = 1.0 / N_BONE_PIXEL_X;","const float dy = 1.0 / N_BONE_PIXEL_Y;","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix \t+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","#endif","#ifdef USE_POINT_SHADOWMAP","uniform samplerCube pShadowMap[MAX_POINT_SHADOWS];","uniform float pShadowDarkness[MAX_POINT_SHADOWS];","uniform vec3 pPosition[MAX_POINT_SHADOWS];","varying vec4 pWorldPosition;","#endif","#if defined(USE_SHADOWMAP) || defined(USE_POINT_SHADOWMAP)","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","float unpack (vec4 colour){","const vec4 bitShifts = vec4(1.0,1.0 / 255.0,1.0 / (255.0 * 255.0),1.0 / (255.0 * 255.0 * 255.0));","return dot(colour, bitShifts) * 100000.0;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3(inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2(inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( depthKernel[0][0] < shadowCoord.z ) shadowKernel[0][0] = 0.25;","else shadowKernel[0][0] = 0.0;","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( depthKernel[0][1] < shadowCoord.z ) shadowKernel[0][1] = 0.25;","else shadowKernel[0][1] = 0.0;","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( depthKernel[0][2] < shadowCoord.z ) shadowKernel[0][2] = 0.25;","else shadowKernel[0][2] = 0.0;","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( depthKernel[1][0] < shadowCoord.z ) shadowKernel[1][0] = 0.25;","else shadowKernel[1][0] = 0.0;","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( depthKernel[1][1] < shadowCoord.z ) shadowKernel[1][1] = 0.25;","else shadowKernel[1][1] = 0.0;","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( depthKernel[1][2] < shadowCoord.z ) shadowKernel[1][2] = 0.25;","else shadowKernel[1][2] = 0.0;","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( depthKernel[2][0] < shadowCoord.z ) shadowKernel[2][0] = 0.25;","else shadowKernel[2][0] = 0.0;","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( depthKernel[2][1] < shadowCoord.z ) shadowKernel[2][1] = 0.25;","else shadowKernel[2][1] = 0.0;","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( depthKernel[2][2] < shadowCoord.z ) shadowKernel[2][2] = 0.25;","else shadowKernel[2][2] = 0.0;","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif","#ifdef USE_POINT_SHADOWMAP","for( int i = 0; i < MAX_POINT_SHADOWS; i ++ ) {","vec3 lightVec = normalize(pWorldPosition.xyz - pPosition[i]);","float depth = length(pWorldPosition.xyz - pPosition[i]);","float shadowDepth = unpack (textureCube(pShadowMap[i], lightVec));","depth = depth * 0.95;","if ( depth > shadowDepth){","gl_FragColor.xyz *= 0.8;","}","}","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif","#ifdef USE_POINT_SHADOWMAP","varying vec4 pWorldPosition;","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","#ifdef USE_POINT_SHADOWMAP","pWorldPosition = modelMatrix * vec4(position,1.0);","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")},Ke.UniformsUtils={merge:function(t){var e,i,n,s={};for(e=0;e<t.length;e++){n=this.clone(t[e]);for(i in n)s[i]=n[i]}return s},clone:function(t){var e,i,n,s={};for(e in t){s[e]={};for(i in t[e])n=t[e][i],n instanceof Ke.Color||n instanceof Ke.Vec2||n instanceof Ke.Vec3||n instanceof Ke.Vec4||n instanceof Ke.Mat4||n instanceof Ke.Texture?s[e][i]=n.clone():n instanceof Array?s[e][i]=n.slice():s[e][i]=n}return s}},Ke.UniformsLib={outline:{diffuse:{type:"c",value:new Ke.Color(15658734)},outline_offset:{type:"f",value:0}},glow:{map:{type:"t",value:null}},blur:{orientation:{type:"i",value:0},texelSize:{type:"v2",value:new Ke.Vec2(512,512)},blurAmount:{type:"i",value:10},blurScale:{type:"f",value:1},blurStrength:{type:"f",value:.2},map:{type:"t",value:null},useBlur:{type:"i",value:1},blurGlobalAlpha:{type:"f",value:1}},deferred:{linearDepth:{type:"f",value:9e3},isNormal:{type:"i",value:1}},ssao:{map0:{type:"t",value:null},map1:{type:"t",value:null},map2:{type:"t",value:null},occluderBias:{type:"f",value:.05},samplingRadius:{type:"f",value:20},attenuation:{type:"v2",value:new Qe(1,0)},texelSize:{type:"v2",value:new Qe(1/512,1/512)}},common:{diffuse:{type:"c",value:new Ke.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},mapLoaded:{type:"i",value:0},offsetRepeat:{type:"v4",value:new Ke.Vec4(0,0,1,1)},flipX:{type:"i",value:0},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},gradient:{gradientColor:{type:"v3v",value:[]},gradientStop:{type:"fv1",value:[]},gradientType:{type:"i",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new Ke.Vec2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new Ke.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{
type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new Ke.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new Ke.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]},pShadowMap:{type:"tv",value:[]},pShadowMapSize:{type:"v2v",value:[]},pShadowDarkness:{type:"fv1",value:[]},pPosition:{type:"v3v",value:[]}}},Ke.ShaderLib={outline:{uniforms:Ke.UniformsUtils.merge([Ke.UniformsLib.outline]),vertexShader:["uniform float outline_offset;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position + normalize(position)  * outline_offset, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","void main() {","gl_FragColor = vec4(diffuse, 1.0 );","}"].join("\n")},blur:{uniforms:Ke.UniformsUtils.merge([Ke.UniformsLib.blur]),vertexShader:["varying vec2 vUv;","void main (){","gl_Position = vec4(position, 1.0);","vUv = uv;","}"].join("\n"),fragmentShader:["uniform vec2 texelSize;","uniform sampler2D map;","uniform int orientation;","uniform int blurAmount;","uniform float blurScale;","uniform float blurStrength;","uniform int useBlur;","uniform float blurGlobalAlpha;","uniform sampler2D depthMap;","varying vec2 vUv;","float Gaussian (float x, float deviation){","return (1.0 / sqrt(2.0 * 3.141592 * deviation)) * exp(-((x * x) / (2.0 * deviation)));","}","void main (){","float halfBlur = float(blurAmount) * 0.5;","vec4 colour = vec4(0.0);","if(useBlur == 0){","colour = texture2D(map,vUv);","}else {","vec4 texColour = vec4(0.0);","float deviation = halfBlur * 0.35;","deviation *= deviation;","float strength = 1.0 - blurStrength;","if ( orientation == 0 ){","for (int i = 0; i < 20; ++i){","if ( i >= blurAmount ){","break;","}","float offset = float(i) - halfBlur;","texColour = texture2D(map, vUv + vec2(offset / texelSize.x * blurScale, 0.0)) * Gaussian(offset * strength, deviation);","colour += texColour;","}","}else{","for (int i = 0; i < 20; ++i){","if ( i >= blurAmount )","break;","float offset = float(i) - halfBlur;","texColour = texture2D(map, vUv + vec2(0.0, offset / texelSize.y * blurScale)) * Gaussian(offset * strength, deviation);","colour += texColour;","}","}","}","gl_FragColor = clamp(colour, 0.0, 1.0);","if(useBlur == 0){","gl_FragColor.w *=  gl_FragColor.w * gl_FragColor.w * gl_FragColor.w * blurGlobalAlpha;","}","}"].join("\n")},deferred:{uniforms:Ke.UniformsUtils.merge([Ke.UniformsLib.deferred]),vertexShader:["varying vec4 vPosition;","varying vec3 vNormal;","void main (){","vNormal = mat3(modelViewMatrix) * normal;","vPosition = modelViewMatrix * vec4(position, 1.0);","gl_Position = projectionMatrix * vPosition;","}"].join("\n"),fragmentShader:["uniform float linearDepth;","uniform int isNormal;","varying vec4 vPosition;","varying vec3 vNormal;","void main (){","float linear_depth = length(vPosition) / linearDepth;","if(isNormal == 1){","vec3 normal = normalize(vNormal);","gl_FragColor = vec4(normal.x, normal.y, normal.z, 1.0);","}else{","gl_FragColor = vec4(vPosition.x, vPosition.y, vPosition.z, linear_depth);","}","}"].join("\n")},ssao:{uniforms:Ke.UniformsUtils.merge([Ke.UniformsLib.ssao]),vertexShader:["varying vec2 vUv;","void main (){","gl_Position = vec4(position, 1.0);","vUv = uv;","}"].join("\n"),fragmentShader:["uniform sampler2D map0;","uniform sampler2D map1;","uniform sampler2D map2;","uniform vec2 texelSize;","uniform float occluderBias;","uniform float samplingRadius;","uniform vec2 attenuation;","varying vec2 vUv;","float samplePixels (vec3 srcPosition, vec3 srcNormal, vec2 uv){","vec3 dstPosition = texture2D(map0, uv).xyz;","vec3 positionVec = dstPosition - srcPosition;","float intensity = max(dot(normalize(positionVec), srcNormal) - occluderBias, 0.0);","float dist = length(positionVec);","float attenuationValue = 1.0 / (attenuation.x + (attenuation.y * dist));","return intensity * attenuationValue;","}","void main (){","vec3 srcPosition = texture2D(map0, vUv).xyz;","vec3 srcNormal = texture2D(map1, vUv).xyz;","vec2 randVec = normalize(texture2D(map2, vUv).xy * 2.0 - 1.0);","float srcDepth = texture2D(map0, vUv).w;","float kernelRadius = samplingRadius * (1.0 - srcDepth);","vec2 kernel[4];","kernel[0] = vec2(0.0, 1.0);","kernel[1] = vec2(1.0, 0.0);","kernel[2] = vec2(0.0, -1.0);","kernel[3] = vec2(-1.0, 0.0);","const float sin45 = 0.707107;","float occlusion = 0.0;","for (int i = 0; i < 4; ++i){","vec2 k1 = reflect(kernel[i], randVec);","vec2 k2 = vec2(k1.x * sin45 - k1.y * sin45,k1.x * sin45 + k1.y * sin45);","k1 *= texelSize;","k2 *= texelSize;","occlusion += samplePixels(srcPosition, srcNormal, vUv + k1 * kernelRadius);","occlusion += samplePixels(srcPosition, srcNormal, vUv + k2 * kernelRadius * 0.75);","occlusion += samplePixels(srcPosition, srcNormal, vUv + k1 * kernelRadius * 0.5);","occlusion += samplePixels(srcPosition, srcNormal, vUv + k2 * kernelRadius * 0.25);","}","occlusion /= 16.0;","occlusion = clamp(occlusion, 0.0, 1.0);","gl_FragColor =  vec4(occlusion,0.0,0.0,1.0);","}"].join("\n")},basic:{uniforms:Ke.UniformsUtils.merge([Ke.UniformsLib.common,Ke.UniformsLib.gradient,Ke.UniformsLib.fog]),vertexShader:[Ke.ShaderChunk.map_pars_vertex,Ke.ShaderChunk.lightmap_pars_vertex,Ke.ShaderChunk.envmap_pars_vertex,Ke.ShaderChunk.color_pars_vertex,Ke.ShaderChunk.morphtarget_pars_vertex,Ke.ShaderChunk.skinning_pars_vertex,"void main() {",Ke.ShaderChunk.map_vertex,Ke.ShaderChunk.lightmap_vertex,Ke.ShaderChunk.color_vertex,Ke.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",Ke.ShaderChunk.morphnormal_vertex,Ke.ShaderChunk.skinnormal_vertex,Ke.ShaderChunk.defaultnormal_vertex,"#endif",Ke.ShaderChunk.morphtarget_vertex,Ke.ShaderChunk.skinning_vertex,Ke.ShaderChunk.default_vertex,Ke.ShaderChunk.worldpos_vertex,Ke.ShaderChunk.envmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",Ke.ShaderChunk.color_pars_fragment,Ke.ShaderChunk.map_pars_fragment,Ke.ShaderChunk.gradient_parts_fragment,Ke.ShaderChunk.lightmap_pars_fragment,Ke.ShaderChunk.envmap_pars_fragment,Ke.ShaderChunk.fog_pars_fragment,Ke.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( diffuse, opacity );",Ke.ShaderChunk.gradient_basic_fragment,Ke.ShaderChunk.map_fragment,Ke.ShaderChunk.alphatest_fragment,Ke.ShaderChunk.lightmap_fragment,Ke.ShaderChunk.color_fragment,Ke.ShaderChunk.envmap_fragment,Ke.ShaderChunk.linear_to_gamma_fragment,Ke.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:Ke.UniformsUtils.merge([Ke.UniformsLib.common,Ke.UniformsLib.fog,Ke.UniformsLib.lights,Ke.UniformsLib.shadowmap,{ambient:{type:"c",value:new Ke.Color(16777215)},emissive:{type:"c",value:new Ke.Color(0)},wrapRGB:{type:"v3",value:new Ke.Vec3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",Ke.ShaderChunk.map_pars_vertex,Ke.ShaderChunk.lightmap_pars_vertex,Ke.ShaderChunk.envmap_pars_vertex,Ke.ShaderChunk.lights_lambert_pars_vertex,Ke.ShaderChunk.color_pars_vertex,Ke.ShaderChunk.morphtarget_pars_vertex,Ke.ShaderChunk.skinning_pars_vertex,Ke.ShaderChunk.shadowmap_pars_vertex,"void main() {",Ke.ShaderChunk.map_vertex,Ke.ShaderChunk.lightmap_vertex,Ke.ShaderChunk.color_vertex,Ke.ShaderChunk.morphnormal_vertex,Ke.ShaderChunk.skinbase_vertex,Ke.ShaderChunk.skinnormal_vertex,Ke.ShaderChunk.defaultnormal_vertex,Ke.ShaderChunk.morphtarget_vertex,Ke.ShaderChunk.skinning_vertex,Ke.ShaderChunk.default_vertex,Ke.ShaderChunk.worldpos_vertex,Ke.ShaderChunk.envmap_vertex,Ke.ShaderChunk.lights_lambert_vertex,Ke.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",Ke.ShaderChunk.color_pars_fragment,Ke.ShaderChunk.map_pars_fragment,Ke.ShaderChunk.lightmap_pars_fragment,Ke.ShaderChunk.envmap_pars_fragment,Ke.ShaderChunk.fog_pars_fragment,Ke.ShaderChunk.shadowmap_pars_fragment,Ke.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",Ke.ShaderChunk.map_fragment,Ke.ShaderChunk.alphatest_fragment,Ke.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",Ke.ShaderChunk.lightmap_fragment,Ke.ShaderChunk.color_fragment,Ke.ShaderChunk.envmap_fragment,Ke.ShaderChunk.shadowmap_fragment,Ke.ShaderChunk.linear_to_gamma_fragment,Ke.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:Ke.UniformsUtils.merge([Ke.UniformsLib.common,Ke.UniformsLib.gradient,Ke.UniformsLib.bump,Ke.UniformsLib.normalmap,Ke.UniformsLib.fog,Ke.UniformsLib.lights,Ke.UniformsLib.shadowmap,{ambient:{type:"c",value:new Ke.Color(16777215)},emissive:{type:"c",value:new Ke.Color(0)},specular:{type:"c",value:new Ke.Color(1118481)},uspecularStrength:{type:"f",value:1},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new Ke.Vec3(1,1,1)},mapSSAO:{type:"t",value:null}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;","varying vec4 finalPosition;",Ke.ShaderChunk.map_pars_vertex,Ke.ShaderChunk.lightmap_pars_vertex,Ke.ShaderChunk.envmap_pars_vertex,Ke.ShaderChunk.lights_phong_pars_vertex,Ke.ShaderChunk.color_pars_vertex,Ke.ShaderChunk.morphtarget_pars_vertex,Ke.ShaderChunk.skinning_pars_vertex,Ke.ShaderChunk.shadowmap_pars_vertex,"void main() {",Ke.ShaderChunk.map_vertex,Ke.ShaderChunk.lightmap_vertex,Ke.ShaderChunk.color_vertex,Ke.ShaderChunk.morphnormal_vertex,Ke.ShaderChunk.skinbase_vertex,Ke.ShaderChunk.skinnormal_vertex,Ke.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",Ke.ShaderChunk.morphtarget_vertex,Ke.ShaderChunk.skinning_vertex,Ke.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",Ke.ShaderChunk.worldpos_vertex,Ke.ShaderChunk.envmap_vertex,Ke.ShaderChunk.lights_phong_vertex,Ke.ShaderChunk.shadowmap_vertex,"finalPosition = gl_Position;","}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float uspecularStrength;","uniform float shininess;","varying vec4 finalPosition;",Ke.ShaderChunk.color_pars_fragment,Ke.ShaderChunk.gradient_parts_fragment,Ke.ShaderChunk.map_pars_fragment,Ke.ShaderChunk.lightmap_pars_fragment,Ke.ShaderChunk.envmap_pars_fragment,Ke.ShaderChunk.fog_pars_fragment,Ke.ShaderChunk.lights_phong_pars_fragment,Ke.ShaderChunk.shadowmap_pars_fragment,Ke.ShaderChunk.bumpmap_pars_fragment,Ke.ShaderChunk.normalmap_pars_fragment,Ke.ShaderChunk.specularmap_pars_fragment,"#ifdef USE_SSAO","uniform sampler2D mapSSAO;","#endif","void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );","vec3 tempDiffuse = diffuse;",Ke.ShaderChunk.gradient_phong_fragment,Ke.ShaderChunk.map_fragment,Ke.ShaderChunk.alphatest_fragment,Ke.ShaderChunk.specularmap_fragment,Ke.ShaderChunk.lights_phong_fragment,Ke.ShaderChunk.lightmap_fragment,Ke.ShaderChunk.color_fragment,Ke.ShaderChunk.envmap_fragment,Ke.ShaderChunk.shadowmap_fragment,Ke.ShaderChunk.linear_to_gamma_fragment,Ke.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:Ke.UniformsUtils.merge([Ke.UniformsLib.particle,Ke.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",Ke.ShaderChunk.color_pars_vertex,Ke.ShaderChunk.shadowmap_pars_vertex,"void main() {",Ke.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","float s = normal.x;","if(s == 0.0){","   s = 1.0;","}","gl_PointSize = size * s;","#endif","gl_Position = projectionMatrix * mvPosition;",Ke.ShaderChunk.worldpos_vertex,Ke.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",Ke.ShaderChunk.color_pars_fragment,Ke.ShaderChunk.map_particle_pars_fragment,Ke.ShaderChunk.fog_pars_fragment,Ke.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",Ke.ShaderChunk.map_particle_fragment,Ke.ShaderChunk.alphatest_fragment,Ke.ShaderChunk.color_fragment,Ke.ShaderChunk.shadowmap_fragment,Ke.ShaderChunk.fog_fragment,"}"].join("\n")},billboard:{vertexShader:["uniform int useScreenCoordinates;","uniform int sizeAttenuation;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position + alignment;","vec2 rotatedPosition;","rotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;","rotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;","vec4 finalPosition;","if( useScreenCoordinates != 0 ) {","finalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );","} else {","finalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition * ( sizeAttenuation == 1 ? 1.0 : finalPosition.z );","}","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")},dashed:{uniforms:Ke.UniformsUtils.merge([Ke.UniformsLib.common,Ke.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",Ke.ShaderChunk.color_pars_vertex,"void main() {",Ke.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",Ke.ShaderChunk.color_pars_fragment,Ke.ShaderChunk.fog_pars_fragment,"void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","gl_FragColor = vec4( diffuse, opacity );",Ke.ShaderChunk.color_fragment,Ke.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:Ke.UniformsUtils.merge([Ke.UniformsLib.fog,Ke.UniformsLib.lights,Ke.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new Ke.Vec2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new Ke.Color(16777215)},uSpecularColor:{type:"c",value:new Ke.Color(1118481)},uSpecualarStrength:{type:"f",value:1},uAmbientColor:{type:"c",value:new Ke.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new Ke.Vec2(0,0)},uRepeat:{type:"v2",value:new Ke.Vec2(1,1)},wrapRGB:{type:"v3",value:new Ke.Vec3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform vec3 uSpecularStrength;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float uRefractionRatio;","uniform float uReflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",Ke.ShaderChunk.shadowmap_pars_fragment,Ke.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","#else","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","#else","spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += uDiffuseColor * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, uRefractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );","}",Ke.ShaderChunk.shadowmap_fragment,Ke.ShaderChunk.linear_to_gamma_fragment,Ke.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",Ke.ShaderChunk.skinning_pars_vertex,Ke.ShaderChunk.shadowmap_pars_vertex,"void main() {",Ke.ShaderChunk.skinbase_vertex,Ke.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")},depthRGBA:{uniforms:{isCube:{type:"i",value:0}},vertexShader:[Ke.ShaderChunk.morphtarget_pars_vertex,Ke.ShaderChunk.skinning_pars_vertex,"varying vec4 vPosition1;","void main() {",Ke.ShaderChunk.skinbase_vertex,Ke.ShaderChunk.morphtarget_vertex,Ke.ShaderChunk.skinning_vertex,Ke.ShaderChunk.default_vertex,"vPosition1 = modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),
fragmentShader:["uniform int isCube;","varying vec4 vPosition1;","varying vec3 vPosition2;","vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","vec4 pack (float depth){","const vec4 bias = vec4(1.0 / 255.0,1.0 / 255.0,1.0 / 255.0, 0.0);","float r = depth;","float g = fract(r * 255.0);","float b = fract(g * 255.0);","float a = fract(b * 255.0);","vec4 colour = vec4(r, g, b, a);","return colour - (colour.yzww * bias);","}","void main() {","if(isCube == 1){","gl_FragData[ 0 ] = pack(length(vPosition1) / 100000.0);","}else{","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}","}"].join("\n")}},Ke.ShaderTerrain={terrain:{uniforms:Ke.UniformsUtils.merge([Ke.UniformsLib.fog,Ke.UniformsLib.lights,Ke.UniformsLib.shadowmap,{enableDiffuse1:{type:"i",value:0},enableDiffuse2:{type:"i",value:0},enableDiffuse3:{type:"i",value:0},enableDisplacement:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse1:{type:"t",value:null},tDiffuse2:{type:"t",value:null},tDiffuse3:{type:"t",value:null},tDetail:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tDisplacement:{type:"t",value:null},heightUnit:{type:"f",value:1},blendRange:{type:"fv1",value:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new Ke.Color(15658734)},uSpecularColor:{type:"c",value:new Ke.Color(1118481)},uAmbientColor:{type:"c",value:new Ke.Color(328965)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uRepeatBase:{type:"v2",value:new Ke.Vec2(1,1)},uRepeatOverlay:{type:"v2",value:new Ke.Vec2(1,1)},uOffset:{type:"v2",value:new Ke.Vec2(0,0)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse1;","uniform bool enableDiffuse2;","uniform bool enableDiffuse3;","uniform bool enableSpecular;","uniform bool enableDisplacement;","uniform float blendRange[2];","uniform float heightUnit;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","uniform sampler2D tDiffuse3;","uniform sampler2D tDetail;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tDisplacement;","uniform float uNormalScale;","uniform vec2 uRepeatOverlay;","uniform vec2 uRepeatBase;","uniform vec2 uOffset;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec4 vPosition;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","varying vec3 vViewPosition;",Ke.ShaderChunk.shadowmap_pars_fragment,Ke.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec2 uvOverlay = uRepeatOverlay * vUv + uOffset;","vec2 uvBase = uRepeatBase * vUv;","vec3 normalTex = texture2D( tDetail, uvOverlay ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( (enableDiffuse1 && enableDiffuse2)  || (enableDiffuse1 && enableDiffuse3) || (enableDiffuse2 && enableDiffuse3) ){","vec4 colDiffuse1 = texture2D( tDiffuse1, uvOverlay );","vec4 colDiffuse2 = texture2D( tDiffuse2, uvOverlay );","vec4 colDiffuse3 = texture2D( tDiffuse3, uvOverlay );","vec4 allDefiuuses[3];","allDefiuuses[0] = colDiffuse1;","allDefiuuses[1] = colDiffuse2;","allDefiuuses[2] = colDiffuse3;","#ifdef GAMMA_INPUT","colDiffuse1.xyz *= colDiffuse1.xyz;","colDiffuse2.xyz *= colDiffuse2.xyz;","colDiffuse3.xyz *= colDiffuse3.xyz;","#endif","vec4 mixColor;","if(enableDisplacement){","vec4 dis = texture2D( tDisplacement, uvBase );","if(enableDiffuse1 && enableDiffuse2 && enableDiffuse3){","float total = dis.r + dis.g + dis.b;","if(total == 0.0){","mixColor = colDiffuse1 * 1.0/3.0 + colDiffuse2 * 1.0/3.0 + colDiffuse3 * 1.0/3.0;","}else{","mixColor = colDiffuse1 * dis.r/total + colDiffuse2 * dis.g/total + colDiffuse3 * dis.b/total;","}","}","}else {","mixColor = colDiffuse2;","float y = vPosition.y;","float blend2Bottom = blendRange[1] * heightUnit * 255.0;","float percent = 0.0;","if(y < blendRange[0] * heightUnit * 255.0){","mixColor = colDiffuse1;","percent = y / (blendRange[0] * heightUnit * 255.0);","if(percent >=0.8){","mixColor = mix(colDiffuse1,colDiffuse2,(percent - 0.8) / 0.2);","}","} else if(y > blend2Bottom){","mixColor = colDiffuse3;","percent = (y - blend2Bottom) / (heightUnit * 255.0 - blend2Bottom);","if(percent <= 0.2){","mixColor = mix(colDiffuse2,colDiffuse3,percent/0.2);","}","}","}","gl_FragColor = gl_FragColor * mixColor;"," } else if( enableDiffuse1 ) {","gl_FragColor = gl_FragColor * texture2D( tDiffuse1, uvOverlay );","} else if( enableDiffuse2 ) {","gl_FragColor = gl_FragColor * texture2D( tDiffuse2, uvOverlay );","}","if( enableSpecular )","specularTex = texture2D( tSpecular, uvOverlay ).xyz;","mat3 tsb = mat3( vTangent, vBinormal, vNormal );","vec3 finalNormal = tsb * normalTex;","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDistance = lDistance;","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","hemiDiffuse += uDiffuseColor * mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","hemiSpecular += uSpecularColor * mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight ) * hemiSpecularWeight * hemiDiffuseWeight;","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif",Ke.ShaderChunk.shadowmap_fragment,Ke.ShaderChunk.linear_to_gamma_fragment,Ke.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uRepeatBase;","uniform sampler2D tNormal;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec4 vPosition;","varying vec3 vViewPosition;",Ke.ShaderChunk.shadowmap_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","vBinormal = cross( vNormal, vTangent ) * tangent.w;","vBinormal = normalize( vBinormal );","vUv = uv;","vec2 uvBase = uv * uRepeatBase;","#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uvBase ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec3 displacedPosition = normal * df + position;","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","#else","vPosition = vec4(position,1.0);","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;","vViewPosition = -mvPosition.xyz;","vec3 normalTex = texture2D( tNormal, uvBase ).xyz * 2.0 - 1.0;","vNormal = normalMatrix * normalTex;",Ke.ShaderChunk.shadowmap_vertex,"}"].join("\n")}},Ke.ShaderLib.terrain=Ke.ShaderTerrain.terrain,Ke.Fog=function(t,i,n){this.name="",this.color=new Ke.Color(t),this.near=i!==e?i:1,this.far=n!==e?n:1e3},Ke.Fog.prototype={constructor:Ke.Fog,clone:function(){return new Ke.Flog(this.color.getHex(),this.near,this.far)},refreshUniforms:function(t){t.fogNear.value=this.near,t.fogFar.value=this.far,t.fogColor.value=this.color}},Ke.FogExp2=function(t,i){this.name="",this.color=new Ke.Color(t),this.density=i!==e?i:1},Ke.FogExp2.prototype={DensityFactor:25e-5,constructor:Ke.FogExp2,clone:function(){return new Ke.FogExp2(this.color.getHex(),this.density)},refreshUniforms:function(t){t.fogDensity.value=this.density*this.DensityFactor,t.fogColor.value=this.color}};var yi={},Ai=yi.RADIANS_TO_DEGREES=180/Math.PI,xi=yi.DEGREES_TO_RADIANS=Math.PI/180;yi.isPowerOfTwo=function(t){return 0===(t&t-1)},yi.clone=function(t,i){i==e&&(i=new t.prototype.constructor);for(var n in t)if("id"!==n){var s=t[n];if(s.copy&&"function"==typeof s.copy)i[n].copy(s);else if(s instanceof Array){var r=s,a=i[n];null==a&&(a=[]);for(var o=0;o<r.length;o++){var h=r[o];a.push(h.clone())}}else cloneObjet[n]=s}},yi.paramToGL=function(t,e){if(!e)return void console.error("No webgl context");switch(t){case Ke.RepeatWrapping:return e.REPEAT;case Ke.ClampToEdgeWrapping:return e.CLAMP_TO_EDGE;case Ke.MirroredRepeatWrapping:return e.MIRRORED_REPEAT;case Ke.NearestFilter:return e.NEAREST;case Ke.NearestMipMapNearestFilter:return e.NEAREST_MIPMAP_NEAREST;case Ke.NearestMipMapLinearFilter:return e.NEAREST_MIPMAP_LINEAR;case Ke.LinearFilter:return e.LINEAR;case Ke.LinearMipMapNearestFilter:return e.LINEAR_MIPMAP_NEAREST;case Ke.LinearMipMapLinearFilter:return e.LINEAR_MIPMAP_LINEAR;case Ke.ByteType:return e.BYTE;case Ke.UnsignedByteType:return e.UNSIGNED_BYTE;case Ke.ShortType:return e.SHORT;case Ke.UnsignedShortType:return e.UNSIGNED_SHORT;case Ke.IntType:return e.INT;case Ke.UnsignedIntType:return e.UNSIGNED_INT;case Ke.FloatType:return e.FLOAT;case Ke.AlphaFormat:return e.ALPHA;case Ke.RGBFormat:return e.RGB;case Ke.RGBAFormat:return e.RGBA;case Ke.LuminanceFormat:return e.LUMINANCE;case Ke.LuminanceAlphaFormat:return e.LUMINANCE_ALPHA;case Ke.AddEquation:return e.FUNC_ADD;case Ke.SubtractEquation:return e.FUNC_SUBTRACT;case Ke.ReverseSubtractEquation:return e.FUNC_REVERSE_SUBTRACT;case Ke.ZeroFactor:return e.ZERO;case Ke.OneFactor:return e.ONE;case Ke.SrcColorFactor:return e.SRC_COLOR;case Ke.OneMinusSrcColorFactor:return e.ONE_MINUS_SRC_COLOR;case Ke.SrcAlphaFactor:return e.SRC_ALPHA;case Ke.OneMinusSrcAlphaFactor:return e.ONE_MINUS_SRC_ALPHA;case Ke.DstAlphaFactor:return e.DST_ALPHA;case Ke.OneMinusDstAlphaFactor:return e.ONE_MINUS_DST_ALPHA;case Ke.DstColorFactor:return e.DST_COLOR;case Ke.OneMinusDstColorFactor:return e.ONE_MINUS_DST_COLOR;case Ke.SrcAlphaSaturateFactor:return e.SRC_ALPHA_SATURATE}return 0},yi.createElement=function(t,i,n,s){var r,a,o,h,l=t.vertices.length,c=(t.uvs.length,t.vertices),u=i.vertices,d=t.faces,f=i.faces,g=t.uvs,_=i.uvs,p=[],v=[],m=[];s===e&&(s=0),t instanceof Ke.Element&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,a=(new $e).getNormalMatrix(r)),i instanceof Ke.Element&&(i.matrixAutoUpdate&&i.updateMatrix(),o=i.matrix,h=(new $e).getNormalMatrix(o));for(var y=0,A=c.length;y<A;y++){var x=c[y],w=x.clone();r&&w.applyMatrix4(r),v.push(w)}for(var y=0,A=u.length;y<A;y++){var x=u[y],w=x.clone();o&&w.applyMatrix4(o),v.push(w)}for(y=0,A=d.length;y<A;y++){var b,S,C,T=d[y],E=T.vertexNormals,L=T.vertexColors;b=T instanceof _i?new _i(T.a,T.b,T.c):new pi(T.a,T.b,T.c,T.d),b.normal.copy(T.normal),a&&b.normal.applyMatrix3(a).normalize();for(var M=0,P=E.length;M<P;M++)S=E[M].clone(),a&&S.applyMatrix3(a).normalize(),b.vertexNormals.push(S);b.color.copy(T.color);for(var M=0,P=L.length;M<P;M++)C=L[M],b.vertexColors.push(C.clone());b.materialIndex=T.materialIndex,b.centroid.copy(T.centroid),r&&b.centroid.applyMatrix4(r),p.push(b)}for(y=0,A=f.length;y<A;y++){var b,S,C,T=f[y],E=T.vertexNormals,L=T.vertexColors;b=T instanceof _i?new _i(T.a+l,T.b+l,T.c+l):new pi(T.a+l,T.b+l,T.c+l,T.d+l),b.normal.copy(T.normal),h&&b.normal.applyMatrix3(h).normalize();for(var M=0,P=E.length;M<P;M++)S=E[M].clone(),h&&S.applyMatrix3(h).normalize(),b.vertexNormals.push(S);b.color.copy(T.color);for(var M=0,P=L.length;M<P;M++)C=L[M],b.vertexColors.push(C.clone());b.materialIndex=T.materialIndex+s,b.centroid.copy(T.centroid),o&&b.centroid.applyMatrix4(o),p.push(b)}for(y=0,A=g.length;y<A;y++){for(var k=g[y],I=[],M=0,P=k.length;M<P;M++)I.push(new Qe(k[M].x,k[M].y));m.push(I)}for(y=0,A=_.length;y<A;y++){for(var k=_[y],I=[],M=0,P=k.length;M<P;M++)I.push(new Qe(k[M].x,k[M].y));m.push(I)}var R=new Ke.Entity;return R.vertices=v,R.faces=p,R.uvs=m,R.material=n===e?t.material:n,R},yi.transformElement=function(t,e){var i,n,s=t.vertices,r=t.faces,a=t.uvs,o=[],h=[],l=[];t instanceof Ke.Element&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,n=(new $e).getNormalMatrix(i));for(var c=0,u=s.length;c<u;c++){var d=s[c],f=d.clone();i&&f.applyMatrix4(i),h.push(f)}for(c=0,u=r.length;c<u;c++){var g,_,p,v=r[c],m=v.vertexNormals,y=v.vertexColors;g=v instanceof _i?new _i(v.a,v.b,v.c):new pi(v.a,v.b,v.c,v.d),g.normal.copy(v.normal),n&&g.normal.applyMatrix3(n).normalize();for(var A=0,x=m.length;A<x;A++)_=m[A].clone(),n&&_.applyMatrix3(n).normalize(),g.vertexNormals.push(_);g.color.copy(v.color);for(var A=0,x=y.length;A<x;A++)p=y[A],g.vertexColors.push(p.clone());g.materialIndex=v.materialIndex,g.centroid.copy(v.centroid),i&&g.centroid.applyMatrix4(i),o.push(g)}for(c=0,u=a.length;c<u;c++){for(var w=a[c],b=[],A=0,x=w.length;A<x;A++)b.push(new Qe(w[A].x,w[A].y));l.push(b)}if(e){var S=new Ke.Entity(t.material);S.vertices=h,S.faces=o,S.uvs=l,S.setPosition(0,0,0),S.setRotation(0,0,0),S.setScale(1,1,1);var C={};return C.vertices=h,C.faces=o,C.uvs=l,S.primitive=new Ke.Primitive(C),S}t.vertices=h,t.faces=o,t.uvs=l,t.setPosition(0,0,0),t.setRotation(0,0,0),t.setScale(1,1,1);var C={};C.vertices=h,C.faces=o,C.uvs=l,t.primitive=new Ke.Primitive(C);for(var c in i.elements)t._attachId+=i.elements[c];return t},yi.mergeElements=function(t){var e,i,n,s,r,a,o=0,h=0,l=0;for(e=0;e<t.length;e++)n=t[e],o+=n.materialSize;var c=new Ke.Entity(o),u={},d={},f=(new Je(0,0,0),[]),g=[],_=[],p=[],v=new Ke.ArrayMaterial;for(e=0;e<t.length;e++){for(n=t[e],n.matrixAutoUpdate&&n.updateWorldMatrix(),s=n.worldMatrix.clone(),r=(new $e).getNormalMatrix(s),i=0;i<n.vertices.length;i++)a=n.vertices[i],f.push(a.clone().applyMatrix4(s));for(i=0;i<n.faces.length;i++){var m,y=n.faces[i];y.vertexNormals,y.vertexColors;m=y instanceof _i?new _i(y.a+h,y.b+h,y.c+h):new pi(y.a+h,y.b+h,y.c+h,y.d+h),m.normal.copy(y.normal),r&&m.normal.applyMatrix3(r).normalize(),m.materialIndex=y.materialIndex+l,m.centroid.copy(y.centroid),s&&m.centroid.applyMatrix4(s),g.push(m)}for(i=0,len=n.uvs.length;i<len;i++){for(var A=n.uvs[i],x=[],w=0,b=A.length;w<b;w++)x.push(new Qe(A[w].x,A[w].y));_.push(x)}if(n.uv2s&&n.uv2s.length>0)for(i=0,len=n.uv2s.length;i<len;i++){for(var S=n.uv2s[i],C=[],w=0,b=S.length;w<b;w++)C.push(new Qe(S[w].x,S[w].y));p.push(C)}v.materials=v.materials.concat(n.material.materials),h+=n.vertices.length,l+=n.materialSize;for(var T in n.styleMap){var E=u[T];null==E&&(E=[]);var L=n.styleMap[T],M=!0;if(yi.isArray(L))for(var w=0;w<L.length;w++)E.push(L[e]),w>0&&L[w]!=L[w-1]&&(M=!1);else for(var w=0;w<n.materialSize;w++)E.push(L);1!=d[T]&&null!=d[T]||(d[T]=M),u[T]=E}}for(var T in d)1==d[T]&&(u[T]=u[T][0]);return c.styleMap=u,c.material=v,c.vertices=f,c.faces=g,c.setUvs(_),c.uv2s=p,c.setUpdateFlags(!0),c},yi.mergeElement=function(t,i,n){var s,r,a,o,h=t.vertices.length,l=(t.uvs.length,t.vertices),c=i.vertices,u=t.faces,d=i.faces,f=t.uvs,g=i.uvs,_=[],p=[],v=[];n===e&&(n=0),t instanceof Ke.Element&&(t.matrixAutoUpdate&&t.updateMatrix(),s=t.matrix,r=(new $e).getNormalMatrix(s)),i instanceof Ke.Element&&(i.matrixAutoUpdate&&i.updateMatrix(),a=i.matrix,o=(new $e).getNormalMatrix(a));for(var m=0,y=l.length;m<y;m++){var A=l[m],x=A.clone();s&&x.applyMatrix4(s),p.push(x)}for(var m=0,y=c.length;m<y;m++){var A=c[m],x=A.clone();a&&x.applyMatrix4(a),p.push(x)}for(m=0,y=u.length;m<y;m++){var w,b,S,C=u[m],T=C.vertexNormals,E=C.vertexColors;w=C instanceof _i?new _i(C.a,C.b,C.c):new pi(C.a,C.b,C.c,C.d),w.normal.copy(C.normal),r&&w.normal.applyMatrix3(r).normalize();for(var L=0,M=T.length;L<M;L++)b=T[L].clone(),r&&b.applyMatrix3(r).normalize(),w.vertexNormals.push(b);w.color.copy(C.color);for(var L=0,M=E.length;L<M;L++)S=E[L],w.vertexColors.push(S.clone());w.materialIndex=C.materialIndex,w.centroid.copy(C.centroid),s&&w.centroid.applyMatrix4(s),_.push(w)}for(m=0,y=d.length;m<y;m++){var w,b,S,C=d[m],T=C.vertexNormals,E=C.vertexColors;w=C instanceof _i?new _i(C.a+h,C.b+h,C.c+h):new pi(C.a+h,C.b+h,C.c+h,C.d+h),w.normal.copy(C.normal),o&&w.normal.applyMatrix3(o).normalize();for(var L=0,M=T.length;L<M;L++)b=T[L].clone(),o&&b.applyMatrix3(o).normalize(),w.vertexNormals.push(b);w.color.copy(C.color);for(var L=0,M=E.length;L<M;L++)S=E[L],w.vertexColors.push(S.clone());w.materialIndex=C.materialIndex+n,w.centroid.copy(C.centroid),a&&w.centroid.applyMatrix4(a),_.push(w)}for(m=0,y=f.length;m<y;m++){for(var P=f[m],k=[],L=0,M=P.length;L<M;L++)k.push(new Qe(P[L].x,P[L].y));v.push(k)}for(m=0,y=g.length;m<y;m++){for(var P=g[m],k=[],L=0,M=P.length;L<M;L++)k.push(new Qe(P[L].x,P[L].y));v.push(k)}return t.vertices=p,t.faces=_,t.uvs=v,t._position.set(0,0,0),t._rotation.set(0,0,0),t._scale.set(1,1,1),t},yi.autoAdjustNetworkBounds=function(e,i,n,s,r,a){r=r||0,a=a||0,e.adjustBounds(i[n]-r,i[s]-a),t.addEventListener?t.addEventListener("resize",function(){e.adjustBounds(i[n]-r,i[s]-a,a,r)},!0):t.attachEvent?t.attachEvent("onresize",function(){e.adjustBounds(i[n]-r,i[s]-a,a,r)}):t.onresize=function(){e.adjustBounds(i[n]-r,i[s]-a,a,r)}},yi.isEmptyObject=function(t){for(var e in t)return!1;return!0},yi.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},yi.isSame=function(t,e){if(t===e)return!0;if(null==t&&null!=e)return!1;if(null!=t&&null==e)return!1;if(typeof t!=typeof e)return!1;for(var i in t)if(t[i]!=e[i])return!1;for(var i in e)if(t[i]!=e[i])return!1;return!0},yi.toString=function(t){if(t){var e="";for(var i in t)e+=i+":"+t[i];return e}},yi.validateLicense=function(t){Ei=t,Wi()},yi.getLicense=function(){return Ei},yi.getObjectCount=function(t){if(!t)return 0;var e=0;for(var i in t)e++;return e},yi.isNaN=function(t){return""===t||null===t||isNaN(t)},yi.getTransformVertices=function(t,e,i){null==i&&(i=[]);var n,s;if(t instanceof Ke.Node||t instanceof Ke.Billboard){for(n=0;n<t.vertices.length;n++)s=t.vertices[n].clone(),t instanceof Ke.Billboard?(s.x*=t.rotation3d.x,s.y*=t.rotation3d.y,s.add(t.getPosition())):s.applyMatrix4(t.worldMatrix),i.push(s);for(var n=0;n<(t._childList?t._childList.size():0);n++){var r=t._childList.get(n);yi.getTransformVertices(r,e,i)}}return i},yi.getBoundingBox=function(t,e){var i,n,s;if(null==t)return null;i=t instanceof ci?t._as:yi.isArray(t)?t:[t];var r=[];for(n=0;n<i.length;n++)s=i[n],yi.getTransformVertices(s,e,r);var a=new Ke.BoundingBox;return a.setFromPoints(r),a},yi.mergeWrapMap=function(t){if(t instanceof vi&&!t.getWrapMap()){for(var e,i=[],n=(t.getMaterialMapping(),t.material.materials),s=0;s<n.length;s++)e=n[s],e.map&&i.indexOf(e.map._image)==-1&&i.push(e.map._image);t.setWrapMap(!0)}},yi.setWrapMap=function(t,e,i,n){yi.loadImages(e,function(s){var r=mono.Utils.createWrapMapFromImages(s,i,n);r.__uniqueCode="";for(var a=0;a<e.length;a++)r.__uniqueCode+=e[a].src;for(var a in i)r.__uniqueCode+=a+":"+i[a];if(yi.isArray(t))for(var a=0;a<t.length;a++)t[a].setStyle("m.texture.image",r),t[a].setClient("_originalImage",e),t[a].setClient("_wrapMapping",i);else t.setStyle("m.texture.image",r),t.setClient("_wrapMapping",i)})},yi.loadImages=function(t,e){function i(t){t.onload=function(){t.loaded=!0,n(),t.onload=null}}function n(){for(var i=0;i<t.length;i++)if(!t[i].loaded)return;e(t)}if(null!=t&&0!=t.length&&null!=e)for(var s=0;s<t.length;s++){var r=t[s];"string"==typeof r&&(t[s]=new Image,t[s].crossOrigin="",t[s].src=r),r=t[s],i(r)}},yi.createWrapMapFromImages=function(t,e,i,n,s){if(null==t||0==t.length)return null;i=(i||"six-each").toLowerCase();var r="six-each"==i||"front-other"==i||"back-other"==i||"left-other"==i||"right-other"==i||"top-other"==i||"bottom-other"==i;if(r){null==e&&(e={0:"bottom",1:"top",2:"back",3:"left",4:"front",5:"right"});var a=document.createElement("canvas"),o=a.getContext("2d"),h=0,l=0;if("six-each"==i){var c={bottom:[0,0],top:[1/3,0],back:[2/3,0],left:[0,.5],front:[1/3,.5],right:[2/3,.5]};if(null==n||null==s)for(var u=0;u<t.length;u++)h=Math.max(t[u].width,h),l=Math.max(t[u].height,l);h*=3,l*=2,h>1024&&(h=1024),l>1024&&(l=1024);var d,f=["front","back","right","left","top","bottom"],g=[];for(var u in e){var _=e[u];"other"!==_?(g.push(_),f.splice(f.indexOf(_),1)):d=u}null!=d&&(e[d]=f),n=n||h,s=s||l,a.setAttribute("width",n),a.setAttribute("height",s);for(var u=(Math.min(t.length,6),0);u<6;u++){var p=e[u];if(p){var v=p;v=yi.isArray(p)?p:p.indexOf(",")!=-1?p.split(","):[p];for(var m=0;m<v.length;m++){var _=v[m],y=c[_][0],A=c[_][1];o.drawImage(t[u],y*n,A*s,n/3,s/2)}}}}else{var x=i.split("-")[0];if(null==n||null==s)for(var u=0;u<t.length;u++)h+=t[u].width,l=Math.max(t[u].height,l);n=n||h,s=s||l,a.setAttribute("width",n),a.setAttribute("height",s);for(var u=(e[x],Math.min(t.length,2),0);u<2;u++){var p=e[u];p&&(p==x?o.drawImage(t[u],0,0,n/2,s):o.drawImage(t[u],n/2,0,n/2,s))}}return a}},yi.getVectorAngles=function(t,e){var i=t;e&&(i=e.clone().sub(t)),i=i.normalize();var n=Math.asin(i.y)*Ai,s=Math.atan2(i.x,i.z)*Ai;return[s,n]},yi.getPixelFromImage=function(t,e,i){var n;ei.isCanvas(t)?n=t:(n=document.createElement("canvas"),n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(t,0,0,t.width,t.height)),e-=Math.floor(e),i-=Math.floor(i),i=1-i;var s=n.getContext("2d").getImageData(t.width*e,t.height*i,1,1).data;return s},yi.nextPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t++,t},yi.createTextBillboard=function(t,e){var i=new mono.Billboard;t=t||"",e=e||{};var n=yi.createTextImage(t,e);return i.setStyle("m.texture.image",n),i.setScale(n.width,n.height,1),i},yi.createTextImage=function(t,i){t=t||"";var n=i.font,s=i.color,r=i.background,a=i.powerOfTwo,o=i.canvas,h=i.drawFunction;o=o||document.createElement("canvas"),n=n||'20px "Dialog"',s=s||"white",r=r===e?"#0F90C4":r,a=a||!1;var l,c=i.textAlign||"center";l=yi.isArray(t)?t:t.split("\n");var u=mono.Utils.getMaxTextSize(l,n),d=i.ratio||u.width/u.height,f=o.realSize={width:u.width,height:u.height};a&&(u.width=mono.Utils.nextPowerOfTwo(u.width),u.height=mono.Utils.nextPowerOfTwo(u.height));var g=o.drawRect={width:f.width/f.height>d?f.width:f.height*d,height:f.width/f.height>d?f.width/d:f.height};Number.isNaN(g.width)&&console.log("debug -- b",f.width,f.height,d),g.width=Math.min(g.width,u.width),g.height=Math.min(g.height,u.height),o.width=u.width,o.height=u.height,Number.isNaN(g.width)&&console.log("debug -- a");var _=o.getContext("2d");if(r&&(_.fillStyle=r),h)h(_,o.width,o.height);else{r&&_.fillRect(0,0,o.width,o.height),_.font=n,_.fillStyle=s,_.strokeStyle="gray",_.textBaseline="middle",_.textAlign=c;for(var p,v=l.length,m=f.height/v,y=0;y<v;y++){yi.isArray(s)&&(p=s[y],p&&(_.fillStyle=p));var A=mono.Utils.getTextSize(n,l[y]),x=(A.width,A.height,o.height,(g.width-f.width)/2);"center"===c?x=g.width/2:"right"===c&&(x=g.width);var w=(g.height-f.height)/2+m/2+y*m+(o.height-g.height);_.strokeText(l[y],x,w),_.fillText(l[y],x,w)}}return o},yi.createTextImage2=function(t,i){t=t||"",t=String(t);var s=i.font,r=i.color,a=i.background,o=i.powerOfTwo,h=i.canvas,l=i.drawFunction;h=h||document.createElement("canvas"),s=s||'20px "Dialog"',r=r||"white",a=a===e?"#0F90C4":a,o=o||!1;var c=(i.align||"center",i.sizeScale||1),u=yi.getMaxTextSize(t.split("\n"),s);h.realSize={width:u.width,height:u.height},u.width*=c,u.height*=c,o&&(u.width=yi.nextPowerOfTwo(u.width),u.height=yi.nextPowerOfTwo(u.height)),h.width=u.width,h.height=u.height;var d=h.getContext("2d");return a&&(d.fillStyle=a),l?l(d,h.width,h.height):(a&&d.fillRect(0,0,h.width,h.height),n(d,t,s,r,h,"center")),h},yi.getMaxTextSize=function(t,e){if(t&&t.length>0){for(var i=t.length,n=ri.getTextSize(e,t[0]),s=n.width,r=n.height*i,a=0;a<i;a++){var o=ri.getTextSize(e,t[a]).width;s<o&&(s=o)}return{width:s,height:r}}return null},yi.getTextSize=function(t,e){return ri.getTextSize(t,e)},yi.playCameraAnimation=function(t,e,i,n,s){e=e||t.p(),i=i||t.getTarget(),n=n||2e3;var r=mono.Utils.getVectorAngles(t.getTarget(),t.p()),a=mono.Utils.getVectorAngles(i,e),o=t.getTarget(),h=i,l=t.getDistance(),c=(new mono.Vec3).subVectors(e,i).length();new mono.Animate({from:0,to:1,repeat:1,dur:n,onPlay:function(){},onUpdate:function(e){var i=r[0]+(a[0]-r[0])*e,n=r[1]+(a[1]-r[1])*e,s=(new mono.Vec3).lerpVectors(o,h,e),u=l+(c-l)*e,d=new mono.Vec3;d.x=s.x+u*Math.sin(i*xi)*Math.cos(n*xi),d.z=s.z+u*Math.cos(i*xi)*Math.cos(n*xi),d.y=s.y+u*Math.sin(n*xi),t.lookAt(s),t.p(d)},onDone:function(){s&&s()}}).play()},yi.stopAnimate=function(t,e){Ge(t,e)},yi.stopAllAnimates=function(t){Ze(t)},Ke.Utils=yi,Ke.GLParameters=function(t,e,i){this.material=t,this.network=e,this.precision=e._precision,this.map=!!t.map,this.mapLoaded=!0,this.envMap=!!t.envMap,this.lightMap=!!t.lightMap,this.bumpMap=!!t.bumpMap&&"phong"===t._type,this.normalMap=!!t.normalMap&&"phong"===t._type,this.specularMap=!!t.specularMap,this.vertexColors=t.vertexColors,this.fog=e._fog,this.useFog=t.fog,this.fogExp=this.fog instanceof Ke.FogExp2,this.sizeAttenuation=t.sizeAttenuation,this.skinning=t.skinning,this.maxBones=e.maxBones,this.useVertexTexture=e._supportsBoneTextures&&i&&i.useVertexTexture,this.boneTextureWidth=i&&i.boneTextureWidth,this.boneTextureHeight=i&&i.boneTextureHeight,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.maxMorphTargets=e.maxMorphTargets,this.maxMorphNormals=e.maxMorphNormals,this.maxDirLights=e.maxLightCount.directional,this.maxPointLights=e.maxLightCount.point,this.maxSpotLights=e.maxLightCount.spot,this.maxHemiLights=e.maxLightCount.hemi,this.maxShadows=e.maxShadows,this.maxPointShadows=e.maxPointShadows,this.shadowMapEnable=e._shadowMapEnable&&i.receiveShadow&&this.maxShadows>0,this.pointShadowMapEnable=e._shadowMapEnable&&i.receiveShadow&&this.maxPointShadows>0,this.shadowMapType=e.shadowMapType,this.shadowMapDebug=e.shadowMapDebug,this.shadowMapCascade=e.shadowMapCascade,this.alphaTest=t.alphaTest,this.metal=t.metal,this.perPixel=t.perPixel,this.wrapAround=t.wrapAround,this.doubleSided=t.side===Ke.DoubleSide&&!ii.isIE,this.flipSided=t.side===Ke.BackSide,this.useSSAO=e.isSSAOEnable()&&e.pm.isLightMaterial(t),this.gammaInput=e.gammaInput,this.gammaOutput=e.gammaOutput,this.physicallyBasedShading=e.physicallyBasedShading,this.supportsVertexTextures=!1,this.shadowMapTypeDefine="SHADOWMAP_TYPE_BASIC",this.shadowMapType===Ke.PCFShadowMap?this.shadowMapTypeDefine="SHADOWMAP_TYPE_PCF":this.shadowMapType===Ke.PCFSoftShadowMap&&(this.shadowMapTypeDefine="SHADOWMAP_TYPE_PCF_SOFT"),this.maxGrandient=yi.getObjectCount(t.gradient)},Ke.GLParameters.prototype.getShaders=function(t){t=t===e?"":t;var i=this,n=["precision "+i.precision+" float;",t,this.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.gammaInput?"#define GAMMA_INPUT":"",i.gammaOutput?"#define GAMMA_OUTPUT":"",i.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,"#define MAX_POINT_SHADOWS "+i.maxPointShadows,"#define MAX_BONES "+i.maxBones,i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.vertexColors?"#define USE_COLOR":"",i.maxGrandient>0?"#define MAX_GRADIENT "+i.maxGrandient:"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.boneTextureWidth?"#define N_BONE_PIXEL_X "+i.boneTextureWidth.toFixed(1):"",i.boneTextureHeight?"#define N_BONE_PIXEL_Y "+i.boneTextureHeight.toFixed(1):"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals?"#define USE_MORPHNORMALS":"",i.perPixel?"#define PHONG_PER_PIXEL":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnable?"#define USE_SHADOWMAP":"",i.shadowMapEnable?"#define "+i.shadowMapTypeDefine:"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.pointShadowMapEnable?"#define USE_POINT_SHADOWMAP":"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n"),s=["precision "+this.precision+" float;",i.bumpMap||i.normalMap?"#extension GL_OES_standard_derivatives : enable":"",t,"#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,"#define MAX_POINT_SHADOWS "+i.maxPointShadows,i.useSSAO?"#define USE_SSAO":"",i.alphaTest?"#define ALPHATEST "+i.alphaTest:"",this.gammaInput?"#define GAMMA_INPUT":"",this.gammaOutput?"#define GAMMA_OUTPUT":"",this.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.maxGrandient>0?"#define MAX_GRADIENT "+i.maxGrandient:"",i.vertexColors?"#define USE_COLOR":"",i.metal?"#define METAL":"",i.perPixel?"#define PHONG_PER_PIXEL":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnable?"#define USE_SHADOWMAP":"",i.shadowMapEnable?"#define "+i.shadowMapTypeDefine:"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.pointShadowMapEnable?"#define USE_POINT_SHADOWMAP":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n");
return[n,s]};var wi={};wi.setDepthTest=function(t,e){var i=e._gl;e._oldDepthTest!==t&&(t?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),e._oldDepthTest=t)},wi.setSmapleAlphaToCoverage=function(t,e){var i=e._gl;e._oldSmapleAlphaToCoverage!==t&&(t?i.enable(i.SAMPLE_ALPHA_TO_COVERAGE):i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),e._oldSmapleAlphaToCoverage=t)},wi.setDepthWrite=function(t,e){var i=e._gl;e._oldDepthWrite!==t&&(i.depthMask(t),e._oldDepthWrite=t)},wi.clear=function(t,i,n,s){var r=s._gl,a=0;(t===e||t)&&(a|=r.COLOR_BUFFER_BIT),(i===e||i)&&(a|=r.DEPTH_BUFFER_BIT),(n===e||n)&&(a|=r.STENCIL_BUFFER_BIT),s._gl.clear(a)},wi.setPolygonOffset=function(t,e,i,n){var s=n._gl;n._oldPolygonOffset!==t&&(t?s.enable(s.POLYGON_OFFSET_FILL):s.disable(s.POLYGON_OFFSET_FILL),n._oldPolygonOffset=t),t&&(n._oldPolygonOffsetFactor!==e||n._oldPolygonOffsetUnits!==i)&&(s.polygonOffset(e,i),n._oldPolygonOffsetFactor=e,n._oldPolygonOffsetUnits=i)},wi.setBlending=function(t,e,i,n,s){var r=s._gl;t!==s._oldBlending&&(t===Ke.NoBlending?r.disable(r.BLEND):t===Ke.AdditiveBlending?(r.enable(r.BLEND),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.SRC_ALPHA,r.ONE)):t===Ke.SubtractiveBlending?(r.enable(r.BLEND),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ZERO,r.ONE_MINUS_SRC_COLOR)):t===Ke.MultiplyBlending?(r.enable(r.BLEND),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ZERO,r.SRC_COLOR)):t===Ke.CustomBlending?r.enable(r.BLEND):(r.enable(r.BLEND),r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)),s._oldBlending=t),t===Ke.CustomBlending?(e!==this._oldBlendEquation&&(r.blendEquation(paramThreeToGL(e)),s._oldBlendEquation=e),i===_oldBlendSrc&&n===_oldBlendDst||(r.blendFunc(paramToGL(i),paramToGL(n)),s._oldBlendSrc=i,s._oldBlendDst=n)):(s._oldBlendEquation=null,s._oldBlendSrc=null,s._oldBlendDst=null)},wi.enableStencil=function(t){t.enable(t.STENCIL_TEST),t.stencilFunc(t.ALWAYS,1,1),t.stencilOp(t.KEEP,t.KEEP,t.REPLACE),t.stencilMask(1),t.clearStencil(0),t.clear(t.STENCIL_BUFFER_BIT)},wi.stencilTest=function(t){t.enable(t.STENCIL_TEST),t.stencilFunc(t.EQUAL,0,1),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.stencilMask(0)},wi.disableStencil=function(t){t.disable(t.STENCIL_TEST)},wi.r=function(t,e,i,n,s,r,a){t._AK47(e,i,n,s,r,a)},wi.g=function(t,e,i,n,s,r){t.renderGroup(e,i,n,s,r)},Ke.GLUtils=wi,Ke.GPU=function(t){var e=t._gl;this._glExtensionTextureFloat=e.getExtension("OES_texture_float"),this._glExtensionStandardDerivatives=e.getExtension("OES_standard_derivatives"),this._glExtensionTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this._glExtensionCompressedTextureS3TC=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._glExtensionTextureFloat||console.log("Float textures not supported."),this._glExtensionStandardDerivatives||console.log("Standard derivatives not supported."),this._glExtensionTextureFilterAnisotropic||console.log("Anisotropic texture filtering not supported."),this._glExtensionCompressedTextureS3TC||console.log("S3TC compressed textures not supported."),this._maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this._maxVertexTextures=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this._maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this._maxAnisotropy=this._glExtensionTextureFilterAnisotropic?e.getParameter(this._glExtensionTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._supportsVertexTextures=this._maxVertexTextures>0,this._supportsBoneTextures=this._supportsVertexTextures&&this._glExtensionTextureFloat,this._compressedTextureFormats=this._glExtensionCompressedTextureS3TC?e.getParameter(e.COMPRESSED_TEXTURE_FORMATS):[],this._vertexShaderPrecisionHighpFloat=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT),this._vertexShaderPrecisionMediumpFloat=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT),this._vertexShaderPrecisionLowpFloat=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.LOW_FLOAT),this._fragmentShaderPrecisionHighpFloat=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT),this._fragmentShaderPrecisionMediumpFloat=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT),this._fragmentShaderPrecisionLowpFloat=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.LOW_FLOAT),this._vertexShaderPrecisionHighpInt=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_INT),this._vertexShaderPrecisionMediumpInt=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_INT),this._vertexShaderPrecisionLowpInt=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.LOW_INT),this._fragmentShaderPrecisionHighpInt=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_INT),this._fragmentShaderPrecisionMediumpInt=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_INT),this._fragmentShaderPrecisionLowpInt=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.LOW_INT);var i=this._vertexShaderPrecisionHighpFloat.precision>0&&this._fragmentShaderPrecisionHighpFloat.precision>0,n=this._vertexShaderPrecisionMediumpFloat.precision>0&&this._fragmentShaderPrecisionMediumpFloat.precision>0,s=t._precision;"highp"===s&&!i&&(n?(s="mediump",console.log("highp not supported, using mediump")):(s="lowp",console.log("highp and mediump not supported, using lowp"))),"mediump"===s&&!n&&(s="lowp",console.log("mediump not supported, using lowp")),t._precision=s},Ke.Program=function(t,e,i,n){this.entity=t,this.group=e,this.material=i,this.network=n},Ke.Program.prototype.setEntity=function(){this.entity},Ke.Program.prototype.buildGLProgram=function(){},Ke.Uniform=function(t,i,n){this.id=t,this.type=i,this.value=n,this.location=e},Ke.Uniform.prototype={constructor:Ke.Uniform,setValue:function(t){this.value=t},getUniformLocation:function(t,e){return t.getUniformLocation(this.id)}},Ke.Uniform.loadUniform=function(t,n,s){if(type=n.type,value=n.value,"i"===type)s.uniform1i(t,value);else if("f"===type)s.uniform1f(t,value);else if("v2"===type)s.uniform2f(t,value.x,value.y);else if("v3"===type)s.uniform3f(t,value.x,value.y,value.z);else if("v4"===type)s.uniform4f(t,value.x,value.y,value.z,value.w);else if("c"===type)s.uniform3f(t,value.r,value.g,value.b);else if("iv1"===type)s.uniform1iv(t,value);else if("iv"===type)s.uniform3iv(t,value);else if("fv1"===type)s.uniform1fv(t,value);else if("fv"===type)s.uniform3fv(t,value);else if("v2v"===type){for(n._array===e&&(n._array=new Float32Array(2*value.length)),i=0,il=value.length;i<il;i++)offset=2*i,n._array[offset]=value[i].x,n._array[offset+1]=value[i].y;s.uniform2fv(t,n._array)}else if("v3v"===type){for(n._array===e&&(n._array=new Float32Array(3*value.length)),i=0,il=value.length;i<il;i++)offset=3*i,n._array[offset]=value[i].x,n._array[offset+1]=value[i].y,n._array[offset+2]=value[i].z;s.uniform3fv(t,n._array)}else if("v4v"===type){for(n._array===e&&(n._array=new Float32Array(4*value.length)),i=0,il=value.length;i<il;i++)offset=4*i,n._array[offset]=value[i].x,n._array[offset+1]=value[i].y,n._array[offset+2]=value[i].z,n._array[offset+3]=value[i].w;s.uniform4fv(t,n._array)}else if("m4"===type)n._array===e&&(n._array=new Float32Array(16)),value.flattenToArray(n._array),s.uniformMatrix4fv(t,!1,n._array);else if("m4v"===type){for(n._array===e&&(n._array=new Float32Array(16*value.length)),i=0,il=value.length;i<il;i++)value[i].flattenToArrayOffset(n._array,16*i);s.uniformMatrix4fv(t,!1,n._array)}else if("t"===type)texture=value,textureUnit=getTextureUnit(),s.uniform1i(t,textureUnit),!texture||(texture.image instanceof Array&&6===texture.image.length?setCubeTexture(texture,textureUnit):texture instanceof $CubeRenderTargetCube?setCubeTextureDynamic(texture,textureUnit):_this.setTexture(texture,textureUnit));else if("tv"===type){for(n._array===e&&(n._array=[]),i=0,il=n.value.length;i<il;i++)n._array[i]=getTextureUnit();for(s.uniform1iv(t,n._array),i=0,il=n.value.length;i<il;i++)texture=n.value[i],textureUnit=n._array[i],texture&&_this.setTexture(texture,textureUnit)}},Ke.Uniform.loadGeneralUniforms=function(t,e,i){var n,s,r,a;for(r=0,a=e.length;r<a;r++)s=t.uniforms[e[r][1]],s&&(n=e[r][0],Ke.Uniform.loadUniform(n,i))},Ke.ProgramManager=function(t){this.id=Ke.ProgramManagerId++,Ke.ProgramManagerCache.count++,this.network=t,this.gl=this.network._gl,this.gpu=this.network.gpu,this.programs=[],this.currentProgram=null,this.currentEntity=null,this.currentGroup=null,this.currentMaterial=null,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0},currentMaterialId:-1},this.textures=[],this.textureCount=0,this._lightNeedsUpdate=!0,this._lights={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}},this.gammaInput=!1,this.textureCount=0,this.programMap={},this.textureMap={},this.textureUpdateFlags={},this.glTextureMap={},this.textureMaterialMap={},this.unLoadedImage={},this.materialMap={},this.materialUpdateFlags={},this.handleTextureChange=function(t){if("image"===t.property||"loaded"===t.property){var e=t.source;this.changeTextureUpdateFlags(e,!0),delete this.unLoadedImage[e._image]}else if("disposed"===t.property){var e=t.source;this.deallocateTexture(e),e.removePropertyChangeListener(this.handleTextureChange),delete this.textureUpdateFlags[e.id],delete this.textureMap[e.id]}yi.getObjectCount(this.unLoadedImage)<=0&&this.network.dirtyNetwork()},this.handleMaterialChange=function(t){if("map"==t.property||t.property.endsWith("Map")||"needsUpdate"===t.property){var e=t.source;this.materialUpdateFlags[e.id]=!0}else if("disposed"===t.property){var e=t.source;this.deallocateMaterial(e),e.removePropertyChangeListener(this.handleMaterialChange),delete this.materialUpdateFlags[e.id],delete this.materialMap[e.id],delete this.programMap[e.id]}yi.getObjectCount(this.unLoadedImage)<=0&&this.network.dirtyNetwork()}},Ke.ProgramManager.prototype.addMaterial=function(t){null==this.materialMap[t.id]&&(this.materialMap[t.id]=t,t.addPropertyChangeListener(this.handleMaterialChange,this))},Ke.ProgramManager.prototype.needsUpdateMaterial=function(t){return this.materialUpdateFlags[t.id]===e||this.materialUpdateFlags[t.id]===!0||(t.map instanceof bi||t.map instanceof Si)},Ke.ProgramManager.prototype.changeMaterialUpdateFlags=function(t,e){this.materialUpdateFlags[t.id]=e},Ke.ProgramManager.prototype.isLightMaterial=function(t){return t instanceof Ke.LambertMaterial||t instanceof Ke.PhongMaterial||t.lights||"lambert"===t._type||"phong"===t._type||"terrain"===t._type},Ke.ProgramManager.prototype.changeAllMaterialUpdateFlags=function(t,e,i){for(var n in this.materialMap){var s=this.materialMap[n];(null==e||e.call(i,s))&&(this.materialUpdateFlags[s.id]=t)}},Ke.ProgramManager.prototype.changeAllLightMaterialUpdateFlags=function(t){this.changeAllMaterialUpdateFlags(t,this.isLightMaterial,this)},Ke.ProgramManager.prototype.addTexture=function(t){null!=t.id&&this.textureMap[t.id]===e&&(this.textureMap[t.id]=t,t.addPropertyChangeListener(this.handleTextureChange,this),t._image.loaded||(this.unLoadedImage[t._image]=1))},Ke.ProgramManager.prototype.needsUpdateTexture=function(t){return this.textureUpdateFlags[t.id]===e||this.textureUpdateFlags[t.id]===!0},Ke.ProgramManager.prototype.changeTextureUpdateFlags=function(t,e){this.textureUpdateFlags[t.id]=e;for(var i in this.materialMap){var n=this.materialMap[i];(n.map===t||n.lightMap===t||n.envMap===t||n.normalMap===t||n.specularMap===t)&&this.changeMaterialUpdateFlags(n,!0)}},Ke.ProgramManager.prototype.buildProgram=function(t,e,i){this.currentEntity=t,this.currentGroup=e,this.currentMaterial=i,i.shaderID||i.setupMaterialShader();var n,s,r,a,o=new Ke.GLParameters(this.currentMaterial,this.network,t),l=[];i.shaderID?l.push(i.shaderID):(l.push(i.vertexShader),l.push(i.fragmentShader));for(ji in o)"material"!==ji&&"network"!==ji&&"node"!==ji&&(l.push(ji),l.push(o[ji]));for(a=l.join(),n=0,s=this.programs.length;n<s;n++)if(this.programs[n].code===a){i.program=this.programs[n].program,i.uniformsList=[];for(g in i.uniforms)i.uniformsList.push([i.uniforms[g],g]);return this.programs[n].usedTimes++,this.programs[n].program}r=this.gl.createProgram();var c=o.getShaders(),u=c[1],d=c[0];this.gl.attachShader(r,h("fragment",u+i.fragmentShader,this.gl)),this.gl.attachShader(r,h("vertex",d+i.vertexShader,this.gl)),this.gl.linkProgram(r),this.gl.getProgramParameter(r,this.gl.LINK_STATUS)||console.log("Could not initialise shader\nVALIDATE_STATUS: "+this.gl.getProgramParameter(r,this.gl.VALIDATE_STATUS)+", gl error ["+this.gl.getError()+"]"),r.uniforms={},r.attributes={};var f,g,_,n;f=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","boneGlobalMatrices","morphTargetInfluences"];for(g in i.uniforms)f.push(g);for(this.attachGLLocations(r,f,"uniform"),f=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"],n=0;n<o.maxMorphTargets;n++)f.push("morphTarget"+n);for(n=0;n<o.maxMorphNormals;n++)f.push("morphNormal"+n);for(_ in i.attributes)f.push(_);this.attachGLLocations(r,f,"attribute"),r.id=this.programs.length,this.programs.push({program:r,code:a,usedTimes:1}),this.info.memory.programCount=this.programs.length,i.program=r,i.uniformsList=[];for(g in i.uniforms)i.uniformsList.push([i.uniforms[g],g]);return r},Ke.ProgramManager.prototype.enableAttribute=function(t,i){var n=i.program.attributes;if(n.position>=0&&_gl.enableVertexAttribArray(n.position),n.color>=0&&_gl.enableVertexAttribArray(n.color),n.normal>=0&&_gl.enableVertexAttribArray(n.normal),i.attributes)for(a in i.attributes)n[a]!==e&&n[a]>=0&&_gl.enableVertexAttribArray(n[a])},Ke.ProgramManager.prototype.attachGLLocations=function(t,e,i){var n,s,r,a=this.gl;if("uniform"===i)for(n=0,s=e.length;n<s;n++)r=e[n],t.uniforms[r]=a.getUniformLocation(t,r);else if("attribute"===i)for(n=0,s=e.length;n<s;n++)r=e[n],t.attributes[r]=a.getAttribLocation(t,r)},Ke.ProgramManager.prototype.getGLShaders=function(t,e){var i;return"fragment"===t?i=this.gl.createShader(this.gl.FRAGMENT_SHADER):"vertex"===tpye&&(i=this.gl.createShader(this.gl.VERTEX_SHADER)),this.gl.shaderSource(i,string),this.gl.compileShader(i),gl.getShaderParameter(i,gl.COMPILE_STATUS)?i:(console.log(gl.getShaderInfoLog(i)),console.log(string),null)},Ke.ProgramManager.prototype.setProgram=function(t,e,i,n,a,h){if(this.textureCount=0,this.addMaterial(n),this.needsUpdateMaterial(n)){n.setupMaterialShader(),this.programMap[n.id]&&this.deallocateMaterial(n);var c=this.buildProgram(h,a,n);this.programMap[n.id]=c,this.changeMaterialUpdateFlags(n,!1)}var u=!1,d=this.programMap[n.id],f=d.uniforms,g=n.uniforms;return d!=this.currentProgram&&(this.gl.useProgram(d),this.currentProgram=d,u=!0),n.id!==this.currentMaterialId&&(this.currentMaterialId=n.id,u=!0),(u||t!==this.network._currentCamera)&&(this.gl.uniformMatrix4fv(f.projectionMatrix,!1,t.projectionMatrix.elements),t!==this.network._currentCamera&&(this.network._currentCamera=t)),i&&n.fog&&i.refreshUniforms(g),(n.lights||"phong"===n._type||"lambert"===n._type||"terrain"===n._type)&&(this._lightNeedsUpdate&&(this.setupLights(d,e),this._lightNeedsUpdate=!1),l(g,this._lights)),u&&n.refreshUniforms(!1,{camera:this.network._camera}),h.receiveShadow&&!n._shadowPass&&this.network.isShadowable()&&(s(g,e),r(g,e)),u&&this.loadUniformsGeneric(d,n.uniformsList,n),n.loadCameraPosition(f,t,this.gl),(n.skinning||"phong"===n._type||"lambert"===n._type||"terrain"===n._type||n instanceof Ke.ShaderMaterial)&&null!==f.viewMatrix&&this.gl.uniformMatrix4fv(f.viewMatrix,!1,t.worldMatrixInverse.elements),o(f,h,this.gl),null!=f.modelMatrix&&this.gl.uniformMatrix4fv(f.modelMatrix,!1,h.worldMatrix.elements),this.network._baseRender&&this.loadSSAOUniforms(f,n,u),d},Ke.ProgramManager.prototype.loadSSAOUniforms=function(t,e,i){if(null!=t.mapSSAO&&this.network._sSAOEnable){var n=t.mapSSAO,s=i?this.getTextureUnit():e._ssaoSlot;this.gl.uniform1i(n,s),this.setTexture(this.network.finalSSAOTarget,s),e._ssaoSlot=s}},Ke.ProgramManager.prototype.onTextureDispose=function(t){var e=t.target;e.removeEventListener("dispose",onTextureDispose),deallocateTexture(e),this.info.memory.textures--},Ke.ProgramManager.prototype.deallocateTexture=function(t){var e=this.gl;if(t._image&&t._image.__webglTextureCube)e.deleteTexture(t._image.__webglTextureCube);else{if(!t.__webglInit)return;t.__webglInit=!1,e.deleteTexture(t.__webglTexture)}},Ke.ProgramManager.prototype.setTextureParameters=function(t,e,i,n){var s=this.gl,r=this.gpu,a=Ke.Utils.paramToGL;i&&!n?(s.texParameteri(t,s.TEXTURE_WRAP_S,a(e.wrapS,s)),s.texParameteri(t,s.TEXTURE_WRAP_T,a(e.wrapT,s)),s.texParameteri(t,s.TEXTURE_MAG_FILTER,a(e.magFilter,s)),s.texParameteri(t,s.TEXTURE_MIN_FILTER,a(e.minFilter,s))):(s.texParameteri(t,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(t,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(t,s.TEXTURE_MAG_FILTER,this.filterFallback(e.magFilter)),s.texParameteri(t,s.TEXTURE_MIN_FILTER,this.filterFallback(e.minFilter))),r._glExtensionTextureFilterAnisotropic&&e.type!==Ke.FloatType&&(e.anisotropy>1||e.__oldAnisotropy)&&(s.texParameterf(t,r._glExtensionTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e.anisotropy,r._maxAnisotropy)),e.__oldAnisotropy=e.anisotropy)},Ke.ProgramManager.prototype.setCubeTexture=function(t,i){var n=this.gl;this.addTexture(t);var s=t.id;if(6===t._image.length){if(!t._image.loaded)return;var r=Ke.Utils.isPowerOfTwo,a=Ke.Utils.paramToGL;if(this.needsUpdateTexture(t)){this.glTextureMap[s]===e&&(this.glTextureMap[s]=n.createTexture(),this.info.memory.texture++),this.changeTextureUpdateFlags(t,!1),n.activeTexture(n.TEXTURE0+i),n.bindTexture(n.TEXTURE_CUBE_MAP,this.glTextureMap[s]),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var o=t instanceof Ke.CompressedTexture,h=[],l=0;l<6;l++)this.autoScaleCubemaps&&!o?h[l]=clampToMaxSize(t._image[l],_maxCubemapSize):h[l]=t._image[l];var c=h[0],u=r(c.width)&&r(c.height),d=a(t.format,n),f=a(t.type,n);this.setTextureParameters(n.TEXTURE_CUBE_MAP,t,u);for(var l=0;l<6;l++)if(o)for(var g,_=h[l].mipmaps,p=0,v=_.length;p<v;p++)g=_[p],n.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+l,p,d,g.width,g.height,0,g.data);else n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,d,d,f,h[l]);t.generateMipmaps&&u&&n.generateMipmap(n.TEXTURE_CUBE_MAP),t.needsUpdate=!1,t.onUpdate&&t.onUpdate()}else n.activeTexture(n.TEXTURE0+i),n.bindTexture(n.TEXTURE_CUBE_MAP,this.glTextureMap[s])}},Ke.ProgramManager.prototype.setCubeTextureDynamic=function(t,e){var i=this.gl;i.activeTexture(i.TEXTURE0+e),i.bindTexture(i.TEXTURE_CUBE_MAP,t.__webglTexture)},Ke.ProgramManager.prototype.loadUniformsGeneric=function(t,i,n){var s,r,a,o,h,l,c,u,d,f,g,_=this.gl;for(d=0,f=i.length;d<f;d++)if(o=t.uniforms[i[d][1]])if(s=i[d][0],a=s.type,r=s.value,"i"===a)_.uniform1i(o,r);else if("f"===a)_.uniform1f(o,r);else if("v2"===a)_.uniform2f(o,r.x,r.y);else if("v3"===a)_.uniform3f(o,r.x,r.y,r.z);else if("v4"===a)_.uniform4f(o,r.x,r.y,r.z,r.w);else if("c"===a)_.uniform3f(o,r.r,r.g,r.b);else if("iv1"===a)_.uniform1iv(o,r);else if("iv"===a)_.uniform3iv(o,r);else if("fv1"===a)_.uniform1fv(o,r);else if("fv"===a)_.uniform3fv(o,r);else if("v2v"===a){for(s._array===e&&(s._array=new Float32Array(2*r.length)),c=0,u=r.length;c<u;c++)g=2*c,s._array[g]=r[c].x,s._array[g+1]=r[c].y;_.uniform2fv(o,s._array)}else if("v3v"===a){for(s._array===e&&(s._array=new Float32Array(3*r.length)),c=0,u=r.length;c<u;c++)g=3*c,r[c]instanceof Ke.Color?(s._array[g]=r[c].r,s._array[g+1]=r[c].g,s._array[g+2]=r[c].b):(s._array[g]=r[c].x,s._array[g+1]=r[c].y,s._array[g+2]=r[c].z);_.uniform3fv(o,s._array)}else if("v4v"===a){for(s._array===e&&(s._array=new Float32Array(4*r.length)),c=0,u=r.length;c<u;c++)g=4*c,s._array[g]=r[c].x,s._array[g+1]=r[c].y,s._array[g+2]=r[c].z,s._array[g+3]=r[c].w;_.uniform4fv(o,s._array)}else if("m4"===a)s._array===e&&(s._array=new Float32Array(16)),r.flattenToArray(s._array),_.uniformMatrix4fv(o,!1,s._array);else if("m4v"===a){for(s._array===e&&(s._array=new Float32Array(16*r.length)),c=0,u=r.length;c<u;c++)r[c].flattenToArrayOffset(s._array,16*c);_.uniformMatrix4fv(o,!1,s._array)}else if("t"===a){if(h=r,l=this.getTextureUnit(),_.uniform1i(o,l),!h)continue;if(h._image instanceof Array&&6===h._image.length)this.setCubeTexture(h,l);else{var p=h._image;this.setTexture(h,l,!p||!p.loaded)}}else if("tv"===a){for(s._array===e&&(s._array=[]),c=0,u=s.value.length;c<u;c++)s._array[c]=this.getTextureUnit();for(_.uniform1iv(o,s._array),c=0,u=s.value.length;c<u;c++)if(h=s.value[c],l=s._array[c],h){var p=h._image;h instanceof Si?this.setCubeTextureDynamic(h,l):this.setTexture(h,l,!p||!p.loaded)}}},Ke.ProgramManager.prototype.setTexture=function(t,i,n){var s=this.gl,r=Ke.Utils.isPowerOfTwo,a=t.id;if(this.addTexture(t),!this.needsUpdateTexture(t)||t instanceof bi)s.activeTexture(s.TEXTURE0+i),t instanceof bi?s.bindTexture(s.TEXTURE_2D,t.__webglTexture):s.bindTexture(s.TEXTURE_2D,this.glTextureMap[a]);else{if(!t._image)return;this.glTextureMap[a]===e&&(this.glTextureMap[a]=s.createTexture(),this.info.memory.textures++),this.changeTextureUpdateFlags(t,!1),s.activeTexture(s.TEXTURE0+i),s.bindTexture(s.TEXTURE_2D,this.glTextureMap[a]),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!t.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,t.unpackAlignment);var o=Ke.Utils.paramToGL,h=n?Ke.ImageCache.Logo:t._image,l=r(h.width)&&r(h.height),c=o(t.format,s),u=o(t.type,s);this.setTextureParameters(s.TEXTURE_2D,t,l,n);var d,f=t.mipmaps;if(t instanceof Ke.PixelsTexture)if(f.length>0&&l){for(var g=0,_=f.length;g<_;g++)d=f[g],s.texImage2D(s.TEXTURE_2D,g,c,d.width,d.height,0,c,u,d.data);t.generateMipmaps=!1}else s.texImage2D(s.TEXTURE_2D,0,c,h.width,h.height,0,c,u,h.data);else if(t instanceof Ke.CompressedTexture)for(var g=0,_=f.length;g<_;g++)d=f[g],s.compressedTexImage2D(s.TEXTURE_2D,g,c,d.width,d.height,0,d.data);else if(f.length>0&&l){for(var g=0,_=f.length;g<_;g++)d=f[g],s.texImage2D(s.TEXTURE_2D,g,c,c,u,d);t.generateMipmaps=!1}else try{s.texImage2D(s.TEXTURE_2D,0,c,c,u,h)}catch(p){console.log(p)}t.generateMipmaps&&l&&s.generateMipmap(s.TEXTURE_2D),t.onUpdate&&t.onUpdate()}},Ke.ProgramManager.prototype.getTextureUnit=function(){var t=this.textureCount;return t>=this.gpu._maxTextures&&console.warn("Network3D: trying to use "+t+" texture units while this GPU supports only "+this.gpu._maxTextures),this.textureCount++,t},Ke.ProgramManager.prototype.deallocateMaterial=function(t){var i=t.program;if(i!==e){t.program=e;var n,s,r,a=!1;for(n=0,s=this.programs.length;n<s;n++)if(r=this.programs[n],r.program===i){r.usedTimes--,0===r.usedTimes&&(a=!0);break}if(a===!0){var o=[];for(n=0,s=this.programs.length;n<s;n++)r=this.programs[n],r.program!==i&&o.push(r);this.programs=o,this.gl.deleteProgram(i),this.info.memory.programs--}}},Ke.ProgramManager.prototype.filterFallback=function(t){return t===Ke.NearestFilter||t===Ke.NearestMipMapNearestFilter||t===Ke.NearestMipMapLinearFilter?this.gl.NEAREST:this.gl.LINEAR},Ke.ProgramManager.prototype.setupLights=function(t,e){var i,n,s,r,a,o,h,l,c,u,g=0,_=0,p=0,v=this._lights,m=v.directional.colors,y=v.directional.positions,A=v.point.colors,x=v.point.positions,w=v.point.distances,b=v.spot.colors,S=v.spot.positions,C=v.spot.distances,T=v.spot.directions,E=v.spot.anglesCos,L=v.spot.exponents,M=v.hemi.skyColors,P=v.hemi.groundColors,k=v.hemi.positions,I=0,R=0,D=0,B=0,N=0,z=0,O=0,F=0,V=0,U=0,H=0,W=0,X=new Ke.Vec3;for(i=0,n=e.size();i<n;i++)if(s=e.get(i),!s.onlyShadow)if(r=s.color,h=s.intensity*this.network.lightIntensityRatio,u=s.distance,s.updateWorldMatrix(!0),s instanceof Ke.AmbientLight){if(!s._visible)continue;this.gammaInput?(g+=r.r*r.r,_+=r.g*r.g,p+=r.b*r.b):(g+=r.r,_+=r.g,p+=r.b)}else if(s instanceof Ke.DirectionalLight){if(N+=1,!s._visible)continue;if(s.direction?X.copy(s.direction):(X.copy(s.worldMatrix.getPosition()),X.sub(s.target.worldMatrix.getPosition())),X.normalize(),0===X.x&&0===X.y&&0===X.z)continue;V=3*I,y[V]=X.x,y[V+1]=X.y,y[V+2]=X.z,this.gammaInput?f(m,V,r,h*h):d(m,V,r,h),I+=1}else if(s instanceof Ke.PointLight){if(z+=1,!s._visible)continue;U=3*R,this.gammaInput?f(A,U,r,h*h):d(A,U,r,h),c=s.worldMatrix.getPosition(),x[U]=c.x,x[U+1]=c.y,x[U+2]=c.z,w[R]=u,R+=1}else if(s instanceof Ke.SpotLight){if(O+=1,!s._visible)continue;H=3*D,this.gammaInput?f(b,H,r,h*h):d(b,H,r,h),c=s.worldMatrix.getPosition(),S[H]=c.x,S[H+1]=c.y,S[H+2]=c.z,C[D]=u,X.copy(c),X.sub(s.target.worldMatrix.getPosition()),X.normalize(),T[H]=X.x,T[H+1]=X.y,T[H+2]=X.z,E[D]=Math.cos(s.angle),L[D]=s.exponent,D+=1}else if(s instanceof Ke.HemisphereLight){if(F+=1,!s._visible)continue;if(X.copy(s.worldMatrix.getPosition()),X.normalize(),0===X.x&&0===X.y&&0===X.z)continue;W=3*B,k[W]=X.x,k[W+1]=X.y,k[W+2]=X.z,a=s.color,o=s.groundColor,this.gammaInput?(l=h*h,f(M,W,a,l),f(P,W,o,l)):(d(M,W,a,h),d(P,W,o,h)),B+=1}for(i=3*I,n=Math.max(m.length,3*N);i<n;i++)m[i]=0;for(i=3*R,n=Math.max(A.length,3*z);i<n;i++)A[i]=0;for(i=3*D,n=Math.max(b.length,3*O);i<n;i++)b[i]=0;for(i=3*B,n=Math.max(M.length,3*F);i<n;i++)M[i]=0;for(i=3*B,n=Math.max(P.length,3*F);i<n;i++)P[i]=0;v.directional.length=I,v.point.length=R,v.spot.length=D,v.hemi.length=B,v.ambient[0]=g,v.ambient[1]=_,v.ambient[2]=p},Ke.ProgramManagerId=0,Ke.ProgramManagerCache={count:0};var bi=function(t,i,n){this.width=t,this.height=i,n=n||{},this.wrapS=n.wrapS!==e?n.wrapS:Ke.ClampToEdgeWrapping,this.wrapT=n.wrapT!==e?n.wrapT:Ke.ClampToEdgeWrapping,this.magFilter=n.magFilter!==e?n.magFilter:Ke.LinearFilter,this.minFilter=n.minFilter!==e?n.minFilter:Ke.LinearMipMapLinearFilter,this.anisotropy=n.anisotropy!==e?n.anisotropy:1,this.offset=new Ke.Vec2(0,0),this.repeat=new Ke.Vec2(1,1),this.format=n.format!==e?n.format:Ke.RGBAFormat,this.type=n.type!==e?n.type:Ke.UnsignedByteType,this.depthBuffer=n.depthBuffer===e||n.depthBuffer,this.stencilBuffer=n.stencilBuffer===e||n.stencilBuffer,this.generateMipmaps=!0,this.shareDepthFrom=null};bi.prototype={constructor:bi,clone:function(){var t=new bi(this.width,this.height);return t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.format=this.format,t.type=this.type,t.depthBuffer=this.depthBuffer,t.stencilBuffer=this.stencilBuffer,t.generateMipmaps=this.generateMipmaps,t.shareDepthFrom=this.shareDepthFrom,t},getUniqueCode:function(){return this._id},dispose:function(){this.dispatchEvent({type:"dispose"})}};var Si=function(t,e,i){bi.call(this,t,e,i),this.activeCubeFace=0};Ke.extend(Si,bi,{}),Ke.Network3D=function(i,n,s,r){Ke.Element.call(this),this.id=Ke.Network3DId++,this._interactionDispatcher=new Ke.EventDispatcher,r=r||{},this.helperBox=new Ke.DataBox,this.helperBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._rootView=ei.createView("hidden"),this._canvas=this.initCanvas(s),this._topCanvas=ei.createCanvas(this),this._bottomCanvas=ei.createCanvas(this);var a=this._canvas.parentNode;a&&(a.removeChild(this._canvas),a.appendChild(this._rootView),this.adjustRootViewBounds(0,0,this._canvas.width,this._canvas.height)),this._rootView.appendChild(this._bottomCanvas),this._rootView.appendChild(this._canvas),this._rootView.appendChild(this._topCanvas),this.setCanvasPropety(),this._camera=n||new Ke.PerspectiveCamera,this._camera.addPropertyChangeListener(this.dirtyNetwork,this),this._clearColor=r.clearColor!==e?r.clearColor:new Ke.Color(16777215),this._clearAlpha=r.clearAlpha!=e?r.clearAlpha:1,this._precision=r.precision!==e?r.precision:"mediump",this.__fog=new Ke.FogExp2,this.devicePixelRatio=r.devicePixelRatio!==e?r.devicePixelRatio:t.devicePixelRatio!==e?t.devicePixelRatio:1,this._premultipliedAlpha=null==r.premultipliedAlpha||r.premultipliedAlpha,this.lightIntensityRatio=1,ii.isIOS||ii.isAndroid?(this._antialias=!1,this._preserveDrawingBuffer=!1,this.lightIntensityRatio=.1):(this._preserveDrawingBuffer=null==r.preserveDrawingBuffer||r.preserveDrawingBuffer,this._antialias=r.antialias==e||r.antialias),this._gl=this.initGL(),this._programs=[],this._currentProgram=null,this.overrideMaterial=null,this._maxLights=r.maxLights!==e?r.maxLights:4,this._projScreenMatrix=new ti,this._projScreenMatrixPS=new ti,this._frustum=new Ke.Frustum,this._vector3=new Je,this._oldDoubleSided=-1,this._oldFlipSided=-1,this._oldBlending=null,this._oldBlendEquation=null,this._oldBlendSrc=null,this._oldBlendDst=null,this._currentCamera=null,this._enabledAttributes={},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.gpu=new Ke.GPU(this),this.pm=new Ke.ProgramManager(this),this.setDefaultGLState(),this.paintSortFunction=Ke.Defaults.paintSortFunction,this.sortNodes=!0,this.sortOpaqueOrderByMaterial=!0,this.glNodeList=[],this.helperGLNodeList=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0},currentMaterialId:-1},this.projector=new Ke.Projector,this.up=new Ke.Vec3(0,1,0),this.position=new Ke.Vec3(0,0,0),this.seletionMaterial=new Ke.BasicMaterial,this.seletionMaterial.wireframe=!0,this.seletionMaterial.wireframeLinewidth=1,this.seletionMaterial.color=new Ke.Color(65280),this.selectionCube=new vi,this.selectionCube.material=this.seletionMaterial,this.outlineMaterialMap={},this.selectionCube._modelViewMatrix=new ti,this.selectionCube._normalMatrix=new $e,this.selectionCube.name="select",this.alarmMaterial=new Ke.BasicMaterial,this.alarmMaterial.wireframe=!0,this.alarmMaterial.wireframeLinewidth=1,this.alarmMaterial.color=new Ke.Color(16711680),this.alarmCube=new vi,this.alarmCube.material=this.alarmMaterial,this.alarmCube._modelViewMatrix=new ti,this.alarmCube._normalMatrix=new $e,this.alarmCube.name="alarm";var o=512;this._glowSurface=new Ke.Plane(2,2),this._glowSurface2=new Ke.Plane(o,o),this._glowSurface.target=new bi(o,o,{type:Ke.UnsignedByteType}),this._glowSurface.target1=new bi(o,o,{type:Ke.UnsignedByteType}),this._glowSurface.target2=new bi(o,o,{type:Ke.UnsignedByteType}),this._glowSurfaceMaterial=new Ke.BlurMaterial,this._blurMaterialH=new Ke.BlurMaterial,this._blurMaterialH.orientation=1,this._blurMaterialV=new Ke.BlurMaterial,this.deferredPostionMaterial=new Ke.DeferredMaterial,this.deferredNormalMaterial=new Ke.DeferredMaterial({isNormal:1}),this.ssaoMaterial=new Ke.SSAOMaterial,this.ssaoMaterial.map2=new Ke.Texture(ui.ssaoNormalImage);var h=1024;this.deferredPostionTarget=new bi(h,h,{type:Ke.FloatType,magFilter:Ke.NearestFilter,minFilter:Ke.NearestFilter}),this.deferredNormalTarget=new bi(h,h,{type:Ke.FloatType,magFilter:Ke.NearestFilter,minFilter:Ke.NearestFilter,format:Ke.RGBFormat}),this.ssaoTarget=new bi(h,h,{type:Ke.FloatType,magFilter:Ke.NearestFilter,minFilter:Ke.NearestFilter}),this.ssaoTarget1=new bi(o,o,{type:Ke.UnsignedByteType}),this.ssaoTarget2=new bi(o,o,{type:Ke.UnsignedByteType}),this.finalSSAOTarget=null,this._interactions=null,this.billboardRenderer=null,this._groupCounter=0,this.groupMap={},this.groupCountMap={},this.bufferNodeMap={},this.lineMap={},this.particleMap={},this.glInited={},this.glNodeMap={},this.normalNodeMap={},this.showAxis=!1,this.axisSize=20,this.axisPosition=new Ke.Vec3(0,0,0),this.axis=new Ke.Axis(this.axisSize),this.alarmBillboards=[],this.areaPickingRect={},this.setDataBox(i===e?new Ke.DataBox:i),this.renderCallback=null,this.beforeRenderFunction=null,this.dirtyNetwork(),this.prepareData(),this.autoUpdateCameraAspect=!0,this.shadowMapRenderer=null,this.shadowMapType=Ke.PCFSoftShadowMap,this.shadowMapCullFace=Ke.CullFaceFront,this.adjustBounds(this._canvas.width,this._canvas.height,0,0);
var l=new Ke.DefaultInteraction(this);l.panSpeed=3,l.zoomSpeed=10;var c=this;this.getRootView().addEventListener("mousedown",function(t){c.handleMouseDown(t)}),this.getRootView().addEventListener("mouseup",function(t){c.handleClick(t)});var u=[l,new Ke.SelectionInteraction(this)];this.setInteractions(u),this.doubleClickToLookAtFunction=mi.doubleClickToLookAtFunction,g(this),this.initSurfaceGroup(),this.materialRenderListMap={},this._selectTransparencyThreshold=0,this._dynamicBatchDraw=!1,this._dynamicBatchDrawCountLimit=1024,this.needSmoothNormalFunction=mi.needSmoothNormalFunction,this._annotationMap={},this._activeAnnotation=null},Ke.extend(Ke.Network3D,Ke.Data,{___accessor:["shadowMapEnable","editableFunction","keyboardRemoveEnabled","selectTransparencyThreshold","dynamicBatchDraw","showFps"],setUseFog:function(t){this._useFog=t,this._useFog?this._fog=this.__fog:this._fog=null},setOverloadMaterial:function(t){this._overloadMaterial=t},setFogColor:function(t){this.__fog.color=t},setFogDensity:function(t){this.__fog.density=t},setDataBox:function(t){if(!t)throw"DataBox can not be null";if(this.dataBox!==t){var e=this.dataBox;e&&(this._clearDataBox(e),e.removeDataBoxChangeListener(this.handleDataBoxChange,this),e.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),e.getAlarmBox().removeDataBoxChangeListener(this.dirtyNetwork,this),e.getSelectionModel().removeSelectionChangeListener(this.dirtyNetwork,this)),this.dataBox=t,this.dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this.dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this.dataBox.getAlarmBox().addDataBoxChangeListener(this.dirtyNetwork,this),this.dataBox.getSelectionModel().addSelectionChangeListener(this.dirtyNetwork,this),this.firePropertyChange("dataBox",e,this._box),this.glNodeList=[],this.dirtyNetwork(),this._clearNodeCache()}},setRenderCallback:function(t){this.renderCallback=t},setBeforeRenderFunction:function(t){this.beforeRenderFunction=t},getDataBox:function(){return this.dataBox},getClearColor:function(){return this._clearColor},setClearColor:function(t){3==arguments.length?(this._clearColor=new Ke.Color,this._clearColor.setRGB(arguments[0],arguments[1],arguments[2])):(this._clearColor=t,this._clearColor instanceof Ke.Color||(this._clearColor=new Ke.Color(t))),this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.dirtyNetwork()},setClearAlpha:function(t){this._clearAlpha=t,this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.dirtyNetwork()},getClearAlpha:function(){return this._clearAlpha},getPrecision:function(){return this._precision},setPrecision:function(t){this._precesion=t},setSSAOBlur:function(t){this._ssaoBlur=t},setSSAOEnable:function(t){return!(t&&!this.isFloatTextureSupport())&&(this._sSAOEnable=t,this._dirty=!0,!0)},isSSAOEnable:function(){return this._sSAOEnable&&this._baseRender},setSSAOOccluderBias:function(t){this._occluderBias=t,this._dirty=!0},setSSAOSamplingRadius:function(t){this._samplingRadius=t,this._dirty=!0},setSSAOAttenuation:function(t){this._attenuation=t,this._dirty=!0},isFloatTextureSupport:function(){return null!=this._glExtensionTextureFloat},getCamera:function(){return this._camera},setCamera:function(t,e){if(this._camera!=t){var i=this._camera;if(i.removePropertyChangeListener(this.dirtyNetwork),this._camera=t,this._camera.addPropertyChangeListener(this.dirtyNetwork,this),this.autoUpdateCameraAspect){this._camera.setAspect(i.aspect);var n=this.getDefaultInteraction();n&&(n.object=this._camera)}e&&(this._camera.p(i.p()),this._camera.lookAt(i.getTarget())),this.dirtyNetwork()}},isVisible:function(t){if(t){if(t instanceof Ke.Link||t instanceof Ke.PathLink){if(!t.isVisible())return!1;if(!this.isVisible(t._fromNode))return!1;if(!this.isVisible(t._toNode))return!1}if(!t.isVisible())return!1;if(t._parent)return this.isVisible(t._parent);if(this.visibleFunction)return this.visibleFunction(t)}return!0},setCanvasPropety:function(){this._canvas&&(this._canvas.setAttribute("tabindex",this.id),this._canvas.style.outline="none",this._canvas.style.position="absolute")},initCanvas:function(t){return t===e?document.createElement("canvas"):("string"==typeof t&&(t=document.getElementById(t)),t)},initGL:function(){var t;try{t=this._canvas.getContext("webgl",{preserveDrawingBuffer:this._preserveDrawingBuffer,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:!0})||this._canvas.getContext("experimental-webgl",{preserveDrawingBuffer:this._preserveDrawingBuffer,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:!0})}catch(e){console.log(e)}return t||console.error("Can not init webgl context"),this._glExtensionTextureFloat=t.getExtension("OES_texture_float"),this._glExtensionStandardDerivatives=t.getExtension("OES_standard_derivatives"),this._glExtensionTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this._glExtensionCompressedTextureS3TC=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._glExtensionTextureFloat||console.log("TGL.Network3D: Float textures not supported."),this._glExtensionStandardDerivatives||console.log("TGL.Network3D: Standard derivatives not supported."),this._glExtensionTextureFilterAnisotropic||console.log("TGL.Network3D: Anisotropic texture filtering not supported."),this._glExtensionCompressedTextureS3TC||console.log("TGL.Network3D: S3TC compressed textures not supported."),t?t:void console.log("Error: Your browser does not support WebGL.")},resetRenderInfo:function(){this.info.render.calls=0,this.info.render.vertices=0,this.info.render.faces=0,this.info.render.points=0,this.info.currentMaterialId=-1},_clearDataBox:function(t){var e=null;e=t===this.helperBox?this.helperGLNodeList:this.glNodeList;for(var i=e.length-1;i>=0;i--){e[i];e.splice(i,1)}e=[],this.prepareData(),this.pm._lightNeedsUpdate=!0,this.pm.changeAllLightMaterialUpdateFlags(!0),this._clearNodeCache(),this.deleteCloneNode()},handleDataBoxChange:function(t){var e=t.kind,i=t.data,n=t.source,s=null;s=n===this.helperBox?this.helperGLNodeList:this.glNodeList,"add"===e?i instanceof Ke.Light?(this.pm._lightNeedsUpdate=!0,this.pm.changeAllLightMaterialUpdateFlags(!0),this.prepareData()):i instanceof Ke.Annotation?this._createAnnotationDiv(i):(this.addNodeMaterials(i),0===s.length?this.initWebGLNodes(n,s):this.addNode(i,s),i._alarmBillboard&&this.alarmBillboards.push(i._alarmBillboard)):"remove"===e?i instanceof Ke.Light?(this.pm._lightNeedsUpdate=!0,this.pm.changeAllLightMaterialUpdateFlags(!0),this.prepareData()):i instanceof Ke.Annotation?this._removeAnnotationDiv(i):(this.removeNode(i,s),this.deleteCloneNode(i)):"clear"===e&&this._clearDataBox(),this.boundingBox=null,this.dirtyNetwork()},removeNode:function(t,e){for(var i=e.length-1;i>=0;i--){var n=e[i];n.node===t&&e.splice(i,1)}this._clearNodeCache(t)},_clearNodeCache:function(t){if(t){if(t.oldGroups=t.groups||t.oldGroups,null!=t.oldGroups)for(var e in t.oldGroups){var i=t.oldGroups[e],n=this.groupCountMap[i.id];null!=n&&(n--,n<=0?(delete this.groupCountMap[i.id],delete this.groupMap[i.id]):this.groupCountMap[i.id]=n)}for(var s=0;s<this.alarmBillboards.length;s++){var r=this.alarmBillboards[s];r.getParent()===t&&(this.alarmBillboards.splice(s,1),s--)}t instanceof Ke.Annotation&&this._removeAnnotationDiv(t)}else{for(var a in this.groupMap){var o=this.groupMap[a],h=o._nodeId;this.helperBox.containsById(h)||delete this.groupMap[a]}this.glInited=new Object,this.alarmBillboards.splice(0),this.glNodeList=[]}for(var a in this._annotationMap)this._removeAnnotationDiv(a)},addNode:function(t,e){for(var i=this.addWebGLNode(e,t),n=0;n<i.length;n++){var s=i[n];this.updateWebGLNode(s)}},addNodeMaterials:function(t){var e,i=t.material;if(i instanceof Ke.Material)this.addMaterial(i);else if(i instanceof Ke.ArrayMaterial){var n=i.materials,s=n.length;for(e=0;e<s;e++)this.addMaterial(n[e])}},addMaterial:function(t){this.pm.addMaterial(t),t.map&&this.pm.addTexture(t.map)},handleDataPropertyChange:function(t){var e=t.source;if(e instanceof Ke.Node){var i=t.property;if(e.isSizeChangedProperty(i)||i===Ke.Styles.MaterailType||i===Ke.Styles.NormalType){if(e instanceof Ke.Line){e.verticesNeedUpdate=!0;var n=this.lineMap[e._id];this.initLineBuffers(e),ai.buildLineBufferData(e,this._gl.DYNAMIC_DRAW,this._gl,n)}else if(e.groups){e.verticesNeedUpdate=!0,i!==Ke.Styles.MaterailType&&i!==Ke.Styles.NormalType||(e.normalsNeedUpdate=!0);for(var s in e.groups){var r=e.groups[s],n=this.groupMap[r.id],a=ai.getMaterial(e,r.materialIndex);e.normalsNeedUpdate&&this.initGroupBuffer(e,r,n,!0),ai.buildGroupBufferData(r,e,this._gl.DYNAMIC_DRAW,!e.dynamic,a,this._gl,n,this)}}}else if("materialMapping"===i)this._currentGroupHash=null,this.glInited[e.getId()]=!1,this.removeNode(e,this.glNodeList),this.addNode(e,this.glNodeList);else if("alarmBillboard"===i){var o=t.oldValue,h=t.newValue;this._addNodeAlarmBillboard(e,o,h)}this.addNodeMaterials(e)}else e instanceof Ke.Light&&(this.pm._lightNeedsUpdate=!0);(e.isSizeChangedProperty&&e.isSizeChangedProperty(i)||"parent"==i||e.isSpaceChangedProperty(i))&&(this.deleteCloneNode(e),this.boundingBox=null),this.dirtyNetwork()},deleteCloneNode:function(t){if(t){var e=t.getId?t.getId():t,i=this.normalNodeMap[e];if(null!=i){i.setParent(null);for(var n in i.groups){var s=i.groups[n];delete this.groupMap[s.id]}}delete this.normalNodeMap[e]}else for(var e in this.normalNodeMap)this.deleteCloneNode(e)},setBlurAmount:function(t){this._blurAmount=t},setBlurScale:function(t){this._blurScale=t},setBlurStrength:function(t){this._blurStrength=t},setBlurGlobalAlpha:function(t){this._blurGlobalAlpha=t},dirtyNetwork:function(t){this.dataBox.batch||(this._dirty=!0)},_addNodeAlarmBillboard:function(t,i,n){if(n===e&&(n=t._alarmBillboard),null!=i&&this.alarmBillboards.indexOf(i)!==-1){var s=this.alarmBillboards.indexOf(i);this.alarmBillboards.splice(s,1),i.removePropertyChangeListener(this.dirtyNetwork,this)}n&&this.alarmBillboards.indexOf(n)===-1&&(this.alarmBillboards.push(n),n.addPropertyChangeListener(this.dirtyNetwork,this))},initWebGLNodes:function(t,e){var i,n,s=t.getNodes();for(i=0,n=s.size();i<n;i++){var r=s.get(i);r.renderSelected=!1,this.addWebGLNode(e,r),this.glNodeMap[r.id]=r}for(i=0,n=e.length;i<n;i++)this.updateWebGLNode(e[i])},updateWebGLNode:function(t){var e,i,n=t.node;if(n instanceof Ke.Entity){for(var s in n.groups)if(e=n.groups[s],i=ai.getMaterial(n,e.materialIndex),n.buffersNeedUpdate){var r=this.groupMap[e.id];this.initGroupBuffer(n,e,r),ai.buildGroupBufferData(e,n,this._gl.DYNAMIC_DRAW,!n.dynamic,i,this._gl,r,this)}n.setUpdateFlags(!1),n.buffersNeedUpdate=!1}else if(n instanceof Ke.BufferNode)this.setBufferNodeData(n,this._gl.DYNAMIC_DRAW,!n.dynamic);else if(n instanceof Ke.Line){var r=this.lineMap[n._id];ai.buildLineBufferData(n,this._gl.DYNAMIC_DRAW,this._gl,r)}else if(n instanceof Ke.Particle){var r=this.particleMap[n._id];hi(n,this._gl.DYNAMIC_DRAW,this._gl,r)}},addWebGLNode:function(t,i){var n,s,r,a,o=[];if(this.glInited[i.getId()]||this._addNodeAlarmBillboard(i),!this.glInited[i.getId()])if(this.glInited[i.id]=!0,i._modelViewMatrix=new ti,i._normalMatrix=new $e,i instanceof Ke.Entity){i.groups==e&&oi(i);for(n in i.groups){s=i.groups[n],s.id=s.id===e?Ke.Network3D.GroupCache._groupCounter++:s.id;var h=this.groupCountMap[s.id]||0;h++,this.groupCountMap[s.id]=h,this.groupMap[s.id]===e&&(this.groupMap[s.id]={});var l=this.groupMap[s.id];l._nodeId=i.getId(),l.__webglVertexBuffer||(this.createGroupBuffer(s,l),this.initGroupBuffer(i,s,l),i.setUpdateFlags(!0))}}else if(i instanceof Ke.Line){null==this.lineMap[i._id]&&(this.lineMap[i._id]={});var l=this.lineMap[i._id];l._nodeId=i.getId(),l.__webglVertexBuffer||(this.createLineBuffers(i),this.initLineBuffers(i),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0,i.lineDistancesNeedUpdate=!0)}else if(i instanceof Ke.Particle){null==this.lineMap[i._id]&&(this.lineMap[i._id]={});var l=this.lineMap[i._id];l._nodeId=i.getId(),l.__webglVertexBuffer||(this.createParticleBuffers(i),this.initParticleBuffers(i),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0)}else i instanceof Ke.BufferNode?this.initBufferNode(i):i instanceof Ke.Annotation&&this._createAnnotationDiv(i);if(i instanceof Ke.Entity){for(n in i.groups)s=i.groups[n],r=ai.getMaterial(i,s.materialIndex),a={group:s,node:i,opaque:r.transparent?null:r,transparent:r.transparent?r:null},t.push(a),o.push(a);null===i.groups}else i instanceof Ke.Line?(r=i.material,a={group:i,node:i,opaque:r.transparent?null:r,transparent:r.transparent?r:null},t.push(a),o.push(a)):i instanceof Ke.Particle?(r=i.material,a={group:i,node:i,opaque:r.transparent?null:r,transparent:r.transparent?r:null},t.push(a),o.push(a)):i instanceof Ke.BufferNode&&(r=i.material instanceof Ke.ArrayMaterial?i.material.materials[0]:i.material,a={group:i,node:i,opaque:r.transparent?null:r,transparent:r.transparent?r:null},t.push(a),o.push(a));return i.glActive=!0,o},onElementDispose:function(t){var e=t.target;e.removeEventListener("dispose",this.onElementDispose),deallocateElement(e),this.info.memory.geometries--},deallocateElement:function(t){},_AK47:function(t,i,n,s,r,a){this._fog;t.parent===e&&t.updateWorldMatrix(!0,!1),t.worldMatrixInverse.getInverse(t.worldMatrix),this._projScreenMatrix.multiply(t.projectionMatrix,t.worldMatrixInverse),this._frustum.setFromMatrix(this._projScreenMatrix),0===n.length&&(this.initWebGLNodes(i,n),this.prepareData()),this.resetRenderInfo();var o,h,l,c;if(!a)for(o=0,h=n.length;o<h;o++)l=n[o],c=l.node,c.renderSelected=!1,l.render=!1,this.isVisible(c)&&(this.unrollBufferMaterial(l),this.setupMatrices(c,t),(c instanceof Ke.Entity||c instanceof Ke.Particle)&&c.frustumCulled&&!this._frustum.intersectsObject(c)||(l.render=!0,this.sortNodes&&(this._vector3.copy(c.worldMatrix.getPosition()),this._vector3.applyProjection(this._projScreenMatrix),null!=c.renderDepth?l.z=c.renderDepth+this._vector3.z:l.z=this._vector3.z)));var u=new ci;if(u.addAll(s),!r&&!a){for(var d=this.alarmBillboards.length-1;d>=0;d--){var f=this.alarmBillboards[d];null==f.getParent()&&this.alarmBillboards.splice(d,1)}u.addAll(this.alarmBillboards)}var g=this;!a&&u.forEach(function(t){t.renderDepth?t.z=t.renderDepth:(g._vector3.copy(t.worldMatrix.getPosition()),g._vector3.applyProjection(g._projScreenMatrix),t.z=g._vector3.z)}),u.size()>0&&!a&&null==this.billboardRenderer&&(this.billboardRenderer=new Ke.BillboardRenderer);var _=[].concat(n).concat(u._as),p=this.sortNodesFunc(_);this.setBlending(Ke.NoBlending),this.renderNodes(p,!1,"opaque",t,i.getLights(),!1,null,a,this.sortOpaqueOrderByMaterial),this.renderNodes(p,!0,"transparent",t,i.getLights(),!0,null,a),this.setDepthTest(!0),this.setDepthWrite(!0)},unrollBufferMaterial:function(t){var e,i,n,s=t.node,r=t.group;n=s.material,n instanceof Ke.ArrayMaterial?(i=r.materialIndex||0,e=n.materials[i],e.transparent?(t.transparent=e,t.opaque=null):(t.opaque=e,t.transparent=null)):(e=n,e&&(e.transparent?(t.transparent=e,t.opaque=null):(t.opaque=e,t.transparent=null)))},renderLicense:function(){},isShadowable:function(){return this.isShadowMapEnable()&&(this.maxShadows>0||this.maxPointShadows>0)},render:function(){if(this._dirty&&(this._dirty=!1,null!=this.beforeRenderFunction&&this.beforeRenderFunction.call(this),!this.isShadowable()||(this.shadowMapRender(),this.setRenderTarget(e),!this.debugPointLight))){if(Xi.twm(this),this.paintBottom(this._bottomCanvas),this.getShowFps()&&(this.__time=(new Date).getTime()),this.innerRender(this._camera,!0),this.renderAnnotations(this._camera),this.extendRender(this._camera),this.paintTopCanvas(),this.getShowFps()){this._tpf=(new Date).getTime()-this.__time;var t=this._topCanvas.getContext("2d"),i=(1e3/this._tpf).toFixed(0);i>500&&(i="> 500");var n="FPS:"+i+",TPF:"+this._tpf+" ms";t.font="20px Arial sans-serif",t.fontWeight="bold",t.lineWith=2,t.fillStyle="rgba(0, 0, 0, 1)",t.fillText(n,10,25)}if(this._xyz!=e){var s,r=this._xyz,a=r.markText,o=r.type,n=(r.expired,r.innerHTML),h=0,l=0,t=(this._topCanvas.getBoundingClientRect(),this._topCanvas.getContext("2d"));a!=e&&null!=a&&""!=a||"2"==o?(t.font="24px Arial sans-serif",s=ri.getTextSize(t.font,n),t.fillStyle="red",h=this._canvas.width-s.width-20,l=this._canvas.height-s.height-10):(t.font="15px Arial sans-serif",t.fillStyle="rgba(240, 120, 25, 0.6)",s=ri.getTextSize(t.font,n),h=this._canvas.width-s.width-20,l=this._canvas.height-s.height-10),t.fillText(n,h,l)}null!=this.renderCallback&&this.renderCallback.call(this)}},getTextSize:function(t,e){return ri.getTextSize(t,e)},shadowMapRender:function(){null==this.shadowMapRenderer&&(this.shadowMapRenderer=new tn,this.shadowMapRenderer.init(this)),0===this.glNodeList.length&&(this.initWebGLNodes(this.dataBox,this.glNodeList),this.prepareData()),this.shadowMapRenderer.render(this.dataBox,this._camera)},handleMouseDown:function(t){var e=t.target;this.lastX=t.clientX,this.lastY=t.clientY,"tgl_annotation"==e.getAttribute("class")&&"1"==e.style.opacity&&(t.stop=!0,t.stopPropagation())},handleClick:function(t){var e=t.clientX-this.lastX,i=t.clientY-this.lastY;if(Math.abs(e)<.1&&Math.abs(i)<.1){var n=t.target;if("tgl_annotation"!=n.getAttribute("clazz"))this._activeAnnotation&&(this._activeAnnotation=null,this.dirtyNetwork());else if("1"==n.style.opacity){var s=n.getAttribute("id"),r=this.getDataBox().getDataById(s),a=this._annotationMap[s];this.handleDefaultAnnotationClick(r,a),this.handleAnnotationClick(r,a),this.dirtyNetwork()}}},handleDefaultAnnotationClick:function(t,e){this._activeAnnotation!=t&&(this._activeAnnotation=t)},handleAnnotationClick:function(t,e){},renderAnnotations:function(t){var e=this.dataBox.getAnnotations(),i=this;if(e&&(e.forEach(function(e){i.renderAnnotation(t,e)}),this._createAnnotationStyle()),this._activeAnnotation){this._createAnnotationToolTipDiv();var n=this._annotationToolTipDiv;n.innerHTML=this._activeAnnotation.getText();var s=this._annotationMap[this._activeAnnotation.getId()];n.parentNode!=s&&s.appendChild(n),n.style.opacity=s.style.opacity}},getAnnotationDiv:function(t){return this._annotationMap[t.getId()]},renderAnnotation:function(t,e){var i=this._annotationMap[e.getId()];null==i&&(i=this._createAnnotationDiv(e)),i.innerHTML=e._label,e.updateWorldMatrix();var n=e.worldMatrix.getPosition(),s=e.getStyle("annotation.class");i.setAttribute("class",s);var r=this.getViewPosition(n);this._annotationToolTipDiv;i.style.left=r.x+"px",i.style.top=r.y+"px",i.style.opacity="1";var a=n.distanceTo(t.getPosition()),o=this.getElementByScreenPoint(r,!1);if(o&&o.length>0){var h=o[0];h.distance<a&&(i.style.opacity="0.03")}},_addCSSRule:function(t,e,i,n){n=n||(t.cssRules||t.rules).length,t.insertRule?t.insertRule(e+"{"+i+"}",n):t.addRule&&t.addRule(e,i,n)},_createAnnotationStyle:function(){if(!this._annotationStyle){var t=document.createElement("style");t.appendChild(document.createTextNode("")),document.head.appendChild(t);var e=t.sheet;this._addCSSRule(e,".tgl_annotation","position:absolute;width:16px;height:16px;border-radius:10px;text-align:center;border : 2px solid gray;"),this._addCSSRule(e,".tgl_annotation:hover","border : 2px solid black;"),this._annotationStyle=t}},_removeAnnotationDiv:function(t){var e=t.getId?t.getId():t,i=this._annotationMap[e];null!=i&&this.getRootView().removeChild(i)},_createAnnotationDiv:function(t){var e=document.createElement("div"),i=t.getStyle("annotation.class");return e.setAttribute("id",t.getId()),e.setAttribute("class",i),e.setAttribute("clazz","tgl_annotation"),this._annotationMap[t.getId()]=e,this.getRootView().appendChild(e),e},_createAnnotationToolTipDiv:function(){if(null==this._annotationToolTipDiv){var t=document.createElement("div");t.setAttribute("class","tgl_annotation_tooltip");var e=document.createElement("style");e.appendChild(document.createTextNode("")),document.head.appendChild(e);var i=e.sheet,n="position: absolute;border: 3px solid #333; background-color: #ccd; padding: 3px;text-align: left;width: 220px;height: 'auto';border-radius: 10px;bottom:35px;left:-13px;";this._addCSSRule(i,".tgl_annotation_tooltip",n),n="content: ' ';position: absolute;top: 100%; border: 1px solid;",this._addCSSRule(i,".tgl_annotation_tooltip:after, .tgl_annotation_tooltip:before",n),n="border-color: #333 transparent transparent transparent;border-width: 16px 17px 0 7px;left: 10px;",this._addCSSRule(i,".tgl_annotation_tooltip:before",n),n="border-color: #ccd transparent transparent transparent;border-width: 12px 11px 0 4px;left: 14px;",this._addCSSRule(i,".tgl_annotation_tooltip:after",n),this._annotationToolTipDiv=t}},extendRender:function(t){},innerRender:function(t,i){if(t===e&&(t=this._camera),null===t)return void console.log(" no camera");if(this.debug&&console.log("inner Render"),this.autoClear){var n=this._clearColor;this._gl.clearColor(n.r,n.g,n.b,this._clearAlpha),wi.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil,this)}if(i)for(var s=0;s<this._interactions.length;s++){var r=this._interactions[s];r.update&&r.update()}if(this.billboardRenderer&&this.billboardRenderer.disable(),this._gl.viewport(0,0,this._canvas.width,this._canvas.height),this._sSAOEnable){this.linearDepth=t.far-t.near,this.ssaoing=!0,this._renderDeferredTarget(t,this.deferredPostionMaterial,this.deferredPostionTarget),this._renderDeferredTarget(t,this.deferredNormalMaterial,this.deferredNormalTarget),this._setSSAOMaterial(),this._overloadMaterial=null,this._renderSurface(t,this.ssaoTarget,this.ssaoMaterial);var a=this._canvas.width/this._canvas.height;this._ssaoBlur?(this._renderBlurTarget(t,this._blurMaterialH,this.ssaoTarget,this.ssaoTarget1,a),this._renderBlurTarget(t,this._blurMaterialV,this.ssaoTarget1,this.ssaoTarget2,a),this.finalSSAOTarget=this.ssaoTarget2):this.finalSSAOTarget=this.ssaoTarget,this.setRenderTarget(e),this.ssaoing=!1}if(this.renderOutline=!1,this.renderOutlineGlow=!1,wi.enableStencil(this._gl),this._baseRender=!0,wi.r(this,t,this.dataBox,this.glNodeList,this.dataBox.getBillboards()),this._baseRender=!1,wi.stencilTest(this._gl),this.renderOutline&&wi.r(this,t,this.dataBox,this.glNodeList,this.dataBox.getBillboards(),!1,"stencil"),this.renderOutlineGlow){var o=this._glowSurface.target,h=this._glowSurface.target1,l=this._glowSurface.target2;wi.disableStencil(this._gl),this.setRenderTarget(o),o._id=o._id||(new Date).getTime()+"0",h._id=h._id||(new Date).getTime()+"1",l._id=l._id||(new Date).getTime()+"2",this._gl.viewport(0,0,o.width,o.height),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._gl.colorMask(!1,!1,!1,!1),wi.r(this,t,this.dataBox,this.glNodeList,this.dataBox.getBillboards(),!1,"glow.unselect"),this._gl.colorMask(!0,!0,!0,!0),wi.r(this,t,this.dataBox,this.glNodeList,this.dataBox.getBillboards(),!1,"glow.select");var c,u;this.setRenderTarget(h),this._gl.viewport(0,0,h.width,h.height),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialH.setMap(o);var a=this._canvas.width/this._canvas.height;this._blurMaterialH.texelSize=new Qe(o.width,o.height/a),this._blurMaterialH.blurAmount=this._blurAmount||5,this._blurMaterialH.blurScale=this._blurScale||1,this._blurMaterialH.blurStrength=this._blurStrength||1,this._blurMaterialH.orientation=1;for(c in this._glowSurface.groups)u=this._glowSurface.groups[c],this.renderGroup(t,[],this._blurMaterialH,u,this._glowSurface2);this.setRenderTarget(l),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialV.setMap(h),this._blurMaterialV.texelSize=new Qe(h.width,h.height/a),this._blurMaterialV.blurAmount=this._blurAmount||5,this._blurMaterialV.blurScale=this._blurScale||1,this._blurMaterialV.blurStrength=this._blurStrength||1,this._blurMaterialV.orientation=0;for(c in this._glowSurface.groups)u=this._glowSurface.groups[c],this.renderGroup(t,[],this._blurMaterialV,u,this._glowSurface2);this.setRenderTarget(e),this._glowSurface._modelViewMatrix=new ti,this._glowSurface._normalMatrix=new $e,this.setupMatrices(this._glowSurface,t),this._glowSurfaceMaterial.setMap(l),this._glowSurfaceMaterial.useBlur=0,this._glowSurfaceMaterial.blurGlobalAlpha=this._blurGlobalAlpha||1,wi.setBlending(this._glowSurfaceMaterial.blendMode,this._glowSurfaceMaterial.blendEquation,this._glowSurfaceMaterial.blendSrc,this._glowSurfaceMaterial.blendDst,this),this._gl.enable(this._gl.STENCIL_TEST);for(c in this._glowSurface.groups)u=this._glowSurface.groups[c],this.renderGroup(t,[],this._glowSurfaceMaterial,u,this._glowSurface);this.setRenderTarget(h),this._gl.viewport(0,0,h.width,h.height),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialH.setMap(o);var a=this._canvas.width/this._canvas.height;this._blurMaterialH.texelSize=new Qe(o.width,o.height/a),this._blurMaterialH.blurAmount=this._blurAmount||10,this._blurMaterialH.blurScale=this._blurScale||1,this._blurMaterialH.blurStrength=this._blurStrength||1,this._blurMaterialH.orientation=0;for(c in this._glowSurface.groups)u=this._glowSurface.groups[c],this.renderGroup(t,[],this._blurMaterialH,u,this._glowSurface2);this.setRenderTarget(l),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialV.setMap(h),this._blurMaterialV.texelSize=new Qe(h.width,h.height/a),this._blurMaterialV.blurAmount=this._blurAmount||10,this._blurMaterialV.blurScale=this._blurScale||1,this._blurMaterialV.blurStrength=this._blurStrength||1,this._blurMaterialV.orientation=1;for(c in this._glowSurface.groups)u=this._glowSurface.groups[c],this.renderGroup(t,[],this._blurMaterialV,u,this._glowSurface2);this.setRenderTarget(e),this._glowSurface._modelViewMatrix=new ti,this._glowSurface._normalMatrix=new $e,this.setupMatrices(this._glowSurface,t),this._glowSurfaceMaterial.setMap(l),this._glowSurfaceMaterial.useBlur=0,this._glowSurfaceMaterial.blurGlobalAlpha=this._blurGlobalAlpha||1,wi.setBlending(this._glowSurfaceMaterial.blendMode,this._glowSurfaceMaterial.blendEquation,this._glowSurfaceMaterial.blendSrc,this._glowSurfaceMaterial.blendDst,this),this._gl.enable(this._gl.STENCIL_TEST);for(c in this._glowSurface.groups)u=this._glowSurface.groups[c],this.renderGroup(t,[],this._glowSurfaceMaterial,u,this._glowSurface);this._gl.clearColor(0,0,0,0)}wi.disableStencil(this._gl),this.renderHelper(t)},_renderDeferredTarget:function(t,e,i,n){n=n||new Ke.Vec4(0,0,0,0,0),e.linearDepth=this.linearDepth,this.setRenderTarget(i),this._overloadMaterial=e,this._gl.clearColor(n.x,n.y,n.z,n.w),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),wi.r(this,t,this.dataBox,this.glNodeList,this.dataBox.getBillboards())},_renderBlurTarget:function(t,e,i,n,s){clearColor=clearColor||new Ke.Vec4(0,0,0,0,0),this.setRenderTarget(n),this._gl.viewport(0,0,n.width,n.height),this._gl.clearColor(clearColor.x,clearColor.y,clearColor.z,clearColor.w),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),e.setMap(i),e.texelSize=new Qe(i.width,i.height/s),e.blurAmount=this._blurAmount||5,e.blurScale=this._blurScale||1,e.blurStrength=this._blurStrength||1;var r,a;for(r in this._glowSurface.groups)a=this._glowSurface.groups[r],this.renderGroup(t,[],e,a,this._glowSurface2)},_setSSAOMaterial:function(){this.ssaoMaterial.map=this.deferredPostionTarget,this.ssaoMaterial.map1=this.deferredNormalTarget,this.ssaoMaterial.attenuation=this._attenuation||new Qe(1,.02),this.ssaoMaterial.occluderBias=this._occluderBias||.5,this.ssaoMaterial.samplingRadius=this._samplingRadius||20,this.ssaoMaterial.texelSize=new Qe(1/this.deferredPostionTarget.width,1/this.deferredPostionTarget.height)},_renderSurface:function(t,e,i,n){n=n||new Ke.Vec4(1,1,1,1),this.setRenderTarget(e),this._gl.clearColor(n.x,n.y,n.z,n.w),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._glowSurface._modelViewMatrix=new ti,this._glowSurface._normalMatrix=new $e,this.setupMatrices(this._glowSurface,t);var s,r;for(r in this._glowSurface.groups)s=this._glowSurface.groups[r],this.renderGroup(t,[],i,s,this._glowSurface)},renderHelper:function(t){wi.r(this,t,this.helperBox,this.helperGLNodeList,this.helperBox.getBillboards(),"stencil")},initSurfaceGroup:function(){this._glowSurface.setUpdateFlags(!0),oi(this._glowSurface);for(var t in this._glowSurface.groups){var i=this._glowSurface.groups[t];i.id=i.id===e?Ke.Network3D.GroupCache._groupCounter++:i.id,this.groupMap[i.id]===e&&(this.groupMap[i.id]={});var n=this.groupMap[i.id];this.createGroupBuffer(i,n),this.initGroupBuffer(this._glowSurface,i,n),ai.buildGroupBufferData(i,this._glowSurface,this._gl.DYNAMIC_DRAW,!1,this._glowSurfaceMaterial,this._gl,n,this)}this._glowSurface2.setUpdateFlags(!0),oi(this._glowSurface2);for(var t in this._glowSurface2.groups){var i=this._glowSurface2.groups[t];i.id=i.id===e?Ke.Network3D.GroupCache._groupCounter++:i.id,this.groupMap[i.id]===e&&(this.groupMap[i.id]={});var n=this.groupMap[i.id];this.createGroupBuffer(i,n),this.initGroupBuffer(this._glowSurface2,i,n),ai.buildGroupBufferData(i,this._glowSurface2,this._gl.DYNAMIC_DRAW,!1,this._glowSurfaceMaterial,this._gl,n,this)}},getOutlineMaterial:function(t,e){var i=(e.getStyle("select.width")||1)+1+" "+new Ke.Color(e.getStyle("select.color")).getUniqueCode()+t,n=this.outlineMaterialMap[i];return null==n&&(n=new Ke.EntityMaterial,"outline.normal"==t?(n._type="outline",n.outline=e.getStyle("select.width")||1):"outline.glow"==t?n._type="basic":(n.wireframe=!0,n.wireframeLinewidth=(e.getStyle("select.width")||1)+1),n.color=new Ke.Color(e.getStyle("select.color")),this.outlineMaterialMap[i]=n),n},renderNodes:function(t,e,i,n,s,r,a,o,h){var l,c,u,d,f,g,_;e?(f=t.length-1,g=-1,_=-1):(f=0,g=t.length,_=1);for(var p=f;p!==g;p+=_)if(l=t[p],d=l.node?l.transparent||l.opaque:l.material){this._overloadMaterial&&(d=this._overloadMaterial);var v=this.getOverLoadMaterial(l.node?l.node:l,d);if(v){var m=v.getUniqueCode(),y=Ji.getMaterial(m);y?d=y:(Ji.setMaterial(m,v),d=v)}if(!("opaque"==i&&1==d.transparent||"transparent"==i&&0==d.transparent)){if(r?(wi.setBlending(d.blendMode,d.blendEquation,d.blendSrc,d.blendDst,this),wi.setDepthWrite(!1,this)):wi.setDepthWrite(d.depthMask,this),l instanceof Ke.Billboard){var A=l.material.transparent?"transparent":"opaque";i==A&&this.billboardRenderer.render(this,[l],n,2*this._canvas.width,2*this._canvas.height)}else if(l.render){if(this.billboardRenderer&&this.billboardRenderer.disable(),c=l.node,u=l.group,wi.setDepthTest(d.depthTest,this),wi.setPolygonOffset(d.polygonOffset,d.polygonOffsetFactor,d.polygonOffsetUnits,this),this.setGLFaces(d),c instanceof Ke.Particle){if(c.verticesNeedUpdate||c.colorsNeedUpdate||c.sortParticles){var x=this.particleMap[c._id];hi(c,this._gl.DYNAMIC_DRAW,this._gl,x)}c.verticesNeedUpdate=!1,c.colorsNeedUpdate=!1}var w=this.getSelectStyle(c);if("outline"==w&&(w="outline.normal"),o?"glow.unselect"===o&&(c.isSelected()||(c instanceof Ke.BufferNode?this.renderBufferNode(n,s,d,u,c):wi.g(this,n,s,d,u,c))):(!c.isSelected()||"outline.normal"!==w&&"outline.wireframe"!==w&&"outline.glow"!==w?this.setStencilTest(!1):(this.setStencilTest(!0),"outline.glow"===w?this.renderOutlineGlow=!0:this.renderOutline=!0),c instanceof Ke.BufferNode?this.renderBufferNode(n,s,d,u,c):wi.g(this,n,s,d,u,c)),c.isSelected()&&this.renderSelect(c))if("outline.normal"===w||"outline.wireframe"===w||"outline.glow"===w){if(null!=o&&"glow.unselect"!=o)if("outline.normal"===w){if(c.renderSelected===!1){var b=this.getOutlineMaterial(w,c),S=this.normalNodeMap[c.getId()];if(null==S){var S=this.cloneNode(c,b);this.normalNodeMap[c.getId()]=S}this.setupMatrices(S,n);for(var C in S.groups)wi.g(this,n,s,b,S.groups[C],S);c.renderSelected=!0}}else if("outline.normal"!==w){
var b=this.getOutlineMaterial(w,c);wi.g(this,n,s,b,u,c)}}else c.renderSelected===!1&&(this.renderNodeSelection(n,s,c),c.renderSelected=!0);c.getAlarmState().getPropagateSeverity()&&this.renderAlarmBorder(c)&&this.renderNodeAlarm(n,s,c)}c&&c.setUpdateFlags(!1)}}},cloneNode:function(t,e){var i,n,s=new Ke.Entity,r={vertices:[],uvs:[],faces:[]};for(i=0,n=t.vertices.length;i<n;i++)r.vertices.push(t.vertices[i].clone());for(i=0,n=t.faces.length;i<n;i++)r.faces.push(t.faces[i].clone());for(i=0,n=t.uvs.lenght;i<n;i++){for(var a=uvs[i],o=[],h=0;h<a;h++)o.push(a[h].clone());r.uvs.push(o)}return Ke.Node.prototype.mergeVertices.call(r),Ke.Node.prototype.computeFaceNormals.call(r),Ke.Node.prototype.computeVertexNormals.call(r,!0),s.setPosition(t.getPosition()),s.setScale(t.getScale()),s.setRotation(t.getRotation()),s.setParent(t.getParent()),s._modelViewMatrix=new ti,s._normalMatrix=new $e,s.data=r,s.vertices=r.vertices,s.uvs=r.uvs,s.faces=r.faces,s.material=e,s.primitive=new Ke.Primitive(r),s.setUpdateFlags(!0),oi(s),this.buildNodeBufferData(s),s},buildNodeBufferData:function(t){for(var i in t.groups){var n=t.groups[i];n.id=n.id===e?Ke.Network3D.GroupCache._groupCounter++:n.id,this.groupMap[n.id]===e&&(this.groupMap[n.id]={});var s=this.groupMap[n.id];this.createGroupBuffer(n,s),this.initGroupBuffer(t,n,s),ai.buildGroupBufferData(n,t,this._gl.DYNAMIC_DRAW,!1,t.material,this._gl,s,this)}},needSmoothNormal:function(t,i){var n=i.normalType;return n!=e?n===Ke.NormalTypeSmooth:!!this.needSmoothNormalFunction&&this.needSmoothNormalFunction(t)},renderNodeSelection:function(t,i,n){n.createSelectionCube(this.selectionCube),this.setupMatrices(this.selectionCube,t);var s=this.selectionCube.groups;this.selectionCube.material.needsUpdate=!0;for(var r in s){var a=s[r];a.id=a.id===e?Ke.Network3D.GroupCache._groupCounter++:a.id,this.groupMap[a.id]===e&&(this.groupMap[a.id]={});var o=this.groupMap[a.id];o.__webglVertexBuffer||(this.createGroupBuffer(a,o),this.initGroupBuffer(n,a,o)),this.selectionCube.setUpdateFlags(!0),ai.buildGroupBufferData(a,this.selectionCube,this._gl.DYNAMIC_DRAW,!1,this.selectionCube.material,this._gl,o,this),this.renderGroup(t,[],this.selectionCube.material,a,this.selectionCube)}},renderNodeAlarm:function(t,i,n){n.createPropagateAlarmCube(this.alarmCube),this.setupMatrices(this.alarmCube,t);var s=this.alarmCube.groups;this.alarmCube.material.needsUpdate=!0;for(var r in s){var a=s[r];a.id=a.id===e?Ke.Network3D.GroupCache._groupCounter++:a.id,this.groupMap[a.id]===e&&(this.groupMap[a.id]={});var o=this.groupMap[a.id];o.__webglVertexBuffer||(this.createGroupBuffer(a,o),this.initGroupBuffer(n,a,o)),this.alarmCube.setUpdateFlags(!0),ai.buildGroupBufferData(a,this.alarmCube,this._gl.DYNAMIC_DRAW,!1,this.alarmCube.material,this._gl,o,this),this.renderGroup(t,[],this.alarmCube.material,a,this.alarmCube)}},renderBufferNode:function(t,e,i,n,s,r){if(i.visible!==!1){var a,o;a=this.pm.setProgram(t,e,this._fog,i,n,s),o=a.attributes;var h=s,l=!1,c=i.wireframe?1:0,u=16777215*n._id+2*a.id+c;(u!==this._currentGroupHash||r)&&(this._currentGroupHash=u,l=!0),l&&this.disableAttributes();var d=this._gl,f=h.attributes.index,g=this.bufferNodeMap[s._id];if(f){var _=h.offsets;_.length>1&&(l=!0);for(var p=0,v=_.length;p<v;p++){var m=_[p].index;if(l){var y=h.attributes.position,A=y.itemSize;d.bindBuffer(d.ARRAY_BUFFER,g.position),this.enableAttribute(o.position),d.vertexAttribPointer(o.position,A,d.FLOAT,!1,0,m*A*4);var x=h.attributes.normal;if(o.normal>=0&&x){var w=x.itemSize;d.bindBuffer(d.ARRAY_BUFFER,g.normal),this.enableAttribute(o.normal),d.vertexAttribPointer(o.normal,w,d.FLOAT,!1,0,m*w*4)}var b=h.attributes.uv;if(o.uv>=0&&b){var S=b.itemSize;d.bindBuffer(d.ARRAY_BUFFER,g.uv),this.enableAttribute(o.uv),d.vertexAttribPointer(o.uv,S,d.FLOAT,!1,0,m*S*4)}var C=h.attributes.color;if(o.color>=0&&C){var T=C.itemSize;d.bindBuffer(d.ARRAY_BUFFER,g.color),this.enableAttribute(o.color),d.vertexAttribPointer(o.color,T,d.FLOAT,!1,0,m*T*4)}d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,g.index)}d.drawElements(d.TRIANGLES,_[p].count,d.UNSIGNED_SHORT,2*_[p].start),this.info.render.calls++,this.info.render.vertices+=_[p].count,this.info.render.faces+=_[p].count/3}}else{if(l){var y=h.attributes.position,A=y.itemSize;d.bindBuffer(d.ARRAY_BUFFER,y.buffer),this.enableAttribute(o.position),d.vertexAttribPointer(o.position,A,d.FLOAT,!1,0,0);var x=h.attributes.normal;if(o.normal>=0&&x){var w=x.itemSize;d.bindBuffer(d.ARRAY_BUFFER,x.buffer),this.enableAttribute(o.normal),d.vertexAttribPointer(o.normal,w,d.FLOAT,!1,0,0)}var b=h.attributes.uv;if(o.uv>=0&&b){var S=b.itemSize;d.bindBuffer(d.ARRAY_BUFFER,b.buffer),this.enableAttribute(o.uv),d.vertexAttribPointer(o.uv,S,d.FLOAT,!1,0,0)}var C=h.attributes.color;if(o.color>=0&&C){var T=C.itemSize;d.bindBuffer(d.ARRAY_BUFFER,C.buffer),this.enableAttribute(o.color),d.vertexAttribPointer(o.color,T,d.FLOAT,!1,0,0)}}var y=h.attributes.position;d.drawArrays(d.TRIANGLES,0,y.numItems/3),this.info.render.calls++,this.info.render.vertices+=y.numItems/3,this.info.render.faces+=y.numItems/3/3}}},getOverLoadMaterial:function(t,e){return null},renderGroup:function(t,e,i,n,s){if(null==i&&console.log("material is null"),i.visible!==!1){var r,a=this._gl;if(s instanceof Ke.Entity?r=this.groupMap[n.id]:s instanceof Ke.Line?r=this.lineMap[n._id]:s instanceof Ke.Particle&&(r=this.particleMap[n._id]),null==r)return void(this.debug&&console.error("tempGroup for id:"+(n.id||n._id)+" is null,please check"));var o,h,l,c,u,d;o=this.pm.setProgram(t,e,this._fog,i,n,s),h=o.attributes;var f,g=!1,_=i.wireframe?1:0;if(f=null!=n.id?16777215*n.id+2*o.id+_:n._id+""+(2*o.id+_),f!==this._currentGroupHash&&(this._currentGroupHash=f,g=!0),g&&this.disableAttributes(),h.position>=0&&g&&(a.bindBuffer(a.ARRAY_BUFFER,r.__webglVertexBuffer),this.enableAttribute(h.position),a.vertexAttribPointer(h.position,3,a.FLOAT,!1,0,0)),g){if(n.__webglCustomAttributesList)for(u=0,d=n.__webglCustomAttributesList.length;u<d;u++)c=n.__webglCustomAttributesList[u],h[c.buffer.belongsToAttribute]>=0&&(a.bindBuffer(a.ARRAY_BUFFER,c.buffer),this.enableAttribute(h[c.buffer.belongsToAttribute]),a.vertexAttribPointer(h[c.buffer.belongsToAttribute],c.size,a.FLOAT,!1,0,0));h.color>=0&&(a.bindBuffer(a.ARRAY_BUFFER,r.__webglColorBuffer),this.enableAttribute(h.color),a.vertexAttribPointer(h.color,3,a.FLOAT,!1,0,0)),h.normal>=0&&(a.bindBuffer(a.ARRAY_BUFFER,r.__webglNormalBuffer),this.enableAttribute(h.normal),a.vertexAttribPointer(h.normal,3,a.FLOAT,!1,0,0)),h.uv>=0&&(a.bindBuffer(a.ARRAY_BUFFER,r.__webglUVBuffer),this.enableAttribute(h.uv),a.vertexAttribPointer(h.uv,2,a.FLOAT,!1,0,0)),h.uv2>=0&&(a.bindBuffer(a.ARRAY_BUFFER,r.__webglUV2Buffer),this.enableAttribute(h.uv2),a.vertexAttribPointer(h.uv2,2,a.FLOAT,!1,0,0)),h.lineDistance>=0&&(a.bindBuffer(a.ARRAY_BUFFER,r.__webglLineDistanceBuffer),this.enableAttribute(h.lineDistance),a.vertexAttribPointer(h.lineDistance,1,a.FLOAT,!1,0,0))}s instanceof Ke.Entity?(i.wireframe?(this.setLineWidth(i.wireframeLinewidth),this._gl.lineJoin="round",g&&a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,r.__webglLineBuffer),a.drawElements(a.LINES,r.__webglLineCount,a.UNSIGNED_SHORT,0)):(g&&a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,r.__webglFaceBuffer),a.drawElements(a.TRIANGLES,r.__webglFaceCount,a.UNSIGNED_SHORT,0)),this.info.render.calls++,this.info.render.vertices+=n.__webglFaceCount,this.info.render.faces+=n.__webglFaceCount/3):s instanceof Ke.Line?(l=s.type===Ke.LineStrip?a.LINE_STRIP:a.LINES,this.setLineWidth(i.linewidth),a.drawArrays(l,0,r.__webglLineCount),this.info.render.calls++):s instanceof Ke.Particle?(a.drawArrays(a.POINTS,0,r.__webglParticleCount),this.info.render.calls++,this.info.render.points+=r.__webglParticleCount):s instanceof Ke.Ribbon&&(a.drawArrays(a.TRIANGLE_STRIP,0,n.__webglVertexCount),this.info.render.calls++)}},prepareData:function(){this.maxLightCount=this.dataBox.allocateLights(this._maxLights),this.maxShadows=this.dataBox.allocateShadows(),this.maxPointShadows=this.dataBox.allocatePointShadows()},wrapBillboardMaterial:function(t){t instanceof Ke.Billboard&&t.material&&(t.opaque=t.material.transparent?null:t.material,t.transparent=t.material.transparent?t.material:null)},sortNodesFunc:function(t){if(this.sortNodes&&(null!==this.paintSortFunction||this.sortOpaqueOrderByMaterial)){var e=this;this.sortOpaqueOrderByMaterial?null==this.__st&&(this.__st=function(t,i){e.wrapBillboardMaterial(t),e.wrapBillboardMaterial(t);var n="opaque";if(t[n]&&i[n])return t[n].id-i[n].id;if(!t[n]&&i[n])return-1;if(t[n]&&!i[n])return 1;var s=t.node?t.node:t,r=i.node?i.node:i;return s.z=t.z,r.z=i.z,e.paintSortFunction?e.paintSortFunction(s,r):void 0}):null==this.__st&&(this.__st=function(t,i){var n=t.node?t.node:t,s=i.node?i.node:i;if(n.z=t.z,s.z=i.z,e.paintSortFunction)return e.paintSortFunction(n,s)}),t.sort(this.__st)}return t},renderNode:function(t,e){this.setupMatrices(t),t instanceof Ke.Entity&&renderEntity(t)},paintTopCanvas:function(){var t=this._topCanvas.getContext("2d");t.clearRect(0,0,this._topCanvas.width,this._topCanvas.height);var e=this.areaPickingRect;e&&(t.beginPath(),t.lineStyle="#FFffff",t.rect(e.x,e.y,e.w,e.h),t.stroke()),this.renderLicense()},setBackgroundImage:function(t){if("string"==typeof t){var e=new Image;t.startsWith("data:image")||(e.crossOrigin="use-credentials"),e.src=t,this._backgroundImage=e;var i=this;e.onload=function(){i.dirtyNetwork()}}else this._backgroundImage=t,this.dirtyNetwork()},paintBottom:function(t){var e=t.getContext("2d");e.clearRect(0,0,t.width,t.height);var i=this._backgroundImage;i instanceof Image&&i.height&&e.drawImage(i,0,0,t.width,t.height)},initBufferNode:function(t){if(!this.bufferNodeMap[t._id]){var e={};this.bufferNodeMap[t._id]=e;var i,n,s,r=this._gl;for(i in t.attributes)s="index"===i?r.ELEMENT_ARRAY_BUFFER:r.ARRAY_BUFFER,n=t.attributes[i],e[i]=r.createBuffer(),r.bindBuffer(s,e[i]),r.bufferData(s,n.array,r.STATIC_DRAW)}},setBufferNodeData:function(t,i,n){var s=this.bufferNodeMap[t._id],r=t.attributes,a=r.index,o=r.position,h=r.normal,l=r.uv,c=r.color,u=r.tangent,d=this._gl;if(t.elementsNeedUpdate&&a!==e&&(d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,s.index),d.bufferData(d.ELEMENT_ARRAY_BUFFER,a.array,i)),t.verticesNeedUpdate&&o!==e&&(d.bindBuffer(d.ARRAY_BUFFER,s.position),d.bufferData(d.ARRAY_BUFFER,o.array,i)),t.normalsNeedUpdate&&h!==e&&(d.bindBuffer(d.ARRAY_BUFFER,s.normal),d.bufferData(d.ARRAY_BUFFER,h.array,i)),t.uvsNeedUpdate&&l!==e&&(d.bindBuffer(d.ARRAY_BUFFER,s.uv),d.bufferData(d.ARRAY_BUFFER,l.array,i)),t.colorsNeedUpdate&&c!==e&&(d.bindBuffer(d.ARRAY_BUFFER,s.color),d.bufferData(d.ARRAY_BUFFER,c.array,i)),t.tangentsNeedUpdate&&u!==e&&(d.bindBuffer(d.ARRAY_BUFFER,s.tangent),d.bufferData(d.ARRAY_BUFFER,u.array,i)),n)for(var f in t.attributes);},initGroupBuffer:function(t,i,n,s){var r=i.faces3,a=i.faces4,o=3*r.length+4*a.length,h=1*r.length+2*a.length,l=3*r.length+4*a.length,c=ai.getMaterial(t,i.materialIndex?i.materialIndex:0),u=c.needUV(),d=c.getNormalType(),f=c.isVertexColor();if(n.__vertexArray=new Float32Array(3*o),d&&(n.__normalArray=new Float32Array(3*o)),!s){f&&(n.__colorArray=new Float32Array(3*o)),u&&(n.__uvArray=new Float32Array(2*o),t.uv2s&&(n.__uv2Array=new Float32Array(2*o))),n.__faceArray=new Uint16Array(3*h),n.__lineArray=new Uint16Array(2*l);var g,_;if(i.numMorphTargets)for(n.__morphTargetsArrays=[],g=0,_=i.numMorphTargets;g<_;g++)n.__morphTargetsArrays.push(new Float32Array(3*o));if(i.numMorphNormals)for(n.__morphNormalsArrays=[],g=0,_=i.numMorphNormals;g<_;g++)n.__morphNormalsArrays.push(new Float32Array(3*o));if(n.__webglFaceCount=3*h,n.__webglLineCount=2*l,c.attributes){n.__webglCustomAttributesList===e&&(n.__webglCustomAttributesList=[]);for(var p in c.attributes){var v=c.attributes[p],m={};for(var y in v)m[y]=v[y];if(!m.__webglInitialized||m.createUniqueBuffers){m.__webglInitialized=!0;var A=1;"v2"===m.type?A=2:"v3"===m.type?A=3:"v4"===m.type?A=4:"c"===m.type&&(A=3),m.size=A,m.array=new Float32Array(o*A),m.buffer=_gl.createBuffer(),m.buffer.belongsToAttribute=p,v.needsUpdate=!0,m.__original=v}n.__webglCustomAttributesList.push(m)}}n.__inittedArrays=!0}},createLineBuffers:function(t){null==this.lineMap[t._id]&&(this.lineMap[t._id]={});var e=this.lineMap[t._id],i=this._gl;e.__webglVertexBuffer=i.createBuffer(),e.__webglColorBuffer=i.createBuffer(),e.__webglLineDistanceBuffer=i.createBuffer(),this.info.memory.geometries++},initLineBuffers:function(t){null==this.lineMap[t._id]&&(this.lineMap[t._id]={});var e=this.lineMap[t._id],i=t.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__lineDistanceArray=new Float32Array(1*i),e.__webglLineCount=i},createParticleBuffers:function(t){null==this.particleMap[t._id]&&(this.particleMap[t._id]={});var e=this.particleMap[t._id],i=this._gl;e.__webglVertexBuffer=i.createBuffer(),e.__webglColorBuffer=i.createBuffer(),e.__webglNormalBuffer=i.createBuffer(),this.info.memory.geometries++},initParticleBuffers:function(t){null==this.particleMap[t._id]&&(this.particleMap[t._id]={});var e=this.particleMap[t._id],i=t.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__normalArray=new Float32Array(3*i),e.__sortArray=[],e.__webglParticleCount=i},createGroupBuffer:function(t,e){var i=this._gl;e.__webglVertexBuffer=i.createBuffer(),e.__webglNormalBuffer=i.createBuffer(),e.__webglTangentBuffer=i.createBuffer(),e.__webglColorBuffer=i.createBuffer(),e.__webglUVBuffer=i.createBuffer(),e.__webglUV2Buffer=i.createBuffer(),e.__webglSkinIndicesBuffer=i.createBuffer(),e.__webglSkinWeightsBuffer=i.createBuffer(),e.__webglFaceBuffer=i.createBuffer(),e.__webglLineBuffer=i.createBuffer(),this.info.memory.geometries++},setRenderTarget:function(t){var i=t instanceof Si,n=this._gl;if(t&&!t.__webglFramebuffer){t.depthBuffer===e&&(t.depthBuffer=!0),t.stencilBuffer===e&&(t.stencilBuffer=!0),t.__webglTexture=n.createTexture(),this.info.memory.textures++;var s=yi.isPowerOfTwo,r=s(t.width)&&s(t.height),a=yi.paramToGL(t.format,n),o=yi.paramToGL(t.type,n);t.type==Ke.FloatType;var h=a;if(i){t.__webglFramebuffer=[],t.__webglRenderbuffer=[],n.bindTexture(n.TEXTURE_CUBE_MAP,t.__webglTexture),this.pm.setTextureParameters(n.TEXTURE_CUBE_MAP,t,r);for(var l=0;l<6;l++)t.__webglFramebuffer[l]=n.createFramebuffer(),t.__webglRenderbuffer[l]=n.createRenderbuffer(),n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,h,t.width,t.height,0,a,o,null),this.setupFrameBuffer(t.__webglFramebuffer[l],t,n.TEXTURE_CUBE_MAP_POSITIVE_X+l),this.setupRenderBuffer(t.__webglRenderbuffer[l],t);r&&n.generateMipmap(n.TEXTURE_CUBE_MAP)}else t.__webglFramebuffer=n.createFramebuffer(),t.shareDepthFrom?t.__webglRenderbuffer=t.shareDepthFrom.__webglRenderbuffer:t.__webglRenderbuffer=n.createRenderbuffer(),n.bindTexture(n.TEXTURE_2D,t.__webglTexture),this.pm.setTextureParameters(n.TEXTURE_2D,t,r),n.texImage2D(n.TEXTURE_2D,0,h,t.width,t.height,0,a,o,null),this.setupFrameBuffer(t.__webglFramebuffer,t,n.TEXTURE_2D),t.shareDepthFrom?t.depthBuffer&&!t.stencilBuffer?n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t.__webglRenderbuffer):t.depthBuffer&&t.stencilBuffer&&n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,t.__webglRenderbuffer):this.setupRenderBuffer(t.__webglRenderbuffer,t),r&&n.generateMipmap(n.TEXTURE_2D);i?n.bindTexture(n.TEXTURE_CUBE_MAP,null):n.bindTexture(n.TEXTURE_2D,null),n.bindRenderbuffer(n.RENDERBUFFER,null),n.bindFramebuffer(n.FRAMEBUFFER,null)}var c,u,d,f,g;t?(c=i?t.__webglFramebuffer[t.activeCubeFace]:t.__webglFramebuffer,u=t.width,d=t.height,f=0,g=0):(c=null,u=this._viewportWidth,d=this._viewportHeight,f=this._viewportX,g=this._viewportY),c!==this._currentFramebuffer&&(n.bindFramebuffer(n.FRAMEBUFFER,c),n.viewport(f,g,u,d),this._currentFramebuffer=c),this._currentWidth=u,this._currentHeight=d},setupFrameBuffer:function(t,e,i){var n=this._gl;n.bindFramebuffer(n.FRAMEBUFFER,t),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,i,e.__webglTexture,0)},setupRenderBuffer:function(t,e){var i=this._gl;i.bindRenderbuffer(i.RENDERBUFFER,t),e.depthBuffer&&!e.stencilBuffer?(i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,t)):e.depthBuffer&&e.stencilBuffer?(i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,t)):i.renderbufferStorage(i.RENDERBUFFER,i.RGBA4,e.width,e.height)},setLineWidth:function(t){t!==this._oldLineWidth&&(this._gl.lineWidth&&this._gl.lineWidth(t),this._oldLineWidth=t)},setupMatrices:function(t,e){t.fixSize(e),t.updateWorldMatrix(),t._modelViewMatrix.multiplyMatrices(e.worldMatrixInverse,t.worldMatrix),t._normalMatrix.getNormalMatrix(t._modelViewMatrix)},setDefaultGLState:function(){var t=this._gl,e=new Ke.Color(this._clearColor);t.clearColor(e.r,e.g,e.b,this._clearAlpha),t.clearDepth(1),ii.isIE||t.clearStencil(0),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.frontFace(t.CCW),t.cullFace(t.BACK),t.enable(t.CULL_FACE),t.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA)},clear:function(t,i,n){var s=this._gl,r=0;(t===e||t)&&(r|=s.COLOR_BUFFER_BIT),(i===e||i)&&(r|=s.DEPTH_BUFFER_BIT),(n===e||n)&&(r|=s.STENCIL_BUFFER_BIT),s.clear(r)},setGLFaces:function(t){var e=this._gl,i=t.side===Ke.DoubleSide,n=t.side===Ke.BackSide;this._oldDoubleSided!==i&&(i?e.disable(e.CULL_FACE):e.enable(e.CULL_FACE),this._oldDoubleSided=i),this._oldFlipSided!==n&&(n?e.frontFace(e.CW):e.frontFace(e.CCW),this._oldFlipSided=n)},getView:function(){return this._canvas},getRootView:function(){return this._rootView},setBlending:function(t,e,i,n){wi.setBlending(t,e,i,n,this)},setDepthTest:function(t){wi.setDepthTest(t,this)},setStencilTest:function(t){this._oldStencilTest!=t&&(t?this._gl.enable(this._gl.STENCIL_TEST):this._gl.disable(this._gl.STENCIL_TEST),this._oldStencilTest=t)},setDepthWrite:function(t){wi.setDepthWrite(t,this)},getLineWidthRange:function(){var t=this._gl;return t.getParameter(t.ALIASED_LINE_WIDTH_RANGE)},setTexture:function(t,e){this.pm.setTexture(t,e)},disableAttributes:function(){for(var t in this._enabledAttributes)this._enabledAttributes[t]&&(this._gl.disableVertexAttribArray(t),this._enabledAttributes[t]=!1)},enableAttribute:function(t){this._enabledAttributes[t]||(this._gl.enableVertexAttribArray(t),this._enabledAttributes[t]=!0)},adjustRootViewBounds:function(t,e){var i=this._rootView;i.style.width=t+"px",i.style.height=e+"px"},adjustCanvasBounds:function(t,e,i,n,s){t.width=e*this.devicePixelRatio,t.height=i*this.devicePixelRatio,t.style.margin="0px",t.style.padding="0px",t.style.width=e+"px",t.style.height=i+"px"},adjustBounds:function(t,e,i,n){var s=this.getView();if(this.adjustRootViewBounds(t,e,i,n),this.adjustCanvasBounds(s,t,e,i,n),this.adjustCanvasBounds(this._topCanvas,t,e,i,n),this.adjustCanvasBounds(this._bottomCanvas,t,e,i,n),this.adjustCallback(t,e,i,n),this.setViewport(0,0,s.width,s.height),this.autoUpdateCameraAspect&&0!==e){var r=this._camera;r.aspect=t/e,r.updateProjectionMatrix(),this._currentCamera=null}this.dirtyNetwork()},adjustCallback:function(){},setViewport:function(t,i,n,s){this._viewportX=t!==e?t:0,this._viewportY=i!==e?i:0,this._viewportWidth=n!==e?n:_canvas.width,this._viewportHeight=s!==e?s:_canvas.height,this._gl.viewport(this._viewportX,this._viewportY,this._viewportWidth,this._viewportHeight)},setShowAxis:function(t){this.showAxis!==t&&(this.showAxis=t,this.showAxis&&(this.helperBox.contains(this.axis)||this.helperBox.addByDescendant(this.axis)),this.axis._visible=t,this.dirtyNetwork())},setShowAxisText:function(t){this.axis.showAxisText(t),this.dirtyNetwork()},setAxisSize:function(t){this.axis.setSize(t)},onSelect:function(t){null!=this.onSelectFunction&&this.onSelectFunction(t)},setOnSelectFunction:function(t){this.onSelectFunction=t},isSelectable:function(t){return!!t.isSelectable()&&(!this.selectableFunction||this.selectableFunction(t))},setSelectableFunction:function(t){this.selectableFunction=t},setRenderSelectFunction:function(t){this.renderSelectFunction=t},renderSelect:function(t){return!this.renderSelectFunction||this.renderSelectFunction(t)},renderAlarmBorder:function(t){return!this.renderAlarmBorderFunction||this.renderAlarmBorderFunction(t)},selectable:function(t){return t.element.isVisible()&&this.isSelectable(t.element)&&this.getDataBox().getSelectionModel().isSelectable(t.element)},editable:function(t){var e=this.selectable(t);return e&&null!=this.editableFunction?this.editableFunction(t.element):e},getFirstSelectElement:function(t){if(null==t)return null;for(var e,i=0;i<t.length;){var n=t[i];if(this.selectable(n)){e=n.element;break}i++}return e},getFirstEditElement:function(t){if(null==t)return null;for(var e,i=0;i<t.length;){var n=t[i];if(this.editable(n)){e=n.element;break}i++}return e},toImageData:function(t,e,i,n){return this.dirtyNetwork(),this.render(),t=t||"PNG",t.toUpperCase(),"PNG"===t?ni.saveAsPNG(this.getView(),e,!1,i,n):"JPEG"===t?ni.saveAsJPEG(this.getView(),e,!1,i,n):"BMP"===t?ni.saveAsBMP(this.getView(),e,!1,i,n):void console.log("Not surport type "+t)},getPickingByEvent:function(t){var e=this._camera,i={},n=this.getView(),s=n.getBoundingClientRect(),r=t.clientX,a=t.clientY;t.touches&&t.touches.length&&(r=t.touches[0].pageX,a=t.touches[0].pageY);var o=(r-s.left)/s.width,h=(a-s.top)/s.height;i.x=2*o-1,i.y=2*-h+1;var l=new Ke.Vec3(i.x,i.y,.5);this.projector.unprojectVector(l,e);var c=null;if(e instanceof Ke.PerspectiveCamera)c=new Ke.Picking(e._position,l.sub(e._position).normalize(),e.up,null,null,this);else{var u=l.clone().sub(e._position),d=e.getTarget().clone().sub(e.p()).normalize(),f=d.multiplyScalar(u.clone().dot(d)),g=u.sub(f),_=(new Je).addVectors(e._position,g);c=new Ke.Picking(_,l.sub(_).normalize(),e.up,null,null,this)}return c},getElementsByMouseEvent:function(t,e,i){var n=this.getPickingByEvent(t),s=new ci;s.addAll(this.dataBox.getNodes()),s.addAll(this.dataBox.getBillboards()),i&&s.addAll(new ci(this.alarmBillboards));var r=n.intersectObjects(s.toArray(),!1,e);return r},getElementByScreenPoint:function(t,e,i){var n={},s=this.getView(),r=this._camera,a=s.getBoundingClientRect();t.x&&(i=e,e=t.y,t=t.x),t/=a.width,e/=a.height,n.x=2*t-1,n.y=2*-e+1;var o=new Ke.Vec3(n.x,n.y,.5);this.projector.unprojectVector(o,r);var h=new Ke.Picking(r._position,o.sub(r._position).normalize(),r.up,null,null,this),l=new ci;l.addAll(this.dataBox.getNodes()),l.addAll(this.dataBox.getBillboards());var c=h.intersectObjects(l.toArray(),!1,i);return c},getFirstElementByMouseEvent:function(t,e,i,n){var s=this.getElementsByMouseEvent(t,e,n);if(s.length)for(var r=0;r<s.length;r++){var a=s[r],o=a.element;if(null==i||i.call(null,o))return a}return null},getUnProjectVector:function(t){var e={},i=this.getView().getBoundingClientRect(),n=t.x/i.width,s=t.y/i.height;e.x=2*n-1,e.y=2*-s+1;var r=new Ke.Vec3(e.x,e.y,.5);return this.projector.unprojectVector(r,this._camera),r},getFrustumByBounding:function(t){var e=t,i=this.getUnProjectVector(new Qe(e.x,e.y)),n=this.getUnProjectVector(new Qe(e.x+e.w,e.y)),s=this.getUnProjectVector(new Qe(e.x,e.y+e.h)),r=this.getUnProjectVector(new Qe(e.x+e.w,e.y+e.h)),a=this.getNearFarPoints(i),o=this.getNearFarPoints(n),h=this.getNearFarPoints(s),l=this.getNearFarPoints(r),c=new Ke.math.Plane,u=new Ke.math.Plane,d=new Ke.math.Plane,f=new Ke.math.Plane,g=new Ke.math.Plane,_=new Ke.math.Plane;c.setFromCoplanarPoints(a[0],o[0],h[0]),u.setFromCoplanarPoints(a[0],a[1],o[0]),d.setFromCoplanarPoints(a[0],h[0],a[1]),f.setFromCoplanarPoints(o[0],o[1],l[0]),g.setFromCoplanarPoints(h[0],l[0],h[1]),_.setFromCoplanarPoints(a[1],h[1],o[1]);var p=new Ke.Frustum(c,u,d,f,g,_);return p.setPoints([a[0],o[0],h[0],l[0],a[1],o[1],h[1],l[1]]),p},getNearFarPoints:function(t){var e=this._camera,i=t.sub(e._position).normalize(),n=e.target.clone().sub(e._position),s=i.angleTo(n),r=e.getNear()/Math.acos(s),a=e.getFar()/Math.acos(s),o=e._position.clone().add(i.clone().multiplyScalar(r)),h=e._position.clone().add(i.clone().multiplyScalar(a));return[o,h]},getSpacePointOnPlane:function(t,e){var i={},n=this.getView(),s=this._camera,r=n.getBoundingClientRect(),a=t.clientX,o=t.clientY;t.touches&&t.touches.length&&(a=t.touches[0].pageX,o=t.touches[0].pageY);var h=(a-r.left)/r.width,l=(o-r.top)/r.height;i.x=2*h-1,i.y=2*-l+1;var c=new Ke.Vec3(i.x,i.y,.5);this.projector.unprojectVector(c,s);var u=s._position,d=c.sub(s._position).normalize(),f=new Ke.Ray(u,d),g=f.distanceToPlane(e);if(g<0||Math.abs(g)<Ke.Picking.prototype.precision)return null;var _=f.at(g);return _},getElementsByBounding:function(t,e,i){var n=new ci;n.addAll(this.dataBox.getNodes()),n.addAll(this.dataBox.getBillboards());var s,r=this.getFrustumByBounding(t),a=[],o=new Je,h=this._camera;return n.forEach(function(t){if(t instanceof Ke.Billboard){o.setFromMatrixPosition(t.worldMatrix);var e=t.material,n=e.alignment;s=new Ke.Plane(1,1),(n.x||n.y)&&(s.setPosition(n.x,n.y,0),s=Ke.Utils.transformElement(s,!0)),s.setPosition(o);var l=(new Je).getScaleFromMatrix(t.worldMatrix);s.setScale(l.x,l.y,1);var c=h.getTarget().clone(),u=h.getPosition();c.sub(u);var d=s.getPosition().clone();e&&e.vertical&&(c.y=0),d.sub(c),s.lookAt(d),s.updateWorldMatrix(!0),r.intersectsObjectAccurate(s,i)&&a.push({element:t})}else t instanceof Ke.Line?r.intersectsObjectAccurate(t,i)&&a.push({element:t}):r.intersectsObjectAccurate(t,i)&&a.push({element:t})}),a},getViewPosition:function(t){var e=new Je;e=this.projector.projectVector(t,this._camera,e),e.x=e.x/2+.5,e.y=-e.y/2+.5;var i={x:this._canvas.width*e.x/this.devicePixelRatio,y:this._canvas.height*e.y/this.devicePixelRatio,h:this._canvas.height};return i},setInteractions:function(t){var e,i,n=this._interactions;if(n)for(e=0;e<n.length;e++)i=n[e],i.tearDown();if(this._interactions=t,t)for(e=0;e<t.length;e++)i=t[e],i.setUp()},getDefaultInteraction:function(){if(this._interactions&&this._interactions.length>0)for(var t=0;t<this._interactions.length;t++){var e=this._interactions[t];if(e instanceof Ke.DefaultInteraction)return e}return null},getInteractions:function(){return this._interactions},fireInteractionEvent:function(t){this._interactionDispatcher.fire(t)},addInteractionListener:function(t,e,i){this._interactionDispatcher.add(t,e,i)},removeInteractionListener:function(t,e){this._interactionDispatcher.remove(t,e)},dispose:function(){},setRenderInterval:function(t){(yi.isNaN(t)||t<=5)&&(t=5),this._renderInterval=t},_computeNetworkBoundingBox:function(){function t(t,e){t.applyMatrix4(e),o.push(t)}var e,i,n,s,r=this.getDataBox().size(),a=this.getDataBox().getDatas(),o=[];for(e=0;e<r;e++)if(i=a.get(e),i instanceof Ke.Node){n=i.getBoundingBox(),s=i.worldMatrix;var h=n.min,l=n.max;t(h.clone(),s),t(l.clone(),s),t(new Je(h.x,h.y,l.z),s),t(new Je(h.x,l.y,h.z),s),t(new Je(l.x,h.y,h.z),s),t(new Je(l.x,l.y,h.z),s),t(new Je(l.x,h.y,l.z),s),t(new Je(h.x,l.y,l.z),s)}if(o.length<=1)return null;var c=new Ke.BoundingBox;return c.setFromPoints(o),c},getNetworkBoundingBox:function(){return null==this.boundingBox&&(this.boundingBox=this._computeNetworkBoundingBox()),this.boundingBox},getSelectStyle:function(t){return t.getSelectStyle()},setZoomStandard:function(t){this._zoomStandard=t},getZoomStandard:function(){return this._zoomStandard},zoom:function(t,e){e=e||this._zoomStandard;var i=this._camera;i.zoom(t,e)},zoomIn:function(t){this.zoom(.9,t)},zoomOut:function(t){this.zoom(1.1,t)},move:function(t,e){var i=(new mono.Vec3((-t),(-e),0),this._camera.t()),n=this._camera.p();this._camera.translateX(-t),this._camera.translateY(-e);var s=this._camera.p();i.add(s.clone().sub(n)),this._camera.lookAt(i)},moveLeft:function(t){t=t||50,this.move(-t,0)},moveRight:function(t){t=t||50,this.move(t,0)},moveUp:function(t){t=t||30,this.move(0,t)},moveDown:function(t){t=t||30,this.move(0,-t)},zoomEstimateOverview:function(t){var e=this.getNetworkBoundingBox();if(null!=e){var i=e.center(),n=new Je(0,e.max.y-e.min.y,e.max.z-e.min.z),s=new Je(e.max.x-e.min.x,0,0,0),r=n.clone();r.length()<s.length()&&(r=s.clone());var a;if(t){var o=n.length();n.y=n.z*Math.tan(t/180*Math.PI),n.setLength(o)}a=(new Je).addVectors(i,n.multiplyScalar(.5));var h=this._camera.fov,l=(this._camera.aspect,r.length()/2/Math.tan(h*Math.PI/180));a.add(n.normalize().multiplyScalar(l)),this._camera.setPosition(a),this._camera.lookAt(i),this._overviewDistance=this._camera.getDistance()}}}),Ke.Network3DId=0,Ke.Network3D.GroupCache={_groupCounter:0};var Ci=function(){function t(){if(c===w){var t=new $RenderObject;return x.push(t),w++,c++,t}return x[c++]}function i(){if(d===S){var t=new $RenderVertex;return b.push(t),S++,d++,t}return b[d++]}function n(){if(g===T){var t=new Ke.RenderFace3;return C.push(t),T++,g++,t}return C[g++]}function s(){if(_===L){var t=new Ke.RenderFace4;return E.push(t),L++,_++,t}return E[_++]}function r(){if(v===P){var t=new Ke.RenderLine;return M.push(t),P++,v++,t}return M[v++]}function a(){if(y===I){var t=new Ke.RenderableParticle;return k.push(t),I++,y++,t}return k[y++]}function o(t,e){return e.z-t.z}function h(t,e){var i=0,n=1,s=t.z+t.w,r=e.z+e.w,a=-t.z+t.w,o=-e.z+e.w;return s>=0&&r>=0&&a>=0&&o>=0||!(s<0&&r<0||a<0&&o<0)&&(s<0?i=Math.max(i,s/(s-r)):r<0&&(n=Math.min(n,s/(s-r))),a<0?i=Math.max(i,a/(a-o)):o<0&&(n=Math.min(n,a/(a-o))),!(n<i)&&(t.lerp(e,i),e.lerp(t,1-n),!0))}var l,c,u,d,f,g,_,p,v,m,y,A,x=[],w=0,b=[],S=0,C=[],T=0,E=[],L=0,M=[],P=0,k=[],I=0,R={objects:[],sprites:[],lights:[],elements:[]},D=new Ke.Vec3,B=new Ke.Vec4,N=new Ke.BoundingBox(new Ke.Vec3((-1),(-1),(-1)),new Ke.Vec3(1,1,1)),z=new Ke.BoundingBox,O=new Array(3),F=new Array(4),V=new Ke.Mat4,U=new Ke.Mat4,H=new Ke.Mat4,W=new Ke.Mat3,X=new Ke.Mat3,G=new Ke.Vec3,Z=new Ke.Frustum,Y=new Ke.Vec4,j=new Ke.Vec4;this.projectVector=function(t,i,n){return i.worldMatrixInverse.getInverse(i.worldMatrix),U.multiplyMatrices(i.projectionMatrix,i.worldMatrixInverse),n===e?t.applyProjection(U):(n.copy(t),n.applyProjection(U))},this.unprojectVector=function(t,e){return e.projectionMatrixInverse.getInverse(e.projectionMatrix),U.multiplyMatrices(e.worldMatrix,e.projectionMatrixInverse),t.applyProjection(U)},this.pickingRay=function(t,e){t.z=-1;var i=new Ke.Vec3(t.x,t.y,1);return this.unprojectVector(t,e),this.unprojectVector(i,e),i.sub(t).normalize(),new Ke.Picking(t,i)};var q=function(e,i){c=0,R.objects.length=0,R.sprites.length=0,R.lights.length=0;var n=function(e){var i;i=e instanceof Ke.DataBox?e.getRoots():e.getChildren(),i=i.toList();for(var s=0,r=i.size();s<r;s++){var a=i.get(s);a.isSelected()&&a instanceof Ke.Node&&(i.add(a.createCanvasSelectionCube(),s),s++)}for(var s=0,r=i.size();s<r;s++){var a=i.get(s);a._visible!==!1&&(a instanceof Ke.Light?R.lights.push(a):a instanceof Ke.Entity||a instanceof Ke.Line?a.frustumCulled!==!1&&Z.intersectsObject(a)!==!0||(l=t(),l.object=a,null!==a.renderDepth?l.z=a.renderDepth:(D.copy(a.worldMatrix.getPosition()),D.applyProjection(U),l.z=D.z),R.objects.push(l)):a instanceof Ke.Billboard||a instanceof Ke.Particle?(l=t(),l.object=a,null!==a.renderDepth?l.z=a.renderDepth:(D.copy(a.worldMatrix.getPosition()),D.applyProjection(U),l.z=D.z),R.sprites.push(l)):(l=t(),l.object=a,null!==a.renderDepth?l.z=a.renderDepth:(D.copy(a.worldMatrix.getPosition()),D.applyProjection(U),l.z=D.z),R.objects.push(l)),n(a))}};return n(e),i===!0&&R.objects.sort(o),R};this.projectDataBox=function(t,l,c,x){var w,S,C,T,E,L,M,P,k,I,D,K,Q,J,$,tt,et,it,nt,st,rt,at,ot,ht=!1;g=0,_=0,v=0,y=0,R.elements.length=0;for(var lt=0;lt<t.getRoots().size();lt++){var ct=t.getRoots().get(lt);ct.updateWorldMatrix()}for(l.parent===e&&l.updateWorldMatrix(!0,!1),V.copy(l.worldMatrixInverse.getInverse(l.worldMatrix)),U.multiplyMatrices(l.projectionMatrix,V),X.getInverse(V),X.transpose(),Z.setFromMatrix(U),R=q(t,c),w=0,S=R.objects.length;w<S;w++)if(D=R.objects[w].object,A=D.worldMatrix,d=0,D instanceof Ke.Entity){for(K=D,Q=K.vertices,J=K.faces,et=K.uvs,W.getInverse(A),W.transpose(),at=D.material instanceof Ke.ArrayMaterial,
ot=at===!0?D.material:null,C=0,T=Q.length;C<T;C++)u=i(),u.positionWorld.copy(Q[C]).applyMatrix4(A),u.positionScreen.copy(u.positionWorld).applyMatrix4(U),u.positionScreen.x/=u.positionScreen.w,u.positionScreen.y/=u.positionScreen.w,u.positionScreen.z/=u.positionScreen.w,u.visible=!(u.positionScreen.x<-1||u.positionScreen.x>1||u.positionScreen.y<-1||u.positionScreen.y>1||u.positionScreen.z<-1||u.positionScreen.z>1);for(E=0,L=J.length;E<L;E++){$=J[E];var ut=at===!0?ot.materials[$.materialIndex]:D.material;if(ut!==e){var dt=ut.side;if($ instanceof Ke.Face3){if(it=b[$.a],nt=b[$.b],st=b[$.c],O[0]=it.positionScreen,O[1]=nt.positionScreen,O[2]=st.positionScreen,it.visible!==!0&&nt.visible!==!0&&st.visible!==!0&&!N.isIntersectionBox(z.setFromPoints(O)))continue;if(ht=(st.positionScreen.x-it.positionScreen.x)*(nt.positionScreen.y-it.positionScreen.y)-(st.positionScreen.y-it.positionScreen.y)*(nt.positionScreen.x-it.positionScreen.x)<0,dt!==Ke.DoubleSide&&ht!==(dt===Ke.FrontSide))continue;f=n(),f.v1.copy(it),f.v2.copy(nt),f.v3.copy(st)}else if($ instanceof Ke.Face4){if(it=b[$.a],nt=b[$.b],st=b[$.c],rt=b[$.d],F[0]=it.positionScreen,F[1]=nt.positionScreen,F[2]=st.positionScreen,F[3]=rt.positionScreen,it.visible!==!0&&nt.visible!==!0&&st.visible!==!0&&rt.visible!==!0&&!N.isIntersectionBox(z.setFromPoints(F)))continue;if(ht=(rt.positionScreen.x-it.positionScreen.x)*(nt.positionScreen.y-it.positionScreen.y)-(rt.positionScreen.y-it.positionScreen.y)*(nt.positionScreen.x-it.positionScreen.x)<0||(nt.positionScreen.x-st.positionScreen.x)*(rt.positionScreen.y-st.positionScreen.y)-(nt.positionScreen.y-st.positionScreen.y)*(rt.positionScreen.x-st.positionScreen.x)<0,dt!==Ke.DoubleSide&&ht!==(dt===Ke.FrontSide))continue;f=s(),f.v1.copy(it),f.v2.copy(nt),f.v3.copy(st),f.v4.copy(rt)}for(f.normalModel.copy($.normal),ht===!1&&(dt===Ke.BackSide||dt===Ke.DoubleSide)&&f.normalModel.negate(),f.normalModel.applyMatrix3(W).normalize(),f.normalModelView.copy(f.normalModel).applyMatrix3(X),f.centroidModel.copy($.centroid).applyMatrix4(A),tt=$.vertexNormals,M=0,P=tt.length;M<P;M++){var ft=f.vertexNormalsModel[M];ft.copy(tt[M]),ht===!1&&(dt===Ke.BackSide||dt===Ke.DoubleSide)&&ft.negate(),ft.applyMatrix3(W).normalize();var gt=f.vertexNormalsModelView[M];gt.copy(ft).applyMatrix3(X)}f.vertexNormalsLength=tt.length;var _t=et[E];for(k=0,I=_t.length;k<I;k++)f.uvs[0][k]=_t[k];f.color=$.color,f.material=ut,G.copy(f.centroidModel).applyProjection(U),f.z=G.z,R.elements.push(f)}}}else if(D instanceof Ke.Line){H.multiplyMatrices(U,A),Q=D.vertices,it=i(),it.positionScreen.copy(Q[0]).applyMatrix4(H);var pt=D.type===Ke.LinePieces?2:1;for(C=1,T=Q.length;C<T;C++)it=i(),it.positionScreen.copy(Q[C]).applyMatrix4(H),(C+1)%pt>0||(nt=b[d-2],Y.copy(it.positionScreen),j.copy(nt.positionScreen),h(Y,j)===!0&&(Y.multiplyScalar(1/Y.w),j.multiplyScalar(1/j.w),p=r(),p.v1.positionScreen.copy(Y),p.v2.positionScreen.copy(j),p.z=Math.max(Y.z,j.z),p.material=D.material,R.elements.push(p)))}for(w=0,S=R.sprites.length;w<S;w++)D=R.sprites[w].object,A=D.worldMatrix,D instanceof Ke.Particle&&(B.set(A.elements[12],A.elements[13],A.elements[14],1),B.applyMatrix4(U),B.z/=B.w,B.z>0&&B.z<1&&(m=a(),m.object=D,m.x=B.x/B.w,m.y=B.y/B.w,m.z=B.z,m.rotation=D.rotation.z,m.scale.x=D.scale.x*Math.abs(m.x-(B.x+l.projectionMatrix.elements[0])/(B.w+l.projectionMatrix.elements[12])),m.scale.y=D.scale.y*Math.abs(m.y-(B.y+l.projectionMatrix.elements[5])/(B.w+l.projectionMatrix.elements[13])),m.material=D.material,R.elements.push(m)));return x===!0&&R.elements.sort(o),R}};Ke.Projector=Ci,Ke.Billboard=function(t){null!=t&&null!=t.id?this._id=t.id:this._id=t,Ke.Element.call(this,this._id),this.material=new Ke.BillboardMaterial,this.rotation3d=this._rotation,this.rotation=0,this.vertices=[new Je((-.5),(-.5),0),new Je(.5,(-.5),0),new Je(.5,.5,0),new Je((-.5),.5,0)]},Ke.extend(Ke.Billboard,Ke.Element,{constructor:Ke.Billboard,className:"TGL.Billboard",updateMatrix:function(){this.matrix.setPosition(this._position),this.rotation=this._rotation.z,this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(1!==this._scale.x||1!==this._scale.y)&&this.matrix.scale(this._scale),this.matrixWorldNeedsUpdate=!0},clone:function(t){return t===e&&(t=new Ke.Billboard(this.material)),Ke.Element.prototype.clone.call(this,t),t},setMaterialStyle:function(t,e){var i=this.material.clone();t=t.substr(t.indexOf(".")+1),this._A97(i,t,e);var n=i.getUniqueCode(),s=Ji.getMaterial(n);null!=s?(Ji.unUseMaterial(this.material),this.material=s,Ji.useMaterial(s)):(Ji.unUseMaterial(this.material),Ji.setMaterial(n,i),this.material=i)}}),Ke.ShaderSprite={sprite:{vertexShader:["uniform int useScreenCoordinates;","uniform int sizeAttenuation;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","uniform bool vertical;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = (position + alignment) * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","vec4 upPosition;","vec4 rightPosition = vec4(scale.x,0.0,0.0,1.0);","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","if(vertical){","upPosition =  modelViewMatrix * vec4( 0.0, 1.0, 0.0, 1.0 ) - finalPosition;","normalize(upPosition);","}","if(vertical){","finalPosition.xyz += (rotatedPosition.x * rightPosition.xyz / scale.x) + (rotatedPosition.y * upPosition.xyz / scale.y);","}else{","finalPosition.xy += rotatedPosition;","}","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform int useMap;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","if(useMap > 0){","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","} else {","gl_FragColor = vec4( color, 1.0);","}","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")}},Ke.BillboardRenderer=function(){function t(t,i){var n=e.createProgram(),s=e.createShader(e.FRAGMENT_SHADER),r=e.createShader(e.VERTEX_SHADER),a="precision "+i+" float;\n";return e.shaderSource(s,a+t.fragmentShader),e.shaderSource(r,a+t.vertexShader),e.compileShader(s),e.compileShader(r),e.attachShader(n,s),e.attachShader(n,r),e.linkProgram(n),n}var e,i,n,s={},r=(new Ke.Billboard,new Ke.BillboardMaterial({color:255}));this.init=function(r){this.enable=!0,r._currentGroupHash=null,e=r._gl,i=r,n=r.getPrecision(),s.vertices=new Float32Array(16),s.faces=new Uint16Array(6),s.lines=new Uint16Array(8);var a=0;s.vertices[a++]=-.5,s.vertices[a++]=-.5,s.vertices[a++]=0,s.vertices[a++]=0,s.vertices[a++]=.5,s.vertices[a++]=-.5,s.vertices[a++]=1,s.vertices[a++]=0,s.vertices[a++]=.5,s.vertices[a++]=.5,s.vertices[a++]=1,s.vertices[a++]=1,s.vertices[a++]=-.5,s.vertices[a++]=.5,s.vertices[a++]=0,s.vertices[a++]=1,a=0,s.faces[a++]=0,s.faces[a++]=1,s.faces[a++]=2,s.faces[a++]=0,s.faces[a++]=2,s.faces[a++]=3,a=0,s.lines[a++]=0,s.lines[a++]=1,s.lines[a++]=0,s.lines[a++]=3,s.lines[a++]=1,s.lines[a++]=2,s.lines[a++]=2,s.lines[a++]=3,s.vertexBuffer=e.createBuffer(),s.elementBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,s.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,s.vertices,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s.elementBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,s.faces,e.STATIC_DRAW),s.program=t(Ke.ShaderSprite.sprite,n),s.attributes={},s.uniforms={},s.attributes.position=e.getAttribLocation(s.program,"position"),s.attributes.uv=e.getAttribLocation(s.program,"uv"),s.uniforms.uvOffset=e.getUniformLocation(s.program,"uvOffset"),s.uniforms.uvScale=e.getUniformLocation(s.program,"uvScale"),s.uniforms.rotation=e.getUniformLocation(s.program,"rotation"),s.uniforms.scale=e.getUniformLocation(s.program,"scale"),s.uniforms.alignment=e.getUniformLocation(s.program,"alignment"),s.uniforms.color=e.getUniformLocation(s.program,"color"),s.uniforms.useMap=e.getUniformLocation(s.program,"useMap"),s.uniforms.map=e.getUniformLocation(s.program,"map"),s.uniforms.opacity=e.getUniformLocation(s.program,"opacity"),s.uniforms.vertical=e.getUniformLocation(s.program,"vertical"),s.uniforms.useScreenCoordinates=e.getUniformLocation(s.program,"useScreenCoordinates"),s.uniforms.sizeAttenuation=e.getUniformLocation(s.program,"sizeAttenuation"),s.uniforms.screenPosition=e.getUniformLocation(s.program,"screenPosition"),s.uniforms.modelViewMatrix=e.getUniformLocation(s.program,"modelViewMatrix"),s.uniforms.projectionMatrix=e.getUniformLocation(s.program,"projectionMatrix"),s.uniforms.fogType=e.getUniformLocation(s.program,"fogType"),s.uniforms.fogDensity=e.getUniformLocation(s.program,"fogDensity"),s.uniforms.fogNear=e.getUniformLocation(s.program,"fogNear"),s.uniforms.fogFar=e.getUniformLocation(s.program,"fogFar"),s.uniforms.fogColor=e.getUniformLocation(s.program,"fogColor"),s.uniforms.alphaTest=e.getUniformLocation(s.program,"alphaTest"),this.inited=!0},this.render=function(t,n,a,o,h){this.inited||this.init(t);var l=new ci(n),c=l.size();if(c){var u=s.attributes,d=s.uniforms,f=!1;t.pm.currentProgram!=s.program&&(e.useProgram(s.program),t.pm.currentProgram=s.program,t._currentGroupHash=null,e.enableVertexAttribArray(u.position),e.enableVertexAttribArray(u.uv),e.disable(e.CULL_FACE),e.bindBuffer(e.ARRAY_BUFFER,s.vertexBuffer),e.vertexAttribPointer(u.position,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(u.uv,2,e.FLOAT,!1,16,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s.elementBuffer),this.enable=!0,f=!0),e.uniformMatrix4fv(d.projectionMatrix,!1,a.projectionMatrix.elements),f&&e.activeTexture(e.TEXTURE0),f&&e.uniform1i(d.map,0);var g=0,_=0,p=t.fog;p?(e.uniform3f(d.fogColor,p.color.r,p.color.g,p.color.b),p instanceof Ke.Fog?(e.uniform1f(d.fogNear,p.near),e.uniform1f(d.fogFar,p.far),e.uniform1i(d.fogType,1),g=1,_=1):p instanceof Ke.FogExp2&&(e.uniform1f(d.fogDensity,p.density),e.uniform1i(d.fogType,2),g=2,_=2)):(g=0,_=0);var v,m,y;for(v=0;v<c;v++)m=l.get(v),y=m.material,i.isVisible(m)&&0!==y.opacity&&(m.updateWorldMatrix(!0,!1),y.useScreenCoordinates?m.z=-m.position.z:(m._modelViewMatrix=new Ke.Mat4,m._modelViewMatrix.multiplyMatrices(a.worldMatrixInverse,m.worldMatrix),m.z=-m._modelViewMatrix.elements[14]));for(v=0;v<c;v++)m=l.get(v),this.renderBillboard(m,d,t,g,_),m._selected&&(m._scale.x=1.01*m._scale.x,m._scale.y=1.01*m._scale.y,m.material.clone(r),r.map=null,r.color.set(65280),this.renderBillboard(m,d,t,g,_,r),m._scale.x=m._scale.x/1.01,m._scale.y=m._scale.y/1.01)}},this.disable=function(){if(this.enable){var t=s.attributes;s.uniforms;e.disableVertexAttribArray(t.position),e.disableVertexAttribArray(t.uv),i._oldDoubleSided||e.enable(e.CULL_FACE),i._oldBlending===Ke.NoBlending&&e.disable(e.BLEND),wi.setDepthWrite(!0,i),this.enable=!1,this.lastMaterialId=null,i.pm.currentProgram=null}},this.renderBillboard=function(t,n,r,a,o,h){var l,c,u,d=[],f=new Je;if(l=h?h:t.material,i.isVisible(t)&&0!==l.opacity){var g=l.id,_=g!=this.lastMaterialId;_&&e.uniform1f(n.alphaTest,l.alphaTest),_&&(l.useScreenCoordinates===!0?(e.uniform1i(n.useScreenCoordinates,1),e.uniform3f(n.screenPosition,(t.position.x*i.devicePixelRatio-halfViewportWidth)/halfViewportWidth,(halfViewportHeight-t.position.y*i.devicePixelRatio)/halfViewportHeight,Math.max(0,Math.min(1,t.position.z)))):(e.uniform1i(n.useScreenCoordinates,0),e.uniform1i(n.sizeAttenuation,l.sizeAttenuation?1:0))),l.useScreenCoordinates===!0?(d[0]=i.devicePixelRatio,d[1]=i.devicePixelRatio):(e.uniformMatrix4fv(n.modelViewMatrix,!1,t._modelViewMatrix.elements),d[0]=1,d[1]=1),u=r.fog&&l.fog?o:0,a!==u&&(e.uniform1i(n.fogType,u),a=u),c=1/(l.scaleByViewport?viewportHeight:1),f.getScaleFromMatrix(t.worldMatrix),d[0]*=c*f.x,d[1]*=c*f.y,_&&(e.uniform2f(n.uvScale,l.repeat.x,l.repeat.y),e.uniform2f(n.uvOffset,l.offset.x,l.offset.y),e.uniform2f(n.alignment,l.alignment.x,l.alignment.y),e.uniform1f(n.opacity,l.opacity),e.uniform1i(n.vertical,l.vertical),e.uniform3f(n.color,l.color.r,l.color.g,l.color.b),e.uniform1f(n.rotation,t.rotation)),e.uniform2fv(n.scale,d),_&&(i.setBlending(l.blending,l.blendEquation,l.blendSrc,l.blendDst),i.setDepthTest(l.depthTest),i.setDepthWrite(l.depthMask)),l.map&&l.map._image&&i.pm.addTexture(l.map),_=_||l.map&&i.pm.needsUpdateTexture(l.map),l.map&&l.map._image&&l.map._image.width?(_&&i.setTexture(l.map,0),_&&e.uniform1i(n.useMap,1)):_&&e.uniform1i(n.useMap,0),h?(_&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s.elementBuffer),_&&e.bufferData(e.ELEMENT_ARRAY_BUFFER,s.lines,e.STATIC_DRAW),_&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s.elementBuffer),e.drawElements(e.LINES,8,e.UNSIGNED_SHORT,0)):(_&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s.elementBuffer),_&&e.bufferData(e.ELEMENT_ARRAY_BUFFER,s.faces,e.STATIC_DRAW),_&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s.elementBuffer),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)),this.lastMaterialId=l.id}}};var bi=function(t,i,n){this.width=t,this.height=i,n=n||{},this.wrapS=n.wrapS!==e?n.wrapS:Ke.ClampToEdgeWrapping,this.wrapT=n.wrapT!==e?n.wrapT:Ke.ClampToEdgeWrapping,this.magFilter=n.magFilter!==e?n.magFilter:Ke.LinearFilter,this.minFilter=n.minFilter!==e?n.minFilter:Ke.LinearMipMapLinearFilter,this.anisotropy=n.anisotropy!==e?n.anisotropy:1,this.offset=new Ke.Vec2(0,0),this.repeat=new Ke.Vec2(1,1),this.format=n.format!==e?n.format:Ke.RGBAFormat,this.type=n.type!==e?n.type:Ke.UnsignedByteType,this.depthBuffer=n.depthBuffer===e||n.depthBuffer,this.stencilBuffer=n.stencilBuffer===e||n.stencilBuffer,this.generateMipmaps=!0,this.shareDepthFrom=null};bi.prototype={constructor:bi,clone:function(){var t=new bi(this.width,this.height);return t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.format=this.format,t.type=this.type,t.depthBuffer=this.depthBuffer,t.stencilBuffer=this.stencilBuffer,t.generateMipmaps=this.generateMipmaps,t.shareDepthFrom=this.shareDepthFrom,t},getUniqueCode:function(){return this._id},dispose:function(){this.dispatchEvent({type:"dispose"})}};var Si=function(t,e,i){bi.call(this,t,e,i),this.activeCubeFace=0};Ke.extend(Si,bi,{});var Ti,Ei="l=1.0\ntype=1\ngis=0\n3d=1\nstart=2015-10-21\nend=2016-10-31\nnote=This license applies to the evaluation version of TWaver. The License is limited to noncommercial use. Noncommercial use relates only to educational, research, personal or evaluation purposes. Any other use is commercial use. You may not use the Software in connection with any business activities.And You are not permitted to modify the software or attempt to decipher, decompile, disassemble or reverse engineer this Software.\nsignature=69b57c46f9801b1ad4c0ec28e49fafd90df6bd4f63e42b019ff240736150c9a2070b4f2c7c1b2d94063a1402d811e757aa6aced3defef6ccafdf6f28b0dd4bc4e5ee9b033b9d9a12629329c76b5e22d608e561c8caa0dfeafb1cd9d1b1c988edf1b7a8d1d9520555f87e20626de98388c1bd30c0079ebacc6229b199648b774538a5abd45055658bcdf472770f1b7574d6ee17c0ec273ec2bcdd3053b24e7f547e93dbd4a180f9cd937541164297564dfa4d28ea4709ca165cbd515262976cc230459a86a7790be4f696b49f5b14e03b30abd94ca1f034c4376e1fad9ab7252c3e2930d2ac9383e84182683ac47ee29e109388c8165ea8001a0526dac643ac073edbb5038f065378dd77d69b22fc9716cc0a8c2adf4e090de8ebe24724d3a14ff73855193182c01cf7e5344e4400d9303f3e9a8d762862cab6ac4d8f37af59c1dcde69eb92a1b7b1a3493d63c1404b6f0c5c00975e9ab12daa68d7f4d3fe3b6863a72618ec0c6a6f6cb77a8476fd904cefcff326eaf2328c49b05c35898418ca2b974359d639f399a9a6f4cb14caf3af590753e67c52d44fed018fcb607a042ebecb4b6bb7d43ed364f76fbe47644c125e9cd97f393029e9cee49a910ae672041ec026ec55709c02662cccb62818dcd33e96a4c59d13995752636ae6ca2a7f961421adabf1277986ed03bdec170e1d00cb4c3668fb65bcc087996a7174163f63179507fc710fbf8697b7e8ddc5bbe5d54177a4dbe073ed1d90e6b842b42f04e6fd69f26a7dc3227f0189c21424b556ccdaa8d2b1829c35039670ea7663a8088220fffe99a530863fdff1ca18a468edd6adcc5a680e13c5a432096977d5b157ff5848f6bf464ca5dbf670f2cb090c3cbc4ccd8f8355b91505502e215b97646b86",Li=0xdeadbeefcafe,Mi=15715070==(16777215&Li);Mi&&"Microsoft Internet Explorer"==navigator.appName?(_.prototype.am=m,Ti=30):Mi&&"Netscape"!=navigator.appName?(_.prototype.am=v,Ti=26):(_.prototype.am=y,Ti=28),_.prototype.DB=Ti,_.prototype.DM=(1<<Ti)-1,_.prototype.DV=1<<Ti;var Pi=52;_.prototype.FV=Math.pow(2,Pi),_.prototype.F1=Pi-Ti,_.prototype.F2=2*Ti-Pi;var ki,Ii,Ri="0123456789abcdefghijklmnopqrstuvwxyz",Di=new Array;for(ki="0".charCodeAt(0),Ii=0;Ii<=9;++Ii)Di[ki++]=Ii;for(ki="a".charCodeAt(0),Ii=10;Ii<36;++Ii)Di[ki++]=Ii;for(ki="A".charCodeAt(0),Ii=10;Ii<36;++Ii)Di[ki++]=Ii;W.prototype.convert=X,W.prototype.revert=G,W.prototype.reduce=Z,W.prototype.mulTo=Y,W.prototype.sqrTo=q,Q.prototype.convert=J,Q.prototype.revert=$,Q.prototype.reduce=tt,Q.prototype.mulTo=it,Q.prototype.sqrTo=et,_.prototype.copyTo=w,_.prototype.fromInt=S,_.prototype.fromString=T,_.prototype.clamp=E,_.prototype.dlShiftTo=D,_.prototype.drShiftTo=B,_.prototype.lShiftTo=N,_.prototype.rShiftTo=z,_.prototype.subTo=O,_.prototype.multiplyTo=F,_.prototype.squareTo=V,_.prototype.divRemTo=U,_.prototype.invDigit=K,_.prototype.isEven=nt,_.prototype.exp=st,_.prototype.toString=L,_.prototype.negate=M,_.prototype.abs=P,_.prototype.compareTo=k,_.prototype.bitLength=R,_.prototype.mod=H,_.prototype.modPowInt=rt,_.ZERO=C(0),_.ONE=C(1),Kt.prototype.convert=Qt,Kt.prototype.revert=Qt,Kt.prototype.mulTo=Jt,Kt.prototype.sqrTo=$t,ne.prototype.convert=se,ne.prototype.revert=re,ne.prototype.reduce=ae,ne.prototype.mulTo=he,ne.prototype.sqrTo=oe;var Bi=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Ni=(1<<26)/Bi[Bi.length-1];_.prototype.chunkSize=ct,_.prototype.toRadix=dt,_.prototype.fromRadix=ft,_.prototype.fromNumber=gt,_.prototype.bitwiseTo=yt,_.prototype.changeBit=Nt,_.prototype.addTo=Vt,_.prototype.dMultiply=jt,_.prototype.dAddOffset=qt,_.prototype.multiplyLowerTo=ee,_.prototype.multiplyUpperTo=ie,_.prototype.modInt=ue,_.prototype.millerRabin=ge,_.prototype.clone=at,_.prototype.intValue=ot,_.prototype.byteValue=ht,_.prototype.shortValue=lt,_.prototype.signum=ut,_.prototype.toByteArray=_t,_.prototype.equals=pt,_.prototype.min=vt,_.prototype.max=mt,_.prototype.and=xt,_.prototype.or=bt,_.prototype.xor=Ct,_.prototype.andNot=Et,_.prototype.not=Lt,_.prototype.shiftLeft=Mt,_.prototype.shiftRight=Pt,_.prototype.getLowestSetBit=It,_.prototype.bitCount=Dt,_.prototype.testBit=Bt,_.prototype.setBit=zt,_.prototype.clearBit=Ot,_.prototype.flipBit=Ft,_.prototype.add=Ut,_.prototype.subtract=Ht,_.prototype.multiply=Wt,_.prototype.divide=Gt,_.prototype.remainder=Zt,_.prototype.divideAndRemainder=Yt,_.prototype.modPow=le,_.prototype.modInverse=de,_.prototype.pow=te,_.prototype.gcd=ce,_.prototype.isProbablePrime=fe,_.prototype.square=Xt,_e.prototype.init=pe,_e.prototype.next=ve;var zi,Oi,Fi,Vi=256;if(null==Oi){Oi=new Array,Fi=0;var Ui;if("Netscape"==navigator.appName&&navigator.appVersion<"5"&&t.crypto){var Hi=t.crypto.random(32);for(Ui=0;Ui<Hi.length;++Ui)Oi[Fi++]=255&Hi.charCodeAt(Ui)}for(;Fi<Vi;)Ui=Math.floor(65536*Math.random()),Oi[Fi++]=Ui>>>8,Oi[Fi++]=255&Ui;Fi=0,Ae()}be.prototype.nextBytes=we;Te.prototype.doPublic=Le,Te.prototype.setPublic=Ee,Te.prototype.encrypt=Me,Te.prototype.doPrivate=Re,Te.prototype.setPrivate=ke,Te.prototype.setPrivateEx=Ie,Te.prototype.decrypt=De;var Wi=function(){Xi.v(Ei)},Xi={},Gi="6a384c1259bdb5e731ec96b3174683f48a2c56a85e52e7a5bb20b58711ce50c1a294bd5e1d1752e766085e9ae94bae6d217c25dbb5fcdb86a8a9a7e180fa066723d00fcb85fcf7c9d29f8cc8859f53244a49c0bc30dcc45156daf8843ce1d24fe8ebc9a3c186bb26e9d0714041aef160304c1db8cc5728cf4acb39d29755f319",Zi="10001",Yi="61a921483dfa8f24e26204ace4d990b965d11e5bef5d8a5e768ebc5853a6bdd94b02369a3165207460fb91001d3fd83fbe69c6e51b8e40c8ae8a4e30a7c539dca98b44858bdc0b76f25af6803d4d13dacd9fa1a28f66cf561fa36309d4239a2cf50fe20ef0e99e01fc8701090f0685a524f411e00ca91f877d3b49d2d0052f9",ji="b881f568eb43e7a60c256a8a90e08b7c7638fd66ce3cded9005c72e283ca4f2b8601e2edc687d7f898348a05723b515d9edeb626af7b499a56ddaea93b0c2047";Xi.cross=function(t){if(t){for(var e="",i=0;i<t.length;)i+1<t.length?(e+=t[i+1],e+=t[i]):e+=t[i],i+=2;return e}return null},Xi.reverse=function(t){if(t){for(var e="",i=t.length;i>0;i--)e+=t[i-1];return e}return null},Xi.v=function(t){if(t){var e=Xi;if(e.start=null,e.beginDate=null,e.end=null,e.endDate=null,e.gis=null,e["3D"]=null,e["3d"]=null,e.l=null,e.__li__=null,t.indexOf("signature=")>0){var i=t.split("signature="),n=i[0],s=i[1],r=new Te;r.setPublic(Gi,Zi);for(var a=s,o=a.length,h=256,l=0,c="",u="";l<o;)c=a.substr(l,h),u+=r.decrypt(c),l+=h;if(u===n)return e.i(t),!0}}return!1},Xi.i=function(t){var i=Xi;i.__li__=t;var n,s,r,a,o,h=t.split("\n");for(n=0;n<h.length;n++)s=h[n],o=s.split("="),r=o[0],a=o[1],i[r]=a;i.start!=e&&(i.beginDate=new Date(Date.parse(i.start.replace(/-/g,"/")))),i.end!=e&&(i.endDate=new Date(Date.parse(i.end.replace(/-/g,"/"))));var l=i.gis;l!=e&&(l=parseInt(l)),l&&(i._isPermissionGIS=!0);var c=i["3D"]||i["3d"];c!=e&&(c=parseInt(c)),c&&(i._isPermission3D=!0),i.l!=e&&(i.version=i.l)};var qi=function(t){return t.__li__!==e&&t._isPermission3D},Ki=function(t){if(!qi(t))return!0;var e=new Date;return null!=t.beginDate&&t.beginDate.getTime()-e.getTime()>=0||null!=t.endDate&&t.endDate.getTime()-e.getTime()<=0};Xi.$z=function(t){var e=new Te;e.setPublic(Gi,Zi);for(var i=t,n=i.length,s=256,r=0,a="",o="";r<n;)a=i.substr(r,s),o+=e.decrypt(a),r+=s;return o},Xi.twm=function(t){var i=Xi,n=i.$z("4cd18113d0c7046bfe51f7a3fbd41c2b7cf14dd785d6ea7cec9da17710d3acfb8ce0cb9cf10839f4bd51e88819de19cdc0db09278584396156fcb65abe0353ac49d01326b30efa0ea98a07da9f8ceeb7572fc1b37b5965ba6103ccba4913b62e36e49425c6ff21a2f008830c59cff8f29058769f858c8a9f0bab3eaea7fb8a9e"),s=this.type,r=this.markText,a=i.$z("648be38cd61c870e95ffc1ea0676af40736c1365015abc326e891a4de67b4de3d4b05da70b9aebedc83ec26ecf71eb74c72f42f6d9a4be2d507d2f67d2860b7b66e3ba1d565e15923f2db335ff922eef17c01b59818b583d5656412d6cc9d9ba70001c2c88e3efd492c6b13a07fda5f325b333138a2036f4696542ec137cc341");t[a]=i.__li__;var o=t;if(o._xyz=null,"3"!==s||Ki(Xi)||r!==e){t.DEBUG&&(console.log("license: "+Xi.__li__),console.log("license Type : "+s),console.log("beginDate: "+Xi.beginDate),console.log("endDate: "+Xi.endDate),console.log("mark: "+r)),t.__liLabel==e&&(t.__liLabel=document.createElement("div")),i.startDate===e&&(i.startDate=new Date);var h=(new Date).getTime()-i.startDate.getTime(),l="2"===s?7200:300;if(!(h<1e3*l)){var c=Ki(i)&&h>1e3*l,u=r;if(c?u=i.$z("0dd629dbd0ce341ecdd447e35ddc3135a0b46916f7571a687f38ae665cf0ae095fee885e14329caa75112d8787508da17285b0897845d8ccae73e6a2727dd19f1ca335fe139d0e60d240f9ececc78f81c2c5667f51aeed4135b9c4bb436b8acb7cd418eeeb404bc4f3bcdedb481ac0edff7644435ce2b9f2bda78c892bd56d73"):"2"!=s||u!==e&&""!=u?"1"==s&&!r&&(u=n):u=i.$z("644d54bf9c59afbd8a742a9e7e2731f23f149ccb7f04c3547548c50ac2d77faea108b55f1f6261e99869f1c06b84e8abdefdf45b5170048531421f3d528123972ba2f03d70f37c33f1341dc12f986e0089e42bab517e2a05b455d12d90991bbba9bc45c715a81943062ea5fa5408c8b1b9270d260cc5a67b38ecc4178ce512fc"),u!==e){var d=o.__liLabel;d.innerHTML=u,d.type=s,d.mark=r,d.expired=c,o._xyz=d,c&&(o.getView().style.opacity=.1)}}}},yi.validateLicense(Ei),Ke.Material=function(t){Ke.PropertyChangeDispatcher.call(this),this.id=Ke.MaterialIdCount++,this.type="basic",this.shaderID="",this.uniforms=e,this.vertexShader="",this.fragmentShader="",this.alarmColor=null,this.name="",this.side=Ke.FrontSide,this.fog=!0,this.normalType=e,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=Ke.NoColors,this.blendMode=Ke.NormalBlending,this.blendSrc=Ke.SrcAlphaFactor,this.blendDst=Ke.OneMinusSrcAlphaFactor,this.blendEquation=Ke.AddEquation,this.depthTest=!0,this.depthMask=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.transparent=!1,this.opacity=1,this.visible=!0,this.needsUpdate=!0,this.setValues(t),this.useCount=0,this.styleMap={},this.offset=new Qe(0,0),this.repeat=new Qe(1,1),this.gradient={},this.gradientType=1,this.gradientCenter=new Qe(.5,.5),this.outline=0},Ke.extend(Ke.Material,Ke.PropertyChangeDispatcher,{generateKey:function(){},setMap:function(t,e){if(null==e&&(e="map"),this[e]!==t){var i=this[e];this[e]=t,this.firePropertyChange(e,i,t),this.onMapChanged(i,t)}},handleTextureChange:function(t){if("image"===t.property){this.firePropertyChange("needsUpdate",!1,!0)}else"disposed"===t.property},onPropertyChange:function(t,e,i){},onMapChanged:function(t,e){},setColor:function(t){if(this.color!==t){var e=this.color.clone();t instanceof Ke.Color?this.color.copy(t):this.color.set(t),this.firePropertyChange("color",e,t)}},setPropertyValue:function(t,e){if(this[t]!==e){var i=this[t];if(i instanceof Ke.Color)null!=e&&(i=i.clone(),e instanceof Ke.Color?this[t].copy(e):this[t].set(e));else if("gradient"==t){var n={};for(var s in e)e[s]instanceof Ke.Color?n[s]=e[s]:n[s]=new Ke.Color(e[s]);this[t]=n}else this[t]=e;this._uniqueCode=null,this.firePropertyChange(t,i,e)}},isTextureStyle:function(t){return"terrain"===this._type?t.startsWith("texture1.")||t.startsWith("texture2.")||t.startsWith("textureb.")||t.startsWith("texturen.")||t.startsWith("texturebp."):t.startsWith("texture.")||t.startsWith("lightmap")||t.startsWith("envmap")||t.startsWith("normalmap")||t.startsWith("specularmap")},setNeedsUpdate:function(t){},getShaderID:function(){return this instanceof Ke.BasicMaterial&&(this.shaderID="basic"),this.shaderID},setupMaterialShader:function(){var t=this.getShaderID(),e=Ke.ShaderLib[t];this.uniforms=Ke.UniformsUtils.clone(e.uniforms),this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader},refreshUniforms:function(t,e){this.refreshUniformsCommon(t,e),this.refreshUniformsSpecific(t,e)},loadCameraPosition:function(t,e,i){if((this instanceof Ke.ShaderMaterial||this instanceof Ke.PhongMaterial||this.envMap||"phong"===this._type)&&null!=t.cameraPosition){var n=e.worldMatrix.getPosition();i.uniform3f(t.cameraPosition,n.x,n.y,n.z)}},loadViewMatrix:function(t,e,i){("lambert"===this.type||"phong"===this.type||material.skinning)&&null!==t.viewMatrix&&i.uniformMatrix4fv(p_uniforms.viewMatrix,!1,e.worldMatrixInverse.elements)},refreshUniformsSpecific:function(t){},refreshUniformsCommon:function(t){var i=this.uniforms,n=this;i.opacity.value=n.opacity;var s=yi.getObjectCount(this.gradient)>0;if(t?i.diffuse.value.copyGammaToLinear(this.alarmColor?this.alarmColor:this.color):i.diffuse.value=this.alarmColor?this.alarmColor:this.color,s){var r=[],a=[];for(var o in this.gradient)r.push(o);r.sort();for(var h=0;h<r.length;h++)a.push(this.gradient[r[h]]);i.gradientColor.value=a,i.gradientStop.value=r,i.gradientType.value=this.gradientType}i.map.value=n.map,i.lightMap.value=n.lightMap,i.specularMap.value=n.specularMap,n.bumpMap&&(i.bumpMap.value=n.bumpMap,i.bumpScale.value=n.bumpScale),n.normalMap&&"phong"===n._type&&(i.normalMap.value=n.normalMap,i.normalScale.value.copy(n.normalScale));var l;if(n.map?l=n.map:n.specularMap?l=n.specularMap:n.normalMap&&"phong"===n._type?l=n.normalMap:n.bumpMap&&"phong"===n._type&&(l=n.bumpMap),l!=e){var c=this.offset,u=this.repeat;i.offsetRepeat.value.set(c.x,c.y,u.x,u.y),i.flipX.value=l.flipX?1:0,i.mapLoaded.value=1,l._image&&!l._image.loaded&&i.offsetRepeat.value.set(0,0,1,1)}i.envMap.value=n.envMap,i.flipEnvMap.value=1,t?i.reflectivity.value=n.reflectRatio*n.reflectRatio:i.reflectivity.value=n.reflectRatio,i.refractionRatio.value=n.refractionRatio,i.combine.value=n.combine,i.useRefract.value=n.envMap&&n.envMap.mapping instanceof Ke.CubeRefractionMapping},loadGeneralUniforms:function(){},getNormalType:function(){var t=this&&this.normalType!==e&&this.normalType===Ke.NormalTypeSmooth;return t?Ke.SmoothShading:Ke.FlatShading},isVertexColor:function(){return!!this.vertexColors&&this.vertexColors},needUV:function(){return this.map||this.lightMap||this.bumpMap||this.normalMap||this.specularMap,!0},setValues:function(t){if(t!==e)for(var i in t){var n=t[i];if(n!==e){if(i in this){var s=this[i];s instanceof Ke.Color&&n instanceof Ke.Color?s.copy(n):s instanceof Ke.Color?s.set(n):s instanceof Ke.Vec3&&n instanceof Ke.Vec3?s.copy(n):this[i]=n}}else console.warn("TGL.Material: '"+i+"' parameter is undefined.")}},isCustomAttributesNeedUpdate:function(){if(!this.attributes)return!1;for(var t in this.attributes)if(this.attributes[t].needsUpdate)return!0;return!1},clearCustomAttributes:function(){if(this.attributes)for(var t in this.attributes)this.attributes[t].needsUpdate=!1},clone:function(t){return t===e&&(t=new Ke.Material),t.name=this.name,t.side=this.side,t.blendMode=this.blendMode,t.blendSrc=this.blendSrc,t.blendDst=this.blendDst,t.blendEquation=this.blendEquation,t.depthTest=this.depthTest,t.depthMask=this.depthMask,t.polygonOffset=this.polygonOffset,t.polygonOffsetFactor=this.polygonOffsetFactor,t.polygonOffsetUnits=this.polygonOffsetUnits,t.alphaTest=this.alphaTest,t.transparent=this.transparent,t.opacity=this.opacity,t.visible=this.visible,t.normalType=this.normalType,t.wireframe=this.wireframe,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.wireframeLinewidth=this.wireframeLinewidth,t.gradient=this.gradient,t.gradientType=this.gradientType,t.outline=this.outline,t},dispose:function(){this.firePropertyChange("disposed",!1,!0)}}),Ke.MaterialIdCount=0,Ke.EntityMaterial=function(t){Ke.Material.call(this),this._type="basic",this.color=new Ke.Color(16777215),this.map=null,this.ambient=new Ke.Color(16777215),this.emissive=new Ke.Color(0),this.specular=new Ke.Color(1118481),this.specularStrength=1,this.shininess=30,this.wrapAround=!1,this.wrapRGB=new Ke.Vec3(1,1,1),this.lightMap=null,this.specularMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Ke.Vec2(1,1),this.envMap=null,this.combine=Ke.MultiplyOperation,this.reflectRatio=1,this.refractionRatio=.98,this.fog=!0,this.shading=Ke.SmoothShading,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.metal=!1,this.perPixel=!0,this.map1=null,this.map2=null,this.blendMap=null,this.detailMap=null,this.specularMap=null,this.blendRange=new Qe(0,1),this.setValues(t)},Ke.extend(Ke.EntityMaterial,Ke.Material,{getShaderID:function(){return this.getType()},getUniqueCode:function(){if(null!=this._uniqueCode)return this._uniqueCode;var t=this._type+" "+this.color.r+this.color.g+this.color.b+" "+this.ambient.getUniqueCode()+" "+this.emissive.getUniqueCode()+this.specular.getUniqueCode()+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth+" "+this.polygonOffset+" "+this.polygonOffsetFactor+" "+this.polygonOffsetUnits+" "+this.overdraw+" "+this.shininess+" "+this.metal+" "+this.specularStrength;
if(this.alphaTest&&(t+=this.alphaTest),t+=" "+this.normalType+" ",t+=this.repeat.x+" "+this.repeat.y+this.offset.x+" "+this.offset.y,t+=" "+this.blendRange.x+" "+this.blendRange.y,t+=" "+this.normalScale.x+" "+this.normalScale.y,t+=" "+this.reflectRatio,this.map&&(t+=this.map.getUniqueCode()),this.map1&&(t+=this.map1.getUniqueCode()),this.map2&&(t+=this.map2.getUniqueCode()),this.blendMap&&(t+=this.blendMap.getUniqueCode()),this.normalMap&&(t+=this.normalMap.getUniqueCode()),this.lightMap&&(t+=this.lightMap.getUniqueCode()),this.envMap&&(t+=this.envMap.getUniqueCode()),this.specularMap&&(t+=this.specularMap.getUniqueCode()),this.alarmColor&&(t+=" "+this.alarmColor.getUniqueCode()),this.gradient)for(var e in this.gradient)t+=" "+e+":"+this.gradient[e].getUniqueCode();return t+=" "+this.gradientType,t+=" "+this.outline,t+=this.combine,this._uniqueCode=t,t},loadViewMatrix:function(t,e,i){("lambert"===this._type||"phong"===this._type||material.skinning)&&null!==t.viewMatrix&&i.uniformMatrix4fv(p_uniforms.viewMatrix,!1,e.worldMatrixInverse.elements)},onMapChanged:function(t,e){if(Ke.TexturePool.useTexture(e),Ke.TexturePool.unUseTexture(t),e){var i=e.getUniqueCode();null==Ke.TexturePool.getTexture(i)&&Ke.TexturePool.setTexture(i,e)}},setType:function(t){if(this._type!==t){var e=this._type;this._type=t,this.firePropertyChange("type",e,t),this.onTypeChanged(e,t)}},onTypeChanged:function(){},getType:function(){return this._type},setStyle:function(t,e){if(null!=t){null==this.styleMap&&(this.styleMap={});var i=this.styleMap[t];return null==e?delete this.styleMap[t]:this.styleMap[t]=e,this.firePropertyChange(Ke.Styles.PREFIX_STYLE+t,i,e),this.onStyleChanged(t,i,e),this}},getStyle:function(t,e){null==e&&(e=!0);var i;return null!=this.styleMap&&(i=this.styleMap[t]),null==i&&e&&(i=Ke.Styles.getStyle(t)),i},clone:function(t){return t=t||new Ke.EntityMaterial,Ke.Material.prototype.clone.call(this,t),t._type=this._type,t.color.copy(this.color),t.setMap(this.map,"map"),t.setMap(this.map1,"map1"),t.setMap(this.map2,"map2"),t.setMap(this.blendMap,"blendMap"),t.setMap(this.normalMap,"normalMap"),t.setMap(this.specularMap,"specularMap"),t.setMap(this.envMap,"envMap"),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.specular.copy(this.specular),t.shininess=this.shininess,t.metal=this.metal,t.perPixel=this.perPixel,t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.setMap(this.lightMap,"lightMap"),t.bumpMap=this.bumpMap,t.bumpScale=this.bumpScale,t.normalScale.copy(this.normalScale),t.combine=this.combine,t.reflectRatio=this.reflectRatio,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t.specularStrength=this.specularStrength,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.blendRange.copy(this.blendRange),t},refreshUniformsSpecific:function(t){var e=this.uniforms;"lambert"===this._type?(t?(e.ambient.value.copyGammaToLinear(this.ambient),e.emissive.value.copyGammaToLinear(this.emissive)):(e.ambient.value=this.ambient,e.emissive.value=this.emissive),this.wrapAround&&e.wrapRGB.value.copy(this.wrapRGB)):"phong"===this._type&&(e.shininess.value=this.shininess,t?(e.ambient.value.copyGammaToLinear(this.alarmColor?this.alarmColor:this.ambient),e.emissive.value.copyGammaToLinear(this.emissive),e.specular.value.copyGammaToLinear(this.specular)):(e.ambient.value=this.alarmColor?this.alarmColor:this.ambient,e.emissive.value=this.emissive,e.specular.value=this.specular),e.uspecularStrength.value=this.specularStrength,this.wrapAround&&e.wrapRGB.value.copy(this.wrapRGB))},refreshUniformsCommon:function(t){if("terrain"===this._type){var e=this.uniforms;e.enableDiffuse1.value=this.map?1:0,e.tDiffuse1.value=this.map,e.enableDiffuse2.value=this.map1?1:0,e.tDiffuse2.value=this.map1,e.enableDiffuse3.value=this.map2?1:0,e.tDiffuse3.value=this.map2,e.enableDisplacement.value=this.blendMap?1:0,e.tDisplacement.value=this.blendMap,e.uRepeatOverlay.value=this.repeat,null==this.blendRangeArray&&(this.blendRangeArray=[0,1]),this.blendRangeArray[0]=this.blendRange.x,this.blendRangeArray[1]=this.blendRange.y,e.blendRange.value=this.blendRangeArray}else if("outline"===this._type){var e=this.uniforms;e.diffuse.value=this.color,e.outline_offset.value=this.outline}else Ke.Material.prototype.refreshUniformsCommon.call(this,t)}}),Ke.BlurMaterial=function(){Ke.Material.call(this),this.orientation=0,this.blurAmount=5,this.blurScale=1,this.blurStrength=1,this.useBlur=1,this.texelSize=new Qe(512,512),this.blurGlobalAlpha=1},Ke.extend(Ke.BlurMaterial,Ke.Material,{refreshUniformsCommon:function(t){var e=this.uniforms;e.map.value=this.map,e.orientation.value=this.orientation,e.blurAmount.value=this.blurAmount,e.blurScale.value=this.blurScale,e.blurStrength.value=this.blurStrength,e.useBlur.value=this.useBlur,e.texelSize.value=this.texelSize,e.blurGlobalAlpha.value=this.blurGlobalAlpha},getShaderID:function(){return"blur"}}),Ke.DeferredMaterial=function(t){t=t||{},Ke.Material.call(this,t),this.linearDepth=30,this.isNormal=t.isNormal!==e?t.isNormal:0},Ke.extend(Ke.DeferredMaterial,Ke.Material,{getShaderID:function(){return"deferred"},refreshUniformsCommon:function(t){var e=this.uniforms;e.linearDepth.value=this.linearDepth,e.isNormal.value=this.isNormal}}),Ke.SSAOMaterial=function(t){Ke.Material.call(this),this.map1=null,this.map2=null,this.occluderBias=.05,this.samplingRadius=20,this.attenuation=new Qe(1,.02),this.texelSize=new Qe(1/512,1/512)},Ke.extend(Ke.SSAOMaterial,Ke.Material,{getShaderID:function(){return"ssao"},refreshUniformsCommon:function(t){var e=this.uniforms;e.map0.value=this.map,e.map1.value=this.map1,e.map2.value=this.map2,e.occluderBias.value=this.occluderBias,e.samplingRadius.value=this.samplingRadius,e.attenuation.value=this.attenuation,e.texelSize.value=this.texelSize}}),Ke.BasicMaterial=function(t){Ke.Material.call(this),this._type="basic",this.color=new Ke.Color(16777215),this.map=null,this.setValues(t),this.offset=new Qe(0,0),this.repeat=new Qe(1,1)},Ke.extend(Ke.BasicMaterial,Ke.Material,{getShaderID:function(){return"basic"},clone:function(){var t=new Ke.BasicMaterial;return Ke.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t},getUniqueCode:function(){var t=this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return t+=this.repeat.x+" "+this.repeat.y+this.offset.x+" "+this.offset.y,this.map&&(t+=this.map.getUniqueCode()),t}}),Ke.LambertMaterial=function(t){Ke.Material.call(this),this._type="basic",this.color=new Ke.Color(16777215),this.ambient=new Ke.Color(16777215),this.emissive=new Ke.Color(0),this.wrapAround=!1,this.wrapRGB=new Ke.Vec3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=Ke.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=Ke.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=Ke.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)},Ke.extend(Ke.LambertMaterial,Ke.Material,{clone:function(){var t=new Ke.LambertMaterial;return Ke.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.map=this.map,t.lightMap=this.lightMap,t.specularMap=this.specularMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},getShaderID:function(){return"lambert"},refreshUniformsSpecific:function(t){var e=this.uniforms;t?(e.ambient.value.copyGammaToLinear(this.ambient),e.emissive.value.copyGammaToLinear(this.emissive)):(e.ambient.value=this.ambient,e.emissive.value=this.emissive),this.wrapAround&&e.wrapRGB.value.copy(this.wrapRGB)}}),Ke.PhongMaterial=function(t){Ke.Material.call(this),this._type="basic",this.color=new Ke.Color(16777215),this.ambient=new Ke.Color(16777215),this.emissive=new Ke.Color(0),this.specular=new Ke.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new Ke.Vec3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Ke.Vec2(1,1),this.specularMap=null,this.envMap=null,this.combine=Ke.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=Ke.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=Ke.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t),this.offset=new Qe(0,0),this.repeat=new Qe(1,1)},Ke.extend(Ke.PhongMaterial,Ke.Material,{getUniqueCode:function(){var t="phong "+this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return t+=this.repeat.x+" "+this.repeat.y+this.offset.x+" "+this.offset.y,this.map&&(t+=this.map.getUniqueCode()),t},clone:function(){var t=new Ke.PhongMaterial;return Ke.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.specular.copy(this.specular),t.shininess=this.shininess,t.metal=this.metal,t.perPixel=this.perPixel,t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.map=this.map,t.lightMap=this.lightMap,t.bumpMap=this.bumpMap,t.bumpScale=this.bumpScale,t.normalMap=this.normalMap,t.normalScale.copy(this.normalScale),t.specularMap=this.specularMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},getShaderID:function(){return"phong"},refreshUniformsSpecific:function(t){var e=this.uniforms;e.shininess.value=this.shininess,t?(e.ambient.value.copyGammaToLinear(this.ambient),e.emissive.value.copyGammaToLinear(this.emissive),e.specular.value.copyGammaToLinear(this.specular)):(e.ambient.value=this.ambient,e.emissive.value=this.emissive,e.specular.value=this.specular),this.wrapAround&&e.wrapRGB.value.copy(material.wrapRGB)}}),Ke.LineMaterial=function(t){Ke.Material.call(this),this.color=new Ke.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.dashed=!0,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(t)},Ke.extend(Ke.LineMaterial,Ke.Material,{getUniqueCode:function(){return this.color.getUniqueCode+" "+this.linewidth+" "+this.dashed},clone:function(){var t=new Ke.LineMaterial;return Ke.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.linewidth=this.linewidth,t.linecap=this.linecap,t.linejoin=this.linejoin,t.dashed=this.dashed,t.scale=this.scale,t.dashSize=this.dashSize,t.gapSize=this.gapSize,t.vertexColors=this.vertexColors,t.fog=this.fog,t},getShaderID:function(){return this.dashed?"dashed":"basic"},refreshUniforms:function(t){Be(this.uniforms,this),this.dashed&&Ne(this.uniforms,this)}}),Ke.ArrayMaterial=function(t){this.materials=t||[]},Ke.extend(Ke.ArrayMaterial,Object,{clone:function(){for(var t=new Ke.ArrayMaterial,e=0;e<this.materials.length;e++){var i=this.materials[e],n=this.materials.indexOf(i);null!=t.materials[n]?t.materials.push(t.materials[n]):t.materials.push(i.clone())}return t}}),Ke.BillboardMaterial=function(t){Ke.Material.call(this),this.alignment=Ke.BillboardAlignment.center.clone(),this.fog=!1,this.color=new Ke.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.offset=new Ke.Vec2(0,0),this.repeat=new Ke.Vec2(1,1),this.transparent=!0,this.setValues(t),this.depthMask=!0,this.vertical=!1,this.alphaTest=0},Ke.extend(Ke.BillboardMaterial,Ke.Material,{clone:function(t){return t=t?t:new Ke.BillboardMaterial,Ke.Material.prototype.clone.call(this,t),t.alignment.copy(this.alignment),t.color.copy(this.color),t.map=this.map,t.rotation=this.rotation,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.fog=this.fog,t.vertical=this.vertical,t.transparent=this.transparent,t.alphaTest=this.alphaTest,t},getUniqueCode:function(){var t="Billboard "+this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return t+=this.vertical+" "+this.alphaTest+" "+this.alignment.x+" "+this.alignment.y,t+=this.repeat.x+" "+this.repeat.y,t+=this.offset.x+" "+this.offset.y,this.map&&(t+=this.map.getUniqueCode()),t}}),Ke.BillboardAlignment={},Ke.BillboardAlignment.topLeft=new Ke.Vec2(.5,(-.5)),Ke.BillboardAlignment.topCenter=new Ke.Vec2(0,(-.5)),Ke.BillboardAlignment.topRight=new Ke.Vec2((-.5),(-.5)),Ke.BillboardAlignment.centerLeft=new Ke.Vec2(.5,0),Ke.BillboardAlignment.center=new Ke.Vec2(0,0),Ke.BillboardAlignment.centerRight=new Ke.Vec2((-.5),0),Ke.BillboardAlignment.bottomLeft=new Ke.Vec2(.5,.5),Ke.BillboardAlignment.bottomCenter=new Ke.Vec2(0,.5),Ke.BillboardAlignment.bottomRight=new Ke.Vec2((-.5),.5);var Qi=function(t){Ke.Material.call(this),this.fragmentShader="void main() {}",this.vertexShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shaderID=t.shaderID||"depth",this._type="shader",this.shading=Ke.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=Ke.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName="position",this.setValues(t)};Ke.ShaderMaterial=Qi,Ke.extend(Ke.ShaderMaterial,Ke.Material,{clone:function(){var t=new Ke.ShaderMaterial;return Ke.Material.prototype.clone.call(this,t),t.fragmentShader=this.fragmentShader,t.vertexShader=this.vertexShader,t.uniforms=Ke.UniformsUtils.clone(this.uniforms),t.attributes=this.attributes,t.defines=this.defines,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.fog=this.fog,t.lights=this.lights,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},needUV:function(){return!0},getShaderID:function(){return null},refreshUniformsCommon:function(t,e){}}),Ke.TransformGizmoMaterial=function(t){Ke.BasicMaterial.call(this),this.depthTest=!1,this.depthMask=!1,this.side=Ke.DoubleSide,this.transparent=!0,this.setValues(t)},Ke.extend(Ke.TransformGizmoMaterial,Ke.BasicMaterial,{getUniqueCode:function(){var t=this.id+"TransformGizmo "+this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return this.map&&(t+=this.map.getUniqueCode()),t}});var Ji={pools:{},useTimes:{},size:0,getMaterial:function(t){return Ji.pools[t]},setMaterial:function(t,e){Ji.size++,Ji.pools[t]=e},useMaterial:function(t){if(t){var e=t.id,i=Ji.useTimes[e]||0;i++,Ji.useTimes[e]=i}},unUseMaterial:function(t){if(t){var e=t.id,i=Ji.useTimes[e]||0;if(i--,Ji.useTimes[e]=i,i<=0){var n=t.getUniqueCode();delete Ji.pools[n],Ji.size--,t.dispose()}}}};Ke.MaterialPool=Ji,Ji.DefaultMaterial=new Ke.EntityMaterial,Ji.TestMaterial=new Ke.EntityMaterial,Ji.DefaultBillBoardMaterial=new Ke.BillboardMaterial,Ji.DefaultLineMaterial=new Ke.LineMaterial;Ke.ParticleMaterial=function(t){Ke.Material.call(this),this.color=new Ke.Color(16777215),this.map=null,this.size=2,this.sizeAttenuation=!1,this.vertexColors=!1,this.fog=!0,this.setValues(t)},Ke.extend(Ke.ParticleMaterial,Ke.Material,{clone:function(){var t=new Ke.ParticleMaterial;return Ke.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.size=this.size,t.sizeAttenuation=this.sizeAttenuation,t.vertexColors=this.vertexColors,t.fog=this.fog,t},getShaderID:function(){return this.shaderID="particle_basic",this.shaderID},refreshUniforms:function(t){ze(this.uniforms,this)}}),Ke.Light=function(t,e){Ke.Element.call(this,e),this.color=new Ke.Color(t),this.ambient=new Ke.Color,this.diffuse=new Ke.Color,this.specular=new Ke.Color,this.castShadow=!1,this.onlyShadow=!1},Ke.extend(Ke.Light,Ke.Element,{__accessor:["color","ambient","diffuse","specular"],constructor:Ke.Light,className:"TGL.Light",setCastShadow:function(t){this.castShadow=t},setOnlyShadow:function(t){this.onlyShadow=t},refreshShadowUniforms:function(t,e){var i=this;if(t.shadowMatrix&&i.castShadow&&(i instanceof Ke.SpotLight||i instanceof Ke.DirectionalLight&&!i.shadowCascade))return t.shadowMap.value[e]=i.shadowMap,t.shadowMapSize.value[e]=i.shadowMapSize,t.shadowMatrix.value[e]=i.shadowMatrix,t.shadowDarkness.value[e]=i.shadowDarkness,t.shadowBias.value[e]=i.shadowBias,!0},refreshUniformsPointShadow:function(t,e){var i=this;if(t.pShadowMap&&i.castShadow&&i instanceof Ke.PointLight)return t.pShadowMap.value[e]=i.shadowMap,t.pShadowMapSize.value[e]=i.shadowMapSize,t.pShadowDarkness.value[e]=i.shadowDarkness||.5,t.pPosition.value[e]=i.getPosition(),!0}}),Ke.PositionLight=function(){},Ke.PointLight=function(t,i,n,s){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var r=arguments[0];t=r.hex,i=r.intensity,n=r.intensity,s=r.id}Ke.Light.call(this,t,s),this.position=new Ke.Vec3(0,0,0),this.intensity=i!==e?i:1,this.distance=n!==e?n:0,this.shadowCameraNear=10,this.shadowCameraFar=1e4,this.shadowMapWidth=512,this.shadowMapHeight=512},Ke.extend(Ke.PointLight,Ke.Light,{constructor:Ke.PointLight,className:"TGL.PointLight",__accessor:["intensity","distance"]}),Ke.SpotLight=function(t,i,n,s,r){Ke.Light.call(this,t),this._position=new Ke.Vec3(0,1,0),this.target=new Ke.Element,this.intensity=i!==e?i:1,this.distance=n!==e?n:0,this.angle=s!==e?s:Math.PI/2,this.exponent=r!==e?r:10,this.shadowCameraNear=100,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},Ke.extend(Ke.SpotLight,Ke.Light,{__accessor:["color","ambient","diffuse","specular","intensity","distance","angle","exponent"],constructor:Ke.SpotLight,className:"TGL.SpotLight"}),Ke.DirectionalLight=function(t,i,n){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var s=arguments[0];t=s.hex,i=s.intensity,n=s.id}Ke.Light.call(this,t,n),this.direction=new Ke.Vec3(0,1,0),this.position=new Ke.Vec3(0,1,0),this.target=new Ke.Element,this.intensity=i!==e?i:1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new Ke.Vec3(0,0,(-1e3)),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},Ke.extend(Ke.DirectionalLight,Ke.Light,{className:"TGL.DirectionalLight"}),Ke.AmbientLight=function(t,e){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var i=arguments[0];t=i.hex,e=i.id}Ke.Light.call(this,t,e)},Ke.extend(Ke.AmbientLight,Ke.Light,{constructor:Ke.AmbientLight,className:"TGL.AmbientLight",clone:function(){var t=new Ke.AmbientLight;return Ke.Light.prototype.clone.call(this,t),t}}),Ke.Camera=function(){Ke.Element.call(this),this.projectionMatrix=new Ke.Mat4,this.projectionMatrixInverse=new Ke.Mat4,this.worldMatrixInverse=new Ke.Mat4,this.target=new Ke.Vec3,this.setPosition(0,0,500),this.lookat=this.lookAt},Ke.extend(Ke.Camera,Ke.Element,{constructor:Ke.Camera,updateCameraMatrix:function(t){var e=this.matrix.clone();this.matrix.lookAt(this._position,this.target,this.up),this.rotationAutoUpdate&&this._rotation.setEulerFromRotationMatrix(this.matrix),!e.equals(this.matrix)&&t&&this.firePropertyChange("matrix",e,this.matrix)},lookAt:function(t,i){3===arguments.length&&t.x===e?(t=new mono.Vec3(arguments[0],arguments[1],arguments[2]),i=e):4===arguments.length&&t.x===e&&(t=new mono.Vec3(arguments[0],arguments[1],arguments[2]),i=arguments[4]),i===e&&(i=!0),this.target=t,this.updateCameraMatrix(i)},look:function(t){3===arguments.length&&t.x===e&&(t=new mono.Vec3(arguments[0],arguments[1],arguments[2])),this.lookAt(t,!0)},onUpChanged:function(t,e){this.updateCameraMatrix()},getTarget:function(){return this.target},t:function(){return this.getTarget()},getDistance:function(){return(new Je).subVectors(this._position,this.target).length()},setDistance:function(t){var e=this.getDistance();this.zoom(t/e)},lookAtElement:function(t,e,i){e instanceof Je?(i=e,e=this.getDistance()):i=i||new Je(0,0,1),t instanceof Ke.Element&&(e=e?e:this.getDistance(),this.setPosition(t.worldPosition(i,e)),this.look(t.getWorldPosition()))},zoomOut:function(t){this.zoom(1.1,t)},zoomIn:function(t){this.zoom(.9,t)},zoom:function(t,e){if(t>0){var i=e||this.getDistance();i*=t;var n=(new Je).addVectors(this.target,(new Je).subVectors(this._position,this.target).setLength(i));this.setPosition(n)}}}),Ke.OrthoCamera=function(t,e,i,n){Ke.Camera.call(this),this.width=t||1,this.aspect=e||1,this.near=i||.1,this.far=n||1e4,this.updateProjectionMatrix()},Ke.extend(Ke.OrthoCamera,Ke.Camera,{constructor:Ke.OrthoCamera,className:"TGL.OrthoCamera",__accessor:["width","aspect","near","far"],updateProjectionMatrix:function(){var t=this.getDistance(),e=t*this.width/2,i=-e,n=t/this.aspect*this.width/2,s=-n;this.projectionMatrix.makeOrthographic(i,e,n,s,this.near,this.far)},onPropertyChange:function(){this.updateProjectionMatrix()},updateCameraMatrix:function(t){Ke.Camera.prototype.updateCameraMatrix.call(this,t),this.updateProjectionMatrix()}}),Ke.PerspectiveCamera=function(t,i,n,s){Ke.Camera.call(this),this.fov=t!==e?t:50,this.aspect=i!==e?i:1,this.near=n!==e?n:1,this.far=s!==e?s:5e4,this.updateProjectionMatrix()},Ke.extend(Ke.PerspectiveCamera,Ke.Camera,{constructor:Ke.PerspectiveCamera,className:"TGL.PerspectiveCamera",__accessor:["fov","aspect","near","far"],updateProjectionMatrix:function(){this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},onPropertyChange:function(){this.updateProjectionMatrix()}}),Ke.CameraHelper=function(t){function i(t,e,i){n(t,i),n(e,i)}function n(t,i){s.vertices.push(new Ke.Vec3),s.colors.push(new Ke.Color(i)),a[t]===e&&(a[t]=[]),a[t].push(s.vertices.length-1)}var s=new Ke.Entity,r=new Ke.LineMaterial({color:16777215,vertexColors:Ke.FaceColors}),a={},o=16755200,h=16711680,l=43775,c=16777215,u=3355443;i("n1","n2",o),i("n2","n4",o),i("n4","n3",o),i("n3","n1",o),i("f1","f2",o),i("f2","f4",o),i("f4","f3",o),i("f3","f1",o),i("n1","f1",o),i("n2","f2",o),i("n3","f3",o),i("n4","f4",o),i("p","n1",h),i("p","n2",h),i("p","n3",h),i("p","n4",h),i("u1","u2",l),i("u2","u3",l),i("u3","u1",l),i("c","t",c),i("p","c",u),i("cn1","cn2",u),i("cn3","cn4",u),i("cf1","cf2",u),i("cf3","cf4",u),Ke.Line.call(this,s.vertices,s.colors,r,Ke.LinePieces),this.camera=t,this.worldMatrix=t.worldMatrix,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()},Ke.CameraHelper.prototype=Object.create(Ke.Line.prototype),Ke.CameraHelper.prototype.update=function(){var t=new Ke.Vec3,i=new Ke.Camera,n=new Ke.Projector;return function(){function s(s,a,o,h){t.set(a,o,h),n.unprojectVector(t,i);var l=r.pointMap[s];if(l!==e)for(var c=0,u=l.length;c<u;c++)r.vertices[l[c]].copy(t)}var r=this,a=1,o=1;i.projectionMatrix.copy(this.camera.projectionMatrix),s("c",0,0,-1),s("t",0,0,1),s("n1",-a,-o,-1),s("n2",a,-o,-1),s("n3",-a,o,-1),s("n4",a,o,-1),s("f1",-a,-o,1),s("f2",a,-o,1),s("f3",-a,o,1),s("f4",a,o,1),s("u1",.7*a,1.1*o,-1),s("u2",.7*-a,1.1*o,-1),s("u3",0,2*o,-1),s("cf1",-a,0,1),s("cf2",a,0,1),s("cf3",0,-o,1),s("cf4",0,o,1),s("cn1",-a,0,-1),s("cn2",a,0,-1),s("cn3",0,-o,-1),s("cn4",0,o,-1),this.verticesNeedUpdate=!0}}();var $i=function(){Ke.Element.call(this)};$i.prototype=Object.create(Ke.Element.prototype),$i.prototype.updateworldMatrix=function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||t)&&(this._parent?(this.worldMatrix.multiplyMatrices(this._parent.worldMatrix,this.matrix),this.worldMatrix.decompose(this.translationWorld,this.QuatWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.QuatObject,this.scaleObject),this.worldMatrix.compose(this.translationWorld,this.QuatObject,this.scaleWorld)):this.worldMatrix.copy(this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0);for(var e=0,i=this.getChildren().size();e<i;e++)this.getChildren().get(e).updateworldMatrix(t)},$i.prototype.translationWorld=new Ke.Vec3,$i.prototype.translationObject=new Ke.Vec3,$i.prototype.QuatWorld=new Ke.Quat,$i.prototype.QuatObject=new Ke.Quat,$i.prototype.scaleWorld=new Ke.Vec3,$i.prototype.scaleObject=new Ke.Vec3;var tn=function(){function t(t,e){var i=new Ke.DirectionalLight;i.isVirtual=!0,i.onlyShadow=!0,i.castShadow=!0,i.shadowCameraNear=t.shadowCameraNear,i.shadowCameraFar=t.shadowCameraFar,i.shadowCameraLeft=t.shadowCameraLeft,i.shadowCameraRight=t.shadowCameraRight,i.shadowCameraBottom=t.shadowCameraBottom,i.shadowCameraTop=t.shadowCameraTop,i.shadowCameraVisible=t.shadowCameraVisible,i.shadowDarkness=t.shadowDarkness,i.shadowBias=t.shadowCascadeBias[e],i.shadowMapWidth=t.shadowCascadeWidth[e],i.shadowMapHeight=t.shadowCascadeHeight[e],i.pointsWorld=[],i.pointsFrustum=[];for(var n=i.pointsWorld,s=i.pointsFrustum,r=0;r<8;r++)n[r]=new Ke.Vec3,s[r]=new Ke.Vec3;var a=t.shadowCascadeNearZ[e],o=t.shadowCascadeFarZ[e];return s[0].set(-1,-1,a),s[1].set(1,-1,a),s[2].set(-1,1,a),s[3].set(1,1,a),s[4].set(-1,-1,o),s[5].set(1,-1,o),s[6].set(-1,1,o),s[7].set(1,1,o),i}function i(t,e){var i=t.shadowCascadeArray[e];i.position.copy(t.position),i.target.position.copy(t.target.position),i.lookAt(i.target),i.shadowCameraVisible=t.shadowCameraVisible,i.shadowDarkness=t.shadowDarkness,i.shadowBias=t.shadowCascadeBias[e];var n=t.shadowCascadeNearZ[e],s=t.shadowCascadeFarZ[e],r=i.pointsFrustum;r[0].z=n,r[1].z=n,r[2].z=n,r[3].z=n,r[4].z=s,r[5].z=s,r[6].z=s,r[7].z=s}function n(t,e){var i=e.shadowCamera,n=e.pointsFrustum,s=e.pointsWorld;f.set(1/0,1/0,1/0),g.set(-(1/0),-(1/0),-(1/0));for(var r=0;r<8;r++){var a=s[r];a.copy(n[r]),tn.__projector.unprojectVector(a,t),a.applyMatrix4(i.worldMatrixInverse),a.x<f.x&&(f.x=a.x),a.x>g.x&&(g.x=a.x),a.y<f.y&&(f.y=a.y),a.y>g.y&&(g.y=a.y),a.z<f.z&&(f.z=a.z),a.z>g.z&&(g.z=a.z)}i.left=f.x,i.right=g.x,i.top=g.y,i.bottom=f.y,i.updateProjectionMatrix()}function s(t){return t.material instanceof Ke.ArrayMaterial?t.material.materials[0]:t.material}var r,a,o,h,l,c,u=new Ke.Frustum,d=new Ke.Mat4,f=new Ke.Vec3,g=new Ke.Vec3,_=new Ke.Vec3;this.init=function(t){r=t._gl,a=t;var e=Ke.ShaderLib.depthRGBA,i=Ke.UniformsUtils.clone(e.uniforms);o=new Qi({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:i}),_depthCubeMaterial=new Qi({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:i,refreshUniformsCommon:function(t){this.uniforms.isCube.value=1}}),h=new Qi({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:i,morphTargets:!0}),l=new Qi({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:i,skinning:!0}),c=new Qi({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:i,morphTargets:!0,skinning:!0}),o._shadowPass=!0,h._shadowPass=!0,l._shadowPass=!0,c._shadowPass=!0},this.render=function(t,e){a._shadowMapEnable&&this.update(t,e)},this.update=function(f,g){var p,v,m,y,A,x,w,b,S,C,T,E,L,M,P=[],k=0;r.clearColor(1,1,1,1),r.disable(r.BLEND),r.enable(r.CULL_FACE),r.frontFace(r.CCW),a.shadowMapCullFace===Ke.CullFaceFront?r.cullFace(r.FRONT):r.cullFace(r.BACK),a.setDepthTest(!0);var I=f.getLights();for(p=0,v=I.size();p<v;p++)if(L=I.get(p),L.castShadow)if(L instanceof Ke.DirectionalLight&&L.shadowCascade)for(A=0;A<L.shadowCascadeCount;A++){var R;if(L.shadowCascadeArray[A])R=L.shadowCascadeArray[A];else{R=t(L,A),R.originalCamera=g;var D=new $i;D.position=L.shadowCascadeOffset,D.add(R),D.add(R.target),g.add(D),L.shadowCascadeArray[A]=R}i(L,A),P[k]=R,k++}else P[k]=L,k++;for(p=0,v=P.length;p<v;p++){if(L=P[p],!L.shadowMap){var B=Ke.LinearFilter;a.shadowMapType===Ke.PCFSoftShadowMap&&(B=Ke.NearestFilter);var N={minFilter:B,magFilter:B,format:Ke.RGBAFormat};L instanceof Ke.PointLight?(L.shadowMap=new Si(L.shadowMapWidth,L.shadowMapHeight,N),L.shadowMapSize=new Qe(L.shadowMapWidth,L.shadowMapHeight),L.shadowMatrix=new Ke.Mat4):(L.shadowMap=new bi(L.shadowMapWidth,L.shadowMapHeight,N),L.shadowMapSize=new Qe(L.shadowMapWidth,L.shadowMapHeight),L.shadowMatrix=new Ke.Mat4)}if(!L.shadowCamera){if(L instanceof Ke.SpotLight)L.shadowCamera=new Ke.PerspectiveCamera(L.shadowCameraFov,L.shadowMapWidth/L.shadowMapHeight,L.shadowCameraNear,L.shadowCameraFar);else if(L instanceof Ke.DirectionalLight)L.shadowCamera=new Ke.OrthoCamera(L.shadowCameraLeft,L.shadowCameraRight,L.shadowCameraTop,L.shadowCameraBottom,L.shadowCameraNear,L.shadowCameraFar);else{if(!(L instanceof Ke.PointLight)){console.error("Unsupported light type for shadow");continue}L.shadowCamera=new Ke.PerspectiveCamera(90,1,L.shadowCameraNear,L.shadowCameraFar)}L.shadowCamera.updateWorldMatrix();for(var z,O=f.getRoots(),F=O.size(),V=0;V<F;V++)z=O.get(V),z.updateWorldMatrix()}L.shadowCameraVisible&&!L.cameraHelper&&(L.cameraHelper=new Ke.CameraHelper(L.shadowCamera),L.shadowCamera.addChild(L.cameraHelper),L.shadowCamera.updateWorldMatrix(!0),a.helperBox.add(L.shadowCamera),a.helperBox.add(L.cameraHelper)),L.isVirtual&&R.originalCamera==g&&n(g,L);for(var U=L instanceof Ke.PointLight?6:1,H=[new Je(1,0,0),new Je((-1),0,0),new Je(0,1,0),new Je(0,(-1),0),new Je(0,0,1),new Je(0,0,(-1))],k=0;k<U;k++)if(null==L.debugFace||k==L.debugFace){for(x=L.shadowMap,w=L.shadowMatrix,b=L.shadowCamera,b._position.setFromMatrixPosition(L.worldMatrix),L.target?_.setFromMatrixPosition(L.target.worldMatrix):_=b._position.clone().add(H[k]),b.lookAt(_),b.updateWorldMatrix(!0),b.worldMatrixInverse.getInverse(b.worldMatrix),L.cameraHelper&&(L.cameraHelper.visible=L.shadowCameraVisible),L.shadowCameraVisible&&L.cameraHelper.update(),w.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),w.multiply(b.projectionMatrix),w.multiply(b.worldMatrixInverse),d.multiplyMatrices(b.projectionMatrix,b.worldMatrixInverse),u.setFromMatrix(d),x.activeCubeFace=k,a.debugPointLight==e&&a.setRenderTarget(x),a.clear(),M=a.glNodeList,m=0,y=M.length;m<y;m++)T=M[m],E=T.node,T.render=!1,E._visible&&E.castShadow&&(!(E instanceof Ke.Node||E instanceof Ke.Particle)||!E.frustumCulled||u.intersectsObject(E))&&(E._modelViewMatrix.multiplyMatrices(b.worldMatrixInverse,E.worldMatrix),T.render=!0);var W,X,G;for(m=0,y=M.length;m<y;m++)T=M[m],T.render&&(E=T.node,S=T.group,W=s(E),X=!1,G=!1,C=E.customDepthMaterial?E.customDepthMaterial:G?X?c:l:X?h:1==U?o:_depthCubeMaterial,E instanceof Ke.BufferNode||a.renderGroup(b,f.getLights(),C,S,E))}}var Z=a.getClearColor(),Y=a.getClearAlpha();r.clearColor(Z.r,Z.g,Z.b,Y),
r.enable(r.BLEND),a.shadowMapCullFace===Ke.CullFaceFront&&r.cullFace(r.BACK)}};tn.__projector=new Ke.Projector,Ke.Picking=function(t,e,i,n,s,r){this.network=r,this.origin=t,this.cameraUp=i,this.direction=e,this.near=n||0,this.far=s||1/0,this.ray=new Ke.Ray(t,e),this.ray.direction.length>0&&this.ray.direction.normalize()},Ke.Picking.testPlane=new Ke.Plane(1,1),Ke.Picking.prototype={constructor:Ke.Picking,precision:1e-4,linePrecision:2,matrixPosition:new Ke.Vec3,set:function(t,e){this.origin=t,this.direction=e,this.ray.set(t,e),this.ray.direction.length>0&&this.ray.direction.normalize()},intersectObject:function(t,e,i){var n=[];return e===!0&&Ve(t,this,n,i),Fe(t,this,n,i),n.sort(Oe),n},intersectObjects:function(t,e,i){t._as&&(t=t._as);for(var n=[],s=0,r=t.length;s<r;s++)Fe(t[s],this,n,i,this.network),e===!0&&Ve(t[s],this,n,i,this.network);return n.sort(Oe),n}};var en=new Ke.Ray,nn=new Ke.Mat4,sn=new Ke.math.Plane,rn=new Ke.Vec3,an=new Ke.BoundingSphere,on=function(t){arguments.length>0&&this.init(t)};on.prototype.init=function(t){this.status=t,this.points=new Array},on.prototype.appendPoint=function(t){this.points.push(t)},on.prototype.appendPoints=function(t){this.points=this.points.concat(t)},on.intersectShapes=function(t,e){var i,n=t.getIntersectionParams(),s=e.getIntersectionParams();if(null!=n&&null!=s)if("Path"==n.name)i=on.intersectPathShape(t,e);else if("Path"==s.name)i=on.intersectPathShape(e,t);else{var r,a;if(n.name<s.name?(r="intersect"+n.name+s.name,a=n.params.concat(s.params)):(r="intersect"+s.name+n.name,a=s.params.concat(n.params)),!(r in on))throw new Error("Intersection not available: "+r);i=on[r].apply(null,a)}else i=new on("No Intersection");return i},on.intersectPathShape=function(t,e){return t.intersectShape(e)},on.intersectBezier2Bezier2=function(t,e,i,n,s,r){var a,o,h,l,c,u,d,f,g,_=new on("No Intersection");if(a=e.multiply(-2),h=t.add(a.add(i)),a=t.multiply(-2),o=e.multiply(2),l=a.add(o),c=new Qe(t.x,t.y),a=s.multiply(-2),u=n.add(a.add(r)),a=n.multiply(-2),o=s.multiply(2),d=a.add(o),f=new Qe(n.x,n.y),0==h.y){var p=h.x*(c.y-f.y),v=p-l.x*l.y,m=p+v,y=l.y*l.y;g=new Polynomial(h.x*u.y*u.y,2*h.x*d.y*u.y,h.x*d.y*d.y-u.x*y-u.y*p-u.y*v,-d.x*y-d.y*p-d.y*v,(c.x-f.x)*y+(c.y-f.y)*v)}else{var p=h.x*u.y-h.y*u.x,v=h.x*d.y-d.x*h.y,m=l.x*h.y-l.y*h.x,y=c.y-f.y,A=h.y*(c.x-f.x)-h.x*y,x=-l.y*m+h.y*A,w=m*m;g=new Polynomial(p*p,2*p*v,(-u.y*w+h.y*v*v+h.y*p*A+p*x)/h.y,(-d.y*w+h.y*v*A+v*x)/h.y,(y*w+A*x)/h.y)}for(var b=g.getRoots(),S=0;S<b.length;S++){var C=b[S];if(0<=C&&C<=1){var T=new Polynomial(h.x,l.x,c.x-f.x-C*d.x-C*C*u.x).getRoots(),E=new Polynomial(h.y,l.y,c.y-f.y-C*d.y-C*C*u.y).getRoots();if(T.length>0&&E.length>0){var L=1e-4;t:for(var M=0;M<T.length;M++){var P=T[M];if(0<=P&&P<=1)for(var k=0;k<E.length;k++)if(Math.abs(P-E[k])<L){_.points.push(u.multiply(C*C).add(d.multiply(C).add(f)));break t}}}}}return _.points.length>0&&(_.status="$Intersection"),_},on.intersectBezier2Bezier3=function(t,e,i,n,s,r,a){var o,h,l,c,u,d,f,g,_,p,v,m=new on("No Intersection");o=e.multiply(-2),u=t.add(o.add(i)),o=t.multiply(-2),h=e.multiply(2),d=o.add(h),f=new Qe(t.x,t.y),o=n.multiply(-1),h=s.multiply(3),l=r.multiply(-3),c=o.add(h.add(l.add(a))),g=new Vector2D(c.x,c.y),o=n.multiply(3),h=s.multiply(-6),l=r.multiply(3),c=o.add(h.add(l)),_=new Vector2D(c.x,c.y),o=n.multiply(-3),h=s.multiply(3),l=o.add(h),p=new Vector2D(l.x,l.y),v=new Vector2D(n.x,n.y);for(var y=f.x*f.x,A=f.y*f.y,x=d.x*d.x,w=d.y*d.y,b=u.x*u.x,S=u.y*u.y,C=v.x*v.x,T=v.y*v.y,E=p.x*p.x,L=p.y*p.y,M=_.x*_.x,P=_.y*_.y,k=g.x*g.x,I=g.y*g.y,R=new Polynomial(-2*u.x*u.y*g.x*g.y+b*I+S*k,-2*u.x*u.y*_.x*g.y-2*u.x*u.y*_.y*g.x+2*S*_.x*g.x+2*b*_.y*g.y,-2*u.x*p.x*u.y*g.y-2*u.x*u.y*p.y*g.x-2*u.x*u.y*_.x*_.y+2*p.x*S*g.x+S*M+b*(2*p.y*g.y+P),2*f.x*u.x*u.y*g.y+2*f.y*u.x*u.y*g.x+d.x*d.y*u.x*g.y+d.x*d.y*u.y*g.x-2*v.x*u.x*u.y*g.y-2*u.x*v.y*u.y*g.x-2*u.x*p.x*u.y*_.y-2*u.x*u.y*p.y*_.x-2*f.x*S*g.x-2*f.y*b*g.y+2*v.x*S*g.x+2*p.x*S*_.x-w*u.x*g.x-x*u.y*g.y+b*(2*v.y*g.y+2*p.y*_.y),2*f.x*u.x*u.y*_.y+2*f.y*u.x*u.y*_.x+d.x*d.y*u.x*_.y+d.x*d.y*u.y*_.x-2*v.x*u.x*u.y*_.y-2*u.x*v.y*u.y*_.x-2*u.x*p.x*u.y*p.y-2*f.x*S*_.x-2*f.y*b*_.y+2*v.x*S*_.x-w*u.x*_.x-x*u.y*_.y+E*S+b*(2*v.y*_.y+L),2*f.x*u.x*u.y*p.y+2*f.y*u.x*p.x*u.y+d.x*d.y*u.x*p.y+d.x*d.y*p.x*u.y-2*v.x*u.x*u.y*p.y-2*u.x*v.y*p.x*u.y-2*f.x*p.x*S-2*f.y*b*p.y+2*v.x*p.x*S-w*u.x*p.x-x*u.y*p.y+2*b*v.y*p.y,-2*f.x*f.y*u.x*u.y-f.x*d.x*d.y*u.y-f.y*d.x*d.y*u.x+2*f.x*u.x*v.y*u.y+2*f.y*v.x*u.x*u.y+d.x*v.x*d.y*u.y+d.x*d.y*u.x*v.y-2*v.x*u.x*v.y*u.y-2*f.x*v.x*S+f.x*w*u.x+f.y*x*u.y-2*f.y*b*v.y-v.x*w*u.x-x*v.y*u.y+y*S+A*b+C*S+b*T),D=R.getRootsInInterval(0,1),B=0;B<D.length;B++){var N=D[B],z=new Polynomial(u.x,d.x,f.x-v.x-N*p.x-N*N*_.x-N*N*N*g.x).getRoots(),O=new Polynomial(u.y,d.y,f.y-v.y-N*p.y-N*N*_.y-N*N*N*g.y).getRoots();if(z.length>0&&O.length>0){var F=1e-4;t:for(var V=0;V<z.length;V++){var U=z[V];if(0<=U&&U<=1)for(var H=0;H<O.length;H++)if(Math.abs(U-O[H])<F){m.points.push(g.multiply(N*N*N).add(_.multiply(N*N).add(p.multiply(N).add(v))));break t}}}}return m.points.length>0&&(m.status="Intersection"),m},on.intersectBezier2Circle=function(t,e,i,n,s){return on.intersectBezier2Ellipse(t,e,i,n,s,s)},on.intersectBezier2Ellipse=function(t,e,i,n,s,r){var a,o,h,l,c,u=new on("No Intersection");a=e.multiply(-2),h=t.add(a.add(i)),a=t.multiply(-2),o=e.multiply(2),l=a.add(o),c=new Qe(t.x,t.y);for(var d=s*s,f=r*r,g=new Polynomial(f*h.x*h.x+d*h.y*h.y,2*(f*h.x*l.x+d*h.y*l.y),f*(2*h.x*c.x+l.x*l.x)+d*(2*h.y*c.y+l.y*l.y)-2*(f*n.x*h.x+d*n.y*h.y),2*(f*l.x*(c.x-n.x)+d*l.y*(c.y-n.y)),f*(c.x*c.x+n.x*n.x)+d*(c.y*c.y+n.y*n.y)-2*(f*n.x*c.x+d*n.y*c.y)-d*f).getRoots(),_=0;_<g.length;_++){var p=g[_];0<=p&&p<=1&&u.points.push(h.multiply(p*p).add(l.multiply(p).add(c)))}return u.points.length>0&&(u.status="Intersection"),u},on.intersectBezier2Line=function(t,e,i,n,s){var r,a,o,h,l,c,u,d=n.min(s),f=n.max(s),g=new on("No Intersection");r=e.multiply(-2),o=t.add(r.add(i)),r=t.multiply(-2),a=e.multiply(2),h=r.add(a),l=new Qe(t.x,t.y),u=new Vector2D(n.y-s.y,s.x-n.x),c=n.x*s.y-s.x*n.y,roots=new Polynomial(u.dot(o),u.dot(h),u.dot(l)+c).getRoots();for(var _=0;_<roots.length;_++){var p=roots[_];if(0<=p&&p<=1){var v=t.lerp(e,p),m=e.lerp(i,p),y=v.lerp(m,p);n.x==s.x?d.y<=y.y&&y.y<=f.y&&(g.status="Intersection",g.appendPoint(y)):n.y==s.y?d.x<=y.x&&y.x<=f.x&&(g.status="Intersection",g.appendPoint(y)):y.gte(d)&&y.lte(f)&&(g.status="Intersection",g.appendPoint(y))}}return g},on.intersectBezier2Polygon=function(t,e,i,n){for(var s=new on("No Intersection"),r=n.length,a=0;a<r;a++){var o=n[a],h=n[(a+1)%r],l=on.intersectBezier2Line(t,e,i,o,h);s.appendPoints(l.points)}return s.points.length>0&&(s.status="Intersection"),s},on.intersectBezier2Rectangle=function(t,e,i,n,s){var r=n.min(s),a=n.max(s),o=new Qe(a.x,r.y),h=new Qe(r.x,a.y),l=on.intersectBezier2Line(t,e,i,r,o),c=on.intersectBezier2Line(t,e,i,o,a),u=on.intersectBezier2Line(t,e,i,a,h),d=on.intersectBezier2Line(t,e,i,h,r),f=new on("No Intersection");return f.appendPoints(l.points),f.appendPoints(c.points),f.appendPoints(u.points),f.appendPoints(d.points),f.points.length>0&&(f.status="Intersection"),f},on.intersectBezier3Bezier3=function(t,e,i,n,s,r,a,o){var h,l,c,u,d,f,g,_,p,v,m,y,A=new on("No Intersection");h=t.multiply(-1),l=e.multiply(3),c=i.multiply(-3),u=h.add(l.add(c.add(n))),d=new Vector2D(u.x,u.y),h=t.multiply(3),l=e.multiply(-6),c=i.multiply(3),u=h.add(l.add(c)),f=new Vector2D(u.x,u.y),h=t.multiply(-3),l=e.multiply(3),c=h.add(l),g=new Vector2D(c.x,c.y),_=new Vector2D(t.x,t.y),h=s.multiply(-1),l=r.multiply(3),c=a.multiply(-3),u=h.add(l.add(c.add(o))),p=new Vector2D(u.x,u.y),h=s.multiply(3),l=r.multiply(-6),c=a.multiply(3),u=h.add(l.add(c)),v=new Vector2D(u.x,u.y),h=s.multiply(-3),l=r.multiply(3),c=h.add(l),m=new Vector2D(c.x,c.y),y=new Vector2D(s.x,s.y);for(var x=_.x*_.x,w=_.x*_.x*_.x,b=_.y*_.y,S=_.y*_.y*_.y,C=g.x*g.x,T=g.x*g.x*g.x,E=g.y*g.y,L=g.y*g.y*g.y,M=f.x*f.x,P=f.x*f.x*f.x,k=f.y*f.y,I=f.y*f.y*f.y,R=d.x*d.x,D=d.x*d.x*d.x,B=d.y*d.y,N=d.y*d.y*d.y,z=y.x*y.x,O=y.x*y.x*y.x,F=y.y*y.y,V=y.y*y.y*y.y,U=m.x*m.x,H=m.x*m.x*m.x,W=m.y*m.y,X=v.x*v.x,G=v.x*v.x*v.x,Z=v.y*v.y,Y=p.x*p.x,j=p.x*p.x*p.x,q=p.y*p.y,K=p.y*p.y*p.y,Q=new Polynomial(-D*K+N*j-3*d.x*B*Y*p.y+3*R*d.y*p.x*q,-6*d.x*v.x*B*p.x*p.y+6*R*d.y*v.y*p.x*p.y+3*v.x*N*Y-3*D*v.y*q-3*d.x*B*v.y*Y+3*R*v.x*d.y*q,-6*m.x*d.x*B*p.x*p.y-6*d.x*v.x*B*v.y*p.x+6*R*v.x*d.y*v.y*p.y+3*m.x*N*Y+3*X*N*p.x+3*m.x*R*d.y*q-3*d.x*m.y*B*Y-3*d.x*X*B*p.y+R*d.y*p.x*(6*m.y*p.y+3*Z)+D*(-m.y*q-2*Z*p.y-p.y*(2*m.y*p.y+Z)),g.x*f.y*d.x*d.y*p.x*p.y-g.y*f.x*d.x*d.y*p.x*p.y+6*m.x*v.x*N*p.x+3*g.x*f.x*d.x*d.y*q+6*_.x*d.x*B*p.x*p.y-3*g.x*f.x*B*p.x*p.y-3*g.y*f.y*d.x*d.y*Y-6*_.y*R*d.y*p.x*p.y-6*y.x*d.x*B*p.x*p.y+3*g.y*f.y*R*p.x*p.y-2*f.x*k*d.x*p.x*p.y-6*m.x*d.x*v.x*B*p.y-6*m.x*d.x*B*v.y*p.x-6*d.x*m.y*v.x*B*p.x+6*m.x*R*d.y*v.y*p.y+2*M*f.y*d.y*p.x*p.y+G*N-3*_.x*N*Y+3*_.y*D*q+3*y.x*N*Y+I*d.x*Y-P*d.y*q-3*_.x*R*d.y*q+3*_.y*d.x*B*Y-2*g.x*f.y*R*q+g.x*f.y*B*Y-g.y*f.x*R*q+2*g.y*f.x*B*Y+3*y.x*R*d.y*q-f.x*k*d.y*Y-3*y.y*d.x*B*Y+M*f.y*d.x*q-3*d.x*X*B*v.y+R*d.y*p.x*(6*y.y*p.y+6*m.y*v.y)+R*v.x*d.y*(6*m.y*p.y+3*Z)+D*(-2*m.y*v.y*p.y-y.y*q-v.y*(2*m.y*p.y+Z)-p.y*(2*y.y*p.y+2*m.y*v.y)),6*g.x*f.x*d.x*d.y*v.y*p.y+g.x*f.y*d.x*v.x*d.y*p.y+g.x*f.y*d.x*d.y*v.y*p.x-g.y*f.x*d.x*v.x*d.y*p.y-g.y*f.x*d.x*d.y*v.y*p.x-6*g.y*f.y*d.x*v.x*d.y*p.x-6*_.x*v.x*N*p.x+6*y.x*v.x*N*p.x+6*_.y*D*v.y*p.y+2*I*d.x*v.x*p.x-2*P*d.y*v.y*p.y+6*_.x*d.x*v.x*B*p.y+6*_.x*d.x*B*v.y*p.x+6*_.y*d.x*v.x*B*p.x-3*g.x*f.x*v.x*B*p.y-3*g.x*f.x*B*v.y*p.x+2*g.x*f.y*v.x*B*p.x+4*g.y*f.x*v.x*B*p.x-6*_.x*R*d.y*v.y*p.y-6*_.y*R*v.x*d.y*p.y-6*_.y*R*d.y*v.y*p.x-4*g.x*f.y*R*v.y*p.y-6*y.x*d.x*v.x*B*p.y-6*y.x*d.x*B*v.y*p.x-2*g.y*f.x*R*v.y*p.y+3*g.y*f.y*R*v.x*p.y+3*g.y*f.y*R*v.y*p.x-2*f.x*k*d.x*v.x*p.y-2*f.x*k*d.x*v.y*p.x-2*f.x*k*v.x*d.y*p.x-6*y.y*d.x*v.x*B*p.x-6*m.x*d.x*m.y*B*p.x-6*m.x*d.x*v.x*B*v.y+6*y.x*R*d.y*v.y*p.y+2*M*f.y*d.x*v.y*p.y+2*M*f.y*v.x*d.y*p.y+2*M*f.y*d.y*v.y*p.x+3*m.x*X*N+3*U*N*p.x-3*d.x*m.y*X*B-3*U*d.x*B*p.y+R*v.x*d.y*(6*y.y*p.y+6*m.y*v.y)+R*d.y*p.x*(6*y.y*v.y+3*W)+m.x*R*d.y*(6*m.y*p.y+3*Z)+D*(-2*y.y*v.y*p.y-p.y*(2*y.y*v.y+W)-m.y*(2*m.y*p.y+Z)-v.y*(2*y.y*p.y+2*m.y*v.y)),g.x*m.x*f.y*d.x*d.y*p.y+g.x*f.y*d.x*m.y*d.y*p.x+g.x*f.y*d.x*v.x*d.y*v.y-g.y*f.x*m.x*d.x*d.y*p.y-g.y*f.x*d.x*m.y*d.y*p.x-g.y*f.x*d.x*v.x*d.y*v.y-6*g.y*m.x*f.y*d.x*d.y*p.x-6*_.x*m.x*N*p.x+6*y.x*m.x*N*p.x+2*m.x*I*d.x*p.x+6*_.x*m.x*d.x*B*p.y+6*_.x*d.x*m.y*B*p.x+6*_.x*d.x*v.x*B*v.y+6*_.y*m.x*d.x*B*p.x-3*g.x*f.x*m.x*B*p.y-3*g.x*f.x*m.y*B*p.x-3*g.x*f.x*v.x*B*v.y+2*g.x*m.x*f.y*B*p.x+4*g.y*f.x*m.x*B*p.x-6*_.y*m.x*R*d.y*p.y-6*_.y*R*m.y*d.y*p.x-6*_.y*R*v.x*d.y*v.y-6*y.x*m.x*d.x*B*p.y-6*y.x*d.x*m.y*B*p.x-6*y.x*d.x*v.x*B*v.y+3*g.y*m.x*f.y*R*p.y-3*g.y*f.y*d.x*X*d.y+3*g.y*f.y*R*m.y*p.x+3*g.y*f.y*R*v.x*v.y-2*f.x*m.x*k*d.x*p.y-2*f.x*m.x*k*d.y*p.x-2*f.x*k*d.x*m.y*p.x-2*f.x*k*d.x*v.x*v.y-6*y.y*m.x*d.x*B*p.x-6*m.x*d.x*m.y*v.x*B+6*y.y*R*m.y*d.y*p.x+2*M*m.x*f.y*d.y*p.y+2*M*f.y*m.y*d.y*p.x+2*M*f.y*v.x*d.y*v.y-3*_.x*X*N+3*y.x*X*N+3*U*v.x*N+I*d.x*X+3*_.y*d.x*X*B+g.x*f.y*X*B+2*g.y*f.x*X*B-f.x*k*X*d.y-3*y.y*d.x*X*B-3*U*d.x*B*v.y+M*f.y*d.x*(2*m.y*p.y+Z)+g.x*f.x*d.x*d.y*(6*m.y*p.y+3*Z)+m.x*R*d.y*(6*y.y*p.y+6*m.y*v.y)+P*d.y*(-2*m.y*p.y-Z)+_.y*D*(6*m.y*p.y+3*Z)+g.y*f.x*R*(-2*m.y*p.y-Z)+g.x*f.y*R*(-4*m.y*p.y-2*Z)+_.x*R*d.y*(-6*m.y*p.y-3*Z)+R*v.x*d.y*(6*y.y*v.y+3*W)+y.x*R*d.y*(6*m.y*p.y+3*Z)+D*(-2*y.y*m.y*p.y-v.y*(2*y.y*v.y+W)-y.y*(2*m.y*p.y+Z)-m.y*(2*y.y*p.y+2*m.y*v.y)),-_.x*g.x*f.y*d.x*d.y*p.y+_.x*g.y*f.x*d.x*d.y*p.y+6*_.x*g.y*f.y*d.x*d.y*p.x-6*_.y*g.x*f.x*d.x*d.y*p.y-_.y*g.x*f.y*d.x*d.y*p.x+_.y*g.y*f.x*d.x*d.y*p.x+g.x*g.y*f.x*f.y*d.x*p.y-g.x*g.y*f.x*f.y*d.y*p.x+g.x*y.x*f.y*d.x*d.y*p.y+g.x*y.y*f.y*d.x*d.y*p.x+g.x*m.x*f.y*d.x*d.y*v.y+g.x*f.y*d.x*m.y*v.x*d.y-y.x*g.y*f.x*d.x*d.y*p.y-6*y.x*g.y*f.y*d.x*d.y*p.x-g.y*f.x*y.y*d.x*d.y*p.x-g.y*f.x*m.x*d.x*d.y*v.y-g.y*f.x*d.x*m.y*v.x*d.y-6*g.y*m.x*f.y*d.x*v.x*d.y-6*_.x*y.x*N*p.x-6*_.x*m.x*v.x*N-2*_.x*I*d.x*p.x+6*y.x*m.x*v.x*N+2*y.x*I*d.x*p.x+2*m.x*I*d.x*v.x+2*_.y*P*d.y*p.y-6*_.x*_.y*d.x*B*p.x+3*_.x*g.x*f.x*B*p.y-2*_.x*g.x*f.y*B*p.x-4*_.x*g.y*f.x*B*p.x+3*_.y*g.x*f.x*B*p.x+6*_.x*_.y*R*d.y*p.y+6*_.x*y.x*d.x*B*p.y-3*_.x*g.y*f.y*R*p.y+2*_.x*f.x*k*d.x*p.y+2*_.x*f.x*k*d.y*p.x+6*_.x*y.y*d.x*B*p.x+6*_.x*m.x*d.x*B*v.y+6*_.x*d.x*m.y*v.x*B+4*_.y*g.x*f.y*R*p.y+6*_.y*y.x*d.x*B*p.x+2*_.y*g.y*f.x*R*p.y-3*_.y*g.y*f.y*R*p.x+2*_.y*f.x*k*d.x*p.x+6*_.y*m.x*d.x*v.x*B-3*g.x*y.x*f.x*B*p.y+2*g.x*y.x*f.y*B*p.x+g.x*g.y*k*d.x*p.x-3*g.x*f.x*y.y*B*p.x-3*g.x*f.x*m.x*B*v.y-3*g.x*f.x*m.y*v.x*B+2*g.x*m.x*f.y*v.x*B+4*y.x*g.y*f.x*B*p.x+4*g.y*f.x*m.x*v.x*B-2*_.x*M*f.y*d.y*p.y-6*_.y*y.x*R*d.y*p.y-6*_.y*y.y*R*d.y*p.x-6*_.y*m.x*R*d.y*v.y-2*_.y*M*f.y*d.x*p.y-2*_.y*M*f.y*d.y*p.x-6*_.y*R*m.y*v.x*d.y-g.x*g.y*M*d.y*p.y-2*g.x*E*d.x*d.y*p.x+3*y.x*g.y*f.y*R*p.y-2*y.x*f.x*k*d.x*p.y-2*y.x*f.x*k*d.y*p.x-6*y.x*y.y*d.x*B*p.x-6*y.x*m.x*d.x*B*v.y-6*y.x*d.x*m.y*v.x*B+3*g.y*y.y*f.y*R*p.x+3*g.y*m.x*f.y*R*v.y+3*g.y*f.y*R*m.y*v.x-2*f.x*y.y*k*d.x*p.x-2*f.x*m.x*k*d.x*v.y-2*f.x*m.x*k*v.x*d.y-2*f.x*k*d.x*m.y*v.x-6*y.y*m.x*d.x*v.x*B-E*f.x*f.y*d.x*p.x+2*y.x*M*f.y*d.y*p.y+6*y.y*R*m.y*v.x*d.y+2*C*g.y*d.x*d.y*p.y+C*f.x*f.y*d.y*p.y+2*M*y.y*f.y*d.y*p.x+2*M*m.x*f.y*d.y*v.y+2*M*f.y*m.y*v.x*d.y+H*N+3*x*N*p.x-3*b*D*p.y+3*z*N*p.x+L*R*p.x-T*B*p.y-g.x*E*R*p.y+C*g.y*B*p.x-3*x*d.x*B*p.y+3*b*R*d.y*p.x-C*k*d.x*p.y+E*M*d.y*p.x-3*U*d.x*m.y*B-3*z*d.x*B*p.y+3*F*R*d.y*p.x+g.x*f.x*d.x*d.y*(6*y.y*p.y+6*m.y*v.y)+P*d.y*(-2*y.y*p.y-2*m.y*v.y)+_.y*D*(6*y.y*p.y+6*m.y*v.y)+g.y*f.x*R*(-2*y.y*p.y-2*m.y*v.y)+M*f.y*d.x*(2*y.y*p.y+2*m.y*v.y)+g.x*f.y*R*(-4*y.y*p.y-4*m.y*v.y)+_.x*R*d.y*(-6*y.y*p.y-6*m.y*v.y)+y.x*R*d.y*(6*y.y*p.y+6*m.y*v.y)+m.x*R*d.y*(6*y.y*v.y+3*W)+D*(-2*y.y*m.y*v.y-F*p.y-m.y*(2*y.y*v.y+W)-y.y*(2*y.y*p.y+2*m.y*v.y)),-_.x*g.x*f.y*d.x*d.y*v.y+_.x*g.y*f.x*d.x*d.y*v.y+6*_.x*g.y*f.y*d.x*v.x*d.y-6*_.y*g.x*f.x*d.x*d.y*v.y-_.y*g.x*f.y*d.x*v.x*d.y+_.y*g.y*f.x*d.x*v.x*d.y+g.x*g.y*f.x*f.y*d.x*v.y-g.x*g.y*f.x*f.y*v.x*d.y+g.x*y.x*f.y*d.x*d.y*v.y+g.x*y.y*f.y*d.x*v.x*d.y+g.x*m.x*f.y*d.x*m.y*d.y-y.x*g.y*f.x*d.x*d.y*v.y-6*y.x*g.y*f.y*d.x*v.x*d.y-g.y*f.x*y.y*d.x*v.x*d.y-g.y*f.x*m.x*d.x*m.y*d.y-6*_.x*y.x*v.x*N-2*_.x*I*d.x*v.x+2*y.x*I*d.x*v.x+2*_.y*P*d.y*v.y-6*_.x*_.y*d.x*v.x*B+3*_.x*g.x*f.x*B*v.y-2*_.x*g.x*f.y*v.x*B-4*_.x*g.y*f.x*v.x*B+3*_.y*g.x*f.x*v.x*B+6*_.x*_.y*R*d.y*v.y+6*_.x*y.x*d.x*B*v.y-3*_.x*g.y*f.y*R*v.y+2*_.x*f.x*k*d.x*v.y+2*_.x*f.x*k*v.x*d.y+6*_.x*y.y*d.x*v.x*B+6*_.x*m.x*d.x*m.y*B+4*_.y*g.x*f.y*R*v.y+6*_.y*y.x*d.x*v.x*B+2*_.y*g.y*f.x*R*v.y-3*_.y*g.y*f.y*R*v.x+2*_.y*f.x*k*d.x*v.x-3*g.x*y.x*f.x*B*v.y+2*g.x*y.x*f.y*v.x*B+g.x*g.y*k*d.x*v.x-3*g.x*f.x*y.y*v.x*B-3*g.x*f.x*m.x*m.y*B+4*y.x*g.y*f.x*v.x*B-2*_.x*M*f.y*d.y*v.y-6*_.y*y.x*R*d.y*v.y-6*_.y*y.y*R*v.x*d.y-6*_.y*m.x*R*m.y*d.y-2*_.y*M*f.y*d.x*v.y-2*_.y*M*f.y*v.x*d.y-g.x*g.y*M*d.y*v.y-2*g.x*E*d.x*v.x*d.y+3*y.x*g.y*f.y*R*v.y-2*y.x*f.x*k*d.x*v.y-2*y.x*f.x*k*v.x*d.y-6*y.x*y.y*d.x*v.x*B-6*y.x*m.x*d.x*m.y*B+3*g.y*y.y*f.y*R*v.x+3*g.y*m.x*f.y*R*m.y-2*f.x*y.y*k*d.x*v.x-2*f.x*m.x*k*d.x*m.y-E*f.x*f.y*d.x*v.x+2*y.x*M*f.y*d.y*v.y-3*g.y*U*f.y*d.x*d.y+6*y.y*m.x*R*m.y*d.y+2*C*g.y*d.x*d.y*v.y+C*f.x*f.y*d.y*v.y+2*M*y.y*f.y*v.x*d.y+2*M*m.x*f.y*m.y*d.y-3*_.x*U*N+3*y.x*U*N+3*x*v.x*N-3*b*D*v.y+3*z*v.x*N+U*I*d.x+L*R*v.x-T*B*v.y+3*_.y*U*d.x*B-g.x*E*R*v.y+g.x*U*f.y*B+2*g.y*f.x*U*B+C*g.y*v.x*B-f.x*U*k*d.y-3*y.y*U*d.x*B-3*x*d.x*B*v.y+3*b*R*v.x*d.y-C*k*d.x*v.y+E*M*v.x*d.y-3*z*d.x*B*v.y+3*F*R*v.x*d.y+M*f.y*d.x*(2*y.y*v.y+W)+g.x*f.x*d.x*d.y*(6*y.y*v.y+3*W)+P*d.y*(-2*y.y*v.y-W)+_.y*D*(6*y.y*v.y+3*W)+g.y*f.x*R*(-2*y.y*v.y-W)+g.x*f.y*R*(-4*y.y*v.y-2*W)+_.x*R*d.y*(-6*y.y*v.y-3*W)+y.x*R*d.y*(6*y.y*v.y+3*W)+D*(-2*y.y*W-F*v.y-y.y*(2*y.y*v.y+W)),-_.x*g.x*f.y*d.x*m.y*d.y+_.x*g.y*f.x*d.x*m.y*d.y+6*_.x*g.y*m.x*f.y*d.x*d.y-6*_.y*g.x*f.x*d.x*m.y*d.y-_.y*g.x*m.x*f.y*d.x*d.y+_.y*g.y*f.x*m.x*d.x*d.y-g.x*g.y*f.x*m.x*f.y*d.y+g.x*g.y*f.x*f.y*d.x*m.y+g.x*y.x*f.y*d.x*m.y*d.y+6*g.x*f.x*y.y*d.x*m.y*d.y+g.x*y.y*m.x*f.y*d.x*d.y-y.x*g.y*f.x*d.x*m.y*d.y-6*y.x*g.y*m.x*f.y*d.x*d.y-g.y*f.x*y.y*m.x*d.x*d.y-6*_.x*y.x*m.x*N-2*_.x*m.x*I*d.x+6*_.y*y.y*D*m.y+2*y.x*m.x*I*d.x+2*_.y*P*m.y*d.y-2*P*y.y*m.y*d.y-6*_.x*_.y*m.x*d.x*B+3*_.x*g.x*f.x*m.y*B-2*_.x*g.x*m.x*f.y*B-4*_.x*g.y*f.x*m.x*B+3*_.y*g.x*f.x*m.x*B+6*_.x*_.y*R*m.y*d.y+6*_.x*y.x*d.x*m.y*B-3*_.x*g.y*f.y*R*m.y+2*_.x*f.x*m.x*k*d.y+2*_.x*f.x*k*d.x*m.y+6*_.x*y.y*m.x*d.x*B+4*_.y*g.x*f.y*R*m.y+6*_.y*y.x*m.x*d.x*B+2*_.y*g.y*f.x*R*m.y-3*_.y*g.y*m.x*f.y*R+2*_.y*f.x*m.x*k*d.x-3*g.x*y.x*f.x*m.y*B+2*g.x*y.x*m.x*f.y*B+g.x*g.y*m.x*k*d.x-3*g.x*f.x*y.y*m.x*B+4*y.x*g.y*f.x*m.x*B-6*_.x*y.y*R*m.y*d.y-2*_.x*M*f.y*m.y*d.y-6*_.y*y.x*R*m.y*d.y-6*_.y*y.y*m.x*R*d.y-2*_.y*M*m.x*f.y*d.y-2*_.y*M*f.y*d.x*m.y-g.x*g.y*M*m.y*d.y-4*g.x*y.y*f.y*R*m.y-2*g.x*E*m.x*d.x*d.y+3*y.x*g.y*f.y*R*m.y-2*y.x*f.x*m.x*k*d.y-2*y.x*f.x*k*d.x*m.y-6*y.x*y.y*m.x*d.x*B-2*g.y*f.x*y.y*R*m.y+3*g.y*y.y*m.x*f.y*R-2*f.x*y.y*m.x*k*d.x-E*f.x*m.x*f.y*d.x+6*y.x*y.y*R*m.y*d.y+2*y.x*M*f.y*m.y*d.y+2*C*g.y*d.x*m.y*d.y+C*f.x*f.y*m.y*d.y+2*M*y.y*m.x*f.y*d.y+2*M*y.y*f.y*d.x*m.y+3*x*m.x*N-3*b*D*m.y+3*z*m.x*N+L*m.x*R-T*m.y*B-3*F*D*m.y-g.x*E*R*m.y+C*g.y*m.x*B-3*x*d.x*m.y*B+3*b*m.x*R*d.y-C*k*d.x*m.y+E*M*m.x*d.y-3*z*d.x*m.y*B+3*F*m.x*R*d.y,_.x*_.y*g.x*f.y*d.x*d.y-_.x*_.y*g.y*f.x*d.x*d.y+_.x*g.x*g.y*f.x*f.y*d.y-_.y*g.x*g.y*f.x*f.y*d.x-_.x*g.x*y.y*f.y*d.x*d.y+6*_.x*y.x*g.y*f.y*d.x*d.y+_.x*g.y*f.x*y.y*d.x*d.y-_.y*g.x*y.x*f.y*d.x*d.y-6*_.y*g.x*f.x*y.y*d.x*d.y+_.y*y.x*g.y*f.x*d.x*d.y-g.x*y.x*g.y*f.x*f.y*d.y+g.x*g.y*f.x*y.y*f.y*d.x+g.x*y.x*y.y*f.y*d.x*d.y-y.x*g.y*f.x*y.y*d.x*d.y-2*_.x*y.x*I*d.x+2*_.y*P*y.y*d.y-3*_.x*_.y*g.x*f.x*B-6*_.x*_.y*y.x*d.x*B+3*_.x*_.y*g.y*f.y*R-2*_.x*_.y*f.x*k*d.x-2*_.x*g.x*y.x*f.y*B-_.x*g.x*g.y*k*d.x+3*_.x*g.x*f.x*y.y*B-4*_.x*y.x*g.y*f.x*B+3*_.y*g.x*y.x*f.x*B+6*_.x*_.y*y.y*R*d.y+2*_.x*_.y*M*f.y*d.y+2*_.x*g.x*E*d.x*d.y+2*_.x*y.x*f.x*k*d.y+6*_.x*y.x*y.y*d.x*B-3*_.x*g.y*y.y*f.y*R+2*_.x*f.x*y.y*k*d.x+_.x*E*f.x*f.y*d.x+_.y*g.x*g.y*M*d.y+4*_.y*g.x*y.y*f.y*R-3*_.y*y.x*g.y*f.y*R+2*_.y*y.x*f.x*k*d.x+2*_.y*g.y*f.x*y.y*R+g.x*y.x*g.y*k*d.x-3*g.x*y.x*f.x*y.y*B-2*_.x*M*y.y*f.y*d.y-6*_.y*y.x*y.y*R*d.y-2*_.y*y.x*M*f.y*d.y-2*_.y*C*g.y*d.x*d.y-_.y*C*f.x*f.y*d.y-2*_.y*M*y.y*f.y*d.x-2*g.x*y.x*E*d.x*d.y-g.x*g.y*M*y.y*d.y+3*y.x*g.y*y.y*f.y*R-2*y.x*f.x*y.y*k*d.x-y.x*E*f.x*f.y*d.x+3*b*g.x*f.x*d.x*d.y+3*g.x*f.x*F*d.x*d.y+2*y.x*M*y.y*f.y*d.y-3*x*g.y*f.y*d.x*d.y+2*C*g.y*y.y*d.x*d.y+C*f.x*y.y*f.y*d.y-3*z*g.y*f.y*d.x*d.y-w*N+S*D+O*N-V*D-3*_.x*z*N-_.x*L*R+3*x*y.x*N+_.y*T*B+3*_.y*F*D+y.x*L*R+x*I*d.x-3*b*y.y*D-b*P*d.y+z*I*d.x-T*y.y*B-P*F*d.y-_.x*C*g.y*B+_.y*g.x*E*R-3*_.x*b*R*d.y-_.x*E*M*d.y+_.y*C*k*d.x-g.x*E*y.y*R+3*x*_.y*d.x*B+x*g.x*f.y*B+2*x*g.y*f.x*B-2*b*g.x*f.y*R-b*g.y*f.x*R+C*y.x*g.y*B-3*_.x*F*R*d.y+3*_.y*z*d.x*B+g.x*z*f.y*B-2*g.x*F*f.y*R+y.x*E*M*d.y-g.y*f.x*F*R-x*f.x*k*d.y-3*x*y.y*d.x*B+3*b*y.x*R*d.y+b*M*f.y*d.x-C*y.y*k*d.x+2*z*g.y*f.x*B+3*y.x*F*R*d.y-z*f.x*k*d.y-3*z*y.y*d.x*B+M*F*f.y*d.x),J=Q.getRootsInInterval(0,1),$=0;$<J.length;$++){var tt=J[$],et=new Polynomial(d.x,f.x,g.x,_.x-y.x-tt*m.x-tt*tt*v.x-tt*tt*tt*p.x).getRoots(),it=new Polynomial(d.y,f.y,g.y,_.y-y.y-tt*m.y-tt*tt*v.y-tt*tt*tt*p.y).getRoots();if(et.length>0&&it.length>0){var nt=1e-4;t:for(var st=0;st<et.length;st++){var rt=et[st];if(0<=rt&&rt<=1)for(var at=0;at<it.length;at++)if(Math.abs(rt-it[at])<nt){A.points.push(p.multiply(tt*tt*tt).add(v.multiply(tt*tt).add(m.multiply(tt).add(y))));break t}}}}return A.points.length>0&&(A.status="Intersection"),A},on.intersectBezier3Circle=function(t,e,i,n,s,r){return on.intersectBezier3Ellipse(t,e,i,n,s,r,r)},on.intersectBezier3Ellipse=function(t,e,i,n,s,r,a){var o,h,l,c,u,d,f,g,_=new on("No Intersection");o=t.multiply(-1),h=e.multiply(3),l=i.multiply(-3),c=o.add(h.add(l.add(n))),u=new Vector2D(c.x,c.y),o=t.multiply(3),h=e.multiply(-6),l=i.multiply(3),c=o.add(h.add(l)),d=new Vector2D(c.x,c.y),o=t.multiply(-3),h=e.multiply(3),l=o.add(h),f=new Vector2D(l.x,l.y),g=new Vector2D(t.x,t.y);for(var p=r*r,v=a*a,m=new Polynomial(u.x*u.x*v+u.y*u.y*p,2*(u.x*d.x*v+u.y*d.y*p),2*(u.x*f.x*v+u.y*f.y*p)+d.x*d.x*v+d.y*d.y*p,2*u.x*v*(g.x-s.x)+2*u.y*p*(g.y-s.y)+2*(d.x*f.x*v+d.y*f.y*p),2*d.x*v*(g.x-s.x)+2*d.y*p*(g.y-s.y)+f.x*f.x*v+f.y*f.y*p,2*f.x*v*(g.x-s.x)+2*f.y*p*(g.y-s.y),g.x*g.x*v-2*g.y*s.y*p-2*g.x*s.x*v+g.y*g.y*p+s.x*s.x*v+s.y*s.y*p-p*v),y=m.getRootsInInterval(0,1),A=0;A<y.length;A++){var x=y[A];_.points.push(u.multiply(x*x*x).add(d.multiply(x*x).add(f.multiply(x).add(g))))}return _.points.length>0&&(_.status="Intersection"),_},on.intersectBezier3Line=function(t,e,i,n,s,r){var a,o,h,l,c,u,d,f,g,_,p=s.min(r),v=s.max(r),m=new on("No Intersection");a=t.multiply(-1),o=e.multiply(3),h=i.multiply(-3),l=a.add(o.add(h.add(n))),c=new Vector2D(l.x,l.y),a=t.multiply(3),o=e.multiply(-6),h=i.multiply(3),l=a.add(o.add(h)),u=new Vector2D(l.x,l.y),a=t.multiply(-3),o=e.multiply(3),h=a.add(o),d=new Vector2D(h.x,h.y),f=new Vector2D(t.x,t.y),_=new Vector2D(s.y-r.y,r.x-s.x),g=s.x*r.y-r.x*s.y,roots=new Polynomial(_.dot(c),_.dot(u),_.dot(d),_.dot(f)+g).getRoots();for(var y=0;y<roots.length;y++){var A=roots[y];if(0<=A&&A<=1){var x=t.lerp(e,A),w=e.lerp(i,A),b=i.lerp(n,A),S=x.lerp(w,A),C=w.lerp(b,A),T=S.lerp(C,A);s.x==r.x?p.y<=T.y&&T.y<=v.y&&(m.status="Intersection",m.appendPoint(T)):s.y==r.y?p.x<=T.x&&T.x<=v.x&&(m.status="Intersection",m.appendPoint(T)):T.gte(p)&&T.lte(v)&&(m.status="Intersection",m.appendPoint(T))}}return m},on.intersectBezier3Polygon=function(t,e,i,n,s){for(var r=new on("No Intersection"),a=s.length,o=0;o<a;o++){var h=s[o],l=s[(o+1)%a],c=on.intersectBezier3Line(t,e,i,n,h,l);r.appendPoints(c.points)}return r.points.length>0&&(r.status="Intersection"),r},on.intersectBezier3Rectangle=function(t,e,i,n,s,r){var a=s.min(r),o=s.max(r),h=new Qe(o.x,a.y),l=new Qe(a.x,o.y),c=on.intersectBezier3Line(t,e,i,n,a,h),u=on.intersectBezier3Line(t,e,i,n,h,o),d=on.intersectBezier3Line(t,e,i,n,o,l),f=on.intersectBezier3Line(t,e,i,n,l,a),g=new on("No Intersection");return g.appendPoints(c.points),g.appendPoints(u.points),g.appendPoints(d.points),g.appendPoints(f.points),g.points.length>0&&(g.status="Intersection"),g},on.intersectCircleCircle=function(t,e,i,n){var s,r=e+n,a=Math.abs(e-n),o=t.distanceFrom(i);if(o>r)s=new on("Outside");else if(o<a)s=new on("Inside");else{s=new on("Intersection");var h=(e*e-n*n+o*o)/(2*o),l=Math.sqrt(e*e-h*h),c=t.lerp(i,h/o),u=l/o;s.points.push(new Qe(c.x-u*(i.y-t.y),c.y+u*(i.x-t.x))),s.points.push(new Qe(c.x+u*(i.y-t.y),c.y-u*(i.x-t.x)))}return s},on.intersectCircleEllipse=function(t,e,i,n,s){return on.intersectEllipseEllipse(t,e,e,i,n,s)},on.intersectCircleLine=function(t,e,i,n){var s,r=(n.x-i.x)*(n.x-i.x)+(n.y-i.y)*(n.y-i.y),a=2*((n.x-i.x)*(i.x-t.x)+(n.y-i.y)*(i.y-t.y)),o=t.x*t.x+t.y*t.y+i.x*i.x+i.y*i.y-2*(t.x*i.x+t.y*i.y)-e*e,h=a*a-4*r*o;if(h<0)s=new on("Outside");else if(0==h)s=new on("Tangent");else{var l=Math.sqrt(h),c=(-a+l)/(2*r),u=(-a-l)/(2*r);(c<0||c>1)&&(u<0||u>1)?s=new on(c<0&&u<0||c>1&&u>1?"Outside":"Inside"):(s=new on("Intersection"),0<=c&&c<=1&&s.points.push(i.lerp(n,c)),0<=u&&u<=1&&s.points.push(i.lerp(n,u)))}return s},on.intersectCirclePolygon=function(t,e,i){for(var n,s=new on("No Intersection"),r=i.length,a=0;a<r;a++){var o=i[a],h=i[(a+1)%r];n=on.intersectCircleLine(t,e,o,h),s.appendPoints(n.points)}return s.points.length>0?s.status="Intersection":s.status=n.status,s},on.intersectCircleRectangle=function(t,e,i,n){var s=i.min(n),r=i.max(n),a=new Qe(r.x,s.y),o=new Qe(s.x,r.y),h=on.intersectCircleLine(t,e,s,a),l=on.intersectCircleLine(t,e,a,r),c=on.intersectCircleLine(t,e,r,o),u=on.intersectCircleLine(t,e,o,s),d=new on("No Intersection");return d.appendPoints(h.points),d.appendPoints(l.points),d.appendPoints(c.points),d.appendPoints(u.points),d.points.length>0?d.status="Intersection":d.status=h.status,d},on.intersectEllipseEllipse=function(t,e,i,n,s,r){for(var a=[i*i,0,e*e,-2*i*i*t.x,-2*e*e*t.y,i*i*t.x*t.x+e*e*t.y*t.y-e*e*i*i],o=[r*r,0,s*s,-2*r*r*n.x,-2*s*s*n.y,r*r*n.x*n.x+s*s*n.y*n.y-s*s*r*r],h=on.bezout(a,o),l=h.getRoots(),c=.001,u=(a[0]*a[0]+2*a[1]*a[1]+a[2]*a[2])*c,d=(o[0]*o[0]+2*o[1]*o[1]+o[2]*o[2])*c,f=new on("No Intersection"),g=0;g<l.length;g++)for(var _=new Polynomial(a[0],a[3]+l[g]*a[1],a[5]+l[g]*(a[4]+l[g]*a[2])),p=_.getRoots(),v=0;v<p.length;v++){var m=(a[0]*p[v]+a[1]*l[g]+a[3])*p[v]+(a[2]*l[g]+a[4])*l[g]+a[5];Math.abs(m)<u&&(m=(o[0]*p[v]+o[1]*l[g]+o[3])*p[v]+(o[2]*l[g]+o[4])*l[g]+o[5],Math.abs(m)<d&&f.appendPoint(new Qe(p[v],l[g])))}return f.points.length>0&&(f.status="Intersection"),f},on.intersectEllipseLine=function(t,e,i,n,s){var r,a=new Vector2D(n.x,n.y),o=Vector2D.fromPoints(n,s),h=new Vector2D(t.x,t.y),l=a.subtract(h),c=new Vector2D(o.x/(e*e),o.y/(i*i)),u=new Vector2D(l.x/(e*e),l.y/(i*i)),d=o.dot(c),f=o.dot(u),t=l.dot(u)-1,g=f*f-d*t;if(g<0)r=new on("Outside");else if(g>0){var _=Math.sqrt(g),p=(-f-_)/d,v=(-f+_)/d;(p<0||1<p)&&(v<0||1<v)?r=new on(p<0&&v<0||p>1&&v>1?"Outside":"Inside"):(r=new on("Intersection"),0<=p&&p<=1&&r.appendPoint(n.lerp(s,p)),0<=v&&v<=1&&r.appendPoint(n.lerp(s,v)))}else{var m=-f/d;0<=m&&m<=1?(r=new on("Intersection"),r.appendPoint(n.lerp(s,m))):r=new on("Outside")}return r},on.intersectEllipsePolygon=function(t,e,i,n){for(var s=new on("No Intersection"),r=n.length,a=0;a<r;a++){var o=n[a],h=n[(a+1)%r],l=on.intersectEllipseLine(t,e,i,o,h);s.appendPoints(l.points)}return s.points.length>0&&(s.status="Intersection"),s},on.intersectEllipseRectangle=function(t,e,i,n,s){var r=n.min(s),a=n.max(s),o=new Qe(a.x,r.y),h=new Qe(r.x,a.y),l=on.intersectEllipseLine(t,e,i,r,o),c=on.intersectEllipseLine(t,e,i,o,a),u=on.intersectEllipseLine(t,e,i,a,h),d=on.intersectEllipseLine(t,e,i,h,r),f=new on("No Intersection");return f.appendPoints(l.points),f.appendPoints(c.points),f.appendPoints(u.points),f.appendPoints(d.points),f.points.length>0&&(f.status="Intersection"),f},on.intersectLineLine=function(t,e,i,n){var s,r=(n.x-i.x)*(t.y-i.y)-(n.y-i.y)*(t.x-i.x),a=(e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x),o=(n.y-i.y)*(e.x-t.x)-(n.x-i.x)*(e.y-t.y);if(0!=o){var h=r/o,l=a/o;0<=h&&h<=1&&0<=l&&l<=1?(s=new on("Intersection"),s.points.push(new Qe(t.x+h*(e.x-t.x),t.y+h*(e.y-t.y)))):s=new on("No Intersection")}else s=new on(0==r||0==a?"Coincident":"Parallel");return s},on.intersectLinePolygon=function(t,e,i){for(var n=new on("No Intersection"),s=i.length,r=0;r<s;r++){var a=i[r],o=i[(r+1)%s],h=on.intersectLineLine(t,e,a,o);n.appendPoints(h.points)}return n.points.length>0&&(n.status="Intersection"),n},on.intersectLineRectangle=function(t,e,i,n){var s=i.min(n),r=i.max(n),a=new Qe(r.x,s.y),o=new Qe(s.x,r.y),h=on.intersectLineLine(s,a,t,e),l=on.intersectLineLine(a,r,t,e),c=on.intersectLineLine(r,o,t,e),u=on.intersectLineLine(o,s,t,e),d=new on("No Intersection");return d.appendPoints(h.points),d.appendPoints(l.points),d.appendPoints(c.points),d.appendPoints(u.points),d.points.length>0&&(d.status="Intersection"),d},on.intersectPolygonPolygon=function(t,e){for(var i=new on("No Intersection"),n=t.length,s=0;s<n;s++){var r=t[s],a=t[(s+1)%n],o=on.intersectLinePolygon(r,a,e);i.appendPoints(o.points)}return i.points.length>0&&(i.status="Intersection"),i},on.intersectPolygonRectangle=function(t,e,i){var n=e.min(i),s=e.max(i),r=new Qe(s.x,n.y),a=new Qe(n.x,s.y),o=on.intersectLinePolygon(n,r,t),h=on.intersectLinePolygon(r,s,t),l=on.intersectLinePolygon(s,a,t),c=on.intersectLinePolygon(a,n,t),u=new on("No Intersection");return u.appendPoints(o.points),u.appendPoints(h.points),u.appendPoints(l.points),u.appendPoints(c.points),u.points.length>0&&(u.status="Intersection"),u},on.intersectRayRay=function(t,e,i,n){var s,r=(n.x-i.x)*(t.y-i.y)-(n.y-i.y)*(t.x-i.x),a=(e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x),o=(n.y-i.y)*(e.x-t.x)-(n.x-i.x)*(e.y-t.y);if(0!=o){var h=r/o;s=new on("Intersection"),s.points.push(new Qe(t.x+h*(e.x-t.x),t.y+h*(e.y-t.y)))}else s=new on(0==r||0==a?"Coincident":"Parallel");return s},on.intersectRectangleRectangle=function(t,e,i,n){var s=t.min(e),r=t.max(e),a=new Qe(r.x,s.y),o=new Qe(s.x,r.y),h=on.intersectLineRectangle(s,a,i,n),l=on.intersectLineRectangle(a,r,i,n),c=on.intersectLineRectangle(r,o,i,n),u=on.intersectLineRectangle(o,s,i,n),d=new on("No Intersection");return d.appendPoints(h.points),d.appendPoints(l.points),d.appendPoints(c.points),d.appendPoints(u.points),d.points.length>0&&(d.status="Intersection"),d},on.bezout=function(t,e){var i=t[0]*e[1]-e[0]*t[1],n=t[0]*e[2]-e[0]*t[2],s=t[0]*e[3]-e[0]*t[3],r=t[0]*e[4]-e[0]*t[4],a=t[0]*e[5]-e[0]*t[5],o=t[1]*e[2]-e[1]*t[2],h=t[1]*e[4]-e[1]*t[4],l=t[1]*e[5]-e[1]*t[5],c=t[2]*e[3]-e[2]*t[3],u=t[3]*e[4]-e[3]*t[4],d=t[3]*e[5]-e[3]*t[5],f=l+u,g=h-c;return new Polynomial(i*o-n*n,i*g+s*o-2*n*r,i*f+s*g-r*r-2*n*a,i*d+s*f-2*r*a,s*d-a*a)},Ke.Intersection=on,Ke.AreaPicking=function(t,e){this.network=t,this.bounding=e,this.cache={}},Ke.extend(Ke.AreaPicking,Object,{intersectObjects:function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i];this.intersectObject(n,e)}return e},getViewPoint:function(t,e){var i=e.vertices[t].clone(),n=this.cache[e.getId()][i.x+" "+i.y+" "+i.z];return n?n:(i.applyMatrix4(e.worldMatrix),n=this.network.getViewPosition(i),n.y=n.h-n.y,n)},intersectObject:function(t,e){if(t instanceof Ke.Entity){this.cache[t.getId()]={};for(var i=0;i<t.vertices.length;i++){var n=t.vertices[i].clone();n.applyMatrix4(t.worldMatrix);var s=this.network.getViewPosition(n);if(s.y=s.h-s.y,this.cache[t.getId()][n.x+" "+n.y+" "+n.z]=s,s.x>this.bounding.x&&s.y>this.bounding.y&&s.x<this.bounding.x+this.bounding.w&&s.y<this.bounding.y+this.bounding.h){var r={element:t};return void e.push(r)}}}}}),Ke.BaseInteraction=function(t){this.network=t,this.view=t.getView()||document},Ke.addEventListener=function(t,e,i,n){var s="_"+t+"_";if(!n[s]){var r=function(t){n[e](t)};n[s]=r,i.addEventListener(t,r,!1)}},Ke.removeEventListener=function(t,e,i){var n="_"+t+"_",s=i[n];s&&(e.removeEventListener(t,s,!1),delete i[n])},Ke.extend(Ke.BaseInteraction,Object,{onPropertyChange:function(){},firePropertyChange:function(){},setUp:function(){},tearDown:function(){},update:function(){},addListener:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];Ke.addEventListener(e,"handle_"+e,this.network.getRootView(),this)}},removeListener:function(){for(var t=0;t<arguments.length;t++){arguments[t];Ke.removeEventListener(arguments[t],this.network.getRootView(),this)}},isCtrlDown:function(t){return t.ctrlKey||t.metaKey},isFinished:function(){return!0}}),Ke.DefaultInteraction=function(e){Ke.BaseInteraction.call(this,e),this.screen={width:0,height:0,offsetLeft:0,offsetTop:0},this.radius=this.screen.width/4,this.domElement=this.network.getRootView(),this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.easing=!0,this.dynamicDampingFactor=.05,this.timeInterval=2e3,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.lastPosition=new Ke.Vec3;var i,n,s=this.STATE.NONE,r=(this.STATE.NONE,new Ke.Vec3),a=new Ke.Vec3,o=new Ke.Vec3,h=new Ke.Vec2,l=new Ke.Vec2,c=0,u=0,d=new Ke.Vec2,f=new Ke.Vec2;this.object=this.network._camera,this.object.target||(this.object.target=new Ke.Vec3),this.movementSpeed=1,this.lookSpeed=.005,this.verticalLookRatio=.1,this.keyboardEnable=!0,this.lookVertical=!0,this.autoForward=!1,this.fpsMode=!1,this.dragMode=!0,this.activeLook=!1,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalFixed=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.freeze=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0,this.lastX=0,this.lastY=0,this.touchSeq=[1,2,3],this.network.getRootView().addEventListener("contextmenu",function(t){t.preventDefault()},!1),this.yRistrict=!0,this.yLowerLimitAngle=-Math.PI/2,this.yUpLimitAngle=Math.PI/2,this.updateIntervalTime=0;var g=null;this.handleResize=function(){this.screen.width=t.innerWidth,this.screen.height=t.innerHeight,this.screen.offsetLeft=0,this.screen.offsetTop=0,this.radius=(this.screen.width+this.screen.height)/4},this.handleResize(),this.handle_mousedown=function(t){if(!ei.isCtrlDown(t)){if(t.preventDefault(),this.fpsMode){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(t.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.lastX=t.pageX,this.lastY=t.pageY,
this.mouseDragOn=!0}else s===this.STATE.NONE&&(s=t.button),s!==this.STATE.ROTATE||this.noRotate?this.state!==this.STATE.ZOOM||this.noZoom?s===this.STATE.PAN&&!this.noPan&&(d=f=this.getMouseOnScreen(t.clientX,t.clientY)):h=l=this.getMouseOnScreen(t.clientX,t.clientY):(a=o=this.getMouseProjectionOnBall(t.clientX,t.clientY),i=n=this.getRotateY(t.clientX,t.clientY));this.beforeUpdate(),this.addListener("mousemove","mouseup")}},this.handle_mousemove=function(t){if(!t.stop){t.preventDefault(),this.fpsMode?this.dragMode?this.mouseDragOn?(this.mouseX=300*(t.pageX-this.lastX),this.mouseY=300*(t.pageY-this.lastY),this.lastX=t.pageX,this.lastY=t.pageY):(this.mouseX=0,this.mouseY=0):this.domElement===document?(this.mouseX=t.pageX-this.viewHalfX,this.mouseY=t.pageY-this.viewHalfY):(this.mouseX=t.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=t.pageY-this.domElement.offsetTop-this.viewHalfY):s!==this.STATE.ROTATE||this.noRotate?s!==this.STATE.ZOOM||this.noZoom?s===this.STATE.PAN&&!this.noPan&&(f=this.getMouseOnScreen(t.clientX,t.clientY)):l=this.getMouseOnScreen(t.clientX,t.clientY):(o=this.getMouseProjectionOnBall(t.clientX,t.clientY),n=this.getRotateY(t.clientX,t.clientY));var e=(new Date).getTime();if(null==this._lt)this.update();else{if(e-this._lt<this.updateIntervalTime)return;this.update()}this._lt=e}},this.handle_mouseup=function(t){if(t.preventDefault(),this.fpsMode){if(this.activeLook)switch(t.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.lastX=0,this.lastY=0,this.dragMode&&(this.mouseX=0,this.mouseY=0),this.mouseDragOn=!1}else s=this.STATE.NONE;this.removeListener("mousemove","mouseup"),this.update()},this.handle_touchstart=function(t){if(this.enabled!==!1){switch(t.touches.length){case this.touchSeq[0]:s=this.STATE.TOUCH_ROTATE,a=this.getMouseProjectionOnBall(t.touches[0].pageX,t.touches[0].pageY),i=n=this.getRotateY(t.touches[0].pageX,t.touches[0].pageY),o.copy(a);break;case this.touchSeq[1]:s=this.STATE.TOUCH_ZOOM;var e=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY;u=c=Math.sqrt(e*e+r*r);break;case this.touchSeq[2]:s=this.STATE.TOUCH_PAN,d.copy(this.getMouseOnScreen(t.touches[0].pageX,t.touches[0].pageY)),f.copy(d);break;default:s=this.STATE.NONE}this.update()}},this.handle_touchmove=function(t){if(this.enabled!==!1){switch(t.preventDefault(),t.touches.length){case this.touchSeq[0]:o=this.getMouseProjectionOnBall(t.touches[0].pageX,t.touches[0].pageY,o),n=this.getRotateY(t.touches[0].pageX,t.touches[0].pageY);break;case this.touchSeq[1]:var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;u=Math.sqrt(e*e+i*i);break;case this.touchSeq[2]:f=this.getMouseOnScreen(t.touches[0].pageX,t.touches[0].pageY,f);break;default:s=this.STATE.NONE}this.update()}},this.handle_touchend=function(t){if(this.enabled!==!1){switch(t.touches.length){case this.touchSeq[0]:a.copy(this.getMouseProjectionOnBall(t.touches[0].pageX,t.touches[0].pageY,o));break;case this.touchSeq[1]:c=u=0;break;case this.touchSeq[2]:f.copy(this.getMouseOnScreen(t.touches[0].pageX,t.touches[0].pageY)),d.copy(f)}s=this.STATE.NONE,this.update()}},this.handle_DOMMouseScroll=function(t){this.handle_mousewheel(t)},this.handle_mousewheel=function(t){t.preventDefault();var e=0;t.wheelDelta?e=t.wheelDelta%120===0?t.wheelDelta/40:t.wheelDelta:t.detail&&(e=-t.detail/3),e&&(h.y+=1/e*.01),this.mouseMoving=!0,this.update()},this.handle_dblclick=function(t){if(this.isCtrlDown(t)){var e=this.network.getElementsByMouseEvent(t);e.length>0&&(g=e[0]),this.update()}},this.getMouseOnScreen=function(t,e){return new Ke.Vec2((t-this.screen.offsetLeft)/this.radius*.5,(e-this.screen.offsetTop)/this.radius*.5)},this.getRotateY=function(t,e){if(this.yRistrict){var i=(.5*this.screen.height+this.screen.offsetTop-e)/this.screen.height*2;return i}},this.handle_keydown=function(t){if(this.keyboardEnable){switch(t.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}this.update()}},this.handle_keyup=function(t){if(this.keyboardEnable){switch(t.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}this.update()}},this.getMouseProjectionOnBall=function(t,e){if(this.yRistrict){var i=new Ke.Vec3((t-.5*this.screen.width-this.screen.offsetLeft)/(.5*this.screen.width),0,0),n=i.length();return n>1?i.normalize():i.z=Math.sqrt(1-n*n),i.normalize()}var i=new Ke.Vec3((t-.5*this.screen.width-this.screen.offsetLeft)/this.radius,(.5*this.screen.height+this.screen.offsetTop-e)/this.radius,0),n=i.length();n>1?i.normalize():i.z=Math.sqrt(1-n*n),r.copy(this.object._position).sub(this.object.target);var s=this.object.up.clone().setLength(i.y);return s.add(this.object.up.clone().cross(r).setLength(i.x)),s.add(r.setLength(i.z)),s},this.rotateCamera=function(){var t=a.dot(o)/a.length()/o.length(),e=Math.acos(t),s=!this.easing||Math.abs(e)<1e-4,h=!1;if(e){var l=(new Ke.Vec3).crossVectors(a,o).normalize(),c=new Ke.Quat;c.setFromAxisAngle(l,-e*this.dynamicDampingFactor*this.rotateSpeed),s?(c.setFromAxisAngle(l,-e*this.rotateSpeed),r.applyQuaternion(c),this.object.up.applyQuaternion(c),a.copy(o)):(c.setFromAxisAngle(l,-e*this.dynamicDampingFactor*this.rotateSpeed),r.applyQuaternion(c),this.object.up.applyQuaternion(c),c.setFromAxisAngle(l,e*this.dynamicDampingFactor),a.applyQuaternion(c),h=!0)}var s=!this.easing||Math.abs(n-i)<1e-4,u=(n-i)*r.length();if(!yi.isNaN(u))if(s)u&&this.yRistrict&&this.limitY(u),i=n;else{var u=u*this.dynamicDampingFactor;u&&this.yRistrict&&this.limitY(u),i+=(n-i)*this.dynamicDampingFactor,h=!0}h&&this.network.dirtyNetwork()},this.limitY=function(t){var e=r.length();Math.abs(r.x)<=.1*e&&Math.abs(r.z)<=.1*e&&(r.x=.1*e);var i=r.x,n=r.z,s=Math.sqrt(i*i+n*n),a=Math.tan(this.yLowerLimitAngle)*s,o=Math.tan(this.yUpLimitAngle)*s;r.y-=t,r.y>o?r.y=o:r.y<a&&(r.y=a)},this.getValueByTime=function(t,e){var i=(new Date).getTime(),n=i-this._timeStart;return n>this.timeInterval?e:t+(e-t)*n/this.timeInterval},this.zoomCamera=function(){if(s===this.STATE.TOUCH_ZOOM){var t=c/u;c=u,r.multiplyScalar(t)}else{var e=this.zoomSpeed;this.easing||(e*=5);var t;t=1+(l.y-h.y)*e,1!==t&&t>0&&(r.multiplyScalar(t),!this.easing||Math.abs(l.y-h.y)<.001?h.copy(l):(h.y+=(l.y-h.y)*this.dynamicDampingFactor,this.network.dirtyNetwork()))}},this.panCamera=function(){var t=f.clone().sub(d);if(t.lengthSq()){t.multiplyScalar(r.length()*this.panSpeed);var e=r.clone().cross(this.object.up).setLength(t.x),i=(new ti).extractRotation(this.object.matrix),n=this.object.up.clone().applyMatrix4(i);e.add(n.setLength(t.y));var s=this.object.p().add(e);this.object.checkPosition(s)&&(this.object.p(s),this.object.target.add(e)),d=f,this.network.dirtyNetwork()}},this.checkAngles=function(){},this.checkDistances=function(){this.noZoom&&this.noPan||(r.lengthSq()>this.maxDistance*this.maxDistance&&this.object._position.addVectors(this.object.target,r.setLength(this.maxDistance)),r.lengthSq()<this.minDistance*this.minDistance&&this.object._position.addVectors(this.object.target,r.setLength(this.minDistance)))},this.updateFPS=function(){var t=2;if(!this.freeze){if(this.heightSpeed){var e=Ke.Math.clamp(this.object._position.y,this.heightMin,this.heightMax),i=e-this.heightMin;this.autoSpeedFactor=t*i*this.heightCoef}else this.autoSpeedFactor=0;var n=t*this.movementSpeed;if(this.moveForward||this.autoForward&&!this.moveBackward){var s=this.object._position.clone();this.object.translateZ(-(n+this.autoSpeedFactor));var a=this.object.target;this.verticalFixed&&this.object.setY(s.y);var o=this.object._position,h=new Je,l=new Je;h.subVectors(o,a),l.subVectors(s,a),h.z*l.z<=this.minDistance*this.minDistance&&this.object.target.subVectors(this.object._position,r)}if(this.moveBackward){var s=this.object._position.clone();this.object.translateZ(n),this.verticalFixed&&this.object.setY(s.y)}this.moveLeft&&(this.object.translateX(-n),this.object.target.subVectors(this.object._position,r)),this.moveRight&&(this.object.translateX(n),this.object.target.subVectors(this.object._position,r)),this.moveUp&&(this.object.translateY(n),this.object.target.subVectors(this.object._position,r)),this.moveDown&&(this.object.translateY(-n),this.object.target.subVectors(this.object._position,r));var c=t*this.lookSpeed;!this.activeLook&&!this.dragMode&&(c=0);var u=this.verticalLookRatio;if(this.constrainVertical&&(u=Math.PI/(this.verticalMax-this.verticalMin)),this.lon+=this.mouseX*c,this.dragMode&&(this.mouseX=0),this.lookVertical&&(this.lat-=this.mouseY*c*u),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=Ke.Math.degToRad(90-this.lat),this.theta=Ke.Math.degToRad(this.lon),this.constrainVertical&&(this.phi=Ke.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax)),this.fpsMode){var d=this.object.target,o=this.object._position;d.x=o.x+100*Math.sin(this.phi)*Math.sin(this.theta),d.y=o.y+100*Math.cos(this.phi),d.z=o.z-100*Math.sin(this.phi)*Math.cos(this.theta),this.object.look(d)}}},this.update=function(){if(r.subVectors(this.object._position,this.object.target),!this.noRotate&&!this.fpsMode&&this.rotateCamera(),this.noZoom||this.zoomCamera(),!this.noPan&&!this.fpsMode&&this.panCamera(),g&&g.element&&this.network.doubleClickToLookAtFunction(g.element)){this.object.target=g.point;var t=this.object._position.distanceTo(this.object.target),e=g.face.normal.clone();e=e.applyMatrix4((new Ke.Mat4).extractRotation(g.element.worldMatrix)),e.normalize(),r=e.multiplyScalar(t),g=null}this.object.setPosition(this.object._position.clone().addVectors(this.object.target,r)),this.updateFPS(),this.fpsMode||(this.checkDistances(),this.object.look(this.object.target)),this.lastPosition.distanceToSquared(this.object._position)>0&&this.lastPosition.copy(this.object._position)}},Ke.extend(Ke.DefaultInteraction,Ke.BaseInteraction,{STATE:{NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5},__accessor:["rotateSpeed","zoomSpeed","panSpeed","yLowerLimitAngle","yUpLimitAngle","minDistance","maxDistance","easing","touchSeq"],setUp:function(){this.addListener("mousedown","touchstart","touchend","touchmove","mousewheel","DOMMouseScroll","dblclick","keydown","keyup")},tearDown:function(){this.removeListener("mousedown","touchstart","touchend","touchmove","mousewheel","DOMMouseScroll","dblclick","keydown","keyup")},beforeUpdate:function(){},setUpdateIntervalTime:function(t){this.updateIntervalTime=t}}),Ke.SelectionInteraction=function(t){Ke.BaseInteraction.call(this,t),this.selectUnVisible=!0,this.ctrlDown=!1,this.deleteTimeoutId=null,this._areaPickingLevel=1},Ke.extend(Ke.SelectionInteraction,Ke.BaseInteraction,{constructor:Ke.SelectionInteraction,setAreaPickingLevel:function(t){this._areaPickingLevel=t},getAreaPickingLevel:function(){return this._areaPickingLevel},setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},setFocus:function(t){if(document.activeElement!==t){var e,i,n,s=document.documentElement;document.body;s&&(ii.isIE||ii.isOpera||s.scrollLeft||s.scrollTop)&&(e=s.scrollLeft,i=s.scrollTop,n=s),t.focus(),n&&(n.scrollLeft=e,n.scrollTop=i)}},handle_mousedown:function(t){if(1!=t.stop&&!ei.isRightClick(t)){this.setFocus(this.network.getView()),this.isCtrlDown(t)?(this.addListener("mousemove","mouseup"),this.ctrlDownEvent=t):this.network.getDataBox().clearSelection();var e=this.network.getElementsByMouseEvent(t,!0),i=this.network.getFirstSelectElement(e);this.network.getDataBox().getSelectionModel().appendSelection(i),this.network.onSelect(i)}},handle_mousemove:function(t){var e=this.getBoundingByMouseEvent(t,this.ctrlDownEvent,this.network.devicePixelRatio);this.mousemoved=!0,this.network.areaPickingRect=e,this.network.paintTopCanvas()},handle_mouseup:function(t){this.network.areaPickingRect=null,this.network.paintTopCanvas();var e=this.getBoundingByMouseEvent(t,this.ctrlDownEvent);if(this.removeListener("mousemove","mouseup"),this.ctrlDownEvent=null,e&&this.mousemoved){var i=this.network.getElementsByBounding(e,!0,this._areaPickingLevel),n=new ci;if(i.length>0)for(var s=0;s<i.length;s++){var r=i[s].element;this.network.selectable(i[s])&&n.add(r)}n.size()>0&&this.network.getDataBox().getSelectionModel().appendSelection(n)}},getBoundingByMouseEvent:function(t,e,i){if(t&&e){var n=this.network.getView().getBoundingClientRect(),s=t.clientX-n.left,r=t.clientY-n.top,a=e.clientX-n.left,o=e.clientY-n.top,h=i||1,l=Math.min(s,a)*h,c=Math.min(r,o)*h,u=Math.abs(s-a)*h,d=Math.abs(r-o)*h;return 0===u&&0===d?null:{x:l,y:c,w:u,h:d}}}}),Ke.TransformGizmo=function(){var t=new Ke.TransformGizmoMaterial({color:16711680}),i=new Ke.TransformGizmoMaterial({color:65280}),n=new Ke.TransformGizmoMaterial({color:255});this.handleGizmos={X:[new Ke.Cylinder(t,.005,.005,1,4,1,(!1),(!1)),new Je(.5,0,0),new Je(0,0,-Math.PI/2)],Y:[new Ke.Cylinder(i,.005,.005,1,4,1,(!1),(!1)),new Je(0,.5,0)],Z:[new Ke.Cylinder(n,.005,.005,1,4,1,(!1),(!1)),new Je(0,0,.5),new Je(Math.PI/2,0,0)]};var s=!1,r=!1;this.showHelpers=!0,this.showable=!0,this.init=function(){Ke.Element.call(this),this.handles=new Ke.Element,this.pickers=new Ke.Element,this.planes=new Ke.Element,this.addChild(this.handles),this.addChild(this.pickers),this.addChild(this.planes);var t=new Ke.BasicMaterial({wireframe:!1,color:65535,side:Ke.DoubleSide}),e=(new Ke.Plane(t,5e4,5e4,2,2),{XY:new Ke.Plane(t,5e4,5e4,2,2),YZ:new Ke.Plane(t,5e4,5e4,2,2),XZ:new Ke.Plane(t,5e4,5e4,2,2),XYZE:new Ke.Plane(t,5e4,5e4,2,2)});e.YZ._rotation.set(0,Math.PI/2,0),e.XZ._rotation.set(-Math.PI/2,0,0);for(var i in e)e[i].name=i,this.planes.addChild(e[i]),this.planes[i]=e[i],e[i]._visible=!0;for(var i in this.handleGizmos){var n=this.handleGizmos[i][0];if(n.name=i,this.handleGizmos[i][1]&&n._position.set(this.handleGizmos[i][1].x,this.handleGizmos[i][1].y,this.handleGizmos[i][1].z),this.handleGizmos[i][2]&&n._rotation.set(this.handleGizmos[i][2].x,this.handleGizmos[i][2].y,this.handleGizmos[i][2].z),n.mode=this.mode,this.handles.addChild(n),this.pickerGizmos&&this.pickerGizmos[i]){var s=this.pickerGizmos[i][0];this.pickerGizmos[i][1]&&s._position.set(this.pickerGizmos[i][1].x,this.pickerGizmos[i][1].y,this.pickerGizmos[i][1].z),this.pickerGizmos[i][2]&&s._rotation.set(this.pickerGizmos[i][2].x,this.pickerGizmos[i][2].y,this.pickerGizmos[i][2].z)}else var s=n.clone();s.mode=this.mode,s.name=i,this.pickers.addChild(s)}this.iterator(function(t){t instanceof Ke.Entity&&Ke.Utils.transformElement(t)})},this.hide=function(){this.handles.getChildren().forEach(function(t){t._visible=!1}),this.pickers.getChildren().forEach(function(t){t._visible=!1}),this.planes.getChildren().forEach(function(t){t._visible=!1})},this.show=function(){var t=this;this.handles.getChildren().forEach(function(e){e._visible=t.showHelpers&&t.showable}),this.pickers.getChildren().forEach(function(t){t._visible=s}),this.activePlane&&(this.activePlane._visible=r)},this.highlight=function(t){var i;for(var n in this.handleGizmos)i=this.handleGizmos[n][0],i.oldColor&&(i.material instanceof Ke.ArrayMaterial?(i.material.materials[0].color.copy(i.oldColor),i.material.materials[0].opacity=i.oldOpacity):(i.material.color.copy(i.oldColor),i.material.opacity=i.oldOpacity),i.oldColor=null);this.handleGizmos[t]&&(i=this.handleGizmos[t][0],i.material instanceof Ke.ArrayMaterial?(i.oldColor=i.oldColor||i.material.materials[0].color.clone(),i.oldOpacity=i.oldOpacit!==e?i.oldOpacity:i.material.materials[0].opacity,i.material.materials[0].opacity=1):(i.oldColor=i.oldColor||i.material.color.clone(),i.oldOpacity=i.material.opacity,i.setStyle("material.opacity",1)))},this.init()},Ke.TransformGizmo.prototype=Object.create(Ke.Element.prototype),Ke.TransformGizmo.prototype.update=function(t,e){for(var i=new Je(0,0,0),n=new Je(0,1,0),s=new ti,r=0;r<this.getChildren().size();r++)for(var a=0;a<this.getChildren().get(r).getChildren().size();a++){var o=this.getChildren().get(r).getChildren().get(a);o.name.search("E")!=-1?(o.quaternion.setFromRotationMatrix(s.lookAt(e,i,n)),o._rotation.setEulerFromQuaternion(o.quaternion)):(o.quaternion.setFromEuler(t),o._rotation.setEulerFromQuaternion(o.quaternion))}},Ke.TransformGizmoTranslate=function(){Ke.TransformGizmo.call(this);var t=new Ke.TransformGizmoMaterial({color:16711680,opacity:.2}),e=new Ke.TransformGizmoMaterial({color:65280,opacity:.2}),i=new Ke.TransformGizmoMaterial({color:255,opacity:.2}),n=new Ke.Arrow(t,1,.03,.2,.05,30),s=new Ke.Arrow(e,1,.03,.2,.05,30),r=new Ke.Arrow(i,1,.03,.2,.05,30),a=new Ke.TransformGizmoMaterial({color:255,opacity:.5}),o=new Ke.TransformGizmoMaterial({color:16711680,opacity:.5}),h=new Ke.TransformGizmoMaterial({color:65280,opacity:.5}),l=new Ke.TransformGizmoMaterial({color:16777215,opacity:.5}),c=new Ke.Circle(a,.5,10,0,Math.PI/2),u=new Ke.Circle(o,.5,10,0,Math.PI/2),d=new Ke.Circle(h,.5,10,0,Math.PI/2),f=new Ke.Octahedron(l,1e-4,0);this.handleGizmos={X:[n,new Je(1.6,0,0),new Je(0,0,-Math.PI/2)],Y:[s,new Je(0,1.6,0)],Z:[r,new Je(0,0,1.6),new Je(Math.PI/2,0,0)],XYZ:[f],XY:[c,new Je(0,0,0)],YZ:[u,new Je(0,0,0),new Je(Math.PI/2,Math.PI/2,0)],XZ:[d,new Je(0,0,0),new Je(Math.PI/2,0,0)]};var l=new Ke.TransformGizmoMaterial({color:16711680,opacity:.25}),g=new Ke.TransformGizmoMaterial({color:65280,opacity:.25}),_=new Ke.TransformGizmoMaterial({color:255,opacity:.25}),p=new Ke.Cylinder(l,.075,0,1.2,4,1,(!1)),v=new Ke.Cylinder(g,.075,0,1.2,4,1,(!1)),m=new Ke.Cylinder(_,.075,0,1.2,4,1,(!1)),f=new Ke.Octahedron(l,1e-4,0);this.pickerGizmos={X:[p,new Je(1.6,0,0),new Je(0,0,-Math.PI/2)],Y:[v,new Je(0,1.6,0)],Z:[m,new Je(0,0,1.6),new Je(Math.PI/2,0,0)],XYZ:[f]},this.setActivePlane=function(t,e){var i=new ti;e.applyProjection(i.getInverse(i.extractRotation(this.planes.XY.worldMatrix))),"X"==t&&(this.activePlane=this.planes.XY,Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"==t&&(this.activePlane=this.planes.XY,Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"==t&&(this.activePlane=this.planes.XZ,Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==t&&(this.activePlane=this.planes.XYZE),"XY"==t&&(this.activePlane=this.planes.XY),"YZ"==t&&(this.activePlane=this.planes.YZ),"XZ"==t&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()},Ke.TransformGizmoTranslate.prototype=Object.create(Ke.TransformGizmo.prototype),Ke.TransformGizmoTranslate.prototype.mode="translate",Ke.TransformGizmoRotate=function(){Ke.TransformGizmo.call(this);var t=new Ke.TransformGizmoMaterial({color:16711680,opacity:.2}),e=new Ke.TransformGizmoMaterial({color:65280,opacity:.2}),i=new Ke.TransformGizmoMaterial({color:255,opacity:.2}),n=new Ke.TransformGizmoMaterial({color:16776960}),s=new Ke.TransformGizmoMaterial({color:7895160,opacity:.25}),s=new Ke.TransformGizmoMaterial({color:16711680}),r=new Ke.Torus(t,1,.02,4,32,Math.PI),a=new Ke.Torus(e,1,.02,4,32,Math.PI),o=new Ke.Torus(i,1,.02,4,32,Math.PI);new Ke.Torus(n,1.25,.01,4,64),new Ke.Torus(s,1,.01,4,64);this.handleGizmos={X:[r,new Je(0,0,0),new Je(0,-Math.PI/2,-Math.PI/2)],Y:[a,new Je(0,0,0),new Je(Math.PI/2,0,0)],Z:[o,new Je(0,0,0),new Je(0,0,-Math.PI/2)]};var h=new Ke.TransformGizmoMaterial({color:16711680,opacity:.25}),l=new Ke.TransformGizmoMaterial({color:65280,opacity:.25}),c=new Ke.TransformGizmoMaterial({color:255,opacity:.25}),u=new Ke.TransformGizmoMaterial({color:983040,opacity:.25}),d=new Ke.Torus(h,1,.05,4,12,Math.PI),f=new Ke.Torus(l,1,.05,4,12,Math.PI),g=new Ke.Torus(c,1,.05,4,12,Math.PI);new Ke.Torus(u,1,.05,2,24);this.pickerGizmos={X:[d,new Je(0,0,0),new Je(0,-Math.PI/2,-Math.PI/2)],Y:[f,new Je(0,0,0),new Je(Math.PI/2,0,0)],Z:[g,new Je(0,0,0),new Je(0,0,-Math.PI/2)]},this.setActivePlane=function(t){"E"==t&&(this.activePlane=this.planes.XYZE),"X"==t&&(this.activePlane=this.planes.YZ),"Y"==t&&(this.activePlane=this.planes.XZ),"Z"==t&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(t,e){Ke.TransformGizmo.prototype.update.apply(this,arguments);var i={handles:this.handles,pickers:this.pickers},n=new ti,s=new Ke.Euler(0,0,1),r=new Ke.Quat,a=new Je(1,0,0),o=new Je(0,1,0),h=new Je(0,0,1),l=new Ke.Quat,c=new Ke.Quat,u=new Ke.Quat,d=e.clone();s.copy(this.planes.XY._rotation),r.setFromEuler(s),n.makeRotationFromQuaternion(r).getInverse(n),d.applyProjection(n);for(var f in i)for(var g=0;g<i[f].getChildren().size;g++){var _=i[f].getChildren().get(g);r.setFromEuler(s),"X"==_.name&&(l.setFromAxisAngle(a,Math.atan2(-d.y,d.z)),r.multiplyQuaternions(r,l),_.quaternion.copy(r)),"Y"==_.name&&(c.setFromAxisAngle(o,Math.atan2(d.x,d.z)),r.multiplyQuaternions(r,c),_.quaternion.copy(r)),"Z"==_.name&&(u.setFromAxisAngle(h,Math.atan2(d.y,d.x)),r.multiplyQuaternions(r,u),_.quaternion.copy(r))}},this.init()},Ke.TransformGizmoRotate.prototype=Object.create(Ke.TransformGizmo.prototype),Ke.TransformGizmoRotate.prototype.mode="rotate",Ke.TransformGizmoScale=function(){Ke.TransformGizmo.call(this);var t=new Ke.TransformGizmoMaterial({color:11184810,opacity:1}),e=new Ke.TransformGizmoMaterial({color:16711680,opacity:.2}),i=new Ke.TransformGizmoMaterial({color:65280,opacity:.2}),n=new Ke.TransformGizmoMaterial({color:255,opacity:.2}),s=new Ke.Cube(t,.25,.25,.25),r=new Ke.Cylinder(null,.1,.1,1,4,1,(!1)),a=new Ke.Cube(t,.225,.225,.225),o=new Ke.Cylinder(null,.1,0,1,20,1,(!0));o._position.y=.05;var o=Ke.Utils.createElement(r,o,e),h=(Ke.Utils.createElement(r,o,i),Ke.Utils.createElement(r,o,n),new Ke.Cylinder(e,.08,0,1,4,1,(!1))),l=new Ke.Cylinder(i,.08,0,1,4,1,(!1)),c=new Ke.Cylinder(n,.08,0,1,4,1,(!1)),u=new Ke.Element;u.material=new Ke.BasicMaterial;var d=new Ke.Element;d.material=new Ke.BasicMaterial;var f=new Ke.Element;f.material=new Ke.BasicMaterial,this.handleGizmos={X:[h,new Je(.5,0,0),new Je(0,0,-Math.PI/2)],Y:[l,new Je(0,.5,0)],Z:[c,new Je(0,0,.5),new Je(Math.PI/2,0,0)],XY:[u],YZ:[d],XZ:[f],XYZ:[s]};var g=new Ke.TransformGizmoMaterial({color:16711680,opacity:.25}),_=new Ke.TransformGizmoMaterial({color:65280,opacity:.25}),p=new Ke.TransformGizmoMaterial({color:255,opacity:.25}),v=new Ke.Cylinder(g,.125,0,1,4,1,(!1)),m=new Ke.Cylinder(_,.125,0,1,4,1,(!1)),y=new Ke.Cylinder(p,.125,0,1,4,1,(!1));this.pickerGizmos={X:[v,new Je(.6,0,0),new Je(Math.PI/4,0,-Math.PI/2)],Y:[m,new Je(0,.6,0),new Je(0,Math.PI/4,0)],Z:[y,new Je(0,0,.6),new Je(Math.PI/2,Math.PI/4,0)],XYZ:[a]},this.setActivePlane=function(t,e){var i=new ti;e.applyProjection(i.getInverse(i.extractRotation(this.planes.XY.worldMatrix))),"X"==t?(this.activePlane=this.planes.XY,Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)):"Y"==t?(this.activePlane=this.planes.XY,Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)):"Z"==t?(this.activePlane=this.planes.XZ,Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ)):"XYZ"==t?this.activePlane=this.planes.XYZE:this.activePlane=this.planes[t],this.hide(),this.show()},this.init()},Ke.TransformGizmoScale.prototype=Object.create(Ke.TransformGizmo.prototype),Ke.TransformGizmoScale.prototype.mode="scale",Ke.EditInteraction=function(i){function n(e){if(v.network._keyboardRemoveEnabled&&46==e.keyCode&&i.getDataBox().getSelectionModel().size()>0){var n="Delete?";t.confirm(n)&&i.getDataBox().removeSelection()}}function s(e){1===e.touches.length&&(v.deleteTimeoutId=setTimeout(function(){var i=v.network.getElementsByMouseEvent(e,v.selectUnVisible);if(i.length>0){var n=i[0],s="Delete?";t.confirm(s)&&v.network.getDataBox().remove(n.element)}},300))}function r(t){clearTimeout(v.deleteTimeoutId)}function a(t){clearTimeout(v.deleteTimeoutId)}function o(t){v.update()}function h(t){if(v.object&&!m){t.preventDefault(),t.stopPropagation();var e=t.touches?t.touches[0]:t,i=f(e,v.filterIntersectPicker(v.pickers));if(i)v.axis=i.object.name,v.setMode(i.object.mode);else{var n=u(t);n===v.object||null!=n&&n.editTransformToParent&&n.isDescendantOf(v.object)?(v.axis=v.getAxis(),v.setMode(v.getMode())):v.axis=!1}v.update(!0)}}function l(t){if(!t.stop){if(K.set(t.clientX,t.clientY),v.showHelpers&&v.axis||(d(t),h(t)),!v.object||m)return void v.network.dirtyNetwork();t.preventDefault(),t.stopPropagation();var n=t.touches?t.touches[0]:t;if(0===n.button||n.button==e){var s=v.filterIntersectPicker(v.pickers),r=f(n,s),a=u(t);if(r||(a===v.object||null!=a&&a.editTransformToParent&&a.isDescendantOf(v.object))&&v.getDefaultPickers()&&(r={object:v.getDefaultPickers()}),r){v.axis=r.object.name,E.copy(Y).sub(X).normalize(),v.gizmo[y].setActivePlane(v.axis,E);var o=f(n,[v.gizmo[y].activePlane]);if(!o&&a&&(o=f(n,[a])),o){F.copy(v.object._position),V.copy(v.object._scale),U.extractRotation(v.object.matrix),Z.extractRotation(v.object.worldMatrix);var l=v.object.getParent();l==e&&(l=i),H.extractRotation(l.worldMatrix),W.getScaleFromMatrix(L.getInverse(l.worldMatrix)),w.copy(o.point)}}}v.update(!0),m=!0}}function c(t){if(v.object&&v.axis&&m){t.preventDefault(),t.stopPropagation(),t.stop=!0;var e=t.touches?t.touches[0]:t,n=f(e,[v.gizmo[y].activePlane]);if(n||(n=f(e,[v.object])),n){if(v.moving?i.fireInteractionEvent({kind:"liveMoveBetween",event:Zi}):(i.fireInteractionEvent({kind:"liveMoveStart",event:Zi}),v.moving=!0),x.copy(n.point),"translate"==y&&v.translateable){if(x.sub(w),x.multiply(W),"local"==v.space&&(x.applyMatrix4(L.getInverse(Z)),v.axis.search("X")==-1&&(x.x=0),v.axis.search("Y")==-1&&(x.y=0),v.axis.search("Z")==-1&&(x.z=0),x.applyMatrix4(U),v.object.setPosition(F.clone().add(x))),"world"==v.space||v.axis.search("XYZ")!=-1){v.axis.search("X")==-1&&(x.x=0),v.axis.search("Y")==-1&&(x.y=0),v.axis.search("Z")==-1&&(x.z=0),x.applyMatrix4(L.getInverse(H)),v.object._position.copy(F);var s=v.object._position.clone().add(x);v.snap&&(v.axis.search("X")!=-1&&(s.x=Math.round(v.object._position.x/v.snap)*v.snap),v.axis.search("Y")!=-1&&(s.y=Math.round(v.object._position.y/v.snap)*v.snap),v.axis.search("Z")!=-1&&(s.z=Math.round(v.object._position.z/v.snap)*v.snap)),v.object.setPosition(s)}}else if("scale"==y&&v.scaleable){x.sub(w),x.multiply(W);var r=v.object._scale.clone(),a=(v.scaleRate||1)/10;if("XYZ"==v.axis)l=1+x.y*a,r.x=V.x*l,r.y=V.y*l,r.z=V.z*l;else if("XY"===v.axis){var o=1+x.x*a,h=1+x.y*a;if(v.forceSameScale){var l=Math.max(o,h);r.x=V.x*l,r.y=V.y*l}else r.x=V.x*o,r.y=V.y*h}else if("YZ"===v.axis){var c=1+x.z*a,h=1+x.y*a;if(v.forceSameScale){var l=Math.max(c,h);r.z=V.z*l,r.y=V.y*l}else r.z=V.z*c,r.y=V.y*h}else if("XZ"===v.axis){var o=1+x.x*a,c=1+x.z*a;if(v.forceSameScale){var l=Math.max(o,h);r.x=V.x*l,r.z=V.z*l}else r.x=V.x*o,r.z=V.z*c}else x.applyMatrix4(L.getInverse(Z)),"X"==v.axis&&(r.x=V.x*(1+x.x*a)),"Y"==v.axis&&(r.y=V.y*(1+x.y*a)),"Z"==v.axis&&(r.z=V.z*(1+x.z*a));v.object.setScale(r)}else if("rotate"==y&&v.rotateable)if(x.sub(X),x.multiply(W),M.copy(w).sub(X),M.multiply(W),"E"==v.axis)x.applyMatrix4(L.getInverse(T)),M.applyMatrix4(L.getInverse(T)),b.set(Math.atan2(x.z,x.y),Math.atan2(x.x,x.z),Math.atan2(x.y,x.x)),S.set(Math.atan2(M.z,M.y),Math.atan2(M.x,M.z),Math.atan2(M.y,M.x)),P.setFromRotationMatrix(L.getInverse(H)),O.setFromAxisAngle(E,b.z-S.z),D.setFromRotationMatrix(Z),P.multiplyQuaternions(P,O),P.multiplyQuaternions(P,D),v.object.quaternion.copy(P);else if("XYZE"==v.axis)O.setFromEuler(x.clone().cross(M).normalize()),P.setFromRotationMatrix(L.getInverse(H)),B.setFromAxisAngle(O,-x.clone().angleTo(M)),D.setFromRotationMatrix(Z),P.multiplyQuaternions(P,B),P.multiplyQuaternions(P,D),v.object.quaternion.copy(P);else if("local"==v.space){x.applyMatrix4(L.getInverse(Z)),M.applyMatrix4(L.getInverse(Z)),b.set(Math.atan2(x.z,x.y),Math.atan2(x.x,x.z),Math.atan2(x.y,x.x)),S.set(Math.atan2(M.z,M.y),Math.atan2(M.x,M.z),Math.atan2(M.y,M.x)),D.setFromRotationMatrix(U),B.setFromAxisAngle(k,b.x-S.x),N.setFromAxisAngle(I,b.y-S.y),z.setFromAxisAngle(R,b.z-S.z),"X"==v.axis&&D.multiplyQuaternions(D,B),"Y"==v.axis&&D.multiplyQuaternions(D,N),"Z"==v.axis&&D.multiplyQuaternions(D,z),v.object.quaternion.copy(D);var u=v.object._rotation.clone();u.setEulerFromQuaternion(D),v.object.setRotation(u)}else if("world"==v.space){b.set(Math.atan2(x.z,x.y),Math.atan2(x.x,x.z),Math.atan2(x.y,x.x)),S.set(Math.atan2(M.z,M.y),Math.atan2(M.x,M.z),Math.atan2(M.y,M.x)),P.setFromRotationMatrix(L.getInverse(H)),B.setFromAxisAngle(k,b.x-S.x),N.setFromAxisAngle(I,b.y-S.y),z.setFromAxisAngle(R,b.z-S.z),D.setFromRotationMatrix(Z),"X"==v.axis&&P.multiplyQuaternions(P,B),"Y"==v.axis&&P.multiplyQuaternions(P,N),"Z"==v.axis&&P.multiplyQuaternions(P,z),P.multiplyQuaternions(P,D),v.object.quaternion.copy(P);var u=v.object._rotation.clone();u.setEulerFromQuaternion(P),v.object.setRotation(u)}v.changed=!0}v.update(!0),v.updateTextNote(t,v.object)}}function u(t){var e=v.network.getElementsByMouseEvent(t);return i.getFirstEditElement(e)}function d(t){if(null===q&&(q=new Qe),q.set(t.clientX,t.clientY),i.getDataBox().clearEditing(),0===q.distanceTo(K)){var e=v.network.getElementsByMouseEvent(t),n=i.getFirstEditElement(e);n&&(n!==v.object,v.object=n,v.translateable&&v.gizmo.translate.show(),v.rotateable&&v.gizmo.rotate.show(),v.scaleable&&v.gizmo.scale.show()),n||(v.gizmo[y].hide(),v.gizmo.translate.hide(),v.gizmo.rotate.hide(),v.gizmo.scale.hide(),v.object=null)}else v.changed&&v.onElementPropertyChanged&&(v.changed=!1,v.moving=!1,v.onElementPropertyChanged(t,v.object),i.fireInteractionEvent({kind:"liveMoveEnd",event:{e:t,source:v.object,time:(new Date).getTime()}}));v.axis=!1,m=!1,v.update(!0),v.hideTextNote()}function f(t,e){if(!e)return null;var i=v.network.getPickingByEvent(t),n=i.intersectObjects(e,!0,!0);return!!n[0]&&n[0]}Ke.BaseInteraction.call(this,i);var g=new Ke.Element,_=i.getCamera(),p=i.getRootView();p=p!==e?p:document,this.domElement=p,this.gizmo={},this.gizmo.translate=new Ke.TransformGizmoTranslate,this.gizmo.rotate=new Ke.TransformGizmoRotate,this.gizmo.scale=new Ke.TransformGizmoScale,g.addChild(this.gizmo.translate),g.addChild(this.gizmo.rotate),g.addChild(this.gizmo.scale),this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide(),this.object=!1,this.snap=!1,this.space="local",this.size=1,this.axis=!1;var v=this;this.scaleable=!0,this.rotateable=!0,this.translateable=!0,this.setShowHelpers(!0);var m=!1,y="translate",A={type:"change"},x=(new Ke.Picking,new Ke.Projector,new Je,new Je),w=new Je,b=new Je,S=new Je,C=1,T=new ti,E=new Je,L=new ti,M=new Je,P=new Ke.Quat,k=new Je(1,0,0),I=new Je(0,1,0),R=new Je(0,0,1),D=new Ke.Quat,B=new Ke.Quat,N=new Ke.Quat,z=new Ke.Quat,O=new Ke.Quat,F=new Je,V=new Je,U=new ti,H=new ti,W=new Je,X=new Je,G=new Ke.Euler,Z=new ti,Y=new Je,j=new Ke.Euler;this.showNote=!0,this.handleDataBoxChange=function(t){"remove"==t.kind?t.data==v.object&&(v.gizmo.translate.hide(),v.gizmo.rotate.hide(),v.gizmo.scale.hide()):"clear"==t.kind&&(v.gizmo.translate.hide(),v.gizmo.rotate.hide(),v.gizmo.scale.hide())},this.network.getDataBox().addDataBoxChangeListener(this.handleDataBoxChange,this),this.network.addPropertyChangeListener(function(t){if("dataBox"==t.property){var e=t.oldValue,i=t.value;e.removeDataBoxChangeListener(this.handleDataBoxChange),i.addDataBoxChangeListener(this.handleDataBoxChange,this)}}),this.defaultMode="TranslateXY",this.pickers=[],this.gizmo.translate.pickers.getChildren().forEach(function(t){v.pickers.push(t)}),this.gizmo.rotate.pickers.getChildren().forEach(function(t){v.pickers.push(t)}),this.gizmo.scale.pickers.getChildren().forEach(function(t){v.pickers.push(t)}),this.attach=function(t){v.object=t,this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide(),this.gizmo[y].show(),v.update()},this.detach=function(t){v.object=!1,this.axis=!1,this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide()},this.setMode=function(t){y=t?t:y,this.update()},this.setUp=function(){p.addEventListener("mousedown",l,!1),p.addEventListener("touchstart",l,!1),p.addEventListener("mousemove",h,!1),p.addEventListener("touchmove",h,!1),
p.addEventListener("mousemove",c,!1),p.addEventListener("touchmove",c,!1),p.addEventListener("mouseup",d,!1),p.addEventListener("mouseout",d,!1),p.addEventListener("touchend",d,!1),p.addEventListener("touchcancel",d,!1),p.addEventListener("touchleave",d,!1),p.addEventListener("keydown",n,!1),p.addEventListener("touchstart",s,!1),p.addEventListener("touchmove",r,!1),p.addEventListener("touchend",a,!1),p.addEventListener("mousewheel",o,!1),v.network.helperBox.addByDescendant(g)},this.tearDown=function(){p.removeEventListener("mousedown",l,!1),p.removeEventListener("touchstart",l,!1),p.removeEventListener("mousemove",h,!1),p.removeEventListener("touchmove",h,!1),p.removeEventListener("mousemove",c,!1),p.removeEventListener("touchmove",c,!1),p.removeEventListener("mouseup",d,!1),p.removeEventListener("mouseout",d,!1),p.removeEventListener("touchend",d,!1),p.removeEventListener("touchcancel",d,!1),p.removeEventListener("touchleave",d,!1),p.removeEventListener("keydown",n,!1),p.removeEventListener("touchstart",s,!1),p.removeEventListener("touchmove",r,!1),p.removeEventListener("touchend",a,!1),p.removeEventListener("mousewheel",o,!1),v.gizmo.translate.hide(),v.gizmo.rotate.hide(),v.gizmo.scale.hide(),v.network.helperBox.removeByDescendant(g)},this.setSnap=function(t){v.snap=t},this.setSize=function(t){v.size=t,v.dispatchEvent(A),this.update()},this.setSpace=function(t){v.space=t,this.update()},this.update=function(t){v.object&&(v.object.updateWorldMatrix(),X.getPositionFromMatrix(v.object.worldMatrix),G.setFromRotationMatrix(L.extractRotation(v.object.worldMatrix)),_.updateWorldMatrix(),Y.getPositionFromMatrix(_.worldMatrix),j.setFromRotationMatrix(L.extractRotation(_.worldMatrix)),C=X.distanceTo(Y)/12*v.size,g.setPosition(X),g.setScale(C,C,C),E.copy(Y).sub(X).normalize(),this.gizmo.scale.update(G,E),"local"==v.space?(this.gizmo.translate.update(G,E),this.gizmo.rotate.update(G,E)):(this.gizmo.translate.update(new Ke.Euler,E),this.gizmo.rotate.update(new Ke.Euler,E)),this.gizmo.translate.highlight(null),this.gizmo.rotate.highlight(null),this.gizmo.scale.highlight(null),this.gizmo[y].highlight(v.axis),g.updateWorldMatrix(!0),t&&v.network.dirtyNetwork())},this.getDefaultPickers=function(){return"TranslateX"===this.defaultMode?v.gizmo.translate.pickers.getChildren().get(0):"TranslateY"===this.defaultMode?v.gizmo.translate.pickers.getChildren().get(1):"TranslateZ"===this.defaultMode?v.gizmo.translate.pickers.getChildren().get(2):"TranslateXY"===this.defaultMode?v.gizmo.translate.pickers.getChildren().get(4):"TranslateYZ"===this.defaultMode?v.gizmo.translate.pickers.getChildren().get(5):"TranslateXZ"===this.defaultMode?v.gizmo.translate.pickers.getChildren().get(6):"TranslateXYZ"===this.defaultMode?v.gizmo.translate.pickers.getChildren().get(3):"RotateX"===this.defaultMode?v.gizmo.rotate.pickers.getChildren().get(0):"RotateY"===this.defaultMode?v.gizmo.rotate.pickers.getChildren().get(1):"RotateZ"===this.defaultMode?v.gizmo.rotate.pickers.getChildren().get(2):"ScaleX"===this.defaultMode?v.gizmo.scale.pickers.getChildren().get(0):"ScaleY"===this.defaultMode?v.gizmo.scale.pickers.getChildren().get(1):"ScaleZ"===this.defaultMode?v.gizmo.scale.pickers.getChildren().get(2):"ScaleXYZ"===this.defaultMode?v.gizmo.scale.pickers.getChildren().get(6):"ScaleXY"===this.defaultMode?v.gizmo.scale.pickers.getChildren().get(3):"ScaleYZ"===this.defaultMode?v.gizmo.scale.pickers.getChildren().get(4):"ScaleXZ"===this.defaultMode?v.gizmo.scale.pickers.getChildren().get(5):null},this.getMode=function(){var t=this.defaultMode;return t.startsWith("Translate")?"translate":t.startsWith("Rotate")?"rotate":t.startsWith("Scale")?"scale":"translate"},this.getAxis=function(){var t=this.defaultMode;return t.endsWith("XYZ")?"XYZ":t.endsWith("XY")?"XY":t.endsWith("YZ")?"YZ":t.endsWith("XZ")?"XZ":t.endsWith("Y")?"X":t.endsWith("Y")?"Y":t.endsWith("Z")?"Z":""};var q=null,K=new Qe;this.filterIntersectPicker=function(t){var e=[];if(!this.showHelpers)return e;for(var i=0;i<t.length;i++){var n=t[i];n.getParent()===this.gizmo.translate.pickers&&this.translateable&&e.push(n),n.getParent()===this.gizmo.rotate.pickers&&this.rotateable&&e.push(n),n.getParent()===this.gizmo.scale.pickers&&this.scaleable&&e.push(n)}return e}},Ke.extend(Ke.EditInteraction,Ke.BaseInteraction,{setShowHelpers:function(t){this.showHelpers=t,this.gizmo.translate.showHelpers=t,this.gizmo.rotate.showHelpers=t,this.gizmo.scale.showHelpers=t,this.resetHelpers()},onElementPropertyChanged:function(t,e){},resetHelpers:function(){this.showHelpers&&this.translateable&&this.object?this.gizmo.translate.show():this.gizmo.translate.hide(),this.showHelpers&&this.rotateable&&this.object?this.gizmo.rotate.show():this.gizmo.rotate.hide(),this.showHelpers&&this.scaleable&&this.object?this.gizmo.scale.show():this.gizmo.scale.hide(),this.update(!0)},setShowNote:function(t){this.showNote=t},setScaleable:function(t){this.scaleable=t,this.gizmo.scale.showable=t,this.resetHelpers()},setRotateable:function(t){this.rotateable=t,this.gizmo.rotate.showable=t,this.resetHelpers()},setTranslateable:function(t){this.translateable=t,this.gizmo.translate.showable=t,this.resetHelpers()},setDefaultMode:function(t){this.defaultMode=t},setScaleRate:function(t){this.scaleRate=t||1},setForceSameScale:function(t){this.forceSameScale=t},setSpaceMode:function(t){"world"==t?this.space="world":this.space="local",this.update()},createTextNote:function(){this.textNote=document.createElement("div"),this.textNote.style.position="relative",this.textNote.style.color="black",this.textNote.style.height="0px",this.textNote.style.zIndex="1000",this.domElement.appendChild(this.textNote);var t=document.createElement("table");this.noteTable=t,this.textNote.appendChild(this.noteTable);t.createTHead();t.style.borderLeft="1px solid #ffa500",t.style.borderTop="1px solid #ffa500",t.style.fontSize="14px",t.style.backgroundColor="rgba(255, 170, 13, 0.5)",t.setAttribute("border",0),t.setAttribute("cellspacing",0),t.setAttribute("cellpadding",0);for(var e=0;e<4;e++){for(var i=document.createElement("tr"),n=0;n<4;n++){var s=document.createElement("td");s.style.borderRight="1px solid #ffa500",s.style.borderBottom="1px solid #ffa500",s.style.paddingLeft="5px",s.style.paddingRight="5px",s.style.paddingTop="2px",s.style.paddingBottom="2px",0==e&&n>0||e>0&&0==n?(s.style.textAlign="center",s.style.fontWeight="bold"):s.style.textAlign="right",i.appendChild(s)}t.appendChild(i)}},showTextNote:function(){this.showNote&&(null==this.textNote&&this.createTextNote(),this.textNote.style.display="")},hideTextNote:function(){this.textNote&&(this.textNote.style.display="none")},updateTextNote:function(t,e){if(null!=e&&this.showNote){var i=this.network.getRootView().getBoundingClientRect();this.showTextNote(),this.textNote.style.top=t.clientY-i.top+20+"px",this.textNote.style.left=t.clientX-i.left+20+"px";for(var n=e.getRotation(),s=e.getPosition(),r=e.getScale(),a=[[" ","x","y","z"],["p",s.x,s.y,s.z],["r",n.x,n.y,n.z],["s",r.x,r.y,r.z]],o=this.noteTable,h=0;h<4;h++)for(var l=0;l<4;l++){var c=a[h][l];h>0&&l>0&&(c=2==h?(180*c/Math.PI).toFixed(0)+"&deg;":c.toFixed(2)),o.rows[h].cells[l].innerHTML=""+c}}}});var hn=1e-5,ln=0,cn=1,un=2,dn=3;Ke.CSG=function(t){var e,i,n,s,r,a,o,h=[];if(!(t instanceof Ke.Element)){if(t instanceof _n)return this.tree=t,this.matrix=new ti,this;throw"TGL.CSG: Given geometry is unsupported"}for(t.computeNodeData&&t.computeNodeData(),t.updateWorldMatrix(!0),this.matrix=t.worldMatrix.clone(),e=0,i=t.faces.length;e<i;e++){if(n=t.faces[e],r=t.uvs[e],a=t.uv2s[e],o=new fn,n instanceof _i)s=t.vertices[n.a],s=new gn(s.x,s.y,s.z,n.vertexNormals[0],new Qe(r[0].x,r[0].y),a[0].clone()),s.materialIndex=n.materialIndex,s.applyMatrix4(this.matrix),o.vertices.push(s),s=t.vertices[n.b],s=new gn(s.x,s.y,s.z,n.vertexNormals[1],new Qe(r[1].x,r[1].y),a[1].clone()),s.materialIndex=n.materialIndex,s.applyMatrix4(this.matrix),o.vertices.push(s),s=t.vertices[n.c],s=new gn(s.x,s.y,s.z,n.vertexNormals[2],new Qe(r[2].x,r[2].y),a[2].clone()),s.applyMatrix4(this.matrix),s.materialIndex=n.materialIndex,o.vertices.push(s);else{if(!(n instanceof pi))throw"Invalid face type at index "+e;s=t.vertices[n.a],s=new gn(s.x,s.y,s.z,n.vertexNormals[0],new Qe(r[0].x,r[0].y),a[0].clone()),s.materialIndex=n.materialIndex,s.applyMatrix4(this.matrix),o.vertices.push(s),s=t.vertices[n.b],s=new gn(s.x,s.y,s.z,n.vertexNormals[1],new Qe(r[1].x,r[1].y),a[1].clone()),s.materialIndex=n.materialIndex,s.applyMatrix4(this.matrix),o.vertices.push(s),s=t.vertices[n.c],s=new gn(s.x,s.y,s.z,n.vertexNormals[2],new Qe(r[2].x,r[2].y),a[2].clone()),s.materialIndex=n.materialIndex,s.applyMatrix4(this.matrix),o.vertices.push(s),s=t.vertices[n.d],s=new gn(s.x,s.y,s.z,n.vertexNormals[3],new Qe(r[3].x,r[3].y),a[3].clone()),s.applyMatrix4(this.matrix),s.materialIndex=n.materialIndex,o.vertices.push(s)}isNaN(o.calculateProperties().w)?console.log("Not right polygon"):h.push(o)}if(this.tree=new _n(h),this.tree.materialSize=t.getMaterialSize?t.getMaterialSize():0,t.material instanceof Ke.ArrayMaterial)this.tree.material=t.material;else{var l=new Ke.ArrayMaterial;this.tree.material=l;for(var e=0;e<this.tree.materialSize;e++)l.push(t.material)}},Ke.CSG.prototype.substract=function(t){var e=this.tree.clone(),i=t.tree.clone();return e.sumMateriaSize(i),e.invert(),e.clipTo(i),i.clipTo(e),i.invert(),i.clipTo(e),i.invert(),e.build(i.allPolygons()),e.invert(),e=new Ke.CSG(e),e.matrix=this.matrix,e},Ke.CSG.prototype.union=function(t){var e=this.tree.clone(),i=t.tree.clone();return e.sumMateriaSize(i),e.clipTo(i),i.clipTo(e),i.invert(),i.clipTo(e),i.invert(),e.build(i.allPolygons()),e=new Ke.CSG(e),e.matrix=this.matrix,e},Ke.CSG.prototype.intersect=function(t){var e=this.tree.clone(),i=t.tree.clone();return e.sumMateriaSize(i),e.invert(),i.clipTo(e),i.invert(),e.clipTo(i),i.clipTo(e),e.build(i.allPolygons()),e.invert(),e=new Ke.CSG(e),e.matrix=this.matrix,e},Ke.CSG.prototype.inverse=function(){var t=this.tree.clone();return t.polygons.map(function(t){t.flip()}),t=new Ke.CSG(t)},Ke.CSG.prototype.toGeometry=function(t){var e,i,n,s,r,a,o,h,l,c,u,d=((new ti).getInverse(this.matrix),new Ke.Entity(this.tree.material,t)),f=this.tree.allPolygons(),g=f.length,_={};for(e=0;e<g;e++)for(n=f[e],s=n.vertices.length,i=2;i<s;i++){c=[],u=[],h=n.vertices[0],c.push(new Qe(h.uv.x,h.uv.y)),u.push(h.uv2.clone());var p=h.materialIndex;h=new Je(h.x,h.y,h.z),"undefined"!=typeof _[h.x+","+h.y+","+h.z]?r=_[h.x+","+h.y+","+h.z]:(d.vertices.push(h),r=_[h.x+","+h.y+","+h.z]=d.vertices.length-1),h=n.vertices[i-1],c.push(new Qe(h.uv.x,h.uv.y)),u.push(h.uv2.clone()),h=new Je(h.x,h.y,h.z),"undefined"!=typeof _[h.x+","+h.y+","+h.z]?a=_[h.x+","+h.y+","+h.z]:(d.vertices.push(h),a=_[h.x+","+h.y+","+h.z]=d.vertices.length-1),h=n.vertices[i],c.push(new Qe(h.uv.x,h.uv.y)),u.push(h.uv2.clone()),h=new Je(h.x,h.y,h.z),"undefined"!=typeof _[h.x+","+h.y+","+h.z]?o=_[h.x+","+h.y+","+h.z]:(d.vertices.push(h),o=_[h.x+","+h.y+","+h.z]=d.vertices.length-1),l=new _i(r,a,o,new Je(n.normal.x,n.normal.y,n.normal.z)),l.materialIndex=p||0,d.faces.push(l),d.uvs.push(c),d.uv2s.push(u)}return d},Ke.CSG.prototype.toMesh=function(t){var e=this.toGeometry(t);return e.computeBoundingBox(),e};var fn=function(t,i,n){t instanceof Array||(t=[]),this.vertices=t,t.length>0?this.calculateProperties():this.normal=this.w=e};fn.prototype.calculateProperties=function(){var t=this.vertices[0],e=this.vertices[1],i=this.vertices[2],n=e.clone().subtract(t),s=i.clone().subtract(t);return this.normal=n.cross(s).normalize(),this.w=this.normal.clone().dot(t),this},fn.prototype.clone=function(){var t,e,i=new fn;for(t=0,e=this.vertices.length;t<e;t++)i.vertices.push(this.vertices[t].clone());return i.calculateProperties(),i},fn.prototype.flip=function(){var t,e=[];for(this.normal.multiplyScalar(-1),this.w*=-1,t=this.vertices.length-1;t>=0;t--)e.push(this.vertices[t]);return this.vertices=e,this},fn.prototype.classifyVertex=function(t){var e=this.normal.dot(t)-this.w;return e<-hn?un:e>hn?cn:ln},fn.prototype.classifySide=function(t){var e,i,n,s=0,r=0,a=t.vertices.length;for(e=0;e<a;e++)i=t.vertices[e],n=this.classifyVertex(i),n===cn?s++:n===un&&r++;return s>0&&0===r?cn:0===s&&r>0?un:0===s&&0===r?ln:dn},fn.prototype.splitPolygon=function(t,e,i,n,s){var r=this.classifySide(t);if(r===ln)(this.normal.dot(t.normal)>0?e:i).push(t);else if(r===cn)n.push(t);else if(r===un)s.push(t);else{var a,o,h,l,c,u,d,f,g,_=[],p=[];for(o=0,a=t.vertices.length;o<a;o++)h=(o+1)%a,u=t.vertices[o],d=t.vertices[h],l=this.classifyVertex(u),c=this.classifyVertex(d),l!=un&&_.push(u),l!=cn&&p.push(u),(l|c)===dn&&(f=(this.w-this.normal.dot(u))/this.normal.dot(d.clone().subtract(u)),g=u.interpolate(d,f),_.push(g),p.push(g));_.length>=3&&n.push(new fn(_).calculateProperties()),p.length>=3&&s.push(new fn(p).calculateProperties())}},Ke.CSG.Polygon=fn;var gn=function(t,e,i,n,s,r){this.x=t,this.y=e,this.z=i,this.normal=n||new Je,this.uv=s||new Qe,this.uv2=r||new Qe};gn.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},gn.prototype.clone=function(){var t=new gn(this.x,this.y,this.z,this.normal.clone(),this.uv.clone(),this.uv2.clone());return t.materialIndex=this.materialIndex,t},gn.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},gn.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},gn.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this},gn.prototype.cross=function(t){var e=this.x,i=this.y,n=this.z;return this.x=i*t.z-n*t.y,this.y=n*t.x-e*t.z,this.z=e*t.y-i*t.x,this},gn.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return this.x/=t,this.y/=t,this.z/=t,this},gn.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},gn.prototype.lerp=function(t,e){return this.add(t.clone().subtract(this).multiplyScalar(e)),this.normal.add(t.normal.clone().sub(this.normal).multiplyScalar(e)),this.uv.add(t.uv.clone().sub(this.uv).multiplyScalar(e)),this.uv2.add(t.uv2.clone().sub(this.uv2).multiplyScalar(e)),this},gn.prototype.interpolate=function(t,e){return this.clone().lerp(t,e)},gn.prototype.applyMatrix4=function(t){var e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n+s[12],this.y=s[1]*e+s[5]*i+s[9]*n+s[13],this.z=s[2]*e+s[6]*i+s[10]*n+s[14],this},Ke.CSG.Vertex=gn;var _n=function(t){var i,n,s=[],r=[];if(this.polygons=[],this.front=this.back=e,t instanceof Array&&0!==t.length){for(this.divider=t[0].clone(),i=0,n=t.length;i<n;i++)this.divider.splitPolygon(t[i],this.polygons,this.polygons,s,r);s.length>0&&(this.front=new _n(s)),r.length>0&&(this.back=new _n(r))}};_n.isConvex=function(t){var e,i;for(e=0;e<t.length;e++)for(i=0;i<t.length;i++)if(e!==i&&t[e].classifySide(t[i])!==un)return!1;return!0},_n.prototype.build=function(t){var e,i,n=[],s=[];for(this.divider||(this.divider=t[0].clone()),e=0,i=t.length;e<i;e++)this.divider.splitPolygon(t[e],this.polygons,this.polygons,n,s);n.length>0&&(this.front||(this.front=new _n),this.front.build(n)),s.length>0&&(this.back||(this.back=new _n),this.back.build(s))},_n.prototype.allPolygons=function(){var t=this.polygons.slice();return this.front&&(t=t.concat(this.front.allPolygons())),this.back&&(t=t.concat(this.back.allPolygons())),t},_n.prototype.clone=function(){var t=new _n;if(this.divider&&(t.divider=this.divider.clone()),t.polygons=this.polygons.map(function(t){return t.clone()}),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t.materialSize=this.materialSize,t.material=new Ke.ArrayMaterial,this.material)for(var e=0;e<this.material.materials.length;e++)t.material.materials.push(this.material.materials[e]);return t},_n.prototype.invert=function(){var t,e,i;for(t=0,e=this.polygons.length;t<e;t++)this.polygons[t].flip();return this.divider&&this.divider.flip(),this.front&&this.front.invert(),this.back&&this.back.invert(),i=this.front,this.front=this.back,this.back=i,this},_n.prototype.clipPolygons=function(t){var e,i,n,s;if(!this.divider)return t.slice();for(n=[],s=[],e=0,i=t.length;e<i;e++)this.divider.splitPolygon(t[e],n,s,n,s);return this.front&&(n=this.front.clipPolygons(n)),s=this.back?this.back.clipPolygons(s):[],n.concat(s)},_n.prototype.clipTo=function(t){this.polygons=t.clipPolygons(this.polygons),this.front&&this.front.clipTo(t),this.back&&this.back.clipTo(t)},_n.prototype.sumMateriaSize=function(t){t.changeMaterialIndex(this.materialSize),this.materialSize=this.materialSize+t.materialSize;for(var e=0;e<t.material.materials.length;e++)this.material.materials.push(t.material.materials[e])},_n.prototype.changeMaterialIndex=function(t){for(var e=0;e<this.polygons.length;e++)for(var i=this.polygons[e],n=0;n<i.vertices.length;n++){var s=i.vertices[n];s.materialIndex=s.materialIndex+t}this.front&&this.front.changeMaterialIndex(t),this.back&&this.back.changeMaterialIndex(t)},Ke.CSG.Node=_n,Ke.XmlSerializer=function(t,e,i){this.dataBox=t,this.settings=e?e:new Ke.SerializationSettings,this.filterFunction=i,this.ref=0,this.refMap={},this.idMap={},this.xmlString=""},Ke.extend(Ke.XmlSerializer,Object,{serialize:function(){return this.xmlString="<TGL version='"+Ke.version+"' platform='html5'>\n",this.serializeBody(),this.xmlString+="</TGL>\n",this.xmlString},serializeBody:function(){this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable&&(this.xmlString+="<dataBox class='"+this.dataBox.getClassName()+"'>\n",this.dataBox.serializeXml(this,this.dataBox.newInstance()),this.xmlString+="</dataBox>\n"),this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(t){this.refMap[t.getId()]=this.ref++,t.getChildren().forEach(this.initRefs,this)},isSerializable:function(t){return!!this.dataBox.contains(t)&&!(this.filterFunction&&!this.filterFunction(t))},getPropertyType:function(t,e){var i=this.settings.getPropertyType(e);return i||t.__SizePropeties&&t.__SizePropeties.indexOf(e)!=-1&&(i="number"),i},serializeData:function(t){if(this.isSerializable(t)){var e=t.newInstance(),i=this.refMap[t.getId()];this.xmlString+="<data class='"+t.getClassName()+"' ref='"+i+"'",null!=this.settings.getPropertyType("id")&&(this.xmlString+=" id='"+t.getId()+"'"),this.xmlString+=">\n",t.serializeXml(this,e),this.xmlString+="</data>\n"}t.getChildren().forEach(this.serializeData,this)},serializePropertyXml:function(t,e,i){var n=this.getPropertyType(t,e);if(n){var s=Ke.getValue(t,e,n),r=Ke.getValue(i,e,n);s!==r&&this.serializeValue("p",e,s,r,n)}},serializeStyleXml:function(t,e,i){var n=this.settings.getStyleType(e);if(n){var s=t.getStyle(e),r=i.getStyle(e);s!=r&&this.serializeValue("s",e,s,r,n)}},serializeClientXml:function(t,e,i){var n=this.settings.getClientType(e);if(null!=n){var s=t.getClient(e),r=i.getClient(e);s!=r&&this.serializeValue("c",e,s,r,n)}},serializeValue:function(t,e,i,n,s){if("s"===t&&(i=this.flattenArray(i),i instanceof Array&&"string"!==s&&"color"!==s&&"number"!==s&&(s="list."+s,i=new ci(i))),null==i)this.xmlString+="\t<"+t+" n='"+e+"' none=''/>\n";else if("cdata"===s)this.xmlString+="\t<"+t+" n='"+e+"'><![CDATA["+i+"]]></"+t+">\n";else if("data"===s){var r=this.refMap[i.getId()];null!=r&&(this.xmlString+="\t<"+t+" n='"+e+"' ref='"+r+"'/>\n")}else"vec2"===s?n&&i.x===n.x&&i.y===n.y||(this.xmlString+="\t<"+t+" n='"+e+"' x='"+i.x+"' y='"+i.y+"'/>\n"):"vec3"===s?n&&i.x===n.x&&i.y===n.y&&i.z==n.z||(this.xmlString+="\t<"+t+" n='"+e+"' x='"+i.x+"' y='"+i.y+"' z='"+i.z+"'/>\n"):"list.vec2"===s?(this.xmlString+="\t<"+t+" n='"+e+"'>\n",i instanceof Array&&(i=new ci(i)),i.forEach(function(e){if(e instanceof Array){this.xmlString+="\t<"+t+">\n";for(var i=0;i<e.length;i++){var n=e[i];this.xmlString+="\t\t<p x='"+n.x+"' y='"+n.y+"'/>\n"}this.xmlString+="\t</"+t+">\n"}else this.xmlString+="\t\t<p x='"+e.x+"' y='"+e.y+"'/>\n"},this),this.xmlString+="\t</"+t+">\n"):"list.vec3"===s?(this.xmlString+="\t<"+t+" n='"+e+"'>\n",i instanceof Array&&(i=new ci(i)),i.forEach(function(e){if(e instanceof Array){this.xmlString+="\t<"+t+">\n";for(var i=0;i<e.length;i++){var n=e[i];this.xmlString+="\t<"+t+"' x='"+n.x+"' y='"+n.y+"' z='"+n.z+"'/>\n"}this.xmlString+="\t</"+t+">\n"}else this.xmlString+="\t\t<"+t+"' x='"+e.x+"' y='"+e.y+"' z='"+e.z+"'/>\n"},this),this.xmlString+="\t</"+t+">\n"):"list.string"===s||"list.number"===s||"list.color"===s?(this.xmlString+="\t<"+t+" n='"+e+"'>\n",i.forEach(function(t){this.xmlString+="\t\t<s>"+t+"</s>\n"},this),this.xmlString+="\t</"+t+">\n"):this.xmlString+="\t<"+t+" n='"+e+"'>"+i+"</"+t+">\n"},flattenArray:function(t){if(t instanceof Array){for(var e=0;e<t.length-1;e++)if(t[e]!=t[e+1]){if(!t[e]||!t[e].equals)return t;if(!t[e].equals(t[e+1]))return t}return t[0]}return t},deserialize:function(t,e){Ke.isDeserializing=!0,this.xmlString=t;var i=Ke.xml(t).documentElement;this.refMap={},this.idMap={};var n,s,r,a=new ci,o=new ci,h=i.getElementsByTagName("data"),l=h.length;for(r=0;r<l;r++){s=h[r];var c=s.getAttribute("class"),u=this.settings.getPropertyType("id");if(u&&s.hasAttribute("id")){var d=null;if("string"===u)d=s.getAttribute("id");else if("int"===u)d=parseInt(s.getAttribute("id"));else{if("number"!==u)throw"Unsupported id type '"+u+"'";d=parseFloat(s.getAttribute("id"))}if("remove"===s.getAttribute("action")){this.dataBox.removeById(d);continue}n=this.dataBox.getDataById(d),n||(n=Ke.newInstance(c,d))}else n=Ke.newInstance(c);if(s.hasAttribute("ref")){var f=s.getAttribute("ref");this.refMap[f]=n}a.add(n),o.add(s),this.idMap[n.getId()]=n}for(this.dataBox.forEach(function(t){this.idMap[t.getId()]=t},this),l=a.size(),r=0;r<l;r++)n=a.get(r),this.dataBox.containsById(n.getId())||(e&&!n.getParent()&&n.setParent(e),this.dataBox.add(n));for(r=0;r<l;r++)n=a.get(r),s=o.get(r),n.deserializeXml(this,s);this.settings.isDataBoxSerializable&&1===i.getElementsByTagName("dataBox").length&&this.dataBox.deserializeXml(this,i.getElementsByTagName("dataBox")[0]),Ke.isDeserializing=!1},deserializePropertyXml:function(t,e,i){var n=this.getPropertyType(t,i);n&&Ke.setValue(t,i,this.deserializeValue(e,n))},deserializeStyleXml:function(t,e,i){var n=this.settings.getStyleType(i);n&&t.setStyle(i,this.deserializeValue(e,n))},deserializeClientXml:function(t,e,i){var n=this.settings.getClientType(i);n&&t.setClient(i,this.deserializeValue(e,n))},deserializePoint:function(t){var e=t.getAttribute("x")?parseFloat(t.getAttribute("x")):null,i=t.getAttribute("a")?parseFloat(t.getAttribute("a")):null;if(null!=e){var n=t.getAttribute("y")?parseFloat(t.getAttribute("y")):null,s=t.getAttribute("z")?parseFloat(t.getAttribute("z")):null,r=t.getAttribute("w")?parseFloat(t.getAttribute("w")):null;return null!=r?new Ke.Vec4(e,n,s,r):null!=s?new Ke.Vec3(e,n,s):new Ke.Vec2(e,n)}if(null!=i){var a=t.getAttribute("b")?parseFloat(t.getAttribute("b")):null,o=t.getAttribute("c")?parseFloat(t.getAttribute("c")):null,h=t.getAttribute("d")?parseFloat(t.getAttribute("d")):null;return null!=h?new Ke.Face4(i,a,o,h):new Ke.Face3(i,a,o)}return null},arrayStyleValue:function(t,e){var i=[];if(t.indexOf(",")){if(i=t.split(","),"string"===e)return i;if("number"===e){for(var n=[],s=0;s<i.length;s++)n.push(parseFloat(i[s]));return n}if("color"===e){for(var r=[],s=0;s<i.length;s++)r.push(new Ke.Color(i[s]));return r}}},deserializeValue:function(t,e,i){if(t.hasAttribute("@none"))return null;var n="s"===t.nodeName,s=n&&t.textContent.indexOf(",")!==-1;if("string"===e)return s?this.arrayStyleValue(t.textContent,e):t.textContent;if("color"===e)return s?this.arrayStyleValue(t.textContent,e):t.textContent;if("number"===e)return s?this.arrayStyleValue(t.textContent,e):parseFloat(t.textContent);if("boolean"===e)return"true"===t.textContent;if("int"===e)return parseInt(t.textContent);if("point"===e)return this.deserializePoint(t);if("vec2"===e){var r=parseFloat(t.getAttribute("x")),a=parseFloat(t.getAttribute("y"));if(!isNaN(r)&&!isNaN(a)||!n)return new Ke.Vec2(r,a);e="list.point"}if("vec3"===e){var r=parseFloat(t.getAttribute("x")),a=parseFloat(t.getAttribute("y")),o=parseFloat(t.getAttribute("z"));return new Ke.Vec3(r,a,o)}if("data"===e){var h=t.getAttribute("ref"),l=this.refMap[h];return l?l:this.idMap[h]}var c,u,d,f;if("list.point"===e){var g=new ci,_=t.getElementsByTagName("p");for(c=_.length,f=0;f<c;f++){var p=_[f];g.add(this.deserializePoint(p))}return n?g._as:g}if("list.string"===e){var v=new ci;for(d=t.getElementsByTagName("s"),c=d.length,f=0;f<c;f++)v.add(d[f].textContent);return v}if("list.number"===e){for(u=new ci,d=t.getElementsByTagName("s"),c=d.length,f=0;f<c;f++)u.add(parseFloat(d[f].textContent));return u}if("array.string"===e)return t.textContent.split(",");if("array.number"===e){for(u=t.textContent.split(","),c=u.length,f=0;f<c;f++)u[f]=parseFloat(u[f]);return u}return"rectangle"===e?{x:parseFloat(t.getAttribute("x")),y:parseFloat(t.getAttribute("y")),width:parseFloat(t.getAttribute("w")),height:parseFloat(t.getAttribute("h"))}:t.textContent}}),Ke.addMethod(Ke.Data,{serializeXml:function(t,e){if(this.__SizePropeties&&this.__SizePropeties.length){var i,n;for(i=0,n=this.__SizePropeties.length;i<n;i++)this.serializePropertyXml(t,this.__SizePropeties[i],e)}else this.serializePropertyXml(t,"materialSize",e),this.vertices&&this.vertices.length&&this.serializePropertyXml(t,"vertices",e),this.faces&&this.faces.length&&this.serializePropertyXml(t,"faces",e),this.uvs&&this.uvs.length&&this.serializePropertyXml(t,"uvs",e);if(t.settings.isClientSerializable&&this._clientMap)for(var s in this._clientMap)this.serializeClientXml(t,s,e);this.serializePropertyXml(t,"name",e),this.serializePropertyXml(t,"parent",e)},serializePropertyXml:function(t,e,i){t.serializePropertyXml(this,e,i)},serializeClientXml:function(t,e,i){t.serializeClientXml(this,e,i)},deserializeXml:function(t,e){var i,n,s,r,a=e.getElementsByTagName("p"),o=a.length;for(i=0;i<o;i++)n=a[i],n.hasAttribute("n")&&this.deserializePropertyXml(t,n,n.getAttribute("n"));if(t.settings.isClientSerializable)for(s=e.getElementsByTagName("c"),o=s.length,i=0;i<o;i++)r=s[i],r.hasAttribute("n")&&this.deserializeClientXml(t,r,r.getAttribute("n"))},deserializePropertyXml:function(t,e,i){t.deserializePropertyXml(this,e,i)},deserializeClientXml:function(t,e,i){t.deserializeClientXml(this,e,i)}}),Ke.addMethod(Ke.Element,{serializeXml:function(t,e){if(t.settings.isStyleSerializable&&this.styleMap)for(var i in this.styleMap)this.isSideStyle(i)||this.serializeStyleXml(t,i,e);this.serializePropertyXml(t,"position",e),this.serializePropertyXml(t,"rotation",e),this.serializePropertyXml(t,"scale",e),Ke.Element.superClass.serializeXml.call(this,t,e),this._alarmState.getHighestNativeAlarmSeverity()&&"alarmstate"===t.settings.getPropertyType("alarmState")&&(t.xmlString+="\t<p n='alarmState'>\n",Ke.AlarmSeverity.forEach(function(e){var i=this.getNewAlarmCount(e);i>0&&(t.xmlString+="\t\t<n n='"+e.name+"' c='"+i+"'/>\n")},this._alarmState),Ke.AlarmSeverity.forEach(function(e){var i=this.getAcknowledgedAlarmCount(e);i>0&&(t.xmlString+="\t\t<a n='"+e.name+"' c='"+i+"'/>\n")},this._alarmState),t.xmlString+="\t</p>\n")},serializeStyleXml:function(t,e,i){t.serializeStyleXml(this,e,i)},deserializeXml:function(t,e){if(Ke.Element.superClass.deserializeXml.call(this,t,e),t.settings.isStyleSerializable){var i,n,s=e.getElementsByTagName("s"),r=s.length;for(i=0;i<r;i++)n=s[i],n.hasAttribute("n")&&this.deserializeStyleXml(t,n,n.getAttribute("n"))}},deserializeStyleXml:function(t,e,i){t.deserializeStyleXml(this,e,i)},deserializePropertyXml:function(t,e,i){if("alarmState"===i){if("alarmstate"===t.settings.getPropertyType("alarmState")){var n,s,r,a=e.getElementsByTagName("n");for(s=0;s<a.length;s++)r=a[s],n=twaver.AlarmSeverity.getByName(r.getAttribute("n")),this._alarmState.setNewAlarmCount(n,parseInt(r.getAttribute("c")));for(a=e.getElementsByTagName("a"),s=0;s<a.length;s++)r=a[s],n=twaver.AlarmSeverity.getByName(r.getAttribute("n")),this._alarmState.setAcknowledgedAlarmCount(n,parseInt(r.getAttribute("c")))}}else Ke.Element.superClass.deserializePropertyXml.call(this,t,e,i)}}),Ke.addMethod(Ke.DataBox,{serializeXml:function(t,e){if(t.settings.isClientSerializable&&this._clientMap)for(var i in this._clientMap)this.serializeClientXml(t,i,e);this.serializePropertyXml(t,"name",e)},serializePropertyXml:function(t,e,i){t.serializePropertyXml(this,e,i)},serializeClientXml:function(t,e,i){t.serializeClientXml(this,e,i)},deserializeXml:function(t,e){var i,n,s,r,a=e.getElementsByTagName("p"),o=a.length;for(i=0;i<o;i++)n=a[i],n.hasAttribute("n")&&this.deserializePropertyXml(t,n,n.getAttribute("n"));if(t.settings.isClientSerializable)for(s=e.getElementsByTagName("c"),o=s.length,i=0;i<o;i++)r=s[i],r.hasAttribute("n")&&this.deserializeClientXml(t,r,r.getAttribute("n"))},deserializePropertyXml:function(t,e,i){t.deserializePropertyXml(this,e,i)},deserializeClientXml:function(t,e,i){t.deserializeClientXml(this,e,i)}}),Ke.JsonSerializer=function(t,e,i){this.dataBox=t,this.settings=e?e:new Ke.SerializationSettings,this.filterFunction=i,this.ref=0,this.refMap={},this.idMap={},this.jsonObject={}},Ke.extend(Ke.JsonSerializer,Object,{constructor:Ke.JsonSerializer,className:"TGL.JsonSerializer",serialize:function(){return this.jsonObject={v:Ke.version,platform:"html5"},this.serializeBody(),JSON.stringify(this.jsonObject)},serializeBody:function(){if(this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable){var t={"class":this.dataBox.getClassName(),p:{},s:{},c:{}};this.jsonObject.dataBox=t,this.dataBox.serializeJson(this,this.dataBox.newInstance(),t),yi.isEmptyObject(t.p)&&delete t.p,yi.isEmptyObject(t.s)&&delete t.s,yi.isEmptyObject(t.c)&&delete t.c}this.jsonObject.datas=[],this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(t){if(this.refMap[t.getId()]=this.ref++,t.getChildren().forEach(this.initRefs,this),t instanceof Ke.ComboNode)for(var e=0;e<t.combos.length;e++){var i=t.combos[e];this.refMap[i.getId()]||(this.refMap[i.getId()]=this.ref++)}},isSerializable:function(t){return!!this.dataBox.contains(t)&&!(this.filterFunction&&!this.filterFunction(t))},serializeData:function(t){if(this.isSerializable(t)){var e=t.newInstance(),i=this.refMap[t.getId()],n={"class":t.getClassName(),ref:i,p:{},s:{},c:{}};this.settings.getPropertyType("id")&&(this.jsonObject.id=t.getId()),this.jsonObject.datas.push(n),t.serializeJson(this,e,n),yi.isEmptyObject(n.p)&&delete n.p,yi.isEmptyObject(n.s)&&delete n.s,yi.isEmptyObject(n.c)&&delete n.c}t.getChildren().forEach(this.serializeData,this)},serializeDataValue:function(t){var e=t.newInstance(),i=this.refMap[t.getId()],n={"class":t.getClassName(),ref:i,p:{},s:{},c:{}};return t.serializeJson(this,e,n),yi.isEmptyObject(n.p)&&delete n.p,yi.isEmptyObject(n.s)&&delete n.s,yi.isEmptyObject(n.c)&&delete n.c,n},getPropertyType:function(t,e){var i=this.settings.getPropertyType(e);return i||(t.__bool&&t.__bool.indexOf(e)!=-1?i="boolean":t.__SizePropeties&&t.__SizePropeties.indexOf(e)!=-1&&(i="number")),i},getStyleType:function(t,e){t.isSideStyle(e)&&(e=e.substr(e.indexOf(".")+1));var i=this.settings.getStyleType(e);return i},serializePropertyJson:function(t,e,i,n){var s=this.getPropertyType(t,e);if(s){var r=Ke.getValue(t,e,s),a=Ke.getValue(i,e,s);r!==a&&(r&&r.equals?!r.equals(a)&&this.serializeValue(e,r,a,s,n.p):this.serializeValue(e,r,a,s,n.p))}},serializeStyleJson:function(t,e,i,n){var s=this.getStyleType(t,e);if(s){var r=t.getStyle(e),a=i.getStyle(e);e.startsWith("m.")&&(r=this.flattenArray(r),a=this.flattenArray(a)),e.endsWith(".image")&&(r=this.encodeURI(r),a=this.encodeURI(a)),r!=a&&(r&&r.equals?!r.equals(a)&&this.serializeValue(e,r,a,s,n.s):this.serializeValue(e,r,a,s,n.s))}},serializeClientJson:function(t,e,i,n){var s=this.settings.getClientType(e);if(null!=s){var r=t.getClient(e),a=i.getClient(e);r!=a&&(r&&r.equals?!r.equals(a)&&this.serializeValue(e,r,a,s,n.c):this.serializeValue(e,r,a,s,n.c))}},serializeValue:function(t,e,i,n,s){if(null==e)s[t]=null;else if(e instanceof ci)s[t]=e._as;else if("data"===n){var r=this.refMap[e.getId()];
null!=r&&(s[t]=r)}else if("data.list"===n){for(var a=[],o=0;o<e.length;o++)a.push(this.serializeDataValue(e[o]));s[t]=a}else if("serializeabe.list"===n){for(var a=[],o=0;o<e.length;o++)a.push(e[o].serializeJsonValue());s[t]=a}else e.serializeJsonValue?s[t]=e.serializeJsonValue():s[t]=e},deserialize:function(t,e){Ke.isDeserializing=!0,this.jsonObject=JSON.parse(t),this.refMap={},this.idMap={};var i,n=new ci,s=new ci,r=this.jsonObject.datas.length;null!=this.deserializeStartCreateData&&this.deserializeStartCreateData(r);for(var a=0;a<r;a++){var o=this.jsonObject.datas[a],h=o["class"],l=this.settings.getPropertyType("id");if(l&&null!=o.id){if("remove"===o.action){this.dataBox.removeById(o.id);continue}i=this.dataBox.getDataById(o.id),i||(i=Ke.newInstance(h,o.id))}else{i=Ke.newInstance(h)}null!=o.ref&&(this.refMap[o.ref]=i),n.add(i),s.add(o),this.idMap[i.getId()]=i,this.deserializeCreateData&&this.deserializeCreateData(a,r)}for(this.dataBox.forEach(function(t){this.idMap[t.getId()]=t},this),r=n.size(),this.deserializeStartFillData&&this.deserializeStartFillData(r),a=0;a<r;a++)i=n.get(a),i.deserializeJson(this,s.get(a)),this.deserializeFillData&&this.deserializeFillData(a,r);for(this.deserializeStartAddData&&this.deserializeStartAddData(r),a=0;a<r;a++)i=n.get(a),this.dataBox.containsById(i.getId())||(e&&!i.getParent()&&i.setParent(e),"TGL.Entity"===i.getClassName()&&(i.computed=!1,i.computeNodeData()),this.dataBox.add(i),this.deserializeAddData&&this.deserializeAddData(a,r));this.settings.isDataBoxSerializable&&this.jsonObject.dataBox&&this.dataBox.deserializeJson(this,this.jsonObject.dataBox),Ke.isDeserializing=!1},deserializePropertyJson:function(t,e,i){var n=this.getPropertyType(t,i);n&&Ke.setValue(t,i,this.deserializeValue(e,n))},deserializeStyleJson:function(t,e,i){var n=this.getStyleType(t,i);if(n){var s=this.deserializeValue(e,n);s._as&&(s=s._as),t.setStyle(i,s)}},deserializeClientJson:function(t,e,i){var n=this.settings.getClientType(i);n&&t.setClient(i,this.deserializeValue(e,n))},getClassName:function(t){if(null!=t)return t["class"]?t["class"]:t.w!==e&&t.x!==e&&t.y!==e&&t.z!==e?"TGL.Vec4":t.x!==e&&t.y!==e&&t.z!==e?"TGL.Vec3":t.x!==e&&t.y!==e?"TGL.Vec2":t.a!==e&&t.b!==e&&t.c!==e&&t.d!==e?"TGL.Face4":t.a!==e&&t.b!==e&&t.c!==e?"TGL.Face3":void 0},translateJson:function(t){if(null!=t){if(null!=this.getClassName(t)){var e=Ke.newInstance(this.getClassName(t));if(e.deserializeJsonValue)e.deserializeJsonValue(t);else for(var i in t)e[i]=t[i];return e}if(t instanceof Array)for(var n=0;n<t.length;n++)t[n]=this.translateJson(t[n]);return t}},isChinese:function(t){return t=t||"",escape(t).indexOf("%u")>0},encodeURI:function(t){if(t instanceof Array){for(var e=0;e<t.length;e++)t[e]=this.encodeURI(t[e]);return t}return"string"==typeof t&&this.isChinese(t)?encodeURI(t):t},flattenArray:function(t){if(t instanceof Array){for(var e=0;e<t.length-1;e++)if(t[e]!=t[e+1]){if(!t[e]||!t[e].equals)return t;if(!t[e].equals(t[e+1]))return t}return t[0]}return t},deserializeValue:function(t,i){if("data"===i){var n=this.refMap[t];return n?n:this.idMap[t]}if("data.list"===i){for(var s,r,a=[],o=0;o<t.length;o++)s=t[o],r=Ke.newInstance(s["class"]),null!=s.ref&&(this.refMap[s.ref]=r),r.deserializeJson(this,s),a.push(r);return a}if("color"===i&&t.r!=e){var h=new Ke.Color;return h.setRGB(t.r,t.g,t.b),h}if("TGL.Path"===t["class"]){var l=new Ke.Path;return l.deserializeJsonValue(t),l}if(t instanceof Array){for(var o=0;o<t.length;o++)t[o]=this.translateJson(t[o]);return t}return null!=this.getClassName(t)?this.translateJson(t):t}}),Ke.addMethod(Ke.DataBox,{serializeJson:function(t,e,i){if(t.settings.isClientSerializable&&this._clientMap)for(var n in this._clientMap)this.serializeClientJson(t,n,e,i);this.serializePropertyJson(t,"name",e,i)},serializePropertyJson:function(t,e,i,n){t.serializePropertyJson(this,e,i,n)},serializeClientJson:function(t,e,i,n){t.serializeClientJson(this,e,i,n)},deserializeJson:function(t,e){var i;for(i in e.p)this.deserializePropertyJson(t,e.p[i],i);if(t.settings.isClientSerializable)for(i in e.c)this.deserializeClientJson(t,e.c[i],i)},deserializePropertyJson:function(t,e,i){t.deserializePropertyJson(this,e,i)},deserializeClientJson:function(t,e,i){t.deserializeClientJson(this,e,i)}}),Ke.addMethod(Ke.Data,{serializeJson:function(t,e,i){if(this.__SizePropeties&&this.__SizePropeties.length){var n,s;for(n=0,s=this.__SizePropeties.length;n<s;n++)this.serializePropertyJson(t,this.__SizePropeties[n],e,i)}else this.materialSize&&this.serializePropertyJson(t,"materialSize",e,i),this instanceof Ke.Entity&&(this.vertices&&this.vertices.length&&this.serializePropertyJson(t,"vertices",e,i),this.faces&&this.faces.length&&this.serializePropertyJson(t,"faces",e,i),this.uvs&&this.uvs.length&&this.serializePropertyJson(t,"uvs",e,i),this.uv2s&&this.uv2s.length&&this.serializePropertyJson(t,"uv2s",e,i));if(t.settings.isClientSerializable&&this._clientMap)for(var r in this._clientMap)this.serializeClientJson(t,r,e,i);this.serializePropertyJson(t,"name",e,i),this.serializePropertyJson(t,"parent",e,i)},serializePropertyJson:function(t,e,i,n){t.serializePropertyJson(this,e,i,n)},serializeClientJson:function(t,e,i,n){t.serializeClientJson(this,e,i,n)},deserializeJson:function(t,e){var i;for(i in e.p)this.deserializePropertyJson(t,e.p[i],i);if(t.settings.isClientSerializable)for(i in e.c)this.deserializeClientJson(t,e.c[i],i)},deserializePropertyJson:function(t,e,i){t.deserializePropertyJson(this,e,i)},deserializeClientJson:function(t,e,i){t.deserializeClientJson(this,e,i)}}),Ke.addMethod(Ke.Element,{serializeJson:function(t,e,i){if(t.settings.isStyleSerializable&&this.styleMap)for(var n in this.styleMap)this.isSideStyle(n)||this.serializeStyleJson(t,n,e,i);if(Ke.Element.superClass.serializeJson.call(this,t,e,i),this.serializePropertyJson(t,"position",e,i),this.serializePropertyJson(t,"rotation",e,i),this.serializePropertyJson(t,"scale",e,i),this._alarmState.getHighestNativeAlarmSeverity()&&"alarmstate"===t.settings.getPropertyType("alarmState")){var s={n:{},a:{}};i.p.alarmState=s,Ke.AlarmSeverity.forEach(function(t){var e=this.getNewAlarmCount(t);e>0&&(s.n[t.name]=e)},this._alarmState),Ke.AlarmSeverity.forEach(function(t){var e=this.getAcknowledgedAlarmCount(t);e>0&&(s.a[t.name]=e)},this._alarmState),yi.isEmptyObject(s.n)&&delete s.n,yi.isEmptyObject(s.a)&&delete s.a,yi.isEmptyObject(s)&&delete i.p.alarmState}},serializeStyleJson:function(t,e,i,n){t.serializeStyleJson(this,e,i,n)},deserializeJson:function(t,e){if(Ke.Element.superClass.deserializeJson.call(this,t,e),t.settings.isStyleSerializable)for(var i in e.s)this.deserializeStyleJson(t,e.s[i],i)},deserializeStyleJson:function(t,e,i){t.deserializeStyleJson(this,e,i)},deserializePropertyJson:function(t,e,i){if("alarmState"===i){if("alarmstate"===t.settings.getPropertyType("alarmState")){var n;for(n in e.n)this._alarmState.setNewAlarmCount(twaver.AlarmSeverity.getByName(n),e.n[n]);for(n in e.a)this._alarmState.setAcknowledgedAlarmCount(twaver.AlarmSeverity.getByName(n),e.a[n])}}else Ke.Element.superClass.deserializePropertyJson.call(this,t,e,i)}}),Ke.addMethod(Ke.Light,{serializeJson:function(t,e,i){if(Ke.Light.superClass.serializeJson.call(this,t,e,i),this.serializePropertyJson(t,"color",e,i),this.serializePropertyJson(t,"ambient",e,i),this.serializePropertyJson(t,"diffuse",e,i),this.serializePropertyJson(t,"specular",e,i),this.serializePropertyJson(t,"castShadow",e,i),this.serializePropertyJson(t,"onlyShadow",e,i),e.__accessor&&e.__accessor.length)for(var n=0;n<e.__accessor.length;n++)this.serializePropertyJson(t,e.__accessor[n],e,i)}});var pn=Ke.Animate=function(t){var e=this;e.type=null==t.type?"number":t.type,e.delay=null==t.delay?0:t.delay,e.dur=null==t.dur?1e3:t.dur,e.interval=null==t.interval?0:t.interval,e.finish=null==t.finish?e.delay+e.dur+e.interval:t.finish,e.repeat=null==t.repeat?1:t.repeat,e.reverse=null==t.reverse||t.reverse,e.easing=null==t.easing?"easeNone":t.easing,e.onUpdate=t.onUpdate,e.onDone=t.onDone,e.onStop=t.onStop,e.onPlay=t.onPlay,e.attr=t.attr,e.source=t.source,e.filter=t.filter,e.from=t.from,e.to=t.to,e.start=null,e.time=0,e.total=0,e.count=0,e.started=!1,e.stopped=!1,e.id=mn++};Ke.extend(Ke.Animate,Object,{play:function(){return He(this)},stop:function(t){return Ge(this,t)},clone:function(){return new pn(this)},chain:function(t){var e,i=this;return i.onDone?(e=i.onDone,i.onDone=function(){e.call(i),t.play()}):i.onDone=function(){t.play()},i}});var vn={},mn=1,yn=!1;!function An(t){requestAnimationFrame(An),yn&&(yn=!1,Ye(t))}(0)}(window),!function(t,e){function n(t,e,i){null!=t&&("number"==typeof t?this.fromNumber(t,e,i):null==e&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,e))}function s(){return new n(null)}function r(t,e,i,n,s,r){for(;--r>=0;){var a=e*this[t++]+i[n]+s;s=Math.floor(a/67108864),i[n++]=67108863&a}return s}function a(t,e,i,n,s,r){for(var a=32767&e,o=e>>15;--r>=0;){var h=32767&this[t],l=this[t++]>>15,c=o*h+l*a;h=a*h+((32767&c)<<15)+i[n]+(1073741823&s),s=(h>>>30)+(c>>>15)+o*l+(s>>>30),i[n++]=1073741823&h}return s}function o(t,e,i,n,s,r){for(var a=16383&e,o=e>>14;--r>=0;){var h=16383&this[t],l=this[t++]>>14,c=o*h+l*a;h=a*h+((16383&c)<<14)+i[n]+s,s=(h>>28)+(c>>14)+o*l,i[n++]=268435455&h}return s}function h(t){return ni.charAt(t)}function l(t,e){var i=si[t.charCodeAt(e)];return null==i?-1:i}function c(t){for(var e=this.t-1;e>=0;--e)t[e]=this[e];t.t=this.t,t.s=this.s}function u(t){this.t=1,this.s=0>t?-1:0,t>0?this[0]=t:-1>t?this[0]=t+DV:this.t=0}function d(t){var e=s();return e.fromInt(t),e}function f(t,e){var i;if(16==e)i=4;else if(8==e)i=3;else if(256==e)i=8;else if(2==e)i=1;else if(32==e)i=5;else{if(4!=e)return void this.fromRadix(t,e);i=2}this.t=0,this.s=0;for(var s=t.length,r=!1,a=0;--s>=0;){var o=8==i?255&t[s]:l(t,s);0>o?"-"==t.charAt(s)&&(r=!0):(r=!1,0==a?this[this.t++]=o:a+i>this.DB?(this[this.t-1]|=(o&(1<<this.DB-a)-1)<<a,this[this.t++]=o>>this.DB-a):this[this.t-1]|=o<<a,a+=i,a>=this.DB&&(a-=this.DB))}8==i&&0!=(128&t[0])&&(this.s=-1,a>0&&(this[this.t-1]|=(1<<this.DB-a)-1<<a)),this.clamp(),r&&n.ZERO.subTo(this,this)}function g(){for(var t=this.s&this.DM;this.t>0&&this[this.t-1]==t;)--this.t}function _(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var i,n=(1<<e)-1,s=!1,r="",a=this.t,o=this.DB-a*this.DB%e;if(a-- >0)for(o<this.DB&&(i=this[a]>>o)>0&&(s=!0,r=h(i));a>=0;)e>o?(i=(this[a]&(1<<o)-1)<<e-o,i|=this[--a]>>(o+=this.DB-e)):(i=this[a]>>(o-=e)&n,0>=o&&(o+=this.DB,--a)),i>0&&(s=!0),s&&(r+=h(i));return s?r:"0"}function p(){var t=s();return n.ZERO.subTo(this,t),t}function v(){return this.s<0?this.negate():this}function m(t){var e=this.s-t.s;if(0!=e)return e;var i=this.t;if(e=i-t.t,0!=e)return e;for(;--i>=0;)if(0!=(e=this[i]-t[i]))return e;return 0}function y(t){var e,i=1;return 0!=(e=t>>>16)&&(t=e,i+=16),0!=(e=t>>8)&&(t=e,i+=8),0!=(e=t>>4)&&(t=e,i+=4),0!=(e=t>>2)&&(t=e,i+=2),0!=(e=t>>1)&&(t=e,i+=1),i}function A(){return this.t<=0?0:this.DB*(this.t-1)+y(this[this.t-1]^this.s&this.DM)}function x(t,e){var i;for(i=this.t-1;i>=0;--i)e[i+t]=this[i];for(i=t-1;i>=0;--i)e[i]=0;e.t=this.t+t,e.s=this.s}function w(t,e){for(var i=t;i<this.t;++i)e[i-t]=this[i];e.t=Math.max(this.t-t,0),e.s=this.s}function b(t,e){var i,n=t%this.DB,s=this.DB-n,r=(1<<s)-1,a=Math.floor(t/this.DB),o=this.s<<n&this.DM;for(i=this.t-1;i>=0;--i)e[i+a+1]=this[i]>>s|o,o=(this[i]&r)<<n;for(i=a-1;i>=0;--i)e[i]=0;e[a]=o,e.t=this.t+a+1,e.s=this.s,e.clamp()}function S(t,e){e.s=this.s;var i=Math.floor(t/this.DB);if(i>=this.t)return void(e.t=0);var n=t%this.DB,s=this.DB-n,r=(1<<n)-1;e[0]=this[i]>>n;for(var a=i+1;a<this.t;++a)e[a-i-1]|=(this[a]&r)<<s,e[a-i]=this[a]>>n;n>0&&(e[this.t-i-1]|=(this.s&r)<<s),e.t=this.t-i,e.clamp()}function C(t,e){for(var i=0,n=0,s=Math.min(t.t,this.t);s>i;)n+=this[i]-t[i],e[i++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n-=t.s;i<this.t;)n+=this[i],e[i++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;i<t.t;)n-=t[i],e[i++]=n&this.DM,n>>=this.DB;n-=t.s}e.s=0>n?-1:0,-1>n?e[i++]=this.DV+n:n>0&&(e[i++]=n),e.t=i,e.clamp()}function T(t,e){var i=this.abs(),s=t.abs(),r=i.t;for(e.t=r+s.t;--r>=0;)e[r]=0;for(r=0;r<s.t;++r)e[r+i.t]=i.am(0,s[r],e,r,0,i.t);e.s=0,e.clamp(),this.s!=t.s&&n.ZERO.subTo(e,e)}function E(t){for(var e=this.abs(),i=t.t=2*e.t;--i>=0;)t[i]=0;for(i=0;i<e.t-1;++i){var n=e.am(i,e[i],t,2*i,0,1);(t[i+e.t]+=e.am(i+1,2*e[i],t,2*i+1,n,e.t-i-1))>=e.DV&&(t[i+e.t]-=e.DV,t[i+e.t+1]=1)}t.t>0&&(t[t.t-1]+=e.am(i,e[i],t,2*i,0,1)),t.s=0,t.clamp()}function L(t,e,i){var r=t.abs();if(!(r.t<=0)){var a=this.abs();if(a.t<r.t)return null!=e&&e.fromInt(0),void(null!=i&&this.copyTo(i));null==i&&(i=s());var o=s(),h=this.s,l=t.s,c=this.DB-y(r[r.t-1]);c>0?(r.lShiftTo(c,o),a.lShiftTo(c,i)):(r.copyTo(o),a.copyTo(i));var u=o.t,d=o[u-1];if(0!=d){var f=d*(1<<this.F1)+(u>1?o[u-2]>>this.F2:0),g=this.FV/f,_=(1<<this.F1)/f,p=1<<this.F2,v=i.t,m=v-u,A=null==e?s():e;for(o.dlShiftTo(m,A),i.compareTo(A)>=0&&(i[i.t++]=1,i.subTo(A,i)),n.ONE.dlShiftTo(u,A),A.subTo(o,o);o.t<u;)o[o.t++]=0;for(;--m>=0;){var x=i[--v]==d?this.DM:Math.floor(i[v]*g+(i[v-1]+p)*_);if((i[v]+=o.am(0,x,i,m,0,u))<x)for(o.dlShiftTo(m,A),i.subTo(A,i);i[v]<--x;)i.subTo(A,i)}null!=e&&(i.drShiftTo(u,e),h!=l&&n.ZERO.subTo(e,e)),i.t=u,i.clamp(),c>0&&i.rShiftTo(c,i),0>h&&n.ZERO.subTo(i,i)}}}function M(t){var e=s();return this.abs().divRemTo(t,null,e),this.s<0&&e.compareTo(n.ZERO)>0&&t.subTo(e,e),e}function P(t){this.m=t}function k(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t}function I(t){return t}function R(t){t.divRemTo(this.m,null,t)}function D(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function B(t,e){t.squareTo(e),this.reduce(e)}function N(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var e=3&t;return e=e*(2-(15&t)*e)&15,e=e*(2-(255&t)*e)&255,e=e*(2-((65535&t)*e&65535))&65535,e=e*(2-t*e%this.DV)%this.DV,e>0?this.DV-e:-e}function z(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function O(t){var e=s();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&e.compareTo(n.ZERO)>0&&this.m.subTo(e,e),e}function F(t){var e=s();return t.copyTo(e),this.reduce(e),e}function V(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var i=32767&t[e],n=i*this.mpl+((i*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(i=e+this.m.t,t[i]+=this.m.am(0,n,t,e,0,this.m.t);t[i]>=t.DV;)t[i]-=t.DV,t[++i]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)}function U(t,e){t.squareTo(e),this.reduce(e)}function H(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function W(){return 0==(this.t>0?1&this[0]:this.s)}function X(t,e){if(t>4294967295||1>t)return n.ONE;var i=s(),r=s(),a=e.convert(this),o=y(t)-1;for(a.copyTo(i);--o>=0;)if(e.sqrTo(i,r),(t&1<<o)>0)e.mulTo(r,a,i);else{var h=i;i=r,r=h}return e.revert(i)}function G(t,e){var i;return i=256>t||e.isEven()?new P(e):new z(e),this.exp(t,i)}function Z(){var t=s();return this.copyTo(t),t}function Y(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function j(){return 0==this.t?this.s:this[0]<<24>>24}function q(){return 0==this.t?this.s:this[0]<<16>>16}function K(t){return Math.floor(Math.LN2*this.DB/Math.log(t))}function Q(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function J(t){if(null==t&&(t=10),0==this.signum()||2>t||t>36)return"0";var e=this.chunkSize(t),i=Math.pow(t,e),n=d(i),r=s(),a=s(),o="";for(this.divRemTo(n,r,a);r.signum()>0;)o=(i+a.intValue()).toString(t).substr(1)+o,r.divRemTo(n,r,a);return a.intValue().toString(t)+o}function $(t,e){this.fromInt(0),null==e&&(e=10);for(var i=this.chunkSize(e),s=Math.pow(e,i),r=!1,a=0,o=0,h=0;h<t.length;++h){var c=l(t,h);0>c?"-"==t.charAt(h)&&0==this.signum()&&(r=!0):(o=e*o+c,++a>=i&&(this.dMultiply(s),this.dAddOffset(o,0),a=0,o=0))}a>0&&(this.dMultiply(Math.pow(e,a)),this.dAddOffset(o,0)),r&&n.ZERO.subTo(this,this)}function tt(t,e,i){if("number"==typeof e)if(2>t)this.fromInt(1);else for(this.fromNumber(t,i),this.testBit(t-1)||this.bitwiseTo(n.ONE.shiftLeft(t-1),ht,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(n.ONE.shiftLeft(t-1),this);else{var s=new Array,r=7&t;s.length=(t>>3)+1,e.nextBytes(s),r>0?s[0]&=(1<<r)-1:s[0]=0,this.fromString(s,256)}}function et(){var t=this.t,e=new Array;e[0]=this.s;var i,n=this.DB-t*this.DB%8,s=0;if(t-- >0)for(n<this.DB&&(i=this[t]>>n)!=(this.s&this.DM)>>n&&(e[s++]=i|this.s<<this.DB-n);t>=0;)8>n?(i=(this[t]&(1<<n)-1)<<8-n,i|=this[--t]>>(n+=this.DB-8)):(i=this[t]>>(n-=8)&255,0>=n&&(n+=this.DB,--t)),0!=(128&i)&&(i|=-256),0==s&&(128&this.s)!=(128&i)&&++s,(s>0||i!=this.s)&&(e[s++]=i);return e}function it(t){return 0==this.compareTo(t)}function nt(t){return this.compareTo(t)<0?this:t}function st(t){return this.compareTo(t)>0?this:t}function rt(t,e,i){var n,s,r=Math.min(t.t,this.t);for(n=0;r>n;++n)i[n]=e(this[n],t[n]);if(t.t<this.t){for(s=t.s&this.DM,n=r;n<this.t;++n)i[n]=e(this[n],s);i.t=this.t}else{for(s=this.s&this.DM,n=r;n<t.t;++n)i[n]=e(s,t[n]);i.t=t.t}i.s=e(this.s,t.s),i.clamp()}function at(t,e){return t&e}function ot(t){var e=s();return this.bitwiseTo(t,at,e),e}function ht(t,e){return t|e}function lt(t){var e=s();return this.bitwiseTo(t,ht,e),e}function ct(t,e){return t^e}function ut(t){var e=s();return this.bitwiseTo(t,ct,e),e}function dt(t,e){return t&~e}function ft(t){var e=s();return this.bitwiseTo(t,dt,e),e}function gt(){for(var t=s(),e=0;e<this.t;++e)t[e]=this.DM&~this[e];return t.t=this.t,t.s=~this.s,t}function _t(t){var e=s();return 0>t?this.rShiftTo(-t,e):this.lShiftTo(t,e),e}function pt(t){var e=s();return 0>t?this.lShiftTo(-t,e):this.rShiftTo(t,e),e}function vt(t){if(0==t)return-1;var e=0;return 0==(65535&t)&&(t>>=16,e+=16),0==(255&t)&&(t>>=8,e+=8),0==(15&t)&&(t>>=4,e+=4),0==(3&t)&&(t>>=2,e+=2),0==(1&t)&&++e,e}function mt(){for(var t=0;t<this.t;++t)if(0!=this[t])return t*this.DB+vt(this[t]);return this.s<0?this.t*this.DB:-1}function yt(t){for(var e=0;0!=t;)t&=t-1,++e;return e}function At(){for(var t=0,e=this.s&this.DM,i=0;i<this.t;++i)t+=yt(this[i]^e);return t}function xt(t){var e=Math.floor(t/this.DB);return e>=this.t?0!=this.s:0!=(this[e]&1<<t%this.DB)}function wt(t,e){var i=n.ONE.shiftLeft(t);return this.bitwiseTo(i,e,i),i}function bt(t){return this.changeBit(t,ht)}function St(t){return this.changeBit(t,dt)}function Ct(t){return this.changeBit(t,ct)}function Tt(t,e){for(var i=0,n=0,s=Math.min(t.t,this.t);s>i;)n+=this[i]+t[i],e[i++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n+=t.s;i<this.t;)n+=this[i],e[i++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;i<t.t;)n+=t[i],e[i++]=n&this.DM,n>>=this.DB;n+=t.s}e.s=0>n?-1:0,n>0?e[i++]=n:-1>n&&(e[i++]=this.DV+n),e.t=i,e.clamp()}function Et(t){var e=s();return this.addTo(t,e),e}function Lt(t){var e=s();return this.subTo(t,e),e}function Mt(t){var e=s();return this.multiplyTo(t,e),e}function Pt(){var t=s();return this.squareTo(t),t}function kt(t){var e=s();return this.divRemTo(t,e,null),e}function It(t){var e=s();return this.divRemTo(t,null,e),e}function Rt(t){var e=s(),i=s();return this.divRemTo(t,e,i),new Array(e,i)}function Dt(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()}function Bt(t,e){if(0!=t){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=t;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}}function Nt(){}function zt(t){return t}function Ot(t,e,i){t.multiplyTo(e,i)}function Ft(t,e){t.squareTo(e)}function Vt(t){return this.exp(t,new Nt)}function Ut(t,e,i){var n=Math.min(this.t+t.t,e);for(i.s=0,i.t=n;n>0;)i[--n]=0;var s;for(s=i.t-this.t;s>n;++n)i[n+this.t]=this.am(0,t[n],i,n,0,this.t);for(s=Math.min(t.t,e);s>n;++n)this.am(0,t[n],i,n,0,e-n);i.clamp()}function Ht(t,e,i){--e;var n=i.t=this.t+t.t-e;for(i.s=0;--n>=0;)i[n]=0;for(n=Math.max(e-this.t,0);n<t.t;++n)i[this.t+n-e]=this.am(e-n,t[n],i,0,0,this.t+n-e);i.clamp(),i.drShiftTo(1,i)}function Wt(t){this.r2=s(),this.q3=s(),n.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}function Xt(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=s();return t.copyTo(e),this.reduce(e),e}function Gt(t){return t}function Zt(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)}function Yt(t,e){t.squareTo(e),this.reduce(e)}function jt(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function qt(t,e){var i,n,r=t.bitLength(),a=d(1);if(0>=r)return a;i=18>r?1:48>r?3:144>r?4:768>r?5:6,n=8>r?new P(e):e.isEven()?new Wt(e):new z(e);var o=new Array,h=3,l=i-1,c=(1<<i)-1;if(o[1]=n.convert(this),i>1){var u=s();for(n.sqrTo(o[1],u);c>=h;)o[h]=s(),n.mulTo(u,o[h-2],o[h]),h+=2}var f,g,_=t.t-1,p=!0,v=s();for(r=y(t[_])-1;_>=0;){for(r>=l?f=t[_]>>r-l&c:(f=(t[_]&(1<<r+1)-1)<<l-r,_>0&&(f|=t[_-1]>>this.DB+r-l)),h=i;0==(1&f);)f>>=1,--h;if((r-=h)<0&&(r+=this.DB,--_),p)o[f].copyTo(a),p=!1;else{for(;h>1;)n.sqrTo(a,v),n.sqrTo(v,a),h-=2;h>0?n.sqrTo(a,v):(g=a,a=v,v=g),n.mulTo(v,o[f],a)}for(;_>=0&&0==(t[_]&1<<r);)n.sqrTo(a,v),g=a,a=v,v=g,--r<0&&(r=this.DB-1,--_)}return n.revert(a)}function Kt(t){var e=this.s<0?this.negate():this.clone(),i=t.s<0?t.negate():t.clone();if(e.compareTo(i)<0){var n=e;e=i,i=n}var s=e.getLowestSetBit(),r=i.getLowestSetBit();if(0>r)return e;for(r>s&&(r=s),r>0&&(e.rShiftTo(r,e),i.rShiftTo(r,i));e.signum()>0;)(s=e.getLowestSetBit())>0&&e.rShiftTo(s,e),(s=i.getLowestSetBit())>0&&i.rShiftTo(s,i),e.compareTo(i)>=0?(e.subTo(i,e),e.rShiftTo(1,e)):(i.subTo(e,i),i.rShiftTo(1,i));return r>0&&i.lShiftTo(r,i),i}function Qt(t){if(0>=t)return 0;var e=this.DV%t,i=this.s<0?t-1:0;if(this.t>0)if(0==e)i=this[0]%t;else for(var n=this.t-1;n>=0;--n)i=(e*i+this[n])%t;return i}function Jt(t){var e=t.isEven();if(this.isEven()&&e||0==t.signum())return n.ZERO;for(var i=t.clone(),s=this.clone(),r=d(1),a=d(0),o=d(0),h=d(1);0!=i.signum();){for(;i.isEven();)i.rShiftTo(1,i),e?(r.isEven()&&a.isEven()||(r.addTo(this,r),a.subTo(t,a)),r.rShiftTo(1,r)):a.isEven()||a.subTo(t,a),a.rShiftTo(1,a);for(;s.isEven();)s.rShiftTo(1,s),e?(o.isEven()&&h.isEven()||(o.addTo(this,o),h.subTo(t,h)),o.rShiftTo(1,o)):h.isEven()||h.subTo(t,h),h.rShiftTo(1,h);i.compareTo(s)>=0?(i.subTo(s,i),e&&r.subTo(o,r),a.subTo(h,a)):(s.subTo(i,s),e&&o.subTo(r,o),h.subTo(a,h))}return 0!=s.compareTo(n.ONE)?n.ZERO:h.compareTo(t)>=0?h.subtract(t):h.signum()<0?(h.addTo(t,h),h.signum()<0?h.add(t):h):h}function $t(t){var e,i=this.abs();if(1==i.t&&i[0]<=ri[ri.length-1]){for(e=0;e<ri.length;++e)if(i[0]==ri[e])return!0;return!1}if(i.isEven())return!1;for(e=1;e<ri.length;){for(var n=ri[e],s=e+1;s<ri.length&&ai>n;)n*=ri[s++];for(n=i.modInt(n);s>e;)if(n%ri[e++]==0)return!1}return i.millerRabin(t)}function te(t){var e=this.subtract(n.ONE),i=e.getLowestSetBit();if(0>=i)return!1;var r=e.shiftRight(i);t=t+1>>1,t>ri.length&&(t=ri.length);for(var a=s(),o=0;t>o;++o){a.fromInt(ri[Math.floor(De.Util.random()*ri.length)]);var h=a.modPow(r,this);if(0!=h.compareTo(n.ONE)&&0!=h.compareTo(e)){for(var l=1;l++<i&&0!=h.compareTo(e);)if(h=h.modPowInt(2,this),0==h.compareTo(n.ONE))return!1;if(0!=h.compareTo(e))return!1}}return!0}function ee(){this.i=0,this.j=0,this.S=new Array}function ie(t){var e,i,n;for(e=0;256>e;++e)this.S[e]=e;for(i=0,e=0;256>e;++e)i=i+this.S[e]+t[e%t.length]&255,n=this.S[e],this.S[e]=this.S[i],this.S[i]=n;this.i=0,this.j=0}function ne(){var t;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,t=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=t,this.S[t+this.S[this.i]&255]}function se(){return new ee}function re(t){hi[li++]^=255&t,hi[li++]^=t>>8&255,hi[li++]^=t>>16&255,hi[li++]^=t>>24&255,li>=ci&&(li-=ci)}function ae(){re((new Date).getTime())}function oe(){if(null==oi){for(ae(),oi=se(),oi.init(hi),li=0;li<hi.length;++li)hi[li]=0;li=0}return oi.next()}function he(t){var e;for(e=0;e<t.length;++e)t[e]=oe()}function le(){}function ce(t,e){return new n(t,e)}function ue(t,e){if(e<t.length+11)return null;for(var i=new Array,s=t.length-1;s>=0&&e>0;){var r=t.charCodeAt(s--);128>r?i[--e]=r:r>127&&2048>r?(i[--e]=63&r|128,i[--e]=r>>6|192):(i[--e]=63&r|128,i[--e]=r>>6&63|128,i[--e]=r>>12|224)}i[--e]=0;for(var a=new le,o=new Array;e>2;){for(o[0]=0;0==o[0];)a.nextBytes(o);i[--e]=o[0]}return i[--e]=2,i[--e]=0,new n(i)}function de(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function fe(t,e){this.n=ce(t,16),this.e=parseInt(e,16)}function ge(t){return t.modPowInt(this.e,this.n)}function _e(t){var e=ue(t,this.n.bitLength()+7>>3);if(null==e)return null;var i=this.doPrivate(e);if(null==i)return null;var n=i.toString(16);return 0==(1&n.length)?n:"0"+n}function pe(t,e){for(var i=t.toByteArray(),n=0;n<i.length&&0==i[n];)++n;if(i.length-n!=e-1||2!=i[n])return null;for(++n;0!=i[n];)if(++n>=i.length)return null;for(var s="";++n<i.length;){var r=255&i[n];128>r?s+=String.fromCharCode(r):r>191&&224>r?(s+=String.fromCharCode((31&r)<<6|63&i[n+1]),++n):(s+=String.fromCharCode((15&r)<<12|(63&i[n+1])<<6|63&i[n+2]),n+=2)}return s}function ve(t,e,i){this.n=ce(t,16),this.e=parseInt(e,16),this.d=ce(i,16)}function me(t,e,i,n,s,r,a,o){this.n=ce(t,16),this.e=parseInt(e,16),this.d=ce(i,16),this.p=ce(n,16),this.q=ce(s,16),this.dmp1=ce(r,16),this.dmq1=ce(a,16),this.coeff=ce(o,16)}function ye(t){if(null==this.p||null==this.q)return t.modPow(this.d,this.n);for(var e=t.mod(this.p).modPow(this.dmp1,this.p),i=t.mod(this.q).modPow(this.dmq1,this.q);e.compareTo(i)<0;)e=e.add(this.p);return e.subtract(i).multiply(this.coeff).mod(this.p).multiply(this.q).add(i)}function Ae(t){var e=ce(t,16),i=this.doPublic(e);return null==i?null:pe(i,this.n.bitLength()+7>>3)}function xe(t,e,i){var n=0,s=0,r=e.split("\n"),a=2*t.measureText("e").width;return r.forEach(function(e){if(i){var r,o,h,l,c,u=e.split(" "),d=u.length,f="";for(h=0;d>h;h++)if(r=u[h]+(h===d-1?"":" "),o=f+r,l=t.measureText(o).width,i>l)f=o;else if(l==i)f="",s+=a;else{for(c=0;c<r.length;c++)if(o=f+r.substr(0,c+1),t.measureText(o).width>i){f=r.substring(c,r.length),s+=a;break}for(;f.length>0&&t.measureText(f).width>i;)for(c=0;c<f.length;c++)if(o=f.substr(0,c+1),t.measureText(o).width>i){f=f.substring(c,f.length),s+=a;break}}}else l=t.measureText(e).width,n=l>n?l:n;s+=a}),n=i?i:n,{w:n,h:s}}function we(t,e,i,n){var s,r=t.animate,a=n._now,o=n._shapeDataIndex,h=i._animates;if(h||(h=i._animates={}),o.length)for(var l=0;l<o.length;l++){s=o[l];var c=h[s];c||(c=h[s]={}),h=c}else s=o;var u=h[s];u||(u=h[s]={},r.forEach(function(s){var r,o=s.attr,h=u[o];s={attr:o,to:s.to,type:s.type||"number",delay:s.delay||0,dur:s.dur||1e3,interval:s.interval||0,finish:s.finish,repeat:s.repeat||1,reverse:null==s.reverse||s.reverse,onDone:s.onDone,easing:s.easing,trigger:null==s.to,start:a,time:0,total:0,count:0,started:!1,stopped:!1,current:null},Array.isArray(s.dur)&&(s.groupDur=s.dur.slice(0,s.dur.length-1),s.dur=s.dur[s.dur.length-1],s.groupDurTotal=s.groupDur.reduce(function(t,e,i){return s.groupDur[i]=t+e},0),s.groupIndex=0,s.groupTime=0,s.groupStart=a),null==s.finish&&(s.finish=s.delay+s.dur+s.interval),h?Array.isArray(h)?(h.push(s),h=h[h.length-2]):u[o]=[h,s]:(r=Ki(i,e,t,o,n),u[o]=s),h&&(r=h.to,"group_set"===h.type&&(r=r[r.length-1])),s.from=r,s.trigger||(s.started=!0,ke(s),Ie(s))})),r=u,Object.keys(r).forEach(function(s){var o=r[s];if(Array.isArray(o)){var h=o[o.length-1];h.count+1===h.repeat?o.forEach(function(s){be(s,t,e,i,n,!0)}):h.count+1<h.repeat&&(h.total>=h.finish&&o.forEach(function(t){t.trigger||(t.started=!0),t.stopped=!1,t.time=0,t.start=a,t.total=0,"group_set"===t.type&&(t.groupIndex=0,t.groupTime=0,t.groupStart=a)}),o.forEach(function(s){be(s,t,e,i,n,!1)}))}else be(o,t,e,i,n,!0)})}function be(t,e,i,n,s,r){if(t.trigger){var a=Ki(n,i,e,t.attr,s,null,!1);if(!t.started){if(a===t.from)return;t.started=!0,t.start=s._now,t.to=a,ke(t),Ie(t)}t.started&&a!==t.to&&(t.start=s._now,t.from=t.current,t.to=a,t.time=0,t.total=0,t.count=0,ke(t),Ie(t))}if(t.started&&!t.stopped){var o=s._now,h=o-t.start;if(h>=t.delay&&(t.total=h,h-=t.delay,t.time=h>t.dur?t.dur:h,"group_set"===t.type&&(t.groupTime=o-t.groupStart,t.groupStart===t.start&&(t.groupTime-=t.delay),t.groupTime>=t.groupDur[t.groupIndex]&&t.groupIndex++,t.groupTime>=t.groupDurTotal&&(t.groupIndex=0,t.groupTime=t.groupTime-t.groupDurTotal,t.groupStart=o)),t.total>=t.finish))if(t.count++,"group_set"===t.type,t.count>=t.repeat)t.time=t.dur,t.stopped=!0,t.trigger&&(t.from=t.to,t.to=null,t.start=null,t.time=0,t.total=0,t.count=0,t.started=!1,t.stopped=!1),t.onDone&&t.onDone.call(i,n,s);else if(r&&(t.time=0,t.start=o,t.total=0,t.reverse)){var l=t.from;t.from=t.to,t.to=l,Ie(t)}s&&!s._invalidate&&(s._invalidate=!0)}}function Se(t){if(!hn[t.id]){if(cn=!0,hn[t.id]=t,null==t.from&&t.attr&&t.source){var e;t.from=(e=t.attr.match(/^S[:@](.*)/i))?t.source.getStyle(e[1]):(e=t.attr.match(/^C[:@](.*)/i))?t.source.getClient(e[1]):De.Util.getValue(t.source,t.attr)}ke(t),Ie(t)}return t.resume(),t}function Ce(t,e){return hn[t.id]&&(null==e&&(e=!0),e&&Pe(t,t.to),t.onStop&&t.onStop(),t.time=0,t.total=0,t.start=null,t.count=0,t.started=!1,t.stopped=!1,t.paused=!1,t.pausedTime=null,t.pausedTotal=0,t._oldSpeed=null,t._speedTotal=0,t._speedTime=null,t._percent=0,t._percentSet=null,t._percentDiff=0,delete hn[t.id]),t}function Te(t){null==t&&(t=!0),Object.keys(hn).forEach(function(e){var i=hn[e];i&&(t&&Pe(i,i.to),i.onStop&&i.onStop())}),hn={}}function Ee(){Object.keys(hn).forEach(function(t){var e=hn[t];e&&e.pause()})}function Le(){Object.keys(hn).forEach(function(t){var e=hn[t];e&&e.resume()})}function Me(t){Object.keys(hn).forEach(function(e){var i=hn[e];if(i&&(null==i.start&&(i._speedTime=i.start=t),null!=i._percentSet&&(i._percentDiff+=(i._percentSet-i._percent)*i.finish),!i.paused||(i.pausedTime||(i.pausedTime=t),null!=i._percentSet))){if(null==i._percentSet&&i.pausedTime&&(i.pausedTotal+=(t-i.pausedTime)*(i._oldSpeed||i._speed),i.pausedTime=null),i._oldSpeed&&!i.pausedTime&&(i._speedTotal=(t-i._speedTime)*i._oldSpeed-i.pausedTotal+i._percentDiff+i._speedTotal,i._percentDiff=0,i.pausedTotal=0,i._speedTime=t,i._oldSpeed=null),i.total=(t-i._speedTime)*i._speed-i.pausedTotal+i._percentDiff+i._speedTotal,null!=i._percentSet&&i.pausedTime&&(i.total-=(t-i.pausedTime)*(i._oldSpeed||i._speed)),i._percent=i.total>=i.finish?1:i.total/i.finish,i.total>i.delay){i.time=i.total-i.delay;var n=!1;if(i.time>=i.dur&&(i.time=i.dur,n=!0),!i.stopped&&Pe(i,Re(i)),i.stopped=n,i.total>=i.finish)if(i.count++,i.count>=i.repeat)Ce(i,!1),i.onDone&&i.onDone();else if(i.time=0,i.total=0,i.start=null,i.stopped=!1,i.reverse){var s=i.from;i.from=i.to,i.to=s,Ie(i)}}i.paused||!cn&&(cn=!0),null!=i._percentSet&&(i._percentSet=null)}})}function Pe(t,e){if(t.started||(t.started=!0,t.onPlay&&t.onPlay()),t.filter&&(e=t.filter(e)),t.attr&&t.source){var i;(i=t.attr.match(/^S[:@](.*)/i))?t.source.setStyle(i[1],e):(i=t.attr.match(/^C[:@](.*)/i))?t.source.setClient(i[1],e):De.Util.setValue(t.source,t.attr,e)}t.onUpdate&&t.onUpdate(e)}function ke(t){var e=t.type,i=t.from,n=t.to;"number"===e?(t.from=i||0,t.to=n||0):"point"===e?(i?i.length&&(t.from={x:i[0],y:i[1]}):t.from="scale"===t.attr?{x:1,y:1}:{x:0,y:0},n?n.length&&(t.to={x:n[0],y:n[1]}):t.to="scale"===t.attr?{x:1,y:1}:{x:0,y:0}):"rect"===e?(i?i.length&&(t.from={x:i[0],y:i[1],w:i[2],h:i[3]}):t.from={x:0,y:0,w:0,h:0},n?n.length&&(t.to={x:n[0],y:n[1],w:n[2],h:n[3]}):t.to={x:0,y:0,w:0,h:0}):"color"===e&&(t.from=yn(i),t.to=yn(n)),t.current=t.from}function Ie(t){var e=t.type,i=t.from,n=t.to;"number"===e?t.delta=n-i:"point"===e?t.delta={x:n.x-i.x,y:n.y-i.y}:"rect"===e?t.delta={x:n.x-i.x,y:n.y-i.y,w:n.w-i.w,h:n.h-i.h}:"color"===e&&(t.delta={r:n.r-i.r,g:n.g-i.g,b:n.b-i.b,a:n.a-i.a})}function Re(t,e){var i=t.type,n=t.delta,s=t.from,r=t.time,a=t.dur,o=un[t.easing||"easeNone"];
return o||(o=un.easeNone),"number"===i?e=o(r,s,n,a):"point"===i?e={x:o(r,s.x,n.x,a),y:o(r,s.y,n.y,a)}:"rect"===i?e={x:o(r,s.x,n.x,a),y:o(r,s.y,n.y,a),w:o(r,s.w,n.w,a),h:o(r,s.h,n.h,a)}:"color"===i?e="rgba("+Math.floor(o(r,s.r,n.r,a))+","+Math.floor(o(r,s.g,n.g,a))+","+Math.floor(o(r,s.b,n.b,a))+","+Math.floor(o(r,s.a,n.a,a))+")":"set"===i?t.time&&(e=t.to):"group_set"===i&&(e=t.to[t.groupIndex]),t.current=e,e}var De={};De._isInitializing=!1;var Be={isDeserializing:!1,isCalculatingBus:!1,images:{},registerImage:function(t,e,i,n,s){Be.images[t]=new De.ImageAsset(t,e,i,n,s),Cn(t)},getRegisteredImageNames:function(){return Object.keys(Be.images)},unregisterImage:function(t){delete Be.images[t]},getImageAsset:function(t){if("string"==typeof t){var e=Be.images[t];return e}},showVersion:function(t){Be.isCtrlDown(t)&&t.shiftKey&&76==t.keyCode&&alert("TWaver HTML5 "+De.Util.getVersion()+"\n"+Ne)},callLater:function(t,e,i,n){return setTimeout(function(){t.apply(e,i)},n||kn.CALL_LATER_DELAY)},isEmptyObject:function(t){for(var e in t)return!1;return!0},xml:function(e){if(t.DOMParser)return(new DOMParser).parseFromString(e,"text/xml");var i=new ActiveXObject("Microsoft.XmlDOM");return i.async=!1,i.loadXml(e),i},num:function(t){return"number"==typeof t&&!isNaN(t)&&isFinite(t)},getter:function(t){var e=t.charAt(0).toUpperCase()+t.slice(1),i=/ble$/.test(t)||/ed$/.test(t)?"is":"get";return i+e},setter:function(t){var e=t.charAt(0).toUpperCase()+t.slice(1);return"set"+e},_id:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],id:function(){for(var t=[],e=0;32>e;e++)t[e]=this._id[Math.floor(16*De.Util.random())];return t[12]="4",t[16]=this._id[3&t[16]|8],t.join("")},keys:function(t){var e=new gn;for(var i in t)e.add(i);return e},es:["toString","toLocaleString","valueOf"],ip:function(t,e){var i="_"+e;t[Be.getter(e)]=function(){return this[i]},t[Be.setter(e)]=function(t){var n=this[i];this[i]=t,this.firePropertyChange(e,n,t)}},validateLicense:function(t){Ne=t,fi()},ibool:function(t,e){var i="_"+e,n=e.charAt(0).toUpperCase()+e.slice(1);t["is"+n]=function(){return this[i]},t[Be.setter(e)]=function(t){var n=this[i];this[i]=t,this.firePropertyChange(e,n,t)}},getValue:function(t,e,i){var n=e.charAt(0).toUpperCase()+e.slice(1),s="get"+n,r="is"+n;return i?"boolean"===i?t[r]():t[s]():t[s]?t[s]():t[r]?t[r]():t[e]},setValue:function(t,e,i){t["set"+e.charAt(0).toUpperCase()+e.slice(1)](i)},clone:function(t){if(!t)return null;var e={};for(var i in t)e[i]=t[i];return e},cloneRect:function(t){return t?{x:t.x,y:t.y,width:t.width,height:t.height}:null},classCache:{},getClass:function(e){var i=Be.classCache[e];if(!i){var n=e.split("."),s=n.length;i=t;for(var r=0;s>r;r++)i=i[n[r]],i||"twaver"===n[r]&&(i=De);Be.classCache[e]=i}return i},newInstance:function(e){var i=Be.getClass(e)||t[e];if(!i)return null;var n=arguments.length,s=arguments;if(1===n)return new i;if(2===n)return new i(s[1]);if(3===n)return new i(s[1],s[2]);if(4===n)return new i(s[1],s[2],s[3]);if(5===n)return new i(s[1],s[2],s[3],s[4]);if(6===n)return new i(s[1],s[2],s[3],s[4],s[5]);if(7===n)return new i(s[1],s[2],s[3],s[4],s[5],s[6]);if(8===n)return new i(s[1],s[2],s[3],s[4],s[5],s[6],s[7]);throw"don't support args more than 7"},addMethod:function(t,e){var i=t.prototype;for(var n in e)i[n]=e[n]},ext:function(t,e,i){var n;if("string"==typeof t&&(n=t,t=Be.getClass(t)),e){var s=function(){};s.prototype=e.prototype,t.prototype=new s,t.prototype.constructor=t,t.superClass=e.prototype,e.prototype.constructor==Object.prototype.constructor&&(e.prototype.constructor=e)}if(n&&(t.prototype.getClassName=function(){return n}),i){var r=t.prototype;for(var a in i)We.ext(a,r,i);for(var o=Be.es.length,h=0;o>h;h++)a=Be.es[h],i.hasOwnProperty(a)&&!i.propertyIsEnumerable(a)&&(r[a]=i[a])}},setViewBounds:function(t,e){if(t)if(t.adjustBounds)t.adjustBounds(e);else{var i=t.style;!i&&t.getView()&&(i=t.getView().style),i&&(i.position="absolute",i.left=e.x+"px",i.top=e.y+"px",i.width=e.width+"px",i.height=e.height+"px")}},getImageSrc:function(t){var e=Be.getImageAsset(t);return e?e.getSrc()?e.getSrc():e.getImage().getAttribute("src"):t},nextColorCount:0,nextColor:function(){return Be.nextColorCount>=kn.COLORS.length&&(Be.nextColorCount=0),kn.COLORS[Be.nextColorCount++]},isCtrlDown:function(t){return t.ctrlKey||t.metaKey},isShiftDown:function(t){return t.shiftKey},isAltDown:function(t){return t.altKey},setText:function(t,e,i){i?He.isFirefox?t.textContent=e:t.innerText=e:t.innerHTML=e},fillDescendant:function(t,e){e.add(t),t.hasChildren()&&t.getChildren().forEach(function(t){Be.fillDescendant(t,e)})}},Ne=(Date,"l=1.0\ntype=1\ngis=1\n3d=0\nstart=2015-10-21\nend=2016-10-31\nnote=This license applies to the evaluation version of TWaver. The License is limited to noncommercial use. Noncommercial use relates only to educational, research, personal or evaluation purposes. Any other use is commercial use. You may not use the Software in connection with any business activities.And You are not permitted to modify the software or attempt to decipher, decompile, disassemble or reverse engineer this Software.\nsignature=2e5ea3fc421c82faefdd5adb7f4cc1292bb315bf7a6ae5f14eaf81bf518344eb30899e3f2e8d1905d281d303ccf9f944ed98ee268cb7052503c879d9bc2479b2285d51fca10e872a7971c3f17b8494b31ef2e7b0988f6ff5c57d5a869f3af37d994321a3dcad3eba0adc0d83c84f50e9d71022bafaffb04a645aa1de657bb8ba49ae0ecb2f9838aaa9d601cdcc49e3ed7770fa84e0cd341dfdad6895ed1535c920f96075a6df4b045500f7d9ea7dfd85ad6c7ef697818090543728102de1c1151a8def3f01b092df43ec585d98f98f26731caf61b294b80e8fb5723b52fbd1301b34036a1a6e2b42bb5a30fe4fc51f569f4544443dd6cbe6ee5983f96cc71038688b4e38630ea6b93e45f6316560da5f6cd77c425eb90b3efb31b2f2ff23856da7d44b52b24c91de9a45064acba360cb3eeb6174a9b1fc4482cf77985e49a336029c2ed2b70d4336b71afca09cb3a086859c708f42680d5431f8ad1230b93b6b343c6237337c62af3242da3cc635a0ca623f822f2a2044e9e6c4598b2761ecc44348e47ec8d989e74526cf7fc34fb229621d761f708a32387c8a4e3f4a1b049be86dd7546559b7bfaa4da0fcd7b6f414bbdbcf8a80b8ef0f7947ae150a0a5027fd33b79ab5f85bfb7760ea6fb79da60d1f12386826f363a6e8b63d0fb3f6319c2f74314fc75a2de2156052418c8581a3565f645ccdf2e0429a9f7e413cd917c1250483f72408d6ccfff0e418bd280696d34358d30236319fda6e1802ad00f015978f4a2db435feb68b8875f962fe9518de30fd841b9dd5f5c394cd5705268e7748f1874880ea25f05b667b3e390b251cd7a1ae9a2ed33963b6088cd771d7be3d1daacf4b6c2a1ba5f822d4319c652e9f29c01a9ef9f76f9811fe258daf3feb5e");t.twaver=De,t._twaver=Be,De.animate={},De.network={},De.network.interaction={},De.controls={},De.charts={},De.layout={};var ze,Oe,Fe=t.navigator,Ve=t.document,Ue=t.Image;t.document||(Oe=!0,ze=require("canvas"),Ue=ze.Image,Fe={userAgent:""},Ve={});var He=function(){var t={},e=Fe.userAgent.toLowerCase();return t.isOpera=/opera/.test(e),t.isIE=/msie/.test(e)||/trident/.test(e)||/edge/.test(e),t.isFirefox=/firefox/i.test(e),t.isChrome=/chrome/i.test(e),t.isSafari=!t.isChrome&&/safari/i.test(e),t.isIPhone=/iphone/.test(e),t.isIPod=/ipod/.test(e),t.isIPad=/ipad/.test(e),t.isAndroid=/android/i.test(e),t.isWebOS=/webos/i.test(e),t.isMSTouchable=t.isIE&&(Fe.msMaxTouchPoints&&Fe.msMaxTouchPoints>1||Fe.maxTouchPoints&&Fe.maxTouchPoints>1),t.isTouchable="ontouchend"in Ve||t.isMSTouchable,t}();Be.ua=He;var We={__accessor:function(t,e){for(var i=e.__accessor,n=i.length,s=0;n>s;s++)Be.ip(t,i[s])},__bool:function(t,e){for(var i=e.__bool,n=i.length,s=0;n>s;s++)Be.ibool(t,i[s])},__client:function(t,e){t.getClient=function(t){return this._clientMap[t]},t.setClient=function(t,e){var i=this._clientMap[t];return null==e?delete this._clientMap[t]:this._clientMap[t]=e,this.firePropertyChange("C:"+t,i,e)&&this.onClientChanged(t,i,e),this},t.getClientProperties=function(){return Be.keys(this._clientMap)},t.getClientMap=function(){return this._clientMap},t.onClientChanged=function(t,e,i){}},__style:function(t,i){t.getStyle=function(t,i){var n=this._styleMap[t];return i===e&&(i=!0),null==n&&i?De.Styles.getStyle(t):n},t.setStyle=function(t,e){var i=this._styleMap[t];return null==e?delete this._styleMap[t]:this._styleMap[t]=e,this.firePropertyChange("S:"+t,i,e)&&this.onStyleChanged(t,i,e),this},t.getStyleProperties=function(){return Be.keys(this._styleMap)},t.onStyleChanged=function(t,e,i){}},__new:function(t,e){t.newInstance=function(){var t=Be.getClass(this.getClassName());if(!t)return null;var e=arguments.length,i=arguments;if(0===e)return new t;if(1===e)return new t(i[0]);if(2===e)return new t(i[0],i[1]);if(3===e)return new t(i[0],i[1],i[2]);if(4===e)return new t(i[0],i[1],i[2],i[3]);if(5===e)return new t(i[0],i[1],i[2],i[3],i[4]);if(6===e)return new t(i[0],i[1],i[2],i[3],i[4],i[5]);if(7===e)return new t(i[0],i[1],i[2],i[3],i[4],i[5],i[6]);throw"don't support args more than 7"}},__property:function(t,e){t.getValue=function(t,e){return"accessor"===this._propertyType?Be.getValue(t,this._propertyName):"style"===this._propertyType&&t.getStyle?t.getStyle(this._propertyName):"client"===this._propertyType&&t.getClient?t.getClient(this._propertyName):"field"===this._propertyType?t[this._propertyName]:null},t.setValue=function(t,e,i){if("accessor"===this._propertyType)t[Be.setter(this._propertyName)](e);else{if("style"===this._propertyType&&t.setStyle)return t.setStyle(this._propertyName,e);if("client"===this._propertyType&&t.setClient)return t.setClient(this._propertyName,e);"field"===this._propertyType&&(t[this._propertyName]=e)}}},map:{__accessor:1,__bool:1,__client:1,__style:1,__new:1,__tree:1,__property:1},ext:function(t,e,i){1===We.map[t]?We[t](e,i):e[t]=i[t]}};Be.extend=We;var Xe=Be.Matrix=function(t,e,i,n,s,r){this.setMatrix(t,e,i,n,s,r)};Xe.identity=function(){return new Xe(1,0,0,1,0,0)},Xe.prototype.setMatrix=function(t,e,i,n,s,r){this._m11=t,this._m12=e,this._m21=i,this._m22=n,this._offsetX=s,this._offsetY=r,this._type=0,0!=this._m21||0!=this._m12?this._type=4:((1!=this._m11||1!=this._m22)&&(this._type=2),(0!=this._offsetX||0!=this._offsetY)&&(this._type|=1),0==(3&this._type)&&(this._type=0))},Xe.prototype.transform=function(){var t;if(t=2===arguments.length?{x:arguments[0],y:arguments[1]}:arguments[0],!t||!Be.num(t.x)||!Be.num(t.y))throw"arguments should contain x, y";switch(this._type){case 0:return{x:t.x,y:t.y};case 1:return{x:this._offsetX+t.x,y:this._offsetY+t.y};case 2:return{x:t.x*this._m11,y:t.y*this._m22};case 3:return{x:t.x*this._m11+this._offsetX,y:t.y*this._m22+this._offsetY}}return{x:this._m11*t.x+t.y*this._m21+this._offsetX,y:this._m22*t.y+t.x*this._m12+this._offsetY}},Xe.prototype.translate=function(t,e){this.multiply(new Xe(1,0,0,1,t,e))},Xe.prototype.scale=function(t,e){this.multiply(new Xe(t,0,0,e,0,0))},Xe.prototype.rotate=function(t,e,i){t=t*Math.PI/180;var n=Math.sin(t),s=Math.cos(t),r=e*(1-s)+i*n,a=i*(1-s)-e*n;this.multiply(new Xe(s,n,(-n),s,r,a))},Xe.prototype.skew=function(t,e){this.multiply(new Xe(1,Math.tan(e*Math.PI/180),Math.tan(t*Math.PI/180),1,0,0))},Xe.prototype.multiply=function(t){var e=this,i=t,n=e._type,s=i._type;if(0!=s)if(0==n)e.setMatrix(i._m11,i._m12,i._m21,i._m22,i._offsetX,i._offsetY);else if(1==s)e._offsetX+=i._offsetX,e._offsetY+=i._offsetY,4!=n&&(e._type|=1);else if(1==n){var r=e._offsetX,a=e._offsetY;e.setMatrix(i._m11,i._m12,i._m21,i._m22,i._offsetX,i._offsetY),e._offsetX=r*i._m11+a*i._m21+i._offsetX,e._offsetY=r*i._m12+a*i._m22+i._offsetY,e._type=4==s?4:3}else switch(n<<4|s){case 34:return e._m11*=i._m11,void(e._m22*=i._m22);case 35:return e._m11*=i._m11,e._m22*=i._m22,e._offsetX=i._offsetX,e._offsetY=i._offsetY,void(e._type=3);case 36:case 52:case 66:case 67:case 68:return void e.setMatrix(e._m11*i._m11+e._m12*i._m21,e._m11*i._m12+e._m12*i._m22,e._m21*i._m11+e._m22*i._m21,e._m21*i._m12+e._m22*i._m22,e._offsetX*i._m11+e._offsetY*i._m21+i._offsetX,e._offsetX*i._m12+e._offsetY*i._m22+i._offsetY);case 50:return e._m11*=i._m11,e._m22*=i._m22,e._offsetX*=i._m11,void(e._offsetY*=i._m22);case 51:return e._m11*=i._m11,e._m22*=i._m22,e._offsetX=i._m11*e._offsetX+i._offsetX,void(e._offsetY=i._m22*e._offsetY+i._offsetY);default:console.log("Matrix multiply hit an invalid case: "+combinedType)}};var Ge={getDistance:function(t,e){var i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)},getCenterPoint:function(t,e){return t&&e?{x:(t.x+e.x)/2,y:(t.y+e.y)/2}:null==e&&t.width?{x:t.x+t.width/2,y:t.y+t.height/2}:void 0},isPointInPolygon:function(t,e){t=t._as?t._as:t;var i=0,n=0,s=!1,r=t.length;for(i=0,n=r-1;r>i;n=i++){var a=t[i],o=t[n];a.y>e.y!=o.y>e.y&&e.x<(o.x-a.x)*(e.y-a.y)/(o.y-a.y)+a.x&&(s=!s)}return s},unionRect:function(t,e){if(t&&!e)return Be.cloneRect(t);if(!t&&e)return Be.cloneRect(e);if(t&&e){var i={};return i.x=Math.min(t.x,e.x),i.y=Math.min(t.y,e.y),i.width=Math.max(t.x+t.width,e.x+e.width)-i.x,i.height=Math.max(t.y+t.height,e.y+e.height)-i.y,i}return null},intersects:function(t,e){if(!t||!e)return!1;var i=e.width,n=e.height,s=t.width,r=t.height;if(0>=s||0>=r||0>=i||0>=n)return!1;var a=e.x,o=e.y,h=t.x,l=t.y;return s+=h,r+=l,i+=a,n+=o,(h>s||s>a)&&(l>r||r>o)&&(a>i||i>h)&&(o>n||n>l)},intersection:function(t,e){if(!t||!e)return!1;var i=e.x,n=e.y,s=t.x,r=t.y,a=i;a+=e.width;var o=n;o+=e.height;var h=s;h+=t.width;var l=r;return l+=t.height,s>i&&(i=s),r>n&&(n=r),a>h&&(a=h),o>l&&(o=l),a-=i,o-=n,0===a||0===o?null:{x:i,y:n,width:a,height:o}},contains:function(t,e){var i=e.x,n=e.y,s=e.width,r=e.height,a=t.width,o=t.height;if(0>(a|o|s|r))return!1;var h=t.x,l=t.y;if(h>i||l>n)return!1;if(a+=h,s+=i,i>=s){if(a>=h||s>a)return!1}else if(a>=h&&s>a)return!1;if(o+=l,r+=n,n>=r){if(o>=l||r>o)return!1}else if(o>=l&&r>o)return!1;return!0},getLinePoints:function(t){if(!t)return null;var e=new gn;return t.forEach(function(t){e.addAll(t)}),e},getLineRect:function(t){var e=Ge.getLinePoints(t);return Ge.getRect(e)},getRect:function(t,e){if(!t)return null;t._as&&(t=t._as);var i=t.length;if(0>=i)return null;var n=t[0];e=e||{x:null,y:null,width:0,height:0};for(var s=0;i>s;s++)if(n=t[s],n instanceof gn)Ge.getRect(n,e);else{null==e.x&&(e.x=n.x,e.y=n.y);var r=Math.min(e.x,n.x),a=Math.min(e.y,n.y),o=Math.max(e.x+e.width,n.x),h=Math.max(e.y+e.height,n.y);e.x=r,e.y=a,e.width=o-r,e.height=h-a}return e},addPadding:function(t,e,i,n){n=n||-1;var s=e.getStyle(i)*n;0!=s&&Ge.grow(t,s,s),s=e.getStyle(i+".left")*n,0!=s&&(t.x-=s,t.width+=s),s=e.getStyle(i+".right")*n,0!=s&&(t.width+=s),s=e.getStyle(i+".top")*n,0!=s&&(t.y-=s,t.height+=s),s=e.getStyle(i+".bottom")*n,0!=s&&(t.height+=s),t.width<0&&(t.width=-t.width,t.x-=t.width),t.height<0&&(t.height=-t.height,t.y-=t.height)},grow:function(t,e,i){if(null==t)return null;null==i&&(i=e);var n=t.width+e+e;if(!(0>n)){var s=t.height+i+i;if(!(0>s))return t.x-=e,t.y-=i,t.width=n,t.height=s,t}},containsPoint:function(t,e,i){return arguments.length<3&&(i=e.y,e=e.x),!(!t||e<t.x||i<t.y||e>t.x+t.width||i>t.y+t.height)},getHotSpot:function(t,e,i,n,s){if("oval"===s){var r=.35;return{x:t+.5*i+i*r,y:e+n/2-Math.sqrt(.25-r*r)*n}}if("circle"===s){var a=t+i/2,o=e+n/2,h=Math.min(i,n)/2;t=a-h,e=o-h,i=2*h,n=2*h;var l=i/2,c=n/2,u=l*c/Math.sqrt(l*l+c*c);return{x:t+i/2+u,y:e+n/2-u}}var d={x:t+i,y:e};return i>3&&(d.x-=3),n>3&&(d.y+=3),d},getCircleRect:function(t){var e=Math.min(t.width,t.height)/2;return{x:t.x+t.width/2-e,y:t.y+t.height/2-e,width:2*e,height:2*e}},getEllipsePoint:function(t,e){if(!t||!e)return null;var i=t.x+t.width/2,n=t.y+t.height/2,s=e.x-i,r=e.y-n,a=t.width/2,o=t.height/2,h=Math.sqrt(1/(1/a/a+r*r/s/s/o/o));0>s&&(h=-h);var l;return l=0==s?r>0?o:-o:h*r/s,{x:i+h,y:n+l}},createMatrix:function(t,e,i){var n=Math.sin(t),s=Math.cos(t),r=e*(1-s)+i*n,a=i*(1-s)-e*n;return new Xe(s,n,(-n),s,r,a)},calculatePointInfoAlongLineBySegments:function(t,e,i,n,s){return Ge.calculatePointInfoAlongLine(Ge.getPointObject(t,e),i,n,s)},calculatePointInfoAlongLine:function(t,i,n,s){if(i=i===e||i,n=n||0,s=s||0,!t||t.size()<2)throw"must more than two points";if(!i){var r=Ge.reversePath(t);return Ge.calculatePointInfoAlongLine(r,!0,n,s)}t._as&&(t=t._as);var a,o,h,l,c,u=0,d=0,f=t.length;for(l=0;f>l;l++)if(c=t[l],0!=l){if(0>=n){h=Ge.calculatePointInfoOnStraightLine(Ge._getPoint(o),Ge._getControlPoint(c),n,s),a=h;break}if(d=Ge._getLength(c,o),u+d>n){h=Ge.getPathInfo(c,o,n-u,s,d),a=h;break}u+=d,o=c}else o=c;if(null==a){var g,_;o=t[f-1],_=Ge._getPoint(o),o instanceof gn&&(o=o._as),g=o instanceof Array?Ge._getControlPoint(o):Ge._getPoint(t[f-2]);var p=Math.atan2(_.y-g.y,_.x-g.x);h=Ge.transformPoint(_,p,n-u,s),h.angle=p,a=h}return a},reversePath:function(t){var e,i=new gn,n=null;t._as&&(t=t._as);for(var s=t.length-1;s>=0;s--)e=t[s],i.add(Ge._getReversePath(e,n)),n=e;return i},_getPoint:function(t){return t._as&&(t=t._as),t instanceof Array?t[t.length-1]:t},_getControlPoint:function(t){return t._as&&(t=t._as),t instanceof Array?t[t.length-2]:t},_getReversePath:function(t,e){var i=Ge._getPoint(t);return e&&e._as&&(e=e._as),null!=e&&e instanceof Array?new gn(2==e.length?[e[0],i]:[e[1],e[0],i]):i},_getLength:function(t,e){var i=Ge._getPoint(e),n=Ge._getPoint(t);if(t instanceof gn&&(t=t._as),t instanceof Array)return Ge.calculateCurveLength(i,t,1);var s=n.y-i.y,r=n.x-i.x;return Math.sqrt(r*r+s*s)},getPathInfo:function(t,e,i,n,s){var r,a=Ge._getPoint(e),o=Ge._getPoint(t);if(t instanceof gn&&(t=t._as),t instanceof Array){0>s&&(s=Ge._getLength(t,e));var h=i/s,l=Ge.calculatePointInfoOnCurveLine(a,t,h);a=l.point,r=l.angle,i=0}else r=Math.atan2(o.y-a.y,o.x-a.x);return Ge.transformPoint(a,r,i,n)},transformPoint:function(t,e,i,n){var s={x:i,y:n},r=Ge.createMatrix(e,0,0);return s=r.transform(s),s.x+=t.x,s.y+=t.y,{point:s,angle:e}},calculatePointInfoOnStraightLine:function(t,e,i,n){var s=Math.atan2(e.y-t.y,e.x-t.x);return Ge.transformPoint(t,s,i,n)},calculatePointInfoOnCurveLine:function(t,e,i){if(0>i||i>1)throw"Illegal arguments";return e._as&&(e=e._as),2==e.length?Ge._calculatePointInfoOnCurveLine2(t,e[0],e[1],i):Ge._calculatePointInfoOnCurveLine3(t,e[0],e[1],e[2],i)},_calculatePointInfoOnCurveLine2:function(t,e,i,n){var s=2*(t.x+i.x-2*e.x)*n+2*e.x-2*t.x,r=2*(t.y+i.y-2*e.y)*n+2*e.y-2*t.y,a=Math.atan2(r,s),o=(t.x+i.x-2*e.x)*n*n+(2*e.x-2*t.x)*n+t.x,h=(t.y+i.y-2*e.y)*n*n+(2*e.y-2*t.y)*n+t.y;return{point:{x:o,y:h},angle:a}},_calculatePointInfoOnCurveLine3:function(t,e,i,n,s){var r,a,o;r=1-s,a=r*r*r,o=s*s*s;var h=a*t.x+3*s*r*r*e.x+3*s*s*r*i.x+o*n.x,l=a*t.y+3*s*r*r*e.y+3*s*s*r*i.y+o*n.y;return{point:{x:h,y:l},angle:Math.atan2(Ge._bezeSpeedY(t,e,i,n,s),Ge._bezeSpeedX(t,e,i,n,s))}},calculateCurveLength:function(t,e,i){return e._as&&(e=e._as),2==e.length?Ge._calculateCurveLength(t,e[0],e[1],i):Ge._calculateBezierCurveLength(t,e[0],e[1],e[2],i)},_calculateCurveLength:function(t,e,i,n){if(0>=n||n>1)return 0;var s=Math.floor(n*(Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))+Math.sqrt((i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y)))/2),r=0;0>=s&&(s=1);for(var a,o,h=n/s,l=0,c=0;s>c;c++)l=h*c,a=2*(t.x+i.x-2*e.x)*l+2*e.x-2*t.x,o=2*(t.y+i.y-2*e.y)*l+2*e.y-2*t.y,a*=h,o*=h,r+=Math.sqrt(a*a+o*o);return r},_calculateBezierCurveLength:function(t,e,i,n,s){if(0>=s||s>1)return 0;var r=1e4,a=Math.floor(r*s);if(1==(1&a)&&a++,0==a)return 0;var o,h=Math.floor(a/2),l=0,c=0,u=s/a;for(o=0;h>o;o++)l+=Ge._bezeSpeed(t,e,i,n,(2*o+1)*u);for(o=1;h>o;o++)c+=Ge._bezeSpeed(t,e,i,n,2*o*u);return(Ge._bezeSpeed(t,e,i,n,0)+Ge._bezeSpeed(t,e,i,n,1)+2*c+4*l)*u/3},_bezeSpeedX:function(t,e,i,n,s){var r=1-s;return-3*t.x*r*r+3*e.x*r*r-6*e.x*r*s+6*i.x*r*s-3*i.x*s*s+3*n.x*s*s},_bezeSpeedY:function(t,e,i,n,s){var r=1-s;return-3*t.y*r*r+3*e.y*r*r-6*e.y*r*s+6*i.y*r*s-3*i.y*s*s+3*n.y*s*s},_bezeSpeed:function(t,e,i,n,s){var r=Ge._bezeSpeedX(t,e,i,n,s),a=Ge._bezeSpeedY(t,e,i,n,s);return Math.sqrt(r*r+a*a)},getPointObject:function(t,e){if(e&&0!=e.size()){var i=new gn;e=e._as,t=t._as;var n,s,r=0,a=e.length,o=t.length;for(n=0;a>n&&(s=e[n],r!=o);n++)"cubicto"===s?o-2>r&&i.add([t[r++],t[r++],t[r++]]):"quadto"===s?o-1>r&&i.add([t[r++],t[r++]]):o>r&&i.add(t[r++]);for(;o>r;r++)i.add(t[r]);return i}return t},calculateLineLength:function(t,e){if(!t||t.size()<2)return 0;if(e)return Ge.calculateLineLength(Ge.getPointObject(t,e));t=t._as;var i,n,s,r,a,o,h,l=t.length,c=0;for(i=0;l>i;i++)r=t[i],0!=i?(s=r,s instanceof gn&&(s=s._as),s instanceof Array?(a=Ge.calculateCurveLength(n,s,1),n=s[s.length-1]):(h=r.y-n.y,o=r.x-n.x,a=Math.sqrt(o*o+h*h),n=s),c+=a):n=r;return c},toDegrees:function(t){return 180*t/Math.PI},toRadians:function(t){return t/180*Math.PI},getRadiansBetweenLines:function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},getAngle:function(t,e){return t.x===e.x?e.y===t.y?0:e.y>t.y?Math.PI/2:-Math.PI/2:Math.atan((e.y-t.y)/(e.x-t.x))}};Be.math=Ge;var Ze={getPoints:function(t){var e=new gn;return t.forEach(function(t){e.add({x:t.x,y:t.y}),e.add({x:t.x+t.width,y:t.y+t.height}),e.add({x:t.x+t.width,y:t.y}),e.add({x:t.x,y:t.y+t.height})}),e},rectangle:function(t){var e;return t.forEach(function(t){e=Ge.unionRect(e,t)}),e},oval:function(t){var e=Ze.rectangle(t),i=0,n=e.height/e.width,s=n*n,r=e.x+e.width/2,a=e.y+e.height/2,o=Ze.getPoints(t);o.forEach(function(t){var e=t.x-r,n=t.y-a,o=e*e+n*n/s;o>i&&(i=o)}),i=Math.sqrt(i);var h=n*i;return{x:r-i,y:a-h,width:2*i,height:2*h}},circle:function(t){var e=Ze.rectangle(t),i=0,n=e.x+e.width/2,s=e.y+e.height/2,r=Ze.getPoints(t);return r.forEach(function(t){var e=t.x-n,r=t.y-s,a=e*e+r*r;a>i&&(i=a)}),i=Math.sqrt(i),{x:n-i,y:s-i,width:2*i,height:2*i}},roundrect:function(t){var e=Ze.rectangle(t),i=Math.min(e.width,e.height)/16;return Ge.grow(e,i,i),e},star:function(t){var e=Ze.rectangle(t);return Ge.grow(e,e.width,e.height),e},triangle:function(t){var e=Ze.rectangle(t);return e.x-=e.width/2,e.width*=2,e.y-=e.height,e.height*=2,e},hexagon:function(t){var e=Ze.rectangle(t);return e.x-=e.width/2,e.width*=2,e},pentagon:function(t){var e=Ze.rectangle(t);return e.x-=e.width/6,e.width+=e.width/3,e.y-=e.height/4,e.height+=e.height/4,e},diamond:function(t){var e=Ze.rectangle(t);return e.x-=e.width/2,e.width+=e.width,e.y-=e.height/2,e.height+=e.height,e},trapezoidal:function(t){var e=Ze.rectangle(t);return e.x-=e.width/2,e.width+=e.width,e.y-=e.height/2,e.height+=e.height,e}};Be.group=Ze;var Ye={"topleft.topleft":function(t,e){return{x:t.x-e.width,y:t.y-e.height}},"topleft.topright":function(t,e){return{x:t.x,y:t.y-e.height}},"top.top":function(t,e){return{x:t.x+t.width/2-e.width/2,y:t.y-e.height}},"topright.topleft":function(t,e){return{x:t.x+t.width-e.width,y:t.y-e.height}},"topright.topright":function(t,e){return{x:t.x+t.width,y:t.y-e.height}},topleft:function(t,e){return{x:t.x-e.width/2,y:t.y-e.height/2}},top:function(t,e){return{x:t.x-e.width/2+t.width/2,y:t.y-e.height/2}},topright:function(t,e){return{x:t.x-e.width/2+t.width,y:t.y-e.height/2}},"topleft.bottomleft":function(t,e){return{x:t.x-e.width,y:t.y}},"topleft.bottomright":function(t,e){return{x:t.x,y:t.y}},"top.bottom":function(t,e){return{x:t.x+t.width/2-e.width/2,y:t.y}},"topright.bottomleft":function(t,e){return{x:t.x-e.width+t.width,y:t.y}},"topright.bottomright":function(t,e){return{x:t.x+t.width,y:t.y}},"left.left":function(t,e){return{x:t.x-e.width,y:t.y+t.height/2-e.height/2}},left:function(t,e){return{x:t.x-e.width/2,y:t.y+t.height/2-e.height/2}},"left.right":function(t,e){return{x:t.x,y:t.y+t.height/2-e.height/2}},center:function(t,e){return{x:t.x+t.width/2-e.width/2,y:t.y+t.height/2-e.height/2}},"right.left":function(t,e){return{x:t.x+t.width-e.width,y:t.y+t.height/2-e.height/2}},right:function(t,e){return{x:t.x+t.width-e.width/2,y:t.y+t.height/2-e.height/2}},"right.right":function(t,e){return{x:t.x+t.width,y:t.y+t.height/2-e.height/2}},"bottomleft.topleft":function(t,e){return{x:t.x-e.width,y:t.y+t.height-e.height}},"bottomleft.topright":function(t,e){return{x:t.x,y:t.y+t.height-e.height}},"bottom.top":function(t,e){return{x:t.x+t.width/2-e.width/2,y:t.y+t.height-e.height}},"bottomright.topleft":function(t,e){return{x:t.x+t.width-e.width,y:t.y+t.height-e.height}},"bottomright.topright":function(t,e){return{x:t.x+t.width,y:t.y+t.height-e.height}},bottomleft:function(t,e){return{x:t.x-e.width/2,y:t.y+t.height-e.height/2}},bottom:function(t,e){return{x:t.x+t.width/2-e.width/2,y:t.y+t.height-e.height/2}},bottomright:function(t,e){return{x:t.x+t.width-e.width/2,y:t.y+t.height-e.height/2}},"bottomleft.bottomleft":function(t,e){return{x:t.x-e.width,y:t.y+t.height}},"bottomleft.bottomright":function(t,e){return{x:t.x,y:t.y+t.height}},"bottom.bottom":function(t,e){return{x:t.x+t.width/2-e.width/2,y:t.y+t.height}},"bottomright.bottomleft":function(t,e){return{x:t.x+t.width-e.width,y:t.y+t.height}},"bottomright.bottomright":function(t,e){return{x:t.x+t.width,y:t.y+t.height}},get:function(t,e,i){if(!e)throw"refRect can not be null";i||(i={width:0,height:0});var n=Ye[t];if(n)return n(e,i);throw"Can not resolve '"+t+"' position"}};Be.position=Ye;var je={preventDefault:function(t){kn.KEEP_DEFAULT_FUNCTION(t)||(t.preventDefault?t.preventDefault():t.preventManipulation?t.preventManipulation():t.returnValue=!1)},insertAfter:function(t,e){return e?e.parentNode.insertBefore(t,e.nextSibling):t.parentNode.insertBefore(t,t.parentNode.firstChild),t},forEach:function(t,e,i){if(je.isVisible(t)){for(var n=t.childNodes.length,s=0;n>s;s++)je.forEach(t.childNodes[s],e,i);i?e.call(i,t):e(t)}},setVisible:function(t,e){t.style.display=e?"block":"none"},isVisible:function(t){return"style"in t&&"none"!==t.style.display},release:function(t){for(var e=t.childNodes.length,i=0;e>i;i++)je.release(t.childNodes[i]);e>0&&je.clear(t),t._pool&&t._pool.release(t)},clear:function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},setZoom:function(t,e){var i=t.style;if(i.setProperty)if(He.isFirefox)i.setProperty("-moz-transform","scale("+e+")",null),i.setProperty("-moz-transform-origin","0 0",null);else if(He.isOpera)i.setProperty("-o-transform","scale("+e+")",null),i.setProperty("-o-transform-origin","0 0",null);else if(He.isChrome||He.isSafari){i.setProperty("-webkit-transform","scale("+e+")",null),i.setProperty("-webkit-transform-origin","0 0",null);var n=null;t._webkitInvaildateDiv?n=t._webkitInvaildateDiv:(n=Ve.createElement("div"),t._webkitInvaildateDiv=n),n.parentNode&&n.parentNode==t?t.removeChild(n):t.appendChild(n)}else He.isIE?(i.setProperty("-ms-transform","scale("+e+")",null),i.setProperty("-ms-transform-origin","0 0",null)):(i.setProperty("transform","scale("+e+")",null),i.setProperty("transform-origin","0 0",null))},setRotate:function(t,e){var i=t.style;if(i.setProperty)if(He.isFirefox)i.setProperty("-moz-transform","scale("+e+")",null),i.setProperty("-moz-transform-origin","0 0",null);else if(He.isOpera)i.setProperty("-o-transform","scale("+e+")",null),i.setProperty("-o-transform-origin","0 0",null);else if(He.isChrome||He.isSafari){i.setProperty("-webkit-transform","scale("+e+")",null),i.setProperty("-webkit-transform-origin","0 0",null);var n=null;t._webkitInvaildateDiv?n=t._webkitInvaildateDiv:(n=Ve.createElement("div"),t._webkitInvaildateDiv=n),n.parentNode&&n.parentNode==t?t.removeChild(n):t.appendChild(n)}else He.isIE?(i.setProperty("-ms-transform","scale("+e+")",null),i.setProperty("-ms-transform-origin","0 0",null)):(i.setProperty("transform","scale("+e+")",null),i.setProperty("transform-origin","0 0",null))},setCSSStyle:function(t,e,i){t.style.setProperty(e,i,null)},removeCSSStyle:function(t,e){t.style.removeProperty(e)},getCSSStyle:function(t,e){return t.style.getPropertyValue(e)},setBorderRaidus:function(t,e){He.isFirefox?t.style.MozBorderRadius=e:t.style.borderRadius=e},createSelect:function(t,e){var i,n,s,r=Ve.createElement("select");if(Array.isArray(t))for(i=0;i<t.length;i++)n=t[i],s=Ve.createElement("option"),s.innerHTML=n,s.setAttribute("value",n),n===e&&s.setAttribute("selected","true"),r.appendChild(s);else for(i=0;i<t.values.length;i++)n=t.values[i],s=Ve.createElement("option"),s.innerHTML=t.map[n],s.setAttribute("value",n),n===e&&s.setAttribute("selected","true"),r.appendChild(s);return r},createImg:function(t){var e=Ve.createElement("img");return e.style.position="absolute","string"==typeof t&&e.setAttribute("src",t),e},createView:function(t,e){var i=Ve.createElement("div");return i.style.position=kn.VIEW_POSITION,i.style.fontSize=kn.VIEW_FONT_SIZE,i.style.fontFamily=kn.VIEW_FONT_FAMILY,i.style.cursor="default",i.style.outline="none",i.style.textAlign="left",i.style.msTouchAction="none",i.style.touchAction="none",i.tabIndex=0,e||(i.onmousedown=je.preventDefault),i.style.setProperty&&(i.style.setProperty("-khtml-user-select","none",null),i.style.setProperty("-webkit-user-select","none",null),i.style.setProperty("-moz-user-select","none",null),i.style.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null)),t&&(i.style.overflow=t),i},createDiv:function(){var t=Ve.createElement("div");return t.style.position="absolute",t.style.msTouchAction="none",t.style.touchAction="none",t},createCanvas:function(t,e){if(t=t||0,e=e||0,Oe){var i=require("canvas");return new i(t,e)}var n=Ve.createElement("canvas");return n.style.position="absolute",n.style.msTouchAction="none",n.style.touchAction="none",n.width=t,n.height=e,n},setCanvas:function(t,e,i,n,s){2===arguments.length&&(i=e.y,n=e.width,s=e.height,e=e.x),t.style.left=e+"px",t.style.top=i+"px",t.setAttribute("width",n),t.setAttribute("height",s),t._viewRect={x:e,y:i,width:n,height:s};var r=t.getContext("2d");return 0!==r.shadowBlur&&(r.shadowOffsetX=0,r.shadowOffsetY=0,r.shadowBlur=0,r.shadowColor="rgba(0,0,0,0.0)"),r.clearRect(0,0,n,s),r.translate(-e,-i),r},setImg:function(t,e,i){t.setAttribute("src",e),t.style.left=i.x+"px",t.style.top=i.y+"px",t.style.width=i.width+"px",t.style.height=i.height+"px",t._viewRect=Be.clone(i)},setDiv:function(t,e,i,n,s){n=Be.num(n)?n:0,t.style.left=e.x-n+"px",t.style.top=e.y-n+"px",t.style.width=e.width+"px",t.style.height=e.height+"px",t._viewRect=Be.clone(e),t.style.backgroundColor=i?i:"",t.style.border=n>0?n+"px "+s+" solid":""},changeTypeForMS:function(e){var i=e;if(0===e.indexOf("MSPointer")||0===e.indexOf("pointer")){var n;0===e.indexOf("MSPointer")?(n=e.substring(9,10).toLowerCase(),n+=e.substring(10)):n=e.substring(7,8),t.MSPointerEvent?i="MSPointer"+n.substring(0,1).toUpperCase()+n.substring(1):t.PointerEvent&&(i="pointer"+n)}return i},addEventListener:function(t,e,i,n){t=this.changeTypeForMS(t);var s="_"+t+"_";if(!n[s]){var r=function(t){r.instance[r.method](t)};r.method=e,r.instance=n,n[s]=r,i.addEventListener(t,r,!1)}},removeEventListener:function(t,e,i){t=this.changeTypeForMS(t);var n="_"+t+"_",s=i[n];s&&(e.removeEventListener(t,s,!1),delete i[n])},isValidEvent:function(t,e){if(!e)return!1;if(e.target===t)if(He.isFirefox){if(t.clientHeight<t.scrollHeight&&e.layerX<25)return!1;if(t.clientWidth<t.scrollWidth&&e.layerY<25)return!1}else if(e.offsetX>t.clientWidth||e.offsetY>t.clientHeight)return!1;return!0},getLogicalPoint:function(t,e,i,n){i=i?i:1;var s,r=t.getBoundingClientRect();if(He.isTouchable&&e.changedTouches&&e.changedTouches.length>0){var a=e.changedTouches[0],o=He.isAndroid?0:Ci.scrollLeft(),h=He.isAndroid?0:Ci.scrollTop();s={x:(a.clientX+t.scrollLeft-r.left-o)/i,y:(a.clientY+t.scrollTop-r.top-h)/i}}else{if(!je.isValidEvent(t,e))return null;s={x:(e.clientX-r.left+t.scrollLeft)/i,y:(e.clientY-r.top+t.scrollTop)/i}}return s},handle_mousedown:function(e,i){je.target&&je.handle_mouseup(i),t.addEventListener("mousemove",je.handle_mousemove,!1),t.addEventListener("mouseup",je.handle_mouseup,!1),je.target=e},handle_mousemove:function(t){je.target.handle_mousemove&&je.target.handle_mousemove(t),je.target.handleMouseMove&&je.target.handleMouseMove(t)},handle_mouseup:function(e){je.target.handle_mouseup&&je.target.handle_mouseup(e),je.target.handleMouseUp&&je.target.handleMouseUp(e),t.removeEventListener("mousemove",je.handle_mousemove,!1),t.removeEventListener("mouseup",je.handle_mouseup,!1),delete je.target},getClientPoint:function(t){return{x:t.clientX,y:t.clientY}},windowWidth:function(){return"number"==typeof t.innerWidth?t.innerWidth:Ve.documentElement&&Ve.documentElement.clientWidth?Ve.documentElement.clientWidth:Ve.body&&Ve.body.clientWidth?Ve.body.clientWidth:0},windowHeight:function(){return"number"==typeof t.innerHeight?t.innerHeight:Ve.documentElement&&Ve.documentElement.clientHeight?Ve.documentElement.clientHeight:Ve.body&&Ve.body.clientHeight?Ve.body.clientHeight:0;
}};Be.html=je;var qe={cache:{},g:je.createCanvas().getContext("2d"),getTextSize:function(t,e){qe.g.font=t?t:kn.FONT;var i=qe.cache[qe.g.font];i||(i=2*qe.g.measureText("e").width+4,qe.cache[qe.g.font]=i),e=e||"",e=String(e);for(var n,s=e.split("\n"),r=s.length,a=0,o=r-1;o>=0;o--)n=qe.g.measureText(s[o]).width,n>a&&(a=n);return{width:a+4,height:i*r}},getSubStringInLength:function(t,e,i){var n=this,s=function(t,e,i,r,a){if(t>=e)return r.substring(0,t+1);var o=Math.floor((t+e)/2),h=r.substring(0,o+1),l=n.getTextSize(i,h).width;if(l>a)return s(t,o-1,i,r,a);var c=o+1,u=r.substring(0,c+1),d=n.getTextSize(i,u).width;return d>a?h:s(c,e,i,r,a)},r=this.getTextSize(t,e).width;return r>i?s(0,e.length-1,t,e,i):e},getCollapseTextInLength:function(t,e,i){var n=this.getTextSize(t,e).width;if(n>i){for(var s=0,r="",a=e,o=n;o>i;){var h=this.getSubStringInLength(t,a,i);r=r+h+"\n",s+=h.length,a=e.substring(s),o=this.getTextSize(t,a).width}return r+a}return e},drawText:function(t,i,n,s,r,a){i=i||"",i=String(i),s||(s=kn.FONT);var o="center";a&&(o=a),t.font=s,t.fillStyle=r,t.textAlign=o,t.textBaseline="middle";var h,l,c=i.split("\n"),u=c.length,d=0;n?n.width===e?(h=n.x,l=n.y):(d=n.height/u,"left"==o?h=n.x:"center"==o&&(h=n.x+n.width/2),l=n.y+d/2):(h=0,l=0),He.isOpera&&(l-=2);for(var f=0;u>f;f++)"right"==o&&(t.textAlign="left",h=n.x+n.width-qe.getTextSize(s,c[f]).width),t.fillText(c[f],h,l),l+=d},drawArc:function(t,e,i,n,s,r,a,o){var h,l,c,u,d,f,g,_,p,v,m;if(Math.abs(s)>2*Math.PI&&(s=2*Math.PI),d=Math.ceil(Math.abs(s)/(Math.PI/4)),h=s/d,l=-h,c=-n,d>0){f=e+Math.cos(n)*r,g=i+Math.sin(-n)*a,o?t.lineTo(f,g):t.moveTo(f,g);for(var y=0;d>y;y++)c+=l,u=c-l/2,_=e+Math.cos(c)*r,p=i+Math.sin(c)*a,v=e+Math.cos(u)*(r/Math.cos(l/2)),m=i+Math.sin(u)*(a/Math.cos(l/2)),t.quadraticCurveTo(v,m,_,p)}},dashedLine:function(t,e,i,n,s,r,a){var o=r-n,h=a-s,l=Math.sqrt(o*o+h*h);if(0!=l){o/=l,h/=l;for(var c=l,u=-i.offset,d=i.drawing,f=i.patternIndex;c>u;)u+=e[f],u>=c&&(i.offset=e[f]-(u-c),i.patternIndex=f,i.drawing=d,u=c),d?t.lineTo(n+u*o,s+u*h):t.moveTo(n+u*o,s+u*h),d=!d,f=(f+1)%e.length}},drawLinePoints:function(t,e,i,n,s){var r,a,o,h,l,c,u=0,d=0,f=e.size();if(c=i&&i.length>0?new Ai(t,i[0],i.length>1?i[1]:i[0]):t,n)for(d=0,l=n.size();l>d;d++)if(r=n.get(d),"moveto"===r&&f>u)a=e.get(u++),c.moveTo(a.x,a.y);else if("lineto"===r&&f>u)a=e.get(u++),c.lineTo(a.x,a.y);else if("cubicto"===r&&f-2>u)a=e.get(u++),o=e.get(u++),h=e.get(u++),c.bezierCurveTo(a.x,a.y,o.x,o.y,h.x,h.y);else{if(!("quadto"===r&&f-1>u))throw"Can not resolve segment '"+r+"'";a=e.get(u++),o=e.get(u++),c.quadraticCurveTo(a.x,a.y,o.x,o.y)}else this._drawLine(e,c);s&&c.closePath()},_drawLine:function(t,e){var i,n,s,r,a,o=0,h=t.size();for(i=t.get(0),e.moveTo(i.x,i.y),o=1;h>o;o++)a=t.get(o),a.size?(r=a.size(),2===r?(i=a.get(0),n=a.get(1),e.quadraticCurveTo(i.x,i.y,n.x,n.y)):3===r&&(i=a.get(0),n=a.get(1),s=a.get(2),e.bezierCurveTo(i.x,i.y,n.x,n.y,s.x,s.y))):e.lineTo(a.x,a.y)},drawRoundRect:function(t,e,i,n,s,r,a,o,h){6===arguments.length&&(a=r,o=r,h=r);var l=e+n,c=i+s,u=s>n?2*n:2*s;r=u>r?r:u,a=u>a?a:u,o=u>o?o:u,h=u>h?h:u;var d=.292893218813453*h,f=.585786437626905*h;t.moveTo(l,c-h),t.quadraticCurveTo(l,c-f,l-d,c-d),t.quadraticCurveTo(l-f,c,l-h,c),d=.292893218813453*o,f=.585786437626905*o,t.lineTo(e+o,c),t.quadraticCurveTo(e+f,c,e+d,c-d),t.quadraticCurveTo(e,c-f,e,c-o),d=.292893218813453*r,f=.585786437626905*r,t.lineTo(e,i+r),t.quadraticCurveTo(e,i+f,e+d,i+d),t.quadraticCurveTo(e+f,i,e+r,i),d=.292893218813453*a,f=.585786437626905*a,t.lineTo(l-a,i),t.quadraticCurveTo(l-f,i,l-d,i+d),t.quadraticCurveTo(l,i+f,l,i+a),t.lineTo(l,c-h)},drawVector:function(t,e,i,n,s,r,a){var o;4===arguments.length?(s=n.y,r=n.width,a=n.height,n=n.x):5===arguments.length&&"roundrect"===e&&(o={},o.topLeft=s,o.topRight=s,o.bottomLeft=s,o.bottomRight=s,s=n.y,r=n.width,a=n.height,n=n.x);var h=qe["_"+e];h&&(t.beginPath(),i&&i.length>0&&(t=new Ai(t,i[0],i.length>1?i[1]:i[0])),5===arguments.length&&"roundrect"===e?h(t,{x:n,y:s,width:r,height:a},o):h(t,n,s,r,a))},_rectangle:function(t,e,i,n,s){t.rect(e,i,n,s)},_circle:function(t,e,i,n,s){var r=e+n/2,a=i+s/2,o=Math.min(n,s)/2;t instanceof Ai?qe.drawArc(t,r,a,0,2*Math.PI,o,o,!1):t.arc(r,a,o,0,2*Math.PI,!0)},_oval:function(t,e,i,n,s){if(t instanceof Ai)qe.drawArc(t,e+n/2,i+s/2,0,2*Math.PI,n/2,s/2,!1);else{var r=.5522848,a=n/2*r,o=s/2*r,h=e+n,l=i+s,c=e+n/2,u=i+s/2;t.moveTo(e,u),t.bezierCurveTo(e,u-o,c-a,i,c,i),t.bezierCurveTo(c+a,i,h,u-o,h,u),t.bezierCurveTo(h,u+o,c+a,l,c,l),t.bezierCurveTo(c-a,l,e,u+o,e,u)}},_roundrect:function(t,e,i,n,s){if(3===arguments.length){var r=i;i=e.y,n=e.width,s=e.height,e=e.x,r.topLeft?qe.drawRoundRect(t,e,i,n,s,r.topLeft):qe.drawRoundRect(t,e,i,n,s,Math.min(Math.min(n,s)/4,10))}else qe.drawRoundRect(t,e,i,n,s,Math.min(Math.min(n,s)/4,10))},_star:function(t,e,i,n,s){var r=2*n,a=2*s,o=e+n/2,h=i+s/2;t.moveTo(o-r/4,h-a/12),t.lineTo(e+.306*n,i+.579*s),t.lineTo(o-r/6,h+a/4),t.lineTo(e+n/2,i+.733*s),t.lineTo(o+r/6,h+a/4),t.lineTo(e+.693*n,i+.579*s),t.lineTo(o+r/4,h-a/12),t.lineTo(e+.611*n,i+.332*s),t.lineTo(o+0,h-a/4),t.lineTo(e+.388*n,i+.332*s),t.closePath()},_triangle:function(t,e,i,n,s){t.moveTo(e+n/2,i),t.lineTo(e+n,i+s),t.lineTo(e,i+s),t.closePath()},_hexagon:function(t,e,i,n,s){t.moveTo(e,i+s/2),t.lineTo(e+n/4,i+s),t.lineTo(e+3*n/4,+i+s),t.lineTo(e+n,i+s/2),t.lineTo(e+3*n/4,i),t.lineTo(e+n/4,i),t.closePath()},_pentagon:function(t,e,i,n,s){var r=2*n,a=2*s,o=e+n/2,h=i+s/2;t.moveTo(o-r/4,h-a/12),t.lineTo(o-r/6,h+a/4),t.lineTo(o+r/6,h+a/4),t.lineTo(o+r/4,h-a/12),t.lineTo(o+0,h-a/4),t.closePath()},_trapezoidal:function(t,e,i,n,s){t.moveTo(e+n/4,i),t.lineTo(e,i+s),t.lineTo(e+n,i+s),t.lineTo(e+3*n/4,i),t.closePath()},_diamond:function(t,e,i,n,s){t.moveTo(e+n/2,i),t.lineTo(e,i+s/2),t.lineTo(e+n/2,i+s),t.lineTo(e+n,i+s/2),t.closePath()},fill:function(t,e,i,n,s,r,a,o){var h=Ke[i];t.fillStyle=h?5===arguments.length?h(t,e,n,s.x,s.y,s.width,s.height):h(t,e,n,s,r,a,o):e},createRadialGradient:function(t,e,i,n,s,r,a,o,h){var l=t.createRadialGradient(n+r*o,s+a*h,Math.min(r,a)/24,n+r/2,s+a/2,Math.max(r,a)/2);return l.addColorStop(0,i),l.addColorStop(1,e),l},drawPath:function(t,e,i,n,s,r,a,o){var h=t._element,l=t.getBodyRect();n&&Ge.addPadding(l,h,i+".padding",1);var c=Be.clone(l),u=h.getStyle(i+".outline.width");u>0&&Ge.grow(c,u/2,u/2);var d=t.setShadow(t,e,c);0!=h.getAngle()&&(h instanceof Vn||(l=h.getOriginalRect()),De.Util.rotateCanvas(d,l,h.getAngle()));var f,g=h.getStyle(i+".fill");if(g){f=t._innerColor&&!xi.hasDefault(t._element)?t._innerColor:h.getStyle(i+".fill.color");var _=h.getStyle(i+".gradient");_?qe.fill(d,f,_,h.getStyle(i+".gradient.color"),l):d.fillStyle=f}var p=h.getStyle(i+".shape"),v=h.getStyle("group.shape.roundrect.radius");return g&&(d.beginPath(),r?qe.drawLinePoints(d,r,null,a,o):"roundrect"===p&&"group"===i?qe.drawVector(d,p,null,l,v):qe.drawVector(d,p,null,l),d.fill()),u>0&&(d.lineWidth=u,d.lineCap=h.getStyle(i+".cap"),d.lineJoin=h.getStyle(i+".join"),d.strokeStyle=h.getStyle(i+".outline.color"),d.beginPath(),r?qe.drawLinePoints(d,r,s,a,o):"roundrect"===p&&"group"===i?qe.drawVector(d,p,s,l,v):qe.drawVector(d,p,s,l),d.stroke()),c},draw3DRect:function(t,e,i,n,s,r,a){if(0!==i){arguments.length<=4&&(a=n.height,r=n.width,s=n.y,n=n.x);var o=i>0;i=Math.abs(i);var h,l;if(t.lineWidth=1,t.lineCap="square",1===i)h=qe.brighter(e),l=qe.darker(e),t.strokeStyle=o?h:l,t.beginPath(),t.moveTo(n,s),t.lineTo(n,s+a),t.moveTo(n,s),t.lineTo(n+r,s),t.closePath(),t.stroke(),t.strokeStyle=o?l:h,t.beginPath(),t.moveTo(n,s+a),t.lineTo(n+r,s+a),t.moveTo(n+r,s),t.lineTo(n+r,s+a),t.closePath(),t.stroke();else for(var c=2*i,u=50/c,d=0;c>d;d++)h=qe.brighter(e,50-d*u),l=qe.darker(e,50-d*u),n+=.5,s+=.5,r-=1,a-=1,t.strokeStyle=o?h:l,t.beginPath(),t.moveTo(n,s),t.lineTo(n,s+a),t.moveTo(n,s),t.lineTo(n+r,s),t.closePath(),t.stroke(),t.strokeStyle=o?l:h,t.beginPath(),t.moveTo(n,s+a),t.lineTo(n+r,s+a),t.moveTo(n+r,s),t.lineTo(n+r,s+a),t.closePath(),t.stroke()}},brighter:function(t,e){return e||(e=50),qe.adjustBrightness2(t,e)},darker:function(t,e){return e||(e=50),qe.adjustBrightness2(t,-e)},adjustBrightness2:function(t,e){var i,n,s;if(0===e)return t;var r=yn(t);return 0>e?(e=(100+e)/100,i=Math.ceil(r.r*e),n=Math.ceil(r.g*e),s=Math.ceil(r.b*e)):(e/=100,i=r.r,n=r.g,s=r.b,i+=(255-i)*e,n+=(255-n)*e,s+=(255-s)*e,i=Math.min(Math.ceil(i),255),n=Math.min(Math.ceil(n),255),s=Math.min(Math.ceil(s),255)),"rgba("+i+","+n+","+s+",1)"},getColorArray:function(t){return mn.clearRect(0,0,1,1),mn.fillStyle=t,mn.fillRect(0,0,1,1),mn.getImageData(0,0,1,1).data},hit:function(t,e,i,n){if(!t)return!1;var s=t._viewRect;if(!s)return!1;if(e-=s.x,i-=s.y,0>e||0>i||e>=s.width||i>=s.height)return!1;try{for(var r=t.getContext("2d").getImageData(e,i,1,1),a=r.data,o=0,h=a.length;h>o;o+=4)if(0!==a[o+3])return!0}catch(l){return!0}return!1},intersects:function(t,e){if(!t)return!1;if(e=Ge.intersection(e,t._viewRect),!e)return!1;e.x-=t._viewRect.x,e.y-=t._viewRect.y;try{for(var i=t.getContext("2d").getImageData(e.x,e.y,e.width,e.height),n=i.data,s=0,r=n.length;r>s;s+=4)if(0!==n[s+3])return!0}catch(a){}return!1},strokeRect:function(t,e,i,n){e&&(t.beginPath(),t.strokeStyle=i?i:De.Util.randomColor(),t.lineWidth=n?n:2,t.strokeRect(e.x,e.y,e.width,e.height),t.stroke())}};Be.g=qe;var Ke={"linear.southwest":function(t,e,i,n,s,r,a){var o=t.createLinearGradient(n,s+a,n+r,s);return o.addColorStop(0,i),o.addColorStop(1,e),o},"linear.southeast":function(t,e,i,n,s,r,a){var o=t.createLinearGradient(n+r,s+a,n,s);return o.addColorStop(0,i),o.addColorStop(1,e),o},"linear.northwest":function(t,e,i,n,s,r,a){var o=t.createLinearGradient(n+r,s+a,n,s);return o.addColorStop(0,e),o.addColorStop(1,i),o},"linear.northeast":function(t,e,i,n,s,r,a){var o=t.createLinearGradient(n+r,s,n,s+a);return o.addColorStop(0,i),o.addColorStop(1,e),o},"linear.north":function(t,e,i,n,s,r,a){var o=t.createLinearGradient(n,s,n,s+a);return o.addColorStop(0,i),o.addColorStop(1,e),o},"linear.south":function(t,e,i,n,s,r,a){var o=t.createLinearGradient(n,s,n,s+a);return o.addColorStop(0,e),o.addColorStop(1,i),o},"linear.west":function(t,e,i,n,s,r,a){var o=t.createLinearGradient(n,s,n+r,s);return o.addColorStop(0,i),o.addColorStop(1,e),o},"linear.east":function(t,e,i,n,s,r,a){var o=t.createLinearGradient(n,s,n+r,s);return o.addColorStop(0,e),o.addColorStop(1,i),o},"radial.center":function(t,e,i,n,s,r,a){return qe.createRadialGradient(t,e,i,n,s,r,a,.5,.5)},"radial.southwest":function(t,e,i,n,s,r,a){return qe.createRadialGradient(t,e,i,n,s,r,a,.25,.75)},"radial.southeast":function(t,e,i,n,s,r,a){return qe.createRadialGradient(t,e,i,n,s,r,a,.75,.75)},"radial.northwest":function(t,e,i,n,s,r,a){return qe.createRadialGradient(t,e,i,n,s,r,a,.25,.25)},"radial.northeast":function(t,e,i,n,s,r,a){return qe.createRadialGradient(t,e,i,n,s,r,a,.75,.25)},"radial.north":function(t,e,i,n,s,r,a){return qe.createRadialGradient(t,e,i,n,s,r,a,.5,.25)},"radial.south":function(t,e,i,n,s,r,a){return qe.createRadialGradient(t,e,i,n,s,r,a,.5,.75)},"radial.west":function(t,e,i,n,s,r,a){return qe.createRadialGradient(t,e,i,n,s,r,a,.25,.5)},"radial.east":function(t,e,i,n,s,r,a){return qe.createRadialGradient(t,e,i,n,s,r,a,.75,.5)},"spread.horizontal":function(t,e,i,n,s,r,a){var o=t.createLinearGradient(n,s,n+r,s);return o.addColorStop(0,e),o.addColorStop(.5,i),o.addColorStop(1,e),o},"spread.vertical":function(t,e,i,n,s,r,a){var o=t.createLinearGradient(n,s,n,s+a);return o.addColorStop(0,e),o.addColorStop(.5,i),o.addColorStop(1,e),o},"spread.diagonal":function(t,e,i,n,s,r,a){var o=t.createLinearGradient(n+r,s,n,s+a);return o.addColorStop(0,e),o.addColorStop(.5,i),o.addColorStop(1,e),o},"spread.antidiagonal":function(t,e,i,n,s,r,a){var o=t.createLinearGradient(n,s,n+r,s+a);return o.addColorStop(0,e),o.addColorStop(.5,i),o.addColorStop(1,e),o},"spread.north":function(t,e,i,n,s,r,a){var o=t.createLinearGradient(n,s-a/4,n,s+a+a/4);return o.addColorStop(0,e),o.addColorStop(1/3,i),o.addColorStop(2/3,e),o.addColorStop(1,i),o},"spread.south":function(t,e,i,n,s,r,a){var o=t.createLinearGradient(n,s-a/4,n,s+a+a/4);return o.addColorStop(0,i),o.addColorStop(1/3,e),o.addColorStop(2/3,i),o.addColorStop(1,e),o},"spread.west":function(t,e,i,n,s,r,a){var o=t.createLinearGradient(n-r/4,s,n+r+r/4,s);return o.addColorStop(0,e),o.addColorStop(1/3,i),o.addColorStop(2/3,e),o.addColorStop(1,i),o},"spread.east":function(t,e,i,n,s,r,a){var o=t.createLinearGradient(n-r/4,s,n+r+r/4,s);return o.addColorStop(0,i),o.addColorStop(1/3,e),o.addColorStop(2/3,i),o.addColorStop(1,e),o}};De.Util={getVersion:function(){return"5.4.5"},registerImage:function(t,e,i,n,s){Be.registerImage(t,e,i,n,s)},registerImageByUrl:function(t,e,i,n){var s=new Ue;s.src=t,s.onload=function(){De.Util.registerImage(e,s,s.width,s.height),s.onload=null,i&&i.invalidateElementUIs(),n&&n()}},getRegisteredImageNames:function(){return Be.getRegisteredImageNames()},unregisterImage:function(t){Be.unregisterImage(t)},getImageAsset:function(t){return Be.getImageAsset(t)},validateLicense:function(t){Be.validateLicense(t)},getLicense:function(){return Ne},isPermissionGIS:function(){return yi()},moveElements:function(t,e,i,n,s){if((0!==e||0!==i)&&t&&!t.isEmpty()){var r,a,o=De.animate.AnimateManager;o.endAnimate(),t=xi.filterMovingElements(t),n&&(r=new gn,a=new gn),t.forEach(function(t){t instanceof On&&(n?(r.add(t),a.add({x:t.getX()+e,y:t.getY()+i})):t.translate(e,i))}),n?o.start(new De.animate.AnimateLocation(r,a,s)):s&&s()}},isTypeOf:function(t,e){if(t===e)return!0;for(var i=t.superClass;i;){if(i===e.prototype)return!0;i=i.constructor.superClass}return!1},setFocus:function(t){if(Ve.activeElement!==t){var e,i,n,s=Ve.documentElement,r=Ve.body;s&&(He.isIE||He.isOpera||s.scrollLeft||s.scrollTop)?(e=s.scrollLeft,i=s.scrollTop,n=s):r&&(e=r.scrollLeft,i=r.scrollTop,n=r),t.focus(),n&&(n.scrollLeft=e,n.scrollTop=i)}},isOpera:He.isOpera,isIE:He.isIE,isFirefox:He.isFirefox,isChrome:He.isChrome,isSafari:He.isSafari,isIPhone:He.isIPhone,isIPod:He.isIPod,isIPad:He.isIPad,isAndroid:He.isAndroid,isWebOS:He.isWebOS,isTouchable:He.isTouchable,ext:function(t,e,i){Be.ext(t,e,i)},getValue:function(t,e,i){return Be.getValue(t,e,i)},setValue:function(t,e,i){Be.setValue(t,e,i)},grow:function(t,e,i){Ge.grow(t,e,i)},containsPoint:function(t,e,i){return Ge.containsPoint.apply(null,arguments)},intersects:function(t,e){return Ge.intersects(t,e)},getRect:function(t){return Ge.getRect(t)},unionRect:function(t,e){return Ge.unionRect(t,e)},createDiv:function(){return je.createDiv()},createCanvas:function(){return je.createCanvas()},setCanvas:function(t,e,i,n,s){return je.setCanvas.apply(null,arguments)},drawVector:function(t,e,i,n,s,r,a){qe.drawVector.apply(null,arguments)},fill:function(t,e,i,n,s,r,a,o){qe.fill.apply(null,arguments)},getClass:function(t){return Be.getClass(t)},getAllClassNames:function(){var t,e=[];for(t in Be.classCache)e.push(t);return e},newInstance:function(t){return Be.newInstance.apply(null,arguments)},isDeserializing:function(){return Be.isDeserializing},addEventListener:function(t,e,i,n){je.addEventListener(t,e,i,n)},removeEventListener:function(t,e,i){je.removeEventListener(t,e,i)},drawArrow:function(t,e,i,n,s,r,a,o,h,l,c,u){_n.drawArrow.apply(null,arguments)},calculatePointAngleAlongLine:function(t,e,i,n,s){return Ge.calculatePointInfoAlongLineBySegments(t,e,i,n,s)},getSubNetwork:function(t){return xi.getSubNetwork(t)},transformPoint:function(t,e,i,n){return Ge.transformPoint(t,e,i,n)},getToolTipDiv:function(){return Ei.getToolTipDiv()},showToolTip:function(t,e){Ei.showToolTip(t,e)},hideToolTip:function(){Ei.hideToolTip()},resetToolTip:function(){Ei.resetToolTip()},setCSSStyle:function(t,e,i){je.setCSSStyle(t,e,i)},removeCSSStyle:function(t,e){je.removeCSSStyle(t,e)},getCSSStyle:function(t,e){return je.getCSSStyle(t,e)},toDegrees:function(t){return Ge.toDegrees(t)},toRadians:function(t){return Ge.toDegrees(t)},getRadiansBetweenLines:function(t,e){return Ge.getRadiansBetweenLines(t,e)},getElementsBounds:function(t,e){var i=null;return t.forEach(function(t){if(t.getRect){var n,s;e&&(s=e.getElementUI(t),s&&(n=s.getViewRect())),n||(n=t.getRect()),i=i?De.Util.unionRect(i,n):n}}),i},getPointIndex:function(t,e,i){if(i||(i=10),t)for(var n=t.size();n--;n>=0)if(Ge.getDistance(t.get(n),e)<=i)return n;return-1},registerVectorShape:function(t,e){Be.g["_"+t]=e},rotateCanvas:function(t,e,i){t.translate(e.x+e.width/2,e.y+e.height/2),t.rotate(i*Math.PI/180),t.translate(-(e.x+e.width/2),-(e.y+e.height/2))},registerShape:function(t,e){an(t,e)},registerDraw:function(t,e){rn(t,e)},getFilterColor:function(t,e){return An(t,e)},registerGifImage:function(t,e){},parseVectorData:function(t){return Pi(t)},getSharedLinks:function(t,e){var i=t.getLinks(),n=e.getLinks();if(i&&0!=i.size()&&n&&0!=n.size()){var s=i.size()>n.size()?i:n;return s.toList(function(i){return i.getFromNode()==t&&i.getToNode()==e||i.getFromNode()==e&&i.getToNode()==t})}return null},isSharedLinks:function(t,e){var i=!1,n=t.getLinks(),s=e.getLinks();if(n&&0!=n.size()&&s&&0!=s.size()){var r=n.size()>s.size()?n:s;r.forEach(function(n){return!(n.getFromNode()==t&&n.getToNode()==e||n.getFromNode()==e&&n.getToNode()==t)||(i=!0,!1)})}return i},playAnimate:function(t){return Se(t)},pauseAnimate:function(t){t.pause()},resumeAnimate:function(t){t.resume()},stopAnimate:function(t,e){Ce(t,e)},pauseAllAnimates:function(){Ee()},resumeAllAnimates:function(){Le()},stopAllAnimates:function(t){Te(t)},randomColor:function(){return"#"+("00000"+(16777216*this.random()<<0).toString(16)).substr(-6)},random:function(){return Math.random()},getHSVColor:function(t,i,n){var s,r,a,o,h,l,c,u;switch(t&&i===e&&n===e&&(i=t.s,n=t.v,t=t.h),o=Math.floor(6*t),h=6*t-o,l=n*(1-i),c=n*(1-h*i),u=n*(1-(1-h)*i),o%6){case 0:s=n,r=u,a=l;break;case 1:s=c,r=n,a=l;break;case 2:s=l,r=n,a=u;break;case 3:s=l,r=c,a=n;break;case 4:s=u,r=l,a=n;break;case 5:s=n,r=l,a=c}var d="#"+toHex(255*s)+toHex(255*r)+toHex(255*a);return d},toHex:function(t){var e=parseInt(t).toString(16);return 1==e.length&&(e="0"+e),e},makeHighRes:function(e){var i=e.getContext("2d"),n=t.devicePixelRatio||1,s=i.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePixelRatio||i.oBackingStorePixelRatio||i.backingStorePixelRatio||1,r=n/s;if(n!==s){var a=e.width,o=e.height;e.width=Math.round(a*r),e.height=Math.round(o*r),e.style.width=a+"px",e.style.height=o+"px",i.scale(r,r)}},newFunction:function(){var t=arguments,e=t.length;return 1===e?Be.newInstance("Function",t[0]):2===e?Be.newInstance("Function",t[0],t[1]):3===e?Be.newInstance("Function",t[0],t[1],t[2]):4===e?Be.newInstance("Function",t[0],t[1],t[2],t[3]):5===e?Be.newInstance("Function",t[0],t[1],t[2],t[3],t[4]):6===e?Be.newInstance("Function",t[0],t[1],t[2],t[3],t[4],t[5]):7===e?Be.newInstance("Function",t[0],t[1],t[2],t[3],t[4],t[5],t[6]):8===e?Be.newInstance("Function",t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):null}},Be.ext("twaver.Util",Object,{});var Qe,Je=0xdeadbeefcafe,$e=15715070==(16777215&Je);$e&&"Microsoft Internet Explorer"==Fe.appName?(n.prototype.am=a,Qe=30):$e&&"Netscape"!=Fe.appName?(n.prototype.am=r,Qe=26):(n.prototype.am=o,Qe=28),n.prototype.DB=Qe,n.prototype.DM=(1<<Qe)-1,n.prototype.DV=1<<Qe;var ti=52;n.prototype.FV=Math.pow(2,ti),n.prototype.F1=ti-Qe,n.prototype.F2=2*Qe-ti;var ei,ii,ni="0123456789abcdefghijklmnopqrstuvwxyz",si=new Array;for(ei="0".charCodeAt(0),ii=0;9>=ii;++ii)si[ei++]=ii;for(ei="a".charCodeAt(0),ii=10;36>ii;++ii)si[ei++]=ii;for(ei="A".charCodeAt(0),ii=10;36>ii;++ii)si[ei++]=ii;P.prototype.convert=k,P.prototype.revert=I,P.prototype.reduce=R,P.prototype.mulTo=D,P.prototype.sqrTo=B,z.prototype.convert=O,z.prototype.revert=F,z.prototype.reduce=V,z.prototype.mulTo=H,z.prototype.sqrTo=U,n.prototype.copyTo=c,n.prototype.fromInt=u,n.prototype.fromString=f,n.prototype.clamp=g,n.prototype.dlShiftTo=x,n.prototype.drShiftTo=w,n.prototype.lShiftTo=b,n.prototype.rShiftTo=S,n.prototype.subTo=C,n.prototype.multiplyTo=T,n.prototype.squareTo=E,n.prototype.divRemTo=L,n.prototype.invDigit=N,n.prototype.isEven=W,n.prototype.exp=X,n.prototype.toString=_,n.prototype.negate=p,n.prototype.abs=v,n.prototype.compareTo=m,n.prototype.bitLength=A,n.prototype.mod=M,n.prototype.modPowInt=G,n.ZERO=d(0),n.ONE=d(1),Nt.prototype.convert=zt,Nt.prototype.revert=zt,Nt.prototype.mulTo=Ot,Nt.prototype.sqrTo=Ft,Wt.prototype.convert=Xt,Wt.prototype.revert=Gt,Wt.prototype.reduce=Zt,Wt.prototype.mulTo=jt,Wt.prototype.sqrTo=Yt;var ri=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],ai=(1<<26)/ri[ri.length-1];n.prototype.chunkSize=K,n.prototype.toRadix=J,n.prototype.fromRadix=$,n.prototype.fromNumber=tt,n.prototype.bitwiseTo=rt,n.prototype.changeBit=wt,n.prototype.addTo=Tt,n.prototype.dMultiply=Dt,n.prototype.dAddOffset=Bt,n.prototype.multiplyLowerTo=Ut,n.prototype.multiplyUpperTo=Ht,n.prototype.modInt=Qt,n.prototype.millerRabin=te,n.prototype.clone=Z,n.prototype.intValue=Y,n.prototype.byteValue=j,n.prototype.shortValue=q,n.prototype.signum=Q,n.prototype.toByteArray=et,n.prototype.equals=it,n.prototype.min=nt,n.prototype.max=st,n.prototype.and=ot,n.prototype.or=lt,n.prototype.xor=ut,n.prototype.andNot=ft,n.prototype.not=gt,n.prototype.shiftLeft=_t,n.prototype.shiftRight=pt,n.prototype.getLowestSetBit=mt,n.prototype.bitCount=At,n.prototype.testBit=xt,n.prototype.setBit=bt,n.prototype.clearBit=St,n.prototype.flipBit=Ct,n.prototype.add=Et,n.prototype.subtract=Lt,n.prototype.multiply=Mt,n.prototype.divide=kt,n.prototype.remainder=It,n.prototype.divideAndRemainder=Rt,n.prototype.modPow=qt,n.prototype.modInverse=Jt,n.prototype.pow=Vt,n.prototype.gcd=Kt,n.prototype.isProbablePrime=$t,n.prototype.square=Pt,ee.prototype.init=ie,ee.prototype.next=ne;var oi,hi,li,ci=256;if(null==hi){hi=new Array,li=0;var ui;if("Netscape"==Fe.appName&&Fe.appVersion<"5"&&t.crypto){var di=t.crypto.random(32);for(ui=0;ui<di.length;++ui)hi[li++]=255&di.charCodeAt(ui)}for(;ci>li;)ui=Math.floor(65536*De.Util.random()),hi[li++]=ui>>>8,hi[li++]=255&ui;li=0,ae()}le.prototype.nextBytes=he,de.prototype.doPublic=ge,de.prototype.setPublic=fe,de.prototype.encrypt=_e,de.prototype.doPrivate=ye,de.prototype.setPrivate=ve,de.prototype.setPrivateEx=me,de.prototype.decrypt=Ae;var fi=function(){gi.v(Ne)},gi={},_i="6a384c1259bdb5e731ec96b3174683f48a2c56a85e52e7a5bb20b58711ce50c1a294bd5e1d1752e766085e9ae94bae6d217c25dbb5fcdb86a8a9a7e180fa066723d00fcb85fcf7c9d29f8cc8859f53244a49c0bc30dcc45156daf8843ce1d24fe8ebc9a3c186bb26e9d0714041aef160304c1db8cc5728cf4acb39d29755f319",pi="10001";gi.cross=function(t){if(t){for(var e="",i=0;i<t.length;)i+1<t.length?(e+=t[i+1],e+=t[i]):e+=t[i],i+=2;return e}return null},gi.reverse=function(t){if(t){for(var e="",i=t.length;i>0;i--)e+=t[i-1];return e}return null},gi.v=function(t){if(t){var e=gi;if(e.start=null,e.beginDate=null,e.end=null,e.endDate=null,e.gis=null,e["3D"]=null,e["3d"]=null,e.l=null,e.__li__=null,t.indexOf("signature=")>0){var i=t.split("signature="),n=i[0],s=i[1],r=new de;r.setPublic(_i,pi);for(var a=s,o=a.length,h=256,l=0,c="",u="";o>l;)c=a.substr(l,h),u+=r.decrypt(c),l+=h;if(u===n)return e.i(t),!0}}return!1},gi.i=function(t){var i=gi;i.__li__=t;var n,s,r,a,o,h=t.split("\n");for(n=h.length-1;n>=0;n--)s=h[n],o=s.split("="),r=o[0],a=o[1],i[r]=a;i.start!=e&&(i.beginDate=new Date(Date.parse(i.start.replace(/-/g,"/")))),i.end!=e&&(i.endDate=new Date(Date.parse(i.end.replace(/-/g,"/"))));var l=i.gis;l!=e&&(l=parseInt(l)),l&&(i._isPermissionGIS=!0);var c=i["3D"]||i["3d"];c!=e&&(c=parseInt(c)),c&&(i._isPermission3D=!0),i["3D"]&&(i._isPermission3D=!0),i.l!=e&&(i.version=i.l)};var vi=function(t){return t.__li__!==e&&!t._isPermission3D},mi=function(t){if(!vi(t))return!0;var e=new Date;return null!=t.beginDate&&t.beginDate.getTime()-e.getTime()>=0||null!=t.endDate&&t.endDate.getTime()-e.getTime()<=0},yi=function(){return!mi(gi)&&gi._isPermissionGIS};gi.$z=function(t){var e=new de;e.setPublic(_i,pi);for(var i=t,n=i.length,s=256,r=0,a="",o="";n>r;)a=i.substr(r,s),o+=e.decrypt(a),r+=s;return o},gi.twm=function(t){var i=gi,n=i.$z("4cd18113d0c7046bfe51f7a3fbd41c2b7cf14dd785d6ea7cec9da17710d3acfb8ce0cb9cf10839f4bd51e88819de19cdc0db09278584396156fcb65abe0353ac49d01326b30efa0ea98a07da9f8ceeb7572fc1b37b5965ba6103ccba4913b62e36e49425c6ff21a2f008830c59cff8f29058769f858c8a9f0bab3eaea7fb8a9e"),s=this.type,r=this.markText,a=i.$z("648be38cd61c870e95ffc1ea0676af40736c1365015abc326e891a4de67b4de3d4b05da70b9aebedc83ec26ecf71eb74c72f42f6d9a4be2d507d2f67d2860b7b66e3ba1d565e15923f2db335ff922eef17c01b59818b583d5656412d6cc9d9ba70001c2c88e3efd492c6b13a07fda5f325b333138a2036f4696542ec137cc341");if(t[a]=i.__li__,"3"!==s||mi(gi)||r!==e){t.__liLabel==e&&(t.__liLabel=Ve.createElement("div")),i.startDate===e&&(i.startDate=new Date);var o=(new Date).getTime()-i.startDate.getTime();if(!(3e5>o)){var h=mi(i)&&o>3e5,l=r;if(h?l=i.$z("0dd629dbd0ce341ecdd447e35ddc3135a0b46916f7571a687f38ae665cf0ae095fee885e14329caa75112d8787508da17285b0897845d8ccae73e6a2727dd19f1ca335fe139d0e60d240f9ececc78f81c2c5667f51aeed4135b9c4bb436b8acb7cd418eeeb404bc4f3bcdedb481ac0edff7644435ce2b9f2bda78c892bd56d73"):"2"!=s||l!==e&&""!=l?"1"!=s||r||(l=n):l=i.$z("644d54bf9c59afbd8a742a9e7e2731f23f149ccb7f04c3547548c50ac2d77faea108b55f1f6261e99869f1c06b84e8abdefdf45b5170048531421f3d528123972ba2f03d70f37c33f1341dc12f986e0089e42bab517e2a05b455d12d90991bbba9bc45c715a81943062ea5fa5408c8b1b9270d260cc5a67b38ecc4178ce512fc"),l!==e){var c=t,u=c.__liLabel;if(u.innerHTML=l,c._rootCanvas)u.type=s,u.mark=r,u.expired=h,c._xyz=u;else{var d=0,f=0;u.style.position="absolute";var g=c.getView().style;r!=e&&null!=r&&""!=r||"2"==s?(d=10-c.getView().scrollLeft,f=10-c.getView().scrollTop):(d=g.width.replace("px","")/2-50-c.getView().scrollLeft,f=g.height.replace("px","")/2-c.getView().scrollTop),u.style.right=d+"px",u.style.bottom=f+"px",u.style.fontSize="120%",h&&(c.getView().style.opacity=.1,u.style.color="red",u.style.fontSize="150%"),c.getView().appendChild(u)}}}}},Be.validateLicense(Ne);var Ai=function(t,e,i){this.g=t,this.onLength=e,this.offLength=i,this.isLine=!0,this.overflow=0,this.dashLength=e+i,this.pen={x:0,y:0}};Be.ext(Ai,Object,{_curveaccuracy:6,moveTo:function(t,e){this.pen={x:t,y:e},this.g.moveTo(t,e),this.start||(this.start={x:t,y:e})},lineTo:function(t,e){var i=t-this.pen.x,n=e-this.pen.y,s=Math.atan2(n,i),r=Math.cos(s),a=Math.sin(s),o=this.lineLength(this.pen.x,this.pen.y,t,e);if(this.overflow){if(this.overflow>o)return this.isLine?this._lineTo(t,e):this.moveTo(t,e),void(this.overflow-=o);if(this.isLine?this._lineTo(this.pen.x+r*this.overflow,this.pen.y+a*this.overflow):this.moveTo(this.pen.x+r*this.overflow,this.pen.y+a*this.overflow),o-=this.overflow,this.overflow=0,this.isLine=!this.isLine,!o)return}var h=Math.floor(o/this.dashLength);if(h){for(var l=r*this.onLength,c=a*this.onLength,u=r*this.offLength,d=a*this.offLength,f=0;h>f;f++)this.isLine?(this._lineTo(this.pen.x+l,this.pen.y+c),this.moveTo(this.pen.x+u,this.pen.y+d)):(this.moveTo(this.pen.x+u,this.pen.y+d),this._lineTo(this.pen.x+l,this.pen.y+c));o-=this.dashLength*h}this.isLine?o>this.onLength?(this._lineTo(this.pen.x+r*this.onLength,this.pen.y+a*this.onLength),this.moveTo(t,e),this.overflow=this.offLength-(o-this.onLength),this.isLine=!1):(this._lineTo(t,e),o==this.onLength?(this.overflow=0,this.isLine=!this.isLine):(this.overflow=this.onLength-o,this.moveTo(t,e))):o>this.offLength?(this.moveTo(this.pen.x+r*this.offLength,this.pen.y+a*this.offLength),this._lineTo(t,e),this.overflow=this.onLength-(o-this.offLength),this.isLine=!0):(this.moveTo(t,e),o==this.offLength?(this.overflow=0,this.isLine=!this.isLine):this.overflow=this.offLength-o)},quadraticCurveTo:function(t,e,i,n){var s,r=this.pen.x,a=this.pen.y,o=this.curveLength(r,a,t,e,i,n),h=0,l=0;if(this.overflow){if(this.overflow>o)return this.isLine?this._curveTo(t,e,i,n):this.moveTo(i,n),void(this.overflow-=o);if(h=this.overflow/o,s=this.curveSliceUpTo(r,a,t,e,i,n,h),this.isLine?this._curveTo(s[2],s[3],s[4],s[5]):this.moveTo(s[4],s[5]),this.overflow=0,this.isLine=!this.isLine,!o)return}var c=o-o*h,u=Math.floor(c/this.dashLength),d=this.onLength/o,f=this.offLength/o;if(u)for(var g=0;u>g;g++)this.isLine?(l=h+d,s=this.curveSlice(r,a,t,e,i,n,h,l),this._curveTo(s[2],s[3],s[4],s[5]),h=l,l=h+f,s=this.curveSlice(r,a,t,e,i,n,h,l),this.moveTo(s[4],s[5])):(l=h+f,s=this.curveSlice(r,a,t,e,i,n,h,l),this.moveTo(s[4],s[5]),h=l,l=h+d,s=this.curveSlice(r,a,t,e,i,n,h,l),this._curveTo(s[2],s[3],s[4],s[5])),h=l;c=o-o*h,this.isLine?c>this.onLength?(l=h+d,s=this.curveSlice(r,a,t,e,i,n,h,l),this._curveTo(s[2],s[3],s[4],s[5]),this.moveTo(i,n),this.overflow=this.offLength-(c-this.onLength),this.isLine=!1):(s=this.curveSliceFrom(r,a,t,e,i,n,h),this._curveTo(s[2],s[3],s[4],s[5]),o==this.onLength?(this.overflow=0,this.isLine=!this.isLine):(this.overflow=this.onLength-c,this.moveTo(i,n))):c>this.offLength?(l=h+f,s=this.curveSlice(r,a,t,e,i,n,h,l),this.moveTo(s[4],s[5]),s=this.curveSliceFrom(r,a,t,e,i,n,l),this._curveTo(s[2],s[3],s[4],s[5]),this.overflow=this.onLength-(c-this.offLength),this.isLine=!0):(this.moveTo(i,n),c==this.offLength?(this.overflow=0,this.isLine=!this.isLine):this.overflow=this.offLength-c)},bezierCurveTo:function(t,e,i,n,s,r){this.pen={x:s,y:r};var a=[this.onLength,this.offLength];this.g.setLineDash&&this.g.setLineDash(a),this.g.lineDash=a,this.g.bezierCurveTo(t,e,i,n,s,r)},rect:function(t,e,i,n){this.pen={x:t,y:e},this.moveTo(t,e),this.lineTo(t,e+n),this.lineTo(t+i,e+n),this.lineTo(t+i,e),this.lineTo(t,e)},closePath:function(){this.lineTo(this.start.x,this.start.y)},lineLength:function(t,e,i,n){var s=i-t,r=n-e;return Math.sqrt(s*s+r*r)},curveLength:function(t,e,i,n,s,r,a){for(var o,h,l,c,u,d,f,g=0,_=t,p=e,v=a>0?a:this._curveaccuracy,m=1;v>=m;m++)l=m/v,c=1-l,u=c*c,d=2*l*c,f=l*l,o=u*t+d*i+f*s,h=u*e+d*n+f*r,g+=this.lineLength(_,p,o,h),_=o,p=h;return g},curveSlice:function(t,e,i,n,s,r,a,o){if(0==a)return this.curveSliceUpTo(t,e,i,n,s,r,o);if(1==o)return this.curveSliceFrom(t,e,i,n,s,r,a);var h=this.curveSliceUpTo(t,e,i,n,s,r,o);return h.push(a/o),this.curveSliceFrom.apply(this,h)},curveSliceUpTo:function(t,e,i,n,s,r,a){if(1!=a){var o=i+(s-i)*a,h=n+(r-n)*a;i=t+(i-t)*a,n=e+(n-e)*a,s=i+(o-i)*a,r=n+(h-n)*a}return[t,e,i,n,s,r]},curveSliceFrom:function(t,e,i,n,s,r,a){if(1!=a){var o=t+(i-t)*a,h=e+(n-e)*a;i+=(s-i)*a,n+=(r-n)*a,t=o+(i-o)*a,e=h+(n-h)*a}return[t,e,i,n,s,r]},_lineTo:function(t,e){(t!=this.pen.x||e!=this.pen.y)&&(this.pen={x:t,y:e},this.g.lineTo(t,e))},_curveTo:function(t,e,i,n){(t!=i||e!=n||i!=this.pen.x||n!=this.pen.y)&&(this.pen={x:i,y:n},this.g.quadraticCurveTo(t,e,i,n))}}),Be.DashedLine=Ai;var xi={DEFAULTS:{"default":1,"default.vector":1,"vector.default":1},VECTORS:{vector:1,"default.vector":1,"vector.default":1},hasDefault:function(t){if(t instanceof On){var e=t.getStyle("body.type");return 1===xi.DEFAULTS[e]}return!0},hasVector:function(t){if(t instanceof On){var e=t.getStyle("body.type");return 1===xi.VECTORS[e]}return!1},hasAgentLinks:function(t){for(var e=t.getChildrenSize(),i=0;e>i;i++){var n=t.getChildAt(i);if(n instanceof On&&xi.hasAgentLinks(n))return!0}return t.hasAgentLinks()},getParents:function(t,e,i){i||(i=!0);for(var n=new gn,s=t._parent;null!=s&&s!==e;)n.add(s,0),s=s._parent;return i&&null!=s&&s===e&&n.add(s,0),n},getSubNetwork:function(t){if(!t)return null;if(t instanceof De.Link){var e=t._fromAgent,i=t._toAgent;if(!e||!i)return null;var n=xi.getSubNetwork(e),s=xi.getSubNetwork(i);return n===s?n:null}var r=t._parent;if(!r)return null;for(;r instanceof De.Link&&!r.ISubNetwork;)r=r._parent;return r.ISubNetwork?r:xi.getSubNetwork(r);
},figureSameSubNetworkAgent:function(t){if(!t)return null;for(var e=t._parent;e instanceof Vn;){if(!(e._parent instanceof Vn))return e.isExpanded()?t:e;e.isExpanded()||(t=e),e=e._parent}return t},figureSpanSubNetworkAgent:function(t,e){if(!t||!e)return null;var i=xi.getSubNetwork(t),n=xi.getSubNetwork(e);if(i!=n){for(;null!=n&&i!=n;)n=xi.getSubNetwork(n);if(i===n)return t;var s=new gn;s.add(t,0);for(var r=t._parent;r instanceof On&&!e.isDescendantOf(r);)s.add(r,0),r=r._parent;for(var a=s.size(),o=0;a>o;o++){var h=s.get(o);if(h instanceof Vn&&!h.isExpanded())return h;if(h.ISubNetwork)return h}return t}return t},figureFromAgent:function(t){if(t.isLooped())return t.getFromNode();var e=xi.figureSameSubNetworkAgent(t.getFromNode()),i=xi.figureSameSubNetworkAgent(t.getToNode());return e===i?t.getFromNode():xi.figureSpanSubNetworkAgent(e,i)},figureToAgent:function(t){if(t.isLooped())return t.getToNode();var e=xi.figureSameSubNetworkAgent(t.getFromNode()),i=xi.figureSameSubNetworkAgent(t.getToNode());return e===i?t.getToNode():xi.figureSpanSubNetworkAgent(i,e)},getBundleLinks:function(t,e){if(!t||!e)return null;var i,n,s,r;if(t===e){if(r=t.getLoopedLinks(),!r)return null;r=new gn(r)}else{var a=t.getAgentLinks(),o=e.getAgentLinks();if(!a||!o)return null;for(n=a.size(),i=0;n>i;i++)s=a.get(i),o.contains(s)&&(r||(r=new gn),r.add(s))}if(null!=r)for(i=0;i<r.size();i++)s=r.get(i),s.getStyle("link.bundle.enable")||(s._setBundleLinks(null),r.removeAt(i),i--);return r},resetBundleLinks:function(t,e){var i=xi.getBundleLinks(t,e);if(i&&0!==i.size()){var n=null;if(1===i.size())return n=i.get(0),void n._setBundleLinks(null);var s,r,a=new gn;for(s=0;s<i.size();s++)n=i.get(s),r=n.getStyle("link.bundle.id"),a.indexOf(r)<0&&a.add(r);a.sort();var o,h,l=new gn;for(h=0;h<a.size();h++){r=a.get(h);var c=new gn;for(s=0;s<i.size();s++)n=i.get(s),r===n.getStyle("link.bundle.id")&&c.add(n);o=new De.BundleLinks(c,l),l.add(o)}for(h=0;h<l.size();h++)for(o=l.get(h),s=0;s<o.getLinks().size();s++)n=o.getLinks().get(s),n._setBundleLinks(o)}},moveElements:function(t,e,i,n){for(var s=xi.filterMovingElements(t,n),r=s.size(),a=0;r>a;a++)s.get(a).translate(e,i)},filterMovingElements:function(t,e){for(var i=new gn,n=t.size(),s=0;n>s;s++){var r=t.get(s);if(r instanceof On&&(!e||e(r))){for(var a=!0,o=i.toArray(),h=0;h<o.length;h++){var l=o[h];a&&l instanceof De.Follower&&r instanceof De.Follower&&r.isLoopedHostOn(l)?a=!1:l instanceof De.Follower&&l.isHostOn(r)?i.remove(l):a&&r instanceof De.Follower&&l instanceof On&&r.isHostOn(l)?a=!1:xi.isDescendantOfGroup(l,r)?i.remove(l):a&&xi.isDescendantOfGroup(r,l)&&(a=!1)}a&&i.add(r)}}return i},isDescendantOfGroup:function(t,e){if(!(t&&e instanceof Vn))return!1;if(!e.hasChildren())return!1;for(t=t._parent;t instanceof Vn;){if(t===e)return!0;t=t._parent}return!1}};Be.element=xi;var wi={between:function(t,e,i){return i>=t&&e>=i||i>=e&&t>=i},considerEast:function(t,e,i){return!e||(wi.between(e.x,i.x,t.x)?i.x>e.x:Math.abs(e.x-t.x)>Math.abs(i.x-t.x))},considerWest:function(t,e,i){return!e||(wi.between(e.x,i.x,t.x)?i.x<e.x:Math.abs(e.x-t.x)>Math.abs(i.x-t.x))},considerNorth:function(t,e,i){return!e||(wi.between(e.y,i.y,t.y)?i.y<e.y:Math.abs(e.y-t.y)>Math.abs(i.y-t.y))},considerSouth:function(t,e,i){return!e||(wi.between(e.y,i.y,t.y)?i.y>e.y:Math.abs(e.y-t.y)>Math.abs(i.y-t.y))},getHorizontalPoint:function(t,e,i){return wi.between(e.x,i.x,t.x)?{x:t.x,y:e.y}:Math.abs(t.x-e.x)<Math.abs(t.x-i.x)?{x:e.x,y:e.y}:{x:i.x,y:i.y}},getVerticalPoint:function(t,e,i){return wi.between(e.y,i.y,t.y)?{x:e.x,y:t.y}:Math.abs(t.y-e.y)<Math.abs(t.y-i.y)?{x:e.x,y:e.y}:{x:i.x,y:i.y}},getPoint:function(t,e,i,n,s){var r=Math.abs(n.x-i.x)>Math.abs(n.y-i.y);if("south"===s)return r&&wi.considerSouth(e,t,i)?wi.getHorizontalPoint(e,i,n):null;if("north"===s)return r&&wi.considerNorth(e,t,i)?wi.getHorizontalPoint(e,i,n):null;if("west"===s)return!r&&wi.considerWest(e,t,i)?wi.getVerticalPoint(e,i,n):null;if("east"===s)return!r&&wi.considerEast(e,t,i)?wi.getVerticalPoint(e,i,n):null;if("nearby"===s){var a;return a=r?wi.getHorizontalPoint(e,i,n):wi.getVerticalPoint(e,i,n),!t||Ge.getDistance(t,e)>Ge.getDistance(a,e)?a:null}return null},getBusPoint:function(t,e,i){var n,s=t.size();if(s>0){for(var r=t.get(0),a=1;s>a;a++){var o=t.get(a),h=wi.getPoint(n,e,r,o,i);h&&(n=h),r=o}n||(n={x:r.x,y:r.y})}return n}};Be.bus=wi;var bi={createFromPoint:function(t,e){var i=t._element;if(!i.getFromAgent())return{x:0,y:0};var n,s=i.getStyle("link.from.position"),r=i.getStyle("link.from.xoffset"),a=i.getStyle("link.from.yoffset"),o=i.getStyle("link.from.percent");if(o&&o instanceof Array&&2===o.length&&o[0]<=1&&o[0]>=0&&o[1]<=1&&o[1]>=0){var h=i.getFromAgent(),l=h.getSize(),c=h.getRect().x+l.width*o[0],u=h.getRect().y+l.height*o[1];return{x:c,y:u}}if(t._network._edgeDetect){var h=i.getFromAgent(),d=i.getToAgent(),f=h.getImage(),g=Be.images[f],_=h.getCenterLocation(),p=d.getCenterLocation(),v=this._getPointAngleDegree(p.x,p.y,_.x,_.y),m={x:0,y:0};if(g){var y=g._image;if(y&&nn(y)||y&&De.Util.getImageAsset(f)._cache)return nn(y)?g._edgeData||(g._edgeData=g._createEdgeData(y,h._width,h._height)):"object"==typeof y&&(g._edgeData||(g._edgeData=g._createEdgeData(De.Util.getImageAsset(f)._cache,h.getWidth(),h.getHeight()))),m.x=g._edgeData[v].x+h.getRect().x,m.y=g._edgeData[v].y+h.getRect().y,m}}if(!Be.isCalculatingBus){if(Be.isCalculatingBus=!0,i.getFromAgent()instanceof De.Bus){var A=i.getFromAgent();if(xi.hasVector(A)){var x=e?e._getElementZoomRect(t,A.getRect()):A.getRect(),w=A.getStyle("vector.shape");if("oval"===w)n=Ge.getEllipsePoint(x,bi.createToPoint(t));else if("circle"===w)n=Ge.getEllipsePoint(Ge.getCircleRect(x),bi.createToPoint(t));else if("rectangle"===w||"roundrect"===w){var b=new gn;b.add({x:A.x,y:A.y}),b.add({x:A.x+A.width,y:A.y}),b.add({x:A.x+A.width,y:A.y+A.height}),b.add({x:A.x,y:A.y+A.height}),b.add({x:A.x,y:A.y}),b=e?e._getShapeNodeZoomPoints(t,b):b,n=wi.getBusPoint(b,bi.createToPoint(t),A.getStyle("bus.style"))}}else{var b=e?e._getShapeNodeZoomPoints(t,A.getPoints()):A.getPoints();n=wi.getBusPoint(b,bi.createToPoint(t),A.getStyle("bus.style"))}}Be.isCalculatingBus=!1}return n?(n.x+=r,n.y+=a):n=t._network.getPosition(s,i.getFromAgent(),null,r,a,!0),n},createToPoint:function(t,e){var i=t._element;if(!i.getToAgent())return{x:0,y:0};var n,s=i.getStyle("link.to.position"),r=i.getStyle("link.to.xoffset"),a=i.getStyle("link.to.yoffset"),o=i.getStyle("link.to.percent");if(o&&o instanceof Array&&2===o.length&&o[0]<=1&&o[0]>=0&&o[1]<=1&&o[1]>=0){var h=i.getToAgent(),l=h.getSize(),c=h.getRect().x+l.width*o[0],u=h.getRect().y+l.height*o[1];return{x:c,y:u}}if(t._network._edgeDetect){var d=i.getFromAgent(),h=i.getToAgent(),f=h.getImage(),g=Be.images[f],_=d.getLocation(),p=h.getCenterLocation(),v=this._getPointAngleDegree(_.x,_.y,p.x,p.y),m={x:0,y:0};if(g){var y=g._image;if(y&&nn(y)||y&&De.Util.getImageAsset(f)._cache)return nn(y)?g._edgeData||(g._edgeData=g._createEdgeData(y,h.getWidth(),h.getHeight())):"object"==typeof y&&(g._edgeData||(g._edgeData=g._createEdgeData(De.Util.getImageAsset(f)._cache,h.getWidth(),h.getHeight()))),m.x=g._edgeData[v].x+h.getRect().x,m.y=g._edgeData[v].y+h.getRect().y,m}}if(!Be.isCalculatingBus){if(Be.isCalculatingBus=!0,i.getToAgent()instanceof De.Bus){var A=i.getToAgent();if(xi.hasVector(A)){var x=e?e._getElementZoomRect(t,A.getRect()):A.getRect(),w=A.getStyle("vector.shape");if("oval"===w)n=Ge.getEllipsePoint(x,bi.createFromPoint(t));else if("circle"===w)n=Ge.getEllipsePoint(Ge.getCircleRect(x),bi.createFromPoint(t));else if("rectangle"===w||"roundrect"===w){var b=new gn;b.add({x:A.x,y:A.y}),b.add({x:A.x+A.width,y:A.y}),b.add({x:A.x+A.width,y:A.y+A.height}),b.add({x:A.x,y:A.y+A.height}),b.add({x:A.x,y:A.y}),b=e?e._getShapeNodeZoomPoints(t,b):b,n=wi.getBusPoint(b,bi.createFromPoint(t),A.getStyle("bus.style"))}}else{var b=e?e._getShapeNodeZoomPoints(t,A.getPoints()):A.getPoints();n=wi.getBusPoint(b,bi.createFromPoint(t),A.getStyle("bus.style"))}}Be.isCalculatingBus=!1}return n?(n.x+=r,n.y+=a):n=t._network.getPosition(s,i.getToAgent(),null,r,a,!0),n},fillLoopedPoints:function(t,e,i){var n,s=bi.getBundleGap(t,!0),r=s,a=t.getStyle("link.looped.type"),o=t.getStyle("link.looped.direction");if("north"===o)return"arc"===a?bi.drawArc(e.x+e.width/2,e.y,0,Math.PI,s,s,!1,i):(n={x:e.x+e.width/2,y:e.y},i.add({x:n.x+r,y:n.y}),i.add({x:n.x+r,y:n.y-s}),i.add({x:n.x-r,y:n.y-s}),i.add({x:n.x-r,y:n.y})),{x:e.x+e.width/2,y:e.y-s};if("northeast"===o)return"arc"===a?bi.drawArc(e.x+e.width,e.y,1.5*Math.PI,1.5*Math.PI,s,s,!1,i):(n={x:e.x+e.width,y:e.y},i.add({x:n.x,y:n.y+r}),i.add({x:n.x+r,y:n.y+r}),i.add({x:n.x+r,y:n.y-s}),i.add({x:n.x-r,y:n.y-s}),i.add({x:n.x-r,y:n.y})),{x:e.x+e.width+.707*s,y:e.y-.707*s};if("east"===o)return"arc"===a?bi.drawArc(e.x+e.width,e.y+e.height/2,1.5*Math.PI,Math.PI,s,s,!1,i):(n={x:e.x+e.width,y:e.y+e.height/2},i.add({x:n.x,y:n.y-r}),i.add({x:n.x+s,y:n.y-r}),i.add({x:n.x+s,y:n.y+r}),i.add({x:n.x,y:n.y+r})),{x:e.x+e.width+s,y:e.y+e.height/2};if("southeast"===o)return"arc"===a?bi.drawArc(e.x+e.width,e.y+e.height,Math.PI,1.5*Math.PI,s,s,!1,i):(n={x:e.x+e.width,y:e.y+e.height},i.add({x:n.x,y:n.y-r}),i.add({x:n.x+r,y:n.y-r}),i.add({x:n.x+r,y:n.y+s}),i.add({x:n.x-r,y:n.y+s}),i.add({x:n.x-r,y:n.y})),{x:e.x+e.width+.707*s,y:e.y+e.height+.707*s};if("south"===o)return"arc"===a?bi.drawArc(e.x+e.width/2,e.y+e.height,Math.PI,Math.PI,s,s,!1,i):(n={x:e.x+e.width/2,y:e.y+e.height},i.add({x:n.x-r,y:n.y}),i.add({x:n.x-r,y:n.y+s}),i.add({x:n.x+r,y:n.y+s}),i.add({x:n.x+r,y:n.y})),{x:e.x+e.width/2,y:e.y+e.height+s};if("southwest"===o)return"arc"===a?bi.drawArc(e.x,e.y+e.height,.5*Math.PI,1.5*Math.PI,s,s,!1,i):(n={x:e.x,y:e.y+e.height},i.add({x:n.x,y:n.y-r}),i.add({x:n.x-r,y:n.y-r}),i.add({x:n.x-r,y:n.y+s}),i.add({x:n.x+r,y:n.y+s}),i.add({x:n.x+r,y:n.y})),{x:e.x-.707*s,y:e.y+e.height+.707*s};if("west"===o)return"arc"===a?bi.drawArc(e.x,e.y+e.height/2,.5*Math.PI,Math.PI,s,s,!1,i):(n={x:e.x,y:e.y+e.height/2},i.add({x:n.x,y:n.y-r}),i.add({x:n.x-s,y:n.y-r}),i.add({x:n.x-s,y:n.y+r}),i.add({x:n.x,y:n.y+r})),{x:e.x-s,y:e.y+e.height/2};if("northwest"===o)return"arc"===a?bi.drawArc(e.x,e.y,0,1.5*Math.PI,s,s,!1,i):(n={x:e.x,y:e.y},i.add({x:n.x,y:n.y+r}),i.add({x:n.x-r,y:n.y+r}),i.add({x:n.x-r,y:n.y-s}),i.add({x:n.x+r,y:n.y-s}),i.add({x:n.x+r,y:n.y})),{x:e.x-.707*s,y:e.y-.707*s};throw"Can not resolve link looped direction '"+o+"'"},drawArc:function(t,e,i,n,s,r,a,o){var h,l,c,u,d,f,g,_,p,v,m;if(Math.abs(n)>2*Math.PI&&(n=2*Math.PI),d=Math.ceil(Math.abs(n)/(Math.PI/4)),h=n/d,l=-h,c=-i,d>0){f=t+Math.cos(i)*s,g=e+Math.sin(-i)*r,o.add({x:f,y:g});for(var y=0;d>y;y++){c+=l,u=c-l/2,_=t+Math.cos(c)*s,p=e+Math.sin(c)*r,v=t+Math.cos(u)*(s/Math.cos(l/2)),m=e+Math.sin(u)*(r/Math.cos(l/2));var A=new gn;A.add({x:v,y:m}),A.add({x:_,y:p}),o.add(A)}}},fillBundlePoints:function(t,i,n,s,r,a){var o;if(t._element.getBundleCount(),t._element.getBundleIndex(),t.getStyle("link.bundle.expanded"),"parallel"!==i&&0===(o=bi.getBundleGap(t,!1)))return r.add(n),r.add(s),Ge.getCenterPoint(n,s);o===e&&(o=bi.getBundleGap(t,!1));var h=bi.getBundleOffset(t),l=Ge.getDistance(n,s);if(a){var c=a.getSizeZoom();h*=c,o*=c}("arc"===i||"triangle"===i)&&r.add({x:0,y:0}),"arc"===i&&r.add({x:0,y:o}),r.add({x:h,y:o}),r.add({x:l-h,y:o}),"arc"===i&&r.add({x:l,y:o}),("arc"===i||"triangle"===i)&&r.add({x:l,y:0});for(var u=Math.atan2(s.y-n.y,s.x-n.x),d=Ge.createMatrix(u,0,0),f=0,g=r.size();g>f;f++){var _=r.get(f);_=d.transform(_),_.x+=n.x,_.y+=n.y,r.set(f,_)}if("arc"===i){var p=Ge.getCenterPoint(r.get(2),r.get(3)),v=new gn;return v.add(r.get(1)),v.add(r.get(2)),r.set(1,v),v=new gn,v.add(r.get(4)),v.add(r.get(5)),r.set(4,v),r.removeAt(5),r.removeAt(2),p}return bi.calculateCenterPoint(r)},calculateCenterPoint:function(t){var e=t.size();if(null==t||1>e)return{x:0,y:0};if(e%2===0){var i=e/2,n=t.get(i-1),s=t.get(i);return{x:(n.x+s.x)/2,y:(n.y+s.y)/2}}return t.get((e-1)/2)},getBundleOffset:function(t){var e=Ge.getDistance(t.getFromPoint(),t.getToPoint()),i=t.getStyle("link.bundle.offset");return e>2*i?i:e/2},getBundleGap:function(t,e){var i=t._element;if(!i.getBundleLinks())return e?i.getStyle("link.looped.gap"):0;for(var n=e?"link.looped.gap":"link.bundle.gap",s=null,r=0,a=0,o=i.getBundleLinks().getSiblings(),h=0,l=i.getStyle("link.bundle.independent"),c=i.getStyle("link.bundle.group.gap"),u=0,d=o.size();d>u;u++){var f=o.get(u);if(!l||f===i.getBundleLinks()){for(var g=0,_=f.getLinks().size();_>g;g++){var p=f.getLinks().get(g);if(l===p.getStyle("link.bundle.independent")&&t._network.isVisible(p)){if(null==s)s=p,h=p.getStyle(n);else{var v=p.getStyle(n);a+=h/2+v/2,h=v}p===i&&(r=a+c/2)}}a+=c}}if(e)return a-r+h;var m=r-a/2;return null!=s&&i.getFromAgent()!==s.getFromAgent()&&(m=-m),m},isTargetPriority:function(t,e,i){if(t){if(e.height<i.height)return e.height+i.height<Math.max(e.y+e.height,i.y+i.height)-Math.min(e.y,i.y)+e.height/2}else if(e.width<i.width)return e.width+i.width<Math.max(e.x+e.width,i.x+i.width)-Math.min(e.x,i.x)+e.width/2;return!0},calculateOrthogonalAndFlexionalLinkPoints:function(t,e,i,n){var s=bi.isHorizontal(t,e,i,n),r=new gn;if(bi.isFlexionalTypeLink(t))bi.flexional(s,e,i,r,n.getStyle("link.extend"));else{bi.orthogonal(t,e,i,r,s,n);var a=bi.isSplitByPercent(t,n),o=a?bi.calculateSplitValueByPercent(t,s,e,i,n.getStyle("link.split.percent")):n.getStyle("link.split.value");0===o&&(s=!s)}var h;0===r.size()?bi.isTargetPriority(s,e,i)?(h={x:i.x+i.width/2,y:i.y+i.height/2},r.add(bi.rectanglePerimeter(e,!0,h)),r.add(bi.rectanglePerimeter(i,!1,r.get(r.size()-1)))):(h={x:e.x+e.width/2,y:e.y+e.height/2},h=bi.rectanglePerimeter(i,!1,h),r.add(bi.rectanglePerimeter(e,!0,h)),r.add(h)):(h=r.get(0),r.add(bi.rectanglePerimeter(e,!0,h),0),r.add(bi.rectanglePerimeter(i,!1,r.get(r.size()-1))));var l=r.size();if(2>l)return r;for(var c=r.get(0),u=1;l-1>u;u++){var d=r.get(u);d.x===c.x&&d.y===c.y&&(r.remove(d),l--,u--),c=d}return r},isHorizontal:function(t,e,i,n){if(t){if("flexional.horizontal"===t||"orthogonal.horizontal"===t||"orthogonal.H.V"===t||"extend.left"===t||"extend.right"===t)return!0;if("flexional.vertical"===t||"orthogonal.vertical"===t||"orthogonal.V.H"===t||"extend.top"===t||"extend.bottom"===t)return!1}var s=bi.calculateXGap(e,i),r=bi.calculateYGap(e,i);return s>=r},flexional:function(t,e,i,n,s){t?bi.flexionalHorizontal(e,i,n,s):bi.flexionalVertical(e,i,n,s)},isSplitByPercent:function(t,e){return e.getStyle("link.split.by.percent")},isExtendTypeLink:function(t){return t&&("extend.top"===t||"extend.left"===t||"extend.bottom"===t||"extend.right"===t)},isFlexionalTypeLink:function(t){return t&&("flexional"===t||"flexional.horizontal"===t||"flexional.vertical"===t)},calculateControlPoint:function(t,e,i,n,s){if("orthogonal.H.V"===t||"orthogonal.V.H"===t)return{x:n.x+n.width/2,y:n.y+n.height/2};var r;if(bi.isExtendTypeLink(t)){var a=Math.min(i.y,n.y),o=Math.min(i.x,n.x),h=Math.max(i.y+i.height,n.y+n.height),l=Math.max(i.x+i.width,n.x+n.width);if(r=s.getStyle("link.extend"),"extend.top"===t)return{x:(o+l)/2,y:a-r};if("extend.left"===t)return{x:o-r,y:(a+h)/2};if("extend.bottom"===t)return{x:(o+l)/2,y:h+r};if("extend.right"===t)return{x:l+r,y:(a+h)/2}}var c=bi.isSplitByPercent(t,s);if(r=c?bi.calculateSplitValueByPercent(t,e,i,n,s.getStyle("link.split.percent")):s.getStyle("link.split.value"),r===Number.NEGATIVE_INFINITY||r===Number.POSITIVE_INFINITY)return{x:n.x+n.width/2,y:n.y+n.height/2};if(0===r)return{x:i.x+i.width/2,y:i.y+i.height/2};if(e){var u=i.x+i.x+i.width<n.x+n.x+n.width;return{x:bi.calculateSplitLocation(u,r,i.x,i.width),y:i.y+i.height/2}}var d=i.y+i.y+i.height<n.y+n.y+n.height;return{x:i.x+i.width/2,y:bi.calculateSplitLocation(d,r,i.y,i.height)}},calculateGap:function(t,e,i,n){var s=Math.max(e,n)-Math.min(t,i);return s-(e-t+n-i)},calculateXGap:function(t,e){var i=Math.max(t.x+t.width,e.x+e.width)-Math.min(t.x,e.x);return i-t.width-e.width},calculateYGap:function(t,e){var i=Math.max(t.y+t.height,e.y+e.height)-Math.min(t.y,e.y);return i-t.height-e.height},calculateSplitValueByPercent:function(t,e,i,n,s){var r=bi.calculateSplitGapByPercent(s,e,i,n);return r*s},calculateSplitGapByPercent:function(t,e,i,n,s){return e?bi._calculateSplitGapByPercent(t,i.x,i.x+i.width,n.x,n.x+n.width):bi._calculateSplitGapByPercent(t,i.y,i.y+i.height,n.y,n.y+n.height)},_calculateSplitGapByPercent:function(t,e,i,n,s){var r=bi.calculateGap(e,i,n,s),a=n+s>e+i;if(r>0){if(1===t)return r+(s-n)/2;if(t>=0&&1>t)return r;if(0>t)return a?n-e:i-s}return Math.abs(a&&t>0||!a&&0>t?i-s:e-n)},calculateSplitPercentByControlPoint:function(t,e,i,n){return e?bi.calculateSplitPercent(t.x,i.x,i.x+i.width,n.x,n.x+n.width):bi.calculateSplitPercent(t.y,i.y,i.y+i.height,n.y,n.y+n.height)},calculateSplitPercent:function(t,e,i,n,s){if(t>=e&&i>=t)return 0;var r=bi.calculateGap(e,i,n,s);if(r>0&&t>=n&&s>=t)return 1;var a=n+s>e+i;if(r>0){if(t>Math.min(i,s)&&t<Math.max(e,n))return Math.abs(t-(a?i:e))/r;if(a){if(e>t)return(t-e)/(n-e)}else if(t>i)return(i-t)/(i-s)}return t>i?(a?t-i:i-t)/Math.abs(i-s):(a?t-e:e-t)/Math.abs(e-n)},calculateSplitLocation:function(t,e,i,n){return t===e>0?i+n+Math.abs(e):i-Math.abs(e)},calculateAngle:function(t,e){if(0!==t&&0!==e)return Math.atan2(t,e);if(0===t){if(e>0)return 0;if(0>e)return Math.PI}return t>0?Math.PI/2:-Math.PI/2},drawCorner:function(t,e){var i=t.size();if(!(3>i)){var n=e.getStyle("link.corner");if("none"!==n){for(var s,r,a,o,h=e.getStyle("link.xradius"),l=e.getStyle("link.yradius"),c=t.get(0),u=t.get(1),d=2;i>d;d++){var f=t.get(d),g=u.x-c.x,_=u.y-c.y,p=f.x-u.x,v=f.y-u.y,m=0===_;if(0===g&&0===v||0===_&&0===p)if(m?(s=Math.min(2===d?Math.abs(g):Math.abs(g)/2,h),r=Math.min(d===i-1?Math.abs(v):Math.abs(v)/2,l),a={x:u.x-(g>0?s:-s),y:u.y},o={x:u.x,y:u.y+(v>0?r:-r)}):(s=Math.min(d===i-1?Math.abs(p):Math.abs(p)/2,h),r=Math.min(2===d?Math.abs(_):Math.abs(_)/2,l),a={x:u.x,y:u.y-(_>0?r:-r)},o={x:u.x+(p>0?s:-s),y:u.y}),t.remove(u),d--,i--,(a.x!==c.x||a.y!==c.y)&&(t.add(a,d),d++,i++),"bevel"===n)t.add(o,d),d++,i++;else if("round"===n){var y=new gn;y.add(u),y.add(o),t.add(y,d),d++,i++}c=u,u=f}o&&o.x===u.x&&o.y===u.y&&t.remove(u)}}},orthogonal:function(t,e,i,n,s,r){var a=r.getStyle("link.control.point"),o=null==a;if(a){var h=Ge.unionRect(e,i);Ge.containsPoint(h,a)||(s=bi.calculateIsHorizontalByControlPoint(a.x,a.y,h.y,h.x,h.y+h.height,h.x+h.width))}else a=bi.calculateControlPoint(t,s,e,i,r);s?bi.sideToSide(e,i,a,n,o):bi.topToBottom(e,i,a,n,o)},calculateIsHorizontalByControlPoint:function(t,e,i,n,s,r){return!(i>e&&i-e>n-t&&i-e>t-r||e>s&&e-s>n-t&&e-s>t-r)},contains:function(t,e,i){return e>=t.x&&e<=t.x+t.width&&i>=t.y&&i<=t.y+t.height},topToBottom:function(t,e,i,n,s){var r=Math.max(t.y,e.y),a=Math.min(t.y+t.height,e.y+e.height),o=i?i.y:a+(r-a)/2,h=t.x+t.width/2,l=e.x+e.width/2;if(!s&&i&&(i.x>=t.x&&i.x<=t.x+t.width&&(h=i.x),i.x>=e.x&&i.x<=e.x+e.width&&(l=i.x)),bi.contains(e,h,o)||bi.contains(t,h,o)||n.add({x:h,y:o}),bi.contains(e,l,o)||bi.contains(t,l,o)||n.add({x:l,y:o}),0===n.size())if(i)bi.contains(e,i.x,o)||bi.contains(t,i.x,o)||n.add({x:i.x,y:o});else{var c=Math.max(t.x,e.x),u=Math.min(t.x+t.width,e.x+e.width);n.add({x:c+(u-c)/2,y:o})}},sideToSide:function(t,e,i,n,s){var r=Math.max(t.x,e.x),a=Math.min(t.x+t.width,e.x+e.width),o=i?i.x:a+(r-a)/2,h=t.y+t.height/2,l=e.y+e.height/2;if(!s&&i&&(i.y>=t.y&&i.y<=t.y+t.height&&(h=i.y),i.y>=e.y&&i.y<=e.y+e.height&&(l=i.y)),bi.contains(e,o,h)||bi.contains(t,o,h)||n.add({x:o,y:h}),bi.contains(e,o,l)||bi.contains(t,o,l)||n.add({x:o,y:l}),0===n.size())if(i)bi.contains(e,o,i.y)||bi.contains(t,o,i.y)||n.add({x:o,y:i.y});else{var c=Math.max(t.y,e.y),u=Math.min(t.y+t.height,e.y+e.height);n.add({x:o,y:c+(u-c)/2})}},flexionalHorizontal:function(t,e,i,n){var s=e.x+e.width<t.x,r=t.x+t.width<e.x,a=s?t.x:t.x+t.width,o=t.y+t.height/2,h=r?e.x:e.x+e.width,l=e.y+e.height/2,c=n,u=s?-c:c,d={x:a+u,y:o};u=r?-c:c;var f={x:h+u,y:l};if(s===r){var g=s?Math.min(a,h)-n:Math.max(a,h)+n;i.add({x:g,y:o}),i.add({x:g,y:l})}else if(d.x<f.x===s){var _=o+(l-o)/2;i.add(d),i.add({x:d.x,y:_}),i.add({x:f.x,y:_}),i.add(f)}else i.add(d),i.add(f)},flexionalVertical:function(t,e,i,n){var s=e.y+e.height<t.y,r=t.y+t.height<e.y,a=t.x+t.width/2,o=s?t.y:t.y+t.height,h=e.x+e.width/2,l=r?e.y:e.y+e.height,c=n,u=s?-c:c,d={x:a,y:o+u};u=r?-c:c;var f={x:h,y:l+u};if(s===r){var g=s?Math.min(o,l)-n:Math.max(o,l)+n;i.add({x:a,y:g}),i.add({x:h,y:g})}else if(d.y<f.y===s){var _=a+(h-a)/2;i.add(d),i.add({x:_,y:d.y}),i.add({x:_,y:f.y}),i.add(f)}else i.add(d),i.add(f)},rectanglePerimeter:function(t,e,i){var n=t.x+t.width/2,s=t.y+t.height/2,r=i.x-n,a=i.y-s,o=Math.atan2(a,r),h={x:0,y:0},l=Math.PI,c=Math.PI/2,u=c-o,d=Math.atan2(t.height,t.width);return-l+d>o||o>l-d?(h.x=t.x,h.y=s-t.width*Math.tan(o)/2):-d>o?(h.y=t.y,h.x=n-t.height*Math.tan(u)/2):d>o?(h.x=t.x+t.width,h.y=s+t.width*Math.tan(o)/2):(h.y=t.y+t.height,h.x=n+t.height*Math.tan(u)/2),i.x>=t.x&&i.x<=t.x+t.width?h.x=i.x:i.y>=t.y&&i.y<=t.y+t.height&&(h.y=i.y),i.x<t.x?h.x=t.x:i.x>t.x+t.width&&(h.x=t.x+t.width),i.y<t.y?h.y=t.y:i.y>t.y+t.height&&(h.y=t.y+t.height),h},isSplitTypeLink:function(t){return t&&("orthogonal"===t||"orthogonal.horizontal"===t||"orthogonal.vertical"===t)},isOrthogonalOrFlexionalLink:function(t){if(t instanceof De.ShapeLink)return!1;if(t.isLooped())return!1;var e=t.getStyle("link.type");return bi.isOrthogonalOrFlexionalType(e)},isOrthogonalLink:function(t){if(t instanceof De.ShapeLink)return!1;if(t.isLooped())return!1;var e=t.getStyle("link.type");return bi.isOrthogonalType(e)},isOrthogonalOrFlexionalType:function(t){return"orthogonal"===t||"orthogonal.horizontal"===t||"orthogonal.H.V"===t||"orthogonal.vertical"===t||"orthogonal.V.H"===t||"extend.top"===t||"extend.left"===t||"extend.bottom"===t||"extend.right"===t||"flexional"===t||"flexional.horizontal"===t||"flexional.vertical"===t},isOrthogonalType:function(t){return"orthogonal"===t||"orthogonal.horizontal"===t||"orthogonal.H.V"===t||"orthogonal.vertical"===t||"orthogonal.V.H"===t||"extend.top"===t||"extend.left"===t||"extend.bottom"===t||"extend.right"===t},hasControlPoint:function(t){return"orthogonal"===t||"orthogonal.horizontal"===t||"orthogonal.vertical"===t||"extend.bottom"===t||"extend.left"===t||"extend.right"===t||"extend.top"===t},getControlPoint:function(t,e,i){if(!t)throw"link can't be null";var n=t.getStyle("link.type");if(!bi.hasControlPoint(n))return null;var s=t.getStyle("link.control.point");if(s)return s;var r,a;if(null==e?(r=t.getFromAgent().getRect(),a=t.getToAgent().getRect()):(r=bi.getLinkSourceBounds(e,i),a=bi.getLinkTargetBounds(e,i)),null==r||null==a)return null;var o=bi.isHorizontal(n,r,a,t);return bi.calculateControlPoint(t.getStyle("link.type"),o,r,a,t)},getSplitValueByControlPoint:function(t,e,i,n,s){if("extend.top"===e)return Math.min(i.y,n.y)-t.y;if("extend.left"===e)return Math.min(i.x,n.x)-t.x;if("extend.bottom"===e)return t.y-Math.max(i.y+i.height,n.y+n.height);if("extend.right"===e)return t.x-Math.max(i.x+i.width,n.x+n.width);var r;if(s){var a=i.x+i.x+i.width<n.x+n.x+n.width;return r=a?t.x-i.x+i.width:i.x-t.x,r>0?r:r>-i.width?0:r+i.width}var o=i.y+i.y+i.height<n.y+n.y+n.height;return r=o?t.y-i.y-i.height:i.y-t.y,r>0?r:r>-i.height?0:r+i.height},isHorizontalByControlPoint:function(t,e,i,n,s){var r=Ge.unionRect(i,n);return Ge.containsPoint(r,t)?bi.isHorizontal(e,i,n,s):bi.calculateIsHorizontalByControlPoint(t.x,t.y,r.y,r.x,r.y+r.height,r.x+r.width)},setParamsByControlPoint:function(t,e,i,n,s){var r=bi.isHorizontalByControlPoint(t,n,e,i,s),a=s.getStyle("link.control.point");if((a||"orthogonal"===n||"orthogonal.horizontal"===n||"orthogonal.vertical"===n)&&s.setStyle("link.type",r?"orthogonal.horizontal":"orthogonal.vertical"),a)return void s.setStyle("link.control.point",t);var o=bi.getSplitValueByControlPoint(t,n,e,i,r);if(bi.isExtendTypeLink(n))return void s.setStyle("link.extend",o);var h=bi.isSplitByPercent(n,s);return h?0===o?void s.setStyle("link.split.percent",0):void s.setStyle("link.split.percent",bi.calculateSplitPercentByControlPoint(t,r,e,i)):void s.setStyle("link.split.value",o)},getLinkNodeBounds:function(t,e,i,n,s,r){if(r){var a=r.getLocationZoom();r.getSizeZoom(t)}if(null==t)return null;var o;if(n)r?(o=t.getZoomBodyRect(),o.x+=e,o.y+=i):(o=t.getBodyRect(),o.x+=e,o.y+=i);else{var h=t.getNetwork().getPosition(s,t,null,e,i);o=r?{x:h.x*a,y:h.y*a,width:1,height:1}:{x:h.x,y:h.y,width:1,height:1}}return o},getLinkSourceBounds:function(t,e){var i=t._element,n=t.getNetwork().getElementUI(i.getFromAgent());if(null==n)return null;var s=i.getStyle("link.from.position"),r=i.getStyle("link.from.xoffset"),a=i.getStyle("link.from.yoffset"),o=i.getStyle("link.from.at.edge");return bi.getLinkNodeBounds(n,r,a,o,s,e)},getLinkTargetBounds:function(t,e){var i=t._element,n=t.getNetwork().getElementUI(i.getToAgent());if(null==n)return null;var s=i.getStyle("link.to.position"),r=i.getStyle("link.to.xoffset"),a=i.getStyle("link.to.yoffset"),o=i.getStyle("link.to.at.edge");return bi.getLinkNodeBounds(n,r,a,o,s,e)},orthogonalAndFlexional:function(t,e,i){var n=bi.getLinkSourceBounds(t,i);if(null==n)return null;var s=bi.getLinkTargetBounds(t,i);if(null==s)return null;var r=bi.calculateOrthogonalAndFlexionalLinkPoints(e,n,s,t._element);return bi.offsetLink(t,r),t.setHotSpot(bi.calculateCenterPoint(r)),"flexional"!==e&&bi.drawCorner(r,t._element),r},offsetLink:function(t,e){var i=t._element,n=i.isBundleAgent();if(!n){var s=bi.getBundleGap(t,!1);if(0!==s)for(var r,a,o=!1,h=!1,l=e.get(0),c=Be.clone(l),u=1,d=e.size();d>u;u++){var f=e.get(u),g=f.x-c.x,_=f.y-c.y;c=Be.clone(f),a=bi.calculateAngle(g,_),0===g?((a-r)%Math.PI===0&&(a-r)%(2*Math.PI)!==0&&(o=!o,o&&(_=-_)),(a-r)%Math.PI!==0&&(l.x+=0>_?s:-s),f.x+=0>_?s:-s):0===_&&((a-r)%Math.PI===0&&(a-r)%(2*Math.PI)!==0&&(h=!h,h&&(g=-g)),r&&(a-r)%Math.PI===0||(l.y-=0>g?s:-s),f.y-=0>g?s:-s),r=a,l=f}}},_getPointAngleDegree:function(t,e,i,n){var s=i-t,r=n-e,a=Math.atan2(r,s);return a=a/Math.PI*180,a=parseInt(a)+180,a%=360}};Be.link=bi;var Si={findMoveToBottomDatas:function(t,e,i){for(var n=0;n<i.size();n++){var s=i.get(n);t.contains(s)&&e.add(s)}for(n=0;n<i.size();n++)s=i.get(n),Si.findMoveToBottomDatas(t,e,s.getChildren())},findMoveToTopDatas:function(t,e,i){for(var n=0;n<i.size();n++){var s=i.get(i.size()-1-n);t.contains(s)&&e.add(s)}for(n=0;n<i.size();n++)s=i.get(n),Si.findMoveToTopDatas(t,e,s.getChildren())},findMoveUpDatas:function(t,e,i){for(var n=!1,s=0;s<i.size();s++){var r=i.get(s);t.contains(r)?n&&e.add(r):n=!0}for(s=0;s<i.size();s++)r=i.get(s),Si.findMoveUpDatas(t,e,r.getChildren())},findMoveDownDatas:function(t,e,i){for(var n=!1,s=0;s<i.size();s++){var r=i.get(i.size()-1-s);t.contains(r)?n&&e.add(r):n=!0}for(s=0;s<i.size();s++)r=i.get(s),Si.findMoveDownDatas(t,e,r.getChildren())},doLayout:function(t,e){e=e||{},e.type=e.type||"round",e.animate=e.animate||!0,e.elements=e.elements||new De.List,e.repulsion=e.repulsion||1,e.expandGroup=e.expandGroup||!1;var i=new De.layout.AutoLayouter(t.getElementBox());i.getElements=function(){}}};Be.box=Si;var Ci={scrollLeft:function(){return Ci._filterResults(t.pageXOffset?t.pageXOffset:0,Ve.documentElement?Ve.documentElement.scrollLeft:0,Ve.body?Ve.body.scrollLeft:0)},scrollTop:function(){return Ci._filterResults(t.pageYOffset?t.pageYOffset:0,Ve.documentElement?Ve.documentElement.scrollTop:0,Ve.body?Ve.body.scrollTop:0)},_filterResults:function(t,e,i){var n=t?t:0;return e&&(!n||n>e)&&(n=e),i&&(!n||n>i)?i:n},isSingleTouch:function(t){return t.touches&&1==t.touches.length},isMultiTouch:function(t){return t.touches&&t.touches.length>1},getDistance:function(t){if(!Ci.isMultiTouch(t))return 0;var e=t.touches[0],i=t.touches[1];return Math.sqrt(Math.pow(e.clientX-i.clientX,2)+Math.pow(e.clientY-i.clientY,2))}};Be.touch=Ci;var Ti={_string:function(t,e,i,n){var s=i._stringPool.get();s.style.whiteSpace="nowrap",s.style.verticalAlign="middle",s.style.padding="0px 2px",Be.setText(s,t,n),s.setAttribute("title",t),e.appendChild(s)},_boolean:function(t,e,i){var n=i._booleanPool.get();e._editInfo?(n._editInfo=e._editInfo,delete e._editInfo,n.disabled=!1):n.disabled=!0,n.keepDefault=!0,n.type="checkbox",n.style.margin="0px 2px",n.style.verticalAlign="middle",n.checked=t,e.appendChild(n),""===e.style.textAlign&&(e.style.textAlign="center")},_color:function(t,e,i){var n=i._colorPool.get();n.style.width="100%",n.style.height="100%",n.style.backgroundColor=t,n.setAttribute("title",t),e.appendChild(n)},render:function(t,e,i,n,s){if(null!=e){var r=Ti["_"+t];r?r(e,i,n,s):"boolean"==typeof e?Ti._boolean(e,i,n,s):Ti._string(e,i,n,s)}}};Be.render=Ti;var Ei={toolTipDiv:null,getToolTipDiv:function(){if(!Ei.toolTipDiv){Ei.toolTipDiv=Ve.createElement("div");var t=kn,e=Ei.toolTipDiv.style;e.position="absolute",e.color=t.TOOLTIP_COLOR,e.background=t.TOOLTIP_BACKGROUND,e.fontSize=t.TOOLTIP_FONT_SIZE,e.padding=t.TOOLTIP_PADDING,e.border=t.TOOLTIP_BORDER,e.borderRadius=t.TOOLTIP_BORDER_RADIUS,e.boxShadow=t.TOOLTIP_BOX_SHADOW,e.zIndex=t.TOOLTIP_ZINDEX,e.setProperty&&e.setProperty("-webkit-box-shadow",t.TOOLTIP_BOX_SHADOW,null)}return Ei.toolTipDiv},isToolTipVisible:function(){return!!Ei.getToolTipDiv().parentNode},hideToolTip:function(){if(Ei._clearTimeout(),Ei._clearDismiss(),Ei.isToolTipVisible()){var t=Ei.getToolTipDiv();t.parentNode&&t.parentNode.removeChild(t)}},showToolTip:function(t,e){return t&&e?void(Ei.isToolTipVisible()||Ei._reshow_timeout?Ei._showToolTip(t,e):(Ei._clearTimeout(),Ei._show_timeout=setTimeout(function(){Ei._showToolTip(t,e)},kn.TOOLTIP_INITIAL_DELAY))):void Ei.hideToolTip()},_showToolTip:function(t,e){var i,n,s;t.target?(i=t.clientX,n=t.clientY):(i=t.x,n=t.y),s=Ei.getToolTipDiv(),je.clear(s),e instanceof Element?s.appendChild(e):s.innerHTML=e,s.style.left=i+kn.TOOLTIP_XOFFSET+"px",s.style.top=n+kn.TOOLTIP_YOFFSET+"px",s.parentNode||Ve.body.appendChild(s),Ei._clearDismiss(),Ei._dismiss_timeout=setTimeout(Ei.hideToolTip,kn.TOOLTIP_DISMISS_DELAY),Ei._clearReshow(),Ei._reshow_timeout=setTimeout(Ei._clearReshow,kn.TOOLTIP_RESHOW_DELAY)},_clearDismiss:function(){Ei._dismiss_timeout&&(clearTimeout(Ei._dismiss_timeout),Ei._dismiss_timeout=null)},_clearReshow:function(){Ei._reshow_timeout&&(clearTimeout(Ei._reshow_timeout),Ei._reshow_timeout=null)},_clearTimeout:function(){Ei._show_timeout&&(clearTimeout(Ei._show_timeout),Ei._show_timeout=null)},resetToolTip:function(){Ei.hideToolTip(),Ei.toolTipDiv=null}};Be.popup=Ei;var Li={handleClicked:function(t,e,i){if(He.isTouchable||0===e.button)if(i){var n=Mi(i);n&&n.onClick&&n.onClick(i,t),t.onClickElement(i,e),t.fireInteractionEvent({kind:"clickElement",event:e,element:i})}else t.onClickBackground(e),t.fireInteractionEvent({kind:"clickBackground",event:e})},handleDoubleClicked:function(t,e,i){if((He.isTouchable||0===e.button)&&!t.isEditingElement()){if(i){var n=Mi(i);n&&n.onDoubleClick&&n.onDoubleClick(i,t),t.onDoubleClickElement(i,e),t.fireInteractionEvent({kind:"doubleClickElement",event:e,element:i})}else t.onDoubleClickBackground(e),t.fireInteractionEvent({kind:"doubleClickBackground",event:e});i?i instanceof De.Link&&t.isDoubleClickToLinkBundle()?i.ISubNetwork&&t.isDoubleClickToSubNetwork()&&!Be.isCtrlDown(e)?(t.isDoubleClickToEmptySubNetwork()||i.getChildrenSize()>0)&&t.setCurrentSubNetwork(i,t.isSubNetworkAnimate(),function(){t.fireInteractionEvent({kind:"enterSubNetwork",event:e,element:i})}):i.reverseBundleExpanded()&&t.fireInteractionEvent({kind:"bundleLink",event:e,element:i}):i.ISubNetwork&&t.isDoubleClickToSubNetwork()?(t.isDoubleClickToEmptySubNetwork()||i.getChildrenSize()>0)&&t.setCurrentSubNetwork(i,t.isSubNetworkAnimate(),function(){t.fireInteractionEvent({kind:"enterSubNetwork",event:e,element:i})}):i instanceof Vn&&t.isDoubleClickToGroupExpand()&&(i.reverseExpanded(),t.fireInteractionEvent({kind:"expandGroup",event:e,element:i})):t.isDoubleClickToUpSubNetwork()&&t.upSubNetwork(t.isSubNetworkAnimate(),function(){t.fireInteractionEvent({kind:"upSubNetwork",event:e})})}},handleKeyDown:function(t,e){Be.isCtrlDown(e)&&65==e.keyCode?(t.isKeyboardSelectEnabled()&&t.selectAll().size()>0&&t.fireInteractionEvent({kind:"selectAll"}),je.preventDefault(e)):46==e.keyCode?(t.isKeyboardRemoveEnabled()&&t.removeSelection()&&t.fireInteractionEvent({
kind:"removeElement"}),je.preventDefault(e)):Be.showVersion(e)},handleLongClicked:function(t,e,i){if(He.isTouchable||0===e.button)if(i){var n=Mi(i);n&&n.onLongClick&&n.onLongClick(i,t),t.onLongClickElement(i,e),t.fireInteractionEvent({kind:"longClickElement",event:e,element:i})}else t.onLongClickBackground(e),t.fireInteractionEvent({kind:"longClickBackground",event:e})}},Mi=function(t){if(t&&t._image){if("object"==typeof t._image)return t._image;var e=Be.getImageAsset(t._image);if(e)return e._image}return null};Be.interaction=Li;var Pi=function(t){return t.trim()[0].match(/[mlhvcsqta]/i)?Ni(t):Ii(t)},ki={},Ii=function(t){var e=ki[t];return e?e:(ki[t]=e=[],t.trim().split(" ").forEach(function(t){t=t.split(","),e.push(2===t.length?{x:parseFloat(t[0]),y:parseFloat(t[1])}:t[0])}),e)},Ri={},Di=/[mlhvcsqtaz][\d.,\-\s]*/gi,Bi=/-?(\d)+(\.(\d)+)?/g,Ni=function(t){var e,i=Ri[t];return i?i:(e=t.trim().match(Di),Ri[t]=i=[],e&&e.forEach(function(t){var e,n=t[0],s=t.match(Bi),r=s&&s.length;if(i.push(t={c:n}),r)switch(s.forEach(function(t,e){s[e]=parseFloat(t)}),n){case"M":case"m":case"L":case"l":for(e=0;r>e;e+=2)0!==e&&i.push(t={c:"M"===n||"L"===n?"L":"l"}),t.x=s[e],t.y=s[e+1];break;case"H":case"h":for(e=0;r>e;e++)0!==e&&i.push(t={c:n}),t.x=s[e];break;case"V":case"v":for(e=0;r>e;e++)0!==e&&i.push(t={c:n}),t.y=s[e];break;case"C":case"c":for(e=0;r>e;e+=6)0!==e&&i.push(t={c:n}),t.x1=s[e],t.y1=s[e+1],t.x2=s[e+2],t.y2=s[e+3],t.x=s[e+4],t.y=s[e+5];break;case"S":case"s":for(e=0;r>e;e+=4)0!==e&&i.push(t={c:n}),t.x2=s[e],t.y2=s[e+1],t.x=s[e+2],t.y=s[e+3];break;case"Q":case"q":for(e=0;r>e;e+=4)0!==e&&i.push(t={c:n}),t.x1=s[e],t.y1=s[e+1],t.x=s[e+2],t.y=s[e+3];break;case"T":case"t":for(e=0;r>e;e+=2)0!==e&&i.push(t={c:n}),t.x=s[e],t.y=s[e+1]}}),i)},zi=function(t,e){var i,n,s,r,a,o,h,l,c,u,d,f,g=t.transform&&Oi(t.transform);return g&&g.length&&(i=Xe.identity(),g.forEach(function(t){var e=t[0];"matrix"===e?i.multiply(new Xe(t[1],t[2],t[3],t[4],t[5],t[6])):"translate"===e?i.translate(t[1]||0,t[2]||0):"scale"===e?i.scale(t[1]||1,t[2]||t[1]||1):"rotate"===e?i.rotate(t[1]||0,t[2]||0,t[3]||0):"skewX"===e?i.skew(t[1]||0,0):"skewY"===e&&i.skew(0,t[1]||0)})),"linear"===t.type?(r=t.x1||0,a=t.y1||0,o=t.x2||0,h=t.y2||0,i&&(n=i.transform(r,a),r=n.x,a=n.y,n=i.transform(o,h),o=n.x,h=n.y),s=e.createLinearGradient(r,a,o,h)):"radial"===t.type&&(l=t.fx||0,c=t.fy||0,u=t.cx||0,d=t.cy||0,f=t.r||0,null==t.fx&&(l=u),null==t.fy&&(c=d),s=e.createRadialGradient(l,c,0,u,d,f)),s&&t.stop&&t.stop.length&&t.stop.forEach(function(t){s.addColorStop(parseFloat(t.offset),An(t.color,e._color))}),s},Oi=function(t){return t.replace(/[\s\r\t\n]+/gm," ").trim().replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/).map(function(t){return t.replace(")","").trim().split(/\s*\(\s*|\s+,?\s*|,\s*/).map(function(t,e){return 0===e?t:parseFloat(t)})})},Fi=function(t,e,i,n,s,r,a){var o,h,l,c,u=1;"object"!=typeof e&&(h=e,o=Be.images[e],e=o&&o.getImage()),nn(e)?t.drawImage(o?o.getImage(i,n.width,n.height):e,n.x,n.y,n.width,n.height):e&&"object"==typeof e&&(t._data=s,t._view=r,h?(l=n.width/(e.w&&Ki(s,e,e,"w")||s.getWidth()),c=n.height/(e.h&&Ki(s,e,e,"h")||s.getHeight()),r&&(u=r.getSizeZoom?r.getSizeZoom()*r.getGraphicsZoom():r.getZoom()),!o._cache||Math.max(l*u,c*u)>1?Vi(t,e,i,n,s,r,a):t.drawImage(i?o.getImage(i,n.width,n.height):o._cache,n.x,n.y,n.width,n.height)):Vi(t,e,i,n,s,r,a),t._data=null,t._view=null)},Vi=function(t,e,i,n,s,r,a){var o,h,l,c,u,d,f,g,_,p,v,m,y,A,x,w,b,S,C,T=s&&s.getStyle("image.state");if(_=t._vector,w=t._color,p=t._fill,v=t._pattern,m=t._lineWidth,y=t._alpha,A=t._sx,x=t._sy,d=e,Ki(s,d,d,"visible",r)!==!1){for(t._color=i,o=Ki(s,d,d,"v",r),h=o&&o.length,S=d.w&&Ki(s,d,d,"w")||s.getWidth(),C=d.h&&Ki(s,d,d,"h")||s.getHeight(),f=n.width/S,g=n.height/C,a===!0?(t._fill=null,t._pattern=null,t._lineWidth=null,t._alpha=null):(t._sx=f,t._sy=g),t.save(),t.translate(n.x+n.width/2,n.y+n.height/2),(1!==f||1!==g)&&t.scale(f,g),d.origin&&t.translate((d.origin.x-.5)*S,(d.origin.y-.5)*C),t._vector=d,d.clip&&(t.beginPath(),d.clip===!0?t.rect(-(d.origin?d.origin.x:.5)*S,-(d.origin?d.origin.y:.5)*C,S,C):d.clip.length?d.clip.forEach(function(e){t.drawShape(e)}):t.drawShape(d.clip),t.clip()),Gi(s,d,d,t,r),l=0,h=o.length;h>l;l++)u=o[l],t._shapeData=u,r&&(r._shapeDataIndex=l,u.animate&&we(u,d,s,r)),b=Ki(s,d,u,"state",r),Ki(s,d,u,"visible",r)===!1||b&&!(Array.isArray(b)?b.indexOf(T)>=0:b===T)||(c=Hi[u.shape],c&&(t.save(),"vector"===u.shape||"g"===u.shape?c(t,u,s,r):Gi(s,d,u,t,r,function(){c(t,u,s,r)}),t.restore())),r&&(r._shapeDataIndex=null),t._shapeData=null;t.restore(),t._vector=_,t._shapeData=null,t._color=w,t._fill=p,t._pattern=v,t._lineWidth=m,t._alpha=y,t._sx=A,t._sy=x}},Ui=function(t,e,i,n,s){var r,a,o,h,l,c,u,d,f,g=t._vector,_=g.origin,p=g.w&&Ki(n,g,g,"w")||n.getWidth(),v=g.h&&Ki(n,g,g,"h")||n.getHeight();if("string"==typeof e?(f=Be.images[e],f&&(o=f.getWidth(),h=f.getHeight())):(o=e.w&&Ki(n,e,e,"w"),h=e.h&&Ki(n,e,e,"h")),o&&h&&i)for(l=i.w/o*t._sx,c=i.h/h*t._sy,r=i.x-p/2*(t._sx-1),a=i.y-v/2*(t._sy-1),_&&(r-=(_.x-.5)*p*(t._sx-1),a-=(_.y-.5)*v*(t._sy-1)),(1!==t._sx||1!==t._sy)&&(t.scale(1/t._sx,1/t._sy),r+=((_?_.x:.5)*p+i.x)*(t._sx-1),a+=((_?_.x:.5)*v+i.y)*(t._sy-1)),i={x:0,y:0,width:o,height:h},u=0;l>u;u++)for(d=0;c>d;d++)i.x=u*o+r,i.y=d*h+a,Fi(t,e,null,i,n,s,!0)},Hi={line:function(t,e,i,n){var s,r,a,o,h=Ki(i,t._vector,e,"p1",n),l=Ki(i,t._vector,e,"p2",n);h?(s=Qi(h.length?h[0]:h.x,t),r=Ji(h.length?h[1]:h.y,t)):(s=Ki(i,t._vector,e,"x1",n,!0),r=Ki(i,t._vector,e,"y1",n,!1)),l?(a=Qi(l.length?l[0]:l.x,t),o=Ji(l.length?l[1]:l.y,t)):(a=Ki(i,t._vector,e,"x2",n,!0),o=Ki(i,t._vector,e,"y2",n,!1)),t.moveTo(s,r),t.lineTo(a,o)},rect:function(t,e,i,n){var s,r,a,o,h=Ki(i,t._vector,e,"rect",n),l=Ki(i,t._vector,e,"r",n);h?(Array.isArray(h)?(s=h[0],r=h[1],a=h[2],o=h[3]):(s=h.x,r=h.y,a=h.w,o=h.h),s=Qi(s,t),r=Ji(r,t),a=Qi(a,t),o=Ji(o,t)):(s=Ki(i,t._vector,e,"x",n,!0),r=Ki(i,t._vector,e,"y",n,!1),a=Ki(i,t._vector,e,"w",n,!0),o=Ki(i,t._vector,e,"h",n,!1)),t.drawRoundRect(s,r,a,o,l),(t._gradientFunc||t._pattern)&&(t._rect={x:s,y:r,w:a,h:o})},circle:function(t,e,i,n){var s=Ki(i,t._vector,e,"cx",n,!0),r=Ki(i,t._vector,e,"cy",n,!1),a=t._vector.w&&Ki(i,t._vector,t._vector,"w")||i.getWidth(),o=t._vector.h&&Ki(i,t._vector,t._vector,"h")||i.getHeight(),h=$i(Ki(i,t._vector,e,"r",n),Math.min(a,o),e,t._vector),l=Ki(i,t._vector,e,"startAngle",n),c=Ki(i,t._vector,e,"endAngle",n),u=Ki(i,t._vector,e,"anticlockwise",n),d=Ki(i,t._vector,e,"close",n);null==l&&(l=0),null==c&&(c=360),null==u&&(u=!1),d&&t.moveTo(s,r),t.arc(s,r,h,l/180*Math.PI,c/180*Math.PI,u),d&&t.closePath(),(t._gradientFunc||t._pattern)&&(t._rect={x:s-h,y:r-h,w:2*h,h:2*h})},ellipse:function(t,e,i,n){var s=Ki(i,t._vector,e,"cx",n,!0),r=Ki(i,t._vector,e,"cy",n,!1),a=Ki(i,t._vector,e,"rx",n,!0),o=Ki(i,t._vector,e,"ry",n,!1),h=Ki(i,t._vector,e,"startAngle",n),l=Ki(i,t._vector,e,"endAngle",n),c=Ki(i,t._vector,e,"anticlockwise",n),u=Ki(i,t._vector,e,"close",n);null==h&&(h=0),null==l&&(l=360),null==c&&(c=!1),u&&t.moveTo(s,r),t.ellipse(s,r,a,o,0,h/180*Math.PI,l/180*Math.PI,c),u&&t.closePath(),(t._gradientFunc||t._pattern)&&(t._rect={x:s-a,y:r-o,w:2*a,h:2*o})},path:function(t,e,i,n){var s=Ki(i,t._vector,e,"data",n);t.drawPath(s)},text:function(t,e,i,n){var s=Ki(i,t._vector,e,"text",n),r=Ki(i,t._vector,e,"x",n,!0),a=Ki(i,t._vector,e,"y",n,!1),o=Ki(i,t._vector,e,"w",n,!0);if(null!=s){s=String(s);var h=s.split("\n"),l=2*t.measureText("e").width,c=xe(t,s,o);a-=(c.h/l-1)/2*l,h.forEach(function(e){if(o){var i,n,s,h,c,u=e.split(" "),d=u.length,f="";for(s=0;d>s;s++)if(i=u[s]+(s===d-1?"":" "),n=f+i,h=t.measureText(n).width,o>h)f=n;else if(h==o)t.fillText(f,r,a),f="",a+=l;else{for(c=0;c<i.length;c++)if(n=f+i.substr(0,c+1),t.measureText(n).width>o){t.fillText(n.substring(0,n.length-1),r,a),f=i.substring(c,i.length),a+=l;break}for(;f.length>0&&t.measureText(f).width>o;)for(c=0;c<f.length;c++)if(n=f.substr(0,c+1),t.measureText(n).width>o){t.fillText(f.substr(0,c),r,a),f=f.substring(c,f.length),a+=l;break}}t.fillText(f,r,a)}else t.fillText(e,r,a);a+=l})}},draw:function(t,e,i,n){var s,r,a=e.draw;"string"==typeof a&&((s=a.match(ji))?(r="with(data) { "+s[1]+" }",a=De.Util.newFunction("g","data","view",r)):a=sn[a]),"function"==typeof a&&a.call(t._vector,t,i,n)},vector:function(t,e,i,n){var s,r,a,o,h,l,c,u,d,f,g,_,p,v=t._vector,m=Ki(i,v,e,"name",n),y=Ki(i,v,e,"x",n,!0),A=Ki(i,v,e,"y",n,!1),x=Ki(i,v,e,"w",n),w=Ki(i,v,e,"h",n);if("string"==typeof m?(u=Be.images[m],c=u&&u._image):c=m,c)if(nn(c))null!=x&&null!=w?t.drawImage(c,y,A,Qi(x,t),Ji(w,t)):t.drawImage(c,y,A);else{for(d=Ki(i,c,c,"v",n),f=d&&d.length,g=c.w&&Ki(i,c,c,"w"),_=c.h&&Ki(i,c,c,"h"),null!=x&&null!=w?(x=Qi(x,t),w=Ji(w,t)):(x=g,w=_),t.save(),o=t._lineWidth,h=t._fill,l=t._alpha,Gi(i,c,c,t,n),Gi(i,v,e,t,n),t.translate(y,A),t.scale(x/g,w/_),c.origin&&t.translate((c.origin.x-.5)*g,(c.origin.y-.5)*_),c.clip&&(t.beginPath(),c.clip===!0?t.rect(-(c.origin?c.origin.x:.5)*g,-(c.origin?c.origin.y:.5)*_,g,_):c.clip.length?c.clip.forEach(function(e){t.drawShape(e)}):t.drawShape(c.clip),t.clip()),p=t._shapeData,t._vector=c,s=0;f>s;s++)r=d[s],t._shapeData=r,n&&(n._shapeDataIndex.length?n._shapeDataIndex.push(s):n._shapeDataIndex=[n._shapeDataIndex,s],r.animate&&we(r,v,i,n)),Ki(i,c,r,"visible",n)!==!1&&(a=Hi[r.shape],a&&(t.save(),"vector"===r.shape||"g"===r.shape?a(t,r,i,n):Gi(i,c,r,t,n,function(){a(t,r,i,n)}),t.restore())),n&&n._shapeDataIndex.pop();t._vector=v,t._shapeData=p,t._lineWidth=o,t._fill=h,t._alpha=l,t.restore()}},g:function(t,e,i,n){var s,r,a,o,h,l=Ki(i,t._vector,e,"v",n);l&&l.length&&(t.save(),r=t._lineWidth,a=t._fill,o=t._alpha,h=t._shapeData,Gi(i,t._vector,e,t,n),l.forEach(function(e){Ki(i,t._vector,e,"visible",n)!==!1&&(s=Hi[e.shape],s&&(t.save(),t._shapeData=e,"vector"===e.shape||"g"===e.shape?s(t,e,i,n):Gi(i,t._vector,e,t,n,function(){s(t,e,i,n)}),t.restore()))}),t._lineWidth=r,t._fill=a,t._alpha=o,t._shapeData=h,t.restore())}};Hi.image=Hi.vector;var Wi=Object.keys(Hi),Xi={M:function(t,e){return t.moveTo(e.x,e.y),t._path_start=e,t._rect&&en(t._rect,e.x,e.y),e},m:function(t,e,i){return i&&(e={x:i.x+e.x,y:i.y+e.y}),t.moveTo(e.x,e.y),t._path_start=e,t._rect&&en(t._rect,e.x,e.y),e},Z:function(t){return t.closePath(),t._path_start},z:function(t){return t.closePath(),t._path_start},L:function(t,e){return t.lineTo(e.x,e.y),t._rect&&en(t._rect,e.x,e.y),e},l:function(t,e,i){var n={x:i.x+e.x,y:i.y+e.y};return t.lineTo(n.x,n.y),t._rect&&en(t._rect,n.x,n.y),n},H:function(t,e,i){var n={x:e.x,y:i.y};return t.lineTo(n.x,n.y),t._rect&&en(t._rect,n.x,n.y),n},h:function(t,e,i){var n={x:i.x+e.x,y:i.y};return t.lineTo(n.x,n.y),t._rect&&en(t._rect,n.x,n.y),n},V:function(t,e,i){var n={x:i.x,y:e.y};return t.lineTo(n.x,n.y),t._rect&&en(t._rect,n.x,n.y),n},v:function(t,e,i){var n={x:i.x,y:i.y+e.y};return t.lineTo(n.x,n.y),t._rect&&en(t._rect,n.x,n.y),n},Q:function(t,e){return t._preQ_x=e.x1,t._preQ_y=e.y1,t.quadraticCurveTo(e.x1,e.y1,e.x,e.y),t._rect&&(en(t._rect,e.x1,e.y1),en(t._rect,e.x,e.y)),e},q:function(t,e,i){var n={x:i.x+e.x,y:i.y+e.y},s=t._preQ_x=i.x+e.x1,r=t._preQ_y=i.y+e.y1;return t.quadraticCurveTo(s,r,n.x,n.y),t._rect&&(en(t._rect,s,r),en(t._rect,n.x,n.y)),n},T:function(t,e,i){var n=t._preQ_x=2*i.x-t._preQ_x,s=t._preQ_y=2*i.y-t._preQ_y;return t.quadraticCurveTo(n,s,e.x,e.y),t._rect&&(en(t._rect,n,s),en(t._rect,e.x,e.y)),e},t:function(t,e,i){var n={x:i.x+e.x,y:i.y+e.y},s=t._preQ_x=2*i.x-t._preQ_x,r=t._preQ_y=2*i.y-t._preQ_y;return t.quadraticCurveTo(s,r,n.x,n.y),t._rect&&(en(t._rect,s,r),en(t._rect,n.x,n.y)),n},C:function(t,e){return t._preC_x=e.x2,t._preC_y=e.y2,t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y),t._rect&&(en(t._rect,e.x1,e.y1),en(t._rect,e.x2,e.y2),en(t._rect,e.x,e.y)),e},c:function(t,e,i){var n={x:i.x+e.x,y:i.y+e.y},s=i.x+e.x1,r=i.y+e.y1,a=t._preC_x=i.x+e.x2,o=t._preC_y=i.y+e.y2;return t.bezierCurveTo(s,r,a,o,n.x,n.y),t._rect&&(en(t._rect,s,r),en(t._rect,a,o),en(t._rect,n.x,n.y)),n},S:function(t,e,i){var n=2*i.x-t._preC_x,s=2*i.y-t._preC_y;return t._preC_x=e.x2,t._preC_y=e.y2,t.bezierCurveTo(n,s,e.x2,e.y2,e.x,e.y),t._rect&&(en(t._rect,n,s),en(t._rect,e.x2,e.y2),en(t._rect,e.x,e.y)),e},s:function(t,e,i){var n={x:i.x+e.x,y:i.y+e.y},s=2*i.x-t._preC_x,r=2*i.y-t._preC_y,a=t._preC_x=i.x+e.x2,o=t._preC_y=i.y+e.y2;return t.bezierCurveTo(s,r,a,o,n.x,n.y),t._rect&&(en(t._rect,s,r),en(t._rect,a,o),en(t._rect,n.x,n.y)),n}},Gi=function(t,e,i,n,s,r){var a,o,h,l,c,u,d,f,g,_,p,v,m,y=Ki(t,e,i,"line",s),A=Ki(t,e,i,"fill",s),x=Ki(t,e,i,"fillRule",s)||"nonzero",w=Ki(t,e,i,"gradient",s),b=Ki(t,e,i,"gradientColor",s),S=Ki(t,e,i,"pattern",s),C=Ki(t,e,i,"font",s),T=Ki(t,e,i,"textAlign",s)||"center",E=Ki(t,e,i,"textBaseline",s)||"middle",L=Ki(t,e,i,"translate",s),M=Ki(t,e,i,"rotate",s),P=Ki(t,e,i,"rotateOrigin",s),k=Ki(t,e,i,"scale",s),I=Ki(t,e,i,"transform",s),R=Ki(t,e,i,"alpha",s),D=n._lineWidth,B=n._fill,N=n._pattern,z=n._alpha,O=n._gradientFunc;if(y?(a=y.color,o=y.width,h=y.cap,l=y.join,c=y.miterLimit,u=y.dash,d=y.dashOffset):(a=Ki(t,e,i,"lineColor",s),o=Ki(t,e,i,"lineWidth",s),h=Ki(t,e,i,"lineCap",s),l=Ki(t,e,i,"lineJoin",s),c=Ki(t,e,i,"miterLimit",s),u=Ki(t,e,i,"lineDash",s),d=Ki(t,e,i,"lineDashOffset",s)),null!=a&&(n.strokeStyle=An(a,n._color)),null!=o&&(n.lineWidth=n._lineWidth=s&&s.getSizeZoom&&!s.zoomManager.sizeChange?o/s.getSizeZoom():o),null!=h&&(n.lineCap=h),null!=l&&(n.lineJoin=l),null!=c&&(n.miterLimit=c),null!=u&&(n.lineDash=u,n.setLineDash(u)),null!=d&&(n.lineDashOffset=d),S?n._pattern=S:(A&&(n.fillStyle=n._fill=An(A,n._color)),w&&("string"==typeof w?g=Ke[w]:(g=Ke[w.type],w.color&&(b=w.color),g||(w=zi(w,n))),n._gradientFunc=g)),null!=C&&(n.font=C),null!=T&&(n.textAlign=T),null!=E&&(n.textBaseline=E),Zi(t,e,i,n,s),null!=I)"string"==typeof I&&(I=Oi(I)),I.length&&I.forEach(function(t){var e=t[0];"matrix"===e?n.transform(t[1],t[2],t[3],t[4],t[5],t[6]):"translate"===e?n.translate(t[1]||0,t[2]||0):"scale"===e?n.scale(t[1]||1,t[2]||t[1]||1):"rotate"===e?t.length>2?(n.translate(t[2],t[3]),n.rotate(t[1]),n.translate(-t[2],-t[3])):n.rotate(t[1]):"skewX"===e?n.transform(1,0,Math.tan(t[1]*Math.PI/180),1,0,0):"skewY"===e&&n.transform(1,Math.tan(t[1]*Math.PI/180),0,1,0,0)});else{if(null!=L&&(Array.isArray(L)?(v=L[0],m=L[1]):"object"==typeof L?(v=L.x,m=L.y):(v=L,m=0),v=Qi(v,n),m=Ji(m,n),(0!==v||0!==m)&&n.translate(v,m)),null!=M&&M%360!==0){var F,V;P&&(Array.isArray(P)?(F=P[0],V=P[1]):"object"==typeof P?(F=P.x,V=P.y):F=V=P,F=Qi(F,n),V=Ji(V,n),(0!==F||0!==V)&&n.translate(F,V)),n.rotate(M*Math.PI/180),P&&(0!==F||0!==V)&&n.translate(-F,-V)}null!=k&&(Array.isArray(k)?(_=k[0],p=k[1]):"object"==typeof k?(_=k.x,p=k.y):_=p=k,(1!==_||1!==p)&&n.scale(_,p))}null!=R&&(n.globalAlpha=n._alpha=null!=z?z*R:R),r&&(n.beginPath(),r(),f=n._rect||i.rect,n._pattern?(n._lineWidth>0&&n.stroke(),n.clip(),Ui(n,n._pattern,f,t,s)):(g&&f&&(w=g(n,An(A||"#000000",n._color),An(b||"#FFFFFF",n._color),f.x,f.y,f.w,f.h)),w&&(n.fillStyle=n._fill=w),n._fill&&n.fill(x),n._lineWidth>0&&n.stroke()),n._lineWidth=D,n._fill=B,n._pattern=N,n._alpha=z,n._gradientFunc=O,n._rect=null)},Zi=function(t,e,i,n,s){var r,a,o,h,l=Ki(t,e,i,"shadow",s);l?(r=l.offsetX,a=l.offsetY,o=l.blur,h=l.color):(r=Ki(t,e,i,"shadowOffsetX",s),a=Ki(t,e,i,"shadowOffsetY",s),o=Ki(t,e,i,"shadowBlur",s),h=Ki(t,e,i,"shadowColor",s)),null!=r&&(n.shadowOffsetX=r),null!=a&&(n.shadowOffsetY=a),null!=o&&(n.shadowBlur=o),null!=h&&(n.shadowColor=h)},Yi=/<%=([\s\S]+?)%>/,ji=/<%([\s\S]+?)%>/,qi=new RegExp([Yi.source,ji.source].join("|")),Ki=function(t,i,n,s,r,a,o){var h,l,c,u,d,f=n[s],g=typeof f;if("string"===g&&(h=f.match(qi))?(l="with(data) { "+(h[1]?"return "+h[1]:h[2])+" }",c=De.Util.newFunction("data","view",l),f=c.call(i,t,r)):"function"===g&&(f=f.call(i,t,r)),a===!0?(u=i.w&&Ki(t,i,i,"w")||t.getWidth(),(n.rel===!0||n.rel===e&&i.rel)&&1>=f&&f>=-1?f*=u:"string"==typeof f&&(f=parseInt(f)/100*u),f=f||0):a===!1&&(d=i.h&&Ki(t,i,i,"h")||t.getHeight(),(n.rel===!0||n.rel===e&&i.rel)&&1>=f&&f>=-1?f*=d:"string"==typeof f&&(f=parseInt(f)/100*d),f=f||0),o!==!1&&r&&t&&n.animate&&t._animates){var _,p=t._animates,v=r._shapeDataIndex;if(v.length)for(var m=0;m<v.length;m++)_=v[m],p=p[_];else _=v;var y=p[_],A=y[s];if(A)if(Array.isArray(A))for(var m=A.length-1;m>=0;m--){var x=A[m];if((x.stopped||x.time>0)&&x.started)return Re(x,f)}else if(A.started)return Re(A,f)}return f},Qi=function(t,i){if(!t)return 0;var n=i._vector.w&&Ki(i._data,i._vector,i._vector,"w")||i._data.getWidth();return(i._shapeData&&i._shapeData.rel===!0||(!i._shapeData||i._shapeData.rel===e)&&i._vector.rel)&&1>=t&&t>=-1?t*n:"string"==typeof t?parseInt(t)/100*n:t},Ji=function(t,i){if(!t)return 0;var n=i._vector.h&&Ki(i._data,i._vector,i._vector,"h")||i._data.getHeight();return(i._shapeData&&i._shapeData.rel===!0||(!i._shapeData||i._shapeData.rel===e)&&i._vector.rel)&&1>=t&&t>=-1?t*n:"string"==typeof t?parseInt(t)/100*n:t},$i=function(t,i,n,s){return t?(n.rel===!0||n.rel===e&&s.rel)&&1>=t&&t>=-1?t*i:"string"==typeof t?parseInt(t)/100*i:t:0},tn=(t.CanvasRenderingContext2D||ze.Context2d).prototype;tn.drawShape=function(t){var e=this,i=e._vector,n=e._shapeData,s=e._data,r=e._view,a=Hi[t.shape];a&&(e.save(),e._shapeData=t,"vector"===t.shape||"g"===t.shape?a(e,t,s,r):Gi(s,i,t,e,r,function(){a(e,t,s,r)}),e._shapeData=n,e.restore())},tn.drawPath=function(t){var e,i,n,s,r,a,o,h,l,c,u,d,f=this;if("string"==typeof t&&(t=Pi(t)),l=t?t.length:0,!(1>=l)){if((f._gradientFunc||f._pattern)&&(f._rect=c={x:0,y:0,w:0,h:0}),e=t&&t[0]&&t[0].c,e||(i=t&&t[0]&&null!=t[0].x,n="z"===t[l-1]||"Z"===t[l-1],n&&l--),e){for(s=0;l>s;s++)a=t[s],o=Xi[a.c],o&&(r=o(f,a,r));f._path_start=null,f._preC_x=null,f._preC_y=null,f._preQ_x=null,f._preQ_y=null}else if(i){for(h=t[0],u=Qi(h.x,f),d=Ji(h.y,f),f.moveTo(u,d),c&&en(c,u,d),s=1;l>s;s++)h=t[s],u=Qi(h.x,f),d=Ji(h.y,f),f.lineTo(u,d),c&&en(c,u,d);n&&f.closePath()}else{for(u=Qi(t[0],f),d=Ji(t[1],f),f.moveTo(u,d),c&&en(c,u,d),s=2;l>s;s+=2)u=Qi(t[s],f),d=Ji(t[s+1],f),f.lineTo(u,d),c&&en(c,u,d);n&&f.closePath()}return t}};var en=function(t,e,i){var n=Math.min(t.x,e),s=Math.max(t.x+t.w,e),r=Math.min(t.y,i),a=Math.max(t.y+t.h,i);t.x=n,t.y=r,t.w=s-n,t.h=a-r};tn._fillPath=function(t,e){var i=this;i.beginPath(),i.fillStyle=t,i.drawPath(e),i.fill()},tn._fillRect=function(t,e,i,n,s){var r=this;r.beginPath(),r.fillStyle=t,r.rect(e,i,n,s),r.fill()},tn.ellipse||(tn.ellipse=function(t,e,i,n){var s=this,r=.5522848,a=i*r,o=n*r,h=t+i,l=e+n,c=t-i,u=e-n;s.moveTo(c,e),s.bezierCurveTo(c,e-o,t-a,u,t,u),s.bezierCurveTo(t+a,u,h,e-o,h,e),s.bezierCurveTo(h,e+o,t+a,l,t,l),s.bezierCurveTo(t-a,l,c,e+o,c,e)}),tn.drawRoundRect=function(t,e,i,n,s){var r=this;if(!s)return void r.rect(t,e,i,n);var a,o,h,l;if(Array.isArray(s))if(1===s.length)a=o=h=l=s[0];else if(2===s.length)a=o=s[0],h=l=s[1];else{if(4!==s.length)return void r.rect(t,e,i,n);a=s[0],o=s[1],h=s[2],l=s[3]}else a=o=h=l=s;var c=t+i,u=e+n,d=n>i?2*i:2*n;a=d>a?a:d,o=d>o?o:d,h=d>h?h:d,l=d>l?l:d;var f=.292893218813453*l,g=.585786437626905*l;r.moveTo(c,u-l),r.quadraticCurveTo(c,u-g,c-f,u-f),r.quadraticCurveTo(c-g,u,c-l,u),f=.292893218813453*h,g=.585786437626905*h,r.lineTo(t+h,u),r.quadraticCurveTo(t+g,u,t+f,u-f),r.quadraticCurveTo(t,u-g,t,u-h),f=.292893218813453*a,g=.585786437626905*a,r.lineTo(t,e+a),r.quadraticCurveTo(t,e+g,t+f,e+f),r.quadraticCurveTo(t+g,e,t+a,e),f=.292893218813453*o,g=.585786437626905*o,r.lineTo(c-o,e),r.quadraticCurveTo(c-g,e,c-f,e+f),r.quadraticCurveTo(c,e+g,c,e+o),r.lineTo(c,u-l)};var nn=function(t){return ze?t instanceof ze||t instanceof Ue:t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement},sn={},rn=function(t,e){"function"==typeof e&&(sn[t]=e)},an=function(t,e){"function"==typeof e&&Wi.indexOf(t)<0&&(Hi[t]=e)};!function(){for(var e=["webkit","moz"],i=0;i<e.length&&!t.requestAnimationFrame;++i){var n=e[i];t.requestAnimationFrame=t[n+"RequestAnimationFrame"],t.cancelAnimationFrame=t[n+"CancelAnimationFrame"]||t[n+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(t.navigator.userAgent)||!t.requestAnimationFrame||!t.cancelAnimationFrame){var s=0;t.requestAnimationFrame=function(t){var e=Date.now(),i=Math.max(s+16,e);return setTimeout(function(){t(s=i)},i-e)},t.cancelAnimationFrame=clearTimeout}}();var on=De.Animate=function(t){var e=this;e.type=null==t.type?"number":t.type,e.delay=null==t.delay?0:t.delay,e.dur=null==t.dur?1e3:t.dur,e.interval=null==t.interval?0:t.interval,e.finish=null==t.finish?e.delay+e.dur+e.interval:t.finish,null==t.finish?e.finish=e.delay+e.dur+e.interval:(e.finish=t.finish,e.interval=e.finish-e.delay-e.dur),e.repeat=null==t.repeat?1:t.repeat,e.reverse=null==t.reverse||t.reverse,e.easing=null==t.easing?"easeNone":t.easing,e.onUpdate=t.onUpdate,e.onDone=t.onDone,e.onStop=t.onStop,e.onPlay=t.onPlay,e.attr=t.attr,e.source=t.source,e.filter=t.filter,e.from=t.from,e.to=t.to,e.start=null,e.time=0,e.total=0,e.count=0,e.started=!1,e.stopped=!1,e.paused=!1,e.pausedTime=null,e.pausedTotal=0,e._speed=1,e._oldSpeed=null,e._speedTotal=0,e._speedTime=null,e._percent=0,e._percentSet=null,e._percentDiff=0,e.id=ln++};Be.ext("twaver.Animate",Object,{play:function(){return Se(this)},stop:function(t){return Ce(this,t)},pause:function(){this.stopped||(this.paused=!0)},resume:function(){this.paused&&(this.paused=!1,cn=!0)},isPaused:function(){return this.paused},percent:function(t){return null==t?this._percentSet||this._percent:(this._percentSet=0>t?0:t>100?100:t,this.paused&&(cn=!0),this.started||(this.play(),this.pause()),this)},speed:function(t){return null==t?this._speed:(t=0>t?1:t,t!==this.speed&&(this.stopped||(this._oldSpeed=this._speed),this._speed=t),this)},clone:function(){return new on(this)},chain:function(t){var e,i=this;return i.next=t,t.pre=i,i.onDone?(e=i.onDone,i.onDone=function(){e.call(i),t.play()}):i.onDone=function(){t.play()},i}});var hn={},ln=1,cn=!1;!function Dr(t){requestAnimationFrame(Dr),cn&&(cn=!1,Me(t))}(0);var un={easeNone:function(t,e,i,n){return i*t/n+e},easeIn:function(t,e,i,n){return i*(t/=n)*t+e},easeOut:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeBoth:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInStrong:function(t,e,i,n){return i*(t/=n)*t*t*t+e},easeOutStrong:function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},easeBothStrong:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},elasticIn:function(t,e,i,n,s,r){var a;return 0===t?e:1===(t/=n)?e+i:(r||(r=.3*n),!s||s<Math.abs(i)?(s=i,a=r/4):a=r/(2*Math.PI)*Math.asin(i/s),-(s*Math.pow(2,10*(t-=1))*Math.sin(2*(t*n-a)*Math.PI/r))+e)},elasticOut:function(t,e,i,n,s,r){var a;return 0===t?e:1===(t/=n)?e+i:(r||(r=.3*n),!s||s<Math.abs(i)?(s=i,a=r/4):a=r/(2*Math.PI)*Math.asin(i/s),s*Math.pow(2,-10*t)*Math.sin(2*(t*n-a)*Math.PI/r)+i+e)},elasticBoth:function(t,e,i,n,s,r){var a;return 0===t?e:2===(t/=n/2)?e+i:(r||(r=.3*n*1.5),!s||s<Math.abs(i)?(s=i,a=r/4):a=r/(2*Math.PI)*Math.asin(i/s),1>t?-.5*s*Math.pow(2,10*(t-=1))*Math.sin(2*(t*n-a)*Math.PI/r)+e:s*Math.pow(2,-10*(t-=1))*Math.sin(2*(t*n-a)*Math.PI/r)*.5+i+e)},backIn:function(t,i,n,s,r){return r===e&&(r=1.70158),t===s&&(t-=.001),n*(t/=s)*t*((r+1)*t-r)+i},backOut:function(t,e,i,n,s){return"undefined"==typeof s&&(s=1.70158),i*((t=t/n-1)*t*((s+1)*t+s)+1)+e},backBoth:function(t,e,i,n,s){return"undefined"==typeof s&&(s=5.70158),(t/=n/2)<1?i/2*t*t*(((s*=1.525)+1)*t-s)+e:i/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+e},bounceIn:function(t,e,i,n){return i-un.bounceOut(n-t,0,i,n)+e},bounceOut:function(t,e,i,n){return(t/=n)<1/2.75?7.5625*i*t*t+e:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},bounceBoth:function(t,e,i,n){return n/2>t?.5*un.bounceIn(2*t,0,i,n)+e:.5*un.bounceOut(2*t-n,0,i,n)+.5*i+e}},dn={draw:function(t,e){var i=null==e.getCurrentSubNetwork()?e.getElementBox():e.getCurrentSubNetwork(),n=i.getStyle("background.type");"image"==n?this.drawImage(t,i,e):"vector"==n?this.drawVector(t,i):"image.vector"==n?(this.drawImage(t,i,e),this.drawVector(t,i)):"vector.image"==n&&(this.drawVector(t,i),this.drawImage(t,i,e))},drawImage:function(t,e,i){var n=e.getStyle("background.image"),s=Be.getImageAsset(n);if(null!=s){var r={x:0,y:0,width:t.canvas.width,height:t.canvas.height};"none"==e.getStyle("background.image.stretch")&&(r.width=s.getWidth(),r.height=s.getHeight());var a=e.getStyle("background.image.padding");if(a&&Ge.grow(r,a,a),"tile"==e.getStyle("background.image.stretch")){if(nn(s.getImage()))for(var o=0;o<r.width;o+=s.getWidth())for(var h=0;h<r.height;h+=s.getHeight())t.drawImage(s.getImage(),o,h)}else("fill"==e.getStyle("background.image.stretch")||"none"==e.getStyle("background.image.stretch"))&&Fi(t,s.getImage(),null,r,e,i)}},drawVector:function(t,e){var i={x:0,y:0,width:t.canvas.width,height:t.canvas.height},n=e.getStyle("background.outline.width"),s=(e.getStyle("background.outline.color"),e.getStyle("background.vector.fill")),r=e.getStyle("background.vector.fill.color"),a=e.getStyle("background.vector.padding"),o=e.getStyle("background.vector.shape"),h=e.getStyle("background.vector.pattern");a&&Ge.grow(i,a,a);var l=e.getStyle("background.vector.gradient");s&&(l?qe.fill(t,r,l,e.getStyle("background.vector.gradient.color"),i):t.fillStyle=r,qe.drawVector(t,o,h,i),t.fill()),n>0&&(t.lineWidth=n,t.strokeStyle=e.getStyle("background.outline.color"),qe.drawVector(t,o,h,i),t.stroke())}},fn=De.UndoManager=function(t){var e=this;e._list=[],e._cursor=-1,e._suspended=!1,e._dispatcher=new De.EventDispatcher,e._box=t,e._enabled=!1,e._limit=100};fn._IGNORE_PROPERTIES={alarmState:1,propagateSeverity:1,enablePropagation:1,children:1,fromAgent:1,toAgent:1,bundleLinks:1},Be.ext("twaver.UndoManager",Object,{setEnabled:function(t){var e=this,i=e._box;e._enabled!=t&&(t?(i.addDataBoxChangeListener(e._handleDataBoxChange,e,!0),i.addDataPropertyChangeListener(e._handleDataPropertyChange,e,!0)):(i.removeDataBoxChangeListener(e._handleDataBoxChange,e),i.removeDataPropertyChangeListener(e._handleDataPropertyChange,e))),e._enabled=t},isEnabled:function(){return this._enabled},undo:function(){var t,e,i,n=this,s=n._list;if(n.canUndo()){if(t=s[n._cursor--],n._suspended=!0,t.length)for(i=t.length,e=i-1;e>=0;e--)t[e].undo();else t.undo();n._suspended=!1,n._fire({kind:"undo",action:t})}},redo:function(){var t,e=this,i=e._list;e.canRedo()&&(t=i[++e._cursor],e._suspended=!0,t.length?t.forEach(function(t){t.redo()}):t.redo(),e._suspended=!1,e._fire({kind:"redo",action:t}))},canUndo:function(){return this._cursor>=0},canRedo:function(){return this._cursor<this._list.length-1},_add:function(t){var e=this,i=e._batch,n=e._list;i?i.push(t):(e._cursor!==n.length-1&&n.splice(e._cursor+1,n.length),0!==e._limit&&n.length===e._limit&&n.splice(0,1),n.push(t),e._cursor=n.length-1,e._fire({kind:"add",action:t}))},_handleDataBoxChange:function(t){if(!this._suspended){var e=this,i=e._box,n=t.kind,s=t.data;"add"===n?e._add({undo:function(){var t=this;t.parent=s.getParent(),t.host=s.getHost&&s.getHost(),s.getFromNode&&(t.fromNode=s.getFromNode(),t.toNode=s.getToNode()),i.remove(s)},redo:function(){var t=this;t.parent&&s.setParent(t.parent),s.getHost&&t.host&&s.setHost(t.host),s.getFromNode&&(t.fromNode&&s.setFromNode(t.fromNode),t.toNode&&s.setToNode(t.toNode)),i.add(s)}}):"remove"===n&&e._add({undo:function(){i.add(s)},redo:function(){i.remove(s)}})}},_handleDataPropertyChange:function(t){if(!this._suspended){var e=this,i=t.property,n=i.substr(0,2),s=t.source,r=t.oldValue,a=t.newValue;"C:"===n?(i=i.substr(2),e._add({undo:function(){s.setClient(i,r)},redo:function(){s.setClient(i,a)}})):"S:"===n?(i=i.substr(2),e._add({undo:function(){s.setStyle(i,r)},redo:function(){s.setStyle(i,a)}})):fn._IGNORE_PROPERTIES[i]||e._add({undo:function(){s[Be.setter(i)](r)},redo:function(){s[Be.setter(i)](a)}})}},size:function(){return this._list.length},getCursor:function(){return this._cursor},_fire:function(t){this._dispatcher.fire(t)},on:function(t,e,i){this._dispatcher.add(t,e,i)},off:function(t,e){this._dispatcher.remove(t,e)},isSuspended:function(){return this._suspended},setSuspended:function(t){this._suspended=t},getLimit:function(){return this._limit},setLimit:function(t){var e,i,n=this,s=n._list;return 0>t&&(t=0),t!==n._limit&&(e=s.length-t,t>0&&e>0&&(i=n._cursor+1,n._cursor-=e,n._cursor<-1&&(n._cursor=-1),i>0&&s.splice(0,i),e-=i,e>0&&s.splice(s.length-e,e)),n._limit=t,n._fire({kind:"change"})),n},clear:function(){var t=this;return t._list=[],t._cursor=-1,t._fire({kind:"clear"}),t},batch:function(t,e){var i=this;return i.startBatch(),t.call(e),i.endBatch(),i},startBatch:function(){var t=this;return t._batch||(t._batch=[]),t},endBatch:function(){var t,e=this;return e._batch&&(t=e._batch,e._batch=null,t.length&&e._add(t)),e}}),De.Pool=function(t,e){this.func="string"==typeof t?function(){return Ve.createElement(t)}:t,this.tagName=t,null!=e&&(this.redundancy=e)},Be.ext("twaver.Pool",Object,{redundancy:2,currentIndex:-1,get:function(){if(this.currentIndex++,this.currentIndex===this.size()){var t=this.func();return t._pool=this,t.style.margin="0px",t.style.padding="0px",this.list||(this.list=new gn),this.list.add(t),t}return this.list.get(this.currentIndex)},release:function(t){this.list&&this.list.remove(t)>=0&&(delete t._selectData,delete t._expandData,delete t._checkData,delete t._editInfo,delete t.keepDefault,t.style.margin="0px",t.style.padding="0px",t.style.backgroundColor="",t.removeAttribute("title"),"img"===this.tagName&&t.removeAttribute&&(t.removeAttribute("width"),t.removeAttribute("height"),t.removeAttribute("src")),this.list.add(t),this.currentIndex--)},reset:function(){this.currentIndex=-1},clear:function(){if(this.list)for(;this.redundancy+this.currentIndex<this.list.size()-1;)delete this.list.removeAt(this.list.size()-1)._pool},size:function(){return this.list?this.list.size():0}});var gn=function(){if(this._as=[],1===arguments.length){var t=arguments[0];if(t instanceof gn&&(t=t._as),t instanceof Array)for(var e=t.length,i=0;e>i;i++)this._as.push(t[i]);else t===!1?(this._duplicatable=!1,this._map={}):null!=t&&this._as.push(t)}else if(arguments.length>1)for(e=arguments.length,i=0;e>i;i++)this._as.push(arguments[i])};De.List=gn,Be.ext("twaver.List",Object,{_duplicatable:!0,size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(t,i){if(!this._duplicatable){if(this._map[t._id])return;this._map[t._id]=!0}return i===e?this._as.push(t):this._as.splice(i,0,t)},addAll:function(t){if(t instanceof gn&&(t=t._as),t instanceof Array)for(var e=t.length,i=0;e>i;i++)this.add(t[i]);else this.add(t)},get:function(t){return this._as[t]},remove:function(t){if(!this._duplicatable&&!this._map[t&&t._id])return-1;var e=this._as.indexOf(t);return e>=0&&e<this._as.length&&this.removeAt(e),e},removeAt:function(t){var e=this._as.splice(t,1)[0];return!this._duplicatable&&e&&delete this._map[e._id],e},set:function(t,e){var i=this._as[t];if(i===e)return e;if(!this._duplicatable){if(this._map[e._id])throw"duplicate item:"+e;delete this._map[i._id],this._map[e._id]=!0}return this._as[t]=e,i},clear:function(){return this._duplicatable||(this._map={}),this._as.splice(0,this._as.length)},contains:function(t){return this._duplicatable?this.indexOf(t)>=0:!!this._map[t&&t._id]},indexOf:function(t){return this._as.indexOf(t)},forEach:function(t,e){for(var i=this._as.length,n=0;i>n;n++){var s=this._as[n];e?t.call(e,s):t(s)}},forEachReverse:function(t,e){for(var i=this._as.length,n=i-1;n>=0;n--){var s=this._as[n];e?t.call(e,s):t(s)}},toArray:function(t,e){if(t){for(var i=[],n=this._as.length,s=0;n>s;s++){var r=this._as[s];e?t.call(e,r)&&i.push(r):t(r)&&i.push(r)}return i}return this._as.concat()},toList:function(t,e){if(t){for(var i=new gn,n=this._as.length,s=0;n>s;s++){var r=this._as[s];e?t.call(e,r)&&i.add(r):t(r)&&i.add(r)}return i}return new gn(this)},sort:function(t){return t?this._as.sort(t):this._as.sort(),this},toString:function(){return this._as.toString()}});var _n={shapeMap:{},init:function(){_n.register("arrow.standard",_n.createStandardArrow()),_n.register("arrow.delta",_n.createDeltaArrow()),_n.register("arrow.diamond",_n.createDiamondArrow()),_n.register("arrow.short",_n.createShortArrow()),
_n.register("arrow.slant",_n.createSlantArrow()),_n.register("arrow.doubledelta",_n.createDoubleDeltaArrow()),_n.register("arrow.tee",_n.createTeeArrow()),_n.register("arrow.box",_n.createBoxArrow()),_n.register("arrow.dot",_n.createDotArrow()),_n.register("arrow.tail",_n.createTailArrow())},createStandardArrow:function(){var t=new gn;return t.add({x:-1,y:-5/9}),t.add({x:-.75,y:0}),t.add({x:-1,y:5/9}),t.add({x:0,y:0}),t.add({x:-1,y:-5/9}),{points:t}},createDeltaArrow:function(){var t=new gn;return t.add({x:-1,y:-5/9}),t.add({x:-1,y:5/9}),t.add({x:0,y:0}),t.add({x:-1,y:-5/9}),{points:t}},createDoubleDeltaArrow:function(){var t=new gn;return t.add({x:-1,y:-5/9}),t.add({x:-1,y:5/9}),t.add({x:-.5,y:0}),t.add({x:-.5,y:-5/9}),t.add({x:0,y:0}),t.add({x:-.5,y:5/9}),t.add({x:-.5,y:0}),t.add({x:-1,y:-5/9}),{points:t}},createTeeArrow:function(){var t=new gn;return t.add({x:-1/9,y:-5/9}),t.add({x:-1/9,y:5/9}),t.add({x:0,y:5/9}),t.add({x:0,y:-5/9}),t.add({x:-1/9,y:-5/9}),{points:t}},createBoxArrow:function(){var t=new gn;return t.add({x:-10/9,y:-5/9}),t.add({x:-10/9,y:5/9}),t.add({x:0,y:5/9}),t.add({x:0,y:-5/9}),t.add({x:-10/9,y:-5/9}),{points:t}},createDotArrow:function(){var t={},e=new De.List;return e.add({x:-.5,y:0}),t.points=e,t.draw=function(t,e){if(t&&e&&e.points&&!(e.points.size()<=0)){var i=e.points._as,n=i[0],s=Math.min(e.width,e.height)/2;t.save(),t.beginPath(),t.arc(n.x,n.y,s,0,2*Math.PI,!1),t.closePath(),t.restore()}},t},createTailArrow:function(){for(var t={},e=new De.List,i=30,n=-i/2;i/2>n;n++)e.add({x:-n/9,y:0});return t.points=e,t.draw=function(t,e){if(t&&e&&e.points&&!(e.points.size()<=0))for(var i=e.points._as,n=e.shadow,s=e.shadowColor,r=e.shadowXOffset,a=e.shadowYOffset,o=e.shadowBlur,s=e.shadowColor,h=i.length-4,l=Math.min(e.width,e.height)/2,c=0;h>c;c++){var u=c/h,d=i[c],f=.4*l;t.save(),t.restore(),t.beginPath(),t.globalAlpha=u*u,n&&(t.shadowOffsetX=r,t.shadowOffsetY=a,t.shadowBlur=o,t.shadowColor=s),t.arc(d.x,d.y,f,0,2*Math.PI,!1),t.closePath(),t.fill()}},t},createDiamondArrow:function(){var t=new gn;return t.add({x:-7/12,y:5/9}),t.add({x:-14/12,y:0}),t.add({x:-7/12,y:-5/9}),t.add({x:0,y:0}),t.add({x:-7/12,y:5/9}),{points:t}},createShortArrow:function(){var t=new gn;return t.add({x:-8/12,y:6/9}),t.add({x:-5/12,y:0}),t.add({x:-8/12,y:-6/9}),t.add({x:0,y:0}),t.add({x:-8/12,y:6/9}),{points:t}},createSlantArrow:function(){var t=new gn;return t.add({x:-1,y:-5/9}),t.add({x:-6.5/12,y:0}),t.add({x:-.75,y:4/9}),t.add({x:0,y:0}),t.add({x:-1,y:-5/9}),{points:t}},register:function(t,e){_n.shapeMap[t]=e},getShape:function(t){if(t)return _n.shapeMap[t];throw"shape type can't be null"},getArrowRect:function(t,e,i,n,s,r,a,o,h){var l=_n.getShape(n);if(l&&l.points&&!(l.points&&l.points.size()<=0)){if(a>0&&1>a){var c;c=t.getLineLength?t.getLineLength():t._element.getLineLength(),a*=c}else t.getLineLength&&(a+=_n.calculateArrowXOffsetAtEdge(e,t,i,h));h&&(a*=h.getLocationZoom(),o*=h.getLocationZoom());var u,d,f,g=Ge.calculatePointInfoAlongLine(e,i,a,o),_=g.point,p=g.angle,v=l.points._as,m=v.length,y=new gn;for(f=new Xe(s,0,0,r,_.x,_.y),u=0;m>u;u++)y.add(f.transform(v[u]));for(f=Ge.createMatrix(p+Math.PI,_.x,_.y),u=0;m>u;u++)d=y.get(u),d instanceof gn&&(d=d._as),d instanceof Array?(d[0]=f.transform(d[0]),d[1]=f.transform(d[1])):y.set(u,f.transform(d));return Ge.getLineRect(y)}},drawArrow:function(t,e,i,n,s,r,a,o,h,l,c,u,d){h=h||0,l=l||0,c=c||0;var f=d._element.getStyle("arrow.from.shadow"),g=d._element.getStyle("arrow.from.shadow.color"),_=d._element.getStyle("arrow.from.shadow.xoffset"),p=d._element.getStyle("arrow.from.shadow.yoffset"),v=d._element.getStyle("arrow.from.shadow.blur"),m=c>=0&&u;if(a||m){var y=_n.getShape(r);if(y&&y.points&&!(y.points&&y.points.size()<=0)){var A=Ge.calculatePointInfoAlongLine(n,s,h,l),x=A.point,w=A.angle;a&&(t.fillStyle=o),t.beginPath(),m&&(t.lineWidth=c,t.strokeStyle=u),_n._drawArrow(t,y,w,x,e,i,u,g,f,_,p,v),f&&(t.shadowOffsetX=_,t.shadowOffsetY=p,t.shadowBlur=v,t.shadowColor=g),a&&t.fill(),m&&t.stroke()}}},_drawArrow:function(t,e,i,n,s,r,a,o,h,l,c,u){if(e.draw){for(var d=new De.List,f=0;f<e.points._as.length;f++)d.add(e.points.get(f));d.add({x:-1,y:-.5}),d.add({x:-1,y:.5}),d.add({x:0,y:.5}),d.add({x:0,y:-.5}),d=d._as;var f,g,_,p=d.length,v=new gn;_=new Xe(s,0,0,r,n.x,n.y);for(var f=0;p>f;f++)v.add(_.transform(d[f]));v=v._as,_=Ge.createMatrix(i+Math.PI,n.x,n.y);for(var m=new gn,f=0;p>f;f++)m.add(_.transform(v[f]));e.draw&&e.draw(t,{points:m,width:s,height:r,shadowColor:o,shadow:h,shadowXOffset:l,shadowYOffset:c,shadowBlur:u})}else{var f,g,_,d=e.points._as,p=d.length,v=new gn;for(_=new Xe(s,0,0,r,n.x,n.y),f=0;p>f;f++)v.add(_.transform(d[f]));v=v._as,_=Ge.createMatrix(i+Math.PI,n.x,n.y);var y=v[0];for(y=_.transform(y),t.moveTo(y.x,y.y),f=1;p>f;f++)g=v[f],g instanceof gn&&(g=g._as),g instanceof Array?(g[0]=_.transform(g[0]),g[1]=_.transform(g[1]),t.quadraticCurveTo(g[0].x,g[0].y,g[1].x,g[1].y)):(g=_.transform(g),t.lineTo(g.x,g.y))}},drawLinkArrow:function(t,e,i,n){i.size()<2||(t._element.getStyle("arrow.from")&&_n._drawFromArrow(t,e,i,n),t._element.getStyle("arrow.to")&&_n._drawToArrow(t,e,i,n))},_drawFromArrow:function(t,e,i,n){var s=t._element,r=s.getStyle("arrow.from.fill"),a=s.getStyle("arrow.from.outline.width");if(s.getStyle("arrow.from.shadow.color"),r||a>=0){var o=s.getStyle("arrow.from.width"),h=s.getStyle("arrow.from.height"),l=s.getStyle("arrow.from.xoffset");if(l>0&&1>l){var c;c=t.getLineLength?t.getLineLength():t._element.getLineLength(),l*=c}else t.getLineLength&&(l+=_n.calculateArrowXOffsetAtEdge(i,t,!0,n));var u=s.getStyle("arrow.from.yoffset"),d=s.getStyle("arrow.from.shape");n&&(l*=n.getLocationZoom(),u*=n.getLocationZoom()),_n.drawArrow(e,o,h,i,!0,d,r,s.getStyle("arrow.from.color"),l,u,a,s.getStyle("arrow.from.outline.color"),t)}},_drawToArrow:function(t,e,i,n){var s=t._element,r=s.getStyle("arrow.to.fill"),a=s.getStyle("arrow.to.outline.width");if(r||a>=0){var o=s.getStyle("arrow.to.width"),h=s.getStyle("arrow.to.height"),l=s.getStyle("arrow.to.xoffset");if(l>0&&1>l){var c;c=t.getLineLength?t.getLineLength():t._element.getLineLength(),l*=c}else t.getLineLength&&(l+=_n.calculateArrowXOffsetAtEdge(i,t,!1));var u=s.getStyle("arrow.to.yoffset"),d=s.getStyle("arrow.to.shape");n&&(l*=n.getLocationZoom(),u*=n.getLocationZoom()),_n.drawArrow(e,o,h,i,!1,d,r,s.getStyle("arrow.to.color"),l,u,a,s.getStyle("arrow.to.outline.color"),t)}},calculateArrowXOffsetAtEdge:function(t,e,i,n){if(null==t||t.size()<2)return 0;var s=e._element,r=s.getStyle(i?"arrow.from.at.edge":"arrow.to.at.edge");if(!r)return 0;var a=e._network.getElementUI(i?s.getFromAgent():s.getToAgent());if(!a)return 0;if(n)var o=a.getZoomBodyRect();else var o=a._bodyRect;if(null==o)return 0;for(var h=Ge._getPoint(t.get(i?0:t.size()-1)),l=0,c=e.getLineLength();_n._containsByInt(o,Math.floor(h.x),Math.floor(h.y),!1)&&c>l;)h=Ge.calculatePointInfoAlongLine(t,i,l++).point;return l},_containsByInt:function(t,i,n,s){return s=s===e||s,s?i>=Math.floor(t.x)&&i<=Math.floor(t.x+t.width)&&n>=Math.floor(t.y)&&n<=Math.floor(t.y+t.height):i>Math.floor(t.x)&&i<Math.floor(t.x+t.width)&&n>Math.floor(t.y)&&n<Math.floor(t.y+t.height)}};_n.init(),Be.arrow=_n,De.EventDispatcher=function(){},Be.ext("twaver.EventDispatcher",null,{contains:function(t,e){if(this._ls)for(var i,n=0,s=this._ls.size();s>n;n++)if(i=this._ls.get(n),t===i.l&&e===i.s)return!0;return!1},add:function(t,e,i){var n={l:t,s:e,a:i};this._ls||(this._ls=new gn),this._f?(this._addPendings||(this._addPendings=new gn),this._addPendings.add(n)):n.a?this._ls.add(n,0):this._ls.add(n)},remove:function(t,e){this._ls&&(this._f?(this._removePendings||(this._removePendings=new gn),this._removePendings.add({l:t,s:e})):this._remove(t,e))},_remove:function(t,e){for(var i,n=0,s=this._ls.size();s>n;n++)if(i=this._ls.get(n),i.l===t&&i.s===e)return void this._ls.removeAt(n)},fire:function(t){if(this._ls){var e,i,n=this._ls.size();for(this._f=!0,e=0;n>e;e++)i=this._ls.get(e),i.s?i.l.call(i.s,t):i.l(t);if(this._f=!1,this._removePendings){for(n=this._removePendings.size(),e=0;n>e;e++)i=this._removePendings.get(e),this._remove(i.l,i.s);delete this._removePendings}if(this._addPendings){for(n=this._addPendings.size(),e=0;n>e;e++)i=this._addPendings.get(e),i.a?this._ls.add(i,0):this._ls.add(i);delete this._addPendings}}}}),De.ImageAsset=function(t,e,i,n,s){this._name=t,this._width=i,this._height=n,this._svg=s,this._edgeData,"string"==typeof e?this._src=e:"function"==typeof e?this._func=e:nn(e)?this._image=e:"object"==typeof e&&(this._image=e,this._width=e.w||e.width,this._height=e.h||e.height,e.cache!==!1&&Tn(e)&&(Sn(t,e),this._cache=Mn(e)))},Be.ext("twaver.ImageAsset",Object,{getName:function(){return this._name},getSrc:function(){return this._src},isSvg:function(){return this._svg},getImage:function(t,e,i){if(!t||!this._image)return this._image;this._map||(this._map={});var n;n=this._svg&&3===arguments.length?t+","+e+","+i:t;var s=this._map[n];return s?s:(s=xn(this._cache||this._image,yn(t),this._svg?e||this.getWidth():this.getWidth(),this._svg?i||this.getHeight():this.getHeight()),this._map[n]=s,s)},getWidth:function(){return this._width},getHeight:function(){return this._height},getFunction:function(){return this._func},_createEdgeData:function(t,e,i){var n=300,s=n/e;e>i&&(s=n/i);var r=Math.floor(e*s),a=Math.floor(i*s);this.tempCanvas||(this.tempCanvas=Ve.createElement("canvas"),this.ctx=this.tempCanvas.getContext("2d")),this.tempCanvas.width=r,this.tempCanvas.height=a,this.ctx.clearRect(0,0,r,a),this.ctx.drawImage(t,0,0,r,a);for(var o=this.ctx.getImageData(0,0,r,a),h=!0,l=[],c=0,e=r,i=a;i>c;c++)for(var u=0;e>u;u++){var d=4*(c*e+u),f=this._isTransparentPoint(o.data,d),g=h!=f||!f&&(0==u||u==e-1);if(g){var _=f?1:0;l.push({x:u-_,y:c})}h=f}h=!0;for(var u=0,e=r,i=a;e>u;u++)for(var c=0;i>c;c++){var d=4*(c*e+u),f=this._isTransparentPoint(o.data,d),g=h!=f||!f&&(0==c||c==i-1);if(g){var _=f?1:0;l.push({x:u,y:c-_})}h=f}for(var p=e/2,v=i/2,m=[],y=0;360>y;y++)m.push({x:p,y:v,dist:0});for(var y=0,A=l.length;A>y;y++){var x=l[y],w=this._getPointAngleDegree(x.x,x.y,p,v),b=this._getPointDist(x.x,x.y,p,v);m[w].dist<b&&(m[w]={x:x.x,y:x.y,dist:b})}for(var y=0,A=m.length;A>y;y++){var g=m[y];g.x=g.x/s,g.y=g.y/s,delete g.dist}return m},_isTransparentPoint:function(t,e){return t[e]+t[e+1]+t[e+2]+t[e+3]==0},_getPointAngleDegree:function(t,e,i,n){var s=i-t,r=n-e,a=Math.atan2(r,s);return a=a/Math.PI*180,a=parseInt(a)+180,a%=360},_getPointDist:function(t,e,i,n){var s=i-t,r=n-e;return Math.sqrt(s*s+r*r)}});var pn={},vn=je.createCanvas();vn.width=1,vn.height=1;var mn=vn.getContext("2d"),yn=function(t){t=t||"black";var e,i=pn[t];return i||(mn.clearRect(0,0,1,1),mn.fillStyle=t,mn.fillRect(0,0,1,1),e=mn.getImageData(0,0,1,1).data,i=pn[t]={r:e[0],g:e[1],b:e[2],a:e[3]}),i},An=function(t,e){if(!e)return t;if(e=yn(e),t=yn(t),kn.PIXEL_FILTER_FUNCTION){var i=kn.PIXEL_FILTER_FUNCTION(t,e);return"rgba("+i.r+","+i.g+","+i.b+","+t.a+")"}return null},xn=function(t,e,i,n){var s=je.createCanvas(i,n),r=s.getContext("2d");r.drawImage(t,0,0,i,n);try{for(var a=r.getImageData(0,0,i,n),o=a.data,h=0,l=o.length;l>h;h+=4){var c={r:o[h+0],g:o[h+1],b:o[h+2]},u=kn.PIXEL_FILTER_FUNCTION(c,e);o[h+0]=u.r,o[h+1]=u.g,o[h+2]=u.b}r.putImageData(a,0,0)}catch(d){return t}return s},wn={},bn=function(t,e){if(t){var i=typeof t;"string"===i&&(t.match(qi)||Be.images[t]||(wn[t]||(wn[t]=[])).push(e))}},Sn=function(t,e){e.pattern&&bn(e.pattern,t),e.v&&e.v.forEach(function(e){e.pattern&&bn(e.pattern,t)})},Cn=function(t){var e=wn[t];e&&(e.forEach(function(t){var e=Be.images[t];e._cache=Mn(e._image)}),delete wn[t])},Tn=function(t){return!(!t.w||!t.h)&&En(t)},En=function(t){return!Object.keys(t).some(function(e){if(/^on/.test(e))return!1;var i=t[e],n=Ln(i);return n||"v"!==e||(n=i.some(function(t){if("draw"===t.shape)return!0;if("vector"===t.shape){var e=Be.images[t.name];if(e&&!e._cache)return!0}var i=Object.keys(t).some(function(e){return"state"===e||"animate"===e||Ln(t[e])});return!!i||!("g"!==t.shape||!t.v||!t.v.length)&&!En(t)})),n})},Ln=function(t){var e=typeof t;return"string"===e&&t.match(qi)||"function"===e},Mn=function(t){var e=je.createCanvas(t.w,t.h),i=e.getContext("2d");return Vi(i,t,null,{x:0,y:0,width:t.w,height:t.h}),e},Pn=De.imageUtil={IMAGE_LOAD_COMPLETED:"IMAGE_LOAD_COMPLETED",_dispatcher:new De.EventDispatcher,addEventListener:function(t,e,i){Pn._dispatcher.add(t,e,i)},removeEventListener:function(t,e){Pn._dispatcher.remove(t,e)},images:{},registerImageByUrl:function(t,e,i){if(e=e||Pn.getImageType(t),i=i||Pn.getImageName(t),!Pn.images[i]){Pn.images[i]=t;var n=new Ue;n.src=t,n.onload=function(){Be.registerImage(i,n,n.width,n.height,e===!0),n.onload=null,delete Pn.images[i];var s={type:Pn.IMAGE_LOAD_COMPLETED,url:t,svg:e,name:i};Pn._dispatcher.fire(s)}}},getImageName:function(t){if("string"!=typeof t)return null;var e=t.lastIndexOf("/"),i=t;return e>=0&&(i=t.substring(e+1)),e=i.lastIndexOf("."),e>=0&&(i=i.substring(0,e)),i},getImageType:function(t){if("string"!=typeof t)return null;var e=t.lastIndexOf("/"),i=t;return e>=0&&(i=t.substring(e+1)),e=i.lastIndexOf("."),e>=0&&(i=i.substring(e+1)),i}},kn={COLORS:["#6495ED","#FFFF00","#00FFFF","#FF0000","#7FFF00","#E0A580","#5FC0CB","#FA00F0","#A1BC50","#FFD700","#4169E1","#E5A5F5","#1E90FF","#696969","#FF6347","#00BFEF","#FFD700","#80E090","#5F9EA0","#A000FF","#7FAF00","#228BA2","#FF00FF","#7FFFD4","#800000","#0000CD","#20B2AA","#D2691E","#6495BD","#DC143C","#F0A8AF","#008B8B","#800080","#B8860B","#4B0082","#00FF00","#FFA500","#FF4500","#FFFF00","#9ACD32","#00008B","#FF1493","#ADFF2F","#4682B4","#00C0B1"],CALL_LATER_DELAY:17,SCROLL_BAR_WIDTH:17,SELECT_COLOR:"#C2CFF1",FOCUS_ON_CLICK:!0,VIEW_POSITION:"absolute",VIEW_FONT_SIZE:"12px",VIEW_FONT_FAMILY:"arial, tahoma, helvetica, sans-serif",TOOLTIP_BACKGROUND:"lightyellow",TOOLTIP_FONT_SIZE:"12px",TOOLTIP_COLOR:"black",TOOLTIP_PADDING:"4px 8px",TOOLTIP_BORDER:"1px solid gray",TOOLTIP_BORDER_RADIUS:"6px",TOOLTIP_XOFFSET:12,TOOLTIP_YOFFSET:12,TOOLTIP_BOX_SHADOW:"0px 0px 3px #AAA",TOOLTIP_ZINDEX:1e5,TOOLTIP_INITIAL_DELAY:750,TOOLTIP_RESHOW_DELAY:500,TOOLTIP_DISMISS_DELAY:4e3,ZOOM_MAX:5,ZOOM_MIN:.1,ZOOM_INCREMENT:1.3,ZOOM_ANIMATE:!0,COLUMN_INNER_TEXT:!0,COLUMN_WIDTH:80,COLUMN_HORIZONTAL_ALIGN:"",COLUMN_PROPERTY_TYPE:"accessor",COLUMN_VALUE_TYPE:"string",COLUMN_EDITABLE:!1,COLUMN_SORTABLE:!0,COLUMN_VISIBLE:!0,COLUMN_RESIZABLE:!0,COLUMN_MOVABLE:!0,COLUMN_RENDER_CELL:null,COLUMN_RENDER_HEADER:null,PROPERTY_INNER_TEXT:!0,PROPERTY_HORIZONTAL_ALIGN:"",PROPERTY_PROPERTY_TYPE:"accessor",PROPERTY_VALUE_TYPE:"string",PROPERTY_EDITABLE:!1,PROPERTY_CATEGORY_NAME:null,PROPERTY_RENDER_NAME:null,PROPERTY_RENDER_VALUE:null,PROPERTY_RENDER_EDITOR:null,TAB_WIDTH:100,TAB_CLOSABLE:!1,TAB_RESIZABLE:!0,TAB_MOVABLE:!0,TAB_DISABLED:!1,TAB_VISIBLE:!0,ACCORDION_EXPAND_ICON:"expand_icon",ACCORDION_COLLAPSE_ICON:"collapse_icon",ACCORDION_TITLE_HEIGHT:20,ACCORDION_TITLE_BACKGROUND:"#EBEBEB",ACCORDION_BORDER_BOTTOM_COLOR:"lightgray",ACCORDION_ICON_POSITION:"left",TITLEPANE_TITLE_HEIGHT:20,TITLEPANE_TITLE_BACKGROUND:"#DDD",TITLEPANE_TITLE_HORIZONTAL_ALIGN:"left",BORDERPANE_HGAP:0,BORDERPANE_VGAP:0,CHARTPANE_TITLE_HEIGHT:20,CHARTPANE_TITLE_HORIZONTAL_ALIGN:"center",CHARTPANE_LEGEND_ORIENTATION:"bottom",CHARTPANE_LEGEND_WIDTH:80,LEGENDPANE_ICON_WIDTH:10,LEGENDPANE_ICON_HEIGHT:10,LEGENDPANE_ICON_RADIUS:0,LEGENDPANE_ROW_HEIGHT:20,LEGENDPANE_ORIENTATION:"horizontal",LEGENDPANE_HIDDEN_COLOR:"#BABBBC",LEGENDPANE_SELECT_BACKGROUND_COLOR:"#00007D",LEGENDPANE_SELECT_FOREGROUND_COLOR:"#FFFFFF",CHART_TOOLTIP_ENABLED:!0,CHART_SELECT_TOLERANCE:0,CHART_XGAP:6,CHART_YGAP:6,CHART_XZOOM_ENABLED:!0,CHART_YZOOM_ENABLED:!0,CHART_XTRANSLATE_ENABLED:!0,CHART_YTRANSLATE_ENABLED:!0,CHART_DOUBLE_CLICK_TO_RESET:!0,CHART_VALUE_VISIBLE:!0,CHART_VALUE_FONT:null,CHART_BACKGROUND_VISIBLE:!1,CHART_BACKGROUND_FILL:!0,CHART_BACKGROUND_FILL_COLOR:"rgba(50,50,50,0.11)",CHART_BACKGROUND_OUTLINE_WIDTH:1,CHART_BACKGROUND_OUTLINE_COLOR:"rgba(50,50,50,0.11)",CHART_BACKGROUND_GRADIENT:"linear.north",CHART_BACKGROUND_GRADIENT_COLOR:"#FFFFFF",PIECHART_TYPE:"oval",PIECHART_START_ANGLE:0,PIECHART_SELECT_OFFSET:5,PIECHART_SHADOW_OFFSET:1,PIECHART_SHADOW_COLOR:"#C2CFF1",PIECHART_LINE_RATE:.5,PIECHART_DONUT_RATE:.5,PIECHART_VALUE_POSITION:.5,BARCHART_TYPE:"default",BARCHART_UPPER_LIMIT:null,BARCHART_LOWER_LIMIT:0,BARCHART_XAXIS_LINE_COLOR:"#808080",BARCHART_XAXIS_LINE_WIDTH:1,BARCHART_XAXIS_TEXT_COLOR:"#000000",BARCHART_XAXIS_TEXT_FONT:null,BARCHART_YAXIS_LINE_COLOR:"#808080",BARCHART_YAXIS_LINE_WIDTH:1,BARCHART_YAXIS_TEXT_COLOR:"#000000",BARCHART_YAXIS_TEXT_FONT:null,BARCHART_XSCALE_TEXT_FONT:null,BARCHART_XSCALE_TEXT_COLOR:"#000000",BARCHART_XSCALE_TEXT_ORIENTATION:"horizontal",BARCHART_YSCALE_TEXT_VISIBLE:!0,BARCHART_YSCALE_TEXT_COLOR:"#000000",BARCHART_YSCALE_TEXT_FONT:null,BARCHART_YSCALE_LINE_COLOR:"#808080",BARCHART_YSCALE_LINE_WIDTH:.3,BARCHART_YSCALE_VALUE_GAP:0,BARCHART_YSCALE_PIXEL_GAP:20,BARCHART_YSCALE_MIN_TEXT_VISIBLE:!1,LINECHART_INTERRUPTABLE:!0,LINECHART_UPPER_LIMIT:null,LINECHART_LOWER_LIMIT:null,LINECHART_XAXIS_LINE_COLOR:"#808080",LINECHART_XAXIS_LINE_WIDTH:1,LINECHART_XAXIS_TEXT_COLOR:"#000000",LINECHART_XAXIS_TEXT_FONT:null,LINECHART_YAXIS_LINE_COLOR:"#808080",LINECHART_YAXIS_LINE_WIDTH:1,LINECHART_YAXIS_TEXT_COLOR:"#000000",LINECHART_YAXIS_TEXT_FONT:null,LINECHART_XSCALE_TEXT_FONT:null,LINECHART_XSCALE_TEXT_COLOR:"#000000",LINECHART_XSCALE_TEXT_ORIENTATION:"horizontal",LINECHART_XSCALE_LINE_COLOR:"#808080",LINECHART_XSCALE_LINE_WIDTH:.3,LINECHART_YSCALE_TEXT_VISIBLE:!0,LINECHART_YSCALE_TEXT_COLOR:"#000000",LINECHART_YSCALE_TEXT_FONT:null,LINECHART_YSCALE_LINE_COLOR:"#808080",LINECHART_YSCALE_LINE_WIDTH:.3,LINECHART_YSCALE_VALUE_GAP:0,LINECHART_YSCALE_PIXEL_GAP:20,LINECHART_YSCALE_MIN_TEXT_VISIBLE:!1,LINECHART_VALUESPANCOUNT:1,BUBBLECHART_UPPER_LIMIT:null,BUBBLECHART_LOWER_LIMIT:null,BUBBLECHART_XAXIS_UPPER_LIMIT:null,BUBBLECHART_XAXIS_LOWER_LIMIT:null,BUBBLECHART_XAXIS_LINE_COLOR:"#808080",BUBBLECHART_XAXIS_LINE_WIDTH:1,BUBBLECHART_XAXIS_TEXT_COLOR:"#000000",BUBBLECHART_XAXIS_TEXT_FONT:null,BUBBLECHART_YAXIS_LINE_COLOR:"#808080",BUBBLECHART_YAXIS_LINE_WIDTH:1,BUBBLECHART_YAXIS_TEXT_COLOR:"#000000",BUBBLECHART_YAXIS_TEXT_FONT:null,BUBBLECHART_XSCALE_TEXT_FONT:null,BUBBLECHART_XSCALE_TEXT_COLOR:"#000000",BUBBLECHART_XSCALE_TEXT_ORIENTATION:"horizontal",BUBBLECHART_XSCALE_LINE_COLOR:"#808080",BUBBLECHART_XSCALE_LINE_WIDTH:.3,BUBBLECHART_YSCALE_TEXT_VISIBLE:!0,BUBBLECHART_YSCALE_TEXT_COLOR:"#000000",BUBBLECHART_YSCALE_TEXT_FONT:null,BUBBLECHART_YSCALE_LINE_COLOR:"#808080",BUBBLECHART_YSCALE_LINE_WIDTH:.3,BUBBLECHART_YSCALE_VALUE_GAP:0,BUBBLECHART_YSCALE_PIXEL_GAP:20,BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE:!1,BUBBLECHART_SELECT_SHADOW_COLOR:"#000000",BUBBLECHART_SELECT_SHADOW_OFFSET:3,RADARCHART_AXIS_TEXT_FONT:null,RADARCHART_AXIS_TEXT_COLOR:"#000000",RADARCHART_AXIS_TEXT_VISIBLE:!0,RADARCHART_SCALE_TEXT_FONT:null,RADARCHART_SCALE_TEXT_COLOR:"#000000",RADARCHART_SCALE_TEXT_VISIBLE:!0,RADARCHART_AXIS_VISIBLE:!0,RADARCHART_AXIS_LINE_COLOR:"#808080",RADARCHART_AXIS_LINE_WIDTH:3,RADARCHART_AXIS_START_ANGLE:0,RADARCHART_RING_VISIBLE:!0,RADARCHART_RING_TYPE:"line",RADARCHART_RING_LINE_COLOR:"#808080",RADARCHART_RING_LINE_WIDTH:1,RADARCHART_SCALE_COUNT:5,RADARCHART_SCALE_MAXVALUE:1,RADARCHART_SCALE_MINVALUE:0,RADARCHART_ANCHOR_VISIBLE:!0,RADARCHART_AREA_FILL:!0,RADARCHART_AREA_FILL_ALPHA:.2,RADARCHART_AREA_SELECT_FILL_ALPHA:.5,DIALCHART_UPPER_LIMIT:100,DIALCHART_LOWER_LIMIT:0,DIALCHART_START_ANGLE:0,DIALCHART_END_ANGLE:360,DIALCHART_INNER_RADIUS:.8,DIALCHART_COLOR_RANGE_FILL_COLOR:"#808080",DIALCHART_OUTLINE_WIDTH:0,DIALCHART_OUTLINE_COLOR:"#808080",DIALCHART_SCALE_INSIDE:!0,DIALCHART_MAJOR_SCALE_COUNT:11,DIALCHART_MAJOR_SCALE_LINE_WIDTH:2,DIALCHART_MAJOR_SCALE_LINE_LENGTH:8,DIALCHART_MAJOR_SCALE_LINE_COLOR:"#000000",DIALCHART_MINOR_SCALE_COUNT:4,DIALCHART_MINOR_SCALE_LINE_WIDTH:1,DIALCHART_MINOR_SCALE_LINE_LENGTH:4,DIALCHART_MINOR_SCALE_LINE_COLOR:"#000000",DIALCHART_SCALE_TEXT_VISIBLE:!0,DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE:!0,DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE:!0,DIALCHART_SCALE_TEXT_FONT:null,DIALCHART_SCALE_TEXT_COLOR:"#000000",DIALCHART_PIVOT_RADIUS:10,DIALCHART_PIVOT_FILL:!0,DIALCHART_PIVOT_FILL_COLOR:"#808080",DIALCHART_PIVOT_OUTLINE_WIDTH:0,DIALCHART_PIVOT_OUTLINE_COLOR:"#808080",DIALCHART_VALUE_POSITION:.5,DIALCHART_INNER_DARKER_RADIUS:10,DIALCHART_OUTER_BRIGHTER_RADIUS:10,DIALCHART_SELECT_SHADOW_COLOR:"#000000",DIALCHART_SELECT_SHADOW_OFFSET:3,TABPANE_TAB_GAP:1,TABPANE_TAB_RADIUS:0,TABPANE_TAB_HEIGHT:24,TABPANE_TAB_ORIENTATION:"top",TABPANE_RESIZE_TOLERANCE:3,TABPANE_TAB_BACKGROUND:"#EBEBEB",TABPANE_DISABLED_COLOR:"#BABBBC",TABPANE_SELECT_BACKGROUND:"white",TABPANE_MOVE_BACKGROUND:"rgba(184,211,240,0.7)",TABPANE_INSERT_BACKGROUND:"orange",TABPANE_HORIZONTAL_ALIGN:"center",TABPANE_CLOSE_ICON:"close_icon",TABPANE_SELECT_NEXT_ON_CLOSE:!0,TABPANE_SELECT_NEXT_ON_INVISIBLE:!0,LISTBASE_INNER_TEXT:!0,LIST_ROW_HEIGHT:19,LIST_INDENT:2,LIST_ROW_LINE_WIDTH:0,LIST_ROW_LINE_COLOR:"#DDD",LIST_MAKE_VISIBLE_ON_SELECTED:!0,LIST_KEYBOARD_REMOVE_ENABLED:!0,LIST_KEYBOARD_SELECT_ENABLED:!0,TREE_ROW_HEIGHT:19,TREE_INDENT:16,TREE_ROW_LINE_WIDTH:0,TREE_ROW_LINE_COLOR:"#DDD",TREE_MAKE_VISIBLE_ON_SELECTED:!0,TREE_KEYBOARD_REMOVE_ENABLED:!0,TREE_KEYBOARD_SELECT_ENABLED:!0,TREE_EXPAND_ICON:"expand_icon",TREE_COLLAPSE_ICON:"collapse_icon",TREE_LINE_TYPE:"none",TREE_LINE_THICKNESS:2,TREE_LINE_COLOR:"#000000",TREE_LINE_ALPHA:1,TREE_LINE_DASH:[4,2],TABLE_ROW_HEIGHT:19,TABLE_ROW_LINE_WIDTH:1,TABLE_ROW_LINE_COLOR:"#DDD",TABLE_COLUMN_LINE_WIDTH:1,TABLE_COLUMN_LINE_COLOR:"#DDD",TABLE_MAKE_VISIBLE_ON_SELECTED:!0,TABLE_KEYBOARD_REMOVE_ENABLED:!0,TABLE_KEYBOARD_SELECT_ENABLED:!0,TABLE_EDITABLE:!1,TABLEHEADER_HEIGHT:24,TABLEHEADER_RESIZE_TOLERANCE:3,TABLEHEADER_BACKGROUND:"#EBEBEB",TABLEHEADER_MOVE_BACKGROUND:"rgba(184,211,240,0.7)",TABLEHEADER_INSERT_BACKGROUND:"orange",TABLEHEADER_COLUMN_LINE_COLOR:"#DDD",TABLEHEADER_SORT_DESC_ICON:"sort_desc",TABLEHEADER_SORT_ASC_ICON:"sort_asc",TABLEHEADER_SORT_ICON_POSITION:"98% 50%",TREETABLE_ROW_HEIGHT:19,TREETABLE_INDENT:16,TREETABLE_ROW_LINE_WIDTH:1,TREETABLE_ROW_LINE_COLOR:"#DDD",TREETABLE_COLUMN_LINE_WIDTH:1,TREETABLE_COLUMN_LINE_COLOR:"#DDD",TREETABLE_MAKE_VISIBLE_ON_SELECTED:!0,TREETABLE_KEYBOARD_REMOVE_ENABLED:!0,TREETABLE_KEYBOARD_SELECT_ENABLED:!0,TREETABLE_EXPAND_ICON:"expand_icon",TREETABLE_COLLAPSE_ICON:"collapse_icon",TREETABLE_EDITABLE:!1,PROPERTYSHEET_AUTO_ADJUSTABLE:!0,PROPERTYSHEET_INDENT:16,PROPERTYSHEET_ROW_HEIGHT:19,PROPERTYSHEET_ROW_LINE_WIDTH:1,PROPERTYSHEET_COLUMN_LINE_WIDTH:1,PROPERTYSHEET_BORDER_COLOR:"#EBEBEB",PROPERTYSHEET_EXPAND_ICON:"expand_icon",PROPERTYSHEET_COLLAPSE_ICON:"collapse_icon",PROPERTYSHEET_PROPERTY_NAME_WIDTH:100,PROPERTYSHEET_PROPERTY_NAME_HORIZONTAL_ALIGN:"",PROPERTYSHEET_SUM_WIDTH:200,PROPERTYSHEET_RESIZE_TOLERANCE:3,PROPERTYSHEET_EDITABLE:!1,PROPERTYSHEET_CATEGORIZABLE:!0,PROPERTYSHEET_EXPAND_CATEGORY:!0,POPUPMENU_SUBNENU_ENABLE_ICON:"submenu_enable_icon",POPUPMENU_SUBNENU_DISABLE_ICON:"submenu_disable_icon",POPUPMENU_CHECKBOX_SELECTED_ICON:"checkbox_selected_icon",POPUPMENU_CHECKBOX_UNSELECTED_ICON:"checkbox_unselected_icon",POPUPMENU_RADIOBUTTON_SELECTED_ICON:"radiobutton_selected_icon",POPUPMENU_RADIOBUTTON_UNSELECTED_ICON:"radiobutton_unselected_icon",SPLITPANE_ORIENTATION:"horizontal",SPLITPANE_POSITION:.5,SPLITPANE_DIVIDER_WIDTH:6,SPLITPANE_DIVIDER_BACKGROUND:"#CCCCFF",SPLITPANE_DIVIDER_OPACITY:.5,SPLITPANE_MASK_BACKGROUND:"",SPLITPANE_UP_EXPAND_ICON:"up_expand_icon",SPLITPANE_DOWN_EXPAND_ICON:"down_expand_icon",SPLITPANE_LEFT_EXPAND_ICON:"left_expand_icon",SPLITPANE_RIGHT_EXPAND_ICON:"right_expand_icon",NODE_WIDTH:50,NODE_HEIGHT:50,IMAGE_NODE:"node_image",IMAGE_GROUP:"group_image",IMAGE_SUBNETWORK:"subnetwork_image",ICON_DATABOX:"databox_icon",ICON_DATA:"data_icon",ICON_NODE:"node_icon",ICON_LINK:"link_icon",ICON_GROUP:"group_icon",ICON_SUBNETWORK:"subnetwork_icon",ICON_GRID:"grid_icon",ICON_BUS:"bus_icon",ICON_SHAPENODE:"shapenode_icon",ICON_SHAPELINK:"shapelink_icon",ICON_LINKSUBNETWORK:"linksubnetwork_icon",ICON_SHAPESUBNETWORK:"shapesubnetwork_icon",LAYER_DEFAULT_ID:"default",LAYER_DEFAULT_NAME:"default",ATTACHMENT_POINTER_LENGTH:10,ATTACHMENT_POINTER_WIDTH:8,ATTACHMENT_CORNER_RADIUS:5,ATTACHMENT_CONTENT_WIDTH:30,ATTACHMENT_CONTENT_HEIGHT:20,ATTACHMENT_POSITION:"topright.topright",ATTACHMENT_XOFFSET:0,ATTACHMENT_YOFFSET:0,ATTACHMENT_PADDING:0,ATTACHMENT_PADDING_LEFT:0,ATTACHMENT_PADDING_RIGHT:0,ATTACHMENT_PADDING_TOP:0,ATTACHMENT_PADDING_BOTTOM:0,ATTACHMENT_DIRECTION:"right",ATTACHMENT_FILL:!1,ATTACHMENT_FILL_COLOR:"#000000",ATTACHMENT_GRADIENT:null,ATTACHMENT_GRADIENT_COLOR:"#FFFFFF",ATTACHMENT_OUTLINE_WIDTH:-1,ATTACHMENT_OUTLINE_COLOR:"#000000",ATTACHMENT_CAP:"butt",ATTACHMENT_JOIN:"miter",ATTACHMENT_SHADOWABLE:!0,NETWORK_TOOLTIP_ENABLED:!0,NETWORK_SELECT_MODE:"mix",NETWORK_MAKE_VISIBLE_ON_SELECTED:!0,NETWORK_NO_AGENT_LINK_VISIBLE:!1,NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE:!1,NETWORK_SUBNETWORK_ANIMATE:!0,NETWORK_SENDTOTOP_ON_SELECTED:!0,NETWORK_KEYBOARD_REMOVE_ENABLED:!0,NETWORK_KEYBOARD_SELECT_ENABLED:!0,NETWORK_RECT_SELECT_ENABLED:!0,NETWORK_DOUBLECLICK_TO_SUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_UPSUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_LINKBUNDLE:!0,NETWORK_DOUBLECLICK_TO_GROUPEXPAND:!0,NETWORK_SELECT_OUTLINE_COLOR:"#2877A8",NETWORK_SELECT_OUTLINE_WIDTH:1,NETWORK_SELECT_FILL_COLOR:"rgba(184,211,240,0.4)",NETWORK_LAZYMOVE_OUTLINE_COLOR:"#2877A8",NETWORK_LAZYMOVE_OUTLINE_WIDTH:1,NETWORK_LAZYMOVE_FILL_COLOR:"rgba(184,211,240,0.4)",NETWORK_LAZYMOVE_FILL:!0,NETWORK_LAZYMOVE_ANIMATE:!0,NETWORK_RESIZE_POINT_SIZE:3,NETWORK_RESIZE_POINT_FILL_COLOR:"#FFFFFF",NETWORK_RESIZE_POINT_OUTLINE_COLOR:"#000000",NETWORK_RESIZE_POINT_OUTLINE_WIDTH:1,NETWORK_RESIZE_LINE_COLOR:"#000000",NETWORK_RESIZE_LINE_WIDTH:1,NETWORK_RESIZE_ANIMATE:!0,NETWORK_EDIT_POINT_SIZE:3,NETWORK_EDIT_POINT_FILL_COLOR:"#FFFF00",NETWORK_EDIT_POINT_OUTLINE_COLOR:"#000000",NETWORK_EDIT_POINT_OUTLINE_WIDTH:1,NETWORK_EDIT_LINE_COLOR:"rgba(184,211,240,0.7)",NETWORK_EDIT_LINE_WIDTH:2,NETWORK_ROTATE_POINT_SIZE:5,NETWORK_ROTATE_POINT_FILL_COLOR:"#FFFF00",NETWORK_ROTATE_POINT_OFFSET:15,NETWORK_ROTATE_POINT_OUTLINE_WIDTH:1,NETWORK_ROTATE_POINT_OUTLINE_COLOR:"rgba(0,0,0,1)",NETWORK_ROTATE_SCALE_FILL_COLOR:"rgb(227,166,103)",NETWORK_ROTATE_SCALE_FONT_COLOR:"#FFFFFF",NETWORK_ROTATE_SCALE_WIDTH:30,NETWORK_ROTATE_SCALE_HEIGHT:20,NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION:!0,NETWORK_LINK_FLOW_STEPPING:3,NETWORK_LINK_FLOW_COLOR:"#FF0000",NETWORK_LINK_FLOW_INTERVAL:600,NETWORK_SELECTION_TOLERANCE:2,NETWORK_TRANSPARENT_SELECTION_ENABLE:!1,SHOW_ALARM_IN_ATTACHMENT_DIV:!0,SHOW_LABEL_IN_ATTACHMENT_DIV:!1,SHOW_LABEL2_IN_ATTACHMENT_DIV:!1,SHOW_ICON_IN_ATTACHMENT_DIV:!1,SHOW_EDIT_IN_ATTACHMENT_DIV:!1,OVERVIEW_FILL_COLOR:"rgba(184,211,240,0.4)",OVERVIEW_OUTLINE_COLOR:"#B8D3F0",OVERVIEW_OUTLINE_WIDTH:1,OVERVIEW_SELECT_COLOR:"#0000FF",OVERVIEW_SELECT_WIDTH:1,OVERVIEW_PADDING:1,OVERVIEW_ANIMATE:!0,OVERVIEW_MAX_PACKING_WIDTH:-1,OVERVIEW_MAX_PACKING_HEIGHT:-1,TOUCH_MOVE_THRESHOLD:5,TOUCH_RECT_SELECT_THRESHOLD:20,TOUCH_ZOOM_THRESHOLD:30,LINK_BUNDLE_AGENT_FUNCTION:null,IS_LINK_ADJUSTED_TO_BOTTOM:!1,ELEMENTUI_FUNCTION:function(t,e){var i=e.getElementUIClass();return i?new i(t,e):null},CANVASUI_FUNCTION:function(t,e){var i=e.getCanvasUIClass();return i?new i(t,e):null},VECTORUI_FUNCTION:function(t,e){var i=e.getVectorUIClass();return i?new i(t,e):null},KEEP_DEFAULT_FUNCTION:function(t){return!(!t.target.keepDefault&&!t.target.getAttribute("keepDefault"))||(!(!t.target.parentNode||!t.target.parentNode.keepDefault&&!t.target.parentNode.getAttribute("keepDefault"))||!!t.shiftKey)},SORT_FUNCTION:function(t,i){if(t===i)return 0;if(null==t&&null!=i)return 1;if(null!=t&&null==i)return-1;if(null==t&&null==i)return 0;var n,s=typeof t,r=typeof i;return"string"===s&&"string"===r&&(n=t.localeCompare(i)),"number"===s&&"number"===r&&(n=t-i),n===e&&(n=(""+t).localeCompare(""+i)),n>0?1:0>n?-1:0},CENTER_LOCATION:!1,PIXEL_FILTER_FUNCTION:function(t,e){if(!e)return t;var i=.3*t.r+.59*t.g+.11*t.b;return{r:Math.floor(e.r*i/255),g:Math.floor(e.g*i/255),b:Math.floor(e.b*i/255)}}};!function(){var e=kn;if(t.OverrideTWaverDefaults)for(var i in OverrideTWaverDefaults)e[i]=OverrideTWaverDefaults[i];e.FONT=e.VIEW_FONT_SIZE&&e.VIEW_FONT_FAMILY?e.VIEW_FONT_SIZE+" "+e.VIEW_FONT_FAMILY:Ve.createElement("canvas").getContext("2d").font,e.CHART_VALUE_FONT||(e.CHART_VALUE_FONT="10px "+e.VIEW_FONT_FAMILY),e.BARCHART_XSCALE_TEXT_FONT||(e.BARCHART_XSCALE_TEXT_FONT="10px "+e.VIEW_FONT_FAMILY),e.BARCHART_YSCALE_TEXT_FONT||(e.BARCHART_YSCALE_TEXT_FONT="10px "+e.VIEW_FONT_FAMILY),e.BARCHART_XAXIS_TEXT_FONT||(e.BARCHART_XAXIS_TEXT_FONT="12px "+e.VIEW_FONT_FAMILY),e.BARCHART_YAXIS_TEXT_FONT||(e.BARCHART_YAXIS_TEXT_FONT="12px "+e.VIEW_FONT_FAMILY),e.LINECHART_XSCALE_TEXT_FONT||(e.LINECHART_XSCALE_TEXT_FONT="10px "+e.VIEW_FONT_FAMILY),e.LINECHART_YSCALE_TEXT_FONT||(e.LINECHART_YSCALE_TEXT_FONT="10px "+e.VIEW_FONT_FAMILY),e.LINECHART_XAXIS_TEXT_FONT||(e.LINECHART_XAXIS_TEXT_FONT="12px "+e.VIEW_FONT_FAMILY),e.LINECHART_YAXIS_TEXT_FONT||(e.LINECHART_YAXIS_TEXT_FONT="12px "+e.VIEW_FONT_FAMILY),e.BUBBLECHART_XAXIS_TEXT_FONT||(e.BUBBLECHART_XAXIS_TEXT_FONT="12px "+e.VIEW_FONT_FAMILY),e.BUBBLECHART_YAXIS_TEXT_FONT||(e.BUBBLECHART_YAXIS_TEXT_FONT="12px "+e.VIEW_FONT_FAMILY),e.BUBBLECHART_XSCALE_TEXT_FONT||(e.BUBBLECHART_XSCALE_TEXT_FONT="10px "+e.VIEW_FONT_FAMILY),e.BUBBLECHART_YSCALE_TEXT_FONT||(e.BUBBLECHART_YSCALE_TEXT_FONT="10px "+e.VIEW_FONT_FAMILY),e.RADARCHART_AXIS_TEXT_FONT||(e.RADARCHART_AXIS_TEXT_FONT="12px "+e.VIEW_FONT_FAMILY),e.RADARCHART_SCALE_TEXT_FONT||(e.RADARCHART_SCALE_TEXT_FONT="10px "+e.VIEW_FONT_FAMILY),e.DIALCHART_SCALE_TEXT_FONT||(e.DIALCHART_SCALE_TEXT_FONT="10px "+e.VIEW_FONT_FAMILY)}(),De.Defaults=kn,Be.ext("twaver.Defaults",Object,{}),De.Colors={orange:"#EC6C00",orange_light:"#EF8200",orange_dark:"#EA5404",gray_light:"#666666",gray_dark:"#242424",green_light:"#57AB9A",green_dark:"#238475",blue_light:"#61B6D8",blue_dark:"#0089C1"},De.SerializationSettings=function(){var t=De.SerializationSettings;this.isDataBoxSerializable=t.isDataBoxSerializable,this.isLayerBoxSerializable=t.isLayerBoxSerializable,this.isStyleSerializable=t.isStyleSerializable,this.isClientSerializable=t.isClientSerializable,this.isImageSerializable=t.isImageSerializable,this._pm=Be.clone(t._pm),this._sm=Be.clone(t._sm),this._cm=Be.clone(t._cm)},function(){var t=De.SerializationSettings;t.isDataBoxSerializable=!0,t.isLayerBoxSerializable=!0,t.isStyleSerializable=!0,t.isClientSerializable=!0,t.isImageSerializable=!0,t._pm={},t._sm={},t._cm={},t.setPropertyType=function(e,i){t._pm[e]=i},t.getPropertyType=function(e){return t._pm[e]},t.setStyleType=function(e,i){t._sm[e]=i},t.getStyleType=function(e){return t._sm[e]},t.setClientType=function(e,i){t._cm[e]=i},t.getClientType=function(e){return t._cm[e]}}(),Be.ext("twaver.SerializationSettings",Object,{setPropertyType:function(t,e){this._pm[t]=e},getPropertyType:function(t){return this._pm[t]},setStyleType:function(t,e){this._sm[t]=e},getStyleType:function(t){return this._sm[t]},setClientType:function(t,e){this._cm[t]=e},getClientType:function(t){return this._cm[t]}}),De.Styles={_m:{},setStyle:function(t,e){null==e?delete De.Styles._m[t]:De.Styles._m[t]=e},getStyle:function(t){return De.Styles._m[t]},getStyleProperties:function(){return Be.keys(De.Styles._m)}},function(){var t=function(t,e){De.SerializationSettings.setPropertyType(t,e)};t("name","cdata"),t("name2","cdata"),t("icon","string"),t("toolTip","cdata"),t("parent","data"),t("layerId","string"),t("alarmState","alarmstate"),t("image","string"),t("imageUrl","string"),t("location","point"),t("width","number"),t("height","number"),t("expanded","boolean"),t("host","data"),t("fromNode","data"),t("toNode","data"),t("points","list.point"),t("segments","list.string"),t("angle","number"),t("visible","boolean"),t=function(t,e,i){null==i&&(i=null!=e?typeof e:"string"),De.Styles.setStyle(t,e),De.SerializationSettings.setStyleType(t,i)},t("chart.color",null),t("chart.value",0),
t("chart.values",null,"list.number"),t("chart.value.color","#000000"),t("chart.value.font",null),t("chart.line.width",2),t("chart.marker.size",6),t("chart.marker.shape","circle"),t("chart.bubble.shape","circle"),t("chart.names",null,"list.string"),t("chart.xaxis.values",null,"list.number"),t("chart.yaxis.values",null,"list.number"),t("dialchart.rear.extension",0),t("dialchart.base.width",5),t("dialchart.top.width",0),t("dialchart.radius",.8),t("inner.color",null),t("outer.shape","rectangle"),t("outer.color",null),t("outer.width",2),t("outer.padding",1),t("outer.padding.left",0),t("outer.padding.right",0),t("outer.padding.top",0),t("outer.padding.bottom",0),t("outer.cap","butt"),t("outer.join","miter"),t("outer.style","border"),t("shadow.color",null),t("shadow.xoffset",3),t("shadow.yoffset",3),t("shadow.blur",6),t("select.style","shadow"),t("select.color","rgba(0, 0, 0, 0.7)"),t("select.shape","rectangle"),t("select.width",2),t("select.padding",2),t("select.padding.left",0),t("select.padding.right",0),t("select.padding.top",0),t("select.padding.bottom",0),t("select.cap","butt"),t("select.join","miter"),t("whole.alpha",1),t("body.type","default"),t("network.label",null,"cdata"),t("image.padding",0),t("image.padding.left",0),t("image.padding.right",0),t("image.padding.top",0),t("image.padding.bottom",0),t("image.state",null),t("vector.shape","rectangle"),t("vector.fill",!0),t("vector.fill.color","#CCCCFF"),t("vector.outline.width",-1),t("vector.outline.pattern",null,"array.number"),t("vector.outline.color","#5B5B5B"),t("vector.gradient","none"),t("vector.gradient.color","#FFFFFF"),t("vector.padding",0),t("vector.padding.left",0),t("vector.padding.right",0),t("vector.padding.top",0),t("vector.padding.bottom",0),t("vector.cap","butt"),t("vector.join","miter"),t("vector.deep",0),t("group.shape","rectangle"),t("group.fill",!0),t("group.fill.color","#CCCCFF"),t("group.outline.width",-1),t("group.outline.color","#5B5B5B"),t("group.gradient","none"),t("group.gradient.color","#FFFFFF"),t("group.padding",5),t("group.padding.left",0),t("group.padding.right",0),t("group.padding.top",0),t("group.padding.bottom",0),t("group.cap","butt"),t("group.join","miter"),t("group.deep",1),t("group.shape.roundrect.radius",-1),t("label.alpha",1),t("label.color","#000000"),t("label.font",null),t("label.position","bottom.bottom"),t("label.direction","below"),t("label.corner.radius",0),t("label.pointer.length",0),t("label.pointer.width",8),t("label.xoffset",0),t("label.yoffset",2),t("label.padding",0),t("label.padding.left",0),t("label.padding.right",0),t("label.padding.top",0),t("label.padding.bottom",0),t("label.fill",!1),t("label.fill.color","#C0C0C0"),t("label.gradient","none"),t("label.gradient.color","#FFFFFF"),t("label.outline.width",-1),t("label.outline.color","#000000"),t("label.cap","butt"),t("label.join","miter"),t("label.shadowable",!0),t("label.align","center"),t("label.rotate.angle",0),t("label.maxlength",0),t("link.label.rotatable",!1),t("label2.alpha",1),t("label2.color","#000000"),t("label2.font",null),t("label2.position","top.top"),t("label2.direction","below"),t("label2.corner.radius",0),t("label2.pointer.length",0),t("label2.pointer.width",8),t("label2.xoffset",0),t("label2.yoffset",-2),t("label2.padding",0),t("label2.padding.left",0),t("label2.padding.right",0),t("label2.padding.top",0),t("label2.padding.bottom",0),t("label2.fill",!1),t("label2.fill.color","#C0C0C0"),t("label2.gradient","none"),t("label2.gradient.color","#FFFFFF"),t("label2.outline.width",-1),t("label2.outline.color","#000000"),t("label2.cap","butt"),t("label2.join","miter"),t("label2.shadowable",!0),t("label2.align","center"),t("label2.rotate.angle",0),t("label2.maxlength",0),t("link.label2.rotatable",!1),t("icons.names",null,"array.string"),t("icons.colors",null,"array.string"),t("icons.position",null,"array.string"),t("icons.orientation",null,"array.string"),t("icons.xoffset",[0],"array.number"),t("icons.yoffset",[0],"array.number"),t("icons.xgap",[1],"array.number"),t("icons.ygap",[1],"array.number"),t("alarm.alpha",1),t("alarm.color","#000000"),t("alarm.font",null),t("alarm.position","hotspot"),t("alarm.direction","aboveright"),t("alarm.corner.radius",5),t("alarm.pointer.length",10),t("alarm.pointer.width",8),t("alarm.xoffset",0),t("alarm.yoffset",0),t("alarm.padding",0),t("alarm.padding.left",0),t("alarm.padding.right",0),t("alarm.padding.top",0),t("alarm.padding.bottom",0),t("alarm.gradient","none"),t("alarm.gradient.color","#FFFFFF"),t("alarm.outline.width",-1),t("alarm.outline.color","#000000"),t("alarm.cap","butt"),t("alarm.join","miter"),t("alarm.shadowable",!0),t("link.color","#658DC1"),t("link.width",3),t("link.cap","butt"),t("link.join","miter"),t("link.type","arc"),t("link.pattern",null,"array.number"),t("link.extend",20),t("link.control.point",null,"point"),t("link.bundle.id",0),t("link.bundle.enable",!0),t("link.bundle.expanded",!0),t("link.bundle.independent",!1),t("link.bundle.offset",20),t("link.bundle.gap",12),t("link.bundle.group.gap",0),t("link.looped.gap",6),t("link.looped.direction","northwest"),t("link.looped.type","arc"),t("link.from.position","center"),t("link.from.xoffset",0),t("link.from.yoffset",0),t("link.from.percent",null),t("link.from.at.edge",!0),t("link.to.position","center"),t("link.to.xoffset",0),t("link.to.yoffset",0),t("link.to.percent",null),t("link.to.at.edge",!0),t("link.split.by.percent",!0),t("link.split.percent",.5),t("link.split.value",20),t("link.corner","round"),t("link.xradius",8),t("link.yradius",8),t("link.flow",!1),t("link.flow.converse",!1),t("link.handler.alpha",1),t("link.handler.color","#000000"),t("link.handler.font",null),t("link.handler.position","topleft.topleft"),t("link.handler.direction","below"),t("link.handler.corner.radius",0),t("link.handler.pointer.length",0),t("link.handler.pointer.width",8),t("link.handler.xoffset",0),t("link.handler.yoffset",0),t("link.handler.padding",0),t("link.handler.padding.left",0),t("link.handler.padding.right",0),t("link.handler.padding.top",0),t("link.handler.padding.bottom",0),t("link.handler.fill",!1),t("link.handler.fill.color","#C0C0C0"),t("link.handler.gradient","none"),t("link.handler.gradient.color","#FFFFFF"),t("link.handler.outline.width",-1),t("link.handler.outline.color","#000000"),t("link.handler.cap","butt"),t("link.handler.join","miter"),t("link.handler.shadowable",!0),t("follower.row.index",0),t("follower.column.index",0),t("follower.row.span",1),t("follower.column.span",1),t("follower.padding",0),t("follower.padding.left",0),t("follower.padding.right",0),t("follower.padding.top",0),t("follower.padding.bottom",0),t("follower.fill.cell",!0),t("follower.cell.position","center"),t("glow.blur",20),t("grid.row.count",1),t("grid.column.count",1),t("grid.row.percents",null,"array.number"),t("grid.column.percents",null,"array.number"),t("grid.border",1),t("grid.border.left",0),t("grid.border.right",0),t("grid.border.top",0),t("grid.border.bottom",0),t("grid.padding",1),t("grid.padding.left",0),t("grid.padding.right",0),t("grid.padding.top",0),t("grid.padding.bottom",0),t("grid.fill",!0),t("grid.fill.color","#C0C0C0"),t("grid.deep",1),t("grid.cell.deep",-1),t("shapelink.type","lineto"),t("shapenode.closed",!1),t("shapenode.pattern",null,"array.number"),t("bus.style","nearby"),t("arrow.from",!1),t("arrow.from.fill",!0),t("arrow.from.shape","arrow.standard"),t("arrow.from.color","#000000"),t("arrow.from.xoffset",0),t("arrow.from.yoffset",0),t("arrow.from.width",12),t("arrow.from.height",9),t("arrow.from.outline.color","#000000"),t("arrow.from.outline.width",-1),t("arrow.from.at.edge",!0),t("arrow.from.shadow",!1),t("arrow.from.shadow.color","#000000"),t("arrow.from.shadow.xoffset",0),t("arrow.from.shadow.yoffset",0),t("arrow.from.shadow.blur",16),t("arrow.to",!1),t("arrow.to.fill",!0),t("arrow.to.shape","arrow.standard"),t("arrow.to.color","#000000"),t("arrow.to.xoffset",0),t("arrow.to.yoffset",0),t("arrow.to.width",12),t("arrow.to.height",9),t("arrow.to.outline.color","#000000"),t("arrow.to.outline.width",-1),t("arrow.to.at.edge",!0),t("background.image",null),t("background.type","none"),t("background.outline.width",-1),t("background.outline.color",null),t("background.vector.padding",0),t("background.image.padding",0),t("background.image.stretch","fill"),t("background.vector.fill",null),t("background.vector.fill.color",null),t("background.vector.gradient",!1),t("background.vector.gradient.color",null),t("background.vector.shape","rectangle"),t("background.outline.pattern",null,"array.number"),t("attachment.label.style","html"),t("attachment.label2.style","html"),t("attachment.alarm.style","html"),t("attachment.htmllabel.hyperlink",!1),t("attachment.htmllabel2.hyperlink",!1)}(),Be.ext("twaver.Styles",Object,{}),De.PropertyChangeDispatcher=function(){this._dispatcher=new De.EventDispatcher},Be.ext("twaver.PropertyChangeDispatcher",Object,{addPropertyChangeListener:function(t,e,i){this._dispatcher.add(t,e,i)},removePropertyChangeListener:function(t,e){this._dispatcher.remove(t,e)},firePropertyChange:function(t,e,i){if(e==i)return!1;var n={property:t,oldValue:e,newValue:i,source:this};return this._dispatcher.fire(n),this.onPropertyChanged(n),!0},onPropertyChanged:function(t){}}),De.animate.Animate=function(){},Be.ext("twaver.animate.Animate",Object,{current:0,step:8,delay:4,finishFunction:null,shouldBeFinished:!1,getCurrentDelay:function(){return this.delay*this.current+1},action:function(t){}}),De.animate.AnimateProperty=function(t,e,i){this.objects=t,this.newValues=e,this.finishFunction=i,this.oldValues=new gn;for(var n=this.objects.size(),s=0;n>s;s++){var r=this.objects.get(s);this.oldValues.add(this.getPropertyValue(r))}},Be.ext("twaver.animate.AnimateProperty",De.animate.Animate,{action:function(t){for(var e=this.objects.size(),i=0;e>i;i++){var n=this.objects.get(i),s=this.oldValues.get(i),r=this.newValues.get(i);this.currentAction(n,s,r,t)}},getPropertyValue:function(t){},currentAction:function(t,e,i,n){}}),De.animate.AnimateBounds=function(t,e,i){this.node=t,this.newBounds=e,this.oldBounds=t.getRect(),this.finishFunction=i},Be.ext("twaver.animate.AnimateBounds",De.animate.Animate,{shouldBeFinished:!0,action:function(t){var e=this.oldBounds,i=this.newBounds;this.node.setLocation(e.x+(i.x-e.x)*t,e.y+(i.y-e.y)*t),this.node.setSize(e.width+(i.width-e.width)*t,e.height+(i.height-e.height)*t)}}),De.animate.AnimateCenterLocation=function(t,e,i){De.animate.AnimateCenterLocation.superClass.constructor.call(this,t,e,i)},Be.ext("twaver.animate.AnimateCenterLocation",De.animate.AnimateProperty,{getPropertyValue:function(t){return t.getCenterLocation()},currentAction:function(t,e,i,n){var s=e.x+(i.x-e.x)*n,r=e.y+(i.y-e.y)*n;t.setCenterLocation(s,r)}}),De.animate.AnimateLocation=function(t,e,i){De.animate.AnimateLocation.superClass.constructor.call(this,t,e,i)},Be.ext("twaver.animate.AnimateLocation",De.animate.AnimateProperty,{getPropertyValue:function(t){return t.getLocation()},currentAction:function(t,e,i,n){var s=e.x+(i.x-e.x)*n,r=e.y+(i.y-e.y)*n;t.setLocation(s,r)}}),De.animate.AnimateScrollPosition=function(t,e,i){this.view=t,this.oldHorizontalOffset=t.scrollLeft,this.oldVerticalOffset=t.scrollTop,this.newHorizontalOffset=e,this.newVerticalOffset=i},Be.ext("twaver.animate.AnimateScrollPosition",De.animate.Animate,{action:function(t){this.view.scrollLeft=this.oldHorizontalOffset+(this.newHorizontalOffset-this.oldHorizontalOffset)*t,this.view.scrollTop=this.oldVerticalOffset+(this.newVerticalOffset-this.oldVerticalOffset)*t}}),De.animate.AnimateZoom=function(t,e,i){this.view=t,this.oldZoom=t.getZoom(),this.newZoom=e,this.finishFunction=i},Be.ext("twaver.animate.AnimateZoom",De.animate.Animate,{shouldBeFinished:!0,action:function(t){this.view.setZoom(this.oldZoom+(this.newZoom-this.oldZoom)*t,!1)}}),De.animate.AnimateXZoom=function(t,e,i){this.view=t,this.oldXZoom=t.getXZoom(),this.newXZoom=e,this.finishFunction=i},Be.ext("twaver.animate.AnimateXZoom",De.animate.Animate,{shouldBeFinished:!0,action:function(t){this.view.setXZoom(this.oldXZoom+(this.newXZoom-this.oldXZoom)*t,!1)}}),De.animate.AnimateYZoom=function(t,e,i){this.view=t,this.oldYZoom=t.getYZoom(),this.newYZoom=e,this.finishFunction=i},Be.ext("twaver.animate.AnimateYZoom",De.animate.Animate,{shouldBeFinished:!0,action:function(t){this.view.setYZoom(this.oldYZoom+(this.newYZoom-this.oldYZoom)*t,!1)}}),De.animate.AnimateXYZoom=function(t,e,i,n){this.view=t,this.oldXZoom=t.getXZoom(),this.newXZoom=e,this.oldYZoom=t.getYZoom(),this.newYZoom=i,this.finishFunction=n},Be.ext("twaver.animate.AnimateXYZoom",De.animate.Animate,{shouldBeFinished:!0,action:function(t){this.view.setXZoom(this.oldXZoom+(this.newXZoom-this.oldXZoom)*t,!1),this.view.setYZoom(this.oldYZoom+(this.newYZoom-this.oldYZoom)*t,!1)}}),De.animate.AnimateSubNetwork=function(t,e,i){this.network=t,this.subNetwork=e,this.finishFunction=i},Be.ext("twaver.animate.AnimateSubNetwork",De.animate.Animate,{shouldBeFinished:!0,action:function(t){t>.5?(this.network.getView().style.opacity=2*t-1,this.network._setCurrentSubNetwork(this.subNetwork)):this.network.getView().style.opacity=1-2*t}}),De.animate.AnimateManager={timer:null,animate:null,start:function(t,e){var i=De.animate.AnimateManager;t.current<0&&(t.current=0),e?Be.callLater(i.startImpl,null,[t],e):i.startImpl(t)},startImpl:function(t){var e=De.animate.AnimateManager;e.animate&&e.endAnimate(),e.animate=t,e.timer=setTimeout(e.tick,t.getCurrentDelay())},tick:function(){var t=De.animate.AnimateManager,e=t.animate;if(e){if(e.current<0)return void e.current++;e.current<e.step&&(e.current++,e.action(e.current/e.step),t.timer=setTimeout(t.tick,e.getCurrentDelay())),e.current>=e.step&&t.endAnimate()}},endAnimate:function(){var t=De.animate.AnimateManager;if(t.animate){t.animate.shouldBeFinished&&t.animate.current<t.animate.step&&(t.animate.current=t.animate.step,t.animate.action(t.animate.current/t.animate.step));var e=t.animate.finishFunction;t.animate=null,t.timer&&(clearTimeout(t.timer),t.timer=null),e&&e()}else t.timer&&(clearTimeout(t.timer),t.timer=null)}},De.DataBox=function(t){De.DataBox.superClass.constructor.apply(this,arguments),1===arguments.length&&(this._name=t),this._dataList=new gn,this._dataMap={},this._rootList=new gn,this._rootMap={},this._clientMap={},this._dataBoxChangeDispatcher=new De.EventDispatcher,this._dataPropertyChangeDispatcher=new De.EventDispatcher,this._hierarchyChangeDispatcher=new De.EventDispatcher,this._selectionModel=new De.SelectionModel(this)},Be.ext("twaver.DataBox",De.PropertyChangeDispatcher,{IClient:!0,__client:1,__new:1,_limit:-1,_name:"DataBox",_icon:kn.ICON_DATABOX,__accessor:["name","icon","toolTip"],getSelectionModel:function(){return this._selectionModel},size:function(){return this._dataList.size()},isEmpty:function(){return this._dataList.isEmpty()},getLimit:function(){return this._limit},setLimit:function(t){var e=this._limit;this._limit=t,this.firePropertyChange("limit",e,t),this._checkLimit()},_checkLimit:function(){this._limit>=0&&this.size()>this._limit&&this.removeFirst(this.size()-this._limit)},removeFirst:function(t){for(0===arguments.length&&(t=1);t>0&&this._dataList.size()>0;){var e=this._dataList.get(0);this.remove(e),t--}},getSiblings:function(t){if(!this.contains(t))throw t+" dosen't belong to this dataBox";var e=t.getParent();return e?e.getChildren():this._rootList},getRoots:function(){return this._rootList},getSiblingIndex:function(t){return t.getParent()?t.getParent().getChildren().indexOf(t):this._rootList.indexOf(t)},getDatas:function(){return this._dataList},getDataAt:function(t){return this._dataList.get(t)},toDatas:function(t,e){return this._dataList.toList(t,e)},forEach:function(t,e){this._dataList.forEach(t,e)},forEachReverse:function(t,e){this._dataList.forEachReverse(t,e)},forEachByDepthFirst:function(t,e,i){if(e)this._depthFirst(t,e,i);else for(var n=this._rootList.size(),s=0;n>s;s++){var r=this._rootList.get(s);if(this._depthFirst(t,r,i)===!1)return}},_depthFirst:function(t,e,i){for(var n=e.getChildrenSize(),s=0;n>s;s++){var r=e.getChildAt(s);if(this._depthFirst(t,r,i)===!1)return!1}if(i){if(t.call(i,e)===!1)return!1}else if(t(e)===!1)return!1},forEachByBreadthFirst:function(t,e,i){var n=new gn;for(e?n.add(e):this._rootList.forEach(n.add,n);n.size()>0;)if(e=n.removeAt(0),e.getChildren().forEach(n.add,n),i){if(t.call(i,e)===!1)return}else if(t(e)===!1)return},add:function(t,e){if(t){1===arguments.length&&(e=-1);var i=t.getId();if(this._dataMap.hasOwnProperty(i))throw"Data with ID '"+i+"' already exists";this._dataBoxChangeDispatcher.fire({kind:"preAdd",data:t}),this._dataMap[i]=t,this._dataList.add(t),t.getParent()||(this._rootMap[i]=t,e>=0?this._rootList.add(t,e):this._rootList.add(t)),t.addPropertyChangeListener(this.handleDataPropertyChange,this,!0),this._dataBoxChangeDispatcher.fire({kind:"add",data:t}),this._checkLimit()}},addByDescendant:function(t){this.add(t),t.getChildren().size()>0&&t.getChildren().forEach(function(t){this.addByDescendant(t)},this)},remove:function(t){this.removeById(t.getId())},removeSelection:function(){this._selectionModel.toSelection().forEach(function(t){this.remove(t)},this)},removeById:function(t){var e=this.getDataById(t);e&&(this._dataBoxChangeDispatcher.fire({kind:"preRemove",data:e}),e instanceof De.Link&&(e.setFromNode(null),e.setToNode(null)),e instanceof On&&e.getLinks()&&e.getLinks().toList().forEach(function(t){this.remove(t)},this),e instanceof On&&e.getFollowers()&&e.getFollowers().toList().forEach(function(t){t.setHost(null)}),e instanceof De.Follower&&e.getHost()&&e.setHost(null),e.toChildren().forEach(function(t){this.remove(t)},this),e.getParent()&&e.getParent().removeChild(e),this._dataList.remove(e),delete this._dataMap[t],this._rootMap[t]&&(delete this._rootMap[t],this._rootList.remove(e)),this._dataBoxChangeDispatcher.fire({kind:"remove",data:e}),e.removePropertyChangeListener(this.handleDataPropertyChange,this))},clear:function(){if(this._dataList.size()>0){this._dataList.forEach(function(t){t.removePropertyChangeListener(this.handleDataPropertyChange,this)},this);var t=this._dataList.toList();this._dataList.clear(),this._dataMap={},this._rootList.clear(),this._rootMap={},this._dataBoxChangeDispatcher.fire({kind:"clear",datas:t})}},getDataById:function(t){return this._dataMap[t]},containsById:function(t){return this._dataMap.hasOwnProperty(t)},contains:function(t){return!!t&&this._dataMap[t._id]===t},moveTo:function(t,e){if(!this.contains(t))throw t+" dosen't belong to this dataBox";var i=this.getSiblings(t),n=i.indexOf(t);n===e||0>n||e>=0&&e<=i.size()&&(i.remove(t),e>i.size()&&e--,i.add(t,e),this._hierarchyChangeDispatcher.fire({data:t,oldIndex:n,newIndex:e}))},moveUp:function(t){var e=this.getSiblings(t);this.moveTo(t,e.indexOf(t)-1)},moveDown:function(t){var e=this.getSiblings(t);this.moveTo(t,e.indexOf(t)+1)},moveToTop:function(t){this.moveTo(t,0)},moveToBottom:function(t){var e=this.getSiblings(t);this.moveTo(t,e.size())},moveSelectionUp:function(t){t||(t=this._selectionModel);var e=new gn;Si.findMoveUpDatas(t,e,this._rootList),e.forEach(this.moveUp,this)},moveSelectionDown:function(t){t||(t=this._selectionModel);var e=new gn;Si.findMoveDownDatas(t,e,this._rootList),e.forEach(this.moveDown,this)},moveSelectionToTop:function(t){t||(t=this._selectionModel);var e=new gn;Si.findMoveToTopDatas(t,e,this._rootList),e.forEach(this.moveToTop,this)},moveSelectionToBottom:function(t){t||(t=this._selectionModel);var e=new gn;Si.findMoveToBottomDatas(t,e,this._rootList),e.forEach(this.moveToBottom,this)},handleDataPropertyChange:function(t){var e=t.source;if("parent"===t.property){var i=e.getId();e.getParent()?this._rootMap[i]&&(delete this._rootMap[i],this._rootList.remove(e)):this._rootMap[i]||(this._rootMap[i]=e,this._rootList.add(e))}this.onDataPropertyChanged(e,t),this._dataPropertyChangeDispatcher.fire(t)},onDataPropertyChanged:function(t,e){},addDataBoxChangeListener:function(t,e,i){this._dataBoxChangeDispatcher.add(t,e,i)},removeDataBoxChangeListener:function(t,e){this._dataBoxChangeDispatcher.remove(t,e)},addDataPropertyChangeListener:function(t,e,i){this._dataPropertyChangeDispatcher.add(t,e,i)},removeDataPropertyChangeListener:function(t,e){this._dataPropertyChangeDispatcher.remove(t,e)},addHierarchyChangeListener:function(t,e,i){this._hierarchyChangeDispatcher.add(t,e,i)},removeHierarchyChangeListener:function(t,e){this._hierarchyChangeDispatcher.remove(t,e)},getRandomData:function(t){if(t){for(var e=new De.List,i=0;i<this._dataList.size()-1;i++){var n=this._dataList.get(i);n instanceof t&&e.add(n)}if(0==e.size())return null}var s=t?e.get(parseInt(De.Util.random()*e.size())):this._dataList.get(parseInt(De.Util.random()*this._dataList.size()));return s}}),De.ElementBox=function(t){De.ElementBox.superClass.constructor.apply(this,arguments),this._styleMap={},this._alarmBox=new De.AlarmBox(this),this._layerBox=new De.LayerBox(this),this._alarmStatePropagator=new De.AlarmStatePropagator(this),this._alarmStatePropagator.setEnable(!0),this._indexChangeDispatcher=new De.EventDispatcher,this._undoManager=new De.UndoManager(this)},De.ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY={fromAgent:1,toAgent:1,expanded:1,parent:1,host:1},Be.ext("twaver.ElementBox",De.DataBox,{IStyle:!0,__style:1,_name:"ElementBox",add:function(t,e){if(t){if(!t.IElement)throw"Only IElement can be added into ElementBox";De.ElementBox.superClass.add.apply(this,arguments),this.adjustElementIndex(t)}},onDataPropertyChanged:function(t,e){De.ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY[e.property]&&this.adjustElementIndex(t),De.ElementBox.superClass.onDataPropertyChanged.apply(this,arguments)},addIndexChangeListener:function(t,e,i){this._indexChangeDispatcher.add(t,e,i)},removeIndexChangeListener:function(t,e){this._indexChangeDispatcher.remove(t,e)},sendToTop:function(t){if(this.contains(t)){if(t!==this.getDatas().get(this.size()-1)){var e=this.getDatas().indexOf(t);this.getDatas().removeAt(e),this.getDatas().add(t),this._indexChangeDispatcher.fire({element:t,oldIndex:e,newIndex:this.size()-1})}t instanceof De.Link&&(t.getFromAgent()&&!t.getFromAgent().isAdjustedToBottom()&&this.sendToTop(t.getFromAgent()),t.getToAgent()&&!t.getToAgent().isAdjustedToBottom()&&this.sendToTop(t.getToAgent())),t instanceof On&&t.getFollowers()&&t.getFollowers().forEach(function(e){e.isRelatedTo(t)||t instanceof De.Follower&&e.isLoopedHostOn(t)||this.sendToTop(e)},this),t.ISubNetwork||t instanceof Vn&&!t.isExpanded()||t.getChildren().forEach(function(t){t instanceof De.Link||this.sendToTop(t)},this)}},sendToBottom:function(t,e){if(t!==e&&this.contains(t)&&(!e||this.contains(e))){var i=this.getDatas().remove(t),n=0;e&&(n=this.getDatas().indexOf(e)),this.getDatas().add(t,n),i!=n&&(this._indexChangeDispatcher.fire({element:t,oldIndex:i,newIndex:n}),!t.getParent()||t.getParent().ISubNetwork||t.getParent()instanceof De.Link||this.sendToBottom(t.getParent(),t))}},fireIndexChange:function(t,e,i){this._indexChangeDispatcher.fire({element:t,oldIndex:e,newIndex:i})},adjustElementIndex:function(t){this.contains(t)&&(t.isAdjustedToBottom()?(this.sendToBottom(t),t.getChildren().forEach(this.adjustElementIndex,this)):this.sendToTop(t))},forEachByLayer:function(t,e,i){var n=this.size(),s=this.getDatas();if(e)for(var r=0;n>r;r++){var a=s.get(r);if(this._layerBox.getLayerByElement(a)===e)if(i){if(t.call(i,a)===!1)return}else if(t(a)===!1)return}else this._layerBox.forEachByDepthFirst(function(e){for(var r=0;n>r;r++){var a=s.get(r);if(this._layerBox.getLayerByElement(a)===e)if(i){if(t.call(i,a)===!1)return}else if(t(a)===!1)return}},null,this)},forEachByLayerReverse:function(t,e,i){var n=new gn;this.forEachByLayer(function(t){n.add(t,0)},e),n.forEach(t,i)},getLayerBox:function(){return this._layerBox},getAlarmBox:function(){return this._alarmBox},getAlarmStatePropagator:function(){return this._alarmStatePropagator},startBatch:function(t,e){De._isInitializing=!0,De._bundleLinks={},De._links={},t.call(e);var i,n;for(var s in De._links)i=De._links[s],i._checkAgentNodeImpl();for(var s in De._bundleLinks)n=De._bundleLinks[s],xi.resetBundleLinks(n[0],n[1]);De._bundleLinks=null,De._links=null,De._isInitializing=!1},getUndoManager:function(){return this._undoManager}}),De.SelectionModel=function(t){De.SelectionModel.superClass.constructor.apply(this,arguments),this._selectionMode="multipleSelection",this._selectionList=new gn,this._selectionChangeDispatcher=new De.EventDispatcher,this._selectionMap={},this._setDataBox(t)},Be.ext("twaver.SelectionModel",De.PropertyChangeDispatcher,{getSelectionMode:function(){return this._selectionMode},setSelectionMode:function(t){if(this._selectionMode!==t&&("noneSelection"===t||"singleSelection"===t||"multipleSelection"===t)){this.clearSelection();var e=this._selectionMode;this._selectionMode=t,this.firePropertyChange("selectionMode",e,this._selectionMode)}},getDataBox:function(){return this._dataBox},_setDataBox:function(t){if(!t)throw"dataBox can not be null";if(this._dataBox!==t){this._dataBox&&(this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this));var e=this._dataBox;this._dataBox=t,this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this.firePropertyChange("dataBox",e,this._dataBox)}},dispose:function(){this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this)},handleDataBoxChange:function(t){if("remove"===t.kind){var e=t.data;this.contains(e)&&(this._selectionList.remove(e),delete this._selectionMap[e.getId()],this.fireSelectionChange("remove",new gn(e)))}else"clear"===t.kind&&this.clearSelection()},getFilterFunction:function(){return this._filterFunction},setFilterFunction:function(t){if(this._filterFunction!==t){this.clearSelection();var e=this._filterFunction;this._filterFunction=t,this.firePropertyChange("filterFunction",e,this._filterFunction)}},fireSelectionChange:function(t,e,i){i&&(this._selectionList.forEach(function(t){i.contains(t)?i.remove(t):i.add(t)}),e=i.toList()),this._selectionChangeDispatcher.fire({kind:t,datas:new gn(e)})},addSelectionChangeListener:function(t,e,i){this._selectionChangeDispatcher.add(t,e,i)},removeSelectionChangeListener:function(t,e){this._selectionChangeDispatcher.remove(t,e)},_filterList:function(t,e){for(var i=new gn(t),n=0;n<i.size();n++){var s=i.get(n);(this._filterFunction&&!this._filterFunction(s)||e&&this.contains(s)||!e&&!this.contains(s)||!this._dataBox.contains(s))&&(i.removeAt(n),n--)}return i},appendSelection:function(t){if("noneSelection"!==this._selectionMode){var e=this._filterList(t,!0);if(!e.isEmpty()){var i=null;"singleSelection"===this._selectionMode&&(i=new gn(this._selectionList),this._selectionList.clear(),this._selectionMap={},e=new gn(e.get(e.size()-1)));for(var n=0;n<e.size();n++){var s=e.get(n);this._selectionList.add(s),this._selectionMap[s.getId()]=s}this.fireSelectionChange("append",e,i)}}},removeSelection:function(t){var e=this._filterList(t);if(0!==e.size()){for(var i=0;i<e.size();i++){var n=e.get(i);this._selectionList.remove(n),delete this._selectionMap[n.getId()]}this.fireSelectionChange("remove",e)}},toSelection:function(t,e){return this._selectionList.toList(t,e)},getSelection:function(){return this._selectionList},setSelection:function(t){if("noneSelection"!==this._selectionMode&&(0!==this._selectionList.size()||null!=t)){var e=new gn(this._selectionList);this._selectionList.clear(),this._selectionMap={};var i=this._filterList(t,!0);"singleSelection"===this._selectionMode&&i.size()>1&&(i=new gn(i.get(i.size()-1)));for(var n=0;n<i.size();n++){var s=i.get(n);this._selectionList.add(s),this._selectionMap[s.getId()]=s}this.fireSelectionChange("set",null,e)}},clearSelection:function(){if(this._selectionList.size()>0){var t=this._selectionList.toList();this._selectionList.clear(),this._selectionMap={},this.fireSelectionChange("clear",t)}},selectAll:function(){if("noneSelection"!==this._selectionMode){var t=this._dataBox.toDatas(),e=0,i=null;if(this._filterFunction)for(e=0;e<t.size();e++)i=t.get(e),this._filterFunction(i)||(t.removeAt(e),e--);var n=new gn(this._selectionList);for(this._selectionList.clear(),this._selectionMap={},"singleSelection"===this._selectionMode&&t.size()>1&&(t=new gn(t.get(t.size()-1))),e=0;e<t.size();e++)i=t.get(e),this._selectionList.add(i),this._selectionMap[i.getId()]=i;this.fireSelectionChange("all",null,n)}},size:function(){return this._selectionList.size()},contains:function(t){return!!t&&null!=this._selectionMap[t.getId()]},getLastData:function(){return this._selectionList.size()>0?this._selectionList.get(this._selectionList.size()-1):null},getFirstData:function(){return this._selectionList.size()>0?this._selectionList.get(0):null},isSelectable:function(t){return!!t&&("noneSelection"!==this._selectionMode&&!(this._filterFunction&&!this._filterFunction(t)))}}),De.QuickFinder=function(t,e,i,n,s){if(this._map={},!t)throw"dataBox can not be null";if(!e)throw"propertyName can not be null";this._dataBox=t,this._propertyName=e,this._propertyType=i||"accessor","accessor"===this._propertyType&&(this._getter=Be.getter(e)),this._valueFunction=n||this.getValue,this._filterFunction=s||this.isInterested,this._dataBox.forEach(this._addData,this),this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this,!0)},Be.ext("twaver.QuickFinder",Object,{_NULL_:"twaver-null-key",getValueFunction:function(){return this._valueFunction},getFilterFunction:function(){return this._filterFunction},handleDataBoxChange:function(t){"add"===t.kind?this._addData(t.data):"remove"===t.kind?this._removeData(t.data):"clear"===t.kind&&(this._map={})},handleDataPropertyChange:function(t){if(this._filterFunction.call(this,t.source)){if("accessor"===this._propertyType&&this._propertyName===t.property);else if("style"===this._propertyType&&t.source.IStyle&&"S:"+this._propertyName===t.property);else if("client"!==this._propertyType||"C:"+this._propertyName!==t.property)return;var e=this._getMap(t.oldValue);e&&e.remove(t.source),this._addData(t.source)}},_getMap:function(t){return t=null==t?this._NULL_:t,this._map[t]},find:function(t){var e=this._getMap(t);return e?e.toList():new gn},findFirst:function(t){var e=this._getMap(t);return!e||e.isEmpty()?null:e.get(0)},_addData:function(t){if(this._filterFunction.call(this,t)){var e=this._valueFunction.call(this,t),i=this._getMap(e);i||(i=new gn,e=null==e?this._NULL_:e,this._map[e]=i),i.add(t)}},_removeData:function(t){if(this._filterFunction.call(this,t)){var e=this._valueFunction.call(this,t),i=this._getMap(e);i&&(i.remove(t),i.isEmpty()&&(e=null==e?this._NULL_:e,delete this._map[e]))}},dispose:function(){this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),delete this._dataBox},getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isInterested:function(t){return!("style"===this._propertyType&&!t.IStyle||"accessor"===this._propertyType&&this._valueFunction===this.getValue&&!t[this._getter])},getValue:function(t){return"accessor"===this._propertyType?t[this._getter]():"style"===this._propertyType&&t.getStyle?t.getStyle(this._propertyName):"client"===this._propertyType&&t.getClient?t.getClient(this._propertyName):null}}),De.PropertyPropagator=function(t,e,i){if(!t)throw"dataBox can not be null";if(!e)throw"propertyName can not be null";this._dataBox=t,this._propertyName=e,this._propertyType=i||"accessor","accessor"===this._propertyType&&(this._getter=Be.getter(e),this._setter=Be.setter(e)),this._enable=!1,this._isPropagating=!1},Be.ext("twaver.PropertyPropagator",Object,{getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isEnable:function(){return this._enable},setEnable:function(t){this._enable!==t&&(this._enable=t,
this._enable?(this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this._dataBox.forEach(function(t){this.propagate(t)},this)):(this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this)))},handleDataBoxChange:function(t){t.data&&this.propagate(t.data)},handleDataPropertyChange:function(t){if(this.isInterestedProperty(t))this.propagate(t.source);else if("parent"===t.property){var e=t.oldValue;e&&this.propagate(e),this.propagate(t.source)}},isInterestedProperty:function(t){return"accessor"===this._propertyType&&this._propertyName===t.property||(!("style"!==this._propertyType||!t.IElement||"S:"+this._propertyName!==t.property)||"client"===this._propertyType&&"C:"+this._propertyName===t.property)},propagate:function(t){t&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(t),this._isPropagating=!1)},propagateToTop:function(t){for(this.propagateToParent(null,t);t&&t.getParent();)this.propagateToParent(t,t.getParent()),t=t.getParent()},propagateToParent:function(t,e){}}),De.AlarmStatePropagator=function(t){De.AlarmStatePropagator.superClass.constructor.call(this,t,"alarmState")},Be.ext("twaver.AlarmStatePropagator",De.PropertyPropagator,{handleDataPropertyChange:function(t){"enablePropagation"===t.property?this.propagate(t.source):De.AlarmStatePropagator.superClass.handleDataPropertyChange.call(this,t)},propagateToParent:function(t,e){var i=null;e.getChildren().forEach(function(t){var e=t.getAlarmState().getHighestOverallAlarmSeverity();De.AlarmSeverity.compare(e,i)>0&&(i=e)}),e.getAlarmState().setPropagateSeverity(i)}}),De.AlarmSeverity=function(t,e,i,n,s){this.value=t,this.name=e,this.nickName=i,this.color=n,this.displayName=s},Be.ext("twaver.AlarmSeverity",Object,{toString:function(){return this.displayName?this.displayName:this.name}}),function(){var t=De.AlarmSeverity;t.severities=new gn,t._vm={},t._nm={},t._cp=function(t,e){if(t&&e){var i=t.value-e.value;return i>0?1:0>i?-1:0}return t&&!e?1:!t&&e?-1:0},t.forEach=function(e,i){t.severities.forEach(e,i)},t.getSortFunction=function(){return t._cp},t.setSortFunction=function(e){t._cp=e,t.severities.sort(e)},t.add=function(e,i,n,s,r){var a=new t(e,i,n,s,r);return t._vm[e]=a,t._nm[i]=a,t.severities.add(a),t.severities.sort(t._cp),a},t.remove=function(e){var i=t._nm[e];return i&&(delete t._nm[e],delete t._vm[i.value],t.severities.remove(i)),i},t.CRITICAL=t.add(500,"Critical","C","#FF0000"),t.MAJOR=t.add(400,"Major","M","#FFA000"),t.MINOR=t.add(300,"Minor","m","#FFFF00"),t.WARNING=t.add(200,"Warning","W","#00FFFF"),t.INDETERMINATE=t.add(100,"Indeterminate","N","#C800FF"),t.CLEARED=t.add(0,"Cleared","R","#00FF00"),t.isClearedAlarmSeverity=function(t){return!!t&&0===t.value},t.getByName=function(e){return t._nm[e]},t.getByValue=function(e){return t._vm[e]},t.clear=function(){t.severities.clear(),t._vm={},t._nm={}},t.compare=function(e,i){return t._cp(e,i)}}(),De.AlarmState=function(t){this._e=t,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0},Be.ext("twaver.AlarmState",Object,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._e.firePropertyChange("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var t=null;for(var e in this._am)e=De.AlarmSeverity.getByName(e),De.AlarmSeverity.isClearedAlarmSeverity(e)||0!==this.getAcknowledgedAlarmCount(e)&&(t=t&&De.AlarmSeverity.compare(t,e)>0?t:e);this._haa=t},_c2:function(){var t=null;for(var e in this._nm)e=De.AlarmSeverity.getByName(e),De.AlarmSeverity.isClearedAlarmSeverity(e)||0!==this.getNewAlarmCount(e)&&(t=t&&De.AlarmSeverity.compare(t,e)>0?t:e);this._hna=t},_c3:function(){if(!this._hna)return void(this._hls=!1);for(var t in this._nm)if(t=De.AlarmSeverity.getByName(t),!De.AlarmSeverity.isClearedAlarmSeverity(t)&&0!==this.getNewAlarmCount(t)&&De.AlarmSeverity.compare(this._hna,t)>0)return void(this._hls=!0);this._hls=!1},_c4:function(){var t=this._haa,e=this._hna,i=this._ps;this._hoa=t,De.AlarmSeverity.compare(e,this._hoa)>0&&(this._hoa=e),De.AlarmSeverity.compare(i,this._hoa)>0&&(this._hoa=i)},_c5:function(){var t=this._haa,e=this._hna;this._hta=t,De.AlarmSeverity.compare(e,this._hta)>0&&(this._hta=e)},increaseAcknowledgedAlarm:function(t,e){if(null==e&&(e=1),0!==e){var i=this._am[t.name];null==i&&(i=0),i+=e,this._am[t.name]=i,this._f()}},increaseNewAlarm:function(t,e){if(null==e&&(e=1),0!==e){var i=this._nm[t.name];null==i&&(i=0),i+=e,this._nm[t.name]=i,this._f()}},decreaseAcknowledgedAlarm:function(t,e){if(null==e&&(e=1),0!==e){var i=this._am[t.name];if(null==i&&(i=0),i-=e,0>i)throw"Alarm count can not be negative";this._am[t.name]=i,this._f()}},decreaseNewAlarm:function(t,e){if(null==e&&(e=1),0!==e){var i=this._nm[t.name];if(null==i&&(i=0),i-=e,0>i)throw"Alarm count can not be negative";this._nm[t.name]=i,this._f()}},acknowledgeAlarm:function(t){this.decreaseNewAlarm(t,1),this.increaseAcknowledgedAlarm(t,1)},acknowledgeAllAlarms:function(t){if(t){var e=this.getNewAlarmCount(t);this.decreaseNewAlarm(t,e),this.increaseAcknowledgedAlarm(t,e)}else for(var i in this._nm)this.acknowledgeAllAlarms(De.AlarmSeverity.getByName(i))},_c6:function(){this._aac=0;for(var t in this._am)t=De.AlarmSeverity.getByName(t),this._aac+=this.getAcknowledgedAlarmCount(t)},getAcknowledgedAlarmCount:function(t){if(t){var e=this._am[t.name];return null==e?0:e}return this._aac},getAlarmCount:function(t){return this.getAcknowledgedAlarmCount(t)+this.getNewAlarmCount(t)},_c7:function(){this._nac=0;for(var t in this._nm)t=De.AlarmSeverity.getByName(t),this._nac+=this.getNewAlarmCount(t)},getNewAlarmCount:function(t){if(t){var e=this._nm[t.name];return null==e?0:e}return this._nac},setNewAlarmCount:function(t,e){this._nm[t.name]=e,this._f()},removeAllNewAlarms:function(t){t?delete this._nm[t]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(t,e){this._am[t.name]=e,this._f()},removeAllAcknowledgedAlarms:function(t){t?delete this._am[t.name]:this._am={},this._f()},isEmpty:function(){return null==this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(t){if(this._ep||(t=null),this._ps!==t){var e=this._ps;this._ps=t,this._f(),this._e.firePropertyChange("propagateSeverity",e,t)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(t){var e=this._ep;this._ep=t,this._e.firePropertyChange("enablePropagation",e,t)&&(t||this.setPropagateSeverity(null))}}),De.AlarmBox=function(t){if(!t)throw"elementBox can not be null.";De.AlarmBox.superClass.constructor.call(this),this._elementBox=t,this._alarmElementMapping=new De.AlarmElementMapping(this,t),this._elementBox.addDataBoxChangeListener(this.handleElementBoxChange,this,!0),this.addDataBoxChangeListener(this.handleAlarmBoxChange,this,!0),this.addDataPropertyChangeListener(this.handleAlarmPropertyChange,this,!0)},Be.ext("twaver.AlarmBox",De.DataBox,{__accessor:["removeAlarmWhenElementIsRemoved"],_name:"AlarmBox",_removeAlarmWhenAlarmIsCleared:!1,_removeAlarmWhenElementIsRemoved:!0,getElementBox:function(){return this._elementBox},isRemoveAlarmWhenAlarmIsCleared:function(){return this._removeAlarmWhenAlarmIsCleared},setRemoveAlarmWhenAlarmIsCleared:function(t){var e=this._removeAlarmWhenAlarmIsCleared;this._removeAlarmWhenAlarmIsCleared=t,this.firePropertyChange("removeAlarmWhenAlarmIsCleared",e,t),t&&this.toDatas(function(t){return t.isCleared()}).forEach(this.remove,this)},getAlarmElementMapping:function(){return this._alarmElementMapping},setAlarmElementMapping:function(t){if(!t)throw"alarmElementMapping can not be null";if(this._alarmElementMapping!==t){var e=this._alarmElementMapping;this.getDatas().forEach(this._decreaseAlarmState,this),this._alarmElementMapping=t,this.getDatas().forEach(this._increaseAlarmState,this),this.firePropertyChange("alarmElementMapping",e,t)}},handleElementBoxChange:function(t){"add"===t.kind?this.handleElementAdded(t.data):"remove"===t.kind?(this.handleElementRemoved(t.data),this._removeAlarmWhenElementIsRemoved&&this.removeAlarmsByElement(t.data)):"clear"===t.kind&&(t.datas.forEach(this.handleElementRemoved,this),this._removeAlarmWhenElementIsRemoved&&this.clear())},handleAlarmBoxChange:function(t){"add"===t.kind?this._increaseAlarmState(t.data):"remove"===t.kind?this._decreaseAlarmState(t.data):"clear"===t.kind&&t.datas.forEach(this._decreaseAlarmState,this)},handleAlarmPropertyChange:function(t){var e=t.source;e.isCleared()||("alarmSeverity"===t.property?this.handleAlarmSeverityChange(e,t):"acked"===t.property&&this.handleAckedChange(e,t)),"cleared"===t.property&&(e.isCleared()?(this._decreaseAlarmState(e,!0),this._removeAlarmWhenAlarmIsCleared&&this.remove(e)):this._increaseAlarmState(e,!0))},handleAckedChange:function(t,e){if(t.getAlarmSeverity()){var i=this.getCorrespondingElements(t);if(i)for(var n=0;n<i.size();n++){var s=i.get(n);e.oldValue?s.getAlarmState().decreaseAcknowledgedAlarm(t.getAlarmSeverity()):s.getAlarmState().decreaseNewAlarm(t.getAlarmSeverity()),e.newValue?s.getAlarmState().increaseAcknowledgedAlarm(t.getAlarmSeverity()):s.getAlarmState().increaseNewAlarm(t.getAlarmSeverity())}}},handleAlarmSeverityChange:function(t,e){var i=e.oldValue,n=e.newValue,s=this.getCorrespondingElements(t);if(s)for(var r=0;r<s.size();r++){var a=s.get(r);i&&(t.isAcked()?a.getAlarmState().decreaseAcknowledgedAlarm(i):a.getAlarmState().decreaseNewAlarm(i)),n&&(t.isAcked()?a.getAlarmState().increaseAcknowledgedAlarm(n):a.getAlarmState().increaseNewAlarm(n))}},getCorrespondingAlarms:function(t){return this._alarmElementMapping.getCorrespondingAlarms(t)},getCorrespondingElements:function(t){return this._alarmElementMapping.getCorrespondingElements(t)},handleElementAdded:function(t){var e=this.getCorrespondingAlarms(t);if(e)for(var i=0;i<e.size();i++){var n=e.get(i);if(!n.isCleared()){var s=n.getAlarmSeverity();s&&(n.isAcked()?t.getAlarmState().increaseAcknowledgedAlarm(s):t.getAlarmState().increaseNewAlarm(s))}}},_increaseAlarmState:function(t,e){if(!t.isCleared()||e){var i=t.getAlarmSeverity();if(i){var n=this.getCorrespondingElements(t);if(n)for(var s=0;s<n.size();s++){var r=n.get(s);t.isAcked()?r.getAlarmState().increaseAcknowledgedAlarm(i):r.getAlarmState().increaseNewAlarm(i)}}}},_decreaseAlarmState:function(t,e){if(!t.isCleared()||e){var i=t.getAlarmSeverity();if(i){var n=this.getCorrespondingElements(t);if(n)for(var s=0;s<n.size();s++){var r=n.get(s);t.isAcked()?r.getAlarmState().decreaseAcknowledgedAlarm(i):r.getAlarmState().decreaseNewAlarm(i)}}}},handleElementRemoved:function(t){var e=this.getCorrespondingAlarms(t);e&&e.forEach(function(e){!e.isCleared()&&e.getAlarmSeverity()&&(e.isAcked()?t.getAlarmState().decreaseAcknowledgedAlarm(e.getAlarmSeverity()):t.getAlarmState().decreaseNewAlarm(e.getAlarmSeverity()))})},removeAlarmsByElement:function(t){var e=this.getCorrespondingAlarms(t);e&&e.forEach(this.remove,this)},add:function(t,e){if(!t.IAlarm)throw"Only IAlarm can be added into AlarmBox";this._removeAlarmWhenAlarmIsCleared&&t.isCleared()||De.AlarmBox.superClass.add.apply(this,arguments)}}),De.AlarmElementMapping=function(t,e){if(!e)throw"ElementBox can not be null";if(!t)throw"AlarmBox can not be null";this._elementBox=e,this._alarmBox=t,this._alarmsFinder=new De.QuickFinder(t,"elementId")},Be.ext("twaver.AlarmElementMapping",Object,{getCorrespondingAlarms:function(t){return this._alarmsFinder.find(t.getId())},getCorrespondingElements:function(t){var e=this._elementBox.getDataById(t.getElementId());return new gn(e)},dispose:function(){this._alarmsFinder.dispose(),delete this._elementBox,delete this._alarmBox,delete this._alarmsFinder}}),De.AlarmStateStatistics=function(t){De.AlarmStateStatistics.superClass.constructor.apply(this,arguments),this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.elementMap={},this.setElementBox(t)},Be.ext("twaver.AlarmStateStatistics",De.PropertyChangeDispatcher,{getElementBox:function(){return this._elementBox},setElementBox:function(t){if(!t)throw"ElementBox can not be null";if(this._elementBox!==t){var e=this._elementBox;e&&(e.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),e.removeDataBoxChangeListener(this.handleElementBoxChange,this),this.severtiyMap={},this.elementMap={}),this._elementBox=t,this.reset(),t.addDataPropertyChangeListener(this.handleElementPropertyChange,this),t.addDataBoxChangeListener(this.handleElementBoxChange,this),this.firePropertyChange("elementBox",e,t)}},dispose:function(){this._elementBox.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),this._elementBox.removeDataBoxChangeListener(this.handleElementBoxChange,this),delete this._elementBox},handleElementPropertyChange:function(t){"alarmState"===t.property&&(this.increase(t.source),this.fireAlarmStateChange())},handleElementBoxChange:function(t){"add"===t.kind?(this.increase(t.data),this.fireAlarmStateChange()):"remove"===t.kind?(this.decrease(t.data),this.fireAlarmStateChange()):"clear"===t.kind&&(this.severtiyMap={},this.elementMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,De.AlarmSeverity.forEach(function(t){var e=this.getSumInfo(t);this.sumAcked+=e.ackedCount,this.sumNew+=e.newCount,this.sumTotal+=e.totalCount},this),this.firePropertyChange("alarmState",!1,!0)},getNewAlarmCount:function(t){if(!t)return this.sumNew;var e=this.getSumInfo(t);return e.newCount},getAcknowledgedAlarmCount:function(t){if(!t)return this.sumAcked;var e=this.getSumInfo(t);return e.ackedCount},getTotalAlarmCount:function(t){if(!t)return this.sumTotal;var e=this.getSumInfo(t);return e.totalCount},getSumInfo:function(t){var e=this.severtiyMap[t.name];return e||(e={},e.newCount=0,e.ackedCount=0,e.totalCount=0,this.severtiyMap[t.name]=e),e},decrease:function(t){var e=this.elementMap[t.getId()];e&&(delete this.elementMap[t.getId()],De.AlarmSeverity.forEach(function(t){var i=e[t.name],n=this.getSumInfo(t);n.newCount=n.newCount-i.newCount,n.ackedCount=n.ackedCount-i.ackedCount,n.totalCount=n.totalCount-i.totalCount},this))},increase:function(t){if(this.decrease(t),!this._filterFunction||this._filterFunction(t)){var e={};this.elementMap[t.getId()]=e,De.AlarmSeverity.forEach(function(i){var n={};n.newCount=t.getAlarmState().getNewAlarmCount(i),n.ackedCount=t.getAlarmState().getAcknowledgedAlarmCount(i),n.totalCount=t.getAlarmState().getAlarmCount(i),e[i.name]=n;var s=this.getSumInfo(i);s.newCount=s.newCount+n.newCount,s.ackedCount=s.ackedCount+n.ackedCount,s.totalCount=s.totalCount+n.totalCount},this)}},reset:function(){this.severtiyMap={},this.elementMap={},this._elementBox.forEach(this.increase,this),this.fireAlarmStateChange()},setFilterFunction:function(t){var e=this._filterFunction;this._filterFunction=t,this.reset(),this.firePropertyChange("filterFunction",e,t)},getFilterFunction:function(){return _filterFunction}}),De.LayerBox=function(t){De.LayerBox.superClass.constructor.call(this),this._elementBox=t,this._defaultLayer=new De.Layer(kn.LAYER_DEFAULT_ID,kn.LAYER_DEFAULT_NAME),this.add(this._defaultLayer)},Be.ext("twaver.LayerBox",De.DataBox,{_name:"LayerBox",getElementBox:function(){return this._elementBox},getDefaultLayer:function(){return this._defaultLayer},add:function(t,e){if(!t.ILayer)throw"Only ILayer can be added into LayerBox";De.LayerBox.superClass.add.apply(this,arguments)},removeById:function(t){if(t===this._defaultLayer.getId())throw"Cannot remove default layer";De.LayerBox.superClass.removeById.call(this,t)},getLayerByElement:function(t){if(!t)return null;if(t._layerId===kn.LAYER_DEFAULT_ID)return this._defaultLayer;var e=this.getDataById(t.getLayerId());return e?e:this._defaultLayer},clear:function(){this.toDatas().forEach(function(t){t!=this._defaultLayer&&this.removeById(t.getId())},this)}}),De.BundleLinks=function(t,e){this._links=t,this._siblings=e;var i,n,s=De.Styles.getStyle("link.bundle.expanded");for(i=0;i<t.size();i++){n=t.get(i);var r=n.getStyle("link.bundle.expanded",!1);if(null!=r){s=r;break}}if(null==s&&(s=!0),kn.LINK_BUNDLE_AGENT_FUNCTION){var a=kn.LINK_BUNDLE_AGENT_FUNCTION(t);null==a?a=t.get(0):a!=t.get(0)&&(t.remove(a),t.add(a,0))}for(i=0;i<t.size();i++)t.get(i).setStyle("link.bundle.expanded",s)},Be.ext("twaver.BundleLinks",Object,{getLinks:function(){return this._links},getSiblings:function(){return this._siblings},forEachSiblingLink:function(t,e){this._siblings.forEach(function(i){i.getLinks().forEach(t,e)})}});var In={bitsToNum:function(t){return t.reduce(function(t,e){return 2*t+e},0)},byteToBitArr:function(t){for(var e=[],i=7;i>=0;i--)e.push(!!(t&1<<i));return e},lzwDecode:function(t,e){for(var i,n,s=0,r=function(t){for(var i=0,n=0;t>n;n++)e.charCodeAt(s>>3)&1<<(7&s)&&(i|=1<<n),s++;return i},a=[],o=1<<t,h=o+1,l=t+1,c=[],u=function(){c=[],l=t+1;for(var e=0;o>e;e++)c[e]=[e];c[o]=[],c[h]=null};;)if(n=i,i=r(l),i!==o){if(i===h)break;if(i<c.length)n!==o&&c.push(c[n].concat(c[i][0]));else{if(i!==c.length)throw new Error("Invalid LZW code.");c.push(c[n].concat(c[n][0]))}a.push.apply(a,c[i]),c.length===1<<l&&12>l&&l++}else u();return a}},Rn=function(t){this.data=t,this.len=this.data.length,this.pos=0};Be.ext(Rn,Object,{readByte:function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return 255&this.data.charCodeAt(this.pos++)},readBytes:function(t){for(var e=[],i=0;t>i;i++)e.push(this.readByte());return e},read:function(t){for(var e="",i=0;t>i;i++)e+=String.fromCharCode(this.readByte());return e},readUnsigned:function(){var t=this.readBytes(2);return(t[1]<<8)+t[0]}});var Dn=function(t){var e,i=t,n=null,s=null,r=null,a=0,o=null,h=null,l=null;this.frames=[],this.size={};var c=this,u=Ve.createElement("canvas");this.loaded=!1;var d=function(){n=null,s=null,o=r,r=null,h=null};this.doParse=function(){Bn(i,y)};var f=function(t){e=t,c.size.width=e.width,c.size.height=e.height},g=function(t){_(),d(),n=t.transparencyGiven?t.transparencyIndex:null,s=t.delayTime,r=t.disposalMethod},_=function(){h&&c.frames.push({data:h.getImageData(0,0,e.width,e.height),delay:s})},p=function(t){h||(h=u.getContext("2d"));var i=c.frames.length,s=t.lctFlag?t.lct:e.gct;i>0&&(3===o?h.putImageData(c.frames[a].data,0,0):a=i-1,2===o&&(l||h.clearRect(l.leftPos,l.topPos,l.width,l.height)));var r=h.getImageData(t.leftPos,t.topPos,t.width,t.height);t.pixels.forEach(function(t,e){t!==n&&(r.data[4*e+0]=s[t][0],r.data[4*e+1]=s[t][1],r.data[4*e+2]=s[t][2],r.data[4*e+3]=255)}),h.putImageData(r,t.leftPos,t.topPos),l=t},v=function(){},m=function(t){return function(e){t(e)}},y={hdr:m(f),gce:m(g),com:m(v),app:{NETSCAPE:m(v)},img:m(p),eof:function(t){_(),c.loaded=!0}}},Bn=function(t,e){e||(e={});var i=function(e){for(var i=[],n=0;e>n;n++)i.push(t.readBytes(3));return i},n=function(){var e,i;i="";do e=t.readByte(),i+=t.read(e);while(0!==e);return i},s=function(){var n={};if(n.sig=t.read(3),n.ver=t.read(3),"GIF"!==n.sig)throw new Error("Not a GIF file.");n.width=t.readUnsigned(),n.height=t.readUnsigned();var s=In.byteToBitArr(t.readByte());n.gctFlag=s.shift(),n.colorRes=In.bitsToNum(s.splice(0,3)),n.sorted=s.shift(),n.gctSize=In.bitsToNum(s.splice(0,3)),n.bgColor=t.readByte(),n.pixelAspectRatio=t.readByte(),n.gctFlag&&(n.gct=i(1<<n.gctSize+1)),e.hdr&&e.hdr(n)},r=function(i){var s=function(i){var n=(t.readByte(),In.byteToBitArr(t.readByte()));i.reserved=n.splice(0,3),i.disposalMethod=In.bitsToNum(n.splice(0,3)),i.userInput=n.shift(),i.transparencyGiven=n.shift(),i.delayTime=t.readUnsigned(),i.transparencyIndex=t.readByte(),i.terminator=t.readByte(),e.gce&&e.gce(i)},r=function(t){t.comment=n(),e.com&&e.com(t)},a=function(i){t.readByte(),i.ptHeader=t.readBytes(12),i.ptData=n(),e.pte&&e.pte(i)},o=function(i){var s=function(i){t.readByte(),i.unknown=t.readByte(),i.iterations=t.readUnsigned(),i.terminator=t.readByte(),e.app&&e.app.NETSCAPE&&e.app.NETSCAPE(i)},r=function(t){t.appData=n(),e.app&&e.app[t.identifier]&&e.app[t.identifier](t)};switch(t.readByte(),i.identifier=t.read(8),i.authCode=t.read(3),i.identifier){case"NETSCAPE":s(i);break;default:r(i)}},h=function(t){t.data=n(),e.unknown&&e.unknown(t)};switch(i.label=t.readByte(),i.label){case 249:i.extType="gce",s(i);break;case 254:i.extType="com",r(i);break;case 1:i.extType="pte",a(i);break;case 255:i.extType="app",o(i);break;default:i.extType="unknown",h(i)}},a=function(s){var r=function(t,e){for(var i=new Array(t.length),n=t.length/e,s=function(n,s){var r=t.slice(s*e,(s+1)*e);i.splice.apply(i,[n*e,e].concat(r))},r=[0,4,2,1],a=[8,8,4,2],o=0,h=0;4>h;h++)for(var l=r[h];n>l;l+=a[h])s(l,o),o++;return i};s.leftPos=t.readUnsigned(),s.topPos=t.readUnsigned(),s.width=t.readUnsigned(),s.height=t.readUnsigned();var a=In.byteToBitArr(t.readByte());s.lctFlag=a.shift(),s.interlaced=a.shift(),s.sorted=a.shift(),s.reserved=a.splice(0,2),s.lctSize=In.bitsToNum(a.splice(0,3)),s.lctFlag&&(s.lct=i(1<<s.lctSize+1)),s.lzwMinCodeSize=t.readByte();var o=n();s.pixels=In.lzwDecode(s.lzwMinCodeSize,o),s.interlaced&&(s.pixels=r(s.pixels,s.width)),e.img&&e.img(s)},o=function(){var i={};switch(i.sentinel=t.readByte(),String.fromCharCode(i.sentinel)){case"!":i.type="ext",r(i);break;case",":i.type="img",a(i);break;case";":i.type="eof",e.eof&&e.eof(i);break;default:throw new Error("Unknown block: 0x"+i.sentinel.toString(16))}"eof"!==i.type&&setTimeout(o,0)},h=function(){s(),setTimeout(o,0)};h()},Nn=function(t,e,i){var n=Ve.createElement("canvas");return zn(n,e.width,e.height),n.getContext("2d").clearRect(0,0,e.width,e.height),n.getContext("2d").putImageData(t[i].data,0,0),n},zn=function(t,e,i){t.width=e,t.height=i,t.style.width=e+"px",t.style.height=i+"px"};De.Data=function(t){if(De.Data.superClass.constructor.apply(this,arguments),this._childList=new gn,this._childMap={},this._clientMap={},t===e||null===t)this._id=Be.id();else if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)this._id=t;else{for(var i in t)if("clients"===i)for(var n in t.clients)this._clientMap[n]=t.clients[n];else if("styles"===i)for(var s in t.styles)this._styleMap[s]=t.styles[s];else null!=t[i]&&("id"===i?this._id=t[i]:this[Be.setter(i)]&&this[Be.setter(i)](t[i]));null==this._id&&(this._id=Be.id())}},Be.ext("twaver.Data",De.PropertyChangeDispatcher,{IData:!0,IClient:!0,__client:1,__new:1,_parent:null,__accessor:["name","name2","icon","toolTip"],_icon:kn.ICON_DATA,getId:function(){return this._id},getChildren:function(){return this._childList},getChildrenSize:function(){return this._childList.size()},toChildren:function(t,e){return this._childList.toList(t,e)},addChild:function(t,i){return i===e&&(i=this._childList.size()),!(!t||t===this)&&(!this._childMap[t.getId()]&&(!this.isDescendantOf(t)&&(t.getParent()&&t.getParent().removeChild(t),(0>i||i>this._childList.size())&&(i=this._childList.size()),this._childList.add(t,i),this._childMap[t._id]=t,t.setParent(this),this.firePropertyChange("children",null,t),this.onChildAdded(t,i),!0)))},onChildAdded:function(t,e){},removeChild:function(t){if(!t)return!1;if(!this._childMap[t._id])return!1;var e=this._childList.remove(t);return delete this._childMap[t._id],this.firePropertyChange("children",t,null),t.setParent(null),this.onChildRemoved(t,e),!0},onChildRemoved:function(t,e){},getChildAt:function(t){return this._childList.get(t)},clearChildren:function(){if(0===this._childList.size())return!1;for(var t=this._childList.toArray(),e=t.length,i=0;e>i;i++)this.removeChild(t[i]);return this.onChildrenCleared(t),!0},onChildrenCleared:function(t){},getParent:function(){return this._parent},setParent:function(t){if(!(this._isUpdatingParent||this._parent===t||this===t||t&&t.isDescendantOf(this))){var e=this._parent;this._parent=t,this._isUpdatingParent=!0,e&&e.removeChild(this),t&&t.addChild(this),delete this._isUpdatingParent,this.firePropertyChange("parent",e,t),this.onParentChanged(e,t)}},onParentChanged:function(t,e){},hasChildren:function(){return this._childList.size()>0},isRelatedTo:function(t){return!!t&&(this.isDescendantOf(t)||t.isDescendantOf(this))},isParentOf:function(t){return!!t&&null!=this._childMap[t._id]},isDescendantOf:function(t){if(!t)return!1;if(!t.hasChildren())return!1;for(var e=this._parent;e;){if(t===e)return!0;e=e.getParent()}return!1},toString:function(){return this.getName()?this.getName():this._id}}),De.Alarm=function(t,e,i,n,s){De.Alarm.superClass.constructor.call(this,t),this._elementId=e,this._alarmSeverity=i,this._acked=n||!1,this._cleared=s||!1},Be.ext("twaver.Alarm",De.Data,{IAlarm:!0,getElementId:function(){return this._elementId},__accessor:["acked","cleared","alarmSeverity"]}),De.Layer=function(t){De.Layer.superClass.constructor.call(this,t)},Be.ext("twaver.Layer",De.Data,{ILayer:!0,__accessor:["visible","movable","editable","rotatable"],_visible:!0,_movable:!0,_editable:!0,_rotatable:!0,_name:"Default"}),De.Element=function(t){this._styleMap=this._styleMap||{},this._alarmState=new De.AlarmState(this),De.Element.superClass.constructor.call(this,t)},Be.ext("twaver.Element",De.Data,{IElement:!0,IStyle:!0,__accessor:["layerId"],__bool:["visible","movable"],__style:1,_layerId:kn.LAYER_DEFAULT_ID,_visible:!0,_movable:!0,getAlarmState:function(){return this._alarmState},isAdjustedToBottom:function(){return!1},getElementUIClass:function(){return null},getCanvasUIClass:function(){return null},getVectorUIClass:function(){return null},s:function(t,i){return i===e?this.getStyle(t):(this.setStyle(t,i),this)}}),De.Dummy=function(t){De.Dummy.superClass.constructor.call(this,t)},Be.ext("twaver.Dummy",De.Element,{IDummy:!0});var On=function(t){this._location={x:0,y:0},On.superClass.constructor.call(this,t)};De.Node=On,On.IS_INTERESTED_NODE_PROPERTY={location:1,width:1,height:1,expanded:1},Be.ext("twaver.Node",De.Element,{_icon:kn.ICON_NODE,_image:kn.IMAGE_NODE,_imageUrl:null,_angle:0,getLoopedLinks:function(){return this._loopedLinks},getLinks:function(){return this._links},getAgentLinks:function(){return this._agentLinks},getFollowers:function(){return this._followers},_addFollower:function(t){this._followers||(this._followers=new gn),this._followers.add(t)},_removeFollower:function(t){this._followers.remove(t),this._followers.isEmpty()&&delete this._followers},getFromLinks:function(){return this._fromLinks},getToLinks:function(){return this._toLinks},_addFromLink:function(t){this._links||(this._links=new gn((!1))),this._fromLinks||(this._fromLinks=new gn((!1))),this._links.add(t),this._toLinks&&this._toLinks.contains(t)&&(this._loopedLinks||(this._loopedLinks=new gn((!1))),this._loopedLinks.add(t)),this._fromLinks.add(t)},_addToLink:function(t){this._links||(this._links=new gn((!1))),this._toLinks||(this._toLinks=new gn((!1))),this._links.add(t),this._fromLinks&&this._fromLinks.contains(t)&&(this._loopedLinks||(this._loopedLinks=new gn((!1))),this._loopedLinks.add(t)),this._toLinks.add(t)},_removeFromLink:function(t){this._links&&this._links.remove(t),this._fromLinks&&this._fromLinks.remove(t),this._loopedLinks&&this._loopedLinks.remove(t)},_removeToLink:function(t){this._links&&this._links.remove(t),this._toLinks&&this._toLinks.remove(t),this._loopedLinks&&this._loopedLinks.remove(t)},hasAgentLinks:function(){return null!=this._agentLinks&&!this._agentLinks.isEmpty()},getFromAgentLinks:function(){return this._fromAgentLinks},getToAgentLinks:function(){return this._toAgentLinks},_addFromAgentLink:function(t){this._fromAgentLinks||(this._fromAgentLinks=new gn((!1))),this._agentLinks||(this._agentLinks=new gn((!1))),this._fromAgentLinks.add(t),this._agentLinks.add(t)},_addToAgentLink:function(t){this._toAgentLinks||(this._toAgentLinks=new gn((!1))),this._agentLinks||(this._agentLinks=new gn((!1))),this._toAgentLinks.add(t),this._agentLinks.add(t)},_removeFromAgentLink:function(t){this._fromAgentLinks&&this._fromAgentLinks.remove(t),this._agentLinks&&this._agentLinks.remove(t)},_removeToAgentLink:function(t){this._toAgentLinks&&this._toAgentLinks.remove(t),this._agentLinks&&this._agentLinks.remove(t)},getImage:function(){return this._image},setImage:function(t){var e=this._image,i=this.getWidth(),n=this.getHeight();this._image=t,this.firePropertyChange("image",e,t),this.firePropertyChange("width",i,this.getWidth()),this.firePropertyChange("height",n,this.getHeight())},getImageUrl:function(){return this._imageUrl},setImageUrl:function(t){if(this._imageUrl!=t){var e=this._imageUrl;this._imageUrl=t,Pn.images[t]||De.imageUtil.registerImageByUrl(t,"svg"===De.imageUtil.getImageType(t),t),this.setImage(t),this.firePropertyChange("imageUrl",e,t)}},getX:function(){return this._location.x},getY:function(){return this._location.y},setX:function(t){this.setLocation(t,this._location.y)},setY:function(t){this.setLocation(this._location.x,t)},getLocation:function(){return this._location},setLocation:function(t,e){var i;if(i=2===arguments.length?{x:arguments[0],y:arguments[1]}:arguments[0],Be.num(i.x)&&Be.num(i.y)&&(i.x!==this._location.x||i.y!==this._location.y)){var n=this._location;this._location=i,this.firePropertyChange("location",n,i)}},getCenterLocation:function(){return kn.CENTER_LOCATION?this._location:{x:this.getX()+this.getWidth()/2,y:this.getY()+this.getHeight()/2}},setCenterLocation:function(t,e){var i;i=2===arguments.length?{x:arguments[0],y:arguments[1]}:Be.clone(arguments[0]),Be.num(i.x)&&Be.num(i.y)&&(kn.CENTER_LOCATION||(i.x-=this.getWidth()/2,i.y-=this.getHeight()/2),this.setLocation(i))},translate:function(t,e){this.setLocation(this.getX()+t,this.getY()+e)},getWidth:function(){if(Be.num(this._width)&&this._width>=0)return this._width;if("object"!=typeof this._image){var t=Be.getImageAsset(this._image);if(t){var e=t.getWidth();return Be.num(e)&&e>=0?e:(t=t._image,Ki(this,t,t,"w"))}}else if(this._image)return this._image.w;return kn.NODE_WIDTH},setWidth:function(t){var e=this._width;this._width=t,this.firePropertyChange("width",e,t)},getHeight:function(){if(Be.num(this._height)&&this._height>=0)return this._height;if("object"!=typeof this._image){var t=Be.getImageAsset(this._image);if(t){var e=t.getHeight();return Be.num(e)&&e>=0?e:(t=t._image,Ki(this,t,t,"h"))}}else if(this._image)return this._image.h;return kn.NODE_HEIGHT},setHeight:function(t){var e=this._height;this._height=t,this.firePropertyChange("height",e,t)},setSize:function(){2===arguments.length?(this.setWidth(arguments[0]),this.setHeight(arguments[1])):(this.setWidth(arguments[0].width),this.setHeight(arguments[0].height))},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getRect:function(){var t=this.getOriginalRect();if(0===this._angle)return t;for(var e=Ge.createMatrix(this._angle*Math.PI/180,t.x+t.width/2,t.y+t.height/2),i=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}],n=0,s=i.length;s>n;n++)i[n]=e.transform(i[n]);var r=Ge.getRect(i);return r},getOriginalRect:function(){var t=this,e=t.getWidth(),i=t.getHeight();return kn.CENTER_LOCATION?{x:t._location.x-e/2,y:t._location.y-i/2,width:e,height:i}:{x:t.getX(),y:t.getY(),width:e,height:i}},getAngle:function(){return this._angle},setAngle:function(t){var e=this._angle;this._angle=t%360,this.firePropertyChange("angle",e,this._angle)},onParentChanged:function(t,e){On.superClass.onParentChanged.call(this,t,e),this._checkLinkAgent()},_checkLinkAgent:function(){if(De._isInitializing){if(this._links)for(var t=this._links.size(),e=0;t>e;e++)this._links.get(e)._checkAgentNode()}else De.ElementBox.prototype.startBatch(function(){if(this._links)for(var t=this._links.size(),e=0;t>e;e++)this._links.get(e)._checkAgentNode()},this)},onPropertyChanged:function(t){
if(On.superClass.onPropertyChanged.call(this,t),this._followers)for(var e=this._followers.size(),i=0;e>i;i++)this._followers.get(i).handleHostPropertyChange(t);this.getParent()instanceof Vn&&On.IS_INTERESTED_NODE_PROPERTY[t.property]&&this.getParent().updateLocationFromChildren()},getElementUIClass:function(){return De.network.NodeUI},getCanvasUIClass:function(){return De.canvas.NodeUI},getVectorUIClass:function(){return De.vector.NodeUI}});var Fn=function(t){Fn.superClass.constructor.call(this,t)};De.HTMLNode=Fn,Be.ext("twaver.HTMLNode",De.Node,{getElementUIClass:function(){return De.network.HTMLNodeUI},getCanvasUIClass:function(){return De.canvas.HTMLNodeUI},getVectorUIClass:function(){return De.vector.HTMLNodeUI}}),De.Link=function(t,e,i){De.Link.superClass.constructor.call(this,t instanceof On?null:t),t instanceof On&&(i=e,e=t),e&&this.setFromNode(e),i&&this.setToNode(i)},De.Link.IS_INTERESTED_BUNDLE_STYLE={"link.bundle.enable":1,"link.bundle.id":1,"link.bundle.independent":1},Be.ext("twaver.Link",De.Element,{_fromNode:null,_toNode:null,_fromAgent:null,_toAgent:null,_icon:kn.ICON_LINK,getFromNode:function(){return this._fromNode},getToNode:function(){return this._toNode},getFromAgent:function(){return this._fromAgent},getToAgent:function(){return this._toAgent},setFromNode:function(t){if(this._fromNode!==t){var e=this._fromNode;this._fromNode=t,e&&e._removeFromLink(this),this._fromNode&&this._fromNode._addFromLink(this),this._checkAgentNode(),this.firePropertyChange("fromNode",e,t)}},setToNode:function(t){if(this._toNode!==t){var e=this._toNode;this._toNode=t,e&&e._removeToLink(this),this._toNode&&this._toNode._addToLink(this),this._checkAgentNode(),this.firePropertyChange("toNode",e,t)}},isLooped:function(){return this._fromNode===this._toNode&&null!=this._fromNode&&null!=this._toNode},_checkAgentNode:function(){De._isInitializing?De._links[this._id]||(De._links[this._id]=this):this._checkAgentNodeImpl()},_checkAgentNodeImpl:function(){var t,e,i=xi.figureFromAgent(this),n=this;this._fromAgent!=i&&(t=this._fromAgent,this._fromAgent&&this._fromAgent._removeFromAgentLink(this),this._fromAgent=i,this._fromAgent&&this._fromAgent._addFromAgentLink(this),this.firePropertyChange("fromAgent",t,this._fromAgent),De._isInitializing?(t&&this._toAgent&&(e=t._id+":"+this._toAgent._id,De._bundleLinks[e]||(De._bundleLinks[e]=[t,this._toAgent])),this._fromAgent&&this._toAgent&&(e=this._fromAgent._id+":"+this._toAgent._id,De._bundleLinks[e]||(De._bundleLinks[e]=[this._fromAgent,this._toAgent]))):(xi.resetBundleLinks(t,n._toAgent),xi.resetBundleLinks(n._fromAgent,n._toAgent)));var s=xi.figureToAgent(this);this._toAgent!=s&&(t=this._toAgent,this._toAgent&&this._toAgent._removeToAgentLink(this),this._toAgent=s,this._toAgent&&this._toAgent._addToAgentLink(this),this.firePropertyChange("toAgent",t,this._toAgent),De._isInitializing?(t&&this._fromAgent&&(e=t._id+":"+this._fromAgent._id,De._bundleLinks[e]||(De._bundleLinks[e]=[t,this._fromAgent])),this._toAgent&&this._fromAgent&&(e=this._toAgent._id+":"+this._fromAgent._id,De._bundleLinks[e]||(De._bundleLinks[e]=[this._toAgent,this._fromAgent]))):(xi.resetBundleLinks(t,n._fromAgent),xi.resetBundleLinks(n._toAgent,n._fromAgent)))},_setBundleLinks:function(t){this._bundleLinks=t,this.firePropertyChange("bundleLinks",!0,!1)},getBundleLinks:function(){return this._bundleLinks},getBundleCount:function(){return this._bundleLinks?this._bundleLinks.getLinks().size():1},getBundleIndex:function(){return this._bundleLinks?this._bundleLinks.getLinks().indexOf(this):0},reverseBundleExpanded:function(){if(this._bundleLinks&&this._bundleLinks.getLinks().size()>0){var t,e,i=this._bundleLinks.getLinks(),n=!this.getStyle("link.bundle.expanded");for(t=0;t<i.size();t++)e=i.get(t),e.setStyle("link.bundle.expanded",n);var s=this._bundleLinks.getSiblings();for(t=0;t<s.size();t++){var r=s.get(t);if(r!=this._bundleLinks){i=r.getLinks();for(var a=0;a<i.size();a++)e=i.get(a),e.firePropertyChange("bundleLinks",null,r)}}return!0}return!1},isBundleAgent:function(){return null!=this._bundleLinks&&this._bundleLinks.getLinks().size()>1&&this===this._bundleLinks.getLinks().get(0)&&!this.getStyle("link.bundle.expanded")},onStyleChanged:function(t,e,i){De.Link.superClass.onStyleChanged.call(this,t,e,i),De.Link.IS_INTERESTED_BUNDLE_STYLE[t]&&xi.resetBundleLinks(this._toAgent,this._fromAgent)},getElementUIClass:function(){return De.network.LinkUI},getCanvasUIClass:function(){return De.canvas.LinkUI},getVectorUIClass:function(){return De.vector.LinkUI},isAdjustedToBottom:function(){return kn.IS_LINK_ADJUSTED_TO_BOTTOM}}),De.HTMLLink=function(t,e,i){De.HTMLLink.superClass.constructor.call(this,t,e,i)},De.Util.ext("twaver.HTMLLink",De.Link,{getElementUIClass:function(){return De.network.HTMLLinkUI},getCanvasUIClass:function(){return De.canvas.HTMLLinkUI},getVectorUIClass:function(){return De.vector.HTMLLinkUI}}),De.Follower=function(t){this._isUpdatingFollower=!1,this._isUpdatingLocation=!1,De.Follower.superClass.constructor.call(this,t)},De.Follower.IS_INTERESTED_HOST_GRID_PROPERTY={location:1,width:1,height:1,"S:grid.row.count":1,"S:grid.column.count":1,"S:grid.row.percents":1,"S:grid.column.percents":1,"S:grid.border":1,"S:grid.border.left":1,"S:grid.border.right":1,"S:grid.border.top":1,"S:grid.border.bottom":1,"S:grid.padding":1,"S:grid.padding.left":1,"S:grid.padding.right":1,"S:grid.padding.top":1,"S:grid.padding.bottom":1},De.Follower.IS_INTERESTED_FOLLOWER_STYLE={"follower.row.index":1,"follower.column.index":1,"follower.row.span":1,"follower.column.span":1,"follower.padding":1,"follower.padding.left":1,"follower.padding.right":1,"follower.padding.top":1,"follower.padding.bottom":1},Be.ext("twaver.Follower",On,{_host:null,getHost:function(){return this._host},setHost:function(t){if(this!==t&&this._host!==t){var e=this._host;e&&e._removeFollower(this),this._host=t,this._host&&this._host._addFollower(this),this.firePropertyChange("host",e,t),this.onHostChanged(e,t)}},onStyleChanged:function(t,e,i){De.Follower.superClass.onStyleChanged.call(this,t,e,i),De.Follower.IS_INTERESTED_FOLLOWER_STYLE[t]&&this.updateFollower(null)},setLocation:function(){this._isUpdatingLocation||(this._isUpdatingLocation=!0,De.Follower.superClass.setLocation.apply(this,arguments),this._isUpdatingLocation=!1)},onHostChanged:function(t,e){this.updateFollower(null)},handleHostPropertyChange:function(t){this.updateFollower(t)},updateFollower:function(t){this._isUpdatingFollower||Be.isDeserializing||(this._isUpdatingFollower=!0,this.updateFollowerImpl(t),this._isUpdatingFollower=!1)},updateFollowerImpl:function(t){var e=this.getHost();if(e instanceof De.Grid){if(!t||De.Follower.IS_INTERESTED_HOST_GRID_PROPERTY[t.property]){var i=this.getStyle("follower.row.index"),n=this.getStyle("follower.column.index"),s=e.getCellRect(i,n);if(!s)return;var r=this.getStyle("follower.row.span"),a=this.getStyle("follower.column.span");if(1!=r||1!=a){var o=e.getCellRect(i+r-1,n+a-1);o&&(s=Ge.unionRect(s,o))}if(Ge.addPadding(s,this,"follower.padding"),this.getStyle("follower.fill.cell"))this.setLocation(s.x,s.y),this.setWidth(s.width),this.setHeight(s.height);else{var h=this.getStyle("follower.cell.position");s=Ye.get(h,s,this.getRect()),this.setLocation(s.x,s.y)}}}else if(null!=t&&"location"===t.property){var l=t.oldValue,c=t.newValue,u=this.getLocation();this.setLocation(u.x+(c.x-l.x),u.y+(c.y-l.y))}},isHostOn:function(t){if(!t)return!1;for(var e={},i=this._host;i&&i!=this&&!e[i.getId()];){if(i===t)return!0;e[i.getId()]=i,i=i instanceof De.Follower?i.getHost():null}return!1},isLoopedHostOn:function(t){return this.isHostOn(t)&&t.isHostOn(this)}});var Vn=function(t){this._isUpdatingLocationFromChildren=!1,this._isAdjusting=!1,this._expanded=!1,Vn.superClass.constructor.call(this,t)};De.Group=Vn,Be.ext("twaver.Group",De.Follower,{_image:kn.IMAGE_GROUP,_icon:kn.ICON_GROUP,isAdjustedToBottom:function(){return this.isExpanded()&&xi.hasAgentLinks(this)},onChildAdded:function(t,e){Vn.superClass.onChildAdded.apply(this,arguments),this.updateLocationFromChildren()},onChildRemoved:function(t,e){Vn.superClass.onChildRemoved.apply(this,arguments),this.updateLocationFromChildren()},updateLocationFromChildren:function(){if(!this._isAdjusting&&!Be.isDeserializing){for(var t,e,i=0,n=this.getChildrenSize();n>i;i++)e=this.getChildAt(i),e instanceof On&&(t=Ge.unionRect(t,this.getChildRect(e)));t&&(this._isUpdatingLocationFromChildren=!0,this.setLocation(t.x+t.width/2-this.getWidth()/2,t.y+t.height/2-this.getHeight()/2),this._isUpdatingLocationFromChildren=!1)}},getChildRect:function(t){var e;return t instanceof On&&(t instanceof Vn?(t.isExpanded()&&t.getChildren().forEach(function(i){e=Ge.unionRect(e,t.getChildRect(i))}),e||(e=t.getRect())):e=t.getRect()),e},setLocation:function(){if(!this._isAdjusting){var t;if(t=2===arguments.length?{x:arguments[0],y:arguments[1]}:arguments[0],!Be.isDeserializing&&!this._isUpdatingLocationFromChildren){this._isAdjusting=!0;var e=t.x-this.getX(),i=t.y-this.getY();xi.moveElements(this.getChildren(),e,i),this._isAdjusting=!1}Vn.superClass.setLocation.call(this,t)}},reverseExpanded:function(){this.setExpanded(!this.isExpanded())},isExpanded:function(){return this._expanded},setExpanded:function(t){if(this._expanded!==t){var e=this._expanded;this._expanded=t,this.firePropertyChange("expanded",e,this._expanded),this._checkLinkAgent()}},_checkLinkAgent:function(){Vn.superClass._checkLinkAgent.call(this);for(var t=this.getChildrenSize(),e=0;t>e;e++){var i=this.getChildAt(e);i instanceof On&&i._checkLinkAgent()}},getElementUIClass:function(){return De.network.GroupUI},getCanvasUIClass:function(){return De.canvas.GroupUI},getVectorUIClass:function(){return De.vector.GroupUI}}),De.SubNetwork=function(t){De.SubNetwork.superClass.constructor.call(this,t)},Be.ext("twaver.SubNetwork",De.Follower,{ISubNetwork:!0,_image:kn.IMAGE_SUBNETWORK,_icon:kn.ICON_SUBNETWORK,_checkLinkAgent:function(){De.SubNetwork.superClass._checkLinkAgent.call(this);for(var t=this.getChildrenSize(),e=0;t>e;e++){var i=this.getChildAt(e);i instanceof On&&i._checkLinkAgent()}}}),De.Grid=function(t){De.Grid.superClass.constructor.call(this,t)},Be.ext("twaver.Grid",De.Follower,{_icon:kn.ICON_GRID,_image:null,getCellObject:function(t,e){1===arguments.length&&(e=t.y,t=t.x);for(var i=this.getStyle("grid.row.count"),n=this.getStyle("grid.column.count"),s=0;i>s;s++)for(var r=0;n>r;r++){var a=this.getCellRect(s,r);if(Ge.containsPoint(a,t,e))return{rowIndex:s,columnIndex:r,rect:a}}return null},getCellRect:function(t,e){var i=this.getStyle("grid.row.count"),n=this.getStyle("grid.column.count");if(0>=i||0>=n)return null;if(0>t||t>=i)return null;if(0>e||e>=n)return null;var s=this.getRect();Ge.addPadding(s,this,"grid.border");var r=0,a=this.getStyle("grid.row.percents"),o=this.getStyle("grid.column.percents");if(a&&a.length===i){var h=0;for(r=0;t>r;r++)h+=s.height*a[r];s.y+=h,s.height=s.height*a[t]}else s.height=s.height/i,s.y+=s.height*t;if(o&&o.length===n){var l=0;for(r=0;e>r;r++)l+=s.width*o[r];s.x+=l,s.width=s.width*o[e]}else s.width=s.width/n,s.x+=s.width*e;return Ge.addPadding(s,this,"grid.padding"),s},getElementUIClass:function(){return De.network.GridUI},getCanvasUIClass:function(){return De.canvas.GridUI},getVectorUIClass:function(){return De.vector.GridUI}}),De.ShapeNode=function(t){this._isUpdatingShapeNode=!1,this._points=new gn,De.ShapeNode.superClass.constructor.call(this,t)},Be.ext("twaver.ShapeNode",De.Follower,{_icon:kn.ICON_SHAPENODE,__accessor:["segments"],getElementUIClass:function(){return De.network.ShapeNodeUI},getCanvasUIClass:function(){return De.canvas.ShapeNodeUI},getVectorUIClass:function(){return De.vector.ShapeNodeUI},getPoints:function(){return this._points},setPoints:function(t){t||(t=new gn);var e=new gn(this._points);this._points=t,this.firePointsChange(e,this._points)},getSegments:function(){return this._segments},setSegments:function(t){t||(t=new gn);var e=new gn(this._segments);this._segments=t,this._reCalculateLineLength(),this.firePropertyChange("segments",e,this._segments)},addPoint:function(t,e){var i=new gn(this._points);this._points.add(t,e),this.firePointsChange(i,this._points)},setPoint:function(t,e){var i=new gn(this._points);this._points.set(t,e),this.firePointsChange(i,this._points)},removePoint:function(t){var e=new gn(this._points);this._points.remove(t),this.firePointsChange(e,this._points)},removeAt:function(t){var e=new gn(this._points);this._points.removeAt(t),this.firePointsChange(e,this._points)},setWidth:function(t){if(1>t&&(t=1),!this._isUpdatingShapeNode&&!Be.isDeserializing){this._isUpdatingShapeNode=!0;for(var e=new gn(this._points),i=0;i<this._points.size();i++){var n=this._points.get(i);n.x=(n.x-this.getX())*t/this.getWidth()+this.getX()}this.firePointsChange(e,this._points),this._isUpdatingShapeNode=!1}De.ShapeNode.superClass.setWidth.apply(this,arguments)},setHeight:function(t){if(1>t&&(t=1),!this._isUpdatingShapeNode&&!Be.isDeserializing){this._isUpdatingShapeNode=!0;for(var e=new gn(this._points),i=0;i<this._points.size();i++){var n=this._points.get(i);n.y=(n.y-this.getY())*t/this.getHeight()+this.getY()}this.firePointsChange(e,this._points),this._isUpdatingShapeNode=!1}De.ShapeNode.superClass.setHeight.apply(this,arguments)},setLocation:function(){if(!this._isUpdatingShapeNode&&!Be.isDeserializing){var t;if(t=2===arguments.length?{x:arguments[0],y:arguments[1]}:arguments[0],!Be.num(t.x)||!Be.num(t.y))return;var e=t.x-this.getX(),i=t.y-this.getY();if(0===e&&0===i)return;this._isUpdatingShapeNode=!0;for(var n=new gn(this._points),s=0;s<this._points.size();s++){var r=this._points.get(s);r.x+=e,r.y+=i}this.firePointsChange(n,this._points),this._isUpdatingShapeNode=!1}De.ShapeNode.superClass.setLocation.apply(this,arguments)},firePointsChange:function(t,e){if(!this._isUpdatingShapeNode&&!Be.isDeserializing){var i=Ge.getRect(e);i?(this._isUpdatingShapeNode=!0,kn.CENTER_LOCATION?this.setLocation(i.x+i.width/2,i.y+i.height/2):this.setLocation(i.x,i.y),this.setWidth(i.width),this.setHeight(i.height),this._isUpdatingShapeNode=!1):(this._isUpdatingShapeNode=!0,this.setWidth(0),this.setHeight(0),this._isUpdatingShapeNode=!1)}this._reCalculateLineLength(),this.firePropertyChange("points",t,e)},_reCalculateLineLength:function(){this._lineLength=null!=this._points&&this._points.size()>0?Ge.calculateLineLength(this._points,this._segments):0},getLineLength:function(){return this._lineLength}}),De.Bus=function(t){this._styleMap={},this._styleMap["vector.fill"]=!1,this._styleMap["shapenode.closed"]=!1,De.Bus.superClass.constructor.call(this,t)},Be.ext("twaver.Bus",De.ShapeNode,{_icon:kn.ICON_BUS,firePointsChange:function(t,e){var i=e.size();if(!Be.isDeserializing&&i>=2)for(var n=e.get(0),s=1;i>s;s++){var r=e.get(s);Math.abs(r.x-n.x)>Math.abs(r.y-n.y)?r.y=n.y:r.x=n.x,n=r}De.Bus.superClass.firePointsChange.apply(this,arguments)}}),De.ShapeLink=function(t,e,i){this._points=new gn,this._styleMap={},this._styleMap["link.bundle.enable"]=!1,De.ShapeLink.superClass.constructor.call(this,t,e,i)},Be.ext("twaver.ShapeLink",De.Link,{_icon:kn.ICON_SHAPELINK,getElementUIClass:function(){return De.network.ShapeLinkUI},getCanvasUIClass:function(){return De.canvas.ShapeLinkUI},getVectorUIClass:function(){return De.vector.ShapeLinkUI},getPoints:function(){return this._points},setPoints:function(t){t||(t=new gn);var e=new gn(this._points);this._points=t,this.firePointsChange(e,this._points)},addPoint:function(t,e){var i=new gn(this._points);this._points.add(t,e),this.firePointsChange(i,this._points)},setPoint:function(t,e){var i=new gn(this._points);this._points.set(t,e),this.firePointsChange(i,this._points)},removePoint:function(t){var e=new gn(this._points);this._points.remove(t),this.firePointsChange(e,this._points)},removeAt:function(t){var e=new gn(this._points);this._points.removeAt(t),this.firePointsChange(e,this._points)},firePointsChange:function(t,e){this.firePropertyChange("points",t,e)}}),De.ShapeSubNetwork=function(t){De.ShapeSubNetwork.superClass.constructor.call(this,t)},Be.ext("twaver.ShapeSubNetwork",De.ShapeNode,{ISubNetwork:!0,_icon:kn.ICON_SHAPESUBNETWORK,_checkLinkAgent:function(){De.ShapeSubNetwork.superClass._checkLinkAgent.call(this);for(var t=this.getChildrenSize(),e=0;t>e;e++){var i=this.getChildAt(e);i instanceof On&&i._checkLinkAgent()}}}),De.LinkSubNetwork=function(){De.LinkSubNetwork.superClass.constructor.apply(this,arguments)},Be.ext("twaver.LinkSubNetwork",De.Link,{ISubNetwork:!0,_icon:kn.ICON_LINKSUBNETWORK}),De.ShapeLinkSubNetwork=function(){De.ShapeLinkSubNetwork.superClass.constructor.apply(this,arguments)},Be.ext("twaver.ShapeLinkSubNetwork",De.ShapeLink,{ISubNetwork:!0,_icon:kn.ICON_LINKSUBNETWORK}),De.RotatableNode=function(t){De.RotatableNode.superClass.constructor.call(this,t)},Be.ext("twaver.RotatableNode",De.Follower,{getWidth:function(){return 0==this._angle?this._getOrignalWidth():this._getRotateRect().width},setWidth:function(t){},getHeight:function(){return 0==this._angle?this._getOrignalHeight():this._getRotateRect().height},setHeight:function(t){},getElementUIClass:function(){return De.network.RotatableNodeUI},getCanvasUIClass:function(){return De.canvas.RotatableNodeUI},getVectorUIClass:function(){return De.vector.RotatableNodeUI},_getRotateRect:function(){for(var t=this._getOrignalWidth(),e=this._getOrignalHeight(),i=Ge.createMatrix(this._angle*Math.PI/180,t/2,e/2),n=[{x:0,y:0},{x:t,y:0},{x:t,y:e},{x:0,y:e}],s=0,r=n.length;r>s;s++)n[s]=i.transform(n[s]);return Ge.getRect(n)},_getOrignalWidth:function(){return De.RotatableNode.superClass.getWidth.call(this)},_getOrignalHeight:function(){return De.RotatableNode.superClass.getHeight.call(this)}}),De.controls.ControlBase=function(){De.controls.ControlBase.superClass.constructor.apply(this,arguments),this._pools=new gn},Be.ext("twaver.controls.ControlBase",De.PropertyChangeDispatcher,{_autoAdjustBounds:!1,addPool:function(t){this._pools.contains(t)||this._pools.add(t)},removePool:function(t){this._pools.remove(t)},adjustBounds:function(t){var e=this._view.style;e.position="absolute",e.left=t.x+"px",e.top=t.y+"px",e.width=t.width+"px",e.height=t.height+"px",this._autoAdjustBounds===!0&&(e.left="0px",e.top="0px",e.right="0px",e.bottom="0px"),this.invalidate&&this.invalidate()},setAutoAdjustBounds:function(e){e===!0?je.addEventListener("resize","_handleResize",t,this):je.removeEventListener("resize",t,this),this._autoAdjustBounds=e},isAutoAdjustBounds:function(){return this._autoAdjustBounds},_handleResize:function(t){this.adjustBounds({x:0,y:0,width:Ve.documentElement.clientWidth,height:Ve.documentElement.clientHeight})},getView:function(){return this._view},invalidate:function(t){this._invalidate||(this._invalidate=!0,Be.callLater(this.validate,this,null,t))},validate:function(){this._invalidate&&(this._invalidate=!1,0===this._view.offsetWidth&&0===this._view.offsetHeight&&null!==this._reinvalidateCount?(this._reinvalidateCount===e&&(this._reinvalidateCount=100),this._reinvalidateCount>0?this._reinvalidateCount--:this._reinvalidateCount=null,this.invalidate()):this.validateImpl())},validateImpl:function(){}}),De.controls.ViewBase=function(){De.controls.ViewBase.superClass.constructor.apply(this,arguments),this._interactionDispatcher=new De.EventDispatcher,this._viewDispatcher=new De.EventDispatcher},Be.ext("twaver.controls.ViewBase",De.controls.ControlBase,{__bool:["focusOnClick"],_focusOnClick:kn.FOCUS_ON_CLICK,getSelectionModel:function(){return this._selectionModel?this._selectionModel:this._box.getSelectionModel()},isShareSelectionModel:function(){return null==this._selectionModel},setShareSelectionModel:function(t){var e=null==this._selectionModel;e!==t&&(t?(this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel.removeSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel.dispose(),this._selectionModel=null):(this._box.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel=new De.SelectionModel(this._box),this._selectionModel.addSelectionChangeListener(this.handleSelectionChange,this)),this.onShareSelectionModelChanged(),this.firePropertyChange("shareSelectionModel",e,t))},removeSelection:function(){if(0===this.getSelectionModel().size())return null;var t=this.getSelectionModel().toSelection();return this._box._undoManager._enabled&&this._box._undoManager.startBatch(),t.forEach(function(t){this._box.remove(t)},this),this._box._undoManager._enabled&&this._box._undoManager.endBatch(),t},selectAll:function(){var t=new gn;return this._box.forEach(function(e){this.isVisible(e)&&t.add(e)},this),this.getSelectionModel().setSelection(t),t},isSelected:function(t){return this.getSelectionModel().contains(t)},isSelectable:function(t){return this.getSelectionModel().isSelectable(t)},getLabel:function(t){return t.getName()},getToolTip:function(t){return t.getToolTip()},getIcon:function(t){return t.getIcon()},getSelectColor:function(t){return kn.SELECT_COLOR},addViewListener:function(t,e,i){this._viewDispatcher.add(t,e,i)},removeViewListener:function(t,e){this._viewDispatcher.remove(t,e)},fireViewEvent:function(t){this._viewDispatcher.fire(t)},addInteractionListener:function(t,e,i){this._interactionDispatcher.add(t,e,i)},removeInteractionListener:function(t,e){this._interactionDispatcher.remove(t,e)},fireInteractionEvent:function(t){this._interactionDispatcher.fire(t)},invalidate:function(t){this._invalidate||(this._invalidate=!0,this.fireViewEvent({kind:"invalidate"}),Be.callLater(this.validate,this,null,t))},validate:function(){this._invalidate&&(this._invalidate=!1,Oe||0!==this._view.offsetWidth||0!==this._view.offsetHeight||null===this._reinvalidateCount?(this._isValidating=!0,this.fireViewEvent({kind:"validateStart"}),this.validateImpl(),this.fireViewEvent({kind:"validateEnd"}),delete this._isValidating):(this._reinvalidateCount===e&&(this._reinvalidateCount=100),this._reinvalidateCount>0?this._reinvalidateCount--:this._reinvalidateCount=null,this.invalidate()))}}),De.controls.View=function(){De.controls.View.superClass.constructor.apply(this,arguments)},Be.ext("twaver.controls.View",De.controls.ViewBase,{_zoom:1,_maxZoom:kn.ZOOM_MAX,_minZoom:kn.ZOOM_MIN,getRootDiv:function(){return this._rootDiv},isValidEvent:function(t){return je.isValidEvent(this._view,t)},getAlarmFillColor:function(t){if(t.IElement){var e=t.getAlarmState().getHighestNewAlarmSeverity();if(e)return e.color}return null},getInnerColor:function(t){if(t.IElement){var e=t.getAlarmState().getHighestNativeAlarmSeverity();return e?e.color:t.getStyle("inner.color")}return null},getOuterColor:function(t){if(t.IElement){var e=t.getAlarmState().getPropagateSeverity();return e?e.color:t.getStyle("outer.color")}return null},zoomOverview:function(t){var e=Math.min(this._view.clientWidth/this._viewRect.width,this._view.clientHeight/this._viewRect.height);this.setZoom(e,t)},getLogicalPoint:function(t){return je.getLogicalPoint(this._view,t,this.getZoom(),this._rootDiv)},centerByLogicalPoint:function(t,e,i){i&&De.animate.AnimateManager.endAnimate();var n=this._view.scrollWidth-this._view.clientWidth,s=this._view.scrollHeight-this._view.clientHeight,r=(t-this._view.clientWidth/this._zoom/2)*this._zoom,a=(e-this._view.clientHeight/this._zoom/2)*this._zoom;0>r&&(r=0),0>a&&(a=0),r>n&&(r=n),a>s&&(a=s),i?De.animate.AnimateManager.start(new De.animate.AnimateScrollPosition(this._view,r,a)):(this._view.scrollLeft=r,this._view.scrollTop=a)},panByOffset:function(t,e){t*=this.getZoom(),e*=this.getZoom();var i=this._view.scrollLeft+t,n=this._view.scrollTop+e,s=this._view.scrollWidth-this._view.clientWidth,r=this._view.scrollHeight-this._view.clientHeight;0>i&&(i=0),i>s&&(i=s),0>n&&(n=0),n>r&&(n=r);var a={x:(i-this._view.scrollLeft)/this.getZoom(),y:(n-this._view.scrollTop)/this.getZoom()};return this._view.scrollLeft=i,this._view.scrollTop=n,a},getMaxZoom:function(){return this._maxZoom},setMaxZoom:function(t){if(!(0>t)){var e=this._maxZoom;this._maxZoom=t,this.firePropertyChange("maxZoom",e,t),this.getZoom()>t&&this.setZoom(t)}},getMinZoom:function(){return this._minZoom},setMinZoom:function(t){if(!(0>t)){var e=this._minZoom;this._minZoom=t,this.firePropertyChange("minZoom",e,t),this.getZoom()<t&&this.setZoom(t,!1)}},getZoom:function(){return this._zoom},onZoomChanged:function(t,e){},zoomIn:function(t){this.setZoom(this._zoom*kn.ZOOM_INCREMENT,t)},zoomOut:function(t){this.setZoom(this._zoom/kn.ZOOM_INCREMENT,t)},zoomReset:function(t){this.setZoom(1,t)},checkZoom:function(t){return t<this._minZoom&&(t=this._minZoom),t>this._maxZoom&&(t=this._maxZoom),t},setZoom:function(t,e){if(Be.num(t)&&!(0>=t)&&(t=this.checkZoom(t),t!==this._zoom))if(null==e&&(e=kn.ZOOM_ANIMATE),e)De.animate.AnimateManager.start(new De.animate.AnimateZoom(this,t));else{var i=(this._view.scrollLeft+this._view.clientWidth/2)/this._zoom,n=(this._view.scrollTop+this._view.clientHeight/2)/this._zoom,s=this._zoom;this._zoom=t,je.setZoom(this._rootDiv,t),this.firePropertyChange("zoom",s,t),this.onZoomChanged(s,t),this.centerByLogicalPoint(i,n,!1)}},setTouchZoom:function(t){this.setZoom(t,!1)}}),function(){var t=function(t,e,i,n){var s=new Ue;s.src=n,De.Util.registerImage(t,s,e,i)};t("subnetwork_image",64,46,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAuCAYAAACYlx/0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAB1JJREFUeNrkWmtQk1cafr4vUQhEiNeBpkWwXitCqK1WaiU4tCMjlmCnrU4rmE4v2v1Rmf7q7M6is/uj7e4OurMz7fSyiXXVddsasBa0xQawoqiFFPBWJATkVpQSLPdLTt/zkTCgSHVNuISXeZLvnC8JeZ7zvu8578kBRs/UhB0EE6GZwIaBmbCToIEXWSjBcAfCI4GLoZ3QzIX+0RwgpYnUsPT0dGY2m5nDwYagqKiYGQwGlpiYeKsQJvoc1UQjriKYCYwjJiaG5eScYN09fXeF8qsVLDk5hbneT2gWJkpYyARBJQpCMYFNV6nYRx9/wtq7uv8vnD57jkVGRjL+WYRmgsYDg+U+U0ydoiJvNpPjagICA2E6moVlERH39Zkt9hboEuJxobSUN+2iKMR2dPdYxkSAQD+FhoJSxxiLAY9LNsgtBeS6+qYFBuC/piNYGr7MLV/yZksLXkx6FpfKynjTRiJEtbR32EdFgNmB01REeAdjSHFm9N8146Ev8fgTq9zqqr/evImN8XGoq6nhzd1Nv7amelwA9awZOsrQBjizsHLaNCxf8YSEhUseue0L/nT5IgICArAp5RWP5Jeis2fwxpbN0jX3gtobv1g8IkCYOkjFiDiNvI63gx5QQ7/tD1i9Ng5KZcCYJtl3095BdqaJf3NjVX2j3u0CLA4LUTkcDjNzxvfLr24jbIdDmpLH3q7X1yMlKb5/xpGJSTwxOm9ZLldW2+9LgIhF8/vJ05zr76/EO399H0siHh1vawykvf0mSi1Fw9220/1cQRDyCBklV67a7kmA5eFLTNzt/ZVK/Ond3VCHPjwu1xqWwlM4lvnFQLvKehVtra23kyMRKFfsOVdyMfd3BYheHrmV3J4nPPz57/9CcEgoxqsRMdBADbRFQaQ+4HJZCWqrrDhtzkG1zTr49UZC6qnzxfZhBVj75EqVo89RybN9/MZNWLvhuYldg5AaDTVVOPnNURTmmwfCQxTF2O8KCi23CbBO+xQVLSxt+szZSP3LP9DrcHhFGSrQX431CrI/34+6a1VOcUR9tjnfOESAxHVxvD5XPbtZjwWRj8HbzNHTjexDeylELM41hBhlyvpGagibdBv40tYUOGMmknf8ET19ffBGk4si8r76H0rPF0rhIJPJww4czrDLfXx9+bqeprsodHR1w1utF31YGZeAlqYbaGyo4yvbdIJe2KZPLuZbUNoNz2O6ei683dqbfsbxz/e5QiFMrlD4SSs+1aw5cHhJ8hvJlLOCMG/hYtRfq+YZ8C25r59CujHVz9+rQ8Bl3TTIcxeHo7npOp8BtHI/Ig7XBhzDpDDV7GA4eWvkhn37pc650esmRQg4Yx8u3nJrZaV00dbZjclkLt5yV0e1tRwPjtPix6PrA14+0rO2zlaBkHkLJgXpcloROqtAO/eAPC5AydkCPBkXPykE4FydlivnNTOpkVZCNXZXZwf8/JXevRBqa8UZ83EqoQU+8+2V0UODzxS5TibKgnx8fLAoQiOVk96KzH2foOJCKWSiYOvpc2yXkuAUuXwP3TaczMrA07oXoPBSL+Be/n1WJqbK5TT6LLWzpxcyaXXU22tRKnx1zNEbdL2uBo89tVZyEW9CXVUFDO/vAnHkW+pGe1vHe0O2xIJUARpBFHlhhKSt27AmYaPXjHz+14dhMnzY32Ast765JdZ1T+a6aO3sapih9K+Sy2S68pIizJwTBHXo/Akd7/XVVhz453sozMmmmBe5Jxhrm5qTht0Uddl8dbCB3ruVX6+O1yFhy2sTbsQvnj+D77MzYb1UMtDHHCz1al3D7mE3RW+1R8JC0klBfpwFwSFhWP/yqwijCmpckCsqRENVJYLnhsGXCprO9jbUU7ujvRUN1ZVEumzI6xljRsKuS7ZrtuH3De9gkQvn6URBHPhdMJQEWPVMAhZHrRgz8vYbjfgg7W2J9EhGGd5GDxlEfM+P5VbbyBunI9jjSxepyBO4N2wd3B+6aCkio7USRss6O9rw2d92oqF/IG1E7lZiedTH9/1zz124ctc/mt7V+YBoTXgoifAWQUcIdfVvSNmOiFVrRkWAr/Z+iJLTeZIjUNkedaq41OaOz73nEyKxK5drnGJIXrF+y+tYtnK1B0e+HSe+3I/SMyelNidvLvxhbE6IDLb4mGiDS4SlK1YjVrcZvgo/t5JvrK3GsYOfSs/95Jn+WH6B0Z3/477OCCU+rd1JIqTx68AZs6DVbcKCcI0bRr0DRfnfouD4kYH8RyMfeyQnz+JuD7vvQ1LPr39GSyIYXLlhzgMP4dE1cZIQ9+oRLb/cQNm5Avxw8gS6yPWd01gukdd/kfWtzRMh5pZTYi/p1vPZYoczNwwcapxPIoQ8vFASZY76IRJEMeR9P9fWSESvVfyE8rJiNNbVDJ6/eabf9R/TUSM8aG49Jqd/IUkliiIXImXwbHEvRqQtNOJ7/n3osEeJe0SAwbY9ebOGxOBnjGKcYtxJEAsnTfiRkPHBZwdtGEX7TYABAPgBTYK366ChAAAAAElFTkSuQmCC"),t("bus_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAINJREFUeNqkU0EOgCAMo2Y/1P8Y/6NvnBADwTnGzHYiGetKW8DMKVJLChbVAwCNCrrzp5/Zg/4MaH0JMBOEh08o6OtxtgvXvkFuV/vFBeGEm0WZo8GgF+QlIkI2OrZq5WLAFjuy4DvVWXHl2VodyElMjkxAJNFm4EjmFGAqLKLf+RZgAKkFNRwzv7gHAAAAAElFTkSuQmCC"),t("data_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAMZJREFUeNqkU8ENwjAM9KEwWwaAKVA3iMQDtRtUTAEDdLZWMkkhIUljU4n7RInP9p3dgoiYBAzDgHAyfykA1rtzbr2bmpDDk5uBvu+ROO98pvs4FqRL10nCogokBS3UBaXCZg9JQ7JQY5qmZoK1trCQCuQJnoS9CsQZHKsNcOyWvS1ehdGqz8xyZ0BXEHG+PTdvj+uJkFsASsusdN5sQSKHGWgWfDxY1GcQfEIYIn4p+HuN+SqXRtL8+ZAOinwm5V+P8ZcAAwC0T1T5kpEqewAAAABJRU5ErkJggg=="),t("databox_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwMjI+N/BiIBUD0jMp8FpDm4cQ2DvYEiw8EL9/FqBqkBqUc3BGT7/0kbz/6HsXHhS/eewtWBXA7CYAMOX75PlCEgA9ANYYQaADbJVleRAShJ0Csw7+T5G2MaQCpgQReAuQAWqPhokAuYGCgEowZQwwBQuiYn/mGAEZaeYTkSlA6IBeCUCDMA2RBSsjZAgAEAOyp6/CYHWkwAAAAASUVORK5CYII="),t("grid_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAFdJREFUeNpi/P//PwMlgImBQsACIhgZGUl2BtDljCguAHkFhIMb1xBkU9ULjCATQV4A2UAsWFsfAvcCzEn/YQBoEEE2VD1Y76gXhpcXyM0LjJRmZ4AAAwCoyOJjz29PsAAAAABJRU5ErkJggg=="),t("group_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOFJREFUeNqUUwsOwjAILa67i2fwEMbEnUej55mJO4Rn8DBtglAh6YfOSdJkBfregwEgottiHiAlQuZjh68TQRJzI5L07nSbC//zOrUAmkxAJXBP2VgxRjpDK818z06gZIwrfSACF0iVVZrLiab7ownOl7PTV0QESsRgWqoHt80oD0fpy/BVhuZfsOpkC8LYxAkBw4YedOdDhuRny1UyZEPE334NvbZ6kBYeJGFPKFgp4HsUAqtI9u1AYipJgfQ+GjtQlPvPMkGlBHrLdFjeBeHruE+hYAxSo6C3jb4zyh8BBgBVL19PZ27iaAAAAABJRU5ErkJggg=="),t("group_image",32,29,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAdCAYAAADLnm6HAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABHNJREFUeNqsV1ts21QY/uy4zc1ZnZY2bdbSLMlKxUWkaBJMgJY9gARIax/2NokVofLARWjiBYRY2QMdCGlI440H1ok3btsQ0wAxNdvKpnYdyyYK7UZHVK1L2rRZLo3j2InDOaZD60psp+WXrDjO93/nO7/PfwkDAwu0Nh8jH30wZwc6/f43X9jVJ5gBn/zueJozgaNkUXLtMwLyLt4XDG4Vtj+/B8lMQRf7QLsb079PCpzJnaVnEsmIEeiZgD/Mu5yYT4uYiWd1sW1NTlCsWQGmzC00gOd5lFQVkqLoYiuViobVBNzf3BRaCfUaUyuV2AomXI1sNrmkRUeUZBRlBXJJRVFRdQUoZVXDclvbvUeImn6j3VmAqpjg5ra0xcL2nDwdwW1JQeP2HJLLki7frVQOo+OXwNnttv5fp65vKPSvvLhHmBgf77fV10XqWBaLZPGEgYC0KIFiOYfdBoY8OH72D8QS6ZoX3x1+CFarFZSnxS1gk9OBeUJ+00BAimAolnM6nQDDEDVAHVOpWQBD/Ow2GyhPoyDHWKjYkr+GVrv+GWBmE6BYIsChRYCz0Kt2AWR92GxWUJ7TFy7GWltb9l368ZteM77lcukE53A4tC91VAC7jggwVIANd3h+OHM+Qlj2ktvQv9U0EIAkSZibm7vbNUpcIxxPQsfQV2BhwDHrE2C320F5qPnaPCMkdVel9EdDQ8iLeex/5+27H4dYljnGnRo5B1EUMT1fwI2lUs0CHs9JOD9xGeNjY9i7u9dXkKTovZgvv/j8H+y2njX+3FxiHmKhgHiGhCir1CwgKxawsLgEynP06xO0aO2sxV+rhAopm9migrRUuwCJVDMS8nXXEE2ALMtIF2UskVJaqxWIgIqqrl8ATUGFkNDaLKu174RGjzYWykO9A17P+6pa2WEqhVnmDOfmnUgmk+gN2vBsZ33NAng1DxspIpTH1+H1Pdrz2OCHn34GpaQfFYe1Dm+9+nKY62jzpIcG3xU20gukXAZtzU0Rkoo+mo6/TMZxI6E/Dzz9sFdLXc7jad6pSIW+jQho2OSKjl2djOyiAwmdB8jrLMj6Ka3emQd+Gh2jeUvTp7/aTGBgwyv+cJNm5HLx2plQSmX9AkYuiuXqOUuorKoj1RZ/7fU34PcHMLj/PSwv5/4LMsgy7EtKuTz887kLyMoq7CERi/miroD5TB4Xr/wGrsPT8omqqlV3PjAwgIYGAd9/+xVmrledG46QjhiZjs0iSYtSehk3M6KugAUigGK5rqA/rAc89MEBOJy81qq7u4LVJyYL27eYSkV50hkXxCLmDCKQIhiK5do3e3VL59TUNdrZ0N3dddTgLMQ89zX5XKQtP+m14kGB1QVv4VVMrIwCRn9M6PkAGctN1fjnwk9ddjc2hcxgb6eWov/rWE7tVGS0ZyWjfEYRoxlkVoBAIhE2gYst5vKDpVJ51QR96PBhxONxfHzw4Oo+wFl2mBFAJ1W6+IgR0OGwD2/zda4Z32/99ScpTiU80fPIvT/1/y3AAMOmtJl1Hv9IAAAAAElFTkSuQmCC"),t("link_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHVJREFUeNqkkwEOgCAIRaEr6nlqdR49I4XTzcqUn39jE5xP1C+LCPkjCl0Kq2NC5fYgRXlMSCw0K6Xozhqaol3ckj+QVwGFNIsI5HPCCunSLZDhGUcQ0033IOb3riE1CLJty/bTVubUBqDyc+Pm01oY8NQpwAAbUwhLBQIWcAAAAABJRU5ErkJggg=="),t("linksubnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAU5JREFUeNqUUi1Tw0AQ3cukEY0AwdlDM8XRD41ARAAi/RHoCmQ7/QNofkTQFQh8W9kOOtgiQIBImTnuXbs3udAvduZms5t9b/fdrUiHGW2z0cOdLsdJ71GU46yfUrgL/PWx8HLxsUTOI3EE98mp9ZdXie0K8HgydYXtVtN6znHsTQAwdy2DOcY/TMFytkqogqskLIf6qQhYL7q/PI8cOIoiiuO69bvIRf3o5M/YANVqIZ03GjSbz2m5/KGiKDxgp90irbUINzEz2BSQEMKSwJiEwfgONmlFR4AAhg2yV0talWNfAbfJN4s7KHcCCcBPgy7WhobdM7q9uXbd3TPyhvEOwL4/30kpRVJKwrYySZ7nWABlzpsthM49R5lzYUhAruERr/P7CdZNPJJVakUiuOgAw9jSXOyUX8f4ZkCHGzQvAGIw4v9M4E0CMEh/BRgAwM37IYxGnbkAAAAASUVORK5CYII="),
t("node_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAGBJREFUeNpiZGBg+M9AJvj//z8jC5RBsmZGRkYwzQITCGlaS7TmNXXBcDYTA4Vg1IDBYAAjJB2Rl5DgKRGWqshyATm2o3uBgcwMBbacBZdmZJfh8CJIASMLodxGCAAEGACTAB0gDBYjygAAAABJRU5ErkJggg=="),t("node_image",30,32,"data:image/png;base64,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"),t("shapelink_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAIJJREFUeNqkUwsOgCAIxeYN5Ty1Og+ekUarzRwQ5tsYDpTPExIzgwY86uWgtSTwIAF6KTvxg/sMliwwCy27mEVr2Xu7+TjaWm4JqxvKpW/iWowQprX2i8RXhS0xXv+WL0xiKIAVxKssa/0hEMuPiB4epNFxnh7lZG1jdCPdABGcAgwAc06H0rgwLSIAAAAASUVORK5CYII="),t("shapenode_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAI9JREFUeNq0UtsNgDAILI0jdZN2Ho3O027SnRA+MNb0QTWS8EPuLncAIKL5UvY5CEdC7h7pjrEtEABgqwucRCBFk7aAfo9uZJtwmXhQCLDyLJlrkSxaMuGgu8QZ8hVhYD8LVgZx9fMO1H9QKXbm+EJvBYwsuSYyFaEmUvyBUkQWCYUDfg5NV8/49xW6dQowAIJydCoPajIHAAAAAElFTkSuQmCC"),t("shapesubnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAATBJREFUeNpiDG5cw4ALbO/L+I/M9yyawYjMX1MXzMCCT/PXD69RxLgFREFiKIbADSjzlAfTjq6eYFtBmk+dPgNXaGZqAqZhYjA+igtAmmG2ImuG8UFyIFfAvIPTC+ia0Q2BeYehLpiRCeZfkO37d2/HqRmX4Yxc/CJwZ9+6fYeBEPjw4QOYNjczZfj//z8j3AuMjIjAvXnrNoomdTVVFDkonxEjEIEmgg1C1oAuhw5YQKEZGhHzH9kVbcuPoiiqirSGy5UUF8FtBwFwIK5esYQRaIMfyE/Y/A0yEGbopk2b/FACEeQ0mO1Ati+UvQndFciuAVkG5W5GMQDqV1+QAci2oxuAFC5+4MCBGQIzAEKBBbFimBxILc7MhOQiPzTxTcixwYhsOxLwRWJvxicHEGAAkPKxzyGuYWgAAAAASUVORK5CYII="),t("subnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOJJREFUeNqkUjsOwjAMzavSBQYY4FDM7SGYOUARHICZQ5SBiUPBAAMLIJk8aFASkoDgSVFlu/68Z6NatCqF3Woqrj2ZreHabVMpnUs+H/eerz8c0+cV0amuTK6XG69bDEWsa5hM0KafU/DZeJRCmBwWsXRUUwEU0Y5tRFLfgHRMARYDeoPRSyy383Zee0nsgO5rcROBzo19FUlOoYG0Bp/0IAW7y4LHQT5GB/UL4F6ie3mX0yFLoTQUTByQxE8lQ51wMRHx1Chd4FtkReQUj3VFktj97ZSDNYkK9h6L/03hLsAAjRx4oMVjqkMAAAAASUVORK5CYII="),t=function(t,e,i,n){De.Util.registerImage(t,n,e,i)},t("expand_icon",16,18,"data:image/gif;base64,R0lGODlhEAASAIcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrnK5MbGxsbW69jh8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAEALAAAAAAQABIAAAhfAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNDjgi8GgQ40YGCwyQLDjAAYCXL1UeFBAS5QIFBVYSFMBxwU0EOWcyUIDAQIGjOgcegMnUYsOnUKMiDAgAOw=="),t("collapse_icon",16,18,"data:image/gif;base64,R0lGODlhEAASAIcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrXI48bGxsbS59Te8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAEALAAAAAAQABIAAAhhAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNADgq8GgQY0YADBYYIFlwgAMAMGGuPCjAAUcACxQUYElQAMcFABQg2EmTgVADBZLyHHggplOLDaNKnYowIAA7"),t("close_icon",11,11,"data:image/gif;base64,R0lGODlhCwALAIcAAHd3d319fUD/QIODg4iIiI6Ojq6urri4uNnZ2eHh4eTk5Ofn5/Dw8PT09Pj4+Pn5+fz8/P39/f///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAIALAAAAAALAAsAAAhdAAUIOECw4AGBAyUoXCjh4AEJDBA4mIiAQcMDERAUKOBgI4IIBCE0IECSZAMIBB8wYDCg5coHBBkkCECTZgIGMQ0AAKBgpwGcBxgsMLCgKFGcA1cqXXlQoMGCAgMCADs="),t("sort_desc",9,5,"data:image/gif;base64,R0lGODlhCQAFAJECAImJiezs7P///wAAACH5BAEAAAIALAAAAAAJAAUAAAIMDI4QYrnC0INxUnYLADs="),t("sort_asc",9,5,"data:image/gif;base64,R0lGODlhCQAFAJECAImJiezs7P///wAAACH5BAEAAAIALAAAAAAJAAUAAAIMlAWnwIrcDJwi2HsLADs="),t("submenu_enable_icon",8,8,"data:image/png;base64,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"),t("submenu_disable_icon",8,8,"data:image/png;base64,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"),t("checkbox_selected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAflJREFUeNqkk09oE1EQxn+7btyIYBRCbayFtlhEtLeAin+KouDNo548eJHCQkFQC1K0Bw8VqT1EVIqo0IMUvejNg6AIIglSsdSCiA0WolaIOWi3+2fGw242CRFBHPjg8d7MfPO+mTEcxzkNDAF5/s1KwE0cxylWKhX1fV89r44gget6bVhd9bRcLqvjOEULyGezWTwvAMAwjIRCRAnD8I/0nZ05gLwZOTYeVBXQOIGgqgk+flrk3MUxVBWRyMeMw5oCG2eREFVBVZibf8+x4ydZLH9GVRISq5W5uXwhDKPSvnz9xolTZ/A29GNZFiJ1kjhBnVFVEw0a7MrQ8HlqbMZwXeYXlpL7ti/Usbz8Hd8PEBGmHzxk9kMVfI+BrWt4PHM/0abtC67r8vTZC4qlWY4c2s/Azh2MTxQwpIPduzZx99Z1bNtu1yBiFp6/fMXr4ht+/NzI+MQNBg/sxdccPbmAqcI1UqkUEresTQMR5ejhQbb19XJ25BJzC8Lbd3dIp22mCtPY9tokuDmB2VyBqtDb082VyxdYv26JXysrTF4dY0uuI3lvoKWCaOoMA1SF7q4u7t2eZObREw7u25MMTbPF8VGCqHNRB4IgQFXY3t/H6MhwLFirGYZBfeItoFSr1fKZTAbVaPbT6fRf19A0TarVKkDJ+N91/j0A8Y5o3Yt7KRAAAAAASUVORK5CYII="),t("checkbox_unselected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAiUlEQVR42qXM3QYFIRiF4d3dJpIhI5FKJCOSSHe7f9gn4ztZo3Wwzt6HvTbHfhdCeD8Nvw27Ad57OI4xUsA5BwMpJQpYa2Eg50wBYwwMlFIocJ4nDFzXRQGtNQzUWilwHAcMtNYooJSCgd47BaSUMDDGoIAQAgbmnBTgnMPAWosCcP3fDdjZNvABvRhVEQglsV8AAAAASUVORK5CYII="),t("radiobutton_selected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAXFJREFUeNrUUz9rwkAUv0syBVxMm01L2lIdilOg4BcQ7eKcIV/AqZAxo1/B2a/QoSSTH6AQCoFMJUSig5C0EiPEv8G+Z604eJNTHxz37vf73Y977+7obrcjlwRHLoyLDYTThWmav6AgKDA9wrg6UF8wvO12O8RFt9s9bwACwvP8U6lUajWbzbYsy/eIR1Hk27b9GgSBlef5O7OEzWZzC5ufNU17gc01gEQcmCOGHGqYJaxWq1qj0WhzHFfwfZ84jrPHVVUliqIUkPM87wOg4KzBcrm8liTpbr1ek8FgQNI03eOz2Yzouk6QQw3zBFmWUewDxnQ6JUmSHHsDRz9qmD0A8ns8HgcortfrRxxzxJBDDfMEi8XC7ff7b4Zh3FSr1UKlUtnjlFI0mCOHGqZBHMd+GIbWZDIROp1OCxqH74HA9Q17vZ7luq4liqJ/uoee/oVyufxX/wPctwqpfKAieB9OsVj8xMVoNDpv8D8/048AAwDskrF8QGeJUgAAAABJRU5ErkJggg=="),t("radiobutton_unselected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAATVJREFUeNrUU71qhEAQ9q8S0mhip3C5kCpcFcgjiJfmal/BKr2lr2DtK1wR9BkCaYRUQTzUQtDE5sB/MTOJAQs3jVUGhp2Z75vPnV2XHseRWmMMtdJWC3DzxDTNnyLHbWC5A7+coA/wt77vT5hYlrUsAASKZdkHWZb3mqYdJEm6wXqWZYHneccwDN1hGF6II3Rddw3Nj7quP0HzDko8OsZYQww5RIGmaXaqqh4YhrnA3cwda4ghh3gGdV1fiaK4bdt28cAQQw5RoCxLGr/2lyGHOAKAn0mShDAnteSIIYcoUFWV7zjOM5DPuJPfxik+I4Yc4gh5ngdRFLlpmnKGYew3YFiH6zvZtu36vu/yPB/Me+j5W1AU5XstiuIW7vseQmmCMvg/XgVBeMckjuNlgf/5mL4EGAAhHbltcqEYDQAAAABJRU5ErkJggg=="),t("right_expand_icon",6,11,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAALCAYAAABcUvyWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6N0ZBRTFFQjJGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6N0ZBRTFFQjNGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCMzYzQTE5MUZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCMzYzQTE5MkZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqPQWR4AAABJSURBVHjaYvT08vrPwMAgCsQM27ZufcMABUxQ+jWI8PL2FkGXwJBElkCRRJeAS2KTAEvikhDFJiGKzSi4f5iwCSLrwPA5QIABAAmgFhOOHdKvAAAAAElFTkSuQmCC"),t("left_expand_icon",6,11,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAALCAYAAABcUvyWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6N0ZBRTFFQjZGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6N0ZBRTFFQjdGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo3RkFFMUVCNEZCMDUxMUU1QTkzQ0IwMDAxMkFFRkI2OSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo3RkFFMUVCNUZCMDUxMUU1QTkzQ0IwMDAxMkFFRkI2OSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PmpWGHAAAABISURBVHjaYvz//z8DDHh5e4tAma+ZsAmCCCZsgiDAfOr0aQxBuA50QZgEhiBMQhSXBAM2SaZtW7e+wSYJ1oFNEu5BdEmAAAMAvV8Xc/cw3YgAAAAASUVORK5CYII="),t("up_expand_icon",11,6,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAGCAYAAAAVMmT4AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QjM2M0ExOEZGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QjM2M0ExOTBGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCMzYzQTE4REZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCMzYzQTE4RUZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PnCNygcAAABGSURBVHjaYvz//z8DDHh5e4tAma+BWBTE2LZ16xuYPBMOhXAaSRyiGItCBmwaGD29vHApRAaiyM7ApxAuz0SEQrgGgAADALOxFSETkKKwAAAAAElFTkSuQmCC"),t("down_expand_icon",11,6,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAGCAYAAAAVMmT4AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA0xpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QjM2M0ExOENGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QjM2M0ExOEJGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjQ5ZTRmZmE2LTQzNmYtMTE3OS04NThhLTk1ZGZjOWRiNmNiOCIgc3RSZWY6ZG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjQ5ZTRmZmE2LTQzNmYtMTE3OS04NThhLTk1ZGZjOWRiNmNiOCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PtPgXX8AAAA7SURBVHjaYvH08vrPQCRgAmJRItWKMsEYhBSCTd62desbAhrA4iB1TDAGDg2iyPIwZ2DTIIomzgAQYAAmahUFv1Iq6AAAAABJRU5ErkJggg==")}(),We.__tree=function(t,e){t._rootVisible=!0,t._initTree=function(t){this._rootData=null,this._expandMap={},this._levelMap={}},t.validateModel=function(){this._rowDatas.clear(),this._levelMap={},this._dataRowMap={},this._currentLevel=0,this._rootData?this._rootVisible?this.isVisible(this._rootData)&&this._buildData(this._rootData):this._buildChildren(this._rootData):this._buildChildren(),delete this._currentLevel},t._buildData=function(t){this._dataRowMap[t.getId()]=this._rowDatas.size(),this._rowDatas.add(t),this._levelMap[t.getId()]=this._currentLevel,this.isExpanded(t)&&(this._currentLevel++,this._buildChildren(t),this._currentLevel--)},t._buildChildren=function(t){var e=t?t.getChildren():this._box.getRoots(),i=this.getCurrentSortFunction();i&&this.isChildrenSortable(t)?e.toList(this.isVisible,this).sort(i).forEach(function(t){this._buildData(t)},this):e.forEach(function(t){this.isVisible(t)&&this._buildData(t)},this)},t.getLevel=function(t){return this._levelMap[t.getId()]},t.getToggleImage=function(t){return t.getChildrenSize()>0?this.isExpanded(t)?this._expandIcon:this._collapseIcon:null},t.isCheckable=function(t){return this.isCheckMode()},t.isCheckMode=function(){return 1===We.__tree._checkMap[this._checkMode]},t.isChildrenSortable=function(t){return!0},t.handleDataBoxChange=function(t){"remove"===t.kind?delete this._expandMap[t.data.getId()]:"clear"===t.kind&&(this._expandMap={}),this.invalidateModel()},t.isExpanded=function(t){return 1===this._expandMap[t.getId()]},t.expand=function(t){if(!this.isExpanded(t)){for(var e=t.getParent();null!=e&&e!==this._rootData;)this._expandMap[e.getId()]=1,e=e.getParent();this._expandMap[t.getId()]=1,
this.invalidateModel()}},t.collapse=function(t){this.isExpanded(t)&&(delete this._expandMap[t.getId()],this.invalidateModel())},t.expandAll=function(){this._box.forEach(function(t){this._expandMap[t.getId()]=1},this),this.invalidateModel()},t.collapseAll=function(){this._expandMap={},this.invalidateModel()},t._handleClick=function(t){if(this.isFocusOnClick()&&De.Util.setFocus(this._view),!this._isValidating){var e;if(t.target._expandData)e=t.target._expandData,this.isExpanded(e)?(this.collapse(e),this.fireInteractionEvent({kind:"collapse",data:e})):(this.expand(e),this.fireInteractionEvent({kind:"expand",data:e}));else if(t.target._selectData||t.target.parentNode._selectData){if(this._handlePressSelection(t.target._selectData||t.target.parentNode._selectData,t),this.isCheckMode()){var i=this.getRowIndexAt(t);i>=0&&this.__handleClick(t)}}else this._treeColumn?(e=this.getDataAt(t),e&&(this.isCheckMode()?t.target._checkData||this.__handleClick(t):this._handlePressSelection(e,t))):this.isCheckMode()&&!t.target._checkData&&this.__handleClick(t);if(this._currentEditor&&!this._isCommitting&&(this._isCommitting=!0,this.commitEditValue(this._currentEditor._editInfo,this._currentEditor)),this.updateCurrentEditor){var n=this;setTimeout(function(){n.updateCurrentEditor(t)},0)}}},t.__handleClick=function(t){var e=this.getDataAt(t),i=this.getRowIndexByData(e);if(this._focusedRow!==i){var n=this._rowDatas.get(this._focusedRow);this._focusedRow=i,n&&this.invalidateData(n),this.invalidateData(e)}},t.handleChange=function(t){if(!(this._isCommitting||this._isCanceling||this._isValidating)){var e=t.target._checkData;if(e){var i,n=this.isSelected(e),s=this.getSelectionModel();if("default"===this._checkMode)n?s.removeSelection(e):s.appendSelection(e);else if("children"===this._checkMode)i=new gn(e),i.addAll(e.getChildren());else if("descendant"===this._checkMode)i=new gn,Be.fillDescendant(e,i);else if("descendantAncestor"===this._checkMode&&(i=new gn,Be.fillDescendant(e,i),!n))for(var r=e.getParent();r;)i.add(r),r=r.getParent();n?s.removeSelection(i):s.appendSelection(i)}t.target._editInfo&&this.commitEditValue&&(this._isCommitting=!0,this.commitEditValue(t.target._editInfo,t.target))}},t.onLabelRendered=function(t,e,i,n,s,r){},t.onToggleImageRendered=function(t){},t._renderTree=function(t,e,i,n){var s=this._levelMap[e.getId()],r=this.getToggleImage(e),a=this.getLineType(),o=this._indent,h=this.__spanPool.get();h.style.width=r?this._indent*s+"px":this._indent*(s+1)+"px",h.style.display="inline-block",h.style.position="relative",h.style.verticalAlign="top",h.style.margin="0px 1px 0px 1px",h.style.width=(s+1)*o+"px",t.appendChild(h);var l=e,c=l.getParent(),u=0;if("dotted"===a||"solid"===a){if(null==c){var d=this.getIcon(e);this._addLine(h,e,d,!0)}for(;null!==c;){var f=c.getChildren(),g=l===f.get(f.size()-1),d=this.getIcon(l);l.setClient("isLast",g),0==u&&this._addLine(h,e,d,g),u++,l=c,c=c.getParent()}}if(r){var _=this.__imagePool.get();_.setAttribute("src",Be.getImageSrc(r)),_.style.verticalAlign="middle",_._expandData=e,_.style.position="absolute",_.style.right="0px";var p=this;_.onload=function(){_.style.top=p.getRowHeight()/2-_.height/2+"px"},h.appendChild(_),this.onToggleImageRendered(_)}var v=this.isCheckable(e),m="disabled"===this.getUncheckableStyle();if(v||m){var y=this._addCheckBox(t,e,n);y.disabled=!v}var d=this.getIcon(e);if(d){var A=this.isCheckMode()||this._treeColumn?null:e;this._addIcon(t,e,d,A)}var x=this.getLabel(e);x&&(h=this.__textPool.get(),h.style.whiteSpace="nowrap",h.style.verticalAlign="middle",h.style.padding="1px 2px 1px 2px",Be.setText(h,x,this._treeColumn?this._treeColumn.isInnerText():this._innerText),this.isCheckMode()||this._treeColumn?this._focusedRow===i&&(h.style.backgroundColor=this.getSelectColor(e)):(h._selectData=e,h.style.backgroundColor=n?this.getSelectColor(e):""),this.onLabelRendered(h,e,x,i,s,n),t.appendChild(h),t.title=this.getToolTip(e))}},We.__tree._checkMap={"default":1,children:1,descendant:1,descendantAncestor:1},De.Column=function(t){De.Column.superClass.constructor.call(this,t)},Be.ext("twaver.Column",De.Data,{IColumn:!0,__property:1,__accessor:["width","horizontalAlign","valueType","propertyType","propertyName","editable","visible","sortable","resizable","movable","sortDirection","sortFunction","enumInfo"],__bool:["innerText"],_innerText:kn.COLUMN_INNER_TEXT,_width:kn.COLUMN_WIDTH,_horizontalAlign:kn.COLUMN_HORIZONTAL_ALIGN,_propertyName:null,_propertyType:kn.COLUMN_PROPERTY_TYPE,_valueType:kn.COLUMN_VALUE_TYPE,_editable:kn.COLUMN_EDITABLE,_sortable:kn.COLUMN_SORTABLE,_visible:kn.COLUMN_VISIBLE,_resizable:kn.COLUMN_RESIZABLE,_movable:kn.COLUMN_MOVABLE,_sortDirection:"asc",_sortFunction:kn.SORT_FUNCTION,_enumInfo:null,renderCell:kn.COLUMN_RENDER_CELL,renderHeader:kn.COLUMN_RENDER_HEADER,setParent:function(t){throw"parent not supported"},getEnumInfo:function(){return"object"==typeof this._enumInfo?this._enumInfo:"function"==typeof this._enumInfo?1===arguments.length?this._enumInfo(arguments[0]):this._enumInfo():void 0}}),De.ColumnBox=function(t){De.ColumnBox.superClass.constructor.apply(this,arguments)},Be.ext("twaver.ColumnBox",De.DataBox,{_name:"ColumnBox",add:function(t,e){if(!t.IColumn)throw"Only IColumn can be added into ColumnBox";De.ColumnBox.superClass.add.apply(this,arguments)}}),De.Property=function(t){De.Property.superClass.constructor.call(this,t)},Be.ext("twaver.Property",De.Data,{IProperty:!0,__property:1,__accessor:["horizontalAlign","valueType","editable","propertyType","propertyName","categoryName","enumInfo"],__bool:["innerText"],_innerText:kn.PROPERTY_INNER_TEXT,_horizontalAlign:kn.PROPERTY_HORIZONTAL_ALIGN,_propertyName:null,_propertyType:kn.PROPERTY_PROPERTY_TYPE,_valueType:kn.PROPERTY_VALUE_TYPE,_editable:kn.PROPERTY_EDITABLE,_categoryName:kn.PROPERTY_CATEGORY_NAME,_enumInfo:null,renderName:kn.PROPERTY_RENDER_NAME,renderValue:kn.PROPERTY_RENDER_VALUE,isVisible:null,renderEditor:kn.PROPERTY_RENDER_EDITOR,setParent:function(t){throw"parent not supported"},setPropertyName:function(t){var e=this._propertyName;this._propertyName=t,this.firePropertyChange("propertyName",e,t)},setPropertyType:function(t){var e=this._propertyType;this._propertyType=t,this.firePropertyChange("propertyType",e,t)},getEnumInfo:function(){return"object"==typeof this._enumInfo?this._enumInfo:"function"==typeof this._enumInfo?1===arguments.length?this._enumInfo(arguments[0]):this._enumInfo():void 0}}),De.PropertyBox=function(t){De.PropertyBox.superClass.constructor.apply(this,arguments)},Be.ext("twaver.PropertyBox",De.DataBox,{_name:"PropertyBox",add:function(t,e){if(!t.IProperty)throw"Only IProperty can be added into PropertyBox";De.PropertyBox.superClass.add.apply(this,arguments)}}),De.Tab=function(t){De.Tab.superClass.constructor.call(this,t)},Be.ext("twaver.Tab",De.Data,{ITab:!0,__accessor:["view","width","closable","resizable","movable","disabled","visible"],_icon:null,_width:kn.TAB_WIDTH,_closable:kn.TAB_CLOSABLE,_resizable:kn.TAB_RESIZABLE,_movable:kn.TAB_MOVABLE,_disabled:kn.TAB_DISABLED,_visible:kn.TAB_VISIBLE,setParent:function(t){throw"parent not supported"}}),De.TabBox=function(t){De.TabBox.superClass.constructor.apply(this,arguments),this.getSelectionModel().setSelectionMode("singleSelection")},Be.ext("twaver.TabBox",De.DataBox,{_name:"TabBox",add:function(t,e){if(!t.ITab)throw"Only ITab can be added into TabBox";De.TabBox.superClass.add.apply(this,arguments)}}),De.controls.ListBase=function(t){De.controls.ListBase.superClass.constructor.apply(this,arguments),this._invalidate=!1,this._invalidateModel=!1,this._invalidateDisplay=!1,this._invalidateDatas=null,this._rowDatas=new gn,this._startRowIndex=0,this._endRowIndex=0,this._renderMap={},this._dataRowMap={},this.__divPool=new De.Pool("div",20),this.__imagePool=new De.Pool("img",20),this.__canvasPool=new De.Pool("canvas",20),this.__spanPool=new De.Pool("span",20),this.__textPool=new De.Pool("span",20),this.__checkBoxPool=new De.Pool("input",20),this.__linePool=new De.Pool("canvas",20),this._pools.add(this.__divPool),this._pools.add(this.__linePool),this._pools.add(this.__imagePool),this._pools.add(this.__canvasPool),this._pools.add(this.__spanPool),this._pools.add(this.__textPool),this._pools.add(this.__checkBoxPool),this._view=je.createView("auto",!0),this._rootDiv=je.createDiv(),this._dataDiv=je.createDiv(),this._dataDiv.style.width="1px",this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._dataDiv),this.setDataBox(t?t:new De.DataBox);var e=this;e.handleChange&&e._view.addEventListener("change",function(t){e.handleChange(t)},!1),He.isTouchable?He.isMSTouchable?new De.controls.ListBaseMSTouchInteraction(this):(new De.controls.ListBaseTouchInteraction(this),new De.controls.ListBaseInteraction(this)):new De.controls.ListBaseInteraction(this)},Be.ext("twaver.controls.ListBase",De.controls.View,{__bool:["innerText"],_innerText:kn.LISTBASE_INNER_TEXT,getDataDiv:function(){return this._dataDiv},getStartRowIndex:function(){return this._startRowIndex},getEndRowIndex:function(){return this._endRowIndex},getRowDatas:function(){return this._rowDatas},getRowIndexByData:function(t){return this._dataRowMap[t.getId()]},getRowIndexById:function(t){return this._dataRowMap[t]},getRowSize:function(){return this._rowDatas.size()},getDataBox:function(){return this._box},setDataBox:function(t){if(!t)throw"DataBox can not be null";if(this._box!==t){var e=this._box;e&&(e.removeDataBoxChangeListener(this.handleDataBoxChange,this),e.removeDataPropertyChangeListener(this.handlePropertyChange,this),e.removeHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel||e.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=t,this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._box.addHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(t):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidateModel(),this.firePropertyChange("dataBox",e,this._box)}},onPropertyChanged:function(t){"zoom"===t.property?this.invalidate():this.invalidateModel()},invalidateModel:function(){this._invalidateModel||(this._invalidateModel=!0,this._invalidateDisplay=!0,this._invalidateDatas=null,this.invalidate())},invalidateDisplay:function(){this._invalidateDisplay||(this._invalidateDisplay=!0,this._invalidateDatas=null,this.invalidate())},invalidateData:function(t){this._invalidateDisplay||(this._invalidateDatas||(this._invalidateDatas={}),this._invalidateDatas[t.getId()]=t,this.invalidate())},validateImpl:function(){var t=this._view.scrollLeft,e=this._view.scrollTop;this._invalidateModel&&(this._invalidateModel=!1,this.validateModel()),this._invalidateDisplay&&(this._invalidateDisplay=!1,this._renderMap={},je.release(this._dataDiv),this._dataDiv.style.height=this.getRowSize()*this._rowHeight+"px");var i;if(this._invalidateDatas){for(i in this._invalidateDatas){var n=this._renderMap[i];n&&(je.release(n),this._dataDiv.removeChild(n),delete this._renderMap[i])}this._invalidateDatas=null}var s=this._view.scrollTop/this._zoom,r=this._view.clientHeight/this._zoom;this._startRowIndex=Math.floor(s/this._rowHeight)-2,this._endRowIndex=Math.ceil((s+r)/this._rowHeight)+2,this._startRowIndex<0&&(this._startRowIndex=0),this._endRowIndex>this._rowDatas.size()&&(this._endRowIndex=this._rowDatas.size());for(var a=this._rowHeight-this._rowLineWidth-2+"px",o=this._rowLineWidth+"px",h=this._startRowIndex;h<this._endRowIndex;h++){var l=this._rowDatas.get(h);i=l.getId();var c=this._renderMap[i];if(!c){c=this.__divPool.get();var u=c.style;u.position="absolute",u.whiteSpace="nowrap",u.lineHeight=a,u.top=h*this._rowHeight+"px",u.borderStyle="solid",u.borderWidth="0px",u.borderBottomWidth=o,u.borderBottomColor=this._rowLineColor,u.opacity=l.getStyle?l.getStyle("whole.alpha"):1,this._dataDiv.appendChild(c),this._renderMap[i]=c;var d=this.isSelected(l);this.renderData(c,l,h,d),this.onDataRendered(c,l,h,d)}}this._dataDiv.style.width=this.calculateSumWidth()+"px","0px"===this._dataDiv.style.height&&(this._dataDiv.style.height="1px"),Be.keys(this._renderMap).forEach(function(t){var e=this.getRowIndexById(t);if(e<this._startRowIndex||e>=this._endRowIndex){var i=this._renderMap[t];je.release(i),this._dataDiv.removeChild(i),delete this._renderMap[t]}},this),this._pools.forEach(function(t){t.clear()}),this._view.scrollLeft!==t&&(this._view.scrollLeft=t),this._view.scrollTop!==e&&(this._view.scrollTop=e),this.adjustRowSize(),this.onValidated()},adjustRowSize:function(){var t,e,i=this._rowHeight-this._rowLineWidth+"px",n=Math.floor((this._view.scrollLeft+this._view.clientWidth)/this._zoom)+"px";for(t in this._renderMap)e=this._renderMap[t],e.style.height=i,e.style.width=n},onValidated:function(){},onDataRendered:function(t,e,i,n){},calculateSumWidth:function(){return 0},_addCheckBox:function(t,e,i){var n=this.__checkBoxPool.get();return n.keepDefault=!0,n.type="checkbox",n.style.margin="0px 2px",n.style.verticalAlign="middle",n._checkData=e,n.checked=i,n.disabled=!1,t.appendChild(n),n},_addIcon:function(t,e,i,n){var s,r=Be.getImageAsset(i),a=this.getInnerColor(e),o=this.getOuterColor(e),h=this.getAlarmFillColor(e);if(r&&r.getImage()){var l=r.getWidth(),c=r.getHeight();s=this.__canvasPool.get(),s.style.verticalAlign="middle",s.setAttribute("width",l),s.setAttribute("height",c);var u=s.getContext("2d");u.clearRect(0,0,l,c);var d={x:0,y:0,width:l,height:c};Fi(u,i,a,d,e,this),o&&(u.lineWidth=2,u.strokeStyle=o,u.beginPath(),u.rect(0,0,l,c),u.closePath(),u.stroke()),h&&(u.fillStyle=qe.createRadialGradient(u,h,"white",1,c-9,8,8,.75,.25),u.beginPath(),u.arc(5,c-5,4,0,2*Math.PI,!0),u.closePath(),u.fill())}else s=this.__imagePool.get(),s.style.verticalAlign="middle",s.setAttribute("src",Be.getImageSrc(i));s.style.margin="0px 1px 0px 1px",s._selectData=n,t.appendChild(s)},_addLine:function(t,e,i,n){var s,r,a=this.__linePool.get(),o=Be.getImageAsset(i),h=this.getToggleImage(e),l=this._levelMap[e.getId()],c=this._indent,u=c,d=c,f=0;this.isCheckable(e),"disabled"===this.getUncheckableStyle(),f=2,o&&(u=o.getWidth(),d=o.getHeight()),n?(s=(l+f-1)*c+u,r=this.getRowHeight()):(s=(l+f-1)*c+u,r=this.getRowHeight()),t.style.width=(l+f-1)*c+"px",t.style.height=r+"px";var g=this.getLineType(),_=this.getLineColor(),p=this.getLineAlpha(),v=this.getLineThickness(),m=this.getLineDash();Be.getImageSrc(h),a.style.verticalAlign="top",a.style.margin="0px 0px 0px 0px",a.style.zIndex=-1,a.setAttribute("width",s),a.setAttribute("height",r);var y=a.getContext("2d");y.lineWidth=v,y.strokeStyle=_,y.globalAlpha=p,"dotted"===g&&y.setLineDash(m);var A=2*(l+f);if(n){var x=e,w=x.getParent();y.clearRect(0,0,s,r),null===w&&0!==e.getChildrenSize()&&this.isExpanded(e)&&(y.moveTo((l+f+1)*s/A,r/2+d/2),y.lineTo((l+f+1)*s/A,r),y.stroke());for(var b=2*l-1;b>=1;b-=2){if(x.getClient("isLast")){if(x=w,w=x.getParent(),(b+1)/2!=l)continue}else x=w,w=x.getParent();b==2*l-1?(y.moveTo((b+f)*s/A,0),y.lineTo((b+f)*s/A,r/2),y.stroke(),y.moveTo((b+f)*s/A,r/2),y.lineTo((b+f+1)*s/A,r/2),y.stroke(),0!==e.getChildrenSize()&&this.isExpanded(e)&&(y.moveTo((b+f+2)*s/A,r/2+d/2),y.lineTo((b+f+2)*s/A,r),y.stroke())):(y.moveTo((b+f)*s/A,0),y.lineTo((b+f)*s/A,r),y.stroke())}}else{var x=e,w=x.getParent();y.clearRect(0,0,s,r);for(var b=2*l-1;b>=1;b-=2){if(x.getClient("isLast")){if(x=w,w=x.getParent(),(b+1)/2!=l)continue}else x=w,w=x.getParent();y.moveTo((b+f)*s/A,0),y.lineTo((b+f)*s/A,r),y.stroke(),b==2*l-1&&(y.moveTo((b+f)*s/A,r/2),y.lineTo((b+f+1)*s/A,r/2),y.stroke(),0!==e.getChildrenSize()&&this.isExpanded(e)&&(y.moveTo((b+f+2)*s/A,r/2+d/2),y.lineTo((b+f+2)*s/A,r),y.stroke()))}}return t.appendChild(a),a},isVisible:function(t){return!!this._box.contains(t)&&(!this._visibleFunction||this._visibleFunction(t))},handleDataBoxChange:function(t){this.invalidateModel()},handlePropertyChange:function(t){"parent"===t.property?this.invalidateModel():this.invalidateData(t.source)},handleHierarchyChange:function(t){this.invalidateModel()},handleSelectionChange:function(t){t.datas.forEach(function(t){this.invalidateData(t)},this),this.onSelectionChanged(t)},getRowIndexAt:function(t){var e=this.getLogicalPoint(t);if(!e)return-1;var i=parseInt(e.y/this._rowHeight);return i>=0&&i<this._rowDatas.size()?i:-1},getDataAt:function(t){var e=this.getRowIndexAt(t);return e>=0?this._rowDatas.get(e):null},getCurrentSortFunction:function(){return this._sortFunction},validateModel:function(){this._rowDatas.clear(),this._dataRowMap={},this._buildChildren(this._box.getRoots()),this._rowDatas=this._rowDatas.toList(this.isVisible,this);var t=this.getCurrentSortFunction();t&&this._rowDatas.sort(t);for(var e=this._rowDatas.size(),i=0;e>i;i++)this._dataRowMap[this._rowDatas.get(i).getId()]=i},_buildChildren:function(t){t.forEach(function(t){this._rowDatas.add(t),this._buildChildren(t.getChildren())},this)},_handlePressSelection:function(t,e){var i=this.getSelectionModel();if(Be.isCtrlDown(e))i.contains(t)?i.removeSelection(t):i.appendSelection(t);else if(e.shiftKey&&i.getLastData()){var n=i.getLastData(),s=this.getRowIndexByData(n),r=this.getRowIndexByData(t),a=new gn;for(a.add(this.getRowDatas().get(s));s!==r;)s+=r>s?1:-1,a.add(this.getRowDatas().get(s));i.setSelection(a)}else 1===i.size()&&i.contains(t)||i.setSelection(t);this.fireInteractionEvent({kind:2===e.detail?"doubleClick":"click",data:t})},_handleClick:function(t){this.isFocusOnClick()&&De.Util.setFocus(this._view);var e=this.getDataAt(t);if(e){if(this.isCheckMode()&&!t.target._checkData){var i=this.getRowIndexByData(e);if(this._focusedRow!==i){var n=this._rowDatas.get(this._focusedRow);this._focusedRow=i,n&&this.invalidateData(n),this.invalidateData(e)}}this.isCheckMode()||this._handlePressSelection(e,t)}if(this._currentEditor&&this.commitEditValue(this._currentEditor._editInfo,this._currentEditor),this.updateCurrentEditor){var s=this;setTimeout(function(){s.updateCurrentEditor(t)},0)}},handleChange:function(t){if(!this._isCanceling&&!this._isValidating){var e=t.target._checkData;if(e){var i=this.isSelected(e),n=this.getSelectionModel();i?n.removeSelection(e):n.appendSelection(e)}t.target._editInfo&&this.commitEditValue&&this.commitEditValue(t.target._editInfo,t.target)}},scrollToData:function(t){if(t){var e=this.getRowIndexById(t.getId());if(!(0>e)){var i=e*this._rowHeight*this._zoom,n=i+this._rowHeight*this._zoom,s=this._view.scrollTop;this._view.scrollTop>i&&(s=i),this._view.scrollTop+this._view.clientHeight<n&&(s=n-this._view.clientHeight),this._view.scrollTop!=s&&(this._view.scrollTop=s,this.invalidate())}}},makeVisible:function(t){this.isVisible(t)&&(this.expand&&this.expand(t),Be.callLater(this.scrollToData,this,[t],2*kn.CALL_LATER_DELAY))},onSelectionChanged:function(t){this._makeVisibleOnSelected&&("append"===t.kind||"set"===t.kind||"all"===t.kind)&&(this.expand&&this.getSelectionModel().getSelection().forEach(function(t){t.getParent()&&this.expand(t.getParent())},this),Be.callLater(this.scrollToData,this,[this.getSelectionModel().getLastData()],2*kn.CALL_LATER_DELAY))},onShareSelectionModelChanged:function(){this.invalidateModel()}}),De.controls.TableBase=function(t){this._columnBox=new De.ColumnBox,this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange,this),this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange,this),this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange,this),De.controls.TableBase.superClass.constructor.apply(this,arguments),this._cellPool=new De.Pool("div",20),this._stringPool=new De.Pool("span",20),this._booleanPool=new De.Pool("input",20),this._colorPool=new De.Pool("div",20),this._pools.add(this._cellPool),this._pools.add(this._stringPool),this._pools.add(this._booleanPool),this._pools.add(this._colorPool)},Be.ext("twaver.controls.TableBase",De.controls.ListBase,{getColumnBox:function(){return this._columnBox},handleColumnBoxChange:function(t){this.invalidateDisplay()},handleColumnPropertyChange:function(t){t.source!==this._sortColumn||"sortDirection"!==t.property&&"sortFunction"!==t.property&&"sortable"!==t.property?this.invalidateDisplay():this.invalidateModel()},handleColumnHierarchyChange:function(t){this.invalidateDisplay()},renderData:function(t,e,i,n){for(var s,r=this._columnBox.getRoots(),a=r.size(),o=0,h=this._rowHeight-this._rowLineWidth+"px",l=0;a>l;l++){var c=r.get(l),u=c.getWidth();0>u&&(u=0);var d=Math.min(this._columnLineWidth,u);if(c.isVisible()){var f=this._cellPool.get();s=f.style,s.position="absolute",s.whiteSpace="nowrap",s.verticalAlign="middle",s.textAlign=c.getHorizontalAlign(),s.overflow="hidden",s.textOverflow="ellipsis",s.left=o+"px",s.width=u-d+"px",s.height=h,s.borderStyle="solid",s.borderWidth="0px",s.borderRightWidth=d+"px",s.borderRightColor=this._columnLineColor,0===l?(s.borderLeftWidth=d+"px",s.borderLeftColor=this._columnLineColor):s.borderLeftWidth="0px",t.appendChild(f);var g={data:e,value:this.getValue(e,c),div:f,view:this,column:c,rowIndex:i,selected:n};this.renderCell(g),this.onCellRendered(g),o+=u}}s=t.style,s.width=o+"px",s.height=h,s.backgroundColor=this.isCheckMode()&&this._focusedRow===i||!this.isCheckMode()&&n?this.getSelectColor(e):""},adjustRowSize:function(){},onCellRendered:function(t){},calculateSumWidth:function(){for(var t=this._columnBox.getRoots(),e=t.size(),i=0,n=0;e>n;n++){var s=t.get(n),r=s.getWidth();0>r&&(r=0),i+=r}return i},getCurrentSortFunction:function(){var t=this._sortColumn;if(t){var e=t.getSortFunction();if(e){var i=this,n="asc"===t.getSortDirection()?1:-1;return function(s,r){var a=i.getValue(s,t),o=i.getValue(r,t);return e.call(i,a,o,s,r)*n}}}return this._sortFunction},renderCell:function(t){var e=t.column;if(e.renderCell)return void e.renderCell(t);var i=t.value,n=e.getEnumInfo(t.rowIndex);n&&!Array.isArray(n)&&(i=n.map[i]),t.view.isCellEditable(t.data,e)&&(t.enumInfo=n,t.div._editInfo=t),Ti.render(e.getValueType(),i,t.div,t.view,e.isInnerText())},getValue:function(t,e){return e.getValue(t,this)},setValue:function(t,e,i){e.setValue(t,i,this)},getColumnAt:function(t){var e=this.getLogicalPoint(t);if(!e)return null;for(var i=this._columnBox.getRoots(),n=0,s=i.size(),r=0;s>n;n++){var a=i.get(n),o=a.getWidth();if(0>o&&(o=0),e.x>r&&e.x<r+o)return a;r+=o}return null},isCellEditable:function(t,e){return this.isEditable()&&e.isEditable()},commitEditValue:function(t,e){if(!this._isCanceling){var i;i="checkbox"===e.type?e.checked:e.value;var n=t.column,s=n.getValueType();if("int"===s&&"string"==typeof i?i=parseInt(i):"number"===s&&"string"==typeof i&&(i=parseFloat(i)),this.setValue(t.data,n,i),this._currentEditor){var r=this._currentEditor.parentNode,a=this._currentEditor;delete this._currentEditor,r&&r.removeChild(a),De.Util.setFocus(this._view)}delete this._isCommitting}},cancelEditing:function(){if(this._currentEditor){this._isCanceling=!0;var t=this._currentEditor.parentNode,e=this._currentEditor;delete this._currentEditor,t&&t.removeChild(e),De.Util.setFocus(this._view),delete this._isCanceling}},renderEditor:function(t){},onEditorRendered:function(t){},updateCurrentEditor:function(t){var e=t.target;if(e!==this._currentEditor&&e.parentNode!==this._currentEditor){for(var i;e&&e!==this._view&&!(i=e._editInfo);)e=e.parentNode;if(i&&e===i.div){var n=this.renderEditor&&this.renderEditor(i);n?(this._currentEditor=n.view,null!=i.value&&(this._currentEditor.value=i.value)):i.enumInfo?this._currentEditor=je.createSelect(i.enumInfo,i.value):(this._currentEditor=Ve.createElement("input"),null!=i.value&&(this._currentEditor.value=i.value));var s=this;if(this._currentEditor){if(n&&n.onKeyDown){var r=n.onKeyDown;r&&Array.isArray(r)&&s._currentEditor.addEventListener("keydown",function(t){for(var e=0;e<r.length;e++)if(r[e].combKey){var i=null;switch(r[e].combKey){case"ctrlKey":i=t.ctrlKey;break;case"shiftKey":i=t.shiftKey;break;case"altKey":i=t.altKey}t.keyCode===r[e].keyCode&&i&&r[e].handlerEvent&&r[e].handlerEvent(t)}else t.keyCode===r[e].keyCode&&r[e].handlerEvent&&r[e].handlerEvent(t)})}else this._currentEditor.addEventListener("keydown",function(t){var e=t.target._editInfo.view;13===t.keyCode&&t.shiftKey||(13===t.keyCode?e.commitEditValue(t.target._editInfo,t.target):27===t.keyCode&&e.cancelEditing())},!1);if(this._currentEditor.addEventListener("blur",function(t){var e=t.target._editInfo.view;e._isCanceling||e.commitEditValue(t.target._editInfo,t.target)},!1),this._currentEditor.keepDefault=!0,this._currentEditor._editInfo=i,!this._currentEditor.parentNode){var a=this._currentEditor.style;a.position="absolute",a.margin="0px",a.border="0px",a.padding="0px",a.left=i.div.style.left,a.top=i.div.parentNode.style.top,a.width=i.div.style.width,a.height=i.div.style.height,this._rootDiv.appendChild(this._currentEditor)}De.Util.setFocus(this._currentEditor)}}}},onColumnSorted:function(t){},getCurrentEditor:function(){return this._currentEditor}}),De.controls.List=function(t){De.controls.List.superClass.constructor.apply(this,arguments)},Be.ext("twaver.controls.List",De.controls.ListBase,{__accessor:["rowHeight","indent","rowLineWidth","rowLineColor","sortFunction","visibleFunction"],__bool:["makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_checkMode:!1,_rowHeight:kn.LIST_ROW_HEIGHT,_indent:kn.LIST_INDENT,_rowLineWidth:kn.LIST_ROW_LINE_WIDTH,_rowLineColor:kn.LIST_ROW_LINE_COLOR,_makeVisibleOnSelected:kn.LIST_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:kn.LIST_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:kn.LIST_KEYBOARD_SELECT_ENABLED,isCheckMode:function(){return this._checkMode},setCheckMode:function(t){delete this._focusedRow;var e=this._checkMode;this._checkMode=t,this.firePropertyChange("checkMode",e,t)},isCheckable:function(t){return this._checkMode===!0},renderData:function(t,e,i,n){var s;this._indent>0&&(s=this.__spanPool.get(),s.style.width=this._indent+"px",s.style.display="inline-block",t.appendChild(s));var r=this.isCheckable(e);r&&this._addCheckBox(t,e,n);var a=this.getIcon(e);a&&this._addIcon(t,e,a);var o=this.getLabel(e);if(o){s=this.__textPool.get();var h=s.style;h.whiteSpace="nowrap",h.verticalAlign="middle",h.padding="1px 2px 1px 2px",h.display="inline-block",Be.setText(s,o,this._innerText),this.onLabelRendered(s,e,o,i,n),t.appendChild(s)}t.style.backgroundColor=this.isCheckMode()?this._focusedRow===i?this.getSelectColor(e):"":n?this.getSelectColor(e):""},onLabelRendered:function(t,e,i,n,s){}}),De.controls.ListBaseInteraction=function(t){this.listBase=t,this.view=t._view;var e=this;this.view.addEventListener("scroll",function(t){e.handleScroll(t)},!1),this.view.addEventListener("mousedown",function(t){e.handleMouseDown(t)},!1),this.view.addEventListener("keydown",function(t){e.handleKeyDown(t)},!1)},Be.ext("twaver.controls.ListBaseInteraction",Object,{handleMouseDown:function(t){var e=this.listBase;t.target!==e._currentEditor&&t.target.parentNode!==e._currentEditor&&e._handleClick(t)},handleKeyDown:function(t){var e=this.listBase;if(!e._currentEditor)if(Be.isCtrlDown(t)&&65==t.keyCode)e.isKeyboardSelectEnabled()&&e.selectAll().size()>0&&e.fireInteractionEvent({kind:"selectAll"}),je.preventDefault(t);else if(46==t.keyCode)e.isKeyboardRemoveEnabled()&&e.removeSelection()&&e.fireInteractionEvent({kind:"removeElement"}),je.preventDefault(t);else if(e.isCheckMode()||38!==t.keyCode&&40!==t.keyCode&&37!==t.keyCode&&39!==t.keyCode)Be.showVersion(t);else{var i=e.getSelectionModel().getLastData();if(i)if(38===t.keyCode||40===t.keyCode){var n=e.getRowDatas(),s=e.getRowIndexByData(i);s>=0&&(38===t.keyCode?0!==s&&(i=n.get(s-1),e.getSelectionModel().setSelection(i)):s!==n.size()-1&&(i=n.get(s+1),e.getSelectionModel().setSelection(i)))}else!e.expand||37!==t.keyCode&&39!==t.keyCode||i.hasChildren()&&(37===t.keyCode?e.collapse(i):e.expand(i));else e.getRowDatas().size()>0&&(i=e.getRowDatas().get(0),e.getSelectionModel().setSelection(i))}},handleScroll:function(t){this.listBase.invalidate()}}),De.controls.ListBaseTouchInteraction=function(t){this.listBase=t,this.view=t._view,je.addEventListener("touchstart","handleTouchstart",this.view,this)},Be.ext("twaver.controls.ListBaseTouchInteraction",Object,{handleTouchstart:function(t){je.preventDefault(t),this.startPoint=this.lastPoint=this.listBase.getLogicalPoint(t),je.addEventListener("touchmove","handleTouchmove",this.view,this),je.addEventListener("touchend","handleTouchend",this.view,this),Ci.isMultiTouch(t)&&(this.distance=Ci.getDistance(t),this.zoom=this.listBase._zoom)},handleTouchmove:function(t){je.preventDefault(t);var e=this.listBase.getLogicalPoint(t);if(!(Ge.getDistance(this.startPoint,e)<20))if(this.moved||(this.moved=!0),Ci.isSingleTouch(t)){if(this.lastPoint){var i=this.lastPoint.x-e.x,n=this.lastPoint.y-e.y,s=this.listBase.panByOffset(i,n);this.listBase.invalidate(),this.lastPoint.x-=i-s.x,this.lastPoint.y-=n-s.y}}else if(this.distance){var r=Ci.getDistance(t)/this.distance;this.listBase.setZoom(this.zoom*r,!1)}},handleTouchend:function(t){je.preventDefault(t),this.moved||t.target===this.listBase._currentEditor||t.target.parentNode===this.listBase._currentEditor||this.listBase._handleClick(t),delete this.startPoint,delete this.lastPoint,delete this.moved,delete this.distance,delete this.zoom,je.removeEventListener("touchmove",this.view,this),je.removeEventListener("touchend",this.view,this)}}),De.controls.ListBaseMSTouchInteraction=function(t){De.controls.ListBaseMSTouchInteraction.superClass.constructor.apply(this,arguments),this._pointerMap={},this._pointerIdArray=[],je.addEventListener("MSPointerDown","handleTouchstart",this.view,this),je.addEventListener("MSPointerMove","handleTouchmove",this.view,this),je.addEventListener("MSPointerUp","handleTouchend",this.view,this),je.addEventListener("MSPointerCancel","handleTouchend",this.view,this),this.superHandleMouseDown=De.controls.ListBaseMSTouchInteraction.superClass.handleMouseDown},Be.ext("twaver.controls.ListBaseMSTouchInteraction",De.controls.ListBaseInteraction,{handleMouseDown:function(t){},handleTouchstart:function(t){t.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),this._pointerMap[t.pointerId]||null==this.listBase.getLogicalPoint(t)||(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t),1==this._pointerIdArray.length&&t.pointerType==t.MSPOINTER_TYPE_MOUSE&&this.superHandleMouseDown(t),1==this._pointerIdArray.length?(this._startTouchPoint=this.listBase.getLogicalPoint(t),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.listBase.getZoom())},handleTouchmove:function(t){if(null!=this._startTouchPoint&&0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(Ge.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=10))if(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length){var e=this._getDistance()/this._distance;this.listBase.setZoom(this._zoom*e,!1)}else if(1==this._pointerIdArray.length&&t.pointerType!=t.MSPOINTER_TYPE_MOUSE&&this._startTouchPoint){var i=this.listBase.getLogicalPoint(t);if(null==i)return;var n=this._startTouchPoint.x-i.x,s=this._startTouchPoint.y-i.y,r=this.listBase.panByOffset(n,s);this.listBase.invalidate(),this._startTouchPoint.x-=n-r.x,this._startTouchPoint.y-=s-r.y}},handleTouchend:function(t){if(this._startTouchPoint&&1==this._pointerIdArray.length&&t.pointerType!=t.MSPOINTER_TYPE_MOUSE){var e=this.listBase.getLogicalPoint(t);if(e){var i=new Date;i.getTime()-this._startTouchTime.getTime()<=500&&Ge.getDistance(this._startTouchPoint,e)<=20&&this.superHandleMouseDown(t)}}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Ge.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),De.controls.Tree=function(t){
this._interactionDispatcher=new De.EventDispatcher,this._initTree(t),De.controls.Tree.superClass.constructor.apply(this,arguments)},Be.ext("twaver.controls.Tree",De.controls.ListBase,{__tree:1,__accessor:["rootData","sortFunction","visibleFunction","indent","rowHeight","rowLineWidth","rowLineColor","expandIcon","collapseIcon","uncheckableStyle","lineType","lineColor","lineThickness","lineAlpha","lineDash"],__bool:["rootVisible","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_checkMode:!1,_indent:kn.TREE_INDENT,_rowHeight:kn.TREE_ROW_HEIGHT,_rowLineWidth:kn.TREE_ROW_LINE_WIDTH,_rowLineColor:kn.TREE_ROW_LINE_COLOR,_makeVisibleOnSelected:kn.TREE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:kn.TREE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:kn.TREE_KEYBOARD_SELECT_ENABLED,_expandIcon:kn.TREE_EXPAND_ICON,_collapseIcon:kn.TREE_COLLAPSE_ICON,_uncheckableStyle:"none",_lineType:kn.TREE_LINE_TYPE,_lineColor:kn.TREE_LINE_COLOR,_lineThickness:kn.TREE_LINE_THICKNESS,_lineAlpha:kn.TREE_LINE_ALPHA,_lineDash:kn.TREE_LINE_DASH,getCheckMode:function(){return this._checkMode},setCheckMode:function(t){delete this._focusedRow;var e=this._checkMode;this._checkMode=t,this.firePropertyChange("checkMode",e,t)},renderData:function(t,e,i,n){this._renderTree(t,e,i,n)},getToolTip:function(t){return t.getToolTip()||t.getName()}}),De.controls.Table=function(t){this._checkColumn=new De.Column,this._checkColumn.setName("check"),this._checkColumn.setEditable(!0),this._checkColumn.setWidth(40),this._checkColumn.setHorizontalAlign("center"),this._checkColumn.renderCell=this.renderCheckCell;var e=this;this._checkColumn.getValue=function(t,i){return e.isSelected(t)},De.controls.Table.superClass.constructor.apply(this,arguments)},Be.ext("twaver.controls.Table",De.controls.TableBase,{__accessor:["rowHeight","rowLineWidth","rowLineColor","columnLineWidth","columnLineColor","sortFunction","visibleFunction","sortColumn"],__bool:["editable","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_editable:kn.TABLE_EDITABLE,_rowHeight:kn.TABLE_ROW_HEIGHT,_rowLineWidth:kn.TABLE_ROW_LINE_WIDTH,_rowLineColor:kn.TABLE_ROW_LINE_COLOR,_columnLineWidth:kn.TABLE_COLUMN_LINE_WIDTH,_columnLineColor:kn.TABLE_COLUMN_LINE_COLOR,_makeVisibleOnSelected:kn.TABLE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:kn.TABLE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:kn.TABLE_KEYBOARD_SELECT_ENABLED,getCheckColumn:function(){return this._checkColumn},isCheckMode:function(){return this._columnBox.contains(this._checkColumn)},setCheckMode:function(t){t!==this.isCheckMode()&&(delete this._focusedRow,t?this._columnBox.add(this._checkColumn,0):this._columnBox.remove(this._checkColumn),this.firePropertyChange("checkMode",!t,t))},renderCheckCell:function(t){var e=t.view._booleanPool.get();e.disabled=!1,e.type="checkbox",e.style.margin="0px 2px",e.style.verticalAlign="middle",e.checked=t.selected;var i=t.div;i.appendChild(e),""===i.style.textAlign&&(i.style.textAlign="center"),e._checkData=t.data}}),De.controls.TableHeader=function(t){De.controls.TableHeader.superClass.constructor.apply(this,arguments),this._invalidateScroll=!1,this._invalidateDisplay=!1,this._divPool=new De.Pool("div"),this._imagePool=new De.Pool("img"),this._textPool=new De.Pool("span"),this._resizePool=new De.Pool("div"),this._pools.add(this._divPool),this._pools.add(this._imagePool),this._pools.add(this._textPool),this._pools.add(this._resizePool),this._table=t,this._tableView=t.getView(),this._columnBox=t.getColumnBox(),this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange,this),this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange,this),this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange,this);var e=this;t.getView().addEventListener("scroll",function(t){e.invalidateScroll()},!1),t.addPropertyChangeListener(function(t){e.invalidateDisplay()},this),this._view=je.createView("hidden"),this._view.tabIndex=-1,this._view.style.background=kn.TABLEHEADER_BACKGROUND,this._rootDiv=je.createDiv(),this._view.appendChild(this._rootDiv),this.invalidateDisplay(),He.isTouchable&&new De.controls.TableHeaderTouchInteraction(this),new De.controls.TableHeaderInteraction(this)},Be.ext("twaver.controls.TableHeader",De.controls.ControlBase,{__accessor:["height","moveBackground","insertBackground","columnLineColor","resizeTolerance","sortDescIcon","sortAscIcon","sortIconPosition"],_height:kn.TABLEHEADER_HEIGHT,_moveBackground:kn.TABLEHEADER_MOVE_BACKGROUND,_insertBackground:kn.TABLEHEADER_INSERT_BACKGROUND,_columnLineColor:kn.TABLEHEADER_COLUMN_LINE_COLOR,_resizeTolerance:kn.TABLEHEADER_RESIZE_TOLERANCE,_sortDescIcon:kn.TABLEHEADER_SORT_DESC_ICON,_sortAscIcon:kn.TABLEHEADER_SORT_ASC_ICON,_sortIconPosition:kn.TABLEHEADER_SORT_ICON_POSITION,getRootDiv:function(){return this._rootDiv},handleColumnBoxChange:function(t){this.invalidateDisplay()},handleColumnPropertyChange:function(t){this.invalidateDisplay()},handleColumnHierarchyChange:function(t){this.invalidateDisplay()},onPropertyChanged:function(t){this.invalidateDisplay()},invalidateScroll:function(){this._invalidateScroll||(this._invalidateScroll=!0,this.invalidate())},invalidateDisplay:function(){this._invalidateDisplay||(this._invalidateDisplay=!0,this._invalidateScroll=!0,this.invalidate())},validate:function(){this._invalidate&&(this._invalidate=!1,this._invalidateDisplay&&(this._invalidateDisplay=!1,this.validateDisplay()),this._invalidateScroll&&(this._invalidateScroll=!1,this._rootDiv.style.left=-this._tableView.scrollLeft+"px"))},validateDisplay:function(){je.release(this._rootDiv);for(var t=this._table.getZoom(),e=this.getHeight()+"px",i=this.getHeight()-2+"px",n=this._table.getColumnBox().getRoots(),s=n.size(),r=0,a=this._table._columnLineWidth*t,o=0;s>o;o++){var h=n.get(o);if(h.isVisible()){var l=h.getWidth()*t;0>l&&(l=0);var c=Math.min(a,l),u=this._divPool.get();u._column=h;var d=u.style;d.position="absolute",d.whiteSpace="nowrap",d.lineHeight=i,d.overflow="hidden",d.textOverflow="ellipsis",d.backgroundPosition=this._sortIconPosition?this._sortIconPosition:"",d.backgroundRepeat="no-repeat",d.backgroundImage="",d.textAlign=h.getHorizontalAlign(),d.borderStyle="solid",d.borderWidth="0px",d.borderRightWidth=c+"px",d.borderRightColor=this._columnLineColor,0===o?(d.borderLeftWidth=c+"px",d.borderLeftColor=this._columnLineColor):d.borderLeftWidth="0px",d.left=r+"px",d.width=l-c+"px",d.height=e,u._x=r,u._width=l-c,this._rootDiv.insertBefore(u,this._rootDiv.firstChild),this.renderColumn(u,h),this.onColumnRendered(u,h),r+=l,h.isResizable()&&(u=this._resizePool.get(),u._resizeColumn=h,d=u.style,d.position="absolute",d.backgroundColor="white",d.opacity=0,d.left=r-c-this._resizeTolerance+"px",d.width=c+2*this._resizeTolerance+"px",d.height=e,this._rootDiv.appendChild(u))}}this._pools.forEach(function(t){t.clear()}),this._rootDiv.style.width=r+"px",this._rootDiv.style.height=e},renderColumn:function(t,e){if(e.renderHeader)e.renderHeader(t);else{var i=this._textPool.get();if(i.style.whiteSpace="nowrap",i.style.verticalAlign="middle",i.style.padding="1px 2px 1px 2px",i.innerHTML=e.getName()?e.getName():e.getPropertyName(),i.setAttribute("title",i.innerHTML),t.appendChild(i),He.isOpera){var n=t.cloneNode(!1);n.style.left="0px",n.style.top="0px",n.style.opacity=0,t.appendChild(n)}}if(this._table.getSortColumn()===e&&e.isSortable()){var s="asc"===e.getSortDirection()?this._sortAscIcon:this._sortDescIcon,r=Be.getImageSrc(s);if(this._sortIconPosition&&""!==this._sortIconPosition)t.style.backgroundImage="url("+r+")";else{var a=this._imagePool.get();a.setAttribute("src",r),a.style.verticalAlign="middle",t.appendChild(a)}}},onColumnRendered:function(t,e){}}),De.controls.TableHeaderInteraction=function(t){this.header=t,this.table=t._table,this.view=t._view;var e=this;this.view.addEventListener("mousedown",function(t){e.handleMouseDown(t)},!1),this.view.addEventListener("mousemove",function(t){e.handleMouseMove(t)},!1)},Be.ext("twaver.controls.TableHeaderInteraction",Object,{handleMouseDown:function(t){if(0===t.button){if(this.movableDiv)return void this.handleMouseUp(t);this.resizeColumn=t.target._resizeColumn,this.resizeColumn||(this.movableDiv=this.getMovableDivAt(t)),this.changeCursor(t),this._startClient=je.getClientPoint(t),this.lastX=this.getX(t),this._startLogicalX=this.lastX,je.handle_mousedown(this,t)}},changeCursor:function(t){var e="";if(t.target._resizeColumn)e="ew-resize";else{var i=this.getColumnAt(t);i&&(i.isMovable()||i.isSortable())&&(e="pointer")}this.view.style.cursor=e},handleMouseMove:function(t){if(null==this.lastX)return void this.changeCursor(t);if(je.target===this){var e=this._startLogicalX+t.clientX-this._startClient.x;if(this.resizeColumn){if(null!=this.stopX){if(e<this.stopX)return;delete this.stopX}var i=this.resizeColumn.getWidth()+(e-this.lastX)/this.table.getZoom();10>i&&(i=10,this.stopX=e),this.resizeColumn.setWidth(i),this.lastX=e}else if(this.movableDiv){var n=e-this.lastX;if(!this.cloneDiv){if(Math.abs(n)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.header.getMoveBackground(),this.insertDiv=je.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.header.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var s=this.cloneDiv._x+n;this.cloneDiv.style.left=s+"px",this.cloneDiv._x=s,this.lastX=e,this.columnInfo=this.getColumnInfoAt(t),this.columnInfo&&(this.insertDiv.style.left=this.columnInfo.position)}}},handleMouseUp:function(t){if(0===t.button){var e;if(this.resizeColumn);else if(this.movableDiv&&this.columnInfo){e=this.movableDiv._column;var i=this.columnInfo.index;this.table.getColumnBox().moveTo(e,i)}else if(e=this.getColumnAt(t),e&&e.isSortable()){var n=e.getSortDirection();this.table.getSortColumn()===e?("desc"===n&&this.table.setSortColumn(null),e.setSortDirection("asc"===n?"desc":"asc")):this.table.setSortColumn(e),this.table.onColumnSorted(this.table.getSortColumn())}this.clear()}},clear:function(){this.view.style.cursor="",this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.columnInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeColumn,delete this.stopX,delete this.lastX,delete this._startClient,delete this._startLogicalX},getColumnAt:function(t){t=t.target;for(var e;t&&t!==this.view&&!(e=t._column);)t=t.parentNode;return e},getMovableDivAt:function(t){t=t.target;for(var e;t&&t!==this.view&&!(e=t._column);)t=t.parentNode;return e&&e.isMovable()?t:null},getX:function(t){var e=je.getLogicalPoint(this.view,t);return e?e.x:null},getColumnInfoAt:function(t){for(var e=this._startLogicalX+t.clientX-this._startClient.x+this.table.getView().scrollLeft,i=this.table.getColumnBox().getRoots(),n=i.size(),s=this.table.getZoom(),r=0,a=!1,o=0;n>o;o++){var h=i.get(o);if(h===this.movableDiv._column&&(a=!0),h.isVisible()){var l=h.getWidth()*s;if(0>=l)continue;if(e>=r&&r+l>=e){var c=r+l/2>e;!a||h===this.movableDiv._column&&c||o--;var u=c?Math.max(0,o):Math.min(o+1,n),d=c?r:r+l;return d=Math.max(0,d-1),{index:u,column:h,position:d+"px"}}r+=l}}return this.columnInfo}}),De.controls.TableHeaderTouchInteraction=function(t){this.header=t,this.table=t._table,this.view=t._view,je.addEventListener("touchstart","handleTouchstart",this.view,this)},Be.ext("twaver.controls.TableHeaderTouchInteraction",Object,{handleTouchstart:function(t){return je.preventDefault(t),this.movableDiv?void this.handleTouchend(t):(this.resizeColumn=t.target._resizeColumn,this.resizeColumn||(this.movableDiv=this.getMovableDivAt(t)),this.lastX=this.getX(t),je.addEventListener("touchmove","handleTouchmove",this.view,this),void je.addEventListener("touchend","handleTouchend",this.view,this))},handleTouchmove:function(t){if(je.preventDefault(t),null!=this.lastX){var e;if(this.resizeColumn){if(e=this.getX(t),null!=this.stopX){if(e<this.stopX)return;delete this.stopX}var i=this.resizeColumn.getWidth()+(e-this.lastX)/this.table.getZoom();0>i&&(i=0,this.stopX=e),this.resizeColumn.setWidth(i),this.lastX=e}else if(this.movableDiv){e=this.getX(t);var n=e-this.lastX;if(!this.cloneDiv){if(Math.abs(n)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.header.getMoveBackground(),this.insertDiv=je.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.header.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var s=this.cloneDiv._x+n;this.cloneDiv.style.left=s+"px",this.cloneDiv._x=s,this.lastX=e,this.columnInfo=this.getColumnInfoAt(t),this.columnInfo&&(this.insertDiv.style.left=this.columnInfo.position)}}},handleTouchend:function(t){je.preventDefault(t);var e;if(this.resizeColumn);else if(this.movableDiv&&this.columnInfo){e=this.movableDiv._column;var i=this.columnInfo.index;this.table.getColumnBox().moveTo(e,i)}else if(e=this.getColumnAt(t),e&&e.isSortable()){var n=e.getSortDirection();this.table.getSortColumn()===e?("desc"===n&&this.table.setSortColumn(null),e.setSortDirection("asc"===n?"desc":"asc")):this.table.setSortColumn(e)}this.clear(),je.removeEventListener("touchmove",this.view,this),je.removeEventListener("touchend",this.view,this)},clear:function(){this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.columnInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeColumn,delete this.stopX,delete this.lastX},getColumnAt:function(t){t=t.target;for(var e;t&&t!==this.view&&!(e=t._column);)t=t.parentNode;return e},getMovableDivAt:function(t){t=t.target;for(var e;t&&t!==this.view&&!(e=t._column);)t=t.parentNode;return e&&e.isMovable()?t:null},getX:function(t){var e=je.getLogicalPoint(this.view,t);return e?e.x:null},getColumnInfoAt:function(t){for(var e=this.getX(t)+this.table.getView().scrollLeft,i=this.table.getColumnBox().getRoots(),n=i.size(),s=this.table.getZoom(),r=0,a=!1,o=0;n>o;o++){var h=i.get(o);if(h===this.movableDiv._column&&(a=!0),h.isVisible()){var l=h.getWidth()*s;if(0>=l)continue;if(e>=r&&r+l>=e){var c=r+l/2>e;!a||h===this.movableDiv._column&&c||o--;var u=c?Math.max(0,o):Math.min(o+1,n),d=c?r:r+l;return d=Math.max(0,d-1),{index:u,column:h,position:d+"px"}}r+=l}}return this.columnInfo}}),De.controls.TablePane=function(t,e){De.controls.TablePane.superClass.constructor.apply(this,arguments),this.invalidate(),this._table=t,this._tableHeader=e?e:new De.controls.TableHeader(t),this._view=je.createView("hidden",!0),this._view.tabIndex=-1,this._view.appendChild(this._tableHeader.getView()),this._view.appendChild(this._table.getView());var i=this;this._tableHeader.addPropertyChangeListener(function(t){"height"===t.property&&i.invalidate()})},Be.ext("twaver.controls.TablePane",De.controls.ControlBase,{onPropertyChanged:function(t){this.invalidate()},getTable:function(){return this._table},getTableHeader:function(){return this._tableHeader},validateImpl:function(){var t=this._view.offsetWidth,e=this._view.offsetHeight,i=this._tableHeader.getHeight();this._tableHeader.adjustBounds({x:0,y:0,width:t,height:i}),this._table.adjustBounds({x:0,y:i,width:t,height:Math.max(0,e-i)})}}),De.controls.TreeTable=function(t){this._treeColumn=new De.Column,this._treeColumn.setName("tree"),this._treeColumn.setWidth(120),this._treeColumn.renderCell=this.renderTreeCell,this._treeColumn.getValue=this.getTreeValue,this._treeColumn.setValue=this.setTreeValue,this._initTree(t),De.controls.TreeTable.superClass.constructor.apply(this,arguments),this._columnBox.add(this._treeColumn)},Be.ext("twaver.controls.TreeTable",De.controls.TableBase,{__tree:1,__accessor:["sortFunction","visibleFunction","checkMode","rootData","sortColumn","indent","rowHeight","rowLineWidth","rowLineColor","columnLineWidth","columnLineColor","expandIcon","collapseIcon","uncheckableStyle","lineType","lineColor","lineThickness","lineAlpha","lineDash"],__bool:["editable","rootVisible","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_editable:kn.TREETABLE_EDITABLE,_indent:kn.TREETABLE_INDENT,_rowHeight:kn.TREETABLE_ROW_HEIGHT,_rowLineWidth:kn.TREETABLE_ROW_LINE_WIDTH,_rowLineColor:kn.TREETABLE_ROW_LINE_COLOR,_columnLineWidth:kn.TREETABLE_COLUMN_LINE_WIDTH,_columnLineColor:kn.TREETABLE_COLUMN_LINE_COLOR,_makeVisibleOnSelected:kn.TREETABLE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:kn.TREETABLE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:kn.TREETABLE_KEYBOARD_SELECT_ENABLED,_expandIcon:kn.TREETABLE_EXPAND_ICON,_collapseIcon:kn.TREETABLE_COLLAPSE_ICON,_lineType:kn.TREE_LINE_TYPE,_lineColor:kn.TREE_LINE_COLOR,_lineThickness:kn.TREE_LINE_THICKNESS,_lineAlpha:kn.TREE_LINE_ALPHA,_lineDash:kn.TREE_LINE_DASH,getTreeColumn:function(){return this._treeColumn},renderTreeCell:function(t){t.view._renderTree(t.div,t.data,t.rowIndex,t.selected)},getTreeValue:function(t,e){return e.getLabel(t)},setTreeValue:function(t,e,i){t.setName(e)}}),De.controls.PropertySheet=function(t){De.controls.PropertySheet.superClass.constructor.apply(this,arguments),this._currentRowIndex=-1,this._currentEditor=null,this._currentData=null,this._invalidate=!1,this._resizeDiv=je.createDiv(),this._resizeDiv.style.backgroundColor="white",this._resizeDiv.style.opacity=0,this._resizeDiv.style.top="0px",this._categoryList=new gn,this._categoryMap={},this._rowList=new gn,this._propertyBox=new De.PropertyBox,this._propertyBox.addDataBoxChangeListener(this.invalidatePropertyBox,this),this._propertyBox.addDataPropertyChangeListener(this.invalidatePropertyBox,this),this._propertyBox.addHierarchyChangeListener(this.invalidatePropertyBox,this),this.__divPool=new De.Pool("div",2),this.__cellPool=new De.Pool("div",2),this.__imagePool=new De.Pool("img",2),this.__textPool=new De.Pool("span",2),this._stringPool=new De.Pool("span",2),this._booleanPool=new De.Pool("input",2),this._colorPool=new De.Pool("div",2),this._pools.add(this.__divPool),this._pools.add(this.__cellPool),this._pools.add(this.__imagePool),this._pools.add(this.__textPool),this._pools.add(this._stringPool),this._pools.add(this._booleanPool),this._pools.add(this._colorPool),this._view=je.createView("auto"),this._rootDiv=je.createDiv(),this._dataDiv=je.createDiv(),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._dataDiv),this.setDataBox(t?t:new De.DataBox);var e=this;this._view.addEventListener("change",function(t){e.handleChange(t)},!1),He.isTouchable?He.isMSTouchable?new De.controls.PropertySheetMSTouchInteraction(this):(new De.controls.PropertySheetTouchInteraction(this),new De.controls.PropertySheetInteraction(this)):new De.controls.PropertySheetInteraction(this)},Be.ext("twaver.controls.PropertySheet",De.controls.View,{__accessor:["indent","rowHeight","sumWidth","propertyNameWidth","propertyNameHorizontalAlign","autoAdjustable","rowLineWidth","columnLineWidth","borderColor","categorizable","resizeTolerance","editable","selectColor","expandIcon","collapseIcon","sortFunction","visibleFunction"],_autoAdjustable:kn.PROPERTYSHEET_AUTO_ADJUSTABLE,_selectColor:kn.SELECT_COLOR,_categorizable:kn.PROPERTYSHEET_CATEGORIZABLE,_editable:kn.PROPERTYSHEET_EDITABLE,_propertyNameWidth:kn.PROPERTYSHEET_PROPERTY_NAME_WIDTH,_propertyNameHorizontalAlign:kn.PROPERTYSHEET_PROPERTY_NAME_HORIZONTAL_ALIGN,_sumWidth:kn.PROPERTYSHEET_SUM_WIDTH,_indent:kn.PROPERTYSHEET_INDENT,_rowHeight:kn.PROPERTYSHEET_ROW_HEIGHT,_rowLineWidth:kn.PROPERTYSHEET_ROW_LINE_WIDTH,_columnLineWidth:kn.PROPERTYSHEET_COLUMN_LINE_WIDTH,_borderColor:kn.PROPERTYSHEET_BORDER_COLOR,_expandIcon:kn.PROPERTYSHEET_EXPAND_ICON,_collapseIcon:kn.PROPERTYSHEET_COLLAPSE_ICON,_resizeTolerance:kn.PROPERTYSHEET_RESIZE_TOLERANCE,getPropertyBox:function(){return this._propertyBox},getCurrentData:function(){return this._currentData},getDataDiv:function(){return this._dataDiv},getDataBox:function(){return this._box},setDataBox:function(t){if(!t)throw"DataBox can not be null";if(this._box!==t){var e=this._box;e&&(e.removeDataPropertyChangeListener(this.handlePropertyChange,this),this._selectionModel||e.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=t,this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._selectionModel?this._selectionModel._setDataBox(t):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidate(),this.firePropertyChange("dataBox",e,this._box)}},invalidatePropertyBox:function(){this._isValidating||this.invalidate()},onPropertyChanged:function(t){"zoom"!==t.property&&this.invalidate()},isVisible:function(t){return!(t.isVisible&&!t.isVisible(this._currentData,this))&&(!this._visibleFunction||this._visibleFunction(t))},handlePropertyChange:function(t){this._currentData===t.source&&this.invalidate()},handleSelectionChange:function(t){this._currentData!==this.getSelectionModel().getLastData()&&(this._currentRowIndex=-1,this.invalidate())},isExpanded:function(t){if(!t)return!0;var e=this._categoryMap[t];return e?e.isExpanded:kn.PROPERTYSHEET_EXPAND_CATEGORY},expand:function(t){if(t){var e=this._categoryMap[t];e&&!e.isExpanded&&(e.isExpanded=!0,this.invalidate())}},expandAll:function(){for(var t in this._categoryMap){var e=this._categoryMap[t];e&&(e.isExpanded=!0)}this.invalidate()},collapse:function(t){if(t){var e=this._categoryMap[t];e&&e.isExpanded&&(e.isExpanded=!1,this.invalidate())}},collapseAll:function(){for(var t in this._categoryMap){var e=this._categoryMap[t];e&&(e.isExpanded=!1)}this.invalidate()},getCategoryName:function(t){if(!this.isCategorizable())return"null";var e=t.getCategoryName();return e?e:"null"},validateModel:function(){this._rowList.clear(),this._categoryList.clear();var t,e,i,n,s,r={},a=new gn,o=this._currentData?this._propertyBox.getRoots():new gn;for(n=o.size(),t=0;n>t;t++)s=o.get(t),this.isVisible(s)&&(a.add(s),i=this.getCategoryName(s),r[i]||(this._categoryList.add(i),r[i]={isExpanded:this.isExpanded(i),properties:new gn}));for(this._sortFunction&&a.sort(this._sortFunction),this._categoryMap=r,n=a.size(),t=0;t<this._categoryList.size();t++){i=this._categoryList.get(t),"null"!==i&&this._rowList.add(i);var h=r[i];if(h.isExpanded)for(e=0;n>e;e++)s=a.get(e),this.getCategoryName(s)===i&&(h.properties.add(s),this._rowList.add({view:this,data:this._currentData,property:s,value:this._currentData?this.getValue(this._currentData,s):null}))}},adjustWidth:function(){var t=this._view.offsetWidth,e=this._view.offsetHeight;t<=this._indent||0>=e||(t-=this._indent,this._rowList.size()*this._rowHeight>e&&(t-=kn.SCROLL_BAR_WIDTH,0>=t)||(this._propertyNameWidth=0===this._sumWidth||this._propertyNameWidth>this._sumWidth?t/2:t*(this._propertyNameWidth/this._sumWidth),this._sumWidth=t,this._view.style.overflowX="hidden",this._view.style.overflowY="auto"))},validateDisplay:function(){var t=this._rowList.size(),e=this._borderColor,i=this._indent,n=this._rowHeight,s=this._propertyNameWidth,r=Math.max(0,this._sumWidth-s),a=this._rowLineWidth,o=this._columnLineWidth,h=n-a+"px",l=n-a-2+"px",c=i+"px",u=s-o+"px",d=r-o+"px",f=s+r+"px",g=a+"px",_=o+"px",p=s+"px",v=this._dataDiv,m=v.style;m.height=t*n+"px",m.width=i+s+r+"px";var y=this.__divPool.get();m=y.style,m.position="absolute",m.left="0px",m.top="0px",m.width=c,m.height=v.style.height,m.borderWidth="0px",m.backgroundColor=e,v.appendChild(y);for(var A=0;t>A;A++){var x=this._rowList.get(A),w=A*n+"px",b=this.__divPool.get();if(x.rowDiv=b,m=b.style,m.position="absolute",m.whiteSpace="nowrap",m.overflow="hidden",m.textOverflow="ellipsis",m.left=c,m.top=w,m.width=f,m.height=h,m.lineHeight=l,m.borderStyle="solid",m.borderWidth="0px",m.borderBottomWidth=g,m.borderBottomColor=e,v.appendChild(b),"string"==typeof x){m.backgroundColor=e,y=this.__divPool.get(),m=y.style,m.position="absolute",m.left="0px",m.top=w,m.width=c,m.height=h,m.lineHeight=l,m.borderWidth="0px",v.appendChild(y);var S=this.__imagePool.get(),C=this.isExpanded(x)?this._expandIcon:this._collapseIcon;S.setAttribute("src",Be.getImageSrc(C)),m=S.style,m.verticalAlign="middle",S._expandData=x,y.appendChild(S),this.renderCategory(b,x),this.onCategoryRendered(b,x)}else{var T=x.property,E=this.__cellPool.get();x.nameRender=E,m=E.style,this._currentRowIndex===A&&(m.backgroundColor=this.getSelectColor()),m.position="absolute",m.verticalAlign="middle",m.textAlign=this._propertyNameHorizontalAlign,m.overflow="hidden",m.textOverflow="ellipsis",m.whiteSpace="nowrap",m.left="0px",m.top="0px",m.width=u,m.height=h,m.borderStyle="solid",m.borderWidth="0px",m.borderRightWidth=_,m.borderRightColor=e,b.appendChild(E),this.renderName(x),this.onNameRendered(x),E=this.__cellPool.get(),x.valueRender=E,m=E.style,m.position="absolute",m.verticalAlign="middle",m.textAlign=T.getHorizontalAlign(),m.whiteSpace="nowrap",m.overflow="hidden",m.textOverflow="ellipsis",m.left=p,m.top="0px",m.width=d,m.height=h,m.borderStyle="solid",m.borderWidth="0px",m.borderRightWidth=_,m.borderRightColor=e,b.appendChild(E),this.renderValue(x),this.onValueRendered(x)}}m=this._resizeDiv.style,m.left=i+s-o-this._resizeTolerance+"px",m.width=o+2*this._resizeTolerance+"px",m.height=v.style.height,v.appendChild(this._resizeDiv)},renderCategory:function(t,e){var i=this.__textPool.get(),n=i.style;n.fontWeight="bold",n.whiteSpace="nowrap",n.overflow="hidden",n.textOverflow="ellipsis",n.verticalAlign="middle",n.padding="1px 2px 1px 2px",i.innerHTML=e,i.setAttribute("title",e),t.appendChild(i)},onCategoryRendered:function(t,e){},renderName:function(t){if(t.property.renderName)return void t.property.renderName(t);var e=this.__textPool.get(),i=e.style;i.fontWeight="",i.whiteSpace="nowrap",i.verticalAlign="middle",i.padding="1px 2px 1px 2px";var n=t.property.getName();n||(n=t.property.getPropertyName()),e.innerHTML=n,e.setAttribute("title",n),t.nameRender.appendChild(e)},onNameRendered:function(t){},renderValue:function(t){var e=t.property;if(e.renderValue)return void e.renderValue(t);var i=t.value,n=e.getEnumInfo(this._currentData);n&&!Array.isArray(n)&&(i=n.map[i]),t.view.isCellEditable(t.data,e)&&(t.enumInfo=n,t.valueRender._editInfo=t),t.valueRender.innerHTML="",Ti.render(e.getValueType(),i,t.valueRender,t.view,e.isInnerText())},onValueRendered:function(t){},renderEditor:function(t){},onEditorRendered:function(t){},updateCurrentData:function(){this._currentData=this.getSelectionModel().getLastData()},validateImpl:function(){var t=this._view.scrollLeft,e=this._view.scrollTop;je.release(this._dataDiv),this.updateCurrentData(),this.validateModel(),this.isAutoAdjustable()&&this.adjustWidth(),this.validateDisplay(),this._pools.forEach(function(t){t.clear()}),this._view.scrollLeft!==t&&(this._view.scrollLeft=t),this._view.scrollTop!==e&&(this._view.scrollTop=e)},getValue:function(t,e){return t?e.getValue(t,this):null},setValue:function(t,e,i){t&&e.setValue(t,i,this)},isCellEditable:function(t,e){return!!t&&(this.isEditable()&&e.isEditable())},getRowIndexAt:function(t){var e=this.getLogicalPoint(t);if(!e)return-1;var i=parseInt(e.y/this._rowHeight);return i>=0&&i<this._rowList.size()?i:-1},handleChange:function(t){this._isCommitting||this._isCanceling||this._isValidating||t.target._editInfo&&this.commitEditValue&&this.commitEditValue(t.target._editInfo,t.target)},commitEditValue:function(t,e){var i;i="checkbox"===e.type?e.checked:e.value;var n=t.property,s=n.getValueType();if("int"===s&&"string"==typeof i)i=parseInt(i);else if("number"===s&&"string"==typeof i)i=parseFloat(i);else if("array.string"===s)i=i.split(",");else if("array.number"===s){i=i.split(",");for(var r=0,a=i.length;a>r;r++)i[r]=parseFloat(i[r])}if(e._rowInfo&&(e._rowInfo.value=i,this.renderValue(e._rowInfo)),this.setValue(t.data,n,i),De.Util.setFocus(this._view),this._currentEditor){var o=this._currentEditor.parentNode;o&&o.removeChild(this._currentEditor),delete this._currentEditor}delete this._isCommitting},cancelEditing:function(){if(this._currentEditor){var t=this._currentEditor.parentNode;t&&t.removeChild(this._currentEditor),delete this._currentEditor,delete this._isCanceling}},updateCurrentRowIndex:function(t){var e=this._rowList.size();(0>t||t>=e)&&(t=-1);var i,n=this._currentRowIndex;if(t!==n&&(n>=0&&e>n&&(i=this._rowList.get(n),i.nameRender&&(i.nameRender.style.backgroundColor="")),this._currentRowIndex=t),t>=0&&(i=this._rowList.get(t),i.nameRender&&(i.nameRender.style.backgroundColor=this.getSelectColor(),!this._currentEditor&&i.valueRender&&i.valueRender._editInfo))){var s=i.valueRender._editInfo,r=this.renderEditor&&this.renderEditor(i);r?(this._currentEditor=r.view,null!=s.value&&(this._currentEditor.value=s.value)):s.enumInfo?this._currentEditor=je.createSelect(s.enumInfo,s.value):(this._currentEditor=Ve.createElement("input"),null!=s.value&&(this._currentEditor.value=s.value));var a=this;if(this._currentEditor){if(r&&r.onKeyDown){var o=r.onKeyDown;o&&Array.isArray(o)&&a._currentEditor.addEventListener("keydown",function(t){for(var e=0;e<o.length;e++)if(o[e].combKey){var i=null;switch(o[e].combKey){case"ctrlKey":i=t.ctrlKey;break;case"shiftKey":i=t.shiftKey;break;case"altKey":i=t.altKey}t.keyCode===o[e].keyCode&&i&&o[e].handlerEvent&&o[e].handlerEvent(t)}else t.keyCode===o[e].keyCode&&o[e].handlerEvent&&o[e].handlerEvent(t)})}else this._currentEditor.addEventListener("keydown",function(t){var e=t.target._editInfo.view;if(13!==t.keyCode||!t.shiftKey)if(13===t.keyCode){if(e._isCommitting)return;e._isCommitting=!0,e.commitEditValue(t.target._editInfo,t.target)}else 27===t.keyCode&&(e._isCanceling=!0,e.cancelEditing())},!1);if(this._currentEditor.addEventListener("blur",function(t){var e=t.target._editInfo.view;e._isCommitting||e._isCanceling||(e._isCommitting=!0,e.commitEditValue(t.target._editInfo,t.target))},!1),this._currentEditor.keepDefault=!0,this._currentEditor._rowInfo=i,this._currentEditor._editInfo=s,!this._currentEditor.parentNode){var h=this._currentEditor.style;h.position="absolute",h.margin="0px",h.border="0px",h.padding="0px",h.left=this._indent+this._propertyNameWidth+"px",h.top=i.rowDiv.style.top,h.width=i.valueRender.style.width,h.height=i.valueRender.style.height,this._rootDiv.appendChild(this._currentEditor)}De.Util.setFocus(this._currentEditor)}}}}),De.controls.PropertySheetInteraction=function(t){this.sheet=t,this.view=t._view,this.resizeDiv=t._resizeDiv;var e=this;this.view.addEventListener("mousedown",function(t){0===t.button&&e.handleMouseDown(t)},!1),this.view.addEventListener("mousemove",function(t){e.handleMouseMove(t)},!1)},Be.ext("twaver.controls.PropertySheetInteraction",Object,{minGap:10,handleMouseDown:function(t){if(t.target!==this.sheet._currentEditor&&t.target.parentNode!==this.sheet._currentEditor&&(this.sheet.isFocusOnClick()&&De.Util.setFocus(this.view),!this.sheet._isValidating))if(t.target._expandData){var e=t.target._expandData;this.sheet.isExpanded(e)?this.sheet.collapse(e):this.sheet.expand(e)}else if(t.target===this.resizeDiv)this.lastX=this.getX(t),je.handle_mousedown(this,t);else{this.sheet._currentEditor&&!this.sheet._isCommitting&&(this.sheet._isCommitting=!0,this.sheet.commitEditValue(this.sheet._currentEditor._editInfo,this.sheet._currentEditor));var i=this.sheet.getRowIndexAt(t);this.sheet.updateCurrentRowIndex(i)}},handleMouseMove:function(t){if(null==this.lastX&&!je.target)return void this.changeCursor(t);if(je.target===this&&null!=this.lastX){var e=this.getX(t);if(null!=this.stopLeft){if(e<this.stopLeft)return;delete this.stopLeft}if(null!=this.stopRight){if(e>this.stopRight)return;delete this.stopRight}var i=this.sheet.getPropertyNameWidth()+(e-this.lastX);
i<this.minGap?(i=this.minGap,this.stopLeft=e):i>this.sheet.getSumWidth()-this.minGap&&(i=this.sheet.getSumWidth()-this.minGap,this.stopRight=e),this.sheet.setPropertyNameWidth(i),this.lastX=e}},handleMouseUp:function(t){0===t.button&&(this.view.style.cursor="default",delete this.stopLeft,delete this.stopRight,delete this.lastX)},changeCursor:function(t){this.view.style.cursor=t.target===this.resizeDiv?"ew-resize":"default"},getX:function(t){return t.clientX/this.sheet.getZoom()}}),De.controls.PropertySheetTouchInteraction=function(t){this.sheet=t,this.view=t._view,this.resizeDiv=t._resizeDiv,je.addEventListener("touchstart","handleTouchstart",this.view,this)},Be.ext("twaver.controls.PropertySheetTouchInteraction",Object,{minGap:10,handleTouchstart:function(t){je.preventDefault(t),t.target!==this.sheet._currentEditor&&t.target.parentNode!==this.sheet._currentEditor&&(this.sheet.isFocusOnClick()&&De.Util.setFocus(this.view),this.sheet._isValidating||(t.target===this.resizeDiv&&(this.lastX=this.getX(t)),this.lastPoint=this.sheet.getLogicalPoint(t),Ci.isMultiTouch(t)&&(this.distance=Ci.getDistance(t),this.zoom=this.sheet.getZoom()),je.addEventListener("touchmove","handleTouchmove",this.view,this),je.addEventListener("touchend","handleTouchend",this.view,this)))},handleTouchmove:function(t){if(je.preventDefault(t),this.moved||(this.moved=!0),null!=this.lastX){var e=this.getX(t);if(null!=this.stopLeft){if(e<this.stopLeft)return;delete this.stopLeft}if(null!=this.stopRight){if(e>this.stopRight)return;delete this.stopRight}var i=this.sheet.getPropertyNameWidth()+(e-this.lastX);i<this.minGap?(i=this.minGap,this.stopLeft=e):i>this.sheet.getSumWidth()-this.minGap&&(i=this.sheet.getSumWidth()-this.minGap,this.stopRight=e),this.sheet.setPropertyNameWidth(i),this.lastX=e}else if(Ci.isSingleTouch(t)){if(this.lastPoint){var n=this.sheet.getLogicalPoint(t),s=this.lastPoint.x-n.x,r=this.lastPoint.y-n.y,a=this.sheet.panByOffset(s,r);this.lastPoint.x-=s-a.x,this.lastPoint.y-=r-a.y}}else if(this.distance){var o=Ci.getDistance(t)/this.distance;this.sheet.setZoom(this.zoom*o,!1)}},handleTouchend:function(t){if(je.preventDefault(t),!this.moved)if(t.target._expandData){var e=t.target._expandData;this.sheet.isExpanded(e)?this.sheet.collapse(e):this.sheet.expand(e)}else if(t.target===this.resizeDiv);else{var i=this.sheet.getRowIndexAt(t);this.sheet.updateCurrentRowIndex(i)}delete this.stopLeft,delete this.stopRight,delete this.lastX,delete this.lastPoint,delete this.distance,delete this.zoom,delete this.moved,je.removeEventListener("touchmove",this.view,this),je.removeEventListener("touchend",this.view,this)},getX:function(t){var e=t.changedTouches[0];return e.clientX}}),De.controls.PropertySheetMSTouchInteraction=function(t){this.sheet=t,this.view=t._view,this.resizeDiv=t._resizeDiv,this._pointerMap={},this._pointerIdArray=[],je.addEventListener("MSPointerDown","handleTouchstart",this.view,this),je.addEventListener("MSPointerMove","handleTouchmove",this.view,this),je.addEventListener("MSPointerUp","handleTouchend",this.view,this),je.addEventListener("MSPointerCancel","handleTouchend",this.view,this),this.superHandleMouseDown=De.controls.PropertySheetMSTouchInteraction.superClass.handleMouseDown},Be.ext("twaver.controls.PropertySheetMSTouchInteraction",De.controls.PropertySheetInteraction,{handleMouseDown:function(t){},handleTouchstart:function(t){t.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),this._pointerMap[t.pointerId]||null==this.sheet.getLogicalPoint(t)||(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t),1==this._pointerIdArray.length&&t.pointerType==t.MSPOINTER_TYPE_MOUSE&&this.superHandleMouseDown(t),1==this._pointerIdArray.length?(this._startTouchPoint=this.sheet.getLogicalPoint(t),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.sheet.getZoom())},handleTouchmove:function(t){if(0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(Ge.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=10))if(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length){var e=this._getDistance()/this._distance;this.sheet.setZoom(this._zoom*e,!1)}else if(1==this._pointerIdArray.length&&t.pointerType!=t.MSPOINTER_TYPE_MOUSE&&this._startTouchPoint){var i=this.sheet.getLogicalPoint(t);if(null==i)return;var n=this._startTouchPoint.x-i.x,s=this._startTouchPoint.y-i.y,r=this.sheet.panByOffset(n,s);this._startTouchPoint.x-=n-r.x,this._startTouchPoint.y-=s-r.y}},handleTouchend:function(t){if(1==this._pointerIdArray.length&&t.pointerType!=t.MSPOINTER_TYPE_MOUSE){var e=this.sheet.getLogicalPoint(t),i=new Date;i.getTime()-this._startTouchTime.getTime()<=500&&Ge.getDistance(this._startTouchPoint,e)<=20&&this.superHandleMouseDown(t)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Ge.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),De.controls.SplitPane=function(t,e,i,n){De.controls.SplitPane.superClass.constructor.apply(this,arguments),this._view=je.createView("hidden",!0),this._view.tabIndex=-1,this._dividerDiv=je.createDiv(),this._dividerDiv.tabIndex=-1,this._view.appendChild(this._dividerDiv),t&&this.setFirstView(t),e&&this.setNextView(e),i&&this.setOrientation(i),null!=n&&this.setPosition(n),this.setDividerDraggable(!0),this.setExpandable(!1),this.invalidate(),He.isTouchable&&new De.controls.SplitPaneTouchInteraction(this),new De.controls.SplitPaneInteraction(this)},Be.ext("twaver.controls.SplitPane",De.controls.ControlBase,{__accessor:["orientation","dividerWidth","dividerBackground","dividerOpacity","maskBackground","upExpandIcon","downExpandIcon","leftExpandIcon","rightExpandIcon"],__bool:["dividerDraggable","expandable"],_position:kn.SPLITPANE_POSITION,_orientation:kn.SPLITPANE_ORIENTATION,_dividerWidth:kn.SPLITPANE_DIVIDER_WIDTH,_dividerBackground:kn.SPLITPANE_DIVIDER_BACKGROUND,_dividerOpacity:kn.SPLITPANE_DIVIDER_OPACITY,_maskBackground:kn.SPLITPANE_MASK_BACKGROUND,_upExpandIcon:kn.SPLITPANE_UP_EXPAND_ICON,_downExpandIcon:kn.SPLITPANE_DOWN_EXPAND_ICON,_leftExpandIcon:kn.SPLITPANE_LEFT_EXPAND_ICON,_rightExpandIcon:kn.SPLITPANE_RIGHT_EXPAND_ICON,onPropertyChanged:function(t){this.invalidate()},getDividerDiv:function(){return this._dividerDiv},getPosition:function(){return this._position},setPosition:function(t){if(0>t&&(t=0),t>1&&(t=1),t!==this._position){var e=this._position;this._position=t,this.firePropertyChange("position",e,t),null==this.lastDividerLocation&&(this.lastDividerLocation=t)}},setFirstView:function(t){if(this._firstView!==t){var e=this._firstView;e&&this._view.removeChild(e.getView?e.getView():e),this._firstView=t,t&&(t.getView?this._view.insertBefore(t.getView(),this._dividerDiv):this._view.insertBefore(t,this._dividerDiv)),this.firePropertyChange("firstView",e,t)}},getFirstView:function(){return this._firstView},setNextView:function(t){if(this._nextView!==t){var e=this._nextView;e&&this._view.removeChild(e.getView?e.getView():e),this._nextView=t,t&&(t.getView?this._view.insertBefore(t.getView(),this._dividerDiv):this._view.insertBefore(t,this._dividerDiv)),this.firePropertyChange("nextView",e,t)}},getNextView:function(){return this._nextView},validateImpl:function(){var t,e=this._position,i=this._view.offsetWidth,n=this._view.offsetHeight,s=this._dividerWidth;if(s>=8||0===s?this._coverDiv&&(this._dividerDiv.removeChild(this._coverDiv),delete this._coverDiv):this._coverDiv||(this._coverDiv=je.createDiv(),this._coverDiv.tabIndex=-1,this._dividerDiv.appendChild(this._coverDiv)),"horizontal"===this._orientation){s>i&&(s=i);var r=(i-s)*e,a=i-s-r+1;Be.setViewBounds(this._firstView,{x:0,y:0,width:r,height:n}),Be.setViewBounds(this._nextView,{x:r+s,y:0,width:a,height:n}),Be.setViewBounds(this._dividerDiv,{x:r,y:0,width:s,height:n}),this._dividerDiv.position=r,this._coverDiv&&Be.setViewBounds(this._coverDiv,{x:s/2-4,y:0,width:8,height:n}),this._expandable&&(this._expandCvs1||(t=Be.html.createDiv(),t.tabIndex=-1,Be.setViewBounds(t,{x:0,y:0,width:s,height:11}),this._expandCvs1=Be.html.createImg(Be.getImageSrc(this._leftExpandIcon)),this._expandCvs1.style.left=s/2-3+"px",t.appendChild(this._expandCvs1),this._dividerDiv.appendChild(t)),this._expandCvs2||(t=Be.html.createDiv(),t.tabIndex=-1,Be.setViewBounds(t,{x:0,y:15,width:s,height:11}),this._expandCvs2=Be.html.createImg(Be.getImageSrc(this._rightExpandIcon)),this._expandCvs2.style.left=s/2-3+"px",t.appendChild(this._expandCvs2),this._dividerDiv.appendChild(t)))}else{s>n&&(s=n);var o=(n-s)*e,h=n-s-o;Be.setViewBounds(this._firstView,{x:0,y:0,width:i,height:o}),Be.setViewBounds(this._nextView,{x:0,y:o+s,width:i,height:h}),Be.setViewBounds(this._dividerDiv,{x:0,y:o,width:i,height:s}),this._dividerDiv.position=o,this._coverDiv&&Be.setViewBounds(this._coverDiv,{x:0,y:s/2-4,width:i,height:8}),this._expandable&&(this._expandCvs1||(t=Be.html.createDiv(),t.tabIndex=-1,Be.setViewBounds(t,{x:0,y:0,width:11,height:s}),this._expandCvs1=Be.html.createImg(Be.getImageSrc(this._upExpandIcon)),this._expandCvs1.style.top=s/2-3+"px",t.appendChild(this._expandCvs1),this._dividerDiv.appendChild(t)),this._expandCvs2||(t=Be.html.createDiv(),t.tabIndex=-1,Be.setViewBounds(t,{x:15,y:0,width:11,height:s}),this._expandCvs2=Be.html.createImg(Be.getImageSrc(this._downExpandIcon)),this._expandCvs2.style.top=s/2-3+"px",t.appendChild(this._expandCvs2),this._dividerDiv.appendChild(t)))}var l=this._dividerDiv.style;l.background=this._dividerBackground}}),De.controls.SplitPaneInteraction=function(t){this.splitPane=t,this.view=t._view,this.dividerDiv=t._dividerDiv;var e=this;this.view.addEventListener("mousedown",function(t){0===t.button&&e.handleMouseDown(t)},!1),this.view.addEventListener("mousemove",function(t){e.handleMouseMove(t)},!1)},Be.ext("twaver.controls.SplitPaneInteraction",Object,{handleMouseDown:function(t){if(this.splitPane.isExpandable()){var e,i,n=this.splitPane._dividerWidth;if(t.target===this.splitPane._expandCvs1)return void("horizontal"===this.splitPane._orientation?(e=this.view.clientWidth,n>e&&(n=e),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(0):this.splitPane.lastDividerLocation<this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())):(i=this.view.clientHeight,n>i&&(n=i),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(0):this.splitPane.lastDividerLocation<this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())));if(t.target===this.splitPane._expandCvs2)return void("horizontal"===this.splitPane._orientation?(e=this.view.clientWidth,n>e&&(n=e),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(1):this.splitPane.lastDividerLocation>this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())):(i=this.view.clientHeight,n>i&&(n=i),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(1):this.splitPane.lastDividerLocation>this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())))}if(this.splitPane.isDividerDraggable())if(this.resizeDiv)this.clear(t);else if(t.target===this.dividerDiv||t.target===this.splitPane._coverDiv){this.resizeDiv=je.createDiv();var s=this.resizeDiv.style;s.left=this.dividerDiv.style.left,s.top=this.dividerDiv.style.top,s.width=this.dividerDiv.style.width,s.height=this.dividerDiv.style.height,s.opacity=this.splitPane.getDividerOpacity(),s.background=this.splitPane.getDividerBackground(),this.resizeDiv.lastPosition="horizontal"===this.splitPane._orientation?t.clientX:t.clientY,this.resizeDiv.maskDiv=je.createDiv(),s=this.resizeDiv.maskDiv.style,s.left="0px",s.top="0px",s.width=this.view.clientWidth+"px",s.height=this.view.clientHeight+"px",s.background=this.splitPane.getMaskBackground(),this.view.appendChild(this.resizeDiv.maskDiv),this.view.appendChild(this.resizeDiv),je.handle_mousedown(this,t),t.preventDefault()}},handleMouseMove:function(t){if((!this.splitPane.isExpandable()||t.target!==this.splitPane._expandCvs1&&t.target!==this.splitPane._expandCvs2)&&this.splitPane.isDividerDraggable())if(this.resizeDiv||je.target)this.resizeDiv&&je.target===this&&("horizontal"===this.splitPane._orientation?this.resizeDiv.style.left=this.dividerDiv.position+t.clientX-this.resizeDiv.lastPosition+"px":this.resizeDiv.style.top=this.dividerDiv.position+t.clientY-this.resizeDiv.lastPosition+"px");else{var e="horizontal"===this.splitPane._orientation?"ew-resize":"ns-resize";this.view.style.cursor=t.target===this.dividerDiv||t.target===this.splitPane._coverDiv?e:"default"}},handleMouseUp:function(t){(!this.splitPane.isExpandable()||t.target!==this.splitPane._expandCvs1&&t.target!==this.splitPane._expandCvs2)&&this.splitPane.isDividerDraggable()&&0===t.button&&this.clear(t)},clear:function(t){if(this.resizeDiv){var e,i=this.splitPane._dividerWidth;if("horizontal"===this.splitPane._orientation){var n=this.view.clientWidth;i>n&&(i=n),e=this.dividerDiv.position+t.clientX-this.resizeDiv.lastPosition,this.splitPane.setPosition(e/(n-i))}else{var s=this.view.clientHeight;i>s&&(i=s),e=this.dividerDiv.position+t.clientY-this.resizeDiv.lastPosition,this.splitPane.setPosition(e/(s-i))}this.splitPane.lastDividerLocation=this.splitPane.getPosition(),this.view.removeChild(this.resizeDiv.maskDiv),this.view.removeChild(this.resizeDiv),delete this.resizeDiv}}}),De.controls.SplitPaneTouchInteraction=function(t){this.splitPane=t,this.view=t._view,this.dividerDiv=t._dividerDiv,je.addEventListener("touchstart","handleTouchstart",this.view,this)},Be.ext("twaver.controls.SplitPaneTouchInteraction",Object,{handleTouchstart:function(t){if(je.preventDefault(t),this.splitPane.isExpandable()){var e,i,n=this.splitPane._dividerWidth;if(t.target===this.splitPane._expandCvs1)return void("horizontal"===this.splitPane._orientation?(e=this.view.clientWidth,n>e&&(n=e),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(0):this.splitPane.lastDividerLocation<this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())):(i=this.view.clientHeight,n>i&&(n=i),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(0):this.splitPane.lastDividerLocation<this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())));if(t.target===this.splitPane._expandCvs2)return void("horizontal"===this.splitPane._orientation?(e=this.view.clientWidth,n>e&&(n=e),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(1):this.splitPane.lastDividerLocation>this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())):(i=this.view.clientHeight,n>i&&(n=i),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(1):this.splitPane.lastDividerLocation>this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())))}if(this.resizeDiv)this.clear(t);else if(t.target===this.dividerDiv||t.target===this.splitPane._coverDiv){this.resizeDiv=je.createDiv();var s=this.resizeDiv.style;s.left=this.dividerDiv.style.left,s.top=this.dividerDiv.style.top,s.width=this.dividerDiv.style.width,s.height=this.dividerDiv.style.height,s.opacity=this.splitPane.getDividerOpacity(),s.background=this.splitPane.getDividerBackground();var r=t.changedTouches[0];this.resizeDiv.lastPosition="horizontal"===this.splitPane._orientation?r.clientX:r.clientY,this.resizeDiv.maskDiv=je.createDiv();var s=this.resizeDiv.maskDiv.style;s.left="0px",s.top="0px",s.width=this.view.clientWidth+"px",s.height=this.view.clientHeight+"px",s.background=this.splitPane.getMaskBackground(),this.view.appendChild(this.resizeDiv.maskDiv),this.view.appendChild(this.resizeDiv)}je.addEventListener("touchmove","handleTouchmove",this.view,this),je.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(t){if(je.preventDefault(t),(!this.splitPane.isExpandable()||t.target!==this.splitPane._expandCvs1&&t.target!==this.splitPane._expandCvs2)&&this.resizeDiv){var e=t.changedTouches[0];"horizontal"===this.splitPane._orientation?this.resizeDiv.style.left=this.dividerDiv.position+e.clientX-this.resizeDiv.lastPosition+"px":this.resizeDiv.style.top=this.dividerDiv.position+e.clientY-this.resizeDiv.lastPosition+"px"}},handleTouchend:function(t){(!this.splitPane.isExpandable()||t.target!==this.splitPane._expandCvs1&&t.target!==this.splitPane._expandCvs2)&&(je.removeEventListener("touchmove",this.view,this),je.removeEventListener("touchend",this.view,this),this.clear(t))},clear:function(t){var e=t.changedTouches[0];if(this.resizeDiv){var i=this.splitPane._dividerWidth;if("horizontal"===this.splitPane._orientation){var n=this.view.clientWidth;i>n&&(i=n);var s=this.dividerDiv.position+e.clientX-this.resizeDiv.lastPosition;this.splitPane.setPosition(s/(n-i))}else{var r=this.view.clientHeight;i>r&&(i=r);var s=this.dividerDiv.position+e.clientY-this.resizeDiv.lastPosition;this.splitPane.setPosition(s/(r-i))}this.splitPane.lastDividerLocation=this.splitPane.getPosition(),this.view.removeChild(this.resizeDiv.maskDiv),this.view.removeChild(this.resizeDiv),delete this.resizeDiv}}}),De.controls.TabPane=function(){De.controls.TabPane.superClass.constructor.apply(this,arguments),this._tabBox=new De.TabBox,this._tabBox.addDataBoxChangeListener(this.handleTabChange,this),this._tabBox.addDataPropertyChangeListener(this.handleTabChange,this),this._tabBox.addHierarchyChangeListener(this.handleTabChange,this),this._tabBox.getSelectionModel().addSelectionChangeListener(this.handleTabChange,this),this._view=je.createView("hidden",!0),this._tabDiv=je.createDiv(),this._tabDiv.onmousedown=je.preventDefault,this._tabDiv.onkeydown=je.preventDefault,this._contentDiv=je.createDiv(),this._view.appendChild(this._tabDiv),this._view.appendChild(this._contentDiv),this._divPool=new De.Pool("div"),this._iconPool=new De.Pool("img"),this._closePool=new De.Pool("img"),this._textPool=new De.Pool("span"),this._resizePool=new De.Pool("div"),this._pools.add(this._divPool),this._pools.add(this._iconPool),this._pools.add(this._closePool),this._pools.add(this._textPool),this._pools.add(this._resizePool),this.invalidateTab(),He.isTouchable&&new De.controls.TabPaneTouchInteraction(this),new De.controls.TabPaneInteraction(this)},Be.ext("twaver.controls.TabPane",De.controls.ControlBase,{__accessor:["tabGap","tabRadius","tabHeight","horizontalAlign","tabOrientation","resizeTolerance","tabBackground","selectBackground","moveBackground","insertBackground","closeIcon","disabledColor"],__bool:["selectNextOnClose","selectNextOnInVisible"],_tabGap:kn.TABPANE_TAB_GAP,_tabRadius:kn.TABPANE_TAB_RADIUS,_tabHeight:kn.TABPANE_TAB_HEIGHT,_resizeTolerance:kn.TABPANE_RESIZE_TOLERANCE,_tabOrientation:kn.TABPANE_TAB_ORIENTATION,_tabBackground:kn.TABPANE_TAB_BACKGROUND,_disabledColor:kn.TABPANE_DISABLED_COLOR,_selectBackground:kn.TABPANE_SELECT_BACKGROUND,_moveBackground:kn.TABPANE_MOVE_BACKGROUND,_insertBackground:kn.TABPANE_INSERT_BACKGROUND,_horizontalAlign:kn.TABPANE_HORIZONTAL_ALIGN,_closeIcon:kn.TABPANE_CLOSE_ICON,_selectNextOnClose:kn.TABPANE_SELECT_NEXT_ON_CLOSE,_selectNextOnInVisible:kn.TABPANE_SELECT_NEXT_ON_INVISIBLE,onPropertyChanged:function(t){this.invalidateTab()},getTabBox:function(){return this._tabBox},getTabDiv:function(){return this._tabDiv},getContentDiv:function(){return this._contentDiv},handleTabChange:function(t){if(this._selectNextOnInVisible&&"visible"===t.property&&!t.newValue&&this._tabBox.getSelectionModel().contains(t.source)){for(var e,i,n=t.source,s=this._tabBox.getRoots().indexOf(n),r=this._tabBox.getRoots(),a=r.size(),o=s;a-1>o;)if(e=r.get(++o),e.isVisible()&&!e.isDisabled()){i=e;break}if(!i)for(o=s;o>0;)if(e=r.get(--o),e.isVisible()&&!e.isDisabled()){i=e;break}this._tabBox.getSelectionModel().setSelection(i)}this.invalidateTab()},invalidateTab:function(t){this._invalidateTab||(this._invalidateTab=!0,this.invalidate(t))},validateImpl:function(){this._invalidateTab&&(this._invalidateTab=!1,this.validateTab());var t,e=this._view.offsetWidth,i=this._view.offsetHeight;"top"===this._tabOrientation?(this._tabDiv.style.top="0px",t={x:0,y:this._tabHeight,width:e,height:Math.max(0,i-this._tabHeight)}):(this._tabDiv.style.top=i-this._tabHeight+"px",t={x:0,y:0,width:e,height:Math.max(0,i-this._tabHeight)}),this._currentView&&Be.setViewBounds(this._currentView,t)},getCurrentTab:function(){return this._currentTab},getCurrentView:function(){return this._currentView},onViewRemoved:function(t){},onViewAdded:function(t){},validateTab:function(){this._currentTab=this._tabBox.getSelectionModel().getLastData();var t=this._currentTab?this._currentTab.getView():null;if(t!==this._currentView){var e,i;this._currentView&&(e=this._currentView.getView?this._currentView.getView():this._currentView,e.style.visibility="hidden",this.onViewRemoved(this._currentView)),t&&(i=t.getView?t.getView():t,i.style.visibility="inherit",i.parentNode||this._contentDiv.appendChild(i),this.onViewAdded(t)),this._currentView=t}je.release(this._tabDiv);for(var n=this._tabBox.getRoots(),s=this._tabHeight+"px",r=this._tabHeight-2+"px",a=this._tabRadius+"px",o=n.size(),h=0,l=0;o>l;l++){var c=n.get(l);if(c.isVisible()){var u=this._currentTab===c,d=c.getWidth();0>d&&(d=0);var f=Math.min(this._tabGap,d),g=this._divPool.get();g._tab=c;var _=g.style;_.position="absolute",_.whiteSpace="nowrap",_.lineHeight=r,_.overflow="hidden",_.textOverflow="ellipsis",_.background=u?this._selectBackground:this._tabBackground,_.textAlign=this._horizontalAlign,"top"===this._tabOrientation?(_.borderTopLeftRadius=a,_.borderTopRightRadius=a,_.borderBottomLeftRadius="0px",_.borderBottomRightRadius="0px"):(_.borderTopLeftRadius="0px",_.borderTopRightRadius="0px",_.borderBottomLeftRadius=a,_.borderBottomRightRadius=a),_.left=h+"px",_.width=d-f+"px",_.height=s,g._x=h,g._width=d-f,this.renderTab(g,c),this.onTabRendered(g,c),this._tabDiv.insertBefore(g,this._tabDiv.firstChild),h+=d,c.isResizable()&&(g=this._resizePool.get(),g._resizeTab=c,_=g.style,_.position="absolute",_.backgroundColor="white",_.opacity=0,_.left=h-f-this._resizeTolerance+"px",_.width=f+2*this._resizeTolerance+"px",_.height=s,this._tabDiv.appendChild(g))}}this._tabDiv.style.left="0px",this._tabDiv.style.width=h+"px",this._tabDiv.style.height=this._tabHeight+"px",this._pools.forEach(function(t){t.clear()})},renderTab:function(t,e){if(e.renderTab)e.renderTab(t);else{var i=e.getIcon();if(i){var n=this._iconPool.get();n.setAttribute("src",Be.getImageSrc(i)),n.style.paddingLeft="4px",n.style.verticalAlign="middle",t.appendChild(n)}var s=e.getName();if(s){var r=this._textPool.get();r.style.whiteSpace="nowrap",r.style.verticalAlign="middle",r.style.padding="2px 4px",r.innerHTML=s,t.appendChild(r)}if(He.isOpera){var a=t.cloneNode(!1);a.style.left="0px",a.style.top="0px",a.style.opacity=0,t.appendChild(a)}}if(e.isClosable()){var o=this._tabRadius/4+2,n=this._closePool.get();n._closeTab=e,n.setAttribute("src",Be.getImageSrc(this._closeIcon)),n.style.position="absolute",n.style.top=o+"px",n.style.right=o+"px",t.appendChild(n)}t.style.color=e.isDisabled()?this.getDisabledColor():""},onTabRendered:function(t,e){}}),De.controls.TabPaneInteraction=function(t){this.tabPane=t,this.view=t.getTabDiv();var e=this;this.view.addEventListener("mousedown",function(t){e.handleMouseDown(t)},!1),this.view.addEventListener("mousemove",function(t){e.handleMouseMove(t)},!1)},Be.ext("twaver.controls.TabPaneInteraction",Object,{handleMouseDown:function(t){if(0===t.button){if(this.movableDiv)return void this.handleMouseUp(t);this.resizeTab=t.target._resizeTab,this.resizeTab||(this.movableDiv=this.getMovableDivAt(t)),this.changeCursor(t),this.lastX=this.getX(t),this._startClient=je.getClientPoint(t),this._startLogicalX=this.lastX,je.handle_mousedown(this,t)}},changeCursor:function(t){var e="";if(t.target._resizeTab)e="ew-resize";else{var i=this.getTabAt(t);!i||i.isDisabled()&&!i.isMovable()||(e="pointer")}this.view.style.cursor=e},handleMouseMove:function(t){if(null==this.lastX)return void this.changeCursor(t);if(je.target===this){var e=this._startLogicalX+t.clientX-this._startClient.x;if(this.resizeTab){if(null!=this.stopX){if(e<this.stopX)return;delete this.stopX}var i=this.resizeTab.getWidth()+(e-this.lastX);10>i&&(i=10,this.stopX=e),this.resizeTab.setWidth(i),this.lastX=e}else if(this.movableDiv){var n=e-this.lastX;if(!this.cloneDiv){if(Math.abs(n)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.tabPane.getMoveBackground(),this.insertDiv=je.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.tabPane.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var s=this.cloneDiv._x+n;this.cloneDiv.style.left=s+"px",this.cloneDiv._x=s,this.lastX=e,this.tabInfo=this.getTabInfoAt(t),this.tabInfo&&(this.insertDiv.style.left=this.tabInfo.position)}}},handleMouseUp:function(t){if(0===t.button){if(this.resizeTab);else if(this.movableDiv&&this.tabInfo){var e=this.movableDiv._tab,i=this.tabInfo.index;this.tabPane.getTabBox().moveTo(e,i)}else{var n=this.tabPane.getTabBox(),e=t.target._closeTab;if(e)if(this.tabPane.isSelectNextOnClose()&&this.tabPane.getCurrentTab()===e){var s=n.getRoots(),i=s.indexOf(e);n.remove(e),s.size()>0&&(i>=s.size()&&(i=s.size()-1),n.getSelectionModel().setSelection(s.get(i)))}else n.remove(e);else{var e=this.getTabAt(t);e&&!e.isDisabled()&&n.getSelectionModel().setSelection(e)}}this.clear()}},clear:function(){this.view.style.cursor="",this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.tabInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeTab,delete this.stopX,delete this.lastX,delete this._startLogicalX,delete this._startClient},getTabAt:function(t){t=t.target;for(var e;t&&t!==this.view&&!(e=t._tab);)t=t.parentNode;return e},getMovableDivAt:function(t){t=t.target;for(var e;t&&t!==this.view&&!(e=t._tab);)t=t.parentNode;return e&&e.isMovable()?t:null},getX:function(t){var e=je.getLogicalPoint(this.view,t);return e?e.x:null},getTabInfoAt:function(t){for(var e=this._startLogicalX+t.clientX-this._startClient.x,i=this.tabPane.getTabBox().getRoots(),n=i.size(),s=0,r=!1,a=0;n>a;a++){var o=i.get(a);if(o===this.movableDiv._tab&&(r=!0),o.isVisible()){var h=o.getWidth();if(0>=h)continue;if(e>=s&&s+h>=e){var l=s+h/2>e;!r||o===this.movableDiv._tab&&l||a--;var c=l?Math.max(0,a):Math.min(a+1,n),u=l?s:s+h;return u=Math.max(0,u-1),{index:c,tab:o,position:u+"px"}}s+=h}}return this.tabInfo}}),De.controls.TabPaneTouchInteraction=function(t){this.tabPane=t,this.view=t.getTabDiv(),je.addEventListener("touchstart","handleTouchstart",this.view,this)},Be.ext("twaver.controls.TabPaneTouchInteraction",Object,{handleTouchstart:function(t){return je.preventDefault(t),this.movableDiv?void this.handleTouchend(t):(this.resizeTab=t.target._resizeTab,this.resizeTab||(this.movableDiv=this.getMovableDivAt(t)),this.lastX=this.getX(t),je.addEventListener("touchmove","handleTouchmove",this.view,this),void je.addEventListener("touchend","handleTouchend",this.view,this))},handleTouchmove:function(t){if(null!=this.lastX)if(this.resizeTab){var e=this.getX(t);if(null!=this.stopX){if(e<this.stopX)return;delete this.stopX}var i=this.resizeTab.getWidth()+(e-this.lastX);0>i&&(i=0,this.stopX=e),this.resizeTab.setWidth(i),this.lastX=e}else if(this.movableDiv){var e=this.getX(t),n=e-this.lastX;if(!this.cloneDiv){if(Math.abs(n)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.tabPane.getMoveBackground(),this.insertDiv=je.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.tabPane.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var s=this.cloneDiv._x+n;this.cloneDiv.style.left=s+"px",this.cloneDiv._x=s,this.lastX=e,this.tabInfo=this.getTabInfoAt(t),this.tabInfo&&(this.insertDiv.style.left=this.tabInfo.position)}},handleTouchend:function(t){if(this.resizeTab);else if(this.movableDiv&&this.tabInfo){var e=this.movableDiv._tab,i=this.tabInfo.index;this.tabPane.getTabBox().moveTo(e,i)}else{var n=this.tabPane.getTabBox(),e=t.target._closeTab;if(e)if(this.tabPane.isSelectNextOnClose()&&this.tabPane.getCurrentTab()===e){var s=n.getRoots(),i=s.indexOf(e);n.remove(e),s.size()>0&&(i>=s.size()&&(i=s.size()-1),n.getSelectionModel().setSelection(s.get(i)))}else n.remove(e);else{var e=this.getTabAt(t);e&&!e.isDisabled()&&n.getSelectionModel().setSelection(e)}}this.clear(),je.removeEventListener("touchmove",this.view,this),je.removeEventListener("touchend",this.view,this)},clear:function(){this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.tabInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeTab,delete this.stopX,delete this.lastX},getTabAt:function(t){t=t.target;for(var e;t&&t!==this.view&&!(e=t._tab);)t=t.parentNode;return e},getMovableDivAt:function(t){t=t.target;for(var e;t&&t!==this.view&&!(e=t._tab);)t=t.parentNode;return e&&e.isMovable()?t:null},getX:function(t){var e=je.getLogicalPoint(this.view,t);return e?e.x:null},getTabInfoAt:function(t){for(var e=this.getX(t),i=this.tabPane.getTabBox().getRoots(),n=i.size(),s=0,r=!1,a=0;n>a;a++){var o=i.get(a);if(o===this.movableDiv._tab&&(r=!0),o.isVisible()){var h=o.getWidth();if(0>=h)continue;if(e>=s&&s+h>=e){var l=s+h/2>e;!r||o===this.movableDiv._tab&&l||a--;var c=l?Math.max(0,a):Math.min(a+1,n),u=l?s:s+h;return u=Math.max(0,u-1),{index:c,tab:o,position:u+"px"}}s+=h}}return this.tabInfo}}),De.controls.TitlePane=function(t,e,i){De.controls.TitlePane.superClass.constructor.apply(this,arguments),this.invalidate(),this._titleDiv=je.createDiv(),this._titleDiv.tabIndex=-1,this._titleDiv.style.verticalAlign="middle",this._titleDiv.style.fontWeight="bold",this._titleDiv.style.textOverflow="ellipsis",this._titleDiv.style.overflow="hidden",this._titleDiv.style.whiteSpace="nowrap",this._titleDiv.onmousedown=je.preventDefault,this._span=Ve.createElement("span"),this._span.style.verticalAlign="middle",this._span.style.paddingLeft="4px",this._span.style.paddingRight="4px",this._img=Ve.createElement("img"),this._img.style.verticalAlign="middle",this._img.style.paddingLeft="4px",this._view=je.createView("hidden",!0),this._view.tabIndex=-1,this._view.appendChild(this._titleDiv),e&&this.setTitle(e),t&&this.setContent(t),i&&this.setIcon(i)},Be.ext("twaver.controls.TitlePane",De.controls.ControlBase,{__accessor:["icon","title","titleHeight","titleHorizontalAlign","titleBackground"],_titleHeight:kn.TITLEPANE_TITLE_HEIGHT,
_titleBackground:kn.TITLEPANE_TITLE_BACKGROUND,_titleHorizontalAlign:kn.TITLEPANE_TITLE_HORIZONTAL_ALIGN,onPropertyChanged:function(t){this.invalidate()},getTitleDiv:function(){return this._titleDiv},getContent:function(){return this._content},setContent:function(t){if(this._content!==t){var e=this._content;e&&this._view.removeChild(e.getView?e.getView():e),this._content=t,t&&this._view.appendChild(t.getView?t.getView():t),this.firePropertyChange("content",e,t)}},validateImpl:function(){var t=this._view.offsetWidth,e=this._view.offsetHeight,i=this._titleDiv.style;i.textAlign=this._titleHorizontalAlign,i.lineHeight=this._titleHeight-2+"px",i.background=this._titleBackground,je.clear(this._titleDiv),this._icon&&(this._img.setAttribute("src",Be.getImageSrc(this._icon)),this._titleDiv.appendChild(this._img)),this._title&&(this._span.innerHTML=this._title,this._span.setAttribute("title",this._title),this._titleDiv.appendChild(this._span));var i=this._titleDiv.style;i.left="0px",i.top="0px",i.width=t+"px",i.height=this._titleHeight+"px",Be.setViewBounds(this._content,{x:0,y:this._titleHeight,width:t,height:Math.max(e-this._titleHeight,0)})}}),De.controls.Accordion=function(){De.controls.Accordion.superClass.constructor.apply(this,arguments),this._titleMap={},this._titleList=new gn,this._currentTitle=null,this._currentView=null,this._view=je.createView("hidden",!0),this.invalidate();var t=this;this._view.addEventListener("mousedown",function(e){t.handleMouseDown(e)},!1)},Be.ext("twaver.controls.Accordion",De.controls.ControlBase,{__accessor:["expandIcon","collapseIcon","titleHeight","titleBackground","borderBottomColor","iconPosition"],_expandIcon:kn.ACCORDION_EXPAND_ICON,_collapseIcon:kn.ACCORDION_COLLAPSE_ICON,_titleHeight:kn.ACCORDION_TITLE_HEIGHT,_titleBackground:kn.ACCORDION_TITLE_BACKGROUND,_borderBottomColor:kn.ACCORDION_BORDER_BOTTOM_COLOR,_iconPosition:kn.ACCORDION_ICON_POSITION,onPropertyChanged:function(t){this.invalidate()},handleMouseDown:function(t){if(0===t.button){var e=t.target._title;e||(e=t.target.parentNode._title),e&&(this._currentTitle===e?this.collapse():this.expand(e))}},getTitles:function(){return this._titleList},getCurrentTitle:function(){return this._currentTitle},add:function(t,e){if(this._titleMap[t])throw"Title ' + title + ' already exists";var i=je.createDiv();i._title=t,i.onmousedown=je.preventDefault,i.style.cursor="pointer",i.style.textAlign="left",i.style.textOverflow="ellipsis",i.style.whiteSpace="nowrap",i.style.overflow="hidden",i.style.borderBottomWidth="1px",i.style.borderBottomStyle="solid";var n=Ve.createElement("img");n.style.verticalAlign="middle",n.style.paddingLeft="4px";var s=Ve.createElement("span");if(s.style.verticalAlign="middle",s.style.paddingLeft="4px",s.innerHTML=t,s.setAttribute("title",t),this._view.appendChild(i),i.appendChild(n),i.appendChild(s),"right"==this._iconPosition){var r=n.style,a=(this._titleHeight-8)/2;r.marginTop=a+"px",r.right="15px",r.position="absolute"}this._titleMap[t]={content:e,titleDiv:i,span:s,img:n},this._titleList.add(t),this.invalidate()},remove:function(t){var e=this._titleMap[t];e&&this._view.removeChild(e.titleDiv),delete this._titleMap[t],this._titleList.remove(t),this.invalidate()},clear:function(){var t=this;Object.keys(t._titleMap).forEach(function(e){t._view.removeChild(t._titleMap[e].titleDiv)}),t._titleMap={},t._titleList.clear(),t.invalidate()},expand:function(t){this._titleMap[t]&&this._currentTitle!==t&&(this._currentTitle=t,this.onExpanded(t),this.invalidate())},onExpanded:function(t){},collapse:function(){this._currentTitle&&(this.onCollapsed(this._currentTitle),this._currentTitle=null,this.invalidate())},onCollapsed:function(t){},validateImpl:function(){var t=this._currentView;this._currentView=null;for(var e=this._view.offsetWidth,i=this._view.offsetHeight,n=this._titleList.size(),s=0,r=0;n>r;r++){var a=this._titleList.get(r),o=this._titleMap[a],h=o.titleDiv.style;h.lineHeight=this._titleHeight-3+"px",h.background=this._titleBackground,h.borderBottomColor=this._borderBottomColor,h.left="0px",h.top=s+"px",h.width=e+"px",h.height=this._titleHeight-1+"px";var l=this._currentTitle===a,c=l?this._expandIcon:this._collapseIcon;if(o.img.setAttribute("src",Be.getImageSrc(c)),l){var u=Math.max(0,i-n*this._titleHeight);o.content&&(this._currentView=o.content.getView?o.content.getView():o.content,Be.setViewBounds(o.content,{x:0,y:s+this._titleHeight,width:e,height:u}),o.content.style.overflowY="auto"),s+=this._titleHeight+u}else s+=this._titleHeight}this._currentView&&this._currentView!==t&&this._view.appendChild(this._currentView),t&&t!==this._currentView&&this._view.removeChild(t)}}),De.controls.BorderPane=function(t,e,i,n,s){De.controls.BorderPane.superClass.constructor.apply(this,arguments),this.invalidate(),this._view=je.createView("hidden",!0),this._view.tabIndex=-1,t&&this.setCenter(t),e&&this.setTop(e),i&&this.setRight(i),n&&this.setBottom(n),s&&this.setLeft(s)},Be.ext("twaver.controls.BorderPane",De.controls.ControlBase,{__accessor:["hGap","vGap","topHeight","bottomHeight","leftWidth","rightWidth"],_hGap:kn.BORDERPANE_HGAP,_vGap:kn.BORDERPANE_VGAP,_topHeight:0,_bottomHeight:0,_leftWidth:0,_rightWidth:0,onPropertyChanged:function(t){this.invalidate()},getCenter:function(){return this._center},setCenter:function(t){this._setContent("center",t)},getTop:function(){return this._top},setTop:function(t){this._setContent("top",t)},getRight:function(){return this._right},setRight:function(t){this._setContent("right",t)},getBottom:function(){return this._bottom},setBottom:function(t){this._setContent("bottom",t)},getLeft:function(){return this._left},setLeft:function(t){this._setContent("left",t)},_setContent:function(t,e){var i=this["_"+t];if(i!==e){if(i){var n=i.getView?i.getView():i;this._view.contains(n)&&this._view.removeChild(n)}this["_"+t]=e,e&&this._view.appendChild(e.getView?e.getView():e),this.firePropertyChange(t,i,e)}},validateImpl:function(){var t=this._view.offsetWidth,e=this._view.offsetHeight,i=0,n=0,s=t,r=e,a=0,o=0,h=0,l=0;this._top&&(a=this._topHeight||(this._top.getView?this._top.getView().offsetHeight:this._top.offsetHeight),n=a+this._vGap),this._bottom&&(o=this._bottomHeight||(this._bottom.getView?this._bottom.getView().offsetHeight:this._bottom.offsetHeight),r=e-o-this._vGap),this._left&&(h=this._leftWidth||(this._left.getView?this._left.getView().offsetWidth:this._left.offsetWidth),i=h+this._hGap),this._right&&(l=this._rightWidth||(this._right.getView?this._right.getView().offsetWidth:this._right.offsetWidth),s=t-l-this._hGap);var c=Math.max(0,s-i),u=Math.max(0,r-n);this._top&&Be.setViewBounds(this._top,{x:0,y:0,width:t,height:a}),this._bottom&&Be.setViewBounds(this._bottom,{x:0,y:r,width:t,height:o}),this._left&&Be.setViewBounds(this._left,{x:0,y:n,width:h,height:u}),this._right&&Be.setViewBounds(this._right,{x:s,y:n,width:l,height:u}),this._center&&Be.setViewBounds(this._center,{x:i,y:n,width:c,height:u})}}),De.controls.PopupMenu=function(t){this._view=je.createDiv(),this._view.style.zIndex=100001,this._items=[],this._itemsMap={},this.setContextView(t);var e=this._view,i=this;e.addEventListener("mouseover",function(t){i._mouseOver=!0},!1),e.addEventListener("mouseout",function(t){i._mouseOver=!1},!1),e.oncontextmenu=function(t){t.preventDefault()},je.addEventListener("mousedown","_handleClick",e,this)},Be.ext("twaver.controls.PopupMenu",Object,{_width:200,_xOffset:0,_yOffset:0,_menuItemHeight:25,_background:"#F9F9F9",_border:"2px outset white",_disabledColor:"#BABBBC",_focusColor:"white",_focusBackground:"#C2CFF1",_color:"black",_subMenuEnableIcon:kn.POPUPMENU_SUBNENU_ENABLE_ICON,_subMenuDisableIcon:kn.POPUPMENU_SUBNENU_DISABLE_ICON,_checkboxSelectedIcon:kn.POPUPMENU_CHECKBOX_SELECTED_ICON,_checkboxUnselectedIcon:kn.POPUPMENU_CHECKBOX_UNSELECTED_ICON,_radiobuttonSelectedIcon:kn.POPUPMENU_RADIOBUTTON_SELECTED_ICON,_radiobuttonUnselectedIcon:kn.POPUPMENU_RADIOBUTTON_UNSELECTED_ICON,getView:function(){return this._view},getContextView:function(){return this._contextView},setContextView:function(t){if(this._removeContextmenuListener(),this._contextView=t,t){var e=t.getView?t.getView():t;He.isTouchable?(e.addEventListener("touchstart",this._getTouchStartListener(),!1),e.addEventListener("touchmove",this._getTouchMoveListener(),!1),e.addEventListener("touchend",this._getTouchEndListener(),!1)):je.addEventListener("contextmenu","_handleContextmenu",e,this)}},getMenuItems:function(){return this._items},setMenuItems:function(t){if(this._items=[],this._itemsMap={},t)for(var e=0,i=t.length;i>e;e++)this.addMenuItem(t[e])},addMenuItem:function(t){t.separator!==!0&&(this._itemsMap[t.id||t.label]=t),this._items.push(t)},getMenuItem:function(t){return this._itemsMap[t]},addSeparator:function(){this.addMenuItem({separator:!0})},getMenuItemById:function(t){return this._itemsMap[t]},isVisible:function(t){return t.visible!==!1},isEnabled:function(t){return t.enabled!==!1},show:function(t){this.hide();var e,i,n=this._view,s=this._view.style;if(He.isTouchable?(e=t.changedTouches[0].clientX,i=t.changedTouches[0].clientY):(e=t.clientX,i=t.clientY),je.clear(n),this.renderMenu(n,this._items),0!==this._height){je.addEventListener(He.isTouchable?"touchstart":"mousedown","_handleBodyClicked",Ve.body,this);var r=je.windowWidth()-this._width-10,a=je.windowHeight()-this._height-10;e=e>r?r:e,i=i>a?a:i,e=0>e?0:e,i=0>i?0:i,s.left=e+Ci.scrollLeft()+this._xOffset+"px",s.top=i+Ci.scrollTop()+this._yOffset+"px",Ve.body.appendChild(n)}},_showMenuItem:function(t,e){this._hideMenuItem(e);var i=Ve.createElement("div");e.menuItem.childrenDiv=i;var n=i.style;n.color="#000000",n.position="absolute";var s=this._width,r=e.offsetTop,a=e.menuItem.items;if(this._itemsShow=!0,e.appendChild(i),je.clear(i),this.renderMenu(i,a),0!==this._height){var o=je.windowWidth()-this._width-10,h=je.windowHeight()-10,l=this._getPosition(this._view);s=l.left+this._width>o?-this._width:s,r=l.top+r+a.length*this._menuItemHeight>h?r-(a.length-1)*this._menuItemHeight:r,n.left=s+"px",n.top=r+"px",e.appendChild(i)}},hide:function(){Ve.body.contains(this._view)&&Ve.body.removeChild(this._view),delete this._mouseOver,delete this._itemsShow,je.removeEventListener(He.isTouchable?"touchstart":"mousedown",Ve.body,this)},_hideMenuItem:function(t){var e=t.menuItem.childrenDiv;e&&t.contains(e)&&t.removeChild(e),this._itemsShow=!1},dispose:function(){this._removeContextmenuListener(),this.hide()},onMenuShowing:function(t){return!0},onAction:function(t){},renderMenu:function(t,e){var i=t.style;i.background=this._background,i.border=this._border,i.width=this._width+"px",this._height=0,delete this._separator;for(var n,s=0,r=e.length;r>s;s++)if(n=e[s],this.isVisible(n))if(n.separator===!0)this._separator=!0;else{var a=Ve.createElement("div");this.isEnabled(n)&&this._addMouseoverListener(a,n),a.menuItem=n,t.appendChild(a),this.renderMenuItem(a,n),this.onMenuItemRendered(a,n),this._separator=!1,this._height+=this._menuItemHeight}},renderMenuItem:function(t,e){var i=t.style;i.height=this._menuItemHeight+"px",this._separator&&(i.borderTop="1px solid gray"),this.isEnabled(e)||(i.color=this._disabledColor);var n=Ve.createElement("span");i=n.style,i.position="absolute",i.width="25px",i.height=this._menuItemHeight+"px",i.lineHeight=this._menuItemHeight+"px",i.textAlign="center",t.appendChild(n);var s;if("check"===e.type?s=e.selected?this._checkboxSelectedIcon:this._checkboxUnselectedIcon:"radio"===e.type?s=e.selected?this._radiobuttonSelectedIcon:this._radiobuttonUnselectedIcon:e.icon&&(s=e.icon),s){var r=new Ue;r.src=Be.getImageSrc(s),r.style.verticalAlign="middle",n.appendChild(r)}var a=Ve.createElement("label");if(Be.setText(a,e.label,!0),i=a.style,i.position="absolute",i.height=this._menuItemHeight+"px",i.lineHeight=this._menuItemHeight+"px",i.left="25px",t.appendChild(a),e.items&&t.parentNode===this._view){var o=Ve.createElement("img");i=o.style,this.isEnabled(e)?o.setAttribute("src",Be.getImageSrc(this._subMenuEnableIcon)):o.setAttribute("src",Be.getImageSrc(this._subMenuDisableIcon));var h=(this._menuItemHeight-8)/2;i.marginTop=h+"px",i.right="5px",i.position="absolute",t.appendChild(o)}},onMenuItemRendered:function(t,e){},_addMouseoverListener:function(t,e){var i=this;t.addEventListener(He.isTouchable?"touchstart":"mouseover",function(n){t.style.background=i._focusBackground,t.style.color=i._focusColor,this===n.relatedTarget||this.contains(n.relatedTarget)||e.items&&!i._itemsShow&&t.parentNode==i._view&&i._showMenuItem(n,t)},!1),t.addEventListener(He.isTouchable?"touchend":"mouseout",function(n){if(t.style.background=i._background,t.style.color=i._color,this!==n.relatedTarget&&!this.contains(n.relatedTarget)&&e.items&&t.parentNode===i._view){var s=n.clientX,r=n.clientY,a=e.childrenDiv,o=i._getPosition(a);(s<o.left+2||s>o.left+a.offsetWidth-2||r<o.top+2||r>o.top+a.offsetHeight-2)&&i._hideMenuItem(t)}},!1)},_getPosition:function(t){for(var e=0,i=0;t;)i+=t.offsetLeft,e+=t.offsetTop,t=t.offsetParent;return{left:i,top:e}},_removeContextmenuListener:function(){var t=this._contextView;t&&(t=t.getView?t.getView():t,He.isTouchable?(t.removeEventListener("touchstart",this._getTouchStartListener(),!1),t.removeEventListener("touchmove",this._getTouchMoveListener(),!1),t.removeEventListener("touchend",this._getTouchEndListener(),!1)):je.removeEventListener("contextmenu",t,this))},_handleContextmenu:function(t){this.onMenuShowing(t)===!0&&this.show(t),t.preventDefault()},_handleBodyClicked:function(t){if(He.isTouchable){for(var e=t.target;e&&e!==this._view;)e=e.parentElement;e!==this._view&&this.hide()}else this._mouseOver||this.hide()},_handleClick:function(t){if(0===t.button){for(var e=t.target;!e.menuItem&&e.parentElement;)e=e.parentElement;var i=e?e.menuItem:null;i&&this.isEnabled(i)&&("check"===i.type&&(i.selected=!i.selected),"radio"===i.type&&(i.groupName?(i.selected=!0,this._items.forEach(function(t){i!==t&&t.groupName===i.groupName&&(t.selected=!1),t.items&&t.items.forEach(function(t){i!==t&&t.groupName===i.groupName&&(t.selected=!1)})})):i.selected=!i.selected),i.action&&i.action(i),this.onAction(i),i.items&&i.items.length>0||this.hide())}},_getTouchStartListener:function(){if(!this._touchStartListener){var t=this;this._touchStartListener=function(e){t._touchMoved=!1,t._lastTouch=new Date}}return this._touchStartListener},_getTouchMoveListener:function(){if(!this._touchMoveListener){var t=this;this._touchMoveListener=function(e){t._touchMoved=!0}}return this._touchMoveListener},_getTouchEndListener:function(){if(!this._touchEndListener){var t=this;this._touchEndListener=function(e){!t._touchMoved&&(new Date).getTime()-t._lastTouch.getTime()>1e3&&t._handleContextmenu(e)}}return this._touchEndListener},getWidth:function(){return this._width},setWidth:function(t){this._width=t},getMenuItemHeight:function(){return this._menuItemHeight},setMenuItemHeight:function(t){this._menuItemHeight=t},getBackground:function(){return this._background},setBackground:function(t){this._background=t},getBorder:function(){return this._border},setBorder:function(t){this._border=t},getDisabledColor:function(){return this._disabledColor},setDisabledColor:function(t){this._disabledColor=t},getFocusColor:function(){return this._focusColor},setFocusColor:function(t){this._focusColor=t},getFocusBackground:function(){return this._focusBackground},setFocusBackground:function(t){this._focusBackground=t},getColor:function(){return this._color},setColor:function(t){this._color=t},getSubMenuEnableIcon:function(){return this._subMenuEnableIcon},setSubMenuEnableIcon:function(t){this._subMenuEnableIcon=t},getSubMenuDisableIcon:function(){return this._subMenuDisableIcon},setSubMenuDisableIcon:function(t){this._subMenuDisableIcon=t},getCheckboxSelectedIcon:function(){return this._checkboxSelectedIcon},setCheckboxSelectedIcon:function(t){this._checkboxSelectedIcon=t},getCheckboxUnselectedIcon:function(){return this._checkboxUnselectedIcon},setCheckboxUnselectedIcon:function(t){this._checkboxUnselectedIcon=t},getRadiobuttonSelectedIcon:function(){return this._radiobuttonSelectedIcon},setRadiobuttonSelectedIcon:function(t){this._radiobuttonSelectedIcon=t},getRadiobuttonUnselectedIcon:function(){return this._radiobuttonUnselectedIcon},setRadiobuttonUnselectedIcon:function(t){this._radiobuttonUnselectedIcon=t},getXOffset:function(){return this._xOffset},setXOffset:function(t){this._xOffset=t},getYOffset:function(){return this._yOffset},setYOffset:function(t){this._yOffset=t}}),De.charts.IS_INVALIDATE_PROPERTY={xZoom:1,xTranslate:1,yZoom:1,yTranslate:1},De.charts.ChartBase=function(t){De.charts.ChartBase.superClass.constructor.apply(this,arguments),this._uniqueColors={},this._nonDataColors={},this._publishedDatas=new gn,this._view=je.createView("hidden"),this._canvas=je.createCanvas(),this._view.appendChild(this._canvas),this.setDataBox(t?t:new De.ElementBox),this.invalidate(),He.isTouchable?He.isMSTouchable?new De.charts.ChartMSTouchInteraction(this):(new De.charts.ChartTouchInteraction(this),new De.charts.ChartInteraction(this)):new De.charts.ChartInteraction(this),this.setToolTipEnabled(kn.CHART_TOOLTIP_ENABLED)},Be.ext("twaver.charts.ChartBase",De.controls.ViewBase,{__accessor:["xGap","yGap","xTranslate","yTranslate","valueVisible","sortFunction","visibleFunction","xTranslateEnabled","yTranslateEnabled","xZoomEnabled","yZoomEnabled","selectTolerance","backgroundVisible","backgroundFill","backgroundFillColor","backgroundOutlineWidth","backgroundOutlineColor","backgroundGradient","backgroundGradientColor","outerZoom"],__bool:["doubleClickToReset","focusOnClick"],_backgroundVisible:kn.CHART_BACKGROUND_VISIBLE,_backgroundFill:kn.CHART_BACKGROUND_FILL,_backgroundFillColor:kn.CHART_BACKGROUND_FILL_COLOR,_backgroundOutlineWidth:kn.CHART_BACKGROUND_OUTLINE_WIDTH,_backgroundOutlineColor:kn.CHART_BACKGROUND_OUTLINE_COLOR,_backgroundGradient:kn.CHART_BACKGROUND_GRADIENT,_backgroundGradientColor:kn.CHART_BACKGROUND_GRADIENT_COLOR,_selectTolerance:kn.CHART_SELECT_TOLERANCE,_doubleClickToReset:kn.CHART_DOUBLE_CLICK_TO_RESET,_focusOnClick:kn.FOCUS_ON_CLICK,_sortFunction:null,_visibleFunction:null,_canvasWidth:0,_canvasHeight:0,_outerZoomL:1,_xGap:kn.CHART_XGAP,_yGap:kn.CHART_YGAP,_xTranslate:0,_yTranslate:0,_xTranslateEnabled:kn.CHART_XTRANSLATE_ENABLED,_yTranslateEnabled:kn.CHART_YTRANSLATE_ENABLED,_xZoom:1,_yZoom:1,_maxZoom:kn.ZOOM_MAX,_minZoom:kn.ZOOM_MIN,_xZoomEnabled:kn.CHART_XZOOM_ENABLED,_yZoomEnabled:kn.CHART_YZOOM_ENABLED,_valueVisible:kn.CHART_VALUE_VISIBLE,_valueFont:kn.CHART_VALUE_FONT,isToolTipEnabled:function(){return!!this._toolTipListener},setToolTipEnabled:function(t){if(t){if(!this._toolTipListener){var e=this;this._toolTipListener=function(t){Ei.showToolTip(t,e.getToolTip(t))},this._canvas.addEventListener("mousemove",this._toolTipListener,!0),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Ei.hideToolTip(),this._canvas.removeEventListener("mousemove",this._toolTipListener,!0),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},getToolTip:function(t){if(this._toolTipInfos){var e=this.getLogicalPoint(t);e.x-=this._xTranslate,e.y-=this._yTranslate;for(var i=this._toolTipInfos.size(),n=i-1;n>=0;n--){var s=this._toolTipInfos.get(n);if(s.rect&&Ge.containsPoint(s.rect,e))return this.getToolTipByData(s.data,s)}}else{var r=this.tryGetDataAt(t);if(r)return this.getToolTipByData(r,{value:this.getValue(r)})}return null},getToolTipByData:function(t,i){return i.value!==e?this.formatValueText(i.value,t):null},addToolTipInfo:function(t,e,i,n,s,r,a){this._toolTipInfos&&this._toolTipInfos.add({data:r,rect:{x:t,y:e,width:i,height:n},value:s,index:a})},getLogicalPoint:function(t){return je.getLogicalPoint(this._canvas,t,this._outerZoom)},getTextSize:function(t,e){var i=qe.getTextSize(t,e);return i.width&&(i.width+=4),i},getUniqueColor:function(t,i){if(null==t)return null;var n;if(!i&&(n=this._nonDataColors[t]))return n;var s=qe.getColorArray(t);if(!i)return n=255!=s[3]?t:"rgba("+s[0]+","+s[1]+","+s[2]+",0.99)",this._nonDataColors[t]=n,n;var r="rgb("+s[0]+","+s[1]+","+s[2]+")";if(this._uniqueColors[r]===e||this._uniqueColors[r]===i);else{var a=1,o=-1,h=1;for(He.isOpera&&(s=[s[0],s[1],s[2]]);(s[0]+=a,s[0]>=255?(s[0]=255,a=-1):s[0]<=0&&(s[0]=0,a=1),r="rgb("+s[0]+","+s[1]+","+s[2]+")",this._uniqueColors[r]!==e&&this._uniqueColors[r]!==i)&&(s[1]+=o,s[1]>=255?(s[1]=255,o=-1):s[1]<=0&&(s[1]=0,o=1),r="rgb("+s[0]+","+s[1]+","+s[2]+")",this._uniqueColors[r]!==e&&this._uniqueColors[r]!==i)&&(s[2]+=h,s[2]>=255?(s[2]=255,h=-1):s[2]<=0&&(s[2]=0,h=1),r="rgb("+s[0]+","+s[1]+","+s[2]+")",this._uniqueColors[r]!==e&&this._uniqueColors[r]!==i););}return this._uniqueColors[r]=i,r},tryGetDataAt:function(t,e){if((null==e||0>e)&&(e=this._selectTolerance),t.target&&(t=je.getLogicalPoint(this._canvas,arguments[0],this._outerZoom)),!t)return null;var i=t.x-e,n=t.y-e,s=2*e+1,r=2*e+1;try{for(var a=this._canvas.getContext("2d").getImageData(i,n,s,r).data,o=0,h=a.length;h>o;o+=4)if(255===a[o+3]){var l="rgb("+a[o]+","+a[o+1]+","+a[o+2]+")",c=this._uniqueColors[l];if(c)return c}}catch(u){}return null},_getPoint:function(){var t,e;if(2===arguments.length)t=arguments[0],e=arguments[1];else if(arguments[0].target){var i=je.getLogicalPoint(this._canvas,arguments[0],this._outerZoom);if(!i)return null;t=i.x,e=i.y}else t=arguments[0].x,e=arguments[0].y;return{x:t,y:e}},getDataAt:function(){var t=this._getPoint.apply(this,arguments),e=t.x,i=t.y;if(0>e||0>i||e>this._canvasWidth||i>this._canvasHeight)return null;try{var n=this._canvas.getContext("2d").getImageData(e,i,1,1).data;if(255===n[3]){var s="rgb("+n[0]+","+n[1]+","+n[2]+")",r=this._uniqueColors[s];if(r)return r}}catch(a){}return null},getBackgroundRect:function(){return this._backgroundRect},drawBackground:function(t,e){this._backgroundRect=Be.clone(e),null!=e&&e.width>0&&e.height>0&&this._backgroundVisible&&(this._backgroundFill&&qe.fill(t,this.getUniqueColor(this._backgroundFillColor),this._backgroundGradient,this.getUniqueColor(this._backgroundGradientColor),e),this._backgroundOutlineWidth>0&&(t.lineWidth=this._backgroundOutlineWidth,t.strokeStyle=this._backgroundOutlineColor),t.beginPath(),t.rect(e.x,e.y,e.width,e.height),t.closePath(),this._backgroundFill&&t.fill(),this._backgroundOutlineWidth>0&&t.stroke())},getName:function(t){return t.getName()},getColor:function(t){return t.getStyle?t.getStyle("chart.color"):t.getClient("chart.color")},getValue:function(t){return t.getStyle?t.getStyle("chart.value"):0},getValueColor:function(t){return t.getStyle?t.getStyle("chart.value.color"):De.Styles.getStyle("chart.value.color")},setValueFont:function(t){if(t!==this._valueFont){var e=t;this._valueFont=t,this.firePropertyChange("valueFont",e,t)}},getValueFont:function(t){if(t){var e=t.getStyle?t.getStyle("chart.value.font"):De.Styles.getStyle("chart.value.font");if(e)return e}return this._valueFont},formatValueText:function(t,e){return t},getCanvasWidth:function(){return this._canvasWidth},getCanvasHeight:function(){return this.canvasHeight},getCanvas:function(){return this._canvas},isVisible:function(t){return!(this._internalVisibleFunction&&!this._internalVisibleFunction(t))&&(!this._visibleFunction||this._visibleFunction(t))},onPropertyChanged:function(t){De.charts.IS_INVALIDATE_PROPERTY[t.property]?this.invalidate():this.invalidateModel()},getDataBox:function(){return this._box},setDataBox:function(t){if(!t)throw"DataBox can not be null";if(this._box!==t){var e=this._box;e&&(e.removeDataBoxChangeListener(this.handleDataBoxChange,this),e.removeDataPropertyChangeListener(this.handlePropertyChange,this),e.removeHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel||e.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=t,this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._box.addHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(t):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidateModel(),this.firePropertyChange("dataBox",e,this._box)}},handleDataBoxChange:function(t){this.invalidateModel()},handlePropertyChange:function(t){this.invalidateModel()},handleHierarchyChange:function(t){this.invalidateModel()},handleSelectionChange:function(t){this.invalidateModel()},getUnfilteredDatas:function(){return this._unfilteredDatas?this._unfilteredDatas:this._publishedDatas},getPublishedDatas:function(){return this._publishedDatas},createPublishedDatas:function(){return this._unfilteredDatas=new gn,this._buildChildren(this._box.getRoots(),this._unfilteredDatas),this._sortFunction&&this._unfilteredDatas.sort(this._sortFunction),this._unfilteredDatas.toList(this.isVisible,this)},_buildChildren:function(t,e){t.forEach(function(t){e.add(t),this._buildChildren(t.getChildren(),e)},this)},invalidateModel:function(){this._invalidateModel||(this._invalidateModel=!0,this.invalidate())},validateImpl:function(){this._invalidateModel&&(this._invalidateModel=!1,this._uniqueColors={},this._nonDataColors={},this._publishedDatas=this.createPublishedDatas(),this._publishedDatas.forEach(function(t){t.IStyle?t.getStyle("chart.color")||t.setStyle("chart.color",Be.nextColor()):t.getClient("chart.color")||t.setClient("chart.color",Be.nextColor())}),this.validateModel());var t=this._canvas.getContext("2d");this._canvasWidth=this._view.clientWidth,this._canvasHeight=this._view.clientHeight,this._canvas.setAttribute("width",this._canvasWidth),this._canvas.setAttribute("height",this._canvasHeight),t.clearRect(0,0,this._canvasWidth,this._canvasHeight),this._canvasWidth>0&&this._canvasHeight>0&&(t.translate(this._xTranslate,this._yTranslate),this._valueTexts=this._valueVisible?new gn:null,this.validateDisplay(t,this._canvasWidth*this._xZoom,this._canvasHeight*this._yZoom),delete this._valueTexts,t.translate(-this._xTranslate,-this._yTranslate))},adjustBounds:function(t){De.charts.ChartBase.superClass.adjustBounds.apply(this,arguments),"undefined"==typeof De.gis&&De.Util.makeHighRes(this._canvas)},validateModel:function(){},validateDisplay:function(t,e,i){},drawLine:function(t,e,i,n,s,r,a){i>0&&(t.lineWidth=i,t.strokeStyle=this.getUniqueColor(e),t.beginPath(),t.moveTo(n,s),t.lineTo(r,a),t.stroke())},drawValueTexts:function(t){this._valueTexts&&this._valueTexts.forEach(function(e){qe.drawText(t,e.text,e,e.font,e.color)})},drawVerticalText:function(t,e,i,n,s){s=this.getUniqueColor(s),t.translate(i.x,i.y),t.rotate(-Math.PI/2),qe.drawText(t,e,null,n,s),t.rotate(Math.PI/2),t.translate(-i.x,-i.y)},_getValueTextInfo:function(t,e){if(this._valueTexts){var i=this.formatValueText(e,t);if(i&&""!==i){var n=this.getValueColor(t),s={text:i,font:this.getValueFont(t),color:this.getUniqueColor(n,t)};return this._valueTexts.add(s),s}}return null},getMaxZoom:function(){return this._maxZoom},setMaxZoom:function(t){if(!(0>t)){var e=this._maxZoom;this._maxZoom=t,this.firePropertyChange("maxZoom",e,t),this.getXZoom()>t&&this.setXZoom(t,!1),this.getYZoom()>t&&this.setYZoom(t,!1)}},getMinZoom:function(){return this._minZoom},setMinZoom:function(t){if(!(0>t)){var e=this._minZoom;this._minZoom=t,this.firePropertyChange("minZoom",e,t),this.getXZoom()<t&&this.setXZoom(t),this.getYZoom()<t&&this.setYZoom(t)}},zoomIn:function(t){null==t&&(t=kn.ZOOM_ANIMATE),t?De.animate.AnimateManager.start(new De.animate.AnimateXYZoom(this,this._xZoom*kn.ZOOM_INCREMENT,this._yZoom*kn.ZOOM_INCREMENT)):(this.xZoomIn(!1),this.yZoomIn(!1))},zoomOut:function(t){null==t&&(t=kn.ZOOM_ANIMATE),t?De.animate.AnimateManager.start(new De.animate.AnimateXYZoom(this,this._xZoom/kn.ZOOM_INCREMENT,this._yZoom/kn.ZOOM_INCREMENT)):(this.xZoomOut(!1),this.yZoomOut(!1))},zoomReset:function(t){null==t&&(t=kn.ZOOM_ANIMATE),t?De.animate.AnimateManager.start(new De.animate.AnimateXYZoom(this,1,1)):(this.xZoomReset(!1),this.yZoomReset(!1))},getXZoom:function(){return this._xZoom},onXZoomChanged:function(t,e){},xZoomIn:function(t){this.setXZoom(this._xZoom*kn.ZOOM_INCREMENT,t)},xZoomOut:function(t){this.setXZoom(this._xZoom/kn.ZOOM_INCREMENT,t)},xZoomReset:function(t){this.setXZoom(1,t)},setXZoom:function(t,e){if(Be.num(t)&&!(0>=t)&&(t<this._minZoom&&(t=this._minZoom),t>this._maxZoom&&(t=this._maxZoom),t!==this.xZoom))if(null==e&&(e=kn.ZOOM_ANIMATE),e)De.animate.AnimateManager.start(new De.animate.AnimateXZoom(this,t));else{var i=this._xZoom,n=this._xTranslate-(this._canvasWidth/2-this._xTranslate)/i*(t-i);this._xZoom=t,this.firePropertyChange("xZoom",i,t),this.onXZoomChanged(i,t),this.setXTranslate(n)}},getYZoom:function(){return this._yZoom},onYZoomChanged:function(t,e){},yZoomIn:function(t){this.setYZoom(this._yZoom*kn.ZOOM_INCREMENT,t)},yZoomOut:function(t){this.setYZoom(this._yZoom/kn.ZOOM_INCREMENT,t)},yZoomReset:function(t){this.setYZoom(1,t)},setYZoom:function(t,e){if(Be.num(t)&&!(0>=t)&&(t<this._minZoom&&(t=this._minZoom),t>this._maxZoom&&(t=this._maxZoom),t!==this.YZoom))if(null==e&&(e=kn.ZOOM_ANIMATE),e)De.animate.AnimateManager.start(new De.animate.AnimateYZoom(this,t));else{var i=this._yZoom,n=this._yTranslate-(this._canvasHeight/2-this._yTranslate)/i*(t-i);this._yZoom=t,this.firePropertyChange("yZoom",i,t),this.onYZoomChanged(i,t),this.setYTranslate(n)}}}),De.charts.ScaleChart=function(t){De.charts.ScaleChart.superClass.constructor.apply(this,arguments)},Be.ext("twaver.charts.ScaleChart",De.charts.ChartBase,{__accessor:["upperLimit","lowerLimit","xAxisText","xAxisLineColor","xAxisLineWidth","xAxisTextColor","xAxisTextFont","yAxisText","yAxisLineColor","yAxisLineWidth","yAxisTextColor","yAxisTextFont","xScaleTexts","xScaleTextFont","xScaleTextColor","xScaleTextOrientation","yScaleTextVisible","yScaleTextColor","yScaleTextFont","yScaleLineColor","yScaleLineWidth","yScaleValueGap","yScalePixelGap","yScaleMinTextVisible","valueSpanCount"],_reset:function(){this._map={},this._max=0,this._min=0,this._columnCount=this._xScaleTexts?this._xScaleTexts.size():0,null!=this._upperLimit&&(this._max=this._upperLimit),null!=this._lowerLimit&&(this._min=this._lowerLimit)},getMin:function(){return this._min},getMax:function(){return this._max},getRange:function(){return this._range},getColumnCount:function(){return this._columnCount},getColumnWidth:function(){return this._columnWidth},getValues:function(t){return t.getStyle?t.getStyle("chart.values"):null},formatYScaleText:function(t){return t.toFixed(2)},_initRange:function(){null==this._lowerLimit&&(this._min>=this._max&&(this._min=this._max-.1*Math.abs(this._max)),this._min=this._min-.1*(this._max-this._min)),this._range=this._max-this._min},_initValuesProportion:function(){this._publishedDatas.forEach(function(t){var e=this._map[t.getId()];e.values.forEach(function(t){e.proportions.add(null==t?null:0==this._range?0:t/this._range)},this)},this)},_commonValidateModel:function(){this._publishedDatas.forEach(function(t){var e=new gn(this.getValues(t));e.size()>this._columnCount&&(this._columnCount=e.size());var i={data:t,values:e,proportions:new gn,color:this.getUniqueColor(this.getColor(t),t)};this._initInfo&&this._initInfo(t,i),this._map[t.getId()]=i,(null==this._upperLimit||null==this._lowerLimit)&&e.forEach(function(t){null!=t&&(null==this._upperLimit&&t>this._max&&(this._max=t),null==this._lowerLimit&&t<this._min&&(this._min=t))},this)},this),this._initRange(),this._initValuesProportion()},validateDisplay:function(t,e,i){var n=0;this._xAxisText&&(n=this.getTextSize(this._xAxisTextFont,this._xAxisText).height);var s=0;this._xScaleTexts&&this._xScaleTexts.forEach(function(t){var e=this.getTextSize(this._xScaleTextFont,t),i="vertical"===this._xScaleTextOrientation?e.width:e.height;i>s&&(s=i)},this);var r=i-this._yGap-n-s,a=r-this._yGap,o=null==this._upperLimit?.9*a:a,h=0;this._yAxisText&&(h=this.getTextSize(this._yAxisTextFont,this._yAxisText).height);var l,c;this._yScaleValueGap>0?(l=Math.max(this._yScaleValueGap/this._range*o,1),c=this._yScaleValueGap):(l=Math.max(this._yScalePixelGap,1),
c=this._range*(l/o));var u,d,f=0,g=new gn;if(this._yScaleTextVisible){u=this._yScaleMinTextVisible?0:l;for(var _=this._min+(this._yScaleMinTextVisible?0:c);a+1>=u;){if(d=this.formatYScaleText(_)){var p=this.getTextSize(this._yScaleTextFont,d);p.width>f&&(f=p.width),g.add({text:d,size:p,cursor:u})}u+=l,_+=c}}var v={x:this._xGap+h+f,y:this._yGap,width:e-this._xGap-h-f-this._xGap,height:i-this._yGap-s-n-this._yGap};if(this.drawBackground(t,v),this._columnWidth=this._columnCount>0?v.width/(3*this._columnCount+1)*2:v.width/2,0===this._columnWidth&&(this._columnWidth=1),this._yScaleLineWidth>0)for(u=0;a+1>=u;)this.drawLine(t,this._yScaleLineColor,this._yScaleLineWidth,v.x,r-u,v.x+v.width,r-u),u+=l;this._xAxisText&&qe.drawText(t,this._xAxisText,{x:v.x+v.width/2,y:r+s+n/2},this._xAxisTextFont,this.getUniqueColor(this._xAxisTextColor)),this._yAxisText&&this.drawVerticalText(t,this._yAxisText,{x:this._xGap+h/2,y:a/2+this._yGap},this._yAxisTextFont,this.getUniqueColor(this._yAxisTextColor)),this.drawLine(t,this._yAxisLineColor,this._yAxisLineWidth,v.x,v.y+v.height,v.x,v.y);var m=this.getUniqueColor(this._yScaleTextColor);g.forEach(function(e){var i={x:this._xGap+h+f-e.size.width/2,y:r-e.cursor};qe.drawText(t,e.text,i,this._yScaleTextFont,m)},this);var y=v.y+v.height+s/2;m=this.getUniqueColor(this._xScaleTextColor);for(var A=this._xScaleLineWidth>0?this.getUniqueColor(this._xScaleLineColor):null,x=0;x<this._columnCount;x++){var w=v.x+this._columnWidth*(1+1.5*x);if(this._xScaleTexts&&x<this._xScaleTexts.size()&&(d=this._xScaleTexts.get(x))){var b={x:w,y:y};"vertical"===this._xScaleTextOrientation?this.drawVerticalText(t,d,b,this._yScaleTextFont,m):this._valueSpanCount?x%this._valueSpanCount==0&&qe.drawText(t,d,b,this._xScaleTextFont,m):qe.drawText(t,d,b,this._xScaleTextFont,m)}"default"!==this._type&&A&&(this._valueSpanCount?x%this._valueSpanCount==0&&this.drawLine(t,A,this._xScaleLineWidth,w,v.y+v.height,w,v.y):this.drawLine(t,A,this._xScaleLineWidth,w,v.y+v.height,w,v.y))}var S=r+this._min/c*l;this._publishedDatas.size()>0&&this._columnCount>0&&this.drawContent(t,v,o,S),this.drawLine(t,this._xAxisLineColor,this._xAxisLineWidth,v.x,v.y+v.height,v.x+v.width,v.y+v.height)}}),De.charts.PieChart=function(t){this._sum=0,this._map={},De.charts.PieChart.superClass.constructor.apply(this,arguments)},Be.ext("twaver.charts.PieChart",De.charts.ChartBase,{__accessor:["type","selectOffset","startAngle","shadowColor","shadowOffset","lineRate","donutRate","valuePosition"],_type:kn.PIECHART_TYPE,_lineRate:kn.PIECHART_LINE_RATE,_donutRate:kn.PIECHART_DONUT_RATE,_startAngle:kn.PIECHART_START_ANGLE,_shadowColor:kn.PIECHART_SHADOW_COLOR,_shadowOffset:kn.PIECHART_SHADOW_OFFSET,_selectOffset:kn.PIECHART_SELECT_OFFSET,_valuePosition:kn.PIECHART_VALUE_POSITION,getSum:function(){return this._sum},validateModel:function(){this._sum=0,this._map={},this._publishedDatas.forEach(function(t){var e=this.getValue(t);this._map[t.getId()]={data:t,value:e,color:this.getUniqueColor(this.getColor(t),t)},this._sum+=e},this);var t=this._startAngle;this._publishedDatas.forEach(function(e){var i=this._map[e.getId()];i.proportion=0===this._sum?0:i.value/this._sum,"line"!==this._type&&(i.startAngle=t,i.arc=i.proportion*Math.PI*2,t+=i.arc)},this)},validateDisplay:function(t,e,i){var n={x:this._xGap,y:this._yGap,width:e-2*this._xGap,height:i-2*this._yGap};if(this.drawBackground(t,n),Ge.grow(n,-4,-4),!(n.width<=0||n.height<=0)){var s=this._shadowOffset;if(s>0&&(t.shadowOffsetX=s,t.shadowOffsetY=s,t.shadowBlur=1.5*s,t.shadowColor=this._shadowColor),"oval"===this._type||"circle"===this._type){var r=n.x+n.width/2,a=n.y+n.height/2,o=n.width/2,h=n.height/2;"circle"===this._type&&(o=h=Math.min(o,h)),this._publishedDatas.forEach(function(e){var i=this._map[e.getId()];if(0!==i.arc){var n=0,s=0;if(this.isSelected(e)){var l=i.startAngle+i.arc/2;n=Math.cos(l)*this._selectOffset,s=Math.sin(l)*this._selectOffset*h/o}t.fillStyle=i.color,t.beginPath(),t.moveTo(r+n,a-s),qe.drawArc(t,r+n,a-s,i.startAngle,i.arc,o,h,!0),t.closePath(),t.fill();var c=this._getValueTextInfo(e,i.value);if(c){var l=i.startAngle+i.arc/2;c.x=r+n+Math.cos(l)*o*this._valuePosition,c.y=a-s-Math.sin(l)*h*this._valuePosition}}},this)}else if("donut"===this._type||"ovalDonut"===this._type){var r=n.x+n.width/2,a=n.y+n.height/2,o=n.width/2,h=n.height/2;"donut"===this._type&&(o=h=Math.min(o,h)),this._publishedDatas.forEach(function(e){var i=this._map[e.getId()];if(0!==i.arc){var n=0,s=0;if(this.isSelected(e)){var l=i.startAngle+i.arc/2;n=Math.cos(l)*this._selectOffset,s=Math.sin(l)*this._selectOffset*h/o}var c=r+Math.cos(i.startAngle)*o*this._donutRate,u=a-Math.sin(i.startAngle)*h*this._donutRate,d=r+Math.cos(i.startAngle+i.arc)*o*this._donutRate,f=a-Math.sin(i.startAngle+i.arc)*h*this._donutRate;t.fillStyle=i.color,t.beginPath(),t.moveTo(c+n,u-s),qe.drawArc(t,r+n,a-s,i.startAngle,i.arc,o,h,!0),t.lineTo(d+n,f-s),qe.drawArc(t,r+n,a-s,i.startAngle+i.arc,-i.arc,o*this._donutRate,h*this._donutRate,!0),t.closePath(),t.fill();var g=this._getValueTextInfo(e,i.value);if(g){var l=i.startAngle+i.arc/2,_=this._donutRate+(1-this._donutRate)*this._valuePosition;g.x=r+n+Math.cos(l)*o*_,g.y=a-s-Math.sin(l)*h*_}}},this)}else if("line"===this._type){var l=n.height*this._lineRate;n.y=n.y+n.height/2-l/2,n.height=l;var c=n.x;this._publishedDatas.forEach(function(e){var i=this._map[e.getId()],s=n.width*i.proportion;if(0!==s){t.beginPath(),t.fillStyle=i.color;var r=this.isSelected(e)?-this._selectOffset:0;t.rect(c,n.y+r,s,n.height),t.closePath(),t.fill();var a=this._getValueTextInfo(e,i.value);a&&(a.x=c+s/2,a.y=n.y+n.height+r-n.height*this._valuePosition),c+=s}},this)}this._shadowOffset>0&&(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0),this.drawValueTexts(t)}}}),De.charts.BarChart=function(t){De.charts.BarChart.superClass.constructor.apply(this,arguments)},Be.ext("twaver.charts.BarChart",De.charts.ScaleChart,{__accessor:["type"],_upperLimit:kn.BARCHART_UPPER_LIMIT,_lowerLimit:kn.BARCHART_LOWER_LIMIT,_type:kn.BARCHART_TYPE,_xAxisText:null,_xAxisTextColor:kn.BARCHART_XAXIS_TEXT_COLOR,_xAxisTextFont:kn.BARCHART_XAXIS_TEXT_FONT,_xAxisLineColor:kn.BARCHART_XAXIS_LINE_COLOR,_xAxisLineWidth:kn.BARCHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:kn.BARCHART_YAXIS_TEXT_COLOR,_yAxisTextFont:kn.BARCHART_YAXIS_TEXT_FONT,_yAxisLineColor:kn.BARCHART_YAXIS_LINE_COLOR,_yAxisLineWidth:kn.BARCHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:kn.BARCHART_XSCALE_TEXT_FONT,_xScaleTextColor:kn.BARCHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:kn.BARCHART_XSCALE_TEXT_ORIENTATION,_yScaleTextVisible:kn.BARCHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:kn.BARCHART_YSCALE_TEXT_COLOR,_yScaleTextFont:kn.BARCHART_YSCALE_TEXT_FONT,_yScaleLineColor:kn.BARCHART_YSCALE_LINE_COLOR,_yScaleLineWidth:kn.BARCHART_YSCALE_LINE_WIDTH,_yScaleValueGap:kn.BARCHART_YSCALE_VALUE_GAP,_yScalePixelGap:kn.BARCHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:kn.BARCHART_YSCALE_MIN_TEXT_VISIBLE,validateModel:function(){var t=this._type+"ValidateModel";this[t]&&(this._reset(),this[t]())},defaultValidateModel:function(){this._columnCount=this._publishedDatas.size(),this._publishedDatas.forEach(function(t){var e=this.getValue(t);null==this._upperLimit&&e>this._max&&(this._max=e),null==this._lowerLimit&&e<this._min&&(this._min=e),this._map[t.getId()]={data:t,value:e,color:this.getUniqueColor(this.getColor(t),t)}},this),this._initRange(),this._publishedDatas.forEach(function(t){var e=this._map[t.getId()];e.proportion=0==this._range?0:e.value/this._range},this)},layerValidateModel:function(){this._commonValidateModel()},groupValidateModel:function(){this._commonValidateModel()},stackValidateModel:function(){if(this._publishedDatas.forEach(function(t){var e=new gn(this.getValues(t));e.size()>this._columnCount&&(this._columnCount=e.size());var i={data:t,values:e,proportions:new gn,color:this.getUniqueColor(this.getColor(t),t)};this._map[t.getId()]=i},this),null==this._upperLimit||null==this._lowerLimit)for(var t=0;t<this._columnCount;t++){var e=0,i=0;this._publishedDatas.forEach(function(n){var s=this._map[n.getId()];if(s.values.size()>t){var r=s.values.get(t);null!=r&&(r>=0?e+=r:i+=r)}},this),null==this._upperLimit&&e>this._max&&(this._max=e),null==this._lowerLimit&&i<this._min&&(this._min=i)}this._initRange(),this._initValuesProportion()},percentValidateModel:function(){this._publishedDatas.forEach(function(t){var e=new gn(this.getValues(t));e.size()>this._columnCount&&(this._columnCount=e.size());var i={data:t,values:e,proportions:new gn,color:this.getUniqueColor(this.getColor(t),t)};this._map[t.getId()]=i},this);for(var t=new gn,e=0;e<this._columnCount;e++){var i=0;this._publishedDatas.forEach(function(t){var n=this._map[t.getId()];if(n.values.size()>e){var s=n.values.get(e);null!=s&&(i+=s)}},this),t.add(i)}for(var e=0;e<this._columnCount;e++)this._publishedDatas.forEach(function(i){var n=this._map[i.getId()],s=t.get(e);if(0!==s&&n.values.size()>e){var r=n.values.get(e);if(null!=r)return void n.proportions.add(r/s)}n.proportions.add(null)},this);this._min=0,this._max=1,this._range=1},drawRect:function(t,e,i,n,s,r,a){t.fillStyle=e,i&&this._selectInfos.add({x:n,y:s,w:r,h:a,color:this.getUniqueColor(qe.darker(e))}),t.beginPath(),t.rect(n,s,r,a),t.closePath(),t.fill()},drawContent:function(t,e,i,n){this._selectInfos=new gn,this._toolTipInfos=this.isToolTipEnabled()?new gn:null,"default"===this._type?this.drawDefaultContent(t,e,i,n):"group"===this._type?this.drawGroupContent(t,e,i,n):"percent"===this._type?this.drawPercentContent(t,e,i,n):"stack"===this._type?this.drawStackContent(t,e,i,n):"layer"===this._type&&this.drawLayerContent(t,e,i,n),this.drawValueTexts(t),this._selectInfos.forEach(function(e){t.lineWidth=2,t.strokeStyle=e.color,t.beginPath(),t.rect(e.x,e.y,e.w,e.h),t.closePath(),t.stroke()},this),delete this._selectInfos},drawDefaultContent:function(t,e,i,n){for(var s=this._publishedDatas.size(),r=this._columnWidth,a=0;s>a;a++){var o=this._publishedDatas.get(a),h=this._map[o.getId()],l=e.x+r*(.5+1.5*a),c=Math.abs(i*h.proportion),u=h.proportion>0?n-c:n;this.drawRect(t,h.color,this.isSelected(o),l,u,r,c),this.addToolTipInfo(l,u,r,c,h.value,o);var d=this._getValueTextInfo(o,h.value);if(d){var f=this.getTextSize(d.font,d.text);d.x=l+r/2,d.y=u-f.height/2+1}}},drawPercentContent:function(t,e,i,n){this.drawStackContent(t,e,i,n)},drawStackContent:function(t,e,i,n){for(var s=this._columnCount,r=this._columnWidth,a=0;s>a;a++){var o=n,h=e.x+r*(.5+1.5*a);this._publishedDatas.forEach(function(e){var n=this._map[e.getId()];if(a<n.proportions.size()){var s=n.proportions.get(a);if(null!=s){var l=i*s;o-=l,this.drawRect(t,n.color,this.isSelected(e),h,o,r,l),this.addToolTipInfo(h,o,r,l,n.values.get(a),e);var c=this._getValueTextInfo(e,n.values.get(a));c&&(c.x=h+r/2,c.y=o+l/2)}}},this)}},drawLayerContent:function(t,e,i,n){for(var s=this._publishedDatas.size(),r=this._columnCount,a=this._columnWidth,o=3*a/8/s,h=0;r>h;h++){var l=e.x+a*(.5+1.5*h),c=0;this._publishedDatas.forEach(function(e){var r=this._map[e.getId()];if(h<r.proportions.size()){var u=r.proportions.get(h);if(null!=u){var d=i*u,f=n-d,g=l+a/2-a/8-o*(s-c),_=2*(a/8+o*(s-c));this.drawRect(t,r.color,this.isSelected(e),g,f,_,d),this.addToolTipInfo(g,f,_,d,r.values.get(h),e);var p=this._getValueTextInfo(e,r.values.get(h));if(p){var v=this.getTextSize(p.font,p.text);p.x=g+_/2,p.y=f-v.height/2+1}}}c++},this)}},drawGroupContent:function(t,e,i,n){for(var s=this._publishedDatas.size(),r=this._columnCount,a=this._columnWidth,o=a/s,h=0;r>h;h++){var l=e.x+a*(.5+1.5*h),c=0;this._publishedDatas.forEach(function(e){var s=this._map[e.getId()];if(h<s.proportions.size()){var r=s.proportions.get(h);if(null!=r){var a=i*r,u=n-a;this.drawRect(t,s.color,this.isSelected(e),l+o*c,u,o,a),this.addToolTipInfo(l+o*c,u,o,a,s.values.get(h),e);var d=this._getValueTextInfo(e,s.values.get(h));if(d){var f=this.getTextSize(d.font,d.text);d.x=l+o*c+o/2,d.y=u-f.height/2+1}}}c++},this)}}}),De.charts.LineChart=function(t){De.charts.LineChart.superClass.constructor.apply(this,arguments),this._selectTolerance=2},Be.ext("twaver.charts.LineChart",De.charts.ScaleChart,{__accessor:["xScaleLineColor","xScaleLineWidth","interruptable"],_interruptable:kn.LINECHART_INTERRUPTABLE,_upperLimit:kn.LINECHART_UPPER_LIMIT,_lowerLimit:kn.LINECHART_LOWER_LIMIT,_xAxisText:null,_xAxisTextColor:kn.LINECHART_XAXIS_TEXT_COLOR,_xAxisTextFont:kn.LINECHART_XAXIS_TEXT_FONT,_xAxisLineColor:kn.LINECHART_XAXIS_LINE_COLOR,_xAxisLineWidth:kn.LINECHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:kn.LINECHART_YAXIS_TEXT_COLOR,_yAxisTextFont:kn.LINECHART_YAXIS_TEXT_FONT,_yAxisLineColor:kn.LINECHART_YAXIS_LINE_COLOR,_yAxisLineWidth:kn.LINECHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:kn.LINECHART_XSCALE_TEXT_FONT,_xScaleTextColor:kn.LINECHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:kn.LINECHART_XSCALE_TEXT_ORIENTATION,_xScaleLineColor:kn.LINECHART_XSCALE_LINE_COLOR,_xScaleLineWidth:kn.LINECHART_XSCALE_LINE_WIDTH,_valueSpanCount:kn.LINECHART_VALUESPANCOUNT,_yScaleTextVisible:kn.LINECHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:kn.LINECHART_YSCALE_TEXT_COLOR,_yScaleTextFont:kn.LINECHART_YSCALE_TEXT_FONT,_yScaleLineColor:kn.LINECHART_YSCALE_LINE_COLOR,_yScaleLineWidth:kn.LINECHART_YSCALE_LINE_WIDTH,_yScaleValueGap:kn.LINECHART_YSCALE_VALUE_GAP,_yScalePixelGap:kn.LINECHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:kn.LINECHART_YSCALE_MIN_TEXT_VISIBLE,getLineWidth:function(t){return t.getStyle?t.getStyle("chart.line.width"):De.Styles.getStyle("chart.line.width")},getMarkerShape:function(t){return t.getStyle?t.getStyle("chart.marker.shape"):De.Styles.getStyle("chart.marker.shape")},getMarkerSize:function(t){return t.getStyle?t.getStyle("chart.marker.size"):De.Styles.getStyle("chart.marker.size")},_initInfo:function(t,e){e.markerShape=this.getMarkerShape(t),e.markerSize=this.getMarkerSize(t),e.lineWidth=this.getLineWidth(t),this.isSelected(t)&&(e.lineWidth+=2)},validateModel:function(){this._reset(),this._commonValidateModel()},getPointIndexAt:function(){var t=this._getPoint.apply(this,arguments),e=this.tryGetDataAt(t);if(!e)return-1;for(var i,n=this._map[e.getId()],s=n.points,r=n.markerSize,a=0,o=s.size();o>a;a++)if(i=s.get(a),i&&Ge.getDistance(t,i)<=r)return a;return-1},drawContent:function(t,e,i,n){this._toolTipInfos=this.isToolTipEnabled()?new gn:null,this._publishedDatas.forEach(function(s){var r=this._map[s.getId()],a=r.markerSize>0?new gn:null;t.strokeStyle=r.color,t.lineWidth=r.lineWidth,t.beginPath();var o=r.proportions,h=null,l=o.size(),c=new gn;r.points=c;for(var u=0;l>u;u++){var d=o.get(u);if(null!=d){var f={x:e.x+this._columnWidth*(1+1.5*u),y:n-i*d};c.add(f),null==h?t.moveTo(f.x,f.y):t.lineTo(f.x,f.y);var g=r.values.get(u),_=this._getValueTextInfo(s,g);if(_){var p=this.getTextSize(_.font,_.text);_.x=f.x,_.y=f.y-p.height/2+2}a&&a.add({point:f,value:g,data:s,index:u}),h=f}else this._interruptable&&(h=null,c.add(null))}if(t.stroke(),a){var v=r.markerSize/2;a.forEach(function(e){t.fillStyle=r.color;var i=e.point.x-v,n=e.point.y-v,s=r.markerSize,a=r.markerSize;qe.drawVector(t,r.markerShape,null,i,n,s,a),t.fill(),this.addToolTipInfo(i,n,s,a,e.value,e.data,e.index)},this)}},this),this.drawValueTexts(t)}}),De.charts.BubbleChart=function(t){De.charts.BubbleChart.superClass.constructor.apply(this,arguments)},Be.ext("twaver.charts.BubbleChart",De.charts.ScaleChart,{__accessor:["xAxisUpperLimit","xAxisLowerLimit","xScaleLineColor","xScaleLineWidth","selectShadowColor","selectShadowOffset"],_upperLimit:kn.BUBBLECHART_UPPER_LIMIT,_lowerLimit:kn.BUBBLECHART_LOWER_LIMIT,_xAxisUpperLimit:kn.BUBBLECHART_XAXIS_UPPER_LIMIT,_xAxisLowerLimit:kn.BUBBLECHART_XAXIS_LOWER_LIMIT,_xAxisText:null,_xAxisTextColor:kn.BUBBLECHART_XAXIS_TEXT_COLOR,_xAxisTextFont:kn.BUBBLECHART_XAXIS_TEXT_FONT,_xAxisLineColor:kn.BUBBLECHART_XAXIS_LINE_COLOR,_xAxisLineWidth:kn.BUBBLECHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:kn.BUBBLECHART_YAXIS_TEXT_COLOR,_yAxisTextFont:kn.BUBBLECHART_YAXIS_TEXT_FONT,_yAxisLineColor:kn.BUBBLECHART_YAXIS_LINE_COLOR,_yAxisLineWidth:kn.BUBBLECHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:kn.BUBBLECHART_XSCALE_TEXT_FONT,_xScaleTextColor:kn.BUBBLECHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:kn.BUBBLECHART_XSCALE_TEXT_ORIENTATION,_xScaleLineColor:kn.BUBBLECHART_XSCALE_LINE_COLOR,_xScaleLineWidth:kn.BUBBLECHART_XSCALE_LINE_WIDTH,_yScaleTextVisible:kn.BUBBLECHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:kn.BUBBLECHART_YSCALE_TEXT_COLOR,_yScaleTextFont:kn.BUBBLECHART_YSCALE_TEXT_FONT,_yScaleLineColor:kn.BUBBLECHART_YSCALE_LINE_COLOR,_yScaleLineWidth:kn.BUBBLECHART_YSCALE_LINE_WIDTH,_yScaleValueGap:kn.BUBBLECHART_YSCALE_VALUE_GAP,_yScalePixelGap:kn.BUBBLECHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:kn.BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE,_selectShadowColor:kn.BUBBLECHART_SELECT_SHADOW_COLOR,_selectShadowOffset:kn.BUBBLECHART_SELECT_SHADOW_OFFSET,_resetX:function(){this._xMax=0,this._xMin=0,null!=this._xAxisUpperLimit&&(this._xMax=this._xAxisUpperLimit),null!=this._xAxisLowerLimit&&(this._xMin=this._xAxisLowerLimit)},getXMin:function(){return this._xMin},getXMax:function(){return this._xMax},getXRange:function(){return this._xRange},getShape:function(t){return t.getStyle?t.getStyle("chart.bubble.shape"):De.Styles.getStyle("chart.bubble.shape")},getSize:function(t,e){return e},getNames:function(t){return t.getStyle?t.getStyle("chart.names"):De.Styles.getStyle("chart.names")},getXAxisValues:function(t){return t.getStyle?t.getStyle("chart.xaxis.values"):De.Styles.getStyle("chart.xaxis.values")},getYAxisValues:function(t){return t.getStyle?t.getStyle("chart.yaxis.values"):De.Styles.getStyle("chart.yaxis.values")},_initXRange:function(){null==this._xAxisLowerLimit&&(this._xMin>=this._xMax&&(this._xMin=this._xMax-.1*Math.abs(this._xMax)),this._xMin=this._xMin-.1*(this._xMax-this._xMin)),this._xRange=this._xMax-this._xMin},_initXYValuesProportion:function(){this._publishedDatas.forEach(function(t){var e=this._map[t.getId()];e.xAxisValues.forEach(function(t){e.xAxisProportions.add(null==t?null:0==this._xRange?0:t/this._xRange)},this),e.yAxisValues.forEach(function(t){e.yAxisProportions.add(null==t?null:0==this._range?0:t/this._range)},this)},this)},validateModel:function(){this._reset(),this._resetX(),this._columnCount=null==this._xScaleTexts?0:this._xScaleTexts.size(),this._publishedDatas.forEach(function(t){var e=new gn(this.getYAxisValues(t)),i=new gn(this.getXAxisValues(t)),n=new gn(this.getValues(t));n.size()>this._columnCount&&(this._columnCount=n.size());var s={data:t,values:n,yAxisValues:e,xAxisValues:i,yAxisProportions:new gn,xAxisProportions:new gn,color:this.getUniqueColor(this.getColor(t),t),anchorShape:this.getShape(t)};this._map[t.getId()]=s,(null==this._upperLimit||null==this._lowerLimit)&&e.forEach(function(t){null!=t&&(null==this._upperLimit&&t>this._max&&(this._max=t),null==this._lowerLimit&&t<this._min&&(this._min=t))},this),(null==this._upperLimit||null==this._lowerLimit)&&i.forEach(function(t){null!=t&&(null==this._xAxisUpperLimit&&t>this._xMax&&(this._xMax=t),null==this._xAxisLowerLimit&&t<this._xMin&&(this._xMin=t))},this)},this),this._initRange(),this._initXRange(),this._initXYValuesProportion()},drawContent:function(t,e,i,n){this._toolTipInfos=this.isToolTipEnabled()?new gn:null,this._publishedDatas.forEach(function(s){var r=this._map[s.getId()],a=r.yAxisProportions,o=r.xAxisProportions,h=r.values,l=r.yAxisProportions.size(),c=this._selectShadowOffset;this.isSelected(s)&&c>0?(t.shadowOffsetX=c,t.shadowOffsetY=c,t.shadowBlur=2*c,t.shadowColor=this._selectShadowColor):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0,t.shadowColor=r.color),t.fillStyle=r.color;for(var u=0;l>u;u++){var d=a.get(u),f=o.get(u);if(null!=d){var g={x:e.x+e.width*f,y:n-i*d},_=h.get(u),p=this.getSize(s,_),c=p/2,v=g.x-c,m=g.y-c,y=p,A=p;qe.drawVector(t,r.anchorShape,null,v,m,y,A),t.fill(),this.addToolTipInfo(v,m,y,A,_,s,u);var x=this._getValueTextInfo(s,_);if(x){var p=this.getTextSize(x.font,x.text);x.x=g.x,x.y=g.y}}}},this),this.drawValueTexts(t)}}),De.charts.DialChart=function(t){De.charts.DialChart.superClass.constructor.apply(this,arguments)},Be.ext("twaver.charts.DialChart",De.charts.ChartBase,{__accessor:["upperLimit","lowerLimit","startAngle","endAngle","innerRadius","colorRangeFillColor","outlineWidth","outlineColor","majorScaleCount","majorScaleLineWidth","majorScaleLineLength","majorScaleLineColor","minorScaleCount","minorScaleLineWidth","minorScaleLineLength","minorScaleLineColor","scaleTextVisible","scaleUpperLimitTextVisible","scaleLowerLimitTextVisible","scaleTextFont","scaleTextColor","pivotRadius","pivotFillColor","pivotOutlineWidth","pivotOutlineColor","pivotGradient","pivotGradientColor","valuePosition","colorRangeList","innerDarkerRadius","outerBrighterRadius","selectShadowColor","selectShadowOffset"],__bool:["scaleInside","pivotFill"],_upperLimit:kn.DIALCHART_UPPER_LIMIT,_lowerLimit:kn.DIALCHART_LOWER_LIMIT,_startAngle:kn.DIALCHART_START_ANGLE,_endAngle:kn.DIALCHART_END_ANGLE,_innerRadius:kn.DIALCHART_INNER_RADIUS,_colorRangeFillColor:kn.DIALCHART_COLOR_RANGE_FILL_COLOR,_outlineWidth:kn.DIALCHART_OUTLINE_WIDTH,_outlineColor:kn.DIALCHART_OUTLINE_COLOR,_scaleInside:kn.DIALCHART_SCALE_INSIDE,_majorScaleCount:kn.DIALCHART_MAJOR_SCALE_COUNT,_majorScaleLineWidth:kn.DIALCHART_MAJOR_SCALE_LINE_WIDTH,_majorScaleLineLength:kn.DIALCHART_MAJOR_SCALE_LINE_LENGTH,_majorScaleLineColor:kn.DIALCHART_MAJOR_SCALE_LINE_COLOR,_minorScaleCount:kn.DIALCHART_MINOR_SCALE_COUNT,_minorScaleLineWidth:kn.DIALCHART_MINOR_SCALE_LINE_WIDTH,_minorScaleLineLength:kn.DIALCHART_MINOR_SCALE_LINE_LENGTH,_minorScaleLineColor:kn.DIALCHART_MINOR_SCALE_LINE_COLOR,_scaleTextVisible:kn.DIALCHART_SCALE_TEXT_VISIBLE,_scaleUpperLimitTextVisible:kn.DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE,_scaleLowerLimitTextVisible:kn.DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE,_scaleTextFont:kn.DIALCHART_SCALE_TEXT_FONT,_scaleTextColor:kn.DIALCHART_SCALE_TEXT_COLOR,_pivotRadius:kn.DIALCHART_PIVOT_RADIUS,_pivotFill:kn.DIALCHART_PIVOT_FILL,_pivotFillColor:kn.DIALCHART_PIVOT_FILL_COLOR,_pivotOutlineWidth:kn.DIALCHART_PIVOT_OUTLINE_WIDTH,_pivotOutlineColor:kn.DIALCHART_PIVOT_OUTLINE_COLOR,_pivotGradient:kn.DIALCHART_PIVOT_GRADIENT,_pivotGradientColor:kn.DIALCHART_PIVOT_GRADIENT_COLOR,_valuePosition:kn.DIALCHART_VALUE_POSITION,_innerDarkerRadius:kn.DIALCHART_INNER_DARKER_RADIUS,_outerBrighterRadius:kn.DIALCHART_OUTER_BRIGHTER_RADIUS,_selectShadowColor:kn.DIALCHART_SELECT_SHADOW_COLOR,_selectShadowOffset:kn.DIALCHART_SELECT_SHADOW_OFFSET,formatScaleText:function(t){return t.toFixed(2)},validateModel:function(){this._map={},this._valueRange=this._upperLimit-this._lowerLimit;var t=this._startAngle;0!=t&&(t=(t%360+360)%360,0==t&&(t=360)),this._positiveStartAngle=t;var e=this._endAngle;0!=e&&(e=(e%360+360)%360,0==e&&(e=360)),this._positiveEndAngle=e,this._whole=360==Math.abs(t-e),this._startAngleByRadian=t*Math.PI/180,this._endAngleByRadian=e*Math.PI/180,this._clockwise=this._startAngleByRadian>this._endAngleByRadian,this._angleRange=Math.abs(this._startAngleByRadian-this._endAngleByRadian),this._publishedDatas.forEach(function(t){var e=this.getValue(t);this._map[t.getId()]={data:t,value:e,color:this.getUniqueColor(this.getColor(t),t),angle:this._startAngleByRadian+(this._clockwise?-1:1)*e/this._valueRange*this._angleRange}},this)},validateDisplay:function(t,e,i){var n={x:this._xGap,y:this._yGap,width:e-2*this._xGap,height:i-2*this._yGap};if(this.drawBackground(t,n),this._startAngleByRadian!=this._endAngleByRadian){var s,r,a=this._lowerLimit,o=this._majorScaleCount>1?this._valueRange/(this._majorScaleCount-1):0,h=0,l=0,c=null,u=null;if(this._scaleTextVisible)for(c=new gn,s=0;s<this._majorScaleCount;s++)0==s&&!this._scaleLowerLimitTextVisible||s==this._majorScaleCount-1&&!this._scaleUpperLimitTextVisible?(r=null,c.add({text:"",size:{width:0,height:0}})):(u=this.formatScaleText(a),r=this.getTextSize(this._scaleTextFont,u),c.add({text:u,size:r})),this._scaleInside||null==r||(r.width>h&&(h=r.width),r.height>l&&(l=r.height)),a+=o;if(this._angleRange<=Math.PI&&(h=Math.max(h,this._pivotRadius),l=Math.max(l,this._pivotRadius)),Ge.grow(n,-h,-l),this._calcluateCenterAndRadius(n),t.lineWidth=0,null==this._colorRangeList||0==this._colorRangeList.size())this._drawArcGroup(t,this._startAngleByRadian,this._endAngleByRadian,this.getUniqueColor(this._colorRangeFillColor)),this._drawArcOutLine(t,this._startAngleByRadian,this._endAngleByRadian,!0,!0);else{var d=this._angleRange/this._colorRangeList.size(),f=this._startAngleByRadian;for(s=0;s<this._colorRangeList.size();s++){var g=this.getUniqueColor(this._colorRangeList.get(s)),_=f+(this._clockwise?-1:1)*d;this._drawArcGroup(t,f,_,g),this._drawArcOutLine(t,f,f+(this._clockwise?-1:1)*d,0==s,s==this._colorRangeList.size()-1),f+=(this._clockwise?-1:1)*d}}var p,v,m,y,A,x,w,b,S=this._startAngleByRadian,C=this._majorScaleCount>1?this._angleRange/(this._majorScaleCount-1):0;for(x=this._scaleInside?this._innerRadiusByPixel:this._outerRadius,w=x+this._majorScaleLineLength*(this._scaleInside?1:-1),b=x+this._minorScaleLineLength*(this._scaleInside?1:-1),s=0;s<this._majorScaleCount;s++){if(v=this._center.x+Math.cos(S)*x,m=this._center.y+Math.sin(-S)*x,y=this._center.x+Math.cos(S)*w,A=this._center.y+Math.sin(-S)*w,t.lineWidth=this._majorScaleLineWidth,t.strokeStyle=this.getUniqueColor(this._majorScaleLineColor),t.beginPath(),t.moveTo(v,m),t.lineTo(y,A),t.closePath(),t.stroke(),this._scaleTextVisible)if(0==s&&!this._scaleLowerLimitTextVisible||s==this._majorScaleCount-1&&!this._scaleUpperLimitTextVisible);else{var T=c.get(s);if(T){var E=this.getScaleTextPosition(S/Math.PI*180,v,m,T.size.width,T.size.height);T.x=E.x,T.y=E.y}}if(this._whole||!this._whole&&s<this._majorScaleCount-1){var L=S,M=this._minorScaleCount>0?C/(this._minorScaleCount+1):0;for(p=0;p<this._minorScaleCount;p++)L+=(this._clockwise?-1:1)*M,v=this._center.x+Math.cos(L)*x,m=this._center.y+Math.sin(-L)*x,y=this._center.x+Math.cos(L)*b,A=this._center.y+Math.sin(-L)*b,t.lineWidth=this._minorScaleLineWidth,t.strokeStyle=this.getUniqueColor(this._minorScaleLineColor),t.beginPath(),t.moveTo(v,m),t.lineTo(y,A),t.closePath(),t.stroke()}S+=(this._clockwise?-1:1)*C}this._pivotFill&&qe.fill(t,this.getUniqueColor(this._pivotFillColor),this._pivotGradient,this._pivotGradientColor,this._center.x-this._pivotRadius,this._center.y-this._pivotRadius,2*this._pivotRadius,2*this._pivotRadius),t.lineWidth=this._pivotOutlineWidth,t.strokeStyle=this.getUniqueColor(this._pivotOutlineColor),t.beginPath(),t.arc(this._center.x,this._center.y,this._pivotRadius,0,2*Math.PI,!0),t.closePath(),this._pivotFill&&t.fill(),c&&c.forEach(function(e){e&&qe.drawText(t,e.text,e,this._scaleTextFont,this._scaleTextColor)},this),this._publishedDatas.forEach(function(e){var i=this._map[e.getId()],n=this._getDataStyle("dialchart.rear.extension",e),s=this._getDataStyle("dialchart.base.width",e),r=this._getDataStyle("dialchart.top.width",e),a=this._getDataStyle("dialchart.radius",e);a>=-1&&1>=a&&(a*=this._innerRadiusByPixel),t.fillStyle=i.color,t.lineWidth=0;var o=Ge.createMatrix(-i.angle,this._center.x,this._center.y),h=o.transform(this._center.x+a,this._center.y+r/2),l=o.transform(this._center.x+a,this._center.y-r/2),c=o.transform(this._center.x-n,this._center.y-s/2),u=o.transform(this._center.x-n,this._center.y+s/2),d=this._selectShadowOffset;this.isSelected(e)&&d>0?(t.shadowOffsetX=d,t.shadowOffsetY=d,t.shadowBlur=2*d,t.shadowColor=this._selectShadowColor):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0,t.shadowColor=i.color),t.beginPath(),t.moveTo(h.x,h.y),t.lineTo(l.x,l.y),t.lineTo(c.x,c.y),t.lineTo(u.x,u.y),t.lineTo(h.x,h.y),t.closePath(),t.fill();var f=this._getValueTextInfo(e,i.value);if(f){var g=o.transform(this._center.x+a*this._valuePosition,this._center.y);f.x=g.x,f.y=g.y}},this),this.drawValueTexts(t)}},_getDataStyle:function(t,e){return e.getStyle?e.getStyle(t):e.getClient(t)},_calcluateCenterAndRadius:function(t){var e=this._clockwise?this._positiveEndAngle:this._positiveStartAngle,i=this._clockwise?this._positiveStartAngle:this._positiveEndAngle;Math.abs(this._positiveEndAngle-this._positiveStartAngle),e>=0&&90>e?i>=0&&90>=i?(this._outerRadius=Math.min(t.width,t.height),this._center={x:t.x+(t.width-this._outerRadius)/2,y:t.y+(t.height+this._outerRadius)/2}):i>90&&180>=i?(this._outerRadius=Math.min(t.width/2,t.height),this._center={x:t.x+t.width/2,y:t.y+(t.height+this._outerRadius)/2}):(this._center={x:t.x+t.width/2,y:t.y+t.height/2},this._outerRadius=Math.min(t.width,t.height)/2):e>=90&&180>e?i>=90&&180>=i?(this._outerRadius=Math.min(t.width,t.height),this._center={x:t.x+(t.width+this._outerRadius)/2,y:t.y+(t.height+this._outerRadius)/2}):i>180&&270>=i?(this._outerRadius=Math.min(t.width,t.height/2),this._center={x:t.x+(t.width+this._outerRadius)/2,y:t.y+t.height/2}):(this._center={x:t.x+t.width/2,y:t.y+t.height/2},this._outerRadius=Math.min(t.width,t.height)/2):e>=180&&270>e?i>=180&&270>=i?(this._outerRadius=Math.min(t.width,t.height),this._center={x:t.x+(t.width+this._outerRadius)/2,y:t.y+(t.height-this._outerRadius)/2}):(this._outerRadius=Math.min(t.width/2,t.height),this._center={x:t.x+t.width/2,y:t.y+(t.height-this._outerRadius)/2}):(this._outerRadius=Math.min(t.width,t.height),this._center={x:t.x+(t.width-this._outerRadius)/2,y:t.y+(t.height-this._outerRadius)/2}),this._innerRadiusByPixel=this._innerRadius>1?this._innerRadius:this._outerRadius*this._innerRadius,this._innerDarkerRadiusByPixel=this._innerDarkerRadius>1?this._innerDarkerRadius:this._outerRadius*this._innerDarkerRadius,this._outerBrighterRadiusByPixel=this._outerBrighterRadius>1?this._outerBrighterRadius:this._outerRadius*this._outerBrighterRadius},_drawArcOutLine:function(t,e,i,n,s){if(!(this._outlineWidth<=0)){var r=Math.abs(e-i),a=this._center.x+Math.cos(e)*this._innerRadiusByPixel,o=this._center.y+Math.sin(-e)*this._innerRadiusByPixel,h=this._center.x+Math.cos(e)*this._outerRadius,l=this._center.y+Math.sin(-e)*this._outerRadius,c=this._center.x+Math.cos(i)*this._innerRadiusByPixel,u=this._center.y+Math.sin(-i)*this._innerRadiusByPixel,d=this._center.x+Math.cos(i)*this._outerRadius,f=this._center.y+Math.sin(-i)*this._outerRadius;this._clockwise?(t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor),t.beginPath(),t.moveTo(this._center.x,this._center.y),qe.drawArc(t,this._center.x,this._center.y,i,r,this._outerRadius,this._outerRadius,!1),t.stroke(),!this._whole&&n?(t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor)):t.lineWidth=0,t.lineTo(a,o),t.stroke(),t.beginPath(),t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor),t.moveTo(this._center.x,this._center.y),qe.drawArc(t,this._center.x,this._center.y,e,-r,this._innerRadiusByPixel,this._innerRadiusByPixel,!1),t.stroke(),!this._whole&&s?(t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor)):t.lineWidth=0,t.lineTo(d,f),t.stroke()):(t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor),t.beginPath(),t.moveTo(this._center.x,this._center.y),qe.drawArc(t,this._center.x,this._center.y,e,r,this._outerRadius,this._outerRadius,!1),t.stroke(),!this._whole&&s?(t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor)):t.lineWidth=0,t.lineTo(c,u),t.stroke(),t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor),t.beginPath(),t.moveTo(this._center.x,this._center.y),qe.drawArc(t,this._center.x,this._center.y,i,-r,this._innerRadiusByPixel,this._innerRadiusByPixel,!1),t.stroke(),!this._whole&&n?(t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor)):t.lineWidth=0,t.lineTo(h,l),t.stroke())}},_drawArcGroup:function(t,e,i,n){0!=this._outerBrighterRadiusByPixel&&this._drawArc(t,e,i,this._outerRadius-this._outerBrighterRadiusByPixel,this._outerRadius,qe.brighter(n)),this._drawArc(t,e,i,this._innerRadiusByPixel+this._innerDarkerRadiusByPixel,this._outerRadius-this._outerBrighterRadiusByPixel,n),
0!=this._innerDarkerRadiusByPixel&&this._drawArc(t,e,i,this._innerRadiusByPixel,this._innerRadiusByPixel+this._innerDarkerRadiusByPixel,qe.darker(n,20))},_drawArc:function(t,e,i,n,s,r){var a=Math.abs(e-i);t.lineWidth=0,t.fillStyle=r;var o=this._center.x+Math.cos(e)*n,h=this._center.y+Math.sin(-e)*n,l=(this._center.x+Math.cos(e)*s,this._center.y+Math.sin(-e)*s,this._center.x+Math.cos(i)*n),c=this._center.y+Math.sin(-i)*n;this._center.x+Math.cos(i)*s,this._center.y+Math.sin(-i)*s,t.beginPath(),this._clockwise?(t.moveTo(l,c),qe.drawArc(t,this._center.x,this._center.y,i,a,s,s,!0),t.lineTo(o,h),qe.drawArc(t,this._center.x,this._center.y,e,-a,n,n,!0),t.closePath()):(t.moveTo(o,h),qe.drawArc(t,this._center.x,this._center.y,e,a,s,s,!0),t.lineTo(l,c),qe.drawArc(t,this._center.x,this._center.y,i,-a,n,n,!0),t.closePath()),t.fill()},getScaleTextPosition:function(t,e,i,n,s){t=(t%360+360)%360;var r={x:e,y:i};return 0==t&&(r=this._scaleInside?{x:e-n/2,y:i}:{x:e+n/2,y:i}),180==t&&(r=this._scaleInside?{x:e+n/2,y:i}:{x:e-n/2,y:i}),90==t&&(r=this._scaleInside?{x:e,y:i+s/2}:{x:e,y:i-s/2}),270==t&&(r=this._scaleInside?{x:e,y:i-s/2}:{x:e,y:i+s/2}),t>270&&360>t&&(r=this._scaleInside?{x:e-n/2,y:i-s/2}:{x:e+n/2,y:i+s/2}),t>180&&270>t&&(r=this._scaleInside?{x:e+n/2,y:i-s/2}:{x:e-n/2,y:i+s/2}),t>90&&180>t&&(r=this._scaleInside?{x:e+n/2,y:i+s/2}:{x:e-n/2,y:i-s/2}),t>0&&90>t&&(r=this._scaleInside?{x:e-n/2,y:i+s/2}:{x:e+n/2,y:i-s/2}),r}}),De.charts.RadarChart=function(t){De.charts.RadarChart.superClass.constructor.apply(this,arguments),this._selectTolerance=2},Be.ext("twaver.charts.RadarChart",De.charts.ChartBase,{__accessor:["axisTextVisible","axisTextFont","axisTextColor","scaleTextVisible","scaleTextFont","scaleTextColor","axisVisible","axisLineColor","axisLineWidth","axisStartAngle","ringVisible","ringType","ringLineColor","ringLineWidth","scaleCount","scaleMaxValue","scaleMinValue","anchorVisible","areaFillAlpha","areaSelectFillAlpha","axisList"],__bool:["areaFill"],_axisTextVisible:kn.RADARCHART_AXIS_TEXT_VISIBLE,_axisTextFont:kn.RADARCHART_AXIS_TEXT_FONT,_axisTextColor:kn.RADARCHART_AXIS_TEXT_COLOR,_scaleTextVisible:kn.RADARCHART_SCALE_TEXT_VISIBLE,_scaleTextFont:kn.RADARCHART_SCALE_TEXT_FONT,_scaleTextColor:kn.RADARCHART_SCALE_TEXT_COLOR,_axisVisible:kn.RADARCHART_AXIS_VISIBLE,_axisLineColor:kn.RADARCHART_AXIS_LINE_COLOR,_axisLineWidth:kn.RADARCHART_AXIS_LINE_WIDTH,_axisStartAngle:kn.RADARCHART_AXIS_START_ANGLE,_ringVisible:kn.RADARCHART_RING_VISIBLE,_ringType:kn.RADARCHART_RING_TYPE,_ringLineColor:kn.RADARCHART_RING_LINE_COLOR,_ringLineWidth:kn.RADARCHART_RING_LINE_WIDTH,_scaleCount:kn.RADARCHART_SCALE_COUNT,_scaleMaxValue:kn.RADARCHART_SCALE_MAXVALUE,_scaleMinValue:kn.RADARCHART_SCALE_MINVALUE,_anchorVisible:kn.RADARCHART_ANCHOR_VISIBLE,_areaFill:kn.RADARCHART_AREA_FILL,_areaFillAlpha:kn.RADARCHART_AREA_FILL_ALPHA,_areaSelectFillAlpha:kn.RADARCHART_AREA_SELECT_FILL_ALPHA,getAxisCount:function(){return this._axisCount},formatScaleText:function(t,e){return t.toFixed(2)},getAnchorSize:function(t){return t.getStyle?t.getStyle("chart.marker.size"):De.Styles.getStyle("chart.marker.size")},getAnchorShape:function(t){return t.getStyle?t.getStyle("chart.marker.shape"):De.Styles.getStyle("chart.marker.shape")},getLineWidth:function(t){return t.getStyle?t.getStyle("chart.line.width"):De.Styles.getStyle("chart.line.width")},getValues:function(t){return t.getStyle?t.getStyle("chart.values"):null},tryGetDataAt:function(t,e){if((null==e||0>e)&&(e=this._selectTolerance),t.target&&(t=je.getLogicalPoint(this._canvas,arguments[0],1)),!t)return null;if(!this._areaFill){var i=t.x-e,n=t.y-e,s=2*e+1,r=2*e+1;try{for(var a=this._canvas.getContext("2d").getImageData(i,n,s,r).data,o=0,h=a.length;h>o;o+=4)if(255===a[o+3]){var l="rgb("+a[o]+","+a[o+1]+","+a[o+2]+")",c=this._uniqueColors[l];if(c)return c}}catch(u){}return null}if(!this._center)return null;t={x:t.x-this._xTranslate,y:t.y-this._yTranslate};for(var o=this._publishedDatas.size()-1;o>=0;o--){var c=this._publishedDatas.get(o),d=this._map[c.getId()],f=Ge.isPointInPolygon(d.points,t);if(f)return c}return null},getDataAt:function(){var t,e;if(2===arguments.length)t=arguments[0],e=arguments[1];else if(arguments[0].target){var i=je.getLogicalPoint(this._canvas,arguments[0],1);if(!i)return;t=i.x,e=i.y}else t=arguments[0].x,e=arguments[0].y;if(0>t||0>e||t>this._canvasWidth||e>this._canvasHeight)return null;if(!this._areaFill){try{var n=this._canvas.getContext("2d").getImageData(t,e,1,1).data;if(255===n[3]){var s="rgb("+n[0]+","+n[1]+","+n[2]+")",r=this._uniqueColors[s];if(r)return r}}catch(a){}return null}for(var o=this._publishedDatas.size()-1;o>=0;o--){var r=this._publishedDatas.get(o),h=this._map[r.getId()],l=Ge.isPointInPolygon(h.points,{x:t-this._xTranslate,y:e-this._yTranslate});if(l)return r}return null},validateModel:function(){if(this._map={},this._axisTexts=new gn,this._axisMaxValues=new gn,this._axisMinValues=new gn,this._axisRangeValues=new gn,this._axisCount=null==this._axisList?0:this._axisList.size(),0!=this._axisCount){this._averageAngleByRadian=2*Math.PI/this._axisCount,this._averageAngle=360/this._axisCount,this._axisList.forEach(function(t){if("string"==typeof t)this._axisTexts.add(t),this._axisMaxValues.add(this._scaleMaxValue),this._axisMinValues.add(this._scaleMinValue),this._axisRangeValues.add(this._scaleMaxValue-this._scaleMinValue);else{this._axisTexts.add(t.text);var e=isNaN(t.max)?this._scaleMaxValue:t.max,i=isNaN(t.min)?this._scaleMinValue:t.min;this._axisMaxValues.add(e),this._axisMinValues.add(i),this._axisRangeValues.add(e-i)}},this),this._publishedDatas.forEach(function(t){var e=new gn(this.getValues(t)),i={data:t,values:e,proportions:new gn,color:this.getUniqueColor(this.getColor(t),t),anchorShape:this.getAnchorShape(t),anchorSize:this.getAnchorSize(t),lineWidth:this.getLineWidth(t),points:new gn};this.isSelected(t)&&(i.lineWidth+=2),this._map[t.getId()]=i},this);for(var t=0;t<this._axisCount;t++)this._publishedDatas.forEach(function(e){var i=this._map[e.getId()],n=0;if(i.values.size()>t){var s=i.values.get(t),r=this._axisMinValues.get(t),a=this._axisRangeValues.get(t);a>0&&(n=(s-r)/a)}i.proportions.add(n)},this)}},validateDisplay:function(t,e,i){var n={x:this._xGap,y:this._yGap,width:e-2*this._xGap,height:i-2*this._yGap};if(this.drawBackground(t,n),!(n.width<=0||n.height<=0||this._axisCount<3)){var s=0,r=0,a=0,o=null,h=null,l=null,c=null;if(this._axisTextVisible)for(c=new gn,a=0;a<this._axisCount;a++)l=this._axisTexts.get(a),o=this.getTextSize(this._axisTextFont,l),c.add({text:l,size:o}),o.width>s&&(s=o.width),o.height>r&&(r=o.height);var u=n.width/2-s>n.height/2-r?n.height/2-2*r:n.width/2-s,d={x:n.x+n.width/2,y:n.y+n.height/2};this._center={x:d.x+this._xTranslate,y:d.y+this._yTranslate};var f=null;this._scaleTextVisible&&(f=new gn);var g=this._axisStartAngle/180*Math.PI;for(a=0;a<this._axisCount;a++){var _=180*g/Math.PI,p=d.x+Math.cos(g)*u,v=d.y+Math.sin(-g)*u,m=null;f&&(m=new gn,f.add(m)),this._ringVisible&&this._ringLineWidth>0&&(t.lineWidth=this._ringLineWidth,t.strokeStyle=this._ringLineColor);for(var y=1;y<=this._scaleCount;y++){var A=y/this._scaleCount,x=u*A,w=d.x+Math.cos(g)*x,b=d.y+Math.sin(-g)*x;if(this._ringVisible&&this._ringLineWidth>0){var S=d.x+Math.cos(g+this._averageAngleByRadian)*x,C=d.y+Math.sin(-g-this._averageAngleByRadian)*x;"line"==this._ringType?this.drawLine(t,this._ringLineColor,this._ringLineWidth,w,b,S,C):"arc"==this._ringType&&(t.beginPath(),t.moveTo(d.x,d.y),qe.drawArc(t,d.x,d.y,g,this._averageAngleByRadian,x,x,!0),t.closePath(),t.stroke())}m&&(l=this.formatScaleText(this._axisMinValues.get(a)+this._axisRangeValues.get(a)*A,a),o=this.getTextSize(this._scaleTextFont,l),h=this.getScaleTextPosition(_,w,b,o.width,o.height),m.add({text:l,x:h.x,y:h.y}))}if(this._axisVisible&&this.drawLine(t,this._axisLineColor,this._axisLineWidth,d.x,d.y,p,v),c){var T=c.get(a);h=this.getAxisTextPosition(_,p,v,T.size.width,T.size.height),T.x=h.x,T.y=h.y}g+=this._averageAngleByRadian}this._publishedDatas.forEach(function(e){var i=this._map[e.getId()];i.points.clear();var n=i.anchorSize>0?new gn:null,s=i.proportions;if(t.lineWidth=0,t.globalAlpha=this.isSelected(e)?this._areaSelectFillAlpha:this._areaFillAlpha,this._areaFill&&(t.fillStyle=i.color),this._drawItem(t,s,d,u,n,i),this._areaFill&&t.fill(),t.lineWidth=i.lineWidth,t.strokeStyle=i.color,t.globalAlpha=1,this._drawItem(t,s,d,u),t.lineWidth=0,null!=n&&n.size()>0){var r=i.anchorSize/2;n.forEach(function(e){t.fillStyle=i.color,qe.drawVector(t,i.anchorShape,null,e.x-r,e.y-r,i.anchorSize,i.anchorSize),t.fill()})}},this),f&&f.forEach(function(e){e.forEach(function(e){qe.drawText(t,e.text,e,this._scaleTextFont,this._scaleTextColor)},this)},this),c&&c.forEach(function(e){qe.drawText(t,e.text,e,this._axisTextFont,this._axisTextColor)},this)}},_drawItem:function(t,e,i,n,s,r){var a=this._axisStartAngle/180*Math.PI,o=null;t.beginPath();for(var h=0;h<this._axisCount;h++){var l=e.get(h),c={x:i.x+Math.cos(a)*n*l,y:i.y+Math.sin(-a)*n*l};null==o?t.moveTo(c.x,c.y):t.lineTo(c.x,c.y),null!=s&&this._anchorVisible&&s.add(c),r&&r.points.add(c),0==h&&(o=c),a+=this._averageAngleByRadian}null!=o&&t.lineTo(o.x,o.y),t.closePath(),t.stroke()},getAxisTextPosition:function(t,e,i,n,s){t=(t%360+360)%360;var r={x:e,y:i};return 0==t&&(r={x:e+n/2,y:i}),180==t&&(r={x:e-n/2,y:i}),90==t&&(r={x:e,y:i-s/2}),270==t&&(r={x:e,y:i+s/2}),t>270&&360>t&&(r={x:e+n/2,y:i+s/2}),t>180&&270>t&&(r={x:e-n/2,y:i+s/2}),t>90&&180>t&&(r={x:e-n/2,y:i-s/2}),t>0&&90>t&&(r={x:e+n/2,y:i-s/2}),r},getScaleTextPosition:function(t,e,i,n,s){t=(t%360+360)%360;var r={x:e,y:i};return 0==t&&(r={x:e,y:i+s/2}),180==t&&(r={x:e-n/2,y:i+s/2}),90==t&&(r={x:e+n/2,y:i}),270==t&&(r={x:e+n/2,y:i}),t>270&&360>t&&(r={x:e+n/2,y:i-s/2}),t>180&&270>t&&(r={x:e-n/2,y:i-s/2}),t>90&&180>t&&(r={x:e-n/2,y:i+s/2}),t>0&&90>t&&(r={x:e+n/2,y:i+s/2}),r}}),De.charts.LegendPane=function(t){De.charts.LegendPane.superClass.constructor.apply(this,arguments),this._divPool=new De.Pool("div"),this._iconPool=new De.Pool("div"),this._textPool=new De.Pool("span"),this._pools.add(this._divPool),this._pools.add(this._iconPool),this._pools.add(this._textPool),this._chart=t,this._chart.addViewListener(this.handleViewChange,this),this._view=je.createView("hidden"),this._view.style.verticalAlign="middle",this._legendDiv=je.createDiv(),this._legendDiv.style.whiteSpace="nowrap",this._legendDiv.style.verticalAlign="middle",this._legendDiv.style.position="",this._view.appendChild(this._legendDiv),this._hiddenMap={};var e=this;this._chart._internalVisibleFunction=function(t){return!e.isHidden(t)},He.isTouchable&&new De.charts.LegendPaneTouchInteraction(this),new De.charts.LegendPaneInteraction(this)},Be.ext("twaver.charts.LegendPane",De.controls.ControlBase,{__accessor:["iconWidth","iconHeight","iconRadius","rowHeight","orientation","hiddenColor","selectBackgroundColor","selectForegroundColor"],_iconWidth:kn.LEGENDPANE_ICON_WIDTH,_iconHeight:kn.LEGENDPANE_ICON_HEIGHT,_iconRadius:kn.LEGENDPANE_ICON_RADIUS,_rowHeight:kn.LEGENDPANE_ROW_HEIGHT,_orientation:kn.LEGENDPANE_ORIENTATION,_hiddenColor:kn.LEGENDPANE_HIDDEN_COLOR,_selectBackgroundColor:kn.LEGENDPANE_SELECT_BACKGROUND_COLOR,_selectForegroundColor:kn.LEGENDPANE_SELECT_FOREGROUND_COLOR,onPropertyChanged:function(t){this.invalidate()},getChart:function(){return this._chart},isHidden:function(t){return null!=this._hiddenMap[t.getId()]},handleViewChange:function(t){"validateEnd"===t.kind&&(this._invalidate=!0,this.validate())},validate:function(){if(this._invalidate){this._invalidate=!1,je.release(this._legendDiv),Be.keys(this._hiddenMap).forEach(function(t){this._chart.getDataBox().containsById(t)||delete this._hiddenMap[t]},this);for(var t=new gn(this._chart.getUnfilteredDatas()),e=0;e<t.size();e++){var i=t.get(e);this._chart.isVisible(i)||this.isHidden(i)||(t.removeAt(e),e--)}var n=t.size(),s=this._view.style,r="horizontal"===this._orientation;for(r?(s.textAlign="center",s.height=this._rowHeight+"px"):(s.textAlign="",s.height=this._rowHeight*n+"px"),s.lineHeight=this._rowHeight-2+"px",e=0;n>e;e++){var i=t.get(e),a=this._divPool.get();a._data=i,a.style.cursor="pointer",a.style.height=this._rowHeight+"px",a.style.display=r?"inline-block":"block",this._legendDiv.appendChild(a),this.renderLegend(a,i),this.onLegendRendered(a,i)}this._pools.forEach(function(t){t.clear()})}},renderLegend:function(t,e){var i=!this.isHidden(e),n=this._chart.isSelected(e),s=this._iconPool.get(),r=s.style;r.display="inline-block",r.verticalAlign="middle",r.marginLeft="4px",r.width=this.getIconWidth()+"px",r.height=this.getIconHeight()+"px",r.backgroundColor=i?this._chart.getColor(e):this.getHiddenColor(),t.appendChild(s);var a=this._textPool.get();r=a.style,r.paddingLeft="2px",r.paddingRight="4px",r.display="inline-block",r.verticalAlign="middle",r.color=i?n?this._selectForegroundColor:"":this.getHiddenColor(),a.innerHTML=this._chart.getName(e),t.appendChild(a),t.style.backgroundColor=i&&n?this._selectBackgroundColor:""},onLegendRendered:function(t,e){}}),De.charts.ChartPane=function(t,e,i,n){De.charts.ChartPane.superClass.constructor.apply(this,arguments),this.invalidate(),this._chart=t,this._legendPane=new De.charts.LegendPane(t),this._titleDiv=je.createDiv(),this._titleDiv.style.verticalAlign="middle",this._titleDiv.style.whiteSpace="nowrap",this._view=je.createView("hidden"),this._view.appendChild(this._titleDiv),this._view.appendChild(this._legendPane.getView()),this._view.appendChild(this._chart.getView());var s=this;this._legendPane.addPropertyChangeListener(function(t){("rowHeight"===t.property||"orientation"===t.porperty)&&s.invalidate()}),arguments.length>1&&this.setTitle(e),arguments.length>2&&this.setLegendOrientation(i),arguments.length>3&&this.setLegendWidth(n)},Be.ext("twaver.charts.ChartPane",De.controls.ControlBase,{__accessor:["title","titleHorizontalAlign","titleHeight","legendWidth"],_title:null,_titleHeight:kn.CHARTPANE_TITLE_HEIGHT,_titleHorizontalAlign:kn.CHARTPANE_TITLE_HORIZONTAL_ALIGN,_legendOrientation:kn.CHARTPANE_LEGEND_ORIENTATION,_legendWidth:kn.CHARTPANE_LEGEND_WIDTH,getLegendOrientation:function(){return this._legendOrientation},setLegendOrientation:function(t){if(this._legendOrientation!==t){var e=this._legendOrientation;this._legendOrientation=t,this.firePropertyChange("orientation",e,t),this._adjustLegendOrientation()}},_adjustLegendOrientation:function(){this._legendPane.setOrientation("left"===this._legendOrientation||"right"===this._legendOrientation?"vertical":"horizontal")},onPropertyChanged:function(t){this.invalidate()},getTitleDiv:function(){return this._titleDiv},getChart:function(){return this._chart},getLegendPane:function(){return this._legendPane},validateImpl:function(){this._adjustLegendOrientation();var t,e=this._view.offsetWidth,i=this._view.offsetHeight,n=this._legendPane.getRowHeight();this._title&&""!==this._title?(t=this._titleHeight,this._titleDiv.innerHTML=this._title):(t=0,this._titleDiv.innerHTML=""),this._titleDiv.innerHTML=this._title?this._title:"",this._titleDiv.style.textAlign=this._titleHorizontalAlign,this._titleDiv.style.lineHeight=this._titleHeight-2+"px";var s=this._titleDiv.style;s.left="0px",s.top="0px",s.width=e+"px",s.height=t+"px";var r,a;"bottom"===this._legendOrientation?(r={x:0,y:t,width:e,height:Math.max(i-t-n,0)},a={x:0,y:Math.max(i-n,0),width:e,height:n}):"right"===this._legendOrientation?(r={x:0,y:t,width:Math.max(e-this._legendWidth,0),height:Math.max(i-t,0)},a={x:Math.max(e-this._legendWidth,0),y:t,width:this._legendWidth,height:Math.max(i-t,0)}):"top"===this._legendOrientation?(r={x:0,y:t+n,width:e,height:Math.max(i-t-n,0)},a={x:0,y:t,width:e,height:n}):"left"===this._legendOrientation&&(r={x:this._legendWidth,y:t,width:Math.max(e-this._legendWidth,0),height:Math.max(i-t,0)},a={x:0,y:t,width:this._legendWidth,height:Math.max(i-t,0)}),r&&this._chart.adjustBounds(r),a&&this._legendPane.adjustBounds(a)}}),De.charts.ChartInteraction=function(t){this.chart=t,this.canvas=t._canvas;var e=this;this.canvas.addEventListener("mousedown",function(t){0===t.button&&e.handleMouseDown(t),t.preventDefault()},!1);var i=He.isFirefox?"DOMMouseScroll":"mousewheel";this.canvas.addEventListener(i,function(t){e.handleMouseWheel(t)},!1)},Be.ext("twaver.charts.ChartInteraction",Object,{handleMouseDown:function(t){this.chart.isFocusOnClick()&&De.Util.setFocus(this.canvas),this.lastPoint=this.chart.getLogicalPoint(t);var e=this.chart.tryGetDataAt(t);2===t.detail&&null==e?this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0)):(this._startLogical=this.lastPoint,this._startClient=je.getClientPoint(t),je.handle_mousedown(this,t))},handleMouseMove:function(t){if(this.lastPoint){var e={x:this._startLogical.x+t.clientX-this._startClient.x,y:this._startLogical.y+t.clientY-this._startClient.y};!this.startPan&&Ge.getDistance(this.lastPoint,e)>3&&(this.startPan=!0,this.lastPoint=e),this.startPan&&(this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+e.x-this.lastPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+e.y-this.lastPoint.y),this.lastPoint=e)}},handleMouseUp:function(t){if(!this.startPan&&1===t.detail){var e=this.chart.tryGetDataAt(t),i=this.chart.getSelectionModel();e?Be.isCtrlDown(t)?i.contains(e)?i.removeSelection(e):i.appendSelection(e):i.contains(e)||i.setSelection(e):Be.isCtrlDown(t)||i.clearSelection()}delete this.lastPoint,delete this.startPan,delete this._startClient,delete this._startLogical},handleMouseWheel:function(t){je.preventDefault(t);var e=He.isFirefox?-t.detail:t.wheelDelta;e>0?(this.chart.isXZoomEnabled()&&this.chart.setXZoom(1.1*this.chart.getXZoom(),!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(1.1*this.chart.getYZoom(),!1)):0>e&&(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()/1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()/1.1,!1))}}),De.charts.ChartTouchInteraction=function(t){this.chart=t,this.canvas=t._canvas,je.addEventListener("touchstart","handleTouchstart",this.canvas,this)},Be.ext("twaver.charts.ChartTouchInteraction",Object,{handleTouchstart:function(t){je.preventDefault(t),this.chart.isFocusOnClick()&&De.Util.setFocus(this.canvas),this.endPoint=this.chart.getLogicalPoint(t),Ci.isMultiTouch(t)&&(this.distance=Ci.getDistance(t),this.xZoom=this.chart.getXZoom(),this.yZoom=this.chart.getYZoom()),je.addEventListener("touchmove","handleTouchmove",this.canvas,this),je.addEventListener("touchend","handleTouchend",this.canvas,this)},handleTouchmove:function(t){if(je.preventDefault(t),this.endPoint){var e=this.chart.getLogicalPoint(t);if(!this.moved&&Ge.getDistance(this.endPoint,e)>10&&(this.moved=!0,this.lastPoint=e),this.moved)if(Ci.isSingleTouch(t))this.endPoint&&(this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+e.x-this.endPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+e.y-this.endPoint.y),this.endPoint=e);else if(this.distance){var i=Ci.getDistance(t)/this.distance,n=this.xZoom*i,s=this.yZoom*i;this.chart.isXZoomEnabled()&&this.chart.setXZoom(n,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(s,!1)}}},handleTouchend:function(t){if(je.preventDefault(t),!this.moved){this.endPoint=this.chart.getLogicalPoint(t);var e=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;e?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date);var i=this.chart.tryGetDataAt(t);if(e&&null==i)this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0));else{var n=this.chart.getSelectionModel();i?n.contains(i)||n.setSelection(i):n.clearSelection()}}delete this.endPoint,delete this.distance,delete this.xZoom,delete this.yZoom,delete this.moved,je.removeEventListener("touchmove",this.canvas,this),je.removeEventListener("touchend",this.canvas,this)}}),De.charts.ChartMSTouchInteraction=function(t){this.chart=t,this.canvas=t._canvas,this._pointerMap={},this._pointerIdArray=[],je.addEventListener("MSPointerDown","handleTouchstart",this.canvas,this),je.addEventListener("MSPointerMove","handleTouchmove",this.canvas,this),je.addEventListener("MSPointerUp","handleTouchend",this.canvas,this),je.addEventListener("MSPointerCancel","handleTouchend",this.canvas,this);var e=He.isFirefox?"DOMMouseScroll":"mousewheel";this.canvas.addEventListener(e,function(t){self.handleMouseWheel(t)},!1)},Be.ext("twaver.charts.ChartMSTouchInteraction",Object,{handleTouchstart:function(t){this.chart.isFocusOnClick()&&De.Util.setFocus(this.canvas);var e=this.chart.getLogicalPoint(t);t.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[t.pointerId]&&e&&(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t);var i=this.chart.tryGetDataAt(t);if(1==this._pointerIdArray.length&&e){var n=this._startTouchPoint&&this._startTouchTime&&(new Date).getTime()-this._startTouchTime.getTime()<=500&&Ge.getDistance(this._startTouchPoint,e)<=10;n&&null==i?this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0),this._startTouchPoint=null,this._startTouchTime=null,this._startClientPoint=null):(this._startTouchPoint=e,this._startTouchTime=new Date,this._startClientPoint={x:t.clientX,y:t.clientY},je.handle_mousedown(this,t))}else 2==this._pointerIdArray.length&&(this.xZoom=this.chart.getXZoom(),this.yZoom=this.chart.getYZoom(),this._distance=this._getDistance())},handleTouchmove:function(t){if(0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(Ge.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=3)&&(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length)){var e=this._getDistance()/this._distance,i=this.xZoom*e,n=this.yZoom*e;this.chart.isXZoomEnabled()&&this.chart.setXZoom(i,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(n,!1)}},handleTouchend:function(t){var e=this.chart.getLogicalPoint(t);if(1==this._pointerIdArray.length&&e&&!this.moved){var i=this.chart.tryGetDataAt(t),n=this._startTouchPoint&&this._startTouchTime&&(new Date).getTime()-this._startTouchTime.getTime()<=500&&Ge.getDistance(this._startTouchPoint,e)<=10,s=this.chart.getSelectionModel();i&&n?Be.isCtrlDown(t)?s.contains(i)?s.removeSelection(i):s.appendSelection(i):s.contains(i)||s.setSelection(i):Be.isCtrlDown(t)||s.clearSelection()}this.moved=!1,this._pointerMap={},this._pointerIdArray=[]},handleMouseWheel:function(t){je.preventDefault(t);var e=He.isFirefox?-t.detail:t.wheelDelta;e>0?(this.chart.isXZoomEnabled()&&this.chart.setXZoom(1.1*this.chart.getXZoom(),!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(1.1*this.chart.getYZoom(),!1)):0>e&&(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()/1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()/1.1,!1))},handle_mousemove:function(t){if(1==this._pointerIdArray.length&&this._startTouchPoint&&this._startClientPoint){var e={x:this._startTouchPoint.x+(t.clientX-this._startClientPoint.x)/this.chart.getXZoom(),y:this._startTouchPoint.y+(t.clientY-this._startClientPoint.y)/this.chart.getYZoom()};Ge.getDistance(this._startTouchPoint,e)>3&&(this.moved=!0,this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+e.x-this._startTouchPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+e.y-this._startTouchPoint.y),this._startClientPoint.x=t.clientX,this._startClientPoint.y=t.clientY)}},handle_mouseup:function(t){this.handleTouchend(t)},_getDistance:function(){return Ge.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),De.charts.LegendPaneInteraction=function(t){this.legendPane=t;var e=this;this.legendPane._legendDiv.addEventListener("mousedown",function(t){e.handleMouseDown(t)},!1)},Be.ext("twaver.charts.LegendPaneInteraction",Object,{handleMouseDown:function(t){if(0===t.button){var e=t.target._data;e||(e=t.target.parentNode._data),e&&(this.legendPane._hiddenMap[e.getId()]?delete this.legendPane._hiddenMap[e.getId()]:this.legendPane._hiddenMap[e.getId()]=e,this.legendPane._chart.invalidateModel())}}}),De.charts.LegendPaneTouchInteraction=function(t){this.legendPane=t,je.addEventListener("touchstart","handleTouchstart",this.legendPane._legendDiv,this)},Be.ext("twaver.charts.LegendPaneTouchInteraction",Object,{handleTouchstart:function(t){je.preventDefault(t);var e=t.target._data;e||(e=t.target.parentNode._data),e&&(this.legendPane._hiddenMap[e.getId()]?delete this.legendPane._hiddenMap[e.getId()]:this.legendPane._hiddenMap[e.getId()]=e,this.legendPane._chart.invalidateModel())}}),De.network.Network=function(t){De.network.Network.superClass.constructor.apply(this,arguments),this._elementUIMap={},this._layerMap={},this._layerList=new gn,this._view=je.createView("auto"),this._rootDiv=je.createDiv(),this._topDiv=je.createDiv(),this._attachmentDiv=je.createDiv(),this._layersDiv=je.createDiv(),this._bottomDiv=je.createDiv(),this._rootDiv.appendChild(this._bottomDiv),this._rootDiv.appendChild(this._layersDiv),this._rootDiv.appendChild(this._attachmentDiv),this._rootDiv.appendChild(this._topDiv),this._view.appendChild(this._rootDiv),this.setElementBox(t?t:new De.ElementBox),He.isTouchable?He.isMSTouchable?this.setMSTouchInteractions():this.setTouchInteractions():this.setDefaultInteractions(!1);var e=this;this._flowLink=function(){if(!(e.isMovingElement()||e.isSelectingElement()||e.isEditingElement()||e._box._layoutMovingElements)){e._flowLinkQuickFinder||(e._flowLinkQuickFinder=new De.QuickFinder(e._box,"link.flow","style"));var t=e._flowLinkQuickFinder.find(!0);t.forEach(function(t){t._styleMap["link.flow.offset"]=e.getLinkFlowOffset(t);var i=e.getElementUI(t);i.drawBody()})}},this.setToolTipEnabled(kn.NETWORK_TOOLTIP_ENABLED),this._view.addEventListener("scroll",function(t){gi.twm(e)}),this.addPropertyChangeListener(function(t){"zoom"===t.property&&gi.twm(e)}),De.imageUtil.addEventListener(this.invalidateElementUIs,this)},Be.ext("twaver.network.Network",De.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointSize","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","rotatePointSize","rotatePointFillColor","rotatePointOffset","rotatePointOutlineWidth","rotatePointOutlineColor","rotateScaleFillColor","rotateScaleFontColor","rotateScaleWidth","rotateScaleHeight","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter","selectionTolerance"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","rotatingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation","showRotateScale","transparentSelectionEnable"],_viewRect:{x:0,y:0,width:0,height:0},_currentSubNetwork:null,_selectMode:kn.NETWORK_SELECT_MODE,_noAgentLinkVisible:kn.NETWORK_NO_AGENT_LINK_VISIBLE,_makeVisibleOnSelected:kn.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:kn.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:kn.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:kn.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_subNetworkAnimate:kn.NETWORK_SUBNETWORK_ANIMATE,_transparentSelectable:kn.NETWORK_TRANSPARENT_SELECTABLE,_removeElementUIOnInvisible:kn.NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE,_elementUIFunction:kn.ELEMENTUI_FUNCTION,_doubleClickToUpSubNetwork:kn.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:kn.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:kn.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:kn.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:kn.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_sendToTopOnSelected:kn.NETWORK_SENDTOTOP_ON_SELECTED,_selectOutlineColor:kn.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:kn.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:kn.NETWORK_SELECT_FILL_COLOR,_lazyMoveOutlineColor:kn.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:kn.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:kn.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:kn.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:kn.NETWORK_LAZYMOVE_ANIMATE,_editPointSize:kn.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:kn.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:kn.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:kn.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:kn.NETWORK_EDIT_LINE_COLOR,_editLineWidth:kn.NETWORK_EDIT_LINE_WIDTH,_resizePointSize:kn.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:kn.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:kn.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:kn.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:kn.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:kn.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:kn.NETWORK_RESIZE_ANIMATE,_rotatePointSize:kn.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:kn.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:kn.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:kn.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:kn.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:kn.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:kn.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:kn.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:kn.NETWORK_ROTATE_SCALE_FONT_COLOR,_limitElementInPositiveLocation:kn.NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION,_linkFlowInterval:kn.NETWORK_LINK_FLOW_INTERVAL,_selectionTolerance:kn.NETWORK_SELECTION_TOLERANCE,_invalidate:!1,_invalidateElementVisibility:!1,_invalidateElementIndex:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_transparentSelectionEnable:De.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,getLabel:function(t){return t.getStyle("network.label")||t.getName()},isToolTipEnabled:function(){return!!this._toolTipEnabled},setToolTipEnabled:function(t){if(this._toolTipEnabled=t,t){if(!this._toolTipListener){var e=this;this._toolTipListener=function(t){var i=e.getElementAt(t);if(e._preElement!==i)if(e._preElement=i,i){var n=e.getToolTip(i);Ei.showToolTip({x:t.pageX,y:t.pageY},n);var s=Ei.getToolTipDiv();if(s.children.length>0){var r=e._view.getBoundingClientRect(),a=s.getBoundingClientRect();a.width+a.left>r.width+r.left&&(s.style.left=r.width+r.left-a.width+(Ve.documentElement.scrollLeft||Ve.body.scrollLeft)+"px"),a.height+a.top>r.height+r.top&&(s.style.top=r.height+r.top-a.height+(Ve.documentElement.scrollTop||Ve.body.scrollTop)+"px")}}else Ei.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!0),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Ei.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!0),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},isLinkFlowEnabled:function(){return!!this._linkFlowEnabled},setLinkFlowEnabled:function(t){t?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange("linkFlowEnabled",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,
this.firePropertyChange("linkFlowEnabled",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(t){var e=this._linkFlowInterval;this._linkFlowInterval=t,this.firePropertyChange("linkFlowInterval",e,t),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getTopDiv:function(){return this._topDiv},getAttachmentDiv:function(){return this._attachmentDiv},getLayersDiv:function(){return this._layersDiv},getBottomDiv:function(){return this._bottomDiv},validateImpl:function(){if(gi.twm(this),this.__lics__){var t=0,e=null,i=null,n=null,s=this._invalidateElementVisibility;if(this._invalidateElementVisibility&&(this._invalidateElementVisibility=!1,this._removeElementUIOnInvisible&&(this._invalidateElementIndex=!0),this.forEachElementUI(function(s){s.validate();var r=s.getElement();if(s.setVisible(this.isVisible(r)),this._removeElementUIOnInvisible){if(e=this.getLayerDivByElement(r),s.isVisible()){if(s.getView().parentNode!==e)for(e.appendChild(s.getView()),i=s.getAttachments(),t=0;t<i.size();t++)n=i.get(t),n.isShowInAttachmentDiv()&&this._attachmentDiv.appendChild(n.getView())}else if(s.getView().parentNode===e)for(e.removeChild(s.getView()),i=s.getAttachments(),t=0;t<i.size();t++)n=i.get(t),n.isShowInAttachmentDiv()&&this._attachmentDiv.removeChild(n.getView())}else if(!s.getView().parentNode)for(e=this.getLayerDivByElement(r),e.appendChild(s.getView()),i=s.getAttachments(),t=0;t<i.size();t++)n=i.get(t),n.isShowInAttachmentDiv()&&this._attachmentDiv.appendChild(n.getView())},null,this)),this._invalidateElementIndex){this._invalidateElementIndex=!1;var r,a=this;this._box.getLayerBox().forEachByDepthFirst(function(t){var e,i=a._layerMap[t.getId()];a._box.forEachByLayer(function(t){var n=a._elementUIMap[t.getId()];if(n&&n.getView().parentNode===i){e=je.insertAfter(n.getView(),e);for(var s=n.getAttachments(),o=0;o<s.size();o++){var h=s.get(o);h.getView().parentNode===a._attachmentDiv&&(r=je.insertAfter(h.getView(),r))}}},t)})}if(s&&!this._invalidateElementVisibility){var o;for(var h in this._elementUIMap){var l=this._elementUIMap[h];l.isVisible()&&(o=Ge.unionRect(o,l.getViewRect()))}if(o=o?{x:0,y:0,width:o.x+o.width,height:o.y+o.height}:{x:0,y:0,width:0,height:0},o.x!==this._viewRect.x||o.y!==this._viewRect.y||o.width!==this._viewRect.width||o.height!==this._viewRect.height){var c=this._viewRect;this._viewRect=o,this._rootDiv.style.left="0px",this._rootDiv.style.top="0px",this._rootDiv.style.width=o.width+"px",this._rootDiv.style.height=o.height+"px",this.firePropertyChange("viewRect",c,o)}}}},setInteractions:function(t){var e=this._interactions;e&&e.forEach(function(t){t.tearDown()}),this._interactions=t,t&&t.forEach(function(t){t.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",e,t)},getInteractions:function(){return this._interactions},upSubNetwork:function(t,e){this._currentSubNetwork&&this.setCurrentSubNetwork(xi.getSubNetwork(this._currentSubNetwork),t,e)},sendToTop:function(t){if(this.isVisible(t)){for(var e=t;this.isVisible(e.getParent())&&(e=e.getParent()););e!==t&&this._box.adjustElementIndex(e),this._box.adjustElementIndex(t)}},invalidateElementIndex:function(){this._invalidateElementIndex||(this._invalidateElementIndex=!0,this.invalidate())},invalidateElementVisibility:function(){this._invalidateElementVisibility||(this._invalidateElementVisibility=!0,this.invalidate())},updateLayers:function(){je.clear(this._layersDiv),je.clear(this._attachmentDiv),this._layerMap={},this._layerList.clear();var t=this;this._box.getLayerBox().forEachByDepthFirst(function(e){var i=je.createDiv();je.setVisible(i,e.isVisible()),t._layerMap[e.getId()]=i,t._layersDiv.appendChild(i),t._layerList.add(e)}),this._box.forEach(this.createElementUI,this)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(t,e,i){var n=De.animate.AnimateManager;if(n.endAnimate(),e){if(this._currentSubNetwork===t)return;if(t&&!this._box.contains(t))throw t+" is not contained in this network's elementBox";n.start(new De.animate.AnimateSubNetwork(this,t,i))}else this._setCurrentSubNetwork(t),i&&i()},_setCurrentSubNetwork:function(t){if(this._currentSubNetwork!==t){if(t&&!this._box.contains(t))throw t+" is not contained in this network's elementBox";var e=this._currentSubNetwork;this._currentSubNetwork=t,this.firePropertyChange("currentSubNetwork",e,t),this.invalidateElementVisibility()}},isVisible:function(t){if(!this._box.contains(t))return!1;if(!t.isVisible())return!1;if(this._visibleFunction&&!this._visibleFunction(t))return!1;if(!this._box.getLayerBox().getLayerByElement(t).isVisible())return!1;if(xi.getSubNetwork(t)!==this._currentSubNetwork)return!1;if(t instanceof De.Link){if(!this.isNoAgentLinkVisible()){if(!t.getFromAgent()||!t.getToAgent())return!1;if(!this.isVisible(t.getFromAgent())||!this.isVisible(t.getToAgent()))return!1}if(t.getBundleIndex()>0&&t.getBundleCount()>1&&!t.getStyle("link.bundle.expanded"))return!1}else for(var e=t.getParent();e&&!e.ISubNetwork;){if(e instanceof Vn&&(!e.isExpanded()||!this.isVisible(e)))return!1;e=e.getParent()}return!t.IDummy},isMovable:function(t){return!!this._box.contains(t)&&(!(t instanceof De.Link)&&(!(this._movableFunction&&!this._movableFunction(t))&&this._box.getLayerBox().getLayerByElement(t).isMovable()))},isEditable:function(t){return!!this._box.contains(t)&&(!(this._editableFunction&&!this._editableFunction(t))&&this._box.getLayerBox().getLayerByElement(t).isEditable())},isRotatable:function(t){return!(this._rotatableFunction&&!this._rotatableFunction(t))},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(t){var e=this._visibleFunction;this._visibleFunction=t,this.firePropertyChange("visibleFunction",e,t),this.invalidateElementVisibility()},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(t){var e=this._editableFunction;this._editableFunction=t,this.firePropertyChange("editableFunction",e,t),this.invalidateSelectedElementUIs(!0)},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(t){var e=this._rotatableFunction;this._rotatableFunction=t,this.firePropertyChange("rotatableFunction",e,t),this.invalidateSelectedElementUIs(!0)},isLinkable:function(t){return null==this._linkableFunction||this._linkableFunction(t)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(t){var e=this._linkableFunction;this._linkableFunction=t,this.firePropertyChange("linkableFunction",e,t),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getElementBox:function(){return this._box},setElementBox:function(t){if(!t)throw"ElementBox can not be null";if(this._box!==t){var e=this._box;e&&(e.removeDataBoxChangeListener(this.handleElementBoxChange,this),e.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),e.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),e.removeIndexChangeListener(this.handleIndexChange,this),e.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),e.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),e.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||e.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=t,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new De.QuickFinder(this._box,"link.flow","style")),this._selectionModel?this._selectionModel._setDataBox(t):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this.updateLayers(),this.invalidateElementVisibility(),this.firePropertyChange("elementBox",e,this._box)}},invalidateElementUI:function(t,e){var i=this.getElementUI(t);i&&i.invalidate(e)},invalidateElementUIs:function(t){for(var e in this._elementUIMap){var i=this._elementUIMap[e];i.invalidate(t)}},invalidateSelectedElementUIs:function(t){this.getSelectionModel().getSelection().forEach(function(e){this.invalidateElementUI(e,t)},this)},getElementUI:function(t){return t?this._elementUIMap[t.getId()]:null},getLayerDivByElement:function(t){var e=this._box.getLayerBox().getLayerByElement(t);return e?this._layerMap[e.getId()]:null},createElementUI:function(t){var e=this._elementUIMap[t.getId()];if(e||(e=this._elementUIFunction(this,t),e&&(this._elementUIMap[t.getId()]=e)),e){var i=this.getLayerDivByElement(t);e.getView().parentNode!==i&&(i.appendChild(e.getView()),e.getAttachments().forEach(function(t){t.isShowInAttachmentDiv()&&t.getView().parentNode!==this._attachmentDiv&&this._attachmentDiv.appendChild(t.getView())},this)),this.invalidateElementIndex()}},invalidateBundleLink:function(t){if(t instanceof De.Link&&t._bundleLinks){var e=this._elementUIMap;t._bundleLinks.forEachSiblingLink(function(i){if(i!==t){var n=e[i._id];n&&n.invalidate(!1)}},this)}},handleLayerBoxChange:function(t){this.updateLayers(),this.invalidateElementVisibility()},handleLayerPropertyChange:function(t){var e=t.source;if("visible"===t.property){var i=this._layerMap[e.getId()];je.setVisible(i,e.isVisible())}else"editable"===t.property&&this.invalidateSelectedElementUIs(!0);this.invalidateElementVisibility()},handleLayerHierarchyChange:function(t){var e;this._layerList.clear(),this._box.getLayerBox().forEachByDepthFirst(function(t){var i=this._layerMap[t.getId()];e=je.insertAfter(i,e),this._layerList.add(t)},null,this),this.invalidateElementVisibility()},handleSelectionChange:function(t){t.datas.forEach(function(e){var i=this.getElementUI(e);i&&i.handleSelectionChange(t)},this),this.invalidateElementVisibility();var e=this.getSelectionModel().getLastData();e&&("append"===t.kind||"set"===t.kind)&&(this.isMakeVisibleOnSelected()&&this.makeVisible(e),this.isSendToTopOnSelected()&&this.sendToTop(e))},makeVisible:function(t){var e=this.getElementUI(t);if(e){var i=xi.getSubNetwork(t);if(i!==this._currentSubNetwork){var n=this;return void this.setCurrentSubNetwork(i,this.isSubNetworkAnimate(),function(){Be.callLater(n.makeVisible,n,[t])})}for(var s=t;(s=s.getParent())&&s!==i;)s instanceof Vn&&s.setExpanded(!0);var r=e.getUnionBodyBounds();if(r){var a={x:this._view.scrollLeft/this._zoom,y:this._view.scrollTop/this._zoom,width:this._view.clientWidth/this._zoom,height:this._view.clientHeight/this._zoom};Ge.intersects(a,r)||this.isVisible(t)&&Be.callLater(this.centerByLogicalPoint,this,[r.x+r.width/2,r.y+r.height/2])}}},handleElementBoxChange:function(t){var e=t.data;if("add"===t.kind)this.createElementUI(e),this.invalidateBundleLink(e);else if("remove"===t.kind){var i=this.getElementUI(e);if(i){var n=this._box.getLayerBox().getLayerByElement(e),s=this._layerMap[n.getId()];i.getView().parentNode===s&&s.removeChild(i.getView()),i.dispose(),delete this._elementUIMap[e.getId()]}e===this._currentSubNetwork&&null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null)}else"clear"===t.kind&&(this.forEachElementUI(function(t){t.dispose()}),this._elementUIMap={},this.updateLayers(),null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null));this.invalidateElementVisibility()},handleElementPropertyChange:function(t){var e=t.source,i=this.getElementUI(e);if(i&&(i.handlePropertyChange(t),"layerId"===t.property)){var n=this._box.getLayerBox().getLayerByElement(e),s=this._layerMap[n.getId()];i.getView().parentNode!==s&&(s.appendChild(i.getView()),this.invalidateElementIndex())}this.invalidateBundleLink(e),this.invalidateElementVisibility()},handleElementBoxPropertyChange:function(t){this.invalidateElementVisibility()},handleIndexChange:function(t){this.invalidateElementIndex()},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(t){if(!t)throw"ElementUIFunction can not be null";if(this._elementUIFunction!==t){var e=this._elementUIFunction;this._elementUIFunction=t,this.firePropertyChange("elementUIFunction",e,t),this._box.isEmpty()||this.updateLayers()}},getIconsNames:function(t){return t.getStyle("icons.names")},getIconsColors:function(t){return t.getStyle("icons.colors")},getLinkHandlerLabel:function(t){return t.isBundleAgent()?"+("+t.getBundleCount()+")":null},getSelectColor:function(t){return t.getStyle("select.color")},getShadowColor:function(t){var e=t.getStyle("shadow.color");return!e&&this.isSelected(t)&&"shadow"===t.getStyle("select.style")?t.getStyle("select.color"):e},getAlarmLabel:function(t){var e=t.getAlarmState().getHighestNewAlarmSeverity();if(e){var i=t.getAlarmState().getNewAlarmCount(e)+e.nickName;return t.getAlarmState().hasLessSevereNewAlarms()&&(i+="+"),i}return null},isRemoveElementUIOnInvisible:function(){return this._removeElementUIOnInvisible},setRemoveElementUIOnInvisible:function(t){var e=this._removeElementUIOnInvisible;this._removeElementUIOnInvisible=t,this.firePropertyChange("removeElementUIOnInvisible",e,t),this.invalidateElementVisibility()},setDefaultInteractions:function(t,e){var i=[new De.network.interaction.SelectInteraction(this),new De.network.interaction.MoveInteraction(this,t),new De.network.interaction.DefaultInteraction(this)];e&&i.push(new De.network.interaction.MoveLinkInteraction(this,t)),this.setInteractions(i)},setPanInteractions:function(){this.setInteractions([new De.network.interaction.PanInteraction(this),new De.network.interaction.DefaultInteraction(this)])},setEditInteractions:function(t,e){var i=[new De.network.interaction.SelectInteraction(this),new De.network.interaction.EditInteraction(this,t),new De.network.interaction.MoveInteraction(this,t),new De.network.interaction.DefaultInteraction(this)];e&&i.push(new De.network.interaction.MoveLinkInteraction(this,t)),this.setInteractions(i)},setCreateElementInteractions:function(t){this.setInteractions([new De.network.interaction.CreateElementInteraction(this,t),new De.network.interaction.DefaultInteraction(this)])},setCreateLinkInteractions:function(t){this.setInteractions([new De.network.interaction.CreateLinkInteraction(this,t),new De.network.interaction.DefaultInteraction(this)])},setCreateShapeLinkInteractions:function(t){this.setInteractions([new De.network.interaction.CreateShapeLinkInteraction(this,t),new De.network.interaction.DefaultInteraction(this)])},setCreateShapeNodeInteractions:function(t){this.setInteractions([new De.network.interaction.CreateShapeNodeInteraction(this,t),new De.network.interaction.DefaultInteraction(this)])},setTouchInteractions:function(){var t=[new De.network.interaction.SelectInteraction(this),new De.network.interaction.MoveInteraction(this,(!1)),new De.network.interaction.DefaultInteraction(this),new De.network.interaction.TouchInteraction(this)];this.setInteractions(t)},setMSTouchInteractions:function(){this.setInteractions([new De.network.interaction.MSTouchInteraction(this)])},setMagnifyInteractions:function(){this.setInteractions([new De.network.interaction.SelectInteraction(this),new De.network.interaction.MoveInteraction(this),new De.network.interaction.DefaultInteraction(this),new De.network.interaction.MagnifyInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(t){var e=this._hasEditInteraction;this._hasEditInteraction=t,this.firePropertyChange("hasEditInteraction",e,t)},moveSelectedElements:function(t,e,i,n){if(0!==t||0!==e){var s=this.getMovableSelectedElementsRect();null!=s&&(this._limitElementInPositiveLocation&&(s.x+t<0&&(t=-s.x),s.y+e<0&&(e=-s.y)),De.Util.moveElements(this.getMovableSelectedElements(),t,e,i,n,this))}},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(t){return this.isMovable(t)},this)},hasMovableSelectedElements:function(){for(var t=this.getSelectionModel().getSelection(),e=0;e<t.size();e++){var i=t.get(e);if(this.isMovable(i))return!0}return!1},getMovableSelectedElementsRect:function(){var t=this.getMovableSelectedElements();if(0===t.size())return null;for(var e=null,i=0,n=t.size();n>i;i++){var s=t.get(i);if(s instanceof On){var r=this.getElementUI(s);r&&(e=Ge.unionRect(e,r.getViewRect()))}}return e},getLayerByElement:function(t){return this._box.getLayerBox().getLayerByElement(t)},getPosition:function(t,e,i,n,s){var r,a=e instanceof De.network.ElementUI?e:this.getElementUI(e);if(a)if("from"===t||"to"===t){if(a.getFromPosition&&(r="from"===t?a.getFromPosition(n,s):a.getToPosition(n,s)))return{x:r.x-i.width/2,y:r.y-i.height/2}}else r="hotspot"===t?a.getHotSpot():Ye.get(t,a.getBodyRect(),i);if(!r&&e.getRect&&(r=Ye.get(t,e.getRect(),i)),r)return{x:r.x+n,y:r.y+s};throw"position '"+t+"' object '"+e+"'"},getViewRect:function(){return this._viewRect?Be.clone(this._viewRect):{x:0,y:0,width:0,height:0}},forEachElementUI:function(t,e,i){e?this._box.forEachReverse(function(n){if(this.getLayerByElement(n)===e){var s=this.getElementUI(n);s&&(i?t.call(i,s):t(s))}},this):this._layerList.forEachReverse(function(e){this.forEachElementUI(t,e,i)},this)},findFirstElement:function(t,e){for(var i=this._layerList.size()-1,n=this._box.size()-1,s=i;s>=0;s--)for(var r=this._layerList.get(s),a=n;a>=0;a--){var o=this._box.getDataAt(a);if(this.getLayerByElement(o)===r)if(e){if(t.call(e,o)===!0)return o}else if(t(o)===!0)return o}return null},getElementAt:function(t,e){if(1===arguments.length&&(e=!0),!this.isValidEvent(t))return null;t=this._getPoint(t),t||console.log("null");var i=t.x,n=t.y,s=this._selectionTolerance;if(s&&s>0){var r={x:i,y:n,width:0,height:0};Ge.grow(r,s,s)}return this.findFirstElement(function(t){if(e&&!this.isSelectable(t))return!1;var s=this.getElementUI(t);return!!s&&(r?!!s.intersectsTest(r):!!s.hitTest(i,n))},this)},_getPoint:function(t){return t?t.target?this.getLogicalPoint(t):t:null},getElementsAtRect:function(t,i,n,s){var r=new gn;return s=s===e||s,this.forEachElementUI(function(e){e.isVisible()&&(!n||n(e._element))&&(s&&this.isSelectable(e._element)||!s)&&(i?e.intersectsTest(t)&&r.add(e._element):Ge.contains(t,e.getViewRect())&&r.add(e._element))},null,this),r},hitTest:function(t){var e=this.getElementAt(t);if(!e)return null;var i=this.getElementUI(e);return i?(t=this._getPoint(t),i.hitTest(t.x,t.y)):null},addElementByInteraction:function(t){t.getParent()||t.setParent(this._currentSubNetwork),this._box.add(t),this.getSelectionModel().setSelection(t),this.fireInteractionEvent({kind:"createElement",element:t})},getLinkFlowStepping:function(t){var e=parseInt(t.getStyle("link.flow.stepping"));return e||(e=kn.NETWORK_LINK_FLOW_STEPPING),e},getLinkFlowOffset:function(t){var e=t.getStyle("link.flow.offset");return isNaN(e)&&(e=0),e+this.getLinkFlowStepping(t)},toCanvas:function(t,e,i){i||(i=je.createCanvas()),i.setAttribute("width",t),i.setAttribute("height",e),i._viewRect?(i._viewRect.width=t,i._viewRect.height=e):i._viewRect={x:0,y:0,width:t,height:e};var n=i.getContext("2d");if(n.clearRect(0,0,t,e),0===this._view.clientWidth||0===this._view.clientHeight)return i;var s=t/this._view.scrollWidth*this._zoom,r=e/this._view.scrollHeight*this._zoom;return n.scale(s,r),je.forEach(this._view,function(t){if(("CANVAS"===t.tagName||"IMG"===t.tagName)&&!t._isIgnored){var e=t._viewRect;if(e)try{n.drawImage(t,e.x,e.y,e.width,e.height)}catch(t){}}}),i},toCanvasByRegion:function(t,e,i){i||(i=je.createCanvas());var n=t.width*e,s=t.height*e;i.setAttribute("width",n),i.setAttribute("height",s);var r=i.getContext("2d");return r.clearRect(0,0,n,s),0===this._view.clientWidth||0===this._view.clientHeight?i:(r.save(),r.scale(e,e),je.forEach(this._view,function(e){if(("CANVAS"===e.tagName||"IMG"===e.tagName)&&!e._isIgnored){var i=e._viewRect;if(i&&Ge.intersects(i,t))try{r.drawImage(e,i.x-t.x,i.y-t.y,i.width,i.height)}catch(e){}}}),r.restore(),i)},getGroupChildrenRects:function(t){var e=new gn;return t.getChildren().forEach(function(t){if(t instanceof On){var i=this.getElementUI(t);if(i){var n=i.getViewRect();n&&e.add(n)}}},this),e},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(t){var e=this._linkPathFunction;this._linkPathFunction=t,this.firePropertyChange("linkPathFunction",e,t),this.invalidateElementUIs()},onClickElement:function(t,e){},onClickBackground:function(t){},onDoubleClickElement:function(t,e){},onDoubleClickBackground:function(t){},onLongClickElement:function(t,e){},onLongClickBackground:function(t){},onMouseMove:function(t,e){},onMouseEnter:function(t,e){},onMouseLeave:function(t,e){},setMovingElement:function(t){if(t!=this._movingElement){var e=this._movingElement;this._movingElement=t,this.firePropertyChange("movingElement",e,t),this._box._undoManager._enabled&&(t?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},setEditingElement:function(t){if(t!=this._editingElement){var e=this._editingElement;this._editingElement=t,this.firePropertyChange("editingElement",e,t),this._box._undoManager._enabled&&(t?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},dispose:function(){De.imageUtil.removeEventListener(this.invalidateElementUIs,this)}}),De.network.Overview=function(t){De.network.Overview.superClass.constructor.apply(this,arguments),this._view=je.createView(),this._rootDiv=je.createDiv(),this._imageCanvas=je.createCanvas(),this._imageDiv=je.createDiv(),this._maskCanvas=je.createCanvas(),this._selectDiv=je.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,je.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this.setNetwork(t),He.isTouchable?He.isMSTouchable?new De.network.OverviewMSTouchInteraction(this):(new De.network.OverviewTouchInteraction(this),new De.network.OverviewInteraction(this)):new De.network.OverviewInteraction(this)},Be.ext("twaver.network.Overview",De.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:kn.OVERVIEW_FILL_COLOR,_outlineColor:kn.OVERVIEW_OUTLINE_COLOR,_outlineWidth:kn.OVERVIEW_OUTLINE_WIDTH,_selectColor:kn.OVERVIEW_SELECT_COLOR,_selectWidth:kn.OVERVIEW_SELECT_WIDTH,_padding:kn.OVERVIEW_PADDING,_animate:kn.OVERVIEW_ANIMATE,_maxPackingWidth:kn.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:kn.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(t){this._invalidateMask()},setNetwork:function(t){t!==this._network&&(this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),je.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=t,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),je.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate())},_handleNetworkPropertyChange:function(t){("zoom"===t.property||"currentSubNetwork"===t.property||"elementBox"===t.property||"dataBox"===t.property)&&this.invalidate()},_handleNetworkViewChange:function(t){"validateEnd"===t.kind&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(t){this._isNetworkDirty&&this._isMaskDirty||(this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),Be.callLater(this.validate,this,null,t))},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,Be.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&0!==this._network._view.clientWidth&&0!==this._network._view.clientHeight){var t,e=this._maxPackingWidth>0&&this._maxPackingHeight>0;t=e?{x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:{x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},Ge.grow(t,-this._padding,-this._padding);var i=Math.min(t.width/this._network._view.scrollWidth,t.height/this._network._view.scrollHeight);e&&(je.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),t.width=this._imageDiv._viewRect.width,t.height=this._imageDiv._viewRect.height);var n=this._network._view.scrollWidth*i,s=this._network._view.scrollHeight*i,r=t.x+(t.width-n)/2,a=t.y+(t.height-s)/2;if(this._isNetworkDirty){var o={x:r,y:a,width:n,height:s};this._network.toCanvas(o.width,o.height,this._imageCanvas),je.setDiv(this._imageDiv,o,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var h={x:this._network._view.scrollLeft*i,y:this._network._view.scrollTop*i,width:n*this._network._view.clientWidth/this._network._view.scrollWidth,height:s*this._network._view.clientHeight/this._network._view.scrollHeight},l=je.setCanvas(this._maskCanvas,r,a,n,s);l.lineWidth=0,l.fillStyle=this._fillColor,l.beginPath(),qe.drawVector(l,"rectangle",null,r,a,n,s),l.fill(),l.clearRect(r+h.x,a+h.y,h.width,h.height);var c=this._outlineWidth<0?0:this._outlineWidth;l.lineWidth=c,l.strokeStyle=this._outlineColor,l.beginPath(),qe.drawVector(l,"rectangle",null,r+h.x+c,a+h.y+c,h.width-2*c,h.height-2*c),c>=0&&l.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(t){return je.getLogicalPoint(this._view,t,1,this._rootDiv)},centerNetwork:function(t,e){var i=this._imageDiv._viewRect;Ge.containsPoint(i,t)&&(this._network.centerByLogicalPoint((t.x-i.x)/i.width*this._network._view.scrollWidth/this._network.getZoom(),(t.y-i.y)/i.height*this._network._view.scrollHeight/this._network.getZoom(),e),this._invalidateMask())}}),De.network.OverviewTouchInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,je.addEventListener("touchstart","handleTouchstart",this.view,this)},Be.ext("twaver.network.OverviewTouchInteraction",Object,{handleTouchstart:function(t){je.preventDefault(t),this.clear(),this.endPoint=this.overview.getLogicalPoint(t),Ci.isMultiTouch(t)&&(this.distance=Ci.getDistance(t),this.zoom=this.network.getZoom()),je.addEventListener("touchmove","handleTouchmove",this.view,this),je.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(t){if(je.preventDefault(t),this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(t),Ci.isSingleTouch(t))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var e=Ci.getDistance(t)/this.distance;this.network.setZoom(this.zoom*e,!1)}},handleTouchend:function(t){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(t);var e=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;e?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),e?Be.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,je.removeEventListener("touchmove",this.view,this),je.removeEventListener("touchend",this.view,this)),this.moved=!1}}),De.network.OverviewInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,je.addEventListener("mousedown","handleMousedown",this.view,this)},Be.ext("twaver.network.OverviewInteraction",Object,{handleMousedown:function(t){0===t.button&&(this.clear(),this.endPoint=this.overview.getLogicalPoint(t),Be.isCtrlDown(t)&&(this.startPoint=this.endPoint,je.setVisible(this.overview._selectDiv,!0)),je.addEventListener("mousemove","handleMousemove",this.view,this),je.addEventListener("mouseup","handleMouseup",this.view,this))},handleMouseup:function(t){if(this.endPoint=this.overview.getLogicalPoint(t),"detail"in t&&2===t.detail)Be.callLater(this.network.zoomReset,this.network,[this.overview._animate]);else if(je.isVisible(this.overview._selectDiv)&&this.startPoint){var e=this.overview._imageDiv._viewRect,i=this.overview._selectDiv._viewRect.x,n=this.overview._selectDiv._viewRect.y,s=e.width/this.overview._selectDiv._viewRect.width,r=e.height/this.overview._selectDiv._viewRect.height,a=Math.min(s,r),o=this.network._view.scrollWidth/this.network.getZoom()*((i-e.x+this.overview._selectDiv._viewRect.width/2)/e.width),h=this.network._view.scrollHeight/this.network.getZoom()*((n-e.y+this.overview._selectDiv._viewRect.height/2)/e.height);this.network.setZoom(a*Math.min(this.network._view.clientWidth/this.network._view.scrollWidth,this.network._view.clientHeight/this.network._view.scrollHeight)*this.network.getZoom(),!1),Be.callLater(this.network.centerByLogicalPoint,this.network,[o,h,this.overview._animate]),je.setVisible(this.overview._selectDiv,!1),je.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(t){var e=this.overview.getLogicalPoint(t);if(this.endPoint=e,je.isVisible(this.overview._selectDiv)&&this.startPoint){var i=e.x>this.startPoint.x?this.startPoint.x:e.x,n=e.x>this.startPoint.x?this.startPoint.y:e.y;e.x>this.startPoint.x&&e.y<this.startPoint.y&&(n=e.y),e.x<this.startPoint.x&&e.y>this.startPoint.y&&(n=this.startPoint.y);var s=this.overview._imageDiv._viewRect;i<s.x&&(i=s.x),i>s.x+s.width&&(i=s.x+s.width),n<s.y&&(n=s.y),n>s.y+s.height&&(n=s.y+s.height);var r=Math.abs(e.x-this.startPoint.x),a=Math.abs(e.y-this.startPoint.y);i+r>s.x+s.width&&(r=s.x+s.width-i),n+a>s.y+s.height&&(a=s.y+s.height-n),je.setDiv(this.overview._selectDiv,{x:i,y:n,width:r,height:a},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(e,!1)},clear:function(){this.endPoint&&(this.endPoint=null,je.removeEventListener("mousemove",this.view,this),je.removeEventListener("mouseup",this.view,this))}}),De.network.OverviewMSTouchInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,this._pointerMap={},this._pointerIdArray=[],je.addEventListener("MSPointerDown","handleTouchstart",this.view,this),je.addEventListener("MSPointerMove","handleTouchmove",this.view,this),je.addEventListener("MSPointerUp","handleTouchend",this.view,this),je.addEventListener("MSPointerCancel","handleTouchend",this.view,this)},Be.ext("twaver.network.OverviewMSTouchInteraction",Object,{handleTouchstart:function(t){je.preventDefault(t),t.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[t.pointerId]&&this.overview.getLogicalPoint(t)&&(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t),1==this._pointerIdArray.length?(this._startTouchPoint=this.overview.getLogicalPoint(t),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),
this._zoom=this.network.getZoom())},handleTouchmove:function(t){if(0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(Ge.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=10))if(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length){var e=this._getDistance()/this._distance;this.network.setZoom(this._zoom*e,!1)}else if(1==this._pointerIdArray.length&&this._startTouchPoint){var i=this.overview.getLogicalPoint(t);if(null==i)return;this._startTouchPoint=i,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(t){var e=this.overview.getLogicalPoint(t);if(1==this._pointerIdArray.length&&e){var i=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&Ge.getDistance(this._endTouchPoint,e)<=10;i?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=e,this._endTouchTime=new Date),i?Be.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Ge.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),De.network.ElementUI=function(t,e){this._view=je.createDiv(),this._bodyView=je.createDiv(),this._view.appendChild(this._bodyView),this._network=t,this._element=e,this._attachments=new gn,this._bodyBounds=new gn,this.invalidate(!0)},Be.ext("twaver.network.ElementUI",Object,{_invalidateFlag:!1,_invalidateAttachmentsFlag:!1,getElement:function(){return this._element},getNetwork:function(){return this._network},getAttachments:function(){return this._attachments},getStyle:function(t){return this._element.getStyle(t)},getFont:function(t){var e=this._element.getStyle(t);return e?e:kn.FONT},getDyeColor:function(t){return this._innerColor?this._innerColor:this.getStyle(t)},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},getHotSpot:function(){return this._hotSpot?Be.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(t){this._hotSpot=t},getUnionBodyBounds:function(){return Be.clone(this._unionBodyBounds)},getBodyRect:function(){return this._bodyRect||(this._bodyRect=this.createBodyRect()),Be.clone(this._bodyRect)},invalidate:function(t){t===e&&(t=!0),t&&(this._invalidateAttachmentsFlag=!0),this._invalidateFlag||(this._bodyRect=null,this._invalidateFlag=!0,this._network.invalidateElementVisibility())},updateMeasure:function(){},validate:function(){if(this._invalidateFlag){this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this._bodyBounds.clear(),je.clear(this._bodyView),this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this.updateMeasure();var t=this._element.getStyle("whole.alpha");this._view.style.opacity=t,this._attachments.forEach(function(e){e.updateMeasure();var i=e.getAlpha();e._view.style.opacity=e.isShowInAttachmentDiv()?i*t:i});var e;this._bodyBounds.forEach(function(t){e=Ge.unionRect(e,t)}),this._unionBodyBounds=Be.clone(e),this._attachments.forEach(function(t){e=Ge.unionRect(e,t.getViewRect())}),this._viewRect=e}},cleanUp:function(t){for(var e=t.length,i=0;e>i;i++){var n=t[i],s=this[n];s&&!s.parentNode&&(this[n]=null)}},setVisible:function(t){this.isVisible()!==t&&(je.setVisible(this._view,t),this._attachments.forEach(function(e){e.isShowInAttachmentDiv()&&je.setVisible(e._view,t)}),this.invalidate(!0))},isVisible:function(){return je.isVisible(this._view)},checkAttachments:function(){this.checkLabelAttachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var t=this._network.getLabel(this._element);null!=t&&""!==t?this._labelAttachment||(this._labelAttachment=new De.network.LabelAttachment(this,kn.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var t=this._network.getAlarmLabel(this._element);null!=t&&""!==t?this._alarmAttachment||(this._alarmAttachment=new De.network.AlarmAttachment(this,kn.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var t=this._network.getIconsNames(this._element);t&&t.length>0?this._iconsAttachment||(this._iconsAttachment=new De.network.IconsAttachment(this),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this.isEditable()&&this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)?this._editAttachment||(this._editAttachment=new De.network.EditAttachment(this),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},isEditable:function(){return!0},handlePropertyChange:function(t){this.invalidate(!0)},handleSelectionChange:function(t){this.invalidate(!0)},dispose:function(){this._attachments.forEach(function(t){t.getView().parentNode&&t.getView().parentNode.removeChild(t.getView()),t.dispose()}),this._attachments.clear()},addAttachment:function(t){this._attachments.add(t),t.isShowInAttachmentDiv()?this._network.getAttachmentDiv().appendChild(t.getView()):this._view.appendChild(t.getView()),this.invalidate(!1)},removeAttachment:function(t){this._attachments.remove(t),t.getView().parentNode&&t.getView().parentNode.removeChild(t.getView()),t.dispose(),this.invalidate(!1)},addBodyBounds:function(t){t&&this._bodyBounds.add(t)},addComponent:function(t){this._bodyView.appendChild(t)},getBodyView:function(){return this._bodyView},getView:function(){return this._view},getViewRect:function(){return Be.clone(this._viewRect)},setShadow:function(t,e,i){var n=t.isShadowable()&&this._shadowColor&&!this._editAttachment;n&&(this._shadowXOffset>0?i.width+=this._shadowXOffset:(i.x+=this._shadowXOffset,i.width+=-this._shadowXOffset),this._shadowYOffset>0?i.height+=this._shadowYOffset:(i.y+=this._shadowYOffset,i.height+=-this._shadowYOffset),Ge.grow(i,this._shadowBlur,this._shadowBlur));var s=je.setCanvas(e,i);return n&&(s.shadowOffsetX=this._shadowXOffset,s.shadowOffsetY=this._shadowYOffset,s.shadowBlur=this._shadowBlur,s.shadowColor=this._shadowColor),s},isShadowable:function(){return!(!this._shadowColor||!this._network.isSelected(this._element)||"shadow"!==this._element.getStyle("select.style"))},hit:function(t,e){return!1},hitCanvas:function(t,e,i){for(var n=i.length,s=0;n>s;s++){var r=i[s],a=this[r];if(qe.hit(a,t,e,this._network.getSelectionTolerance()))return!0}return!1},hitComponent:function(t,e,i){for(var n=i.length,s=0;n>s;s++){var r=i[s],a=this[r];if(a&&Ge.containsPoint(a._viewRect,t,e))return!0}return!1},hitTest:function(t,e){if(!this.isVisible()||!Ge.containsPoint(this._viewRect,t,e))return null;var i,n,s=this._attachments.size();for(i=s-1;i>=0;i--)if(n=this._attachments.get(i),n.isShowInAttachmentDiv()&&n.hit(t,e))return n;for(i=s-1;i>=0;i--)if(n=this._attachments.get(i),!n.isShowInAttachmentDiv()&&n.hit(t,e))return n;return Ge.containsPoint(this._unionBodyBounds,t,e)&&this.hit(t,e)?this:null},intersects:function(t){return!1},intersectsComponent:function(t,e){for(var i=e.length,n=0;i>n;n++){var s=e[n],r=this[s];if(r&&Ge.intersects(r._viewRect,t))return!0}return!1},intersectsCanvas:function(t,e){for(var i=e.length,n=0;i>n;n++){var s=e[n],r=this[s];if(qe.intersects(r,t))return!0}return!1},intersectsTest:function(t){if(!this.isVisible()||!Ge.intersects(this._viewRect,t))return null;var e,i,n=this._attachments.size();for(e=n-1;e>=0;e--)if(i=this._attachments.get(e),i.isShowInAttachmentDiv()&&i.intersects(t))return i;for(e=n-1;e>=0;e--)if(i=this._attachments.get(e),!i.isShowInAttachmentDiv()&&i.intersects(t))return i;return Ge.intersects(this._unionBodyBounds,t)&&this.intersects(t)?this:null}}),De.network.Attachment=function(t,e){this._view=je.createDiv(),this._ui=t,this._element=this._ui.getElement(),this._network=t.getNetwork(),this._isShowInAttachmentDiv=e===!0,this._isShowInAttachmentDiv&&je.setVisible(this._view,t.isVisible())},Be.ext("twaver.network.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},getStyle:function(t){return this._ui.getStyle(t)},getFont:function(t){return this._ui.getFont(t)},isShowInAttachmentDiv:function(){return this._isShowInAttachmentDiv},getView:function(){return this._view},getViewRect:function(){return Be.clone(this._viewRect)},getAlpha:function(){return 1},updateMeasure:function(){},dispose:function(){},hit:function(t,e){return Ge.containsPoint(this._viewRect,t,e)},intersects:function(t){return Ge.intersects(this._viewRect,t)}}),De.network.BasicAttachment=function(t,e){De.network.BasicAttachment.superClass.constructor.call(this,t,e),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0},this._attachmentCanvas=je.createCanvas(),this._view.insertBefore(this._attachmentCanvas,this._view.firstChild)},Be.ext("twaver.network.BasicAttachment",De.network.Attachment,{calculateMeasure:function(){var t=this.getContentWidth(),e=this.getContentHeight(),i=this.getCornerRadius(),n=this.getPointerLength(),s=this.getPointerWidth(),r=this.getPosition(),a=this.getXOffset(),o=this.getYOffset(),h=this._roundRect;h.width=t+2*i,h.height=e;var l;if(n>0){var c=this.getDirection();l=this._network.getPosition(r,this._ui,null,a,o);var u;if("aboveleft"===c)h.y=l.y-n-h.height,h.x=l.x-(h.width-i),u=Math.max(l.x-s,h.x+i/2),this._pointers=[l,{x:l.x,y:l.y-n},{x:u,y:l.y-n}];else if("aboveright"===c)h.y=l.y-n-h.height,h.x=l.x-i,u=Math.min(l.x+s,h.x+h.width-i/2),this._pointers=[l,{x:l.x,y:l.y-n},{x:u,y:l.y-n}];else if("belowleft"===c)h.y=l.y+n,h.x=l.x-(h.width-i),u=Math.max(l.x-s,h.x+i/2),this._pointers=[l,{x:l.x,y:l.y+n},{x:u,y:l.y+n}];else if("belowright"===c)h.y=l.y+n,h.x=l.x-i,u=Math.min(l.x+s,h.x+h.width-i/2),this._pointers=[l,{x:l.x,y:l.y+n},{x:u,y:l.y+n}];else if("leftabove"===c)h.y=l.y+i-h.height,h.x=l.x-n-h.width,u=Math.max(l.y-s,h.y+i/2),this._pointers=[l,{x:l.x-n,y:l.y},{x:l.x-n,y:u}];else if("leftbelow"===c)h.y=l.y-i,h.x=l.x-n-h.width,u=Math.min(l.y+s,h.y+h.height-i/2),this._pointers=[l,{x:l.x-n,y:l.y},{x:l.x-n,y:u}];else if("rightabove"===c)h.y=l.y+i-h.height,h.x=l.x+n,u=Math.max(l.y-s,h.y+i/2),this._pointers=[l,{x:l.x+n,y:l.y},{x:l.x+n,y:u}];else if("rightbelow"===c)h.y=l.y-i,h.x=l.x+n,u=Math.min(l.y+s,h.y+h.height-i/2),this._pointers=[l,{x:l.x+n,y:l.y},{x:l.x+n,y:u}];else if("above"===c)h.y=l.y-n-h.height,h.x=l.x-h.width/2,u=Math.min(t/2,s/2),this._pointers=[l,{x:l.x-u,y:l.y-n},{x:l.x+u,y:l.y-n}];else if("below"===c)h.y=l.y+n,h.x=l.x-h.width/2,u=Math.min(t/2,s/2),this._pointers=[l,{x:l.x-u,y:l.y+n},{x:l.x+u,y:l.y+n}];else if("left"===c)h.y=l.y-h.height/2,h.x=l.x-n-h.width,u=Math.min(e/2,s/2),this._pointers=[l,{x:l.x-n,y:l.y+u},{x:l.x-n,y:l.y-u}];else{if("right"!==c)throw"Can not resolve '"+c+"' attachment direction";h.y=l.y-h.height/2,h.x=l.x+n,u=Math.min(e/2,s/2),this._pointers=[l,{x:l.x+n,y:l.y+u},{x:l.x+n,y:l.y-u}]}}else l=this._network.getPosition(r,this._ui,{width:h.width,height:h.height},a,o),h.x=l.x,h.y=l.y,this._pointers=null;this._contentRect.x=h.x+(h.width-t)/2,this._contentRect.y=h.y+(h.height-e)/2,this._contentRect.width=t,this._contentRect.height=e;var d=this.getPadding();0!=d&&Ge.grow(h,d,d),d=this.getPaddingLeft(),0!=d&&(h.x-=d,h.width+=d),d=this.getPaddingRight(),0!=d&&(h.width+=d),d=this.getPaddingTop(),0!=d&&(h.y-=d,h.height+=d),d=this.getPaddingBottom(),0!=d&&(h.height+=d),h.width<0&&(h.width=h.width,h.x-=h.width),h.height<0&&(h.height=-h.height,h.y-=h.height)},updateMeasure:function(){De.network.BasicAttachment.superClass.updateMeasure.call(this),this.calculateMeasure();var t=this.isFill(),e=this.getOutlineWidth();this._viewRect=Ge.getRect(this._pointers),this._viewRect=Ge.unionRect(this._viewRect,this._roundRect),e>0&&Ge.grow(this._viewRect,e/2,e/2);var i=this._ui.setShadow(this,this._attachmentCanvas,this._viewRect);if((e>0||t)&&(i.beginPath(),qe.drawRoundRect(i,this._roundRect.x,this._roundRect.y,this._roundRect.width,this._roundRect.height,this.getCornerRadius()),this._pointers&&(i.moveTo(this._pointers[0].x,this._pointers[0].y),i.lineTo(this._pointers[1].x,this._pointers[1].y),i.lineTo(this._pointers[2].x,this._pointers[2].y)),i.closePath(),e>0&&(i.lineWidth=e,i.strokeStyle=this.getOutlineColor(),i.lineCap=this.getCap(),i.lineJoin=this.getJoin(),i.stroke()),t)){var n=this.getFillColor(),s=this.getGradient();s?qe.fill(i,n,s,this.getGradientColor(),this._viewRect):i.fillStyle=n,i.fill()}return i},getRoundRect:function(){return Be.clone(this._roundRect)},getContentRect:function(){return Be.clone(this._contentRect)},getContent:function(){return this._content},setContent:function(t){this._content!==t&&(this._content&&this._view.removeChild(this._content),this._content=t,t&&this._view.appendChild(t))},getContentWidth:function(){return kn.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return kn.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return kn.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return kn.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return kn.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return kn.ATTACHMENT_POSITION},getXOffset:function(){return kn.ATTACHMENT_XOFFSET},getYOffset:function(){return kn.ATTACHMENT_YOFFSET},getPadding:function(){return kn.ATTACHMENT_PADDING},getPaddingLeft:function(){return kn.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return kn.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return kn.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return kn.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return kn.ATTACHMENT_DIRECTION},isFill:function(){return kn.ATTACHMENT_FILL},getFillColor:function(){return kn.ATTACHMENT_FILL_COLOR},getGradient:function(){return kn.ATTACHMENT_GRADIENT},getGradientColor:function(){return kn.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return kn.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return kn.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return kn.ATTACHMENT_CAP},getJoin:function(){return kn.ATTACHMENT_JOIN},isShadowable:function(){return kn.ATTACHMENT_SHADOWABLE},hit:function(t,e){return!!Ge.containsPoint(this._viewRect,t,e)&&(!!Ge.containsPoint(this._contentRect,t,e)||qe.hit(this._attachmentCanvas,t,e))},intersects:function(t){return!!Ge.intersects(this._viewRect,t)&&(!!Ge.intersects(this._contentRect,t)||qe.intersects(this._attachmentCanvas,t))}}),De.network.LabelAttachment=function(t,e){De.network.LabelAttachment.superClass.constructor.call(this,t,e)},Be.ext("twaver.network.LabelAttachment",De.network.BasicAttachment,{updateMeasure:function(){var t,e=this.getFont("label.font"),i=this.getLabel(),n=Be.g.getTextSize(e,i),s=this.getMaxLength();0!==s&&n.width>s?(t=Be.g.getCollapseTextInLength(e,i,s),this._textSize=Be.g.getTextSize(e,t)):(t=i,this._textSize=n);var r=De.network.LabelAttachment.superClass.updateMeasure.call(this),a=this._element.getStyle("label.align");qe.drawText(r,t,this._contentRect,e,this.getStyle("label.color"),a)},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},getMaxLength:function(){return this.getStyle("label.maxlength")},isShadowable:function(){return this.getStyle("label.shadowable")}}),De.network.AlarmAttachment=function(t,e){De.network.AlarmAttachment.superClass.constructor.call(this,t,e)},Be.ext("twaver.network.AlarmAttachment",De.network.BasicAttachment,{updateMeasure:function(){var t=this.getFont("alarm.font"),e=this._network.getAlarmLabel(this._element);this._textSize=qe.getTextSize(t,e),this._fillColor=this._network.getAlarmFillColor(this._element);var i=De.network.AlarmAttachment.superClass.updateMeasure.call(this);qe.drawText(i,e,this._contentRect,t,this.getStyle("alarm.color"))},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return null!=this._fillColor},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),De.network.LinkHandlerAttachment=function(t,e){De.network.LinkHandlerAttachment.superClass.constructor.call(this,t,e)},Be.ext("twaver.network.LinkHandlerAttachment",De.network.BasicAttachment,{updateMeasure:function(){var t=this.getFont("link.handler.font"),e=this._network.getLinkHandlerLabel(this._element);this._textSize=qe.getTextSize(t,e);var i=De.network.LabelAttachment.superClass.updateMeasure.call(this);qe.drawText(i,e,this._contentRect,t,this.getStyle("link.handler.color"))},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),De.network.EditAttachment=function(t,e){De.network.EditAttachment.superClass.constructor.call(this,t,e),this._attachmentDiv=je.createDiv(),this._view.appendChild(this._attachmentDiv)},Be.ext("twaver.network.EditAttachment",De.network.Attachment,{updateMeasure:function(){De.network.EditAttachment.superClass.updateMeasure.call(this),this._viewRect=null,this._element instanceof On&&this._addResizingPoint(this._element),!(this._network.isRotatable(this._element)&&this._element instanceof On)||this._element instanceof De.ShapeNode||this._element instanceof De.Grid||this._element instanceof De.Group||this._addRotatePoint(this._element),this._element instanceof De.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof De.network.ShapeLinkUI&&this._addShapeLinkPoints(this._ui),this._ui instanceof De.network.LinkUI&&this._addLinkControlPoint(this._ui)},_addRotatePoint:function(t){var e=this._network.getRotatePointSize();if(!(0>=e)){var i=t.getOriginalRect();if(!this._rotateDiv){var n=je.createDiv();this._attachmentDiv.appendChild(n),this._rotateDiv=n}var s,r=this._network.getRotatePointOutlineWidth(),a=this._network.getRotatePointOutlineColor(),o=this._network.getRotatePointFillColor(),e=this._network.getRotatePointSize(),h=2*e,l={x:i.x+i.width/2-e,y:i.y-this._network.getRotatePointOffset()-h,width:h,height:h};s=0==t.angle?l:this._getRotateRect(l,t.getAngle(),{x:i.x+i.width/2,y:i.y+i.height/2});var c=Ge.unionRect(t.getRect(),s);this._viewRect=Ge.unionRect(c,this._viewRect),je.setDiv(this._rotateDiv,l,o,r,a),this._rotateDiv._viewRect=s,je.setBorderRaidus(this._rotateDiv,h+"px"),this._rotateAttachments(this._rotateDiv,h/2,r)}},_addResizingPoint:function(t){var e=this._network.getResizePointSize();if(!(0>=e)){var i=t.getOriginalRect(),n=new gn([{x:i.x,y:i.y},{x:i.x+i.width/2,y:i.y},{x:i.x+i.width,y:i.y},{x:i.x,y:i.y+i.height/2},{x:i.x+i.width,y:i.y+i.height/2},{x:i.x,y:i.y+i.height},{x:i.x+i.width/2,y:i.y+i.height},{x:i.x+i.width,y:i.y+i.height}]);if(!this._resizeDivs){this._resizeDivs=new Array;for(var s=0;8>s;s++){var r=je.createDiv();this._attachmentDiv.appendChild(r),this._resizeDivs[s]=r}}if(this._resizeDivs){this._resizeRects=new Array;for(var s=0;8>s;s++){var a,o=n.get(s),h={x:o.x-e,y:o.y-e,width:2*e,height:2*e};a=0==t.getAngle()?h:this._getRotateRect(h,t.getAngle(),{x:i.x+i.width/2,y:i.y+i.height/2}),this._resizeRects[s]=a}}var l=this._network.getResizePointOutlineWidth(),c=this._network.getResizePointOutlineColor(),u=this._network.getResizePointFillColor();this._addPoints(t.getRect(),n,l,c,u,!0)}},_addPoints:function(t,e,i,n,s,r){var a=r?this._network.getResizePointSize():this._network.getEditPointSize();if(!(0>=a)){var o=a+i;Ge.grow(t,o,o),this._viewRect=Ge.unionRect(t,this._viewRect);var h,l,c,u,d=2*a,f=new gn;for(h=0,l=e.size();l>h;h++)c=e.get(h),u={x:c.x-a,y:c.y-a,width:d,height:d},f.add(u);var g;if(r)g=this._resizeDivs;else{if(this._controlDivs||(this._controlDivs=new Array),this._controlDivs.length<l)for(h=this._controlDivs.length;l>h;h++){var _=je.createDiv();this._attachmentDiv.appendChild(_),this._controlDivs[h]=_}else if(this._controlDivs.length>l){for(h=l;h<this._controlDivs.length;h++)this._attachmentDiv.removeChild(this._controlDivs[h]);this._controlDivs.splice(l)}g=this._controlDivs}for(h=0,l=f.size();l>h;h++)u=f.get(h),je.setDiv(g[h],u,s,i,n),je.setBorderRaidus(g[h],(r?"0":d)+"px"),this._rotateAttachments(g[h],d/2,i,e.get(h))}},_rotateAttachments:function(t,e,i,n){if(this._element instanceof On){var s=this._element.getAngle();if(0==s)return;var r=this._element.getOriginalRect(),a=t.style.left.split("px")[0],o=t.style.top.split("px")[0];r.x+r.width/2,r.y+r.height/2,n||(n={x:parseFloat(a)+e+i,y:parseFloat(o)+e+i});var h=Ge.createMatrix(s*Math.PI/180,r.x+r.width/2,r.y+r.height/2),l=h.transform(n);t.style.webkitTransform="rotate("+s+"deg)",t.style.mozTransform="rotate("+s+"deg)",t.style.OTransform="rotate("+s+"deg)",t.style.msTransform="rotate("+s+"deg)",t.style.transform="rotate("+s+"deg)",t.style.left=l.x-e-i+"px",t.style.top=l.y-e-i+"px"}},_addShapeLinkPoints:function(t){this._addEditPoints(t._element.getPoints())},_addShapeNodePoint:function(t){this._addEditPoints(t.getPoints())},_addLinkControlPoint:function(t){if(bi.isOrthogonalLink(t._element)){var e=t.getControlPoint();if(e){var i=new gn;i.add(e),this._addEditPoints(i)}}},_addEditPoints:function(t){var e=Ge.getRect(t);if(e){var i=this._network.getEditPointOutlineWidth(),n=this._network.getEditPointOutlineColor(),s=this._network.getEditPointFillColor();this._addPoints(e,t,i,n,s,!1)}},hit:function(t,e){if(!Ge.containsPoint(this._viewRect,t,e))return!1;var i;if(this._resizeDivs)for(i=this._resizeDivs.length-1;i>=0;i--)if(Ge.containsPoint(this._resizeRects[i],t,e))return!0;if(this._rotateDiv&&Ge.containsPoint(this._rotateDiv._viewRect,t,e))return!0;if(this._controlDivs)for(i=this._controlDivs.length-1;i>=0;i--)if(Ge.containsPoint(this._controlDivs[i]._viewRect,t,e))return!0;return!1},intersects:function(t){if(!Ge.intersects(this._viewRect,t))return!1;var e;if(this._resizeDivs)for(e=this._resizeDivs.length-1;e>=0;e--)if(Ge.intersects(this._resizeRects[e],t))return!0;if(this._rotateDiv&&Ge.containsPoint(this._rotateDiv._viewRect,t))return!0;if(this._controlDivs)for(e=this._controlDivs.length-1;e>=0;e--)if(Ge.intersects(this._controlDivs[e]._viewRect,t))return!0;return Ge.intersects(this._viewRect,t),!1},_getRotateRect:function(t,e,i){var n=Ge.createMatrix(e*Math.PI/180,i.x,i.y),s={x:t.x+t.width/2,y:t.y+t.height/2},r=n.transform(s),a=new De.List([{x:r.x-t.width/2,y:r.y-t.height/2},{x:r.x+t.width/2,y:r.y-t.height/2},{x:r.x+t.width/2,y:r.y+t.height/2},{x:r.x-t.width/2,y:r.y+t.height/2}]);return Ge.getRect(a)}}),De.network.IconsAttachment=function(t,e){De.network.IconsAttachment.superClass.constructor.call(this,t,e),this._iconsCanvas=null},Be.ext("twaver.network.IconsAttachment",De.network.Attachment,{isShadowable:function(){return kn.ATTACHMENT_SHADOWABLE},updateMeasure:function(){De.network.IconsAttachment.superClass.updateMeasure.call(this);var t=this._network.getIconsNames(this._element);if(t&&0!=t.length){var e=this._network.getIconsColors(this._element),i=this._element.getStyle("icons.orientation"),n=this._element.getStyle("icons.position"),s=this._element.getStyle("icons.xoffset");s=s instanceof Array?s[0]:s;var r=this._element.getStyle("icons.yoffset");r=r instanceof Array?r[0]:r;var a=this._element.getStyle("icons.xgap");a=a instanceof Array?a[0]:a;var o=this._element.getStyle("icons.ygap");o=o instanceof Array?o[0]:o;var h=this._getIconsSize(t,i,a,o);if(h){var l=this._network.getPosition(n,this._ui,h,s,r);this._viewRect={x:l.x,y:l.y,width:h.width,height:h.height},"top"===i?l.y+=h.height:"left"===i&&(l.x+=h.width),this._iconsCanvas||(this._iconsCanvas=je.createCanvas(),this._view.appendChild(this._iconsCanvas));var c=this._ui.setShadow(this,this._iconsCanvas,Be.clone(this._viewRect)),u=l.x,d=l.y,f=0;for(var g in t){var _=null,p=null;e&&e.length>f&&(p=e[f++]);var v=Be.getImageAsset(t[g]);if(null!=v){if("right"===i)_={x:u,y:d,width:v.getWidth(),height:v.getHeight()},u+=_.width+a;else if("left"===i)_={x:u-v.getWidth(),y:d,width:v.getWidth(),height:v.getHeight()},u-=_.width+a;else if("top"===i)_={x:u,y:d-v.getHeight(),width:v.getWidth(),height:v.getHeight()},d-=_.height+o;else{if("bottom"!==i)throw"Can not resolve '"+i+"' orientation";_={x:u,y:d,width:v.getWidth(),height:v.getHeight()},d+=_.height+o}Fi(c,v.getImage(p,_.width,_.height),p,_,this._element,this._network)}}}}},_getIconsSize:function(t,e,i,n){var s=0,r=0,a=null,o=null,h=null;for(var l in t)if(o=Be.getImageAsset(t[l])){if("right"===e)a={x:s,y:r,width:o.getWidth(),height:o.getHeight()},s+=a.width+i;else if("left"===e)a={x:s-o.getWidth(),y:r,width:o.getWidth(),height:o.getHeight()},s-=a.width+i;else if("top"===e)a={x:s,y:r-o.getHeight(),width:o.getWidth(),height:o.getHeight()},r-=a.height+n;else{if("bottom"!==e)throw"Can not resolve '"+e+"' orientation";a={x:s,y:r,width:o.getWidth(),height:o.getHeight()},r+=a.height+n}h=null==h?Be.clone(a):Ge.unionRect(h,a)}return h?{width:Math.abs(h.width),height:Math.abs(h.height)}:null}}),De.network.HTMLBasicAttachment=function(t,e){function i(t,e,i,n,s,r,a){i||(i=this._origin.x),n||(n=this._origin.y),s||(s=this._location.x),r||(r=this._location.y),t=t-i-s,e=e-n-r;var o=De.Util.transformPoint({x:i+s,y:n+r},a?this._radian:-this._radian,t,e).point;return o}De.network.HTMLBasicAttachment.superClass.constructor.call(this,t,e),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0},this._triangleDiv=De.Util.createDiv(),this._roundDiv=De.Util.createDiv(),this._contentDiv=De.Util.createDiv(),De.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),De.Util.setCSSStyle(this._contentDiv,"white-space","nowrap");var n=this;this.hit=function(t,e){if(this._radian&&this._origin){var s=i.call(n,t,e);t=s.x,e=s.y}return De.Util.containsPoint(this._roundRect,t,e)||De.Util.containsPoint(this._pointerRect,t,e)},this.intersects=function(t){var e={x:t.x,y:t.y},s={x:t.x+t.width,y:t.y},r={x:t.x,y:t.y+t.height},a={x:t.x+t.width,y:t.y+t.height};if(this._radian&&this._origin){if(t.width*t.height>50)return!1;e=i.call(n,e.x,e.y),s=i.call(n,s.x,s.y),r=i.call(n,r.x,r.y),a=i.call(n,a.x,a.y)}return t=De.Util.getRect([e,s,r,a]),De.Util.intersects(this._roundRect,t)||De.Util.intersects(this._pointerRect,t)},this.getContentWidth=function(){return this._contentDiv.scrollWidth||parseInt(De.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},this.getContentHeight=function(){return this._contentDiv.scrollHeight||parseInt(De.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},this._view.appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},De.Util.ext("twaver.network.HTMLBasicAttachment",De.network.BasicAttachment,{
calculateMeasure:function(){var t=this.getContentWidth(),e=this.getContentHeight(),i=Math.min(this.getCornerRadius(),e/2),n=this.getPointerLength(),s=this.getPointerWidth(),r=this.getPosition(),a=this.getXOffset(),o=this.getYOffset();this._contentRect.width=t,this._contentRect.height=e,this._contentRect.x=i;var h=this._roundRect;h.width=t+2*i,h.height=e;var l;if(n>0){var c=this.getDirection();if(l=this._network.getPosition(r,this._ui,null,a,o),"aboveleft"===c){h.y=l.y-n-h.height,h.x=l.x-(h.width-i),this._pointers=[l,{x:l.x,y:l.y-n},{x:l.x-Math.min(s,t),y:l.y-n}];var u=n/2,d=Math.min(s,t)/2,f=this.getFillColor();this._triangleBorderWidthStyle=u+"px "+d+"px "+u+"px "+d+"px",this._triangleBorderColorStyle=f+" "+f+" transparent transparent",this._triangleDivLocation=this._pointers[2]}else if("aboveright"===c){h.y=l.y-n-h.height,h.x=l.x-i,this._pointers=[l,{x:l.x,y:l.y-n},{x:l.x+Math.min(s,t),y:l.y-n}];var u=n/2,d=Math.min(s,t)/2,f=this.getFillColor();this._triangleBorderWidthStyle=u+"px "+d+"px "+u+"px "+d+"px",this._triangleBorderColorStyle=f+" transparent transparent "+f,this._triangleDivLocation=this._pointers[1]}else if("belowleft"===c){h.y=l.y+n,h.x=l.x-(h.width-i),this._pointers=[l,{x:l.x,y:l.y+n},{x:l.x-Math.min(s,t),y:l.y+n}];var u=n/2,d=Math.min(s,t)/2,f=this.getFillColor();this._triangleBorderWidthStyle=u+"px "+d+"px "+u+"px "+d+"px",this._triangleBorderColorStyle=" transparent "+f+" "+f+" transparent",this._triangleDivLocation={x:this._pointers[2].x,y:l.y}}else if("belowright"===c){h.y=l.y+n,h.x=l.x-i,this._pointers=[l,{x:l.x,y:l.y+n},{x:l.x+Math.min(s,t),y:l.y+n}];var u=n/2,d=Math.min(s,t)/2,f=this.getFillColor();this._triangleBorderWidthStyle=u+"px "+d+"px "+u+"px "+d+"px",this._triangleBorderColorStyle="transparent transparent "+f+" "+f,this._triangleDivLocation=this._pointers[0]}else if("above"===c){h.y=l.y-n-h.height,h.x=l.x-h.width/2,this._pointers=[l,{x:l.x-Math.min(s,t)/2,y:l.y-n},{x:l.x+Math.min(s,t)/2,y:l.y-n}];var u=n,d=Math.min(s,t)/2,f=this.getFillColor();this._triangleBorderWidthStyle=u+"px "+d+"px 0px "+d+"px",this._triangleBorderColorStyle=f+" transparent transparent transparent",this._triangleDivLocation=this._pointers[1]}else if("below"===c){h.y=l.y+n,h.x=l.x-h.width/2,this._pointers=[l,{x:l.x-Math.min(s,t)/2,y:l.y+n},{x:l.x+Math.min(s,t)/2,y:l.y+n}];var u=n,d=Math.min(s,t)/2,f=this.getFillColor();this._triangleBorderWidthStyle="0px "+d+"px "+u+"px "+d+"px",this._triangleBorderColorStyle="transparent transparent "+f+" transparent ",this._triangleDivLocation={x:this._pointers[1].x,y:l.y}}else if("left"===c){h.y=l.y-h.height/2,h.x=l.x-h.width-n,this._pointers=[l,{x:l.x-n,y:l.y-Math.min(s,e)/2},{x:l.x-n,y:l.y+Math.min(s,e)/2}];var u=Math.min(s,e)/2,d=n,f=this.getFillColor();this._triangleBorderWidthStyle=u+"px 0px "+u+"px "+d+"px",this._triangleBorderColorStyle="transparent transparent  transparent "+f,this._triangleDivLocation=this._pointers[1]}else{if("right"!==c)throw"Can not resolve '"+c+"' attachment direction";h.y=l.y-h.height/2,h.x=l.x+n,this._pointers=[l,{x:l.x+n,y:l.y-Math.min(s,e)/2},{x:l.x+n,y:l.y+Math.min(s,e)/2}];var u=Math.min(s,e)/2,d=n,f=this.getFillColor();this._triangleBorderWidthStyle=u+"px "+d+"px "+u+"px 0px",this._triangleBorderColorStyle="transparent "+f+" transparent  transparent ",this._triangleDivLocation={x:l.x,y:this._pointers[1].y}}}else l=this._network.getPosition(r,this._ui,{width:h.width,height:h.height},a,o),h.x=l.x,h.y=l.y,this._pointers=null;this._location=l},updateMeasure:function(){if(this.calculateMeasure(),this._ui.isShadowable()&&this.isShadowable()?De.Util.setCSSStyle(this._roundDiv,"text-shadow",this._ui._shadowXOffset+"px "+this._ui._shadowYOffset+"px "+this._ui._shadowBlur+"px "+this._ui._shadowColor):De.Util.removeCSSStyle(this._roundDiv,"text-shadow"),this._pointerRect=De.Util.getRect(this._pointers),this._viewRect=De.Util.unionRect(this._pointerRect,this._roundRect),De.Util.setCSSStyle(this._contentDiv,"left",this._contentRect.x+"px"),De.Util.setCSSStyle(this._contentDiv,"top",this._contentRect.y+"px"),De.Util.setCSSStyle(this._roundDiv,"left",this._roundRect.x+"px"),De.Util.setCSSStyle(this._roundDiv,"top",this._roundRect.y+"px"),De.Util.setCSSStyle(this._roundDiv,"width",this._roundRect.width+"px"),De.Util.setCSSStyle(this._roundDiv,"height",this._roundRect.height+"px"),De.Util.setCSSStyle(this._roundDiv,"background",this.isFill()?this.getFillColor():null),De.Util.setCSSStyle(this._roundDiv,"-webkit-border-radius",this.getCornerRadius()+"px"),De.Util.setCSSStyle(this._roundDiv,"-moz-border-radius",this.getCornerRadius()+"px"),De.Util.setCSSStyle(this._roundDiv,"border-radius",this.getCornerRadius()+"px"),this._pointers?(De.Util.setCSSStyle(this._triangleDiv,"left",this._triangleDivLocation.x+"px"),De.Util.setCSSStyle(this._triangleDiv,"top",this._triangleDivLocation.y+"px"),De.Util.setCSSStyle(this._triangleDiv,"border-width",this._triangleBorderWidthStyle),De.Util.setCSSStyle(this._triangleDiv,"border-color",this._triangleBorderColorStyle),this._view.appendChild(this._triangleDiv)):this._triangleDiv.parentNode==this._view&&this._view.removeChild(this._triangleDiv),this._element.getStyle("label.rotatable")&&this.label){var t=this._ui.getFromPoint(),e=this._ui.getToPoint(),i=this._ui.getLinkPoints();i.size()%2==0&&(t=i.get(i.size()/2-1),e=i.get(i.size()/2)),this._radian=t.x>e.x?De.Util.getRadiansBetweenLines(e,t):De.Util.getRadiansBetweenLines(t,e),this._origin={x:this._contentRect.width/2,y:0};var n="rotate("+De.Util.toDegrees(this._radian)+"deg)",s=this._origin.x+"px "+this._origin.y+"px";De.Util.isChrome||De.Util.isSafari?(De.Util.setCSSStyle(this._roundDiv,"-webkit-transform",n),De.Util.setCSSStyle(this._roundDiv,"-webkit-transform-origin",s)):De.Util.isIE?(De.Util.setCSSStyle(this._roundDiv,"-ms-transform",n),De.Util.setCSSStyle(this._roundDiv,"-ms-transform-origin",s)):(De.Util.setCSSStyle(this._roundDiv,"transform",n),De.Util.setCSSStyle(this._roundDiv,"transform-origin",s))}else De.Util.removeCSSStyle(this._roundDiv,"-webkit-transform"),De.Util.removeCSSStyle(this._roundDiv,"-webkit-transform-origin"),De.Util.removeCSSStyle(this._roundDiv,"-ms-transform"),De.Util.removeCSSStyle(this._roundDiv,"-ms-transform-origin"),De.Util.removeCSSStyle(this._roundDiv,"transform"),De.Util.removeCSSStyle(this._roundDiv,"transform-origin"),delete this._origin,delete this._radian}}),De.network.HTMLLabelAttachment=function(t,e){De.network.HTMLBasicAttachment.call(this,t,e),this.label=!0},De.Util.ext("twaver.network.HTMLLabelAttachment",De.network.LabelAttachment,{updateMeasure:function(){var t=this.getFont("label.font"),e=this.getLabel();this._contentDiv.innerHTML=e,De.Util.setCSSStyle(this._contentDiv,"font",t),De.network.HTMLBasicAttachment.prototype.updateMeasure.call(this),De.Util.removeCSSStyle(this._contentDiv,"font")},calculateMeasure:De.network.HTMLBasicAttachment.prototype.calculateMeasure}),De.network.HTMLAlarmAttachment=function(t,e){De.network.HTMLBasicAttachment.call(this,t,e),this.alarm=!0},De.Util.ext("twaver.network.HTMLAlarmAttachment",De.network.AlarmAttachment,{updateMeasure:function(){var t=this.getFont("alarm.font");this._contentDiv.innerHTML=this._network.getAlarmLabel(this._element),De.Util.setCSSStyle(this._contentDiv,"font",t),this._fillColor=this._network.getAlarmFillColor(this._element),De.network.HTMLBasicAttachment.prototype.updateMeasure.call(this),De.Util.removeCSSStyle(this._contentDiv,"font")},calculateMeasure:De.network.HTMLBasicAttachment.prototype.calculateMeasure}),De.network.NodeUI=function(t,e){De.network.NodeUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.network.NodeUI",De.network.ElementUI,{createBodyRect:function(){return this._element.getRect()},invalidate:function(t){De.network.NodeUI.superClass.invalidate.call(this,t);var e=this._element.getAgentLinks();e&&e.forEach(function(t){this._network.invalidateElementUI(t,!1)},this)},updateMeasure:function(){De.network.NodeUI.superClass.updateMeasure.call(this);var t=this.getStyle("vector.shape"),e=this.getBodyRect();this._hotSpot=Ge.getHotSpot(e.x,e.y,e.width,e.height,t),this.drawBody(),this._outerColor&&this.drawOuterBorder(),!this._editAttachment&&"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.drawSelectBorder(),this.cleanUp(["_selectCanvas","_nodeCanvas","_nodeImage","_nodeComponent","_vectorCanvas","_outerCanvas"]);var i=this._element.getParent();i instanceof Vn&&this._network.invalidateElementUI(i,!1)},drawBody:function(){var t=this.getStyle("body.type");"default"===t?this.drawDefaultBody():"vector"===t?this.drawVectorBody():"default.vector"===t?(this.drawVectorBody(),this.drawDefaultBody()):"vector.default"===t?(this.drawDefaultBody(),this.drawVectorBody()):this.addBodyBounds({x:this._element.getX(),y:this._element.getY(),width:0,height:0})},drawOuterBorder:function(){var t=this._element,e=t.getStyle("outer.width");if(e>0){var i=this.getBodyRect();Ge.addPadding(i,t,"outer.padding",1),this._outerCanvas||(this._outerCanvas=je.createCanvas());var n=Be.clone(i);Ge.grow(n,e/2,e/2);var s=je.setCanvas(this._outerCanvas,n);s.lineWidth=e,s.lineCap=t.getStyle("outer.cap"),s.lineJoin=t.getStyle("outer.join"),s.strokeStyle=this._outerColor,qe.drawVector(s,t.getStyle("outer.shape"),null,i),s.stroke(),this.addComponent(this._outerCanvas),this.addBodyBounds(n)}},drawSelectBorder:function(){var t=this._element,e=t.getStyle("select.width");if(e>0){var i=this.getBodyRect();i=Be.clone(i);var n=t.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();Ge.addPadding(i,t,"select.padding",1/n),this._selectCanvas||(this._selectCanvas=je.createCanvas()),Ge.grow(i,e/2/n,e/2/n);var s=je.setCanvas(this._selectCanvas,bounds);s.lineWidth=e/n,s.lineCap=t.getStyle("select.cap"),s.lineJoin=t.getStyle("select.join"),s.strokeStyle=t.getStyle("select.color"),qe.drawVector(s,t.getStyle("select.shape"),null,i),s.stroke(),this.addComponent(this._selectCanvas),this.addBodyBounds(bounds)}},drawDefaultBody:function(){var t=this._element,e=Be.getImageAsset(t.getImage()),i=this.getBodyRect();if(!e)return this.addBodyBounds(i),void(this._currentImageAsset=null);if(Ge.addPadding(i,this._element,"image.padding",1),e.getImage()){this._nodeCanvas||(this._nodeCanvas=je.createCanvas());var n=Be.clone(i),s=this.setShadow(this,this._nodeCanvas,n);0!=t.getAngle()&&(i=t.getOriginalRect(),De.Util.rotateCanvas(s,i,t.getAngle())),Fi(s,t.getImage(),this.getInnerColor(),i,t,this._network),i=n,this.addComponent(this._nodeCanvas)}else if(e.getSrc())this._nodeImage||(this._nodeImage=je.createImg()),je.setImg(this._nodeImage,e.getSrc(),i),this.addComponent(this._nodeImage);else{if(!e.getFunction())throw"ImageAsset '"+t.getImage()+" ' is empty";this._nodeComponent=this._currentImageAsset!==e?e.getFunction()(this,i):e.getFunction()(this,i,this._nodeComponent),this.addComponent(this._nodeComponent),this._nodeComponent._viewRect=Be.clone(i)}this.addBodyBounds(i),this._currentImageAsset=e},hit:function(t,e){if(this._network._transparentSelectionEnable){var i=this.getBodyRect();if(Be.math.containsPoint(i,t,e))return!0}return!!this.hitCanvas(t,e,["_nodeCanvas","_outerCanvas","_vectorCanvas"])||this.hitComponent(t,e,["_nodeImage","_nodeComponent"])},intersects:function(t){if(this._network._transparentSelectionEnable){var e=this.getBodyRect();if(Be.math.intersects(e,t))return!0}return!!this.intersectsCanvas(t,["_nodeCanvas","_outerCanvas","_vectorCanvas"])||this.intersectsComponent(t,["_nodeImage","_nodeComponent"])},drawVectorBody:function(){this._vectorCanvas||(this._vectorCanvas=je.createCanvas());var t=qe.drawPath(this,this._vectorCanvas,"vector",!0,this._element.getStyle("vector.outline.pattern")),e=this.getStyle("vector.deep"),i=this._vectorCanvas.getContext("2d"),n=this.getBodyRect(),s=this.getStyle("vector.fill.color");if(0!==e&&s){var r=this._element.getAngle();0!=r&&(n=this._element.getOriginalRect(),De.Util.rotateCanvas(i,n,-r),De.Util.rotateCanvas(i,n,r)),"rectangle"===this.getStyle("vector.shape")&&qe.draw3DRect(i,s,e,n)}this.addBodyBounds(t),this.addComponent(this._vectorCanvas)}}),De.network.LinkUI=function(t,e){De.network.LinkUI.superClass.constructor.call(this,t,e),this._linkCanvas=je.createCanvas()},Be.ext("twaver.network.LinkUI",De.network.ElementUI,{isEditable:function(){return!(!bi.isOrthogonalLink(this._element)||!this.getControlPoint())},createBodyRect:function(){var t=this.getHotSpot();return t?{x:t.x-1,y:t.y-1,width:2,height:2}:null},hit:function(t,e){return this.hitCanvas(t,e,["_linkCanvas"])},intersects:function(t){return this.intersectsCanvas(t,["_linkCanvas"])},checkAttachments:function(){De.network.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var t=this._network.getLinkHandlerLabel(this._element);null!=t&&""!==t?this._linkHandlerAttachment||(this._linkHandlerAttachment=new De.network.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=Ge.calculateLineLength(this._linkPoints)),this._linkPoints},invalidate:function(t){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,De.network.LinkUI.superClass.invalidate.call(this,t)},getFromPosition:function(t,e){var i=this.getFromPoint();return i?{x:i.x+t,y:i.y+e}:null},getToPosition:function(t,e){var i=this.getToPoint();return i?{x:i.x+t,y:i.y+e}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=bi.createFromPoint(this)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=bi.createToPoint(this)),this._toPoint},updateMeasure:function(){De.network.LinkUI.superClass.updateMeasure.call(this),this.drawBody()},createLinkPoints:function(){var t=this.getFromPoint(),e=this.getToPoint(),i=this.getStyle("link.type"),n=new gn;if(bi.isOrthogonalOrFlexionalLink(this._element))n=bi.orthogonalAndFlexional(this,i);else if(this._element.isLooped()){var s=this._network.getElementUI(this._element.getFromAgent());null!=s&&(this._hotSpot=bi.fillLoopedPoints(this,s.getBodyRect(),n))}else{if("arc"!==i&&"triangle"!==i&&"parallel"!==i)throw"Can not resolve link type '"+i+"'";this._hotSpot=bi.fillBundlePoints(this,i,t,e,n)}if(this._network._linkPathFunction){var r=this._network._linkPathFunction(this,n);r&&(n=r)}return n},drawLinePoints:function(t,e,i,n,s){if(t.lineWidth=i,t.strokeStyle=n,this._element.getStyle("link.flow")===!0&&s&&s.length>1){var r=new Ai(t,s[0],s[1]),a=this._element.getStyle("link.flow.offset");this._element.getStyle("link.flow.converse")?a<s[0]?r.overflow=s[0]-a:a>=s[0]&&a<=s[0]+s[1]?(r.overflow=s[1]-(a-s[0]),r.overflow&&(r.isLine=!1)):(a-=s[0]+s[1],r.overflow=s[0]-a):a<=s[1]?(r.overflow=a,a&&(r.isLine=!1)):a>s[1]&&a<=s[0]+s[1]?r.overflow=a-s[1]:(a-=s[0]+s[1],a&&(r.isLine=!1),r.overflow=a),this._element._styleMap["link.flow.offset"]=a,t.beginPath(),qe._drawLine(e,t),t.stroke(),t.shadowColor="transparent",t.beginPath();var o=this._element.getStyle("link.flow.color");o=o?o:kn.NETWORK_LINK_FLOW_COLOR,t.strokeStyle=o,qe._drawLine(e,r),t.stroke(),t.shadowColor=this._shadowColor}else t.beginPath(),qe.drawLinePoints(t,e,s),t.stroke()},drawBody:function(){var t=this.getLinkPoints();if(t&&!(t.size()<2)){var e=this._element,i=Ge.getLineRect(t),n=e.getStyle("link.width"),s=n;if(this._outerColor){var r=e.getStyle("outer.width");s+=2*r}var a=!this._editAttachment&&"border"===e.getStyle("select.style")&&this._network.isSelected(this._element);if(a){var o=e.getStyle("select.width");s+=2*o}Ge.grow(i,s/2,s/2),e.getStyle("arrow.from")&&(i=Ge.unionRect(i,_n.getArrowRect(t,!0,e.getStyle("arrow.from.shape"),e.getStyle("arrow.from.width"),e.getStyle("arrow.from.height"),e.getStyle("arrow.from.xoffset"),e.getStyle("arrow.from.yoffset")))),e.getStyle("arrow.to")&&(i=Ge.unionRect(i,_n.getArrowRect(t,!1,e.getStyle("arrow.to.shape"),e.getStyle("arrow.to.width"),e.getStyle("arrow.to.height"),e.getStyle("arrow.to.xoffset"),e.getStyle("arrow.to.yoffset"))));var h=this.setShadow(this,this._linkCanvas,i);h.lineCap=e.getStyle("link.cap"),h.lineJoin=e.getStyle("link.join");var l=e.getStyle("link.pattern");a&&this.drawLinePoints(h,t,s,e.getStyle("select.color"),l),this._outerColor&&this.drawLinePoints(h,t,n+2*r,this._outerColor,l),this.drawLinePoints(h,t,n,this._innerColor||e.getStyle("link.color"),l),this.addBodyBounds(i),this.addComponent(this._linkCanvas),_n.drawLinkArrow(this,h,t)}},getControlPoint:function(){return bi.getControlPoint(this._element,this)},setControlPoint:function(t){if(t){var e=this.getStyle("link.type");if(bi.hasControlPoint(e)){var i=bi.getLinkSourceBounds(this),n=bi.getLinkTargetBounds(this);bi.setParamsByControlPoint(t,i,n,e,this._element)}}},getLineLength:function(){return this._lineLength}}),De.network.HTMLLinkUI=function(t,e){De.network.HTMLLinkUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.network.HTMLLinkUI",De.network.LinkUI,{checkAttachments:function(){De.network.LinkUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var t=this._element.getStyle("attachment.label.style");if(t&&"none"===t)return void De.network.HTMLLinkUI.superClass.checkLabelAttachment.call(this);var e=this._network.getLabel(this._element);null!=e&&""!==e?this._labelAttachment||(this._labelAttachment=new De.network.HTMLLabelAttachment(this),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var t=this._element.getStyle("attachment.alarm.style");if(t&&"none"===t)return void De.network.HTMLLinkUI.superClass.checkAlarmAttachment.call(this);var e=this._network.getAlarmLabel(this._element);null!=e&&""!==e?this._alarmAttachment||(this._alarmAttachment=new De.network.HTMLAlarmAttachment(this,(!1)),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}}),De.network.GroupUI=function(t,e){De.network.GroupUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.network.GroupUI",De.network.NodeUI,{isEditable:function(){return!this._element.isExpanded()},drawBody:function(){this.getBodyRect(),this._shapeRect?this.drawExpandedGroup():De.network.GroupUI.superClass.drawBody.call(this)},drawExpandedGroup:function(){this._nodeCanvas||(this._nodeCanvas=je.createCanvas());var t=qe.drawPath(this,this._nodeCanvas,"group",!1,this._element.getStyle("vector.outline.pattern")),e=this.getStyle("group.deep"),i=this.getStyle("group.fill.color");0!==e&&i&&"rectangle"===this.getStyle("group.shape")&&qe.draw3DRect(this._nodeCanvas.getContext("2d"),i,e,this._bodyRect),this.addBodyBounds(t),this.addComponent(this._nodeCanvas)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var t=this._element;if(t.isExpanded()){var e=this.getChildrenRects();if(!e.isEmpty()){var i=t.getStyle("group.shape"),n=Ze[i];if(!n)throw"Can not resolve group shape '"+i+"'";this._shapeRect=n(e)}}return this._shapeRect?(Ge.addPadding(this._shapeRect,t,"group.padding",1),this._shapeRect):De.network.GroupUI.superClass.createBodyRect.call(this)}}),De.network.GridUI=function(t,e){De.network.GridUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.network.GridUI",De.network.NodeUI,{drawDefaultBody:function(){this._element.getImage()?De.network.GridUI.superClass.drawDefaultBody.call(this):this.drawGridBody()},drawGridBody:function(){var t=this.getStyle("grid.fill"),e=this.getStyle("grid.deep"),i=this.getStyle("grid.cell.deep");if(t||0!==e||0!==i){var n=this.getBodyRect(),s=this.getDyeColor("grid.fill.color");this._nodeCanvas||(this._nodeCanvas=je.createCanvas());var r=Be.clone(n),a=this.setShadow(this,this._nodeCanvas,r);if(a.rect(n.x,n.y,n.width,n.height),this.addComponent(this._nodeCanvas),t&&(a.fillStyle=s,a.fill()),0!=e&&qe.draw3DRect(a,s,e,n.x,n.y,n.width,n.height),0!=i)for(var o=this.getStyle("grid.row.count"),h=this.getStyle("grid.column.count"),l=0;o>l;l++)for(var c=0;h>c;c++){var u=this._element.getCellRect(l,c);null!=u&&qe.draw3DRect(a,s,i,u.x,u.y,u.width,u.height)}this.addBodyBounds(r)}}}),De.network.ShapeNodeUI=function(t,e){De.network.ShapeNodeUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.network.ShapeNodeUI",De.network.NodeUI,{drawDefaultBody:function(){if(this._element._points.size()<2)return void this.addBodyBounds({x:this._element.getX(),y:this._element.getY(),width:0,height:0});this._nodeCanvas||(this._nodeCanvas=je.createCanvas());var t=qe.drawPath(this,this._nodeCanvas,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._element._points,this._element._segments,this._element.getStyle("shapenode.closed"));this.addBodyBounds(t),this.addComponent(this._nodeCanvas),_n.drawLinkArrow(this,this._nodeCanvas.getContext("2d"),Ge.getPointObject(this._element._points,this._element._segments))},drawSelectBorder:function(){var t=this._element,e=t.getStyle("select.width");if(e>0){var i=this.getBodyRect();i=Be.clone(i);var n=t.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();Ge.addPadding(i,t,"select.padding",1/n);var s=t.getStyle("vector.outline.width");s>0&&Ge.grow(i,s/2,s/2),this._selectCanvas||(this._selectCanvas=je.createCanvas()),Ge.grow(i,e/2/n,e/2/n);var r=je.setCanvas(this._selectCanvas,i);r.lineWidth=e/n,r.lineCap=t.getStyle("select.cap"),r.lineJoin=t.getStyle("select.join"),r.strokeStyle=t.getStyle("select.color"),qe.drawVector(r,t.getStyle("select.shape"),null,i),r.stroke(),this.addComponent(this._selectCanvas),this.addBodyBounds(bounds)}}}),De.network.ShapeLinkUI=function(t,e){De.network.ShapeLinkUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.network.ShapeLinkUI",De.network.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var t=this.getFromPoint(),e=this.getToPoint(),i=new gn,n=this.getStyle("shapelink.type");i.add(t),null!=this._element._points&&i.addAll(this._element._points),i.add(e);var s=i.size(),r=Math.floor(s/2);if(s%2===0){var a=i.get(r),o=i.get(r-1);this._hotSpot={x:(a.x+o.x)/2,y:(a.y+o.y)/2}}else this._hotSpot=Be.clone(i.get(r));var h,l,c;if("lineto"===n);else if("quadto"===n){for(h=new gn(i.get(0)),l=1,s=i.size();s>l;l++)h.add(s-1>l?new gn([i.get(l++),i.get(l)]):i.get(l));i=h}else if("cubicto"===n){for(h=new gn(i.get(0)),l=1,s=i.size();s>l;l++)h.add(s-2>l?new gn([i.get(l++),i.get(l++),i.get(l)]):s-1>l?new gn([i.get(l++),i.get(l)]):i.get(l));i=h}else{if("orthogonalto"!==n)throw"Can not resolve shapelink type '"+n+"'";for(c=i.get(0),h=new gn(c),l=1,s=i.size();s>l;l++)if(s-1>l){var u=Be.clone(i.get(l)),d=u.x,f=u.y,g=d-c.x,_=f-c.y;Math.abs(g)>Math.abs(_)?(u.x=d,u.y=c.y):(u.x=c.x,u.y=f),c=u,h.add(c)}else h.add(i.get(l));i=h}return i}}),De.network.RotatableNodeUI=function(t,e){De.network.RotatableNodeUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.network.RotatableNodeUI",De.network.NodeUI,{isEditable:function(){return!1},drawDefaultBody:function(){var t=this._element,e=Be.getImageAsset(t.getImage()),i=this.getBodyRect();if(!e)return this.addBodyBounds(i),void(this._currentImageAsset=null);if(Ge.addPadding(i,this._element,"image.padding",1),e.getImage()){this._nodeCanvas||(this._nodeCanvas=je.createCanvas());var n=Be.clone(i),s=this.setShadow(this,this._nodeCanvas,n),r=this._element._getOrignalWidth(),a=this._element._getOrignalHeight(),o=this._element._getRotateRect();s.save(),s.translate(i.x-o.x+r/2,i.y-o.y+a/2),s.rotate(this._element._angle*Math.PI/180);var i={x:-r/2,y:-a/2,width:r,height:a};Fi(s,e.getImage(this._innerColor,i.width,i.height),this._innerColor,i,t,this._network),s.restore(),this.addComponent(this._nodeCanvas)}else if(e.getSrc());else if(!e.getFunction())throw"ImageAsset '"+t.getImage()+" ' is empty";this.addBodyBounds(i),this._currentImageAsset=e}}),De.network.HTMLNodeUI=function(t,e){De.network.HTMLNodeUI.superClass.constructor.call(this,t,e)},De.Util.ext("twaver.network.HTMLNodeUI",De.network.NodeUI,{checkAttachments:function(){De.network.NodeUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var t=this._element.getStyle("attachment.label.style");if(t&&"none"===t)return void De.network.HTMLNodeUI.superClass.checkLabelAttachment.call(this);var e=this._network.getLabel(this._element);null!=e&&""!==e?this._labelAttachment||(this._labelAttachment=new De.network.HTMLLabelAttachment(this,kn.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var t=this._element.getStyle("attachment.alarm.style");if(t&&"none"===t)return void De.network.HTMLNodeUI.superClass.checkAlarmAttachment.call(this);var e=this._network.getAlarmLabel(this._element);null!=e&&""!==e?this._alarmAttachment||(this._alarmAttachment=new De.network.HTMLAlarmAttachment(this,(!1)),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}}),De.network.interaction.BaseInteraction=function(t){this.network=t},Be.ext("twaver.network.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},addListener:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];je.addEventListener(e,"handle_"+e,this.network.getView(),this)}},removeListener:function(){for(var t=0;t<arguments.length;t++)je.removeEventListener(arguments[t],this.network.getView(),this)},_handle_mousedown:function(t){0===t.button&&(this._startLogical=this.network.getLogicalPoint(t),this._startClient=je.getClientPoint(t),this._startLogical&&je.handle_mousedown(this,t))},_handle_mousemove:function(t){this._endLogical={x:this._startLogical.x+(t.clientX-this._startClient.x)/this.network.getZoom(),y:this._startLogical.y+(t.clientY-this._startClient.y)/this.network.getZoom()}},_handle_mouseup:function(t){delete this._startClient,delete this._startLogical,delete this._endLogical}}),De.network.interaction.SelectInteraction=function(t){De.network.interaction.SelectInteraction.superClass.constructor.call(this,t)},Be.ext("twaver.network.interaction.SelectInteraction",De.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown"),this.end()},handle_mousedown:function(t){if(this._button=t.button,this.network.isValidEvent(t)&&!this.network.isMovingElement()&&!this.network.isEditingElement()&&!t.shiftKey){var e=this.network.getElementAt(t),i=this.network.getSelectionModel();e?Be.isCtrlDown(t)?i.contains(e)?i.removeSelection(e):i.appendSelection(e):i.contains(e)||i.setSelection(e):(Be.isCtrlDown(t)||i.clearSelection(),this.end(t),this.network.getLogicalPoint(t)&&this.network.isRectSelectEnabled()&&this._handle_mousedown(t))}},handle_mouseup:function(t){this.end(t)},handle_mousemove:function(t){if(0!==this._button||this.network.isMovingElement()||this.network.isEditingElement())return void this.end(t);this._handle_mousemove(t),this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:t}):(this.mark=je.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:t}));var e=Ge.getRect([this._startLogical,this._endLogical]);je.setDiv(this.mark,e,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())},end:function(t){if(this._startLogical){if(this.mark){if(this._endLogical&&this._startLogical.x!==this._endLogical.x&&this._startLogical.y!==this._endLogical.y){var e=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(e&&e.size()>0){var i=this.network.getSelectionModel(),n=i.toSelection();e.forEach(function(t){i.contains(t)?n.remove(t):n.add(t)},this),i.setSelection(n)}this.network.fireInteractionEvent({kind:"selectEnd",event:t})}var s=this;setTimeout(function(){s.mark&&(s.network.getTopDiv().removeChild(s.mark),s.mark=null)},0),this.network.setSelectingElement(!1)}this._handle_mouseup(t)}},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()||"contain"!==this.network.getSelectMode()&&(this._startLogical.x>this._endLogical.x&&this._startLogical.y>this._endLogical.y)}}),De.network.interaction.MoveInteraction=function(t,e){this.lazyMode=e,this.xoffset=0,this.yoffset=0,De.network.interaction.MoveInteraction.superClass.constructor.call(this,t),this.currentKeyEvent=null},Be.ext("twaver.network.interaction.MoveInteraction",De.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","keydown","mouseleave")},tearDown:function(){this.removeListener("mousedown","keydown","mouseleave"),this.end()},handle_keydown:function(t){this.currentKeyEvent=t,this.addListener("keyup")},handle_keyup:function(t){this.currentKeyEvent=null,this.removeListener("keyup")},handle_mouseleave:function(t){this.end(t)},isParenting:function(){return this._startLogical&&null!=this.currentKeyEvent&&80===this.currentKeyEvent.keyCode},parentProcess:function(t,e){var i=null;null!=this.parent&&(i=this.network.getElementUI(this.parent).getViewRect(),this.parent=null);var n=this;if(t=this.network.getLogicalPoint(t),!e&&this.isParenting()){var s={};s.x=t.x-1,s.y=t.y-1,s.width=2,s.height=2;var r=this.network.getElementsAtRect(s,!0);if(r&&r.size()>0)for(var a=r.size(),o=0;a>o;o++){var h=r.get(o);if(!n.network.getElementBox().getSelectionModel().contains(h)){n.parent=h;break}}}null!=this.parent&&(i=this.network.getElementUI(this.parent).getViewRect()),null==i||e?this.parentMark&&(this.network.getTopDiv().removeChild(this.parentMark),this.parentMark=null):(this.parentMark||(this.parentMark=Be.html.createDiv(),this.network.getTopDiv().appendChild(this.parentMark)),Be.html.setDiv(this.parentMark,i,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()))},handle_mousedown:function(t){if(0===t.button&&!this.network.isSelectingElement()&&!this.network.isEditingElement()){var e=this.network.getElementAt(t);this.network.isMovable(e)&&(this.end(t),this._handle_mousedown(t))}},handle_mouseup:function(t){this.end(t)},handle_mousemove:function(t){if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.network.hasMovableSelectedElements()||!this._startLogical)return void this.end(t);if(this._handle_mousemove(t),this.xoffset=this._endLogical.x-this._startLogical.x,this.yoffset=this._endLogical.y-this._startLogical.y,this.lazyMode){if(this.mark)this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:t});else{this.mark=je.createDiv();var e;this.network.getMovableSelectedElements().forEach(function(t){var i=this.getElementUI(t);i&&(e=Ge.unionRect(e,i.getViewRect()))},this.network),this.network.getTopDiv().appendChild(this.mark),this.network.setMovingElement(!0),je.setDiv(this.mark,e,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()),this.network.fireInteractionEvent({kind:"lazyMoveStart",event:t})}this.mark.style.left=this.xoffset+this.mark._viewRect.x+"px",this.mark.style.top=this.yoffset+this.mark._viewRect.y+"px"}else this._startLogical=this._endLogical,this._startClient=je.getClientPoint(t),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:t})),this.network.moveSelectedElements(this.xoffset,this.yoffset);this.parentProcess(t,!1)},end:function(t){if(this._startLogical){if(this.lazyMode){if(this.mark){var e=this,i=function(){e.network.fireInteractionEvent({kind:"lazyMoveEnd",
event:t}),e.mark&&(e.network.getTopDiv().removeChild(e.mark),e.mark=null,e.network.setMovingElement(!1))};this.network.moveSelectedElements(this.xoffset,this.yoffset,this.network.isLazyMoveAnimate(),i)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:t}));if(this.isParenting()){null==this.parent&&(this.parent=this.network.getCurrentSubNetwork());var e=this;this.network.getMovableSelectedElements().forEach(function(t){t.setParent(e.parent)},this.network)}this.parentProcess(t,!0),this._handle_mouseup(t)}}}),De.network.interaction.DefaultInteraction=function(t){De.network.interaction.DefaultInteraction.superClass.constructor.call(this,t)},Be.ext("twaver.network.interaction.DefaultInteraction",De.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove","keydown")},tearDown:function(){this.removeListener("mousedown","mousemove","keydown")},handle_mousedown:function(t){if(this.network.isValidEvent(t)){this.network.isFocusOnClick()&&De.Util.setFocus(this.network.getView());var e=this.network.getElementAt(t);2===t.detail?this.handleDoubleClicked(t,e):this.handleClicked(t,e)}},handleClicked:function(t,e){Li.handleClicked(this.network,t,e)},handleDoubleClicked:function(t,e){Li.handleDoubleClicked(this.network,t,e)},handle_keydown:function(t){Li.handleKeyDown(this.network,t)},handle_mousemove:function(t){var e=this.network.getElementAt(t),i=this._preElement,n=Mi(i),s=Mi(e);i!==e&&(i&&(n&&n.onMouseLeave&&n.onMouseLeave(i,this.network),this.network.onMouseLeave(i,t)),e&&(s&&s.onMouseEnter&&s.onMouseEnter(e,this.network),this.network.onMouseEnter(e,t))),e&&s&&s.onMouseMove&&s.onMouseMove(e,this.network),this.network.onMouseMove(e,t),this._preElement=e}}),De.network.interaction.PanInteraction=function(t){De.network.interaction.PanInteraction.superClass.constructor.call(this,t)},Be.ext("twaver.network.interaction.PanInteraction",De.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown"),this._oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(t){this._startLogical=this.network.getLogicalPoint(t),this._startLogical&&(this._handle_mousedown(t),this.network.getView().style.cursor="pointer")},handle_mouseup:function(t){this._clear()},handle_mousemove:function(t){if(this._startLogical){this._handle_mousemove(t);var e=this._startLogical.x-this._endLogical.x,i=this._startLogical.y-this._endLogical.y;this.network.panByOffset(e,i),this._startLogical=this._endLogical,this._startClient=je.getClientPoint(t)}},_clear:function(t){this._startLogical&&(this._handle_mouseup(t),this.network.getView().style.cursor=this._oldCursor)}}),De.network.interaction.EditInteraction=function(t,e){this.lazyMode=e,this.pointIndex=-1,De.network.interaction.EditInteraction.superClass.constructor.call(this,t)},Be.ext("twaver.network.interaction.EditInteraction",De.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear()},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.mouseMoved=!1,this.horizontal=!1,this.vertical=!1,this.mark&&(this.network.getTopDiv().removeChild(this.mark),this.mark=null),this.rotateScale&&this.network.getTopDiv().contains(this.rotateScale)&&(this.network.getTopDiv().removeChild(this.rotateScale),this.rotateScale=null)},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(t){this.cursorID=t,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},handle_mousedown:function(t){if(0===t.button)if(!Be.isAltDown(t)||this.network.isEditingElement())!this.network.isEditingElement()||this.isStart||this.isStartRotate||(this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:t,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?Be.isAltDown(t)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:t,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0?Be.isAltDown(t)?(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:t,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(t)));else{var e=this.network.getElementAt(t),i=this.network.getLogicalPoint(t);if(e instanceof De.ShapeNode){var n=this.getPointIndex(e.getPoints(),i,!0);n>0&&(this._handle_mousedown(t),this.pointIndex=n,this.shapeNode=e,e.addPoint(i,n),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:t,element:e,pointIndex:n}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:e,pointIndex:n}))}if(e instanceof De.ShapeLink){var s=new De.List(e.getPoints()),r=this.network.getElementUI(e);s.add(r.getFromPoint(),0),s.add(r.getToPoint());var n=this.getPointIndex(s,i)-1;n>0&&(this._handle_mousedown(t),this.pointIndex=n,this.shapeLink=e,e.addPoint(i,n),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:t,element:e,pointIndex:n}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:e,pointIndex:n}))}}},handle_mouseup:function(t){if(this.isStart){var e=Be.clone(this._endLogical);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var i=this,n=new De.animate.AnimateBounds(this.node,this.resizingRect,function(){i.network.fireInteractionEvent({kind:"lazyResizeEnd",event:t,element:i.node,resizeDirection:i.resizeDirection}),i.clear()});De.animate.AnimateManager.start(n)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:t,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:t,element:this.node,resizeDirection:this.resizeDirection});else if(this.shapeNode&&this.pointIndex>=0&&e){var s=this.shapeNode.getPoints().get(this.pointIndex);this.horizontal&&(e.y=s.y),this.vertical&&(e.x=s.x),this.shapeNode.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:t,element:this.shapeNode,pointIndex:this.pointIndex})}else if(this.shapeLink&&this.pointIndex>=0&&e){var s=this.shapeLink.getPoints().get(this.pointIndex);this.horizontal&&(e.y=s.y),this.vertical&&(e.x=s.x),this.shapeLink.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:t,element:this.shapeLink,pointIndex:this.pointIndex})}else this.linkUI&&e&&(this.linkUI.setControlPoint(e),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:t,element:this.linkUI._element}))}this._handle_mouseup(t),this.lazyMode||this.clear()},handle_mousemove:function(t){if(this.isStartRotate&&this.node)return this._handleRotateElement(t,this.node),void(this.network.isShowRotateScale()&&this.showRotateScale());if(this.isStart){if(this.shapeNode&&this.pointIndex>=0)return void this._handleMovingShapeNodePoint(t);if(this.shapeLink&&this.pointIndex>=0)return void this._handleMovingShapeLinkPoint(t);if(this.node&&this.resizeDirection)return void this._handleResizing(t);if(this.linkUI)return void this._handleMovingLinkControlPoint(t)}else if(this.network.isValidEvent(t)){if(this.network.isSelectingElement()||this.network.isMovingElement()||0===this.network.getSelectionModel().size())return void this.clear();var e=this.network.getElementAt(t),i=this.network.getElementUI(e);if(!i||!i.getEditAttachment())return void this.clear();var n=this.network.getLogicalPoint(t);if(e instanceof On){if(this.node=e,this._isEditingShapeNode(n)||this._isResizingNode(n))return void this.network.setEditingElement(!0);if(this._isRotatingElement(n))return this.network.setRotatingElement(!0),void this.network.setEditingElement(!0)}else if(e instanceof De.ShapeLink){if(this.shapeLink=e,this._isEditingShapeLink(n))return void this.network.setEditingElement(!0)}else if(i instanceof De.network.LinkUI){var s=this.network.getEditPointSize();if(bi.isOrthogonalLink(i._element)){this.linkUI=i;var r=this.linkUI.getControlPoint();return void(r&&this._contains(n,r,s)&&(this._setCrossCursor(),this.network.setEditingElement(!0)))}}this.clear()}},_isRotatingElement:function(t){var e=this.network.getRotatePointSize();if(0>=e)return!1;var i=this.node.getOriginalRect(),n=this.node.getAngle();return this._isRotating(t,"crosshair",i,n)},_isRotating:function(t,e,i,n){var s=this.network.getRotatePointSize(),r={x:i.x+i.width/2,y:i.y-this.network.getRotatePointOffset()-s},a=this._rotatePoint(r,n,i),o={x:a.x-s,y:a.y-s,width:2*s,height:2*s};return!!Ge.containsPoint(o,t)&&(this._removeCursor(),this._setCursor(e),!0)},_handleRotateElement:function(t,e){this._handle_mousemove(t);var i=this._calculateAngle(this.network.getLogicalPoint(t),e);e.setAngle(i)},_calculateAngle:function(t,e){var i=e.getCenterLocation();return Math.round(180*Math.atan2(i.x-t.x,t.y-i.y)/Math.PI+180)},_handleMovingShapeNodePoint:function(t){if(this._handle_mousemove(t),!this.mouseMoved&&Be.isCtrlDown(t)){var e=this._endLogical.x-this._startLogical.x,i=this._endLogical.y-this._startLogical.y;this.horizontal=Math.abs(e)>=Math.abs(i),this.vertical=!this.horizontal,this.mouseMoved=!0}var n=this.shapeNode.getPoints().get(this.pointIndex),s=Be.clone(this._endLogical);this.horizontal&&(s.y=n.y),this.vertical&&(s.x=n.x),this.shapeNode.setPoint(this.pointIndex,s),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:t,element:this.shapeNode,pointIndex:this.pointIndex})},_handleMovingShapeLinkPoint:function(t){if(this._handle_mousemove(t),!this.mouseMoved&&Be.isCtrlDown(t)){var e=this._endLogical.x-this._startLogical.x,i=this._endLogical.y-this._startLogical.y;this.horizontal=Math.abs(e)>=Math.abs(i),this.vertical=!this.horizontal,this.mouseMoved=!0}var n=this.shapeLink.getPoints().get(this.pointIndex),s=Be.clone(this._endLogical);this.horizontal&&(s.y=n.y),this.vertical&&(s.x=n.x),this.shapeLink.setPoint(this.pointIndex,s),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:t,element:this.shapeLink,pointIndex:this.pointIndex})},_handleMovingLinkControlPoint:function(t){this._handle_mousemove(t),this.linkUI.setControlPoint(Be.clone(this._endLogical)),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:t,element:this.linkUI._element})},_handleResizing:function(t){this._handle_mousemove(t);var e=this.node.getAngle(),i=this.node.getLocation(),n=this.node.getWidth()/2,s=this.node.getHeight()/2,r={x:i.x+n,y:i.y+s},a={x:-n,y:-s},o={x:-n,y:s},h={x:n,y:s},l={x:n,y:-s},c={x:0,y:-s},u={x:n,y:0},d={x:0,y:s},f={x:-n,y:0};if("northwest"===this.resizeDirection&&(this._transformPoint(h,r,e),a.x=this._endLogical.x,a.y=this._endLogical.y,r.x=(a.x+h.x)/2,r.y=(a.y+h.y)/2,this._reversPoint(a,r,e),this._reversPoint(h,r,e),this.resizingRect={x:a.x,y:a.y,width:h.x-a.x,height:h.y-a.y}),"north"===this.resizeDirection){var g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,r,e),c.y=g.y-r.y,this._transformPoint(c,r,e),this._transformPoint(d,r,e),r.x=(c.x+d.x)/2,r.y=(c.y+d.y)/2,this._reversPoint(c,r,e),this._reversPoint(d,r,e),this.resizingRect={x:r.x-this.node.getWidth()/2,y:r.y-(d.y-c.y)/2,width:this.node.getWidth(),height:d.y-c.y}}if("northeast"===this.resizeDirection&&(this._transformPoint(o,r,e),l.x=this._endLogical.x,l.y=this._endLogical.y,r.x=(o.x+l.x)/2,r.y=(o.y+l.y)/2,this._reversPoint(o,r,e),this._reversPoint(l,r,e),this.resizingRect={x:o.x,y:l.y,width:l.x-o.x,height:o.y-l.y}),"west"===this.resizeDirection){var g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,r,e),f.x=g.x-r.x,this._transformPoint(u,r,e),this._transformPoint(f,r,e),r.x=(u.x+f.x)/2,r.y=(u.y+f.y)/2,this._reversPoint(u,r,e),this._reversPoint(f,r,e),this.resizingRect={x:r.x-(u.x-f.x)/2,y:r.y-this.node.getHeight()/2,width:u.x-f.x,height:this.node.getHeight()}}if("east"===this.resizeDirection){var g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,r,e),u.x=g.x-r.x,this._transformPoint(u,r,e),this._transformPoint(f,r,e),r.x=(u.x+f.x)/2,r.y=(u.y+f.y)/2,this._reversPoint(u,r,e),this._reversPoint(f,r,e),this.resizingRect={x:r.x-(u.x-f.x)/2,y:r.y-this.node.getHeight()/2,width:u.x-f.x,height:this.node.getHeight()}}if("southwest"===this.resizeDirection&&(this._transformPoint(l,r,e),o.x=this._endLogical.x,o.y=this._endLogical.y,r.x=(o.x+l.x)/2,r.y=(o.y+l.y)/2,this._reversPoint(o,r,e),this._reversPoint(l,r,e),this.resizingRect={x:o.x,y:l.y,width:l.x-o.x,height:o.y-l.y}),"south"===this.resizeDirection){var g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,r,e),d.y=g.y-r.y,this._transformPoint(c,r,e),this._transformPoint(d,r,e),r.x=(c.x+d.x)/2,r.y=(c.y+d.y)/2,this._reversPoint(c,r,e),this._reversPoint(d,r,e),this.resizingRect={x:r.x-this.node.getWidth()/2,y:r.y-(d.y-c.y)/2,width:this.node.getWidth(),height:d.y-c.y}}"southeast"===this.resizeDirection&&(this._transformPoint(a,r,e),h.x=this._endLogical.x,h.y=this._endLogical.y,r.x=(a.x+h.x)/2,r.y=(a.y+h.y)/2,this._reversPoint(a,r,e),this._reversPoint(h,r,e),this.resizingRect={x:a.x,y:a.y,width:h.x-a.x,height:h.y-a.y}),this.lazyMode?(this.mark||(this.mark=je.createDiv(),this.mark.style.webkitTransform="rotate("+e+"deg)",this.mark.style.mozTransform="rotate("+e+"deg)",this.mark.style.OTransform="rotate("+e+"deg)",this.mark.style.msTransform="rotate("+e+"deg)",this.mark.style.transform="rotate("+e+"deg)",this.network.getTopDiv().appendChild(this.mark)),je.setDiv(this.mark,this.resizingRect,null,this.network.getResizeLineWidth(),this.network.getResizeLineColor()),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:t,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:t,element:this.node,resizeDirection:this.resizeDirection}))},_isEditingShapeNode:function(t){var e=this.network.getEditPointSize();if(this.node instanceof De.ShapeNode){this.shapeNode=this.node;for(var i=this.shapeNode.getPoints(),n=0,s=i.size();s>n;n++){var r=i.get(n);if(this._contains(t,r,e))return this._setCrossCursor(),this.pointIndex=n,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(t){for(var e=this.shapeLink.getPoints(),i=this.network.getEditPointSize(),n=0,s=e.size();s>n;n++){var r=e.get(n);if(this._contains(t,r,i))return this._setCrossCursor(),this.pointIndex=n,!0}return this.pointIndex=-1,!1},_isResizingNode:function(t){var e=this.network.getResizePointSize();if(0>=e)return!1;var i=this.node.getOriginalRect(),n=this.node.getAngle(),s={x:i.x,y:i.y},r=this._rotatePoint(s,n,i);return!!this._isResizing(t,r.x,r.y,"northwest","nwse-resize")||(s={x:i.x+i.width/2,y:i.y},r=this._rotatePoint(s,n,i),!!this._isResizing(t,r.x,r.y,"north","ns-resize")||(s={x:i.x+i.width,y:i.y},r=this._rotatePoint(s,n,i),!!this._isResizing(t,r.x,r.y,"northeast","nesw-resize")||(s={x:i.x,y:i.y+i.height/2},r=this._rotatePoint(s,n,i),!!this._isResizing(t,r.x,r.y,"west","ew-resize")||(s={x:i.x+i.width,y:i.y+i.height/2},r=this._rotatePoint(s,n,i),!!this._isResizing(t,r.x,r.y,"east","ew-resize")||(s={x:i.x,y:i.y+i.height},r=this._rotatePoint(s,n,i),!!this._isResizing(t,r.x,r.y,"southwest","nesw-resize")||(s={x:i.x+i.width/2,y:i.y+i.height},r=this._rotatePoint(s,n,i),!!this._isResizing(t,r.x,r.y,"south","ns-resize")||(s={x:i.x+i.width,y:i.y+i.height},r=this._rotatePoint(s,n,i),!!this._isResizing(t,r.x,r.y,"southeast","nwse-resize"))))))))},_rotatePoint:function(t,e,i){var n=Ge.createMatrix(e*Math.PI/180,i.x+i.width/2,i.y+i.height/2),s=n.transform(t);return s},_isResizing:function(t,e,i,n,s){var r=this.network.getResizePointSize();return!!this._contains(t,{x:e,y:i},r)&&(this.resizeDirection!==n&&(this._removeCursor(),s=this._changeCursorWithAngle(n,this.node.getAngle()),this._setCursor(s),this.resizeDirection=n),!0)},_getRect:function(t,e,i,n){var s=i>t?t:i,r=n>e?e:n,a=Math.abs(t-i),o=Math.abs(e-n);return{x:s,y:r,width:a,height:o}},_contains:function(t,e,i){var n={x:e.x-i,y:e.y-i,width:2*i,height:2*i};return Ge.containsPoint(n,t)},getPointIndex:function(t,e,i){if(t.size()<2)return 0;for(var n,s=t.get(0),r=1;r<t.size();r++){if(n=t.get(r),this.isPointOnLine(e,s,n,6))return r;s=n}return s=t.get(0),i&&this.isPointOnLine(e,s,n,6)?t.size():0},showRotateScale:function(){this.rotateScale||(this.rotateScale=Be.html.createCanvas());var t,e,i,n,s,r=(new De.List,this.network.getRotateScaleWidth()),a=this.network.getRotateScaleHeight(),o=this.network.getRotatePointSize(),h=this.node.getAngle(),l=this.node.getOriginalRect(),c={x:l.x+l.width/2,y:l.y-this.network.getRotatePointOffset()-o},u=this._rotatePoint(c,h,l),d="13px Arial",f=h+"";this.node.getAngle()>=0&&this.node.getAngle()<=180?(e={x:u.x+o,y:u.y},i={x:e.x+r,y:e.y},n={x:i.x,y:i.y-a},s={x:e.x,y:n.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(e={x:u.x-o,y:u.y},i={x:e.x-r,y:e.y},n={x:i.x,y:i.y-a},s={x:e.x,y:n.y});var g=new De.List([e,i,n,s]),t=Be.math.getRect(g),_=Be.html.setCanvas(this.rotateScale,t);_.fillStyle=this.network.getRotateScaleFillColor(),_.fillRect(t.x,t.y,t.width,t.height),_.fillStyle=this.network.getRotateScaleFontColor(),_.textBaseline="middle",_.textAlign="center",_.font=d,_.fillText(f,t.x+t.width/2,t.y+t.height/2),this.network.getTopDiv().appendChild(this.rotateScale)},isPointOnLine:function(t,e,i,n){0>n&&(n=0);var s=this.getDistanceFromPointToLine(t,e,i);return n>=s&&t.x>=Math.min(e.x,i.x)-n&&t.x<=Math.max(e.x,i.x)+n&&t.y>=Math.min(e.y,i.y)-n&&t.y<=Math.max(e.y,i.y)+n},getDistanceFromPointToLine:function(t,e,i){if(e.x===i.x)return Math.abs(t.x-e.x);var n=(i.y-e.y)/(i.x-e.x),s=(i.x*e.y-e.x*i.y)/(i.x-e.x);return Math.abs(n*t.x-t.y+s)/Math.sqrt(n*n+1)},_transformPoint:function(t,e,i){var n=Math.cos(i*Math.PI/180),s=Math.sin(i*Math.PI/180),r=t.x,a=t.y,o=r*n-a*s,h=r*s+a*n;t.x=o+e.x,t.y=h+e.y},_reversPoint:function(t,e,i){i*=-1;var n=Math.cos(i*Math.PI/180),s=Math.sin(i*Math.PI/180),r=t.x-e.x,a=t.y-e.y,o=r*n-a*s,h=r*s+a*n;t.x=o+e.x,t.y=h+e.y},_changeCursorWithAngle:function(t,e){var i,n=["auto","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];switch(t){case"northwest":i=1;break;case"north":i=2;break;case"northeast":i=3;break;case"east":i=4;break;case"southeast":i=5;break;case"south":i=6;break;case"southwest":i=7;break;case"west":i=8;break;default:i=0}return(e>=360||-360>=e)&&(e%=360),e>22.5&&67.5>=e&&(i+=1),-22.5>e&&e>=-67.5&&(i-=1),e>67.5&&112.5>=e&&(i+=2),-67.5>e&&e>=-112.5&&(i-=2),e>112.5&&157.5>=e&&(i+=3),-112.5>e&&e>=-157.5&&(i-=3),e>157.5&&202.5>=e&&(i+=4),-157.5>e&&e>=-202.5&&(i-=4),e>202.5&&247.5>=e&&(i+=5),-202.5>e&&e>=-247.5&&(i-=5),e>247.5&&292.5>=e&&(i+=6),-247.5>e&&e>=-292.5&&(i-=6),e>292.5&&337.5>=e&&(i+=7),-292.5>e&&e>=-337.5&&(i-=7),i>8&&(i-=8),0>=i&&(i+=8),n[i]}}),De.network.interaction.CreateElementInteraction=function(t,e){e||(e=On),this.elementFunction=De.Util.isTypeOf(e,On)?function(t){var i=new e;return i instanceof On&&i.setCenterLocation(t),i}:e,De.network.interaction.CreateElementInteraction.superClass.constructor.call(this,t)},Be.ext("twaver.network.interaction.CreateElementInteraction",De.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(t){var e=this.network.getLogicalPoint(t);if(e){var i=this.elementFunction(e);i&&this.network.addElementByInteraction(i)}}}),De.network.interaction.CreateLinkInteraction=function(t,e){e||(e=De.Link),this.linkFunction=De.Util.isTypeOf(e,De.Link)?function(t,i){var n=new e;return n instanceof De.Link&&(n.setFromNode(t),n.setToNode(i)),n}:e,De.network.interaction.CreateLinkInteraction.superClass.constructor.call(this,t)},Be.ext("twaver.network.interaction.CreateLinkInteraction",De.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove")},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear()},clear:function(){var t=this;setTimeout(function(){t._fromRectangle&&(t.network.getTopDiv().removeChild(t._fromRectangle),t._fromRectangle=null),t._currentRectangle&&(t.network.getTopDiv().removeChild(t._currentRectangle),t._currentRectangle=null),t._line&&(t.network.getTopDiv().removeChild(t._line),t._line=null)}),this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(t){if(this.network.isValidEvent(t))if(this.fromNode){if(this.toNode=this.currentNode,this.toNode){var e=this.createLink();e&&this.network.addElementByInteraction(e)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.updateMark()},handle_mousemove:function(t){var e=this.network.getLogicalPoint(t);if(e){if(this.network.isMovingElement()||this.network.isEditingElement())return void this.clear();var i=null;this.fromNode?(this.currentNode=this.getToNode(t),this.currentPoint=e,this.updateMark()):(i=this.getFromNode(t),this.currentNode!==i&&(this.currentNode=i,this.updateMark()))}},getFromNode:function(t){return this.getNode(t)},getToNode:function(t){return this.getNode(t)},getNode:function(t){var e=this.network.getElementAt(t);return e instanceof On&&this.network.isLinkable(e)?e:null},updateMark:function(){var t;this.fromNode&&!this._fromRectangle&&this._currentRectangle&&(this._fromRectangle=this._currentRectangle,this._currentRectangle=null),!this.fromNode&&this._fromRectangle&&(this.network.getTopDiv().removeChild(this._fromRectangle),this._fromRectangle=null),this.currentNode&&!this._currentRectangle&&(t=this.network.getElementUI(this.currentNode),this._currentRectangle=je.createDiv(),this.network.getTopDiv().appendChild(this._currentRectangle),je.setDiv(this._currentRectangle,t._viewRect,null,this.network.getEditLineWidth(),this.network.getEditLineColor())),!this.currentNode&&this._currentRectangle&&(this.network.getTopDiv().removeChild(this._currentRectangle),this._currentRectangle=null),this.updateLine()},updateLine:function(){if(this.currentPoint){var t=this.fromNode.getCenterLocation(),e=t.x,i=t.y,n=this.currentPoint.x,s=this.currentPoint.y;this._line||(this._line=je.createCanvas(),this.network.getTopDiv().appendChild(this._line));var r=je.setCanvas(this._line,Math.min(e,n),Math.min(i,s),Math.abs(e-n),Math.abs(i-s));r.lineWidth=this.network.getEditLineWidth(),r.strokeStyle=this.network.getEditLineColor(),r.beginPath(),r.moveTo(e,i),r.lineTo(n,s),r.stroke()}else this._line&&(this.network.getTopDiv().removeChild(this._line),this._line=null)}}),De.network.interaction.CreateShapeNodeInteraction=function(t,e){e||(e=De.ShapeNode),this.shapeNodeFunction=De.Util.isTypeOf(e,De.ShapeNode)?function(t){var i=new e;return i instanceof De.ShapeNode&&t&&i.setPoints(t),i}:e,De.network.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,t),this.timeStamp=-1},Be.ext("twaver.network.interaction.CreateShapeNodeInteraction",De.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove")},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear()},clear:function(){this.network.setEditingElement(!1),this.points=null,this.currentPoint=null,this.lastPoint=null,this.horizontal=!1,this.vertical=!1,this.mark&&(this.network.getTopDiv().removeChild(this.mark),this.mark=null)},handle_mousedown:function(t){if(0===t.button){var e=this.network.getLogicalPoint(t);if(e){if(2===t.detail||t.timeStamp-this.timeStamp<300){if(this.points){var i=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(i),this.clear();var n=this;setTimeout(function(){n.network.setEditingElement(!1)},0)}}else{if(this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new gn),this.points.size()>0){var s=this.points.get(this.points.size()-1);if(s.x===e.x&&s.y===e.y)return}this._handle_mousedown(t),this.points.size()>0&&Be.isCtrlDown(t)&&(this.horizontal&&(e.y=s.y),this.vertical&&(e.x=s.x),this.horizontal=!1,this.vertical=!1),this.lastPoint=e,this.points.add(e),this.updateMark()}this.timeStamp=t.timeStamp}}},handle_mousemove:function(t){if(this.points){if(this.currentPoint=this.network.getLogicalPoint(t),Be.isCtrlDown(t)){var e=this.currentPoint.x-this.lastPoint.x,i=this.currentPoint.y-this.lastPoint.y;this.horizontal=Math.abs(e)>=Math.abs(i),this.vertical=!this.horizontal}else this.horizontal=!1,this.vertical=!1;this.horizontal&&(this.currentPoint.y=this.lastPoint.y),this.vertical&&(this.currentPoint.x=this.lastPoint.x),this.updateMark()}},updateMark:function(t){if(this.points&&this.points.size()>0&&this.currentPoint){this.mark||(this.mark=je.createCanvas(),this.network.getTopDiv().appendChild(this.mark));var e=new gn(this.points);e.add(this.currentPoint);var i=Ge.getRect(e),n=this.network.getEditLineWidth();Be.math.grow(i,n,n);var s=je.setCanvas(this.mark,i);s.lineWidth=n,s.strokeStyle=this.network.getEditLineColor(),s.beginPath(),qe.drawLinePoints(s,e),s.stroke()}}}),De.network.interaction.CreateShapeLinkInteraction=function(t,e){De.network.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,t),e||(e=De.ShapeLink),this.linkFunction=De.Util.isTypeOf(e,De.ShapeLink)?function(t,i,n){var s=new e;return s instanceof De.ShapeLink&&(s.setFromNode(t),s.setToNode(i),n&&s.setPoints(n)),s}:e},Be.ext("twaver.network.interaction.CreateShapeLinkInteraction",De.network.interaction.CreateLinkInteraction,{clear:function(){this.network.setEditingElement(!1),this.points=null,this.polyline&&(this.network.getTopDiv().removeChild(this.polyline),this.polyline=null),De.network.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(t){if(0===t.button){var e=this.network.getLogicalPoint(t);if(e)if(this.fromNode)if(this.toNode=this.currentNode,this.toNode){var i=this.createLink();i&&this.network.addElementByInteraction(i),this.clear()}else{if(this.points||(this.points=new gn),this.points.size()>0){var n=this.points.get(this.points.size()-1);if(n.x===e.x&&n.y===e.y)return}this.points.add(e),this.updateMark()}else this.fromNode=this.currentNode,this.fromNode&&(this.polyline||(this.polyline=je.createCanvas(),this.network.getTopDiv().appendChild(this.polyline))),this.points=null,this.currentNode=null,this.currentPoint=null,this.updateMark()}},updateLine:function(){if(this.currentPoint&&this.polyline){var t=new gn(this.points);t.add(this.fromNode.getCenterLocation(),0),t.add(this.currentPoint);var e=Ge.getRect(t),i=je.setCanvas(this.polyline,e);i.lineWidth=this.network.getEditLineWidth(),i.strokeStyle=this.network.getEditLineColor(),i.beginPath(),qe.drawLinePoints(i,t),i.stroke()}}}),De.network.interaction.CreateOrthogonalLinkInteraction=function(t,e,i,n,s,r){De.network.interaction.CreateOrthogonalLinkInteraction.superClass.constructor.call(this,t,e),this.linkType=i||"orthogonal",this.isByControlPoint=n,this.splitPercent=s,this.isSplitByPercent=r,this.link=new De.Link,this.link.setStyle("link.type",this.linkType),this.link.setStyle("link.split.by.percent",this.isSplitByPercent),bi.isFlexionalTypeLink(this.linkType)||bi.isExtendTypeLink(this.linkType)?(this.splitPercent<0&&(this.splitPercent=De.Styles.getStyle("link.extend")),this.link.setStyle("link.extend",this.splitPercent)):bi.isSplitTypeLink(this.linkType)&&(this.splitPercent<0&&(this.splitPercent=De.Styles.getStyle(this.isSplitByPercent?"link.split.percent":"link.split.value")),this.isSplitByPercent?this.link.setStyle("link.split.percent",this.splitPercent):this.link.setStyle("link.split.value",this.splitPercent))},Be.ext("twaver.network.interaction.CreateOrthogonalLinkInteraction",De.network.interaction.CreateLinkInteraction,{clear:function(){this.path&&(this.network.getTopDiv().removeChild(this.path),this.path=null),De.network.interaction.CreateOrthogonalLinkInteraction.superClass.clear.call(this)},createLink:function(){var t=De.network.interaction.CreateOrthogonalLinkInteraction.superClass.createLink.call(this);if(t.setStyle("link.type",this.linkType),t.setStyle("link.split.by.percent",this.isSplitByPercent),this.isByControlPoint){var e=bi.getControlPoint(t);if(e)return t.SetStyle("link.control.point",e),t}else bi.isFlexionalTypeLink(this.linkType)||bi.isExtendTypeLink(this.linkType)?(this.splitPercent<0&&(this.splitPercent=De.Styles.getStyle("link.extend")),t.setStyle("link.extend",this.splitPercent)):bi.isSplitTypeLink(this.linkType)&&(this.splitPercent<0&&(this.splitPercent=De.Styles.getStyle(this.isSplitByPercent?"link.split.percent":"link.split.value")),this.isSplitByPercent?t.setStyle("link.split.percent",this.splitPercent):t.setStyle("link.split.value",this.splitPercent));return t},updateLine:function(){if(this.currentPoint){if(!this.fromNode||this.currentNode===this.fromNode)return;var t,e=this.network.getElementUI(this.fromNode);if(!e)return;if(t=e.getBodyRect(),null==t)return;var i;if(this.currentNode&&this.currentNode!==this.fromNode){var n=this.network.getElementUI(this.currentNode);if(!n)return;i=n.getBodyRect()}else i={x:this.currentPoint.x,y:this.currentPoint.y,width:1,height:1};if(!i)return;var s=bi.calculateOrthogonalAndFlexionalLinkPoints(this.linkType,t,i,this.link);if(bi.drawCorner(s,this.link),s.size()<2)return;this.line||(this.line=je.createCanvas(),this.network.getTopDiv().appendChild(this.line));var r=je.setCanvas(this.line,Ge.getLineRect(s));r.lineWidth=this.network.getEditLineWidth(),r.strokeStyle=this.network.getEditLineColor(),r.beginPath(),qe.drawLinePoints(r,s),r.stroke()}else this.line&&(this.network.getTopDiv().removeChild(this.line),this.line=null)}}),De.network.interaction.MagnifyInteraction=function(t,e,i,n,s){De.network.interaction.MagnifyInteraction.superClass.constructor.call(this,t),this.zoom=e||2,this.xRadius=i||100,this.yRadius=n||100,this.shape=s||"circle",this.borderColor="black",this.borderWidth=1,this.backgroundColor="white",this.markCanvas=je.createCanvas(),this.markCanvas._isIgnored=!0},Be.ext("twaver.network.interaction.MagnifyInteraction",De.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove")},tearDown:function(){this.removeListener("mousemove"),
this._clear()},handle_mousemove:function(t){var e=this.network.getLogicalPoint(t);e&&(this.lastPoint||this.network.getView().appendChild(this.markCanvas),this.lastPoint=e,this.updateMark())},updateMark:function(){var t,e=this.network._zoom,i=this.zoom*e,n=this.lastPoint.x*e-this.xRadius,s=this.lastPoint.y*e-this.yRadius,r=2*this.xRadius,a=2*this.yRadius,o={x:this.lastPoint.x-this.xRadius/i,y:this.lastPoint.y-this.yRadius/i,width:r/i,height:a/i},h=this.borderWidth,l=je.createCanvas();l.width=r,l.height=a,this.network.toCanvasByRegion(o,i,l),je.setCanvas(this.markCanvas,n,s,r,a),t=this.markCanvas.getContext("2d"),t.save(),t.beginPath(),qe.drawVector(t,this.shape,null,n,s,r,a),t.clip(),t.fillStyle=this.backgroundColor,t.beginPath(),t.rect(n,s,r,a),t.fill(),t.drawImage(l,n,s),t.restore(),t.beginPath(),t.lineWidth=h,qe.drawVector(t,this.shape,null,n+h/2,s+h/2,r-h,a-h),t.strokeStyle=this.borderColor,t.stroke()},_clear:function(t){this.lastPoint&&(this.network.getView().removeChild(this.markCanvas),this.lastPoint=null)},getZoom:function(){return this.zoom},setZoom:function(t){this.zoom=t,this.updateMark()},getShape:function(){return this.shape},setShape:function(t){this.shape=t,this.updateMark()},getXRadius:function(){return this.xRadius},setXRadius:function(t){this.xRadius=t,this.updateMark()},getYRadius:function(){return this.yRadius},setYRadius:function(t){this.yRadius=t,this.updateMark()},getBorderColor:function(){return this.borderColor},setBorderColor:function(t){this.borderColor=t,this.updateMark()},getBorderWidth:function(){return this.borderWidth},setBorderWidth:function(t){this.borderWidth=t,this.updateMark()},getBackgroundColor:function(){return this.backgroundColor},setBackgroundColor:function(t){this.backgroundColor=t,this.updateMark()}}),De.network.interaction.TouchInteraction=function(t){De.network.interaction.TouchInteraction.superClass.constructor.call(this,t)},Be.ext("twaver.network.interaction.TouchInteraction",De.network.interaction.BaseInteraction,{setUp:function(){var t=this.network.getView();je.addEventListener("touchstart","handleTouchstart",t,this),je.addEventListener("touchmove","handleTouchmove",t,this),je.addEventListener("touchend","handleTouchend",t,this),je.addEventListener("touchcancel","handleTouchend",t,this)},tearDown:function(){var t=this.network.getView();je.removeEventListener("touchstart",t,this),je.removeEventListener("touchmove",t,this),je.removeEventListener("touchend",t,this),je.removeEventListener("touchcancel",t,this)},handleTouchstart:function(t){if(je.preventDefault(t),t.touches&&1==t.touches.length){var e=this.network.getLogicalPoint(t),i=this.network.getElementAt(e);this._startTouchTime=new Date,this._startTouchPoint=e;var n=this;i?(this._haveElementUnderTouch=!0,this._startTouchElement=i):(this._haveElementUnderTouch=!1,this._startTouchElement=null),this.timer=setTimeout(function(){Li.handleLongClicked(n.network,t,i)},1e3)}else t.touches&&2==t.touches.length&&(this._distance=Ci.getDistance(t),this._zoom=this.network.getZoom(),this._startTouchPoint={x:t.touches[0].clientX,y:t.touches[0].clientY});this._touchCount=t.touches.length},handleTouchmove:function(t){if(je.preventDefault(t),2==this._touchCount&&t.touches&&2==t.touches.length)if(this.timer&&clearTimeout(this.timer),Math.abs(this._distance-Ci.getDistance(t))>=kn.TOUCH_ZOOM_THRESHOLD||this._zoomFlag){this._zoomFlag=!0;var e=Ci.getDistance(t)/this._distance;this.network.setTouchZoom(this._zoom*e,!1)}else{var i=t.touches[0],n=this._startTouchPoint.x-i.clientX,s=this._startTouchPoint.y-i.clientY,r=this.network.panByOffset(n,s);this._startTouchPoint.x-=n-r.x,this._startTouchPoint.y-=s-r.y}else if(1==this._touchCount&&t.touches&&1==t.touches.length)if(this._haveElementUnderTouch||!this.network.isRectSelectEnabled()){var a=this.network.getLogicalPoint(t),o=this.network.getElementAt(a);if(this.network.isMovingElement()||null!=this._startTouchElement&&this._startTouchElement==o&&this.network.getMovableSelectedElements().contains(o)){var n=a.x-this._startTouchPoint.x,s=a.y-this._startTouchPoint.y;(Math.abs(n)>=kn.TOUCH_MOVE_THRESHOLD||Math.abs(s)>=kn.TOUCH_MOVE_THRESHOLD)&&(this._startTouchPoint=a,this.network.moveSelectedElements(n,s),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:t}),this.timer&&clearTimeout(this.timer)))}else{var n=a.x-this._startTouchPoint.x,s=a.y-this._startTouchPoint.y;(Math.abs(n)>=kn.TOUCH_MOVE_THRESHOLD||Math.abs(s)>=kn.TOUCH_MOVE_THRESHOLD)&&this.timer&&clearTimeout(this.timer)}}else{this._moveTouchPoint=this.network.getLogicalPoint(t);var n=this._moveTouchPoint.x-this._startTouchPoint.x,s=this._moveTouchPoint.y-this._startTouchPoint.y;if(Math.abs(n)>=kn.TOUCH_RECT_SELECT_THRESHOLD&&Math.abs(s)>=kn.TOUCH_RECT_SELECT_THRESHOLD){this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:t}):(this.mark=je.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:t}),this.timer&&clearTimeout(this.timer));var h=Ge.getRect([this._startTouchPoint,this._moveTouchPoint]);je.setDiv(this.mark,h,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())}}},handleTouchend:function(t){if(je.preventDefault(t),this.network.isMovingElement())this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:t});else if(this.network.isSelectingElement()){var e=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(e&&e.size()>0){var i=this.network.getSelectionModel(),n=i.toSelection();e.forEach(function(t){i.contains(t)?n.remove(t):n.add(t)},this),i.setSelection(n)}this.network.fireInteractionEvent({kind:"selectEnd",event:t}),this.network.getTopDiv().removeChild(this.mark),this.mark=null,this.network.setSelectingElement(!1),this.timer&&clearTimeout(this.timer)}else if(this._startTouchPoint){this._zoomFlag=!1;var s=new Date,r=this.network.getLogicalPoint(t),a=this.network.getElementAt(this._startTouchPoint);this._startTouchPoint&&r&&s.getTime()-this._startTouchTime.getTime()<=500&&Ge.getDistance(this._startTouchPoint,r)<=20&&(a?this.network.getSelectionModel().contains(a)||this.network.getSelectionModel().setSelection(a):this.network.getSelectionModel().clearSelection(),Li.handleClicked(this.network,t,a),this.timer&&clearTimeout(this.timer),this._endTouchTime&&s.getTime()-this._endTouchTime.getTime()<=500&&Ge.getDistance(this._endTouchPoint,r)<=20?(delete this._endTouchTime,delete this._endTouchPoint,Li.handleDoubleClicked(this.network,t,a),this.timer&&clearTimeout(this.timer)):(this._endTouchTime=s,this._endTouchPoint=r))}},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()||"contain"!==this.network.getSelectMode()&&(this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y)}}),De.network.interaction.MSTouchInteraction=function(t){De.network.interaction.MSTouchInteraction.superClass.constructor.call(this,t),this._pointerMap={},this._pointerIdArray=[]},Be.ext("twaver.network.interaction.MSTouchInteraction",De.network.interaction.BaseInteraction,{setUp:function(){var t=this.network.getView();je.addEventListener("MSPointerDown","handleTouchstart",t,this),je.addEventListener("MSPointerMove","handleTouchmove",t,this),je.addEventListener("MSPointerUp","handleTouchend",t,this),je.addEventListener("MSPointerCancel","handleTouchend",t,this)},tearDown:function(){var t=this.network.getView();je.removeEventListener("MSPointerDown",t,this),je.removeEventListener("MSPointerMove",t,this),je.removeEventListener("MSPointerUp",t,this),je.removeEventListener("MSPointerCancel",t,this)},handleTouchstart:function(t){if(this.network.isFocusOnClick()&&De.Util.setFocus(this.network._view),!this.network.isSelectingElement()||t.pointerType!=t.MSPOINTER_TYPE_MOUSE){var e=this.network.getLogicalPoint(t),i=new Date;if(t.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(t),this._pointerMap[t.pointerId]||(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t),1==this._pointerIdArray.length){var n=this.network.getElementAt(e);this._startTouchElement=n,this._startClientPoint={x:t.clientX,y:t.clientY},Li.handleClicked(this.network,t,n),this._startTouchTime&&this._startTouchPoint&&i.getTime()-this._startTouchTime.getTime()<=500&&Ge.getDistance(this._startTouchPoint,e)<=20?(Li.handleDoubleClicked(this.network,t,n),this._doubleClick=!0):(je.handle_mousedown(this,t),this._startTouchPoint=e,this._startTouchTime=i);var s=this.network.getSelectionModel();n?Be.isCtrlDown(t)?s.contains(n)?s.removeSelection(n):s.appendSelection(n):s.contains(n)||s.setSelection(n):Be.isCtrlDown(t)||s.clearSelection()}else 2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())}},handleTouchmove:function(t){if(null!=this._startTouchPoint&&0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(Ge.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=10)&&(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length)){var e=this._getDistance()/this._distance;this.network.setZoom(this._zoom*e,!1)}},handleTouchend:function(t){if(this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:t})),this.network.isSelectingElement()){var e=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(e&&e.size()>0){var i=this.network.getSelectionModel(),n=i.toSelection();e.forEach(function(t){i.contains(t)?n.remove(t):n.add(t)},this),i.setSelection(n)}this.network.fireInteractionEvent({kind:"selectEnd",event:t}),this.network.getTopDiv().removeChild(this.mark),this.mark=null,this.network.setSelectingElement(!1)}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);for(var s=-1,r=0;r<this._pointerIdArray.length;r++)if(this._pointerIdArray[r]==t.pointerId){s=r;break}s>=0&&this._pointerIdArray.splice(s,1),delete this._pointerMap[t.pointerId]},_getDistance:function(){return Ge.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()||"contain"!==this.network.getSelectMode()&&(this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y)},handle_mousemove:function(t){if(this._startTouchPoint&&1==this._pointerIdArray.length){if(this._moveTouchPoint={x:this._startTouchPoint.x+(t.clientX-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(t.clientY-this._startClientPoint.y)/this.network.getZoom()},Ge.getDistance(this._startTouchPoint,this._moveTouchPoint)<3)return;if(null==this._startTouchElement&&this.network.isRectSelectEnabled()){this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:t}):(this.mark=je.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:t}));var e=Ge.getRect([this._startTouchPoint,this._moveTouchPoint]);je.setDiv(this.mark,e,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())}else{var i=this.network.getElementAt(this._moveTouchPoint),n=this._moveTouchPoint.x-this._startTouchPoint.x,s=this._moveTouchPoint.y-this._startTouchPoint.y;null!=this._startTouchElement||this.network.isRectSelectEnabled()?(this.network.isMovingElement()||null!=this._startTouchElement&&i==this._startTouchElement&&this.network.getMovableSelectedElements().contains(i))&&(this.network.moveSelectedElements(n,s),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:t}))):this.network.panByOffset(-n,-s),this._startClientPoint.x=t.clientX,this._startClientPoint.y=t.clientY}}},handle_mouseup:function(t){this.handleTouchend(t),this._pointerIdArray=[],this._pointerMap={}}});var Un={_hitCanvas:null,getHitCanvas:function(t,e){null==this._hitCanvas&&(this._hitCanvas=je.createCanvas()),0==arguments.length&&(t=2,e=2),this._hitCanvas.setAttribute("width",""+t-1),this._hitCanvas.setAttribute("height",""+e-1),this._hitCanvas.setAttribute("width",""+t),this._hitCanvas.setAttribute("height",""+e);var i=this.getCtx(this._hitCanvas);return i.clearRect(0,0,t,e),this._hitCanvas},disposeHitCanvas:function(){this._hitCanvas=null},getCtx:function(t){return t.getContext("2d")},render:function(t,i,n){i!=e&&(t.fillStyle=i,t.fill()),n!=e&&(t.strokeStyle=n,t.stroke())},text:function(t,e,i,n,s,r){t.textAlign="center",t.textBaseline="middle",null!=s&&(t.fillStyle=s,t.fillText(e,i,n)),r&&(t.strokeStyle=r,t.strokeText(e,i,n))},circle:function(t,e,i,n,s,r){t.arc(e,i,n,0,2*Math.PI,!0),t.closePath(),this.render(t,s,r)},rect:function(t,e,i,n,s,r,a){t.rect(e,i,n,s),t.closePath(),this.render(t,r,a)},OUT_LEFT:1,OUT_TOP:2,OUT_RIGHT:4,OUT_BOTTOM:8,outcode:function(t,e,i,n,s,r){var a=0;return 0>=s?a|=this.OUT_LEFT|this.OUT_RIGHT:i>t?a|=this.OUT_LEFT:t>i+s&&(a|=this.OUT_RIGHT),0>=r?a|=this.OUT_TOP|this.OUT_BOTTOM:n>e?a|=this.OUT_TOP:e>n+r&&(a|=this.OUT_BOTTOM),a},intersectsLine:function(t,e,i,n,s,r,a,o){var h,l;if(0==(l=this.outcode(i,n,s,r,a,o)))return!0;for(;0!=(h=this.outcode(t,e,s,r,a,o));){if(0!=(h&l))return!1;if(0!=(h&(this.OUT_LEFT|this.OUT_RIGHT))){var c=s;0!=(h&this.OUT_RIGHT)&&(c+=a),e+=(c-t)*(n-e)/(i-t),t=c}else{var u=r;0!=(h&this.OUT_BOTTOM)&&(u+=o),t+=(u-e)*(i-t)/(n-e),e=u}}return!0}};De.canvas={},De.canvas.interaction={},De.canvas.Network=function(t){De.canvas.Network.superClass.constructor.apply(this,arguments),this._rootCanvas=je.createCanvas(),this._topCanvas=je.createCanvas(),this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0},this._zoom=1,this._elementUIMap={},this._visibleMap={},this.viewRect={x:0,y:0,width:0,height:0},this.hScrollBarVisible=!1,this.vScrollBarVisible=!1,this.markerList=new De.List,this._topAttachmentList=new De.List,this.setElementBox(t?t:new De.ElementBox),Oe||(this._view=je.createView("hidden"),this._view.appendChild(this._rootCanvas),this._view.appendChild(this._topCanvas),He.isTouchable?He.isMSTouchable?this.setMSTouchInteractions():this.setTouchInteractions():this.setDefaultInteractions(!1),this.setToolTipEnabled(De.Defaults.NETWORK_TOOLTIP_ENABLED));var e=this;this._flowLink=function(){if(!(e.isMovingElement()||e.isSelectingElement()||e.isEditingElement()||e._box._layoutMovingElements)){e._flowLinkQuickFinder||(e._flowLinkQuickFinder=new De.QuickFinder(e._box,"link.flow","style"));var t=e._flowLinkQuickFinder.find(!0);t.forEach(function(t){t._styleMap["link.flow.offset"]=e.getLinkFlowOffset(t);var i=e.getElementUI(t);i.invalidate(!1)})}},De.imageUtil.addEventListener(this.invalidateElementUIs,this)},Be.ext("twaver.canvas.Network",De.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","scrollBarWidth","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointSize","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","rotatePointSize","rotatePointFillColor","rotatePointOffset","rotatePointOutlineWidth","rotatePointOutlineColor","rotateScaleFillColor","rotateScaleFontColor","rotateScaleWidth","rotateScaleHeight","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter","paddingRight","paddingBottom","selectionTolerance"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","scrollBarVisible","limitViewInCanvas","autoValidateCanvasSize","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","rotatingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation","showRotateScale","transparentSelectionEnable","debug","showShadowInEdit"],_currentSubNetwork:null,_subNetworkAnimate:De.Defaults.NETWORK_SUBNETWORK_ANIMATE,_scrollBarWidth:10,_scrollBarVisible:!0,_limitViewInCanvas:!0,_autoValidateCanvasSize:!0,_makeVisibleOnSelected:De.Defaults.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:De.Defaults.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:De.Defaults.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:kn.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_elementUIFunction:De.Defaults.CANVASUI_FUNCTION,_doubleClickToUpSubNetwork:De.Defaults.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:De.Defaults.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:De.Defaults.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:De.Defaults.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:De.Defaults.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_selectOutlineColor:De.Defaults.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:De.Defaults.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:De.Defaults.NETWORK_SELECT_FILL_COLOR,_sendToTopOnSelected:De.Defaults.NETWORK_SENDTOTOP_ON_SELECTED,_lazyMoveOutlineColor:De.Defaults.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:De.Defaults.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:De.Defaults.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:De.Defaults.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:De.Defaults.NETWORK_LAZYMOVE_ANIMATE,_resizePointSize:De.Defaults.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:De.Defaults.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:De.Defaults.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:De.Defaults.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:De.Defaults.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:De.Defaults.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:De.Defaults.NETWORK_RESIZE_ANIMATE,_editPointSize:De.Defaults.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:De.Defaults.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:De.Defaults.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:De.Defaults.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:De.Defaults.NETWORK_EDIT_LINE_COLOR,_editLineWidth:De.Defaults.NETWORK_EDIT_LINE_WIDTH,_rotatePointSize:De.Defaults.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:De.Defaults.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:De.Defaults.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:De.Defaults.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:De.Defaults.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:kn.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:kn.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:kn.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:kn.NETWORK_ROTATE_SCALE_FONT_COLOR,_limitElementInPositiveLocation:kn.NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION,_linkFlowInterval:kn.NETWORK_LINK_FLOW_INTERVAL,_selectionTolerance:kn.NETWORK_SELECTION_TOLERANCE,_invalidateElementVisibility:!1,_invalidateViewRectFlag:!1,_repaintTopFlag:!1,_invalidateCanvasSizeFlag:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_paddingRight:0,_paddingBottom:0,_transparentSelectionEnable:De.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,_debug:!1,_showShadowInEdit:!1,adjustBounds:function(t){if(Oe)this._rootCanvas=new ze(t.width,t.height),this._topCanvas=new ze(t.width,t.height),this.setViewRect(t.x,t.y,t.width,t.height);else{var e=!1,i=this._view.style;if(i.left==t.x+"px"&&i.top==t.y+"px"&&i.width==t.width+"px"&&i.height==t.height+"px"&&(e=!0),De.canvas.Network.superClass.adjustBounds.apply(this,arguments),1==e)return;var n=this._view.offsetWidth,s=this._view.offsetHeight;this._rootCanvas.setAttribute("width",n),this._rootCanvas.setAttribute("height",s),this._topCanvas.setAttribute("width",n),this._topCanvas.setAttribute("height",s),this.setViewRect(this.viewRect.x,this.viewRect.y,n,s)}"undefined"==typeof De.gis&&(De.Util.makeHighRes(this._rootCanvas),De.Util.makeHighRes(this._topCanvas)),this.invalidateElementVisibility()},getLabel:function(t){return t.getStyle("network.label")||t.getName()},getBackgroundImage:function(){return this._backgroundImage},setBackgroundImage:function(t){if(this._backgroundImage!=t){var e=this._backgroundImage;this._backgroundImage=t;var i=this._backgroundImage;if(i&&!i._viewRect)if(i.width>0)i._viewRect={x:0,y:0,width:i.width,height:i.height},this.validateCanvasSize(),this.firePropertyChange("backgroundImage",e,i);else{var n=this;i.onload=function(){i._viewRect={x:0,y:0,width:i.width,height:i.height},n.validateCanvasSize(),n.firePropertyChange("backgroundImage",e,i),i.onload=null}}else this.firePropertyChange("backgroundImage",e,i),this.validateCanvasSize()}},getRootCanvas:function(){return this._rootCanvas},getTopCanvas:function(){return this._topCanvas},validateImpl:function(){if(!Oe&&gi.twm(this),1==this._invalidateElementVisibility){this._invalidateElementVisibility=!1;var t,e,i,n=this.getElementBox().getDatas()._as,s=n.length,r={},a=this._visibleFunction,o=1===this._box._layerBox.size()?this._box._layerBox._defaultLayer:null;for(t=0;s>t;t++)e=n[t],r[e._id]=this.isVisible(e,a,o);if(this._visibleMap)for(t=0;s>t;t++)e=n[t],r[e._id]!==this._visibleMap[e._id]&&(i=this._elementUIMap[e._id],i&&i.invalidate());for(t=0;s>t;t++)e=n[t],i=this._elementUIMap[e._id],i&&i.validate();this._visibleMap=r,this.paintRoot()}this.validateCanvasSize(),1==this._repaintTopFlag&&(this._repaintTopFlag=!1,this.paintTopCanvas())},isLinkFlowEnabled:function(){return!!this._linkFlowEnabled},setLinkFlowEnabled:function(t){t?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange("linkFlowEnabled",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange("linkFlowEnabled",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(t){var e=this._linkFlowInterval;this._linkFlowInterval=t,this.firePropertyChange("linkFlowInterval",e,t),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getElementBox:function(){return this._box},setElementBox:function(t){if(!t)throw"ElementBox can not be null";if(this._box!==t){var e=this._box;e&&(e.removeDataBoxChangeListener(this.handleElementBoxChange,this),e.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),e.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),e.removeIndexChangeListener(this.handleIndexChange,this),e.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),e.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),e.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||e.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=t,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new De.QuickFinder(this._box,"link.flow","style")),this._selectionModel?this._selectionModel._setDataBox(t):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.firePropertyChange("elementBox",e,this._box)}},handleElementBoxChange:function(t){var e=t.data;if("add"===t.kind)this.createElementUI(e),this.invalidateBundleLink(e);else if("remove"===t.kind){var i=this.getElementUI(e);i&&(i.dispose(),delete this._elementUIMap[e.getId()]),e===this._currentSubNetwork&&null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null)}else"clear"===t.kind&&(this._elementUIMap={},null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null));this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementPropertyChange:function(t){var e=t.source,i=this.getElementUI(e);i&&i.handlePropertyChange(t),this.invalidateBundleLink(e),this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementBoxPropertyChange:function(){this.invalidateElementVisibility()},handleIndexChange:function(t){this.invalidateElementVisibility()},handleLayerBoxChange:function(){this.invalidateElementVisibility()},handleLayerPropertyChange:function(t){"editable"===t.property&&this.invalidateSelectedElementUIs(!0),this.invalidateElementVisibility()},handleLayerHierarchyChange:function(){this.invalidateElementVisibility()},handleSelectionChange:function(t){t.datas.forEach(function(e){var i=this.getElementUI(e);i&&i.handleSelectionChange(t)},this);var e=this.getSelectionModel().getLastData();e&&("append"===t.kind||"set"===t.kind)&&(this.isMakeVisibleOnSelected()&&this.makeVisible(e),this.isSendToTopOnSelected()&&this.sendToTop(e)),this.invalidateElementVisibility()},sendToTop:function(t){if(this._box.contains(t)){for(var e=t;e._parent&&this.isVisible(e._parent)&&(e=e._parent););e!==t&&this._box.adjustElementIndex(e),this._box.adjustElementIndex(t)}},getViewRect:function(){return this.viewRect?Be.clone(this.viewRect):{x:0,y:0,width:0,height:0}},getCanvasSize:function(){return{width:this.realWidth,height:this.realHeight}},setViewOffSet:function(t,e){var i=this.viewRect.x,n=this.viewRect.y,s=this.viewRect.width,r=this.viewRect.height;this.setViewRect(i+t,n+e,s,r)},setViewRect:function(t,e,i,n){1==this.isLimitViewInCanvas()&&(0>t&&(t=0),i>this.realWidth?t=0:t+i>this.realWidth&&(t=this.realWidth-i),0>e&&(e=0),n>this.realHeight?e=0:e+n>this.realHeight&&(e=this.realHeight-n));var s=this.viewRect;(null==this.viewRect||t!=this.viewRect.x||e!=this.viewRect.y||i!=this.viewRect.width||n!=this.viewRect.height)&&(this.viewRect={x:t,y:e,width:i,height:n},this.firePropertyChange("viewRect",s,this.viewRect),this.invalidateElementVisibility())},isHScrollBarVisible:function(){return this.hScrollBarVisible},setHScrollBarVisible:function(t){this.hScrollBarVisible=t},isVScrollBarVisible:function(){return this.vScrollBarVisible},setVScrollBarVisible:function(t){this.vScrollBarVisible=t},dispose:function(){De.imageUtil.removeEventListener(this.invalidateElementUIs,this);for(var t in this._elementUIMap){var e=this._elementUIMap[t];e.curInterval&&clearTimeout(e.curInterval)}},invalidateElementVisibility:function(){this._invalidateElementVisibility||(this._invalidateElementVisibility=!0,this.invalidate())},repaintTopCanvas:function(){this._repaintTopFlag||(this._repaintTopFlag=!0,this.invalidate())},invalidateCanvasSize:function(t){this._invalidateCanvasSizeFlag||(this._invalidateCanvasSizeFlag=!0,this.invalidate())},validateCanvasSize:function(){0!=this._invalidateCanvasSizeFlag&&(this._invalidateCanvasSizeFlag=!1,this._validateCanvasSize())},_validateCanvasSize:function(){if(!this.isMovingElement()){if(0==this.isAutoValidateCanvasSize())return this.realWidth=0,this.realHeight=0,void(this._unionBounds={x:0,y:0,width:0,height:0});var t=this.getElementBox().getDatas(),e=t.size();if(e>0){for(var i={x:0,y:0,width:0,height:0},n=0;e>n;n++){var s=t.get(n);if(this._visibleMap[s._id]){var r=this._elementUIMap[s._id];r&&(i=Ge.unionRect(i,r._viewRect))}}var a=this.getBackgroundImage();if(a&&(i=Ge.unionRect(i,a._viewRect)),i.x<0&&(i.width+=i.x,i.x=0),i.y<0&&(i.height+=i.y,i.y=0),this.realWidth==(i.x+i.width)*this.getZoom()&&this.realHeight==(i.y+i.height)*this.getZoom())return;var o=this.getZoom();this.realWidth=(i.x+i.width)*o+this._paddingRight,this.realHeight=(i.y+i.height)*o+this._paddingBottom,this._unionBounds={x:i.x*o,y:i.y*o,width:i.width*o+this._paddingRight,height:i.height*o+this._paddingRight}}else this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0};this.setViewRect(this.viewRect.x,this.viewRect.y,this.viewRect.width,this.viewRect.height),this.firePropertyChange("canvasSizeChange",null,this.viewRect)}},getElementUI:function(t){return null==t?null:this._elementUIMap[t._id]},createElementUI:function(t){var e=this._elementUIMap[t.getId()];e||(e=this._elementUIFunction(this,t),e&&(this._elementUIMap[t.getId()]=e))},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(t){if(!t)throw"ElementUIFunction can not be null";if(this._elementUIFunction!==t){var e=this._elementUIFunction;this._elementUIFunction=t,this.firePropertyChange("elementUIFunction",e,t),this._box.isEmpty()||(this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize())}},invalidateElementUI:function(t,e){var i=this.getElementUI(t);i&&i.invalidate(e)},invalidateElementUIs:function(t){for(var e in this._elementUIMap){var i=this._elementUIMap[e];i.invalidate(t)}},invalidateSelectedElementUIs:function(t){this.getSelectionModel().getSelection().forEach(function(e){this.invalidateElementUI(e,t)},this)},invalidateBundleLink:function(t){if(t instanceof De.Link&&t._bundleLinks){var e=this._elementUIMap;t._bundleLinks.forEachSiblingLink(function(i){if(i!==t){var n=e[i._id];n&&n.invalidate(!1)}},this)}},paintRoot:function(){var t=this._rootCanvas.getContext("2d");if(t.clearRect(0,0,this._rootCanvas.width,this._rootCanvas.height),this.visibleList=new De.List,this._topAttachmentList=new De.List,null!=this.getElementBox()){dn.draw(t,this);var i=this.getElementBox().getDatas()._as,n=i.length;t.save(),t.scale(this.getZoom(),this.getZoom()),t.translate(-this.viewRect.x/this.getZoom(),-this.viewRect.y/this.getZoom()),this.paintBottom(t);var s={x:this.viewRect.x/this.getZoom(),y:this.viewRect.y/this.getZoom(),width:this.viewRect.width/this.getZoom(),height:this.viewRect.height/this.getZoom()},r=this.getBackgroundImage(),a=this.getBackgroundImageRect();if(r instanceof Ue&&(a?t.drawImage(r,a.x,a.y,a.width,a.height):t.drawImage(r,0,0,r.width,r.height),r._viewRect={x:0,y:0,width:r.width,height:r.height}),"string"==typeof r){var o=Be.getImageAsset(r),h={x:0,y:0,width:o.getWidth(),height:o.getHeight()};Fi(t,r,null,h,null,this)}var l,c,u,d,f=this._box._layerBox;if(1===f.size())for(l=0;n>l;l++)c=i[l],this._visibleMap[c._id]&&(u=this._elementUIMap[c._id],null!=u&&this._isInView(u,s)?(u.paint(t),u.setAttachmentVisible&&u.setAttachmentVisible(!0),this.visibleList.add(c)):u.setAttachmentVisible&&u.setAttachmentVisible(!1));else f.forEachByDepthFirst(function(e){for(l=0;n>l;l++)c=i[l],f.getLayerByElement(c)===e&&this._visibleMap[c._id]&&(u=this._elementUIMap[c._id],null!=u&&this._isInView(u,s)?(u.paint(t),u.setAttachmentVisible&&u.setAttachmentVisible(!0),this.visibleList.add(c)):u.setAttachmentVisible&&u.setAttachmentVisible(!1))},null,this);for(n=this._topAttachmentList.size(),l=0;n>l;l++)d=this._topAttachmentList.get(l),
d.getElementUI().paintAttachment(t,d);if(this._xyz){var n,g=this._xyz,_=g.markText,p=g.type,v=(g.expired,g.innerHTML),m=0,y=0,A=this.viewRect;t.translate(this.viewRect.x/this.getZoom(),this.viewRect.y/this.getZoom()),t.scale(1/this.getZoom(),1/this.getZoom()),this.getZoom(),_!=e&&null!=_&&""!=_||"2"==p?(t.font="15px Arial sans-serif",n=Be.g.getTextSize(t.font,v),t.fillStyle="red",m=A.width-n.width,y=A.height-20):(t.font="10px Arial sans-serif",n=Be.g.getTextSize(t.font,v),m=A.width/2-n.width/2,y=A.height/2),t.fillText(v,m,y)}t.restore()}},paintBottom:function(t){},_isInView:function(t,e){return Ge.intersects(e,t._viewRect)},paintTopCanvas:function(){var t=this._topCanvas.getContext("2d");t.clearRect(0,0,this._topCanvas.width,this._topCanvas.height),this.paintMarker(t)},paintMarker:function(t){for(var e=this.markerList.size(),i=0;e>i;i++){var n=this.markerList.get(i);n.paint(t)}},getLayerByElement:function(t){return this._box.getLayerBox().getLayerByElement(t)},getLogicalPoint:function(t){var e;if(He.isTouchable&&t.changedTouches&&t.changedTouches.length>0){var i=this._view.getBoundingClientRect(),n=t.changedTouches[0],s=He.isAndroid?0:Ci.scrollLeft(),r=He.isAndroid?0:Ci.scrollTop();return e={x:(n.clientX+this.viewRect.x-i.left-s)/this._zoom,y:(n.clientY+this.viewRect.y-i.top-r)/this._zoom}}return e=He.isFirefox?{x:(t.layerX+this.viewRect.x)/this.getZoom(),y:(t.layerY+this.viewRect.y)/this.getZoom()}:{x:(t.offsetX+this.viewRect.x)/this.getZoom(),y:(t.offsetY+this.viewRect.y)/this.getZoom()}},getElementAt:function(t,e){if(null==this.visibleList)return null;1===arguments.length&&(e=!0);var i,n;if(t.target?i=this.getLogicalPoint(t):t.event?t.event.target&&(i=this.getLogicalPoint(t.event)):i=t,null!=this._topAttachmentList)for(var s=this._topAttachmentList.size(),r=s-1;r>=0;r--){var a=this._topAttachmentList.get(r);if(n=a.getElement(),(!e||this.isSelectable(n))&&a.hit(i.x,i.y))return n}if(null!=this.visibleList)for(var o=this.visibleList.size(),h=o-1;h>=0;h--){var l=this.visibleList.get(h),c=this.getElementUI(l);if((!e||this.isSelectable(l))&&c&&c.hit(i.x,i.y))return l}return null},hitTest:function(t){var e=this.getElementAt(t);if(!e)return null;var i=this.getElementUI(e);if(!i)return null;var n;return n=t.target?this.getLogicalPoint(t):t,i.hitTest(n.x,n.y)},getElementsAtRect:function(t,i,n,s){var r=new De.List;if(null==this.visibleList)return r;s=s===e||s;for(var a=this.visibleList.size(),o=a-1;o>=0;o--){var h=this.visibleList.get(o),l=this.getElementUI(h);l&&(!n||n(l._element))&&(s&&this.isSelectable(l._element)||!s)&&(i?l.intersects(t)&&r.add(h):Ge.contains(t,l.getViewRect())&&r.add(h))}return r},getPosition:function(t,e,i,n,s){var r,a=e instanceof De.canvas.ElementUI?e:this.getElementUI(e);if(a)if("from"===t||"to"===t){if(a.getFromPosition&&(r="from"===t?a.getFromPosition(n,s):a.getToPosition(n,s)))return i?{x:r.x-i.width/2,y:r.y-i.height/2}:r}else r="hotspot"===t?a.getHotSpot():Ye.get(t,a.getBodyRect(),i);if(!r&&e.getRect&&(r=Ye.get(t,e.getRect(),i)),r)return{x:r.x+n,y:r.y+s};throw"position '"+t+"' object '"+e+"'"},isValidEvent:function(t){if(!t)return!1;var e,i;if(t.currentTarget===this._view){if(He.isFirefox?(e=t.layerX,i=t.layerY):(e=t.offsetX,i=t.offsetY),1==this.isHScrollBarVisible()&&i>=this.viewRect.height-this.getScrollBarWidth())return!1;if(1==this.isVScrollBarVisible()&&e>=this.viewRect.width-this.getScrollBarWidth())return!1}return!0},addMarker:function(t){this.markerList.add(t),this.repaintTopCanvas()},removeMarker:function(t){this.markerList.remove(t),this.repaintTopCanvas()},clearMarker:function(){this.markerList.clear(),this.repaintTopCanvas()},isMovable:function(t){return!!this._box.contains(t)&&(!(t instanceof De.Link)&&(!(this._movableFunction&&!this._movableFunction(t))&&this.getLayerByElement(t).isMovable()))},hasMovableSelectedElements:function(){for(var t=this.getSelectionModel().getSelection(),e=0;e<t.size();e++){var i=t.get(e);if(this.isMovable(i))return!0}return!1},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(t){return this.isMovable(t)},this)},moveSelectedElements:function(t,e,i,n){if(0!==t||0!==e){var s=this.getMovableSelectedElementsRect();null!=s&&(this._limitElementInPositiveLocation&&(s.x+t<0&&(t=-s.x),s.y+e<0&&(e=-s.y)),De.Util.moveElements(this.getMovableSelectedElements(),t,e,i,n,this))}},getMovableSelectedElementsRect:function(){var t=this.getMovableSelectedElements();if(0===t.size())return null;for(var e=null,i=0,n=t.size();n>i;i++){var s=t.get(i);if(s instanceof On){var r=this.getElementUI(s);r&&(e=Ge.unionRect(e,r.getViewRect()))}}return e},isVisible:function(t,e,i){if(!this._box.contains(t))return!1;if(!t.isVisible())return!1;if(3!==arguments.length&&(e=this._visibleFunction),e&&!e(t))return!1;if(!(i||this._box._layerBox.getLayerByElement(t))._visible)return!1;if(xi.getSubNetwork(t)!==this._currentSubNetwork)return!1;if(t instanceof De.Link){if(!this._noAgentLinkVisible){if(!t._fromAgent||!t._toAgent)return!1;if(!this.isVisible(t._fromAgent,e,i)||!this.isVisible(t._toAgent,e,i))return!1}if(t.getBundleIndex()>0&&t.getBundleCount()>1&&!t.getStyle("link.bundle.expanded"))return!1}else for(var n=t._parent;n&&!n.ISubNetwork;){if(n instanceof De.Group&&(!n.isExpanded()||!this.isVisible(n,e,i)))return!1;n=n._parent}return!t.IDummy},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(t){var e=this._visibleFunction;this._visibleFunction=t,this.firePropertyChange("visibleFunction",e,t),this.invalidateElementVisibility()},isEditable:function(t){return!!this._box.contains(t)&&(!(this._editableFunction&&!this._editableFunction(t))&&this.getLayerByElement(t).isEditable())},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(t){var e=this._editableFunction;this._editableFunction=t,this.firePropertyChange("editableFunction",e,t),this.invalidateSelectedElementUIs(!0)},isRotatable:function(t){return!(this._rotatableFunction&&!this._rotatableFunction(t))},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(t){var e=this._rotatableFunction;this._rotatableFunction=t,this.firePropertyChange("rotatableFunction",e,t),this.invalidateSelectedElementUIs(!0)},isLinkable:function(t){return null==this._linkableFunction||this._linkableFunction(t)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(t){var e=this._linkableFunction;this._linkableFunction=t,this.firePropertyChange("linkableFunction",e,t),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getShadowColor:function(t){var e=t.getStyle("shadow.color");return!e&&this.isSelected(t)&&"shadow"===t.getStyle("select.style")?t.getStyle("select.color"):e},getSelectColor:function(t){return t.getStyle("select.color")},getAlarmLabel:function(t){var e=t.getAlarmState().getHighestNewAlarmSeverity();if(e){var i=t.getAlarmState().getNewAlarmCount(e)+e.nickName;return t.getAlarmState().hasLessSevereNewAlarms()&&(i+="+"),i}return null},getLinkHandlerLabel:function(t){return t.isBundleAgent()?"+("+t.getBundleCount()+")":null},setInteractions:function(t){var e=this._interactions;e&&e.forEach(function(t){t.tearDown()}),this._interactions=t,t&&t.forEach(function(t){t.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",e,t)},getInteractions:function(){return this._interactions},setDefaultInteractions:function(t){this.setInteractions([new De.canvas.interaction.DefaultInteraction(this),new De.canvas.interaction.SelectInteraction(this),new De.canvas.interaction.MoveInteraction(this,t),new De.canvas.interaction.ScrollInteraction(this)])},setTouchInteractions:function(){this.setInteractions([new De.canvas.interaction.DefaultInteraction(this),new De.canvas.interaction.SelectInteraction(this),new De.canvas.interaction.MoveInteraction(this,(!1)),new De.canvas.interaction.ScrollInteraction(this),new De.canvas.interaction.TouchInteraction(this)])},setMSTouchInteractions:function(){this.setInteractions([new De.canvas.interaction.ScrollInteraction(this),new De.canvas.interaction.MSTouchInteraction(this)])},setEditInteractions:function(t){this.setInteractions([new De.canvas.interaction.DefaultInteraction(this),new De.canvas.interaction.SelectInteraction(this),new De.canvas.interaction.EditInteraction(this,t),new De.canvas.interaction.MoveInteraction(this,t),new De.canvas.interaction.ScrollInteraction(this)])},setCreateElementInteractions:function(t){this.setInteractions([new De.canvas.interaction.DefaultInteraction(this),new De.canvas.interaction.CreateElementInteraction(this,t)])},setCreateLinkInteractions:function(t){this.setInteractions([new De.canvas.interaction.DefaultInteraction(this),new De.canvas.interaction.CreateLinkInteraction(this,t),new De.canvas.interaction.ScrollInteraction(this)])},setCreateShapeLinkInteractions:function(t){this.setInteractions([new De.canvas.interaction.DefaultInteraction(this),new De.canvas.interaction.CreateShapeLinkInteraction(this,t),new De.canvas.interaction.ScrollInteraction(this)])},setCreateShapeNodeInteractions:function(t){this.setInteractions([new De.canvas.interaction.DefaultInteraction(this),new De.canvas.interaction.CreateShapeNodeInteraction(this,t),new De.canvas.interaction.ScrollInteraction(this)])},setPanInteractions:function(){this.setInteractions([new De.canvas.interaction.DefaultInteraction(this),new De.canvas.interaction.PanInteraction(this),new De.canvas.interaction.ScrollInteraction(this)])},setMagnifyInteractions:function(){this.setInteractions([new De.canvas.interaction.DefaultInteraction(this),new De.canvas.interaction.SelectInteraction(this),new De.canvas.interaction.MoveInteraction(this),new De.canvas.interaction.ScrollInteraction(this),new De.canvas.interaction.MagnifyInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(t){var e=this._hasEditInteraction;this._hasEditInteraction=t,this.firePropertyChange("hasEditInteraction",e,t)},addElementByInteraction:function(t){t.getParent()||t.setParent(this._currentSubNetwork),this._box.add(t),this.getSelectionModel().setSelection(t),this.fireInteractionEvent({kind:"createElement",element:t})},getToolTip:function(t){if(t){var e=t.getToolTip();return e?e:t.getName()}return null},isToolTipEnabled:function(){return!!this._toolTipEnabled},setToolTipEnabled:function(t){if(this._toolTipEnabled=t,t){if(!this._toolTipListener){var e=this;this._toolTipListener=function(t){if(e.isMovingElement())return void Ei.hideToolTip();var i=e.getElementAt(t);if(e._preElement!==i)if(e._preElement=i,i){var n=e.getToolTip(i);Ei.showToolTip({x:t.pageX,y:t.pageY},n);var s=Ei.getToolTipDiv(),s=Ei.getToolTipDiv();if(s.children.length>0){var r=e._view.getBoundingClientRect(),a=s.getBoundingClientRect();a.width+a.left>r.width+r.left&&(s.style.left=r.width+r.left-a.width+(Ve.documentElement.scrollLeft||Ve.body.scrollLeft)+"px"),a.height+a.top>r.height+r.top&&(s.style.top=r.height+r.top-a.height+(Ve.documentElement.scrollTop||Ve.body.scrollTop)+"px")}}else Ei.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!1),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Ei.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!1),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},setZoom:function(t){t=this.checkZoom(t);var e=this._zoom;if(this._zoom!=t){var i={x:(this.viewRect.x+this.viewRect.width/2)/this.getZoom()*t,y:(this.viewRect.y+this.viewRect.height/2)/this.getZoom()*t};this._zoom=t,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.validateCanvasSize(),this.setViewRect(i.x-this.viewRect.width/2,i.y-this.viewRect.height/2,this.viewRect.width,this.viewRect.height),this.firePropertyChange("zoom",e,this._zoom)}},getZoom:function(){return this._zoom},setTouchZoom:function(t){this.setZoom(t,!1)},zoomOverview:function(t){if(!(this.realWidth<=0||this.realHeight<=0)){var e=this.realWidth/this.getZoom(),i=this.realHeight/this.getZoom(),n=this.viewRect.width/e,s=this.viewRect.height/i,r=Math.min(n,s);this.setZoom(r)}},zoomReset:function(){this.setZoom(1)},zoomIn:function(){this.setZoom(1.2*this.getZoom())},zoomOut:function(){this.setZoom(this.getZoom()/1.2)},upSubNetwork:function(t,e){this._currentSubNetwork&&this.setCurrentSubNetwork(xi.getSubNetwork(this._currentSubNetwork),t,e)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(t,e,i){if(De.animate.AnimateManager.endAnimate(),e){if(this._currentSubNetwork===t)return;if(t&&!this._box.contains(t))throw t+" is not contained in this network's elementBox";var n=new De.animate.AnimateSubNetwork(this,t,i);De.animate.AnimateManager.start(n)}else this._setCurrentSubNetwork(t),i&&i()},_setCurrentSubNetwork:function(t){if(this._currentSubNetwork!==t){if(t&&!this._box.contains(t))throw t+" is not contained in this network's elementBox";var e=this._currentSubNetwork;this._currentSubNetwork=t,this.firePropertyChange("currentSubNetwork",e,t),this.invalidateElementVisibility(),this.invalidateCanvasSize()}},makeVisible:function(t){var e=this.getElementUI(t);if(e){var i=xi.getSubNetwork(t);if(i!==this._currentSubNetwork){var n=this;return void this.setCurrentSubNetwork(i,this.isSubNetworkAnimate(),function(){Be.callLater(n.makeVisible,n,[t])})}for(var s=t;(s=s.getParent())&&s!==i;)s instanceof De.Group&&s.setExpanded(!0);var r=e.getViewRect();if(r){var a={x:r.x*this.getZoom(),y:r.y*this.getZoom(),width:r.width*this.getZoom(),height:r.height*this.getZoom()};Ge.intersects(this.viewRect,a)||this.isVisible(t)&&Be.callLater(this.centerByLogicalPoint,this,[a.x+a.width/2,a.y+a.height/2])}}},centerByLogicalPoint:function(t,e,i){var n=t-this.viewRect.width/2,s=e-this.viewRect.height/2;this.setViewRect(n,s,this.viewRect.width,this.viewRect.height)},panByOffset:function(t,e){this.setViewOffSet(t,e)},getIconsNames:function(t){return t.getStyle("icons.names")},getIconsColors:function(t){return t.getStyle("icons.colors")},getLinkFlowStepping:function(t){var e=parseInt(t.getStyle("link.flow.stepping"));return e||(e=kn.NETWORK_LINK_FLOW_STEPPING),e},getLinkFlowOffset:function(t){var e=t.getStyle("link.flow.offset");return isNaN(e)&&(e=0),e+this.getLinkFlowStepping(t)},toCanvas:function(t,e,i){i||(i=je.createCanvas()),i.setAttribute("width",t),i.setAttribute("height",e),i._viewRect?(i._viewRect.width=t,i._viewRect.height=e):i._viewRect={x:0,y:0,width:t,height:e};var n=i.getContext("2d");if(n.clearRect(0,0,t,e),dn.draw(n,this),0===this._view.clientWidth||0===this._view.clientHeight)return i;var s=t/this.realWidth*this._zoom,r=e/this.realHeight*this._zoom;n.scale(s,r);var a=this.getBackgroundImage();if(a&&a._viewRect){var o=a._viewRect;try{n.drawImage(a,o.x,o.y,o.width,o.height)}catch(h){}}var l=this.getElementBox().getDatas()._as,c=l.length;this._topAttachmentList=new De.List;var u,d,f,g,_,p,v=this.getElementBox().getLayerBox(),m=v.getRoots(),y=m.size();if(1===y)for(f=0;c>f;f++)g=l[f],this._visibleMap[g._id]&&(_=this._elementUIMap[g._id],null!=_&&_.paint(n));else for(u=0;y>u;u++)for(d=m.get(u),f=0;c>f;f++)g=l[f],v.getLayerByElement(g)===d&&this._visibleMap[g._id]&&(_=this._elementUIMap[g._id],null!=_&&_.paint(n));for(c=this._topAttachmentList.size(),f=0;c>f;f++)p=this._topAttachmentList.get(f),p.getElementUI().paintAttachment(n,p);return i},toCanvasByRegion:function(t,e,i){i||(i=je.createCanvas());var n=t.width*e,s=t.height*e;i.setAttribute("width",n),i.setAttribute("height",s),i._viewRect?(i._viewRect.width=n,i._viewRect.height=s):i._viewRect={x:0,y:0,width:n,height:s};var r=i.getContext("2d");if(r.clearRect(0,0,n,s),dn.draw(r,this),0===this._view.clientWidth||0===this._view.clientHeight)return i;r.save(),r.scale(e,e),r.beginPath(),r.translate(-t.x,-t.y);var a=this.getElementBox().getDatas()._as,o=a.length;this._topAttachmentList=new De.List;var h=this.getBackgroundImage();if(h&&h._viewRect&&Ge.intersects(t,h._viewRect)){var t=Ge.intersection(t,h._viewRect),l=h._viewRect;try{r.drawImage(h,l.x,l.y,l.width,l.height)}catch(c){}}var u,d,f,g,_,p,v=this.getElementBox().getLayerBox(),m=v.getRoots(),y=m.size();if(1===y)for(f=0;o>f;f++)g=a[f],this._visibleMap[g._id]&&(_=this._elementUIMap[g._id],null!=_&&Ge.intersects(t,_._viewRect)&&_.paint(r));else for(u=0;y>u;u++)for(d=m.get(u),f=0;o>f;f++)g=a[f],v.getLayerByElement(g)===d&&this._visibleMap[g._id]&&(_=this._elementUIMap[g._id],null!=_&&Ge.intersects(t,_._viewRect)&&_.paint(r));for(o=this._topAttachmentList.size(),f=0;o>f;f++)p=this._topAttachmentList.get(f),p.getElementUI().paintAttachment(r,p);return r.restore(),i},getGroupChildrenRects:function(t){var e=new gn;return t.getChildren().forEach(function(t){if(t instanceof On){var i=this.getElementUI(t);if(i){var n=i.getViewRect();n&&e.add(n)}}},this),e},getBackgroundImageRect:function(){return null},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(t){var e=this._linkPathFunction;this._linkPathFunction=t,this.firePropertyChange("linkPathFunction",e,t),this.invalidateElementUIs()},onClickElement:function(t,e){},onClickBackground:function(t){},onDoubleClickElement:function(t,e){},onDoubleClickBackground:function(t){},onLongClickElement:function(t,e){},onLongClickBackground:function(t){},onMouseMove:function(t,e){},onMouseEnter:function(t,e){},onMouseLeave:function(t,e){},setMovingElement:function(t){if(t!=this._movingElement){var e=this._movingElement;this._movingElement=t,this.firePropertyChange("movingElement",e,t),this._box._undoManager._enabled&&(t?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},setEditingElement:function(t){if(t!=this._editingElement){var e=this._editingElement;this._editingElement=t,this.firePropertyChange("editingElement",e,t),this._box._undoManager._enabled&&(t?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}}}),De.canvas.Overview=function(t){De.canvas.Overview.superClass.constructor.apply(this,t),this._view=je.createView(),this._rootDiv=je.createDiv(),this._imageCanvas=je.createCanvas(),this._imageDiv=je.createDiv(),this._maskCanvas=je.createCanvas(),this._selectDiv=je.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,je.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this.setNetwork(t),He.isTouchable?He.isMSTouchable?new De.canvas.OverviewMSTouchInteraction(this):(new De.canvas.OverviewTouchInteraction(this),new De.canvas.OverviewInteraction(this)):new De.canvas.OverviewInteraction(this)},Be.ext("twaver.canvas.Overview",De.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:kn.OVERVIEW_FILL_COLOR,_outlineColor:kn.OVERVIEW_OUTLINE_COLOR,_outlineWidth:kn.OVERVIEW_OUTLINE_WIDTH,_selectColor:kn.OVERVIEW_SELECT_COLOR,_selectWidth:kn.OVERVIEW_SELECT_WIDTH,_padding:kn.OVERVIEW_PADDING,_animate:kn.OVERVIEW_ANIMATE,_maxPackingWidth:kn.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:kn.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(t){this._invalidateMask()},setNetwork:function(t){t!==this._network&&(this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),je.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=t,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),je.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate())},_handleNetworkPropertyChange:function(t){("zoom"===t.property||"currentSubNetwork"===t.property||"elementBox"===t.property||"dataBox"===t.property||"canvasSizeChange"===t.property)&&this.invalidate()},_handleNetworkViewChange:function(t){"validateEnd"===t.kind&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(t){this._isNetworkDirty&&this._isMaskDirty||(this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),Be.callLater(this.validate,this,null,t))},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,Be.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&0!==this._network.getViewRect().width&&0!==this._network.getViewRect().height&&!this._network._invalidate){var t,e=this._maxPackingWidth>0&&this._maxPackingHeight>0;t=e?{x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:{x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},Ge.grow(t,-this._padding,-this._padding);var i=Math.min(t.width/this._network.getCanvasSize().width,t.height/this._network.getCanvasSize().height);e&&(je.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),t.width=this._imageDiv._viewRect.width,t.height=this._imageDiv._viewRect.height);var n=this._network.getCanvasSize().width*i,s=this._network.getCanvasSize().height*i,r=t.x+(t.width-n)/2,a=t.y+(t.height-s)/2;if(this._isNetworkDirty){var o={x:r,y:a,width:n,height:s};this._network.toCanvas(o.width,o.height,this._imageCanvas),je.setDiv(this._imageDiv,o,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var h={x:this._network.getViewRect().x*i,y:this._network.getViewRect().y*i,width:n*this._network._view.clientWidth/this._network.getCanvasSize().width,height:s*this._network._view.clientHeight/this._network.getCanvasSize().height};h.x=h.x<0?0:h.x,h.y=h.y<0?0:h.y;var l=je.setCanvas(this._maskCanvas,r,a,n,s);l.lineWidth=0,l.fillStyle=this._fillColor,l.beginPath(),qe.drawVector(l,"rectangle",null,r,a,n,s),l.fill(),l.clearRect(r+h.x,a+h.y,h.width,h.height);var c=this._outlineWidth<0?0:this._outlineWidth;l.lineWidth=c,l.strokeStyle=this._outlineColor;var u=h.width-2*c,d=h.height-2*c;u=Math.min(u,n-2-h.x-this._outlineWidth),d=Math.min(d,s-2-h.y-this._outlineWidth),l.beginPath(),qe.drawVector(l,"rectangle",null,r+h.x+c,a+h.y+c,u,d),c>=0&&l.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(t){return je.getLogicalPoint(this._view,t,1,this._rootDiv)},centerNetwork:function(t,e){var i=this._imageDiv._viewRect;Ge.containsPoint(i,t)&&(this._network.centerByLogicalPoint((t.x-i.x)/i.width*this._network.getCanvasSize().width,(t.y-i.y)/i.height*this._network.getCanvasSize().height,e),this._invalidateMask())}}),De.canvas.OverviewTouchInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,je.addEventListener("touchstart","handleTouchstart",this.view,this)},Be.ext("twaver.canvas.OverviewTouchInteraction",Object,{handleTouchstart:function(t){je.preventDefault(t),this.clear(),this.endPoint=this.overview.getLogicalPoint(t),Ci.isMultiTouch(t)&&(this.distance=Ci.getDistance(t),this.zoom=this.network.getZoom()),je.addEventListener("touchmove","handleTouchmove",this.view,this),je.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(t){if(this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(t),Ci.isSingleTouch(t))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var e=Ci.getDistance(t)/this.distance;this.network.setZoom(this.zoom*e,!1)}},handleTouchend:function(t){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(t);var e=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;e?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),e?Be.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,je.removeEventListener("touchmove",this.view,this),je.removeEventListener("touchend",this.view,this)),this.moved=!1}}),De.canvas.OverviewMSTouchInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,this._pointerMap={},this._pointerIdArray=[],je.addEventListener("MSPointerDown","handleTouchstart",this.view,this),je.addEventListener("MSPointerMove","handleTouchmove",this.view,this),je.addEventListener("MSPointerUp","handleTouchend",this.view,this),je.addEventListener("MSPointerCancel","handleTouchend",this.view,this)},Be.ext("twaver.canvas.OverviewMSTouchInteraction",Object,{handleTouchstart:function(t){je.preventDefault(t),t.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[t.pointerId]&&this.overview.getLogicalPoint(t)&&(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t),1==this._pointerIdArray.length?(this._startTouchPoint=this.overview.getLogicalPoint(t),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(t){if(0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(Ge.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=10))if(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length){var e=this._getDistance()/this._distance;this.network.setZoom(this._zoom*e,!1)}else if(1==this._pointerIdArray.length&&this._startTouchPoint){var i=this.overview.getLogicalPoint(t);if(null==i)return;this._startTouchPoint=i,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(t){var e=this.overview.getLogicalPoint(t);if(1==this._pointerIdArray.length&&e){var i=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&Ge.getDistance(this._endTouchPoint,e)<=10;i?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=e,this._endTouchTime=new Date),i?Be.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Ge.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),De.canvas.OverviewInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,je.addEventListener("mousedown","handleMousedown",this.view,this)},Be.ext("twaver.canvas.OverviewInteraction",Object,{handleMousedown:function(t){0===t.button&&(this.clear(),this.endPoint=this.overview.getLogicalPoint(t),Be.isCtrlDown(t)&&(this.startPoint=this.endPoint,je.setVisible(this.overview._selectDiv,!0)),je.addEventListener("mousemove","handleMousemove",this.view,this),je.addEventListener("mouseup","handleMouseup",this.view,this))},handleMouseup:function(t){if(this.endPoint=this.overview.getLogicalPoint(t),"detail"in t&&2===t.detail)Be.callLater(this.network.zoomReset,this.network,[this.overview._animate]);else if(je.isVisible(this.overview._selectDiv)&&this.startPoint){var e=this.overview._imageDiv._viewRect,i=this.overview._selectDiv._viewRect.x,n=this.overview._selectDiv._viewRect.y,s=e.width/this.overview._selectDiv._viewRect.width,r=e.height/this.overview._selectDiv._viewRect.height,a=Math.min(s,r);this.network.setZoom(a*Math.min(this.network.getViewRect().width/this.network.getCanvasSize().width,this.network.getViewRect().height/this.network.getCanvasSize().height)*this.network.getZoom(),!1);var o=this.network.getCanvasSize().width*((i-e.x+this.overview._selectDiv._viewRect.width/2)/e.width),h=this.network.getCanvasSize().height*((n-e.y+this.overview._selectDiv._viewRect.height/2)/e.height);Be.callLater(this.network.centerByLogicalPoint,this.network,[o,h,this.overview._animate]),je.setVisible(this.overview._selectDiv,!1),je.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(t){var e=this.overview.getLogicalPoint(t);if(this.endPoint=e,je.isVisible(this.overview._selectDiv)&&this.startPoint){var i=e.x>this.startPoint.x?this.startPoint.x:e.x,n=e.x>this.startPoint.x?this.startPoint.y:e.y;e.x>this.startPoint.x&&e.y<this.startPoint.y&&(n=e.y),e.x<this.startPoint.x&&e.y>this.startPoint.y&&(n=this.startPoint.y);var s=this.overview._imageDiv._viewRect;i<s.x&&(i=s.x),i>s.x+s.width&&(i=s.x+s.width),n<s.y&&(n=s.y),n>s.y+s.height&&(n=s.y+s.height);var r=Math.abs(e.x-this.startPoint.x),a=Math.abs(e.y-this.startPoint.y);i+r>s.x+s.width&&(r=s.x+s.width-i),n+a>s.y+s.height&&(a=s.y+s.height-n),je.setDiv(this.overview._selectDiv,{x:i,y:n,width:r,height:a},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(e,!1)},clear:function(){this.endPoint&&(this.endPoint=null,je.removeEventListener("mousemove",this.view,this),je.removeEventListener("mouseup",this.view,this))}}),De.canvas.ElementUI=function(t,e){this._network=t,this._element=e,this._attachments=new De.List,this._bodyBounds=new De.List,this._hitTest=!1,this._hitTest=!1,this._intersectTest=!1,this.invalidate(!0)},Be.ext("twaver.canvas.ElementUI",Object,{getElement:function(){return this._element},getNetwork:function(){return this._network},handlePropertyChange:function(t){this.invalidate(!0)},handleSelectionChange:function(t){this.invalidate(!0)},invalidate:function(t){t===e&&(t=!0),t&&(this._invalidateAttachmentsFlag=!0),this._invalidateFlag||(this._hotSpot=null,this._bodyRect=null,this._invalidateFlag=!0,this._network.invalidateElementVisibility())},updateStyle:function(){this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this._wholeAlpha=this._element.getStyle("whole.alpha")},validate:function(){if(0!=this._invalidateFlag){this._bodyBounds.clear(),this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this.updateStyle(),this.validateImpl(),this._attachments.forEach(function(t){t.validate()});var t;this._bodyBounds.forEach(function(e){t=Ge.unionRect(t,e)}),this._unionBodyBounds=Be.clone(t),this._attachments.forEach(function(e){t=Ge.unionRect(t,e.getViewRect())}),this._viewRect=t}},validateImpl:function(){},setShadow:function(t,e){var i=t.isShadowable()&&this._shadowColor&&!this._editAttachment;return e.shadowOffsetX===this._shadowXOffset&&e.shadowOffsetY===this._shadowYOffset&&e.shadowBlur===this._shadowBlur?e:((i||this._network._showShadowInEdit)&&(e.shadowOffsetX=this._shadowXOffset,e.shadowOffsetY=this._shadowYOffset,e.shadowBlur=this._shadowBlur,e.shadowColor=this._shadowColor),e)},clearShadow:function(t){(0!=t.shadowOffsetX||0!=t.shadowOffsetY||0!=t.shadowBlur)&&(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0)},appendShadowBound:function(t,e){var i=t.isShadowable()&&this._shadowColor&&!this._editAttachment;
return i&&(this._shadowXOffset>0?e.width+=this._shadowXOffset:(e.x+=this._shadowXOffset,e.width+=-this._shadowXOffset),this._shadowYOffset>0?e.height+=this._shadowYOffset:(e.y+=this._shadowYOffset,e.height+=-this._shadowYOffset),Ge.grow(e,this._shadowBlur,this._shadowBlur)),e},isShadowable:function(){return!(!this._shadowColor||!this._network.isSelected(this._element)||"shadow"!==this._element.getStyle("select.style"))},addAttachment:function(t){this._attachments.add(t)},removeAttachment:function(t){this._attachments.remove(t)},getAttachments:function(){return this._attachments},checkAttachments:function(){this.checkLabelAttachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var t=this._network.getLabel(this._element);null!=t&&""!==t?this._labelAttachment||(this._labelAttachment=new De.canvas.LabelAttachment(this,kn.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var t=this._network.getAlarmLabel(this._element);null!=t&&""!==t?this._alarmAttachment||(this._alarmAttachment=new De.canvas.AlarmAttachment(this,kn.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var t=this._network.getIconsNames(this._element);t&&t.length>0?this._iconsAttachment||(this._iconsAttachment=new De.canvas.IconsAttachment(this),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)&&this.isEditable()?this._editAttachment||(this._editAttachment=new De.canvas.EditAttachment(this),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},isEditable:function(){return!0},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getDyeColor:function(t){return this._innerColor?this._innerColor:this.getStyle(t)},getStyle:function(t){return this._element.getStyle(t)},getFont:function(t){var e=this._element.getStyle(t);return e?e:De.Defaults.FONT},paint:function(t){t.save(),t.globalAlpha=this._wholeAlpha,t.beginPath(),this.paintBody(t),this.clearShadow(t),t.closePath(),t.beginPath(),this.paintAttachments(t),t.closePath(),t.restore()},paintBody:function(t){},paintAttachments:function(t){t.beginPath();for(var e=this._attachments.size(),i=0;e>i;i++){var n=this._attachments.get(i);1==this._hitTest&&0==n.isShowOnTop()&&this.paintAttachment(t,n),1==this._intersectTest&&this.paintAttachment(t,n),0==this._hitTest&&0==this._intersectTest&&(n.isShowOnTop()?this._network._topAttachmentList.add(n):this.paintAttachment(t,n))}},paintAttachment:function(t,e){t.beginPath(),e.paint(t),this.clearShadow(t)},getViewRect:function(){return Be.clone(this._viewRect)},getUnionBodyBounds:function(){return Be.clone(this._unionBodyBounds)},addBodyBounds:function(t){t&&this._bodyBounds.add(t)},getBodyRect:function(){return this._bodyRect||(this._bodyRect=this.createBodyRect()),Be.clone(this._bodyRect)},getHotSpot:function(){return this._hotSpot?Be.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(t){this._hotSpot=t},hit:function(t,e){return!1},intersects:function(t){return!!Ge.contains(t,this.getViewRect())},hitCanvasRectAtBody:function(t){var e=Un.getHitCanvas(t.width,t.height),i=Un.getCtx(e);if(i.save(),i.translate(-t.x,-t.y),this._element.getImage){var n=Be.getImageAsset(this._element.getImage());if(n&&n.getImage()instanceof Dn)return 1}this.paintBody(i);try{for(var s=i.getImageData(0,0,t.width,t.height),r=s.data,a=0;a<s.width;a++)for(var o=0;o<s.height;o++){var h=4*(o*s.width+a),l=r[h+3];if(0!==l)return i.restore(),1}}catch(c){if(Un.disposeHitCanvas(),Ge.contains(this.getUnionBodyBounds(),t))return 0}return i.restore(),-1},hitCanvasRectAtAttachments:function(t){var e=Un.getHitCanvas(t.width,t.height),i=Un.getCtx(e);i.save(),i.translate(-t.x,-t.y),this.paintAttachments(i);try{for(var n=i.getImageData(0,0,t.width,t.height),s=n.data,r=0;r<n.width;r++)for(var a=0;a<n.height;a++){var o=4*(a*n.width+r),h=s[o+3];if(0!==h)return i.restore(),1}}catch(l){Un.disposeHitCanvas()}return i.restore(),-1},hitCanvasRect:function(t){this._intersectTest=!0,1==this._hitTest&&(this._intersectTest=!1);var e=Ge.intersection(t,this._viewRect),i=this.hitCanvasRectAtBody(e);if(1==i)return this._intersectTest=!1,!0;var n=this.hitCanvasRectAtAttachments(e);return 1==n?(this._intersectTest=!1,!0):(this._intersectTest=!1,0==i)},hitCanvasPoint:function(t,e){var i={x:t,y:e,width:0,height:0},n=this._network.getSelectionTolerance();if(n&&n>0&&Ge.grow(i,n,n),!Ge.intersects(this._viewRect,i))return!1;this._hitTest=!0;var s=this.hitCanvasRect(i);return this._hitTest=!1,s},hitTest:function(t,e){var i={x:t,y:e,width:0,height:0},n=this._network.getSelectionTolerance();if(n&&n>0&&Ge.grow(i,n,n),!Ge.intersects(this._viewRect,i))return null;var s=Ge.intersection(i,this._viewRect),r=this.hitCanvasRectAtBody(s);if(1==r)return this;for(var a=this._attachments.size(),o=0;a>o;o++){var h=this._attachments.get(o);if(h.hit(t,e))return h}return 0==r?this:null},dispose:function(){this._attachments.forEach(function(t){t.dispose()}),this._attachments.clear()}}),De.canvas.NodeUI=function(t,e){De.canvas.NodeUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.canvas.NodeUI",De.canvas.ElementUI,{invalidate:function(t){De.canvas.NodeUI.superClass.invalidate.call(this,t),this.curInterval&&clearInterval(this.curInterval);var e=this._element.getAgentLinks();e&&e.forEach(function(t){this._network.invalidateElementUI(t,!1)},this);var i=this._element.getParent();i instanceof De.Group&&this._network.invalidateElementUI(i,!1)},createBodyRect:function(){return this._element.getRect()},validateImpl:function(){De.canvas.NodeUI.superClass.validateImpl.call(this);var t=this.getStyle("vector.shape"),e=this.getBodyRect();this._hotSpot=Ge.getHotSpot(e.x,e.y,e.width,e.height,t),this.validateBodyBounds()},validate:function(){0!=this._invalidateFlag&&De.canvas.NodeUI.superClass.validate.call(this)},validateBodyBounds:function(){var t=this.getStyle("body.type");"default"===t?this.addBodyBounds(this.getDefaultBodyRect()):"vector"===t?this.addBodyBounds(this.getVectorBody()):"default.vector"===t?(this.addBodyBounds(this.getVectorBody()),this.addBodyBounds(this.getDefaultBodyRect())):"vector.default"===t&&(this.addBodyBounds(this.getDefaultBodyRect()),this.addBodyBounds(this.getVectorBody())),this._outerColor&&this.addBodyBounds(this.getOuterBorderRect()),!this._editAttachment&&"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.addBodyBounds(this.getSelectBorderRect())},getDefaultBodyRect:function(){var t=this._element,e=Be.getImageAsset(t.getImage()),i=this.getBodyRect();if(!e)return i;Ge.addPadding(i,this._element,"image.padding",1),this._defaultRect=i;var n=Be.clone(i);return this.appendShadowBound(this,n),i=n},getVectorBody:function(){var t=this.getPathRect("vector");return t},getOuterBorderRect:function(){return this._getBorderRect("outer")},getSelectBorderRect:function(){return this._getBorderRect("select")},_getBorderRect:function(t){var e=this._element,i=e.getStyle(t+".width");if(i>0){var n=this.getBodyRect();Ge.addPadding(n,e,t+".padding",1);var s=Be.clone(n);return Ge.grow(s,i/2,i/2),s}return null},getPathRect:function(t,e){var i=this._element,n=this.getBodyRect();e&&Ge.addPadding(n,i,t+".padding",1);var s=Be.clone(n),r=i.getStyle(t+".outline.width");return r>0&&Ge.grow(s,r/2,r/2),this.appendShadowBound(this,s),s},paintBody:function(t){this.curInterval&&clearInterval(this.curInterval);var e=this.getStyle("body.type");"default"===e?this.drawDefaultBody(t):"vector"===e?this.drawVectorBody(t):"default.vector"===e?(this.drawVectorBody(t),this.drawDefaultBody(t)):"vector.default"===e&&(this.drawDefaultBody(t),this.drawVectorBody(t)),this._outerColor&&this.drawOuterBorder(t),"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.drawSelectBorder(t)},drawOuterBorder:function(t){var e=this._element,i=e.getStyle("outer.width");if(i>0){var n=this.getBodyRect();Ge.addPadding(n,e,"outer.padding",1),t.lineWidth=i,t.lineCap=e.getStyle("outer.cap"),t.lineJoin=e.getStyle("outer.join"),t.strokeStyle=this._outerColor,qe.drawVector(t,e.getStyle("outer.shape"),null,n),t.stroke()}},drawDefaultBody:function(t){var e=this._element,i=Be.getImageAsset(e.getImage()),n=this._defaultRect;if(i&&i.getImage()){if(0!=e.getAngle()&&(t.save(),n=e.getOriginalRect(),De.Util.rotateCanvas(t,n,e.getAngle())),this.setShadow(this,t),i.getImage()instanceof Dn){var s,r=i.getImage().frames,a=i.getImage().size,o=0;s=Nn(r,a,0),t.drawImage(s,n.x,n.y,n.width,n.height),this.curInterval=setInterval(function(){o=(o+r.length)%r.length,s=Nn(r,a,o),t.drawImage(s,n.x,n.y,n.width,n.height),o++},100)}else Fi(t,e.getImage(),this.getInnerColor(),n,e,this._network);0!=e.getAngle()&&t.restore()}},drawSelectBorder:function(t){var e=this._element,i=e.getStyle("select.width");if(i>0){var n=this.getBodyRect();n=Be.clone(n);var s=e.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();Ge.addPadding(n,e,"select.padding",1/s),Ge.grow(n,i/2/s,i/2/s),t.lineWidth=i/s,t.lineCap=e.getStyle("select.cap"),t.lineJoin=e.getStyle("select.join"),t.strokeStyle=e.getStyle("select.color"),qe.drawVector(t,e.getStyle("select.shape"),null,n),t.stroke()}},drawVectorBody:function(t){this.drawPath(t,"vector",!0,this._element.getStyle("vector.outline.pattern"));var e=this.getStyle("vector.deep"),i=this.getStyle("vector.fill.color"),n=this.getBodyRect();if(0!==e&&i){var s=this._element.getAngle();0!=s&&(t.save(),n=this._element.getOriginalRect(),De.Util.rotateCanvas(t,n,s)),"rectangle"===this.getStyle("vector.shape")&&qe.draw3DRect(t,i,e,n),0!=s&&t.restore()}},drawPath:function(t,e,i,n,s,r,a){var o=this._element,h=this.getBodyRect();i&&Ge.addPadding(h,o,e+".padding",1);var l=o.getStyle(e+".outline.width");this.setShadow(this,t),0!=o.getAngle()&&(o instanceof Vn||(h=o.getOriginalRect()),t.save(),De.Util.rotateCanvas(t,h,o.getAngle()));var c,u=o.getStyle(e+".fill");if(u){c=this._innerColor&&!xi.hasDefault(this._element)?this._innerColor:o.getStyle(e+".fill.color");var d=o.getStyle(e+".gradient");d?qe.fill(t,c,d,o.getStyle(e+".gradient.color"),h):t.fillStyle=c}var f=o.getStyle(e+".shape"),g=o.getStyle("group.shape.roundrect.radius");u&&(t.beginPath(),s?qe.drawLinePoints(t,s,null,r,a):"roundrect"===f&&"group"===e?qe.drawVector(t,f,null,h,g):qe.drawVector(t,f,null,h),t.fill()),l>0&&(t.lineWidth=l,t.lineCap=o.getStyle(e+".cap"),t.lineJoin=o.getStyle(e+".join"),t.strokeStyle=o.getStyle(e+".outline.color"),t.beginPath(),s?qe.drawLinePoints(t,s,n,r,a):"roundrect"===f&&"group"===e?qe.drawVector(t,f,n,h,g):qe.drawVector(t,f,n,h),t.stroke()),0!=o.getAngle()&&t.restore()},hit:function(t,e){var i={x:t,y:e,width:0,height:0},n=this._network.getSelectionTolerance();if(n&&n>0&&Ge.grow(i,n,n),this._network._transparentSelectionEnable){var s=this.getBodyRect();if(Be.math.intersects(s,i))return!0}return!!Ge.intersects(this.getViewRect(),i)&&this.hitCanvasPoint(t,e)},intersects:function(t){var e=De.canvas.NodeUI.superClass.intersects.apply(this,arguments);if(1==e)return!0;if(this._network._transparentSelectionEnable){var i=this.getBodyRect();if(Be.math.intersects(i,t))return!0}return!!Ge.intersects(t,this.getViewRect())&&this.hitCanvasRect(t)}}),De.canvas.LinkUI=function(t,e){De.canvas.LinkUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.canvas.LinkUI",De.canvas.ElementUI,{isEditable:function(){return!(!bi.isOrthogonalLink(this._element)||!this.getControlPoint())},invalidate:function(t){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,this._angle=null,De.canvas.LinkUI.superClass.invalidate.call(this,t)},validateImpl:function(){this.validateBodyBounds(),De.canvas.LinkUI.superClass.validateImpl.call(this)},validateBodyBounds:function(){var t=this.getLinkPoints();if(t&&!(t.size()<2)){var e=this._element,i=Ge.getLineRect(t),n=e.getStyle("link.width"),s=n;if(this._outerColor){var r=e.getStyle("outer.width");s+=2*r}var a=!this._editAttachment&&"border"===e.getStyle("select.style")&&this._network.isSelected(this._element);if(a){var o=e.getStyle("select.width");s+=2*o}Ge.grow(i,s/2,s/2),e.getStyle("arrow.from")&&(this._network._debug&&(this._arrowFromRect=_n.getArrowRect(this,t,!0,e.getStyle("arrow.from.shape"),e.getStyle("arrow.from.width"),e.getStyle("arrow.from.height"),e.getStyle("arrow.from.xoffset"),e.getStyle("arrow.from.yoffset"))),i=Ge.unionRect(i,_n.getArrowRect(this,t,!0,e.getStyle("arrow.from.shape"),e.getStyle("arrow.from.width"),e.getStyle("arrow.from.height"),e.getStyle("arrow.from.xoffset"),e.getStyle("arrow.from.yoffset")))),e.getStyle("arrow.to")&&(this._network._debug&&(this._arrowToRect=_n.getArrowRect(this,t,!1,e.getStyle("arrow.to.shape"),e.getStyle("arrow.to.width"),e.getStyle("arrow.to.height"),e.getStyle("arrow.to.xoffset"),e.getStyle("arrow.to.yoffset"))),i=Ge.unionRect(i,_n.getArrowRect(this,t,!1,e.getStyle("arrow.to.shape"),e.getStyle("arrow.to.width"),e.getStyle("arrow.to.height"),e.getStyle("arrow.to.xoffset"),e.getStyle("arrow.to.yoffset")))),this.appendShadowBound(this,i),this.addBodyBounds(i)}},createBodyRect:function(){var t=this.getHotSpot();return t?{x:t.x-1,y:t.y-1,width:2,height:2}:null},paintBody:function(t){var e=this._linkPoints;if(e&&!(e.size()<2)){var i=this._element,n=i.getStyle("link.width"),s=n;if(this._outerColor){var r=i.getStyle("outer.width");s+=2*r}var a=!this._editAttachment&&"border"===i.getStyle("select.style")&&this._network.isSelected(this._element);if(a){var o=i.getStyle("select.width");s+=2*o}this.setShadow(this,t),t.lineCap=i.getStyle("link.cap"),t.lineJoin=i.getStyle("link.join");var h=i.getStyle("link.pattern");a&&this.drawLinePoints(t,e,s,i.getStyle("select.color"),h),this._outerColor&&this.drawLinePoints(t,e,n+2*r,this._outerColor,h),this.drawLinePoints(t,e,n,this._innerColor||i.getStyle("link.color"),h),_n.drawLinkArrow(this,t,e)}},drawLinePoints:function(t,e,i,n,s){if(t.lineWidth=i,t.strokeStyle=n,this._element.getStyle("link.flow")===!0&&s&&s.length>1){var r=new Ai(t,s[0],s[1]),a=this._element.getStyle("link.flow.offset"),o=Math.floor(a/(s[0]+s[1]));o>2&&(a-=(s[0]+s[1])*o),this._element.getStyle("link.flow.converse")?a<s[0]?r.overflow=s[0]-a:a>=s[0]&&a<=s[0]+s[1]?(r.overflow=s[1]-(a-s[0]),r.overflow&&(r.isLine=!1)):(a-=s[0]+s[1],r.overflow=s[0]-a):a<=s[1]?(r.overflow=a,a&&(r.isLine=!1)):a>s[1]&&a<=s[0]+s[1]?r.overflow=a-s[1]:(a-=s[0]+s[1],a&&(r.isLine=!1),r.overflow=a),this._element._styleMap["link.flow.offset"]=a,t.beginPath(),qe._drawLine(e,t),t.stroke(),t.shadowColor="transparent",t.beginPath();var h=this._element.getStyle("link.flow.color");h=h?h:kn.NETWORK_LINK_FLOW_COLOR,t.strokeStyle=h,qe._drawLine(e,r),t.stroke(),t.shadowColor=this._shadowColor}else t.beginPath(),qe.drawLinePoints(t,e,s),t.stroke()},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=Ge.calculateLineLength(this._linkPoints)),this._linkPoints},getFromPosition:function(t,e){var i=this.getFromPoint();return i?{x:i.x+t,y:i.y+e}:null},getToPosition:function(t,e){var i=this.getToPoint();return i?{x:i.x+t,y:i.y+e}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=bi.createFromPoint(this)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=bi.createToPoint(this)),this._toPoint},createLinkPoints:function(){var t=this.getFromPoint(),e=this.getToPoint(),i=this.getStyle("link.type"),n=new De.List;if(bi.isOrthogonalOrFlexionalLink(this._element))n=bi.orthogonalAndFlexional(this,i);else if(this._element.isLooped()){var s=this._network.getElementUI(this._element.getFromAgent());null!=s&&(this._hotSpot=bi.fillLoopedPoints(this,s.getBodyRect(),n))}else{if("arc"!==i&&"triangle"!==i&&"parallel"!==i)throw"Can not resolve link type '"+i+"'";this._hotSpot=bi.fillBundlePoints(this,i,t,e,n)}if(this._network._linkPathFunction){var r=this._network._linkPathFunction(this,n);r&&(n=r)}return n},checkAttachments:function(){De.canvas.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var t=this._network.getLinkHandlerLabel(this._element);null!=t&&""!==t?this._linkHandlerAttachment||(this._linkHandlerAttachment=new De.canvas.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getControlPoint:function(){return bi.getControlPoint(this._element,this)},setControlPoint:function(t){if(t){var e=this.getStyle("link.type");if(bi.hasControlPoint(e)){var i=bi.getLinkSourceBounds(this),n=bi.getLinkTargetBounds(this);bi.setParamsByControlPoint(t,i,n,e,this._element)}}},getLineLength:function(){return this._lineLength},hit:function(t,e){var i={x:t,y:e,width:0,height:0},n=this._network.getSelectionTolerance();return n&&n>0&&Ge.grow(i,n,n),!!Ge.intersects(this.getViewRect(),i)&&this.hitCanvasPoint(t,e)},intersects:function(t){var e=De.canvas.LinkUI.superClass.intersects.apply(this,arguments);if(1==e)return!0;if(0==Ge.intersects(t,this.getViewRect()))return!1;var i=this.getLinkPoints(),n=i.size();if(2==n)for(var s=0;n>s;s+=2){var r=i.get(s);if(n>s+1){var a=i.get(s+1);if(Un.intersectsLine(r.x,r.y,a.x,a.y,t.x,t.y,t.width,t.height))return!0}}return this.hitCanvasRect(t)},getAngle:function(){return!this._angle&&this._fromPoint&&this._toPoint&&(this._angle=Ge.getAngle(this._fromPoint,this._toPoint)),this._angle||0}}),De.canvas.GroupUI=function(t,e){De.canvas.GroupUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.canvas.GroupUI",De.canvas.NodeUI,{isEditable:function(){return!this._element.isExpanded()},paintBody:function(t){this._shapeRect?this.drawExpandedGroup(t):De.canvas.GroupUI.superClass.paintBody.apply(this,arguments)},validateBodyBounds:function(){this.getBodyRect(),this._shapeRect?this.addBodyBounds(this.getPathRect("group",!1)):De.canvas.GroupUI.superClass.validateBodyBounds.call(this)},drawExpandedGroup:function(t){this.drawPath(t,"group",!1,this._element.getStyle("vector.outline.pattern"));var e=this.getStyle("group.deep"),i=this.getStyle("group.fill.color");0!==e&&i&&"rectangle"===this.getStyle("group.shape")&&qe.draw3DRect(t,i,e,this._bodyRect)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var t=this._element,e=this._network;if(t.isExpanded()){t.getChildren().forEach(function(t){var i=e.getElementUI(t);i&&i.validate()});var i=this.getChildrenRects();if(!i.isEmpty()){var n=t.getStyle("group.shape"),s=Ze[n];if(!s)throw"Can not resolve group shape '"+n+"'";this._shapeRect=s(i)}}return this._shapeRect?(Ge.addPadding(this._shapeRect,t,"group.padding",1),this._shapeRect):De.canvas.GroupUI.superClass.createBodyRect.call(this)}}),De.canvas.ShapeNodeUI=function(t,e){De.canvas.ShapeNodeUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.canvas.ShapeNodeUI",De.canvas.NodeUI,{getDefaultBodyRect:function(){return this._element._points.size()<2?null:this.getPathRect("vector",!0)},drawDefaultBody:function(t){this._element._points.size()<2||(this.drawPath(t,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._element._points,this._element._segments,this._element.getStyle("shapenode.closed")),_n.drawLinkArrow(this,t,Ge.getPointObject(this._element._points,this._element._segments)))},drawSelectBorder:function(t){var e=this._element,i=e.getStyle("select.width");if(i>0){var n=this.getBodyRect();n=Be.clone(n);var s=e.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();Ge.addPadding(n,e,"select.padding",1/s),Ge.grow(n,i/2,i/2);var r=e.getStyle("vector.outline.width");r>0&&Ge.grow(n,r/2/s,r/2/s),t.lineWidth=i/s,t.lineCap=e.getStyle("select.cap"),t.lineJoin=e.getStyle("select.join"),t.strokeStyle=e.getStyle("select.color"),qe.drawVector(t,e.getStyle("select.shape"),null,n),t.stroke()}}}),De.canvas.ShapeLinkUI=function(t,e){De.canvas.ShapeLinkUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.canvas.ShapeLinkUI",De.canvas.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var t=this.getFromPoint(),e=this.getToPoint(),i=new De.List,n=this.getStyle("shapelink.type");i.add(t),null!=this._element._points&&i.addAll(this._element._points),i.add(e);var s,r,a,o,h,l,c,u=Ge.calculateLineLength(i)/2,d=i.size(),f=0,g=0;for(s=0;d>s;s++)if(o=i.get(s),0!=s){if(a=o,a instanceof gn&&(a=a._as),a instanceof Array?(h=Ge.calculateCurveLength(r,a,1),r=a[a.length-1]):(c=o.y-r.y,l=o.x-r.x,h=Math.sqrt(l*l+c*c),r=a),g+=h,u>=f&&g>=u){var _=u-f,p=i.get(s-1);p instanceof gn&&(p=p._as,p instanceof Array&&(p=p[p.length-1]));var v=i.get(s),m=Ge.getPathInfo(v,p,_,0,-1).point;this._hotSpot=Be.clone(m)}f=g}else r=o;var y,A,x;if("lineto"===n);else if("quadto"===n){for(y=new De.List(i.get(0)),A=1,pointCount=i.size();A<pointCount;A++)y.add(A<pointCount-1?new De.List([i.get(A++),i.get(A)]):i.get(A));i=y}else if("cubicto"===n){for(y=new De.List(i.get(0)),A=1,pointCount=i.size();A<pointCount;A++)y.add(A<pointCount-2?new De.List([i.get(A++),i.get(A++),i.get(A)]):A<pointCount-1?new De.List([i.get(A++),i.get(A)]):i.get(A));i=y}else{if("orthogonalto"!==n)throw"Can not resolve shapelink type '"+n+"'";for(x=i.get(0),y=new De.List(x),A=1,pointCount=i.size();A<pointCount;A++)if(A<pointCount-1){var o=Be.clone(i.get(A)),w=o.x,b=o.y,l=w-x.x,c=b-x.y;Math.abs(l)>Math.abs(c)?(o.x=w,o.y=x.y):(o.x=x.x,o.y=b),x=o,y.add(x)}else y.add(i.get(A));i=y}return i}}),De.canvas.GridUI=function(t,e){De.canvas.GridUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.canvas.GridUI",De.canvas.NodeUI,{drawDefaultBody:function(t){this._element.getImage()?De.canvas.GridUI.superClass.drawDefaultBody.apply(this,arguments):this.drawGridBody(t)},validateBodyBounds:function(){if(this._element.getImage())De.canvas.GridUI.superClass.validateBodyBounds.call(this);else{var t=this.getBodyRect(),e=Be.clone(t);this.appendShadowBound(this,e),this.addBodyBounds(e)}},drawGridBody:function(t){var e=this.getStyle("grid.fill"),i=this.getStyle("grid.deep"),n=this.getStyle("grid.cell.deep");if(e||0!==i||0!==n){t.beginPath();var s=this._element.getRect(),r=this.getDyeColor("grid.fill.color");if(this.setShadow(this,t),e&&(t.fillStyle=r,t.rect(s.x,s.y,s.width,s.height),t.fill()),t.closePath(),this.clearShadow(t),t.beginPath(),0!=i&&qe.draw3DRect(t,r,i,s.x,s.y,s.width,s.height),t.closePath(),0!=n)for(var a=this.getStyle("grid.row.count"),o=this.getStyle("grid.column.count"),h=0;a>h;h++)for(var l=0;o>l;l++){var c=this._element.getCellRect(h,l);null!=c&&(t.beginPath(),qe.draw3DRect(t,r,n,c.x,c.y,c.width,c.height),t.closePath())}}}}),De.canvas.RotatableNodeUI=function(t,e){De.canvas.RotatableNodeUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.canvas.RotatableNodeUI",De.canvas.NodeUI,{isEditable:function(){return!1},getDefaultBodyRect:function(){var t=this._element,e=Be.getImageAsset(t.getImage()),i=this.getBodyRect();return e?(Ge.addPadding(i,this._element,"image.padding",1),i):i},drawDefaultBody:function(t){var e=this._element,i=Be.getImageAsset(e.getImage()),n=this.getBodyRect();if(Ge.addPadding(n,this._element,"image.padding",1),i.getImage()){var s=this._element._getOrignalWidth(),r=this._element._getOrignalHeight(),a=this._element._getRotateRect();t.save(),t.translate(n.x-a.x+s/2,n.y-a.y+r/2),t.rotate(this._element._angle*Math.PI/180);var n={x:-s/2,y:-r/2,width:s,height:r};Fi(t,i.getImage(this._innerColor,n.width,n.height),this._innerColor,n,e,this._network),t.restore()}else if(i.getSrc());else if(!i.getFunction())throw"ImageAsset '"+e.getImage()+" ' is empty"}}),De.canvas.HTMLNodeUI=function(t,e){De.canvas.HTMLNodeUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.canvas.HTMLNodeUI",De.canvas.NodeUI,{checkAttachments:function(){De.canvas.NodeUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var t=this._element.getStyle("attachment.label.style");if(t&&"none"===t)return void De.canvas.HTMLNodeUI.superClass.checkLabelAttachment.call(this);var e=this._network.getLabel(this._element);null!=e&&""!==e?this._labelAttachment||(this._labelAttachment=new De.canvas.HTMLLabelAttachment(this,kn.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var t=this._element.getStyle("attachment.alarm.style");if(t&&"none"===t)return void De.canvas.HTMLNodeUI.superClass.checkAlarmAttachment.call(this);var e=this._network.getAlarmLabel(this._element);null!=e&&""!==e?this._alarmAttachment||(this._alarmAttachment=new De.canvas.HTMLAlarmAttachment(this,(!1)),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},setAttachmentVisible:function(t){t?(this._labelAttachment&&this._labelAttachment.setVisibility("visible"),this._alarmAttachment&&this._alarmAttachment.setVisibility("visible")):(this._labelAttachment&&this._labelAttachment.setVisibility("hidden"),this._alarmAttachment&&this._alarmAttachment.setVisibility("hidden"))}}),De.canvas.HTMLLinkUI=function(t,e){De.canvas.HTMLLinkUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.canvas.HTMLLinkUI",De.canvas.LinkUI,{checkAttachments:function(){De.canvas.LinkUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var t=this._element.getStyle("attachment.label.style");if(t&&"none"===t)return void De.canvas.HTMLLinkUI.superClass.checkLabelAttachment.call(this);var e=this._network.getLabel(this._element);null!=e&&""!==e?this._labelAttachment||(this._labelAttachment=new De.canvas.HTMLLabelAttachment(this),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var t=this._element.getStyle("attachment.alarm.style");if(t&&"none"===t)return void De.canvas.HTMLLinkUI.superClass.checkAlarmAttachment.call(this);var e=this._network.getAlarmLabel(this._element);null!=e&&""!==e?this._alarmAttachment||(this._alarmAttachment=new De.canvas.HTMLAlarmAttachment(this,(!1)),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}}),De.canvas.Attachment=function(t,e){this._ui=t,this._element=this._ui.getElement(),this._network=t.getNetwork(),this._showOnTop=e},Be.ext("twaver.canvas.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},isShowOnTop:function(){return this._showOnTop===!0},setShowOnTop:function(t){this._showOnTop=t},getStyle:function(t){return this._ui.getStyle(t)},getFont:function(t){return this._ui.getFont(t)},getViewRect:function(){return Be.clone(this._viewRect)},getAlpha:function(){return 1},validate:function(){},paint:function(t){},hit:function(t,e){return!!Ge.containsPoint(this._viewRect,t,e)&&this.hitCanvasRect({x:t-1,y:e-1,width:2,height:2})},hitCanvasRect:function(t){var e=Un.getHitCanvas(t.width,t.height),i=Un.getCtx(e);i.save(),i.translate(-t.x,-t.y),this.paint(i);try{for(var n=i.getImageData(0,0,t.width,t.height),s=n.data,r=0;r<n.width;r++)for(var a=0;a<n.height;a++){var o=4*(a*n.width+r),h=s[o+3];if(0!==h)return i.restore(),!0}}catch(l){Un.disposeHitCanvas()}return i.restore(),!1},dispose:function(){},_rotatePoint:function(t,e,i){var n=Ge.createMatrix(e*Math.PI/180,i.x+i.width/2,i.y+i.height/2),s=n.transform(t);return s},_rotatePointList:function(t,e,i){var n=this,s=new De.List;return t.forEach(function(t){s.add(n._rotatePoint(t,e,i))}),s}}),De.canvas.BasicAttachment=function(t,e){De.canvas.BasicAttachment.superClass.constructor.call(this,t,e),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0}},Be.ext("twaver.canvas.BasicAttachment",De.canvas.Attachment,{paint:function(t){De.canvas.BasicAttachment.superClass.paint.apply(this,arguments);var e=this.isFill(),i=this.getOutlineWidth();if(this.getElementUI().setShadow(this,t),(i>0||e)&&(qe.drawRoundRect(t,this._roundRect.x,this._roundRect.y,this._roundRect.width,this._roundRect.height,this.getCornerRadius()),this._pointers&&(t.moveTo(this._pointers[0].x,this._pointers[0].y),t.lineTo(this._pointers[1].x,this._pointers[1].y),t.lineTo(this._pointers[2].x,this._pointers[2].y)),t.closePath(),i>0&&(t.lineWidth=i,t.strokeStyle=this.getOutlineColor(),t.lineCap=this.getCap(),t.lineJoin=this.getJoin(),t.stroke()),e)){var n=this.getFillColor(),s=this.getGradient();s?qe.fill(t,n,s,this.getGradientColor(),this._viewRect):t.fillStyle=n,t.fill()}},validate:function(){De.canvas.BasicAttachment.superClass.validate.call(this),this.calculateMeasure();var t=this.getOutlineWidth();this._viewRect=Ge.getRect(this._pointers),this._viewRect=Ge.unionRect(this._viewRect,this._roundRect),t>0&&Ge.grow(this._viewRect,t/2,t/2),this._viewRect=this._ui.appendShadowBound(this,this._viewRect)},calculateMeasure:function(){var t=this.getContentWidth(),e=this.getContentHeight(),i=this.getCornerRadius(),n=this.getPointerLength(),s=this.getPointerWidth(),r=this.getPosition(),a=this.getXOffset(),o=this.getYOffset(),h=this._roundRect;h.width=t+i,h.height=e;var l;if(this._ui._element instanceof De.Link){var c,u=this._ui.getLinkPoints();c=this._ui.getLineLength?this._ui.getLineLength():this._ui._element.getLineLength(),Math.abs(a)>0&&Math.abs(a)<1?"from"===r?a*=c:"to"===r?a=c*(1-a):(a/=2,a+=.5,a*=c):"from"===r?a=a:"to"===r?a=c-a:a+=c/2;var d,f=Ge.calculatePointInfoAlongLine(u,!0,a,o),g=f.point;f.angle,d="from"===r?this._ui.getFromPoint():"to"===r?this._ui.getToPoint():this._ui._hotSpot,a=g.x-d.x,o=g.y-d.y}if(n>0){var _=this.getDirection();l=this._network.getPosition(r,this._ui,null,a,o,!1);var p;if("aboveleft"===_)h.y=l.y-n-h.height,h.x=l.x-(h.width-i),p=Math.max(l.x-s,l.x-(h.width-i)+i/2),this._pointers=[l,{x:l.x,y:l.y-n},{x:p,y:l.y-n}];else if("aboveright"===_)h.y=l.y-n-h.height,h.x=l.x-i,p=Math.min(l.x+s,l.x-i+h.width-i/2),this._pointers=[l,{x:l.x,y:l.y-n},{x:p,y:l.y-n}];else if("belowleft"===_)h.y=l.y+n,h.x=l.x-(h.width-i),p=Math.max(l.x-s,l.x-(h.width-i)+i/2),this._pointers=[l,{x:l.x,y:l.y+n},{x:p,y:l.y+n}];else if("belowright"===_)h.y=l.y+n,h.x=l.x-i,p=Math.min(l.x+s,l.x-i+h.width-i/2),this._pointers=[l,{x:l.x,y:l.y+n},{x:p,y:l.y+n}];else if("leftabove"===_)h.y=l.y+i-h.height,h.x=l.x-n-h.width,p=Math.max(l.y-s,l.y+i-h.height+i/2),this._pointers=[l,{x:l.x-n,y:l.y},{x:l.x-n,y:p}];else if("leftbelow"===_)h.y=l.y-i,h.x=l.x-n-h.width,p=Math.min(l.y+s,l.y-i+h.height-i/2),this._pointers=[l,{x:l.x-n,y:l.y},{x:l.x-n,y:p}];else if("rightabove"===_)h.y=l.y+i-h.height,h.x=l.x+n,p=Math.max(l.y-s,l.y+i-h.height+i/2),this._pointers=[l,{x:l.x+n,y:l.y},{x:l.x+n,y:p}];else if("rightbelow"===_)h.y=l.y-i,h.x=l.x+n,p=Math.min(l.y+s,l.y-i+h.height-i/2),this._pointers=[l,{x:l.x+n,y:l.y},{x:l.x+n,y:p}];else if("above"===_)h.y=l.y-n-h.height,h.x=l.x-h.width/2,p=Math.min(t/2,s/2),this._pointers=[l,{x:l.x-p,y:l.y-n},{x:l.x+p,y:l.y-n}];else if("below"===_)h.y=l.y+n,h.x=l.x-h.width/2,p=Math.min(t/2,s/2),this._pointers=[l,{x:l.x-p,y:l.y+n},{x:l.x+p,y:l.y+n}];else if("left"===_)h.y=l.y-h.height/2,
h.x=l.x-n-h.width,p=Math.min(e/2,s/2),this._pointers=[l,{x:l.x-n,y:l.y+p},{x:l.x-n,y:l.y-p}];else{if("right"!==_)throw"Can not resolve '"+_+"' attachment direction";h.y=l.y-h.height/2,h.x=l.x+n,p=Math.min(e/2,s/2),this._pointers=[l,{x:l.x+n,y:l.y+p},{x:l.x+n,y:l.y-p}]}}else l=this._network.getPosition(r,this._ui,{width:h.width,height:h.height},a,o,!1),h.x=l.x,h.y=l.y,this._pointers=null;this._contentRect.x=h.x+(h.width-t)/2,this._contentRect.y=h.y+(h.height-e)/2,this._contentRect.width=t,this._contentRect.height=e;var v=this.getPadding();0!=v&&Ge.grow(h,v,v),v=this.getPaddingLeft(),0!=v&&(h.x-=v,h.width+=v),v=this.getPaddingRight(),0!=v&&(h.width+=v),v=this.getPaddingTop(),0!=v&&(h.y-=v,h.height+=v),v=this.getPaddingBottom(),0!=v&&(h.height+=v),h.width<0&&(h.width=h.width,h.x-=h.width),h.height<0&&(h.height=-h.height,h.y-=h.height)},getContentWidth:function(){return De.Defaults.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return De.Defaults.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return De.Defaults.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return De.Defaults.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return De.Defaults.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return De.Defaults.ATTACHMENT_POSITION},getXOffset:function(){return De.Defaults.ATTACHMENT_XOFFSET},getYOffset:function(){return De.Defaults.ATTACHMENT_YOFFSET},getPadding:function(){return De.Defaults.ATTACHMENT_PADDING},getPaddingLeft:function(){return De.Defaults.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return De.Defaults.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return De.Defaults.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return De.Defaults.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return De.Defaults.ATTACHMENT_DIRECTION},isFill:function(){return De.Defaults.ATTACHMENT_FILL},getFillColor:function(){return De.Defaults.ATTACHMENT_FILL_COLOR},getGradient:function(){return De.Defaults.ATTACHMENT_GRADIENT},getGradientColor:function(){return De.Defaults.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return De.Defaults.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return De.Defaults.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return De.Defaults.ATTACHMENT_CAP},getJoin:function(){return De.Defaults.ATTACHMENT_JOIN},isShadowable:function(){return De.Defaults.ATTACHMENT_SHADOWABLE},getRoundRect:function(){return Be.clone(this._roundRect)},getContentRect:function(){return Be.clone(this._contentRect)}}),De.canvas.LabelAttachment=function(t,e){De.canvas.LabelAttachment.superClass.constructor.call(this,t,e)},Be.ext("twaver.canvas.LabelAttachment",De.canvas.BasicAttachment,{paint:function(t){var e=this._element instanceof De.Link&&this._element.getStyle("link.label.rotatable");if(e){t.save();var i=this._viewRect.x+this._viewRect.width/2,n=this._viewRect.y+this._viewRect.height/2;t.translate(i,n),t.rotate(this._network.getElementUI(this._element).getAngle()),t.translate(-i,-n)}De.canvas.LabelAttachment.superClass.paint.apply(this,arguments);var s=this._element.getStyle("label.align"),r=this._element&&this._element.getStyle("label.rotate.angle");0!==r&&(t.save(),De.Util.rotateCanvas(t,this._contentRect,r)),qe.drawText(t,this.text,this._contentRect,this.font,this.getStyle("label.color"),s),(e||0!==r)&&t.restore()},validate:function(){this.font=this.getFont("label.font");var t=this.getLabel(),e=Be.g.getTextSize(this.font,t),i=this.getMaxLength();0!==i&&e.width>i?(this.text=Be.g.getCollapseTextInLength(this.font,t,i),this._textSize=Be.g.getTextSize(this.font,this.text)):(this.text=t,this._textSize=e),De.canvas.LabelAttachment.superClass.validate.call(this);var n=this._viewRect,s=this._element&&this._element.getStyle("label.rotate.angle");if(0!==s){var r=new De.List;r.add({x:n.x,y:n.y}),r.add({x:n.x+n.width,y:n.y}),r.add({x:n.x+n.width,y:n.y+n.height}),r.add({x:n.x,y:n.y+n.height}),r=this._rotatePointList(r,s,n);var a=De.Util.getRect(r);this._viewRect=a}},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},getMaxLength:function(){return this.getStyle("label.maxlength")},isShadowable:function(){return this.getStyle("label.shadowable")}}),De.canvas.AlarmAttachment=function(t,e){De.canvas.AlarmAttachment.superClass.constructor.call(this,t,e)},Be.ext("twaver.canvas.AlarmAttachment",De.canvas.BasicAttachment,{paint:function(t){De.canvas.AlarmAttachment.superClass.paint.apply(this,arguments),qe.drawText(t,this.text,this._contentRect,this.font,this.getStyle("alarm.color"))},validate:function(){this.font=this.getFont("alarm.font"),this.text=this._network.getAlarmLabel(this._element),this._textSize=qe.getTextSize(this.font,this.text),this._fillColor=this._network.getAlarmFillColor(this._element),De.canvas.LabelAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return null!=this._fillColor},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),De.canvas.LinkHandlerAttachment=function(t,e){De.canvas.LinkHandlerAttachment.superClass.constructor.call(this,t,e)},Be.ext("twaver.canvas.LinkHandlerAttachment",De.canvas.BasicAttachment,{paint:function(t){De.canvas.LinkHandlerAttachment.superClass.paint.apply(this,arguments),qe.drawText(t,this.linkHandlerLabel,this._contentRect,this.linkHandlerFont,this.getStyle("link.handler.color"))},validate:function(){this.linkHandlerFont=this.getFont("link.handler.font"),this.linkHandlerLabel=this._network.getLinkHandlerLabel(this._element),this._textSize=qe.getTextSize(this.linkHandlerFont,this.linkHandlerLabel),De.canvas.LinkHandlerAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),De.canvas.IconsAttachment=function(t,e){De.canvas.IconsAttachment.superClass.constructor.call(this,t,e)},Be.ext("twaver.canvas.IconsAttachment",De.canvas.Attachment,{isShadowable:function(){return De.Defaults.ATTACHMENT_SHADOWABLE},validate:function(){if(De.canvas.IconsAttachment.superClass.validate.call(this),this.iconsNames=this._network.getIconsNames(this._element),this.iconsNames&&0!=this.iconsNames.length){var t=this._makeGroup(this.iconsNames),e=this._makeGroup(this._network.getIconsColors(this._element));len=t.length,this.iconsOrientation=this._makeArray(this._element.getStyle("icons.orientation"),len,"right"),this.iconsPosition=this._makeArray(this._element.getStyle("icons.position"),len,"topleft.bottomright"),this.iconsXoffset=this._makeArray(this._element.getStyle("icons.xoffset"),len,0),this.iconsYoffset=this._makeArray(this._element.getStyle("icons.yoffset"),len,0),this.iconsXgap=this._makeArray(this._element.getStyle("icons.xgap"),len,1),this.iconsYgap=this._makeArray(this._element.getStyle("icons.ygap"),len,1),this.locations=[],this.iconsSizes=[];var n,s;for(i=0;i<len;i++){var r=t[i],a=this.iconsOrientation[i]||"right",o=this.iconsPosition[i]||"topleft.bottomright",h=this.iconsXgap[i]||1,l=this.iconsYgap[i]||1,c=this.iconsXoffset[i]||0,u=this.iconsYoffset[i]||0;if(this._ui._element instanceof De.Link){var d,f=this._ui.getLinkPoints();d=this._ui.getLineLength?this._ui.getLineLength():this._ui._element.getLineLength(),Math.abs(c)>0&&Math.abs(c)<1?"from"===o?c*=d:"to"===o?c=d*(1-c):(c/=2,c+=.5,c*=d):"from"===o?c=c:"to"===o?c=d-c:c+=d/2;var g,_=Ge.calculatePointInfoAlongLine(f,!0,c,u),p=_.point;_.angle,g="from"===o?this._ui.getFromPoint():"to"===o?this._ui.getToPoint():this._ui._hotSpot,c=p.x-g.x,u=p.y-g.y}s=null,n=this._getIconsSize(r,a,h,l),n&&(s=this._network.getPosition(o,this._ui,n,c,u),"top"===a?s.y+=n.height:"left"===a&&(s.x+=n.width)),this.locations.push(s),this.iconsSizes.push(n)}var v=null;for(i=0;i<this.locations.length;i++)s=this.locations[i],n=this.iconsSizes[i],null!=s&&(v=null==v?{x:s.x,y:s.y,width:n.width,height:n.height}:Ge.unionRect(v,{x:s.x,y:s.y,width:n.width,height:n.height}));this._viewRect=v||{x:this._element.getLocation().x,y:this._element.getLocation().y,width:0,height:0},this.iconsGroups=t,this.colorGroups=e;var m=this._element instanceof De.Link&&this._element.getStyle("link.icons.rotatable");for(i=0;i<len;i++)if(m instanceof Array&&m[i]&&this._viewRect){var y=this._viewRect.x+this._viewRect.width/2,A=this._viewRect.y+this._viewRect.height/2,x=Math.sqrt(this._viewRect.height*this._viewRect.height+this._viewRect.width*this._viewRect.width);this._viewRect={x:y-x/2,y:A-x/2,width:x,height:x}}}},_makeGroup:function(t){if(!Array.isArray(t))return[[t]];var e,i,n,s=[],r=!1,a=t.length;for(e=0;a>e;e++)i=t[e],Array.isArray(i)?(r=!0,s.push(i)):(n=[i],s.push(n));return r||(s.length=0,s.push(t)),s},_makeArray:function(t,e,i){if(Array.isArray(t))return t;for(var n=[],s=0;e>s;s++)n.push(t||i);return n},paint:function(t){if(De.canvas.IconsAttachment.superClass.paint.apply(this,arguments),this.iconsNames&&0!=this.iconsNames.length&&this.locations){var e,i,n,s,r,a,o,h,l,c;for(e=0;e<this.iconsGroups.length;e++)if(i=this.locations[e]){r=i.x,a=i.y,s=this.iconsGroups[e],o=this.colorGroups[e],h=this.iconsOrientation[e],l=this.iconsXgap[e]||1,c=this.iconsYgap[e]||1,n=0;for(var u in s){var d=null,f=null;o&&o.length>n&&(f=o[n++]);var g=Be.getImageAsset(s[u]);if(null!=g){if("right"===h)d={x:r,y:a,width:g.getWidth(),height:g.getHeight()},r+=d.width+l;else if("left"===h)d={x:r-g.getWidth(),y:a,width:g.getWidth(),height:g.getHeight()},r-=d.width+l;else if("top"===h)d={x:r,y:a-g.getHeight(),width:g.getWidth(),height:g.getHeight()},a-=d.height+c;else{if("bottom"!==h)throw"Can not resolve '"+h+"' orientation";d={x:r,y:a,width:g.getWidth(),height:g.getHeight()},a+=d.height+c}var _=this._element instanceof De.Link&&this._element.getStyle("link.icons.rotatable");if(_ instanceof Array&&_[e]){t.save();var p=d,r=p.x+p.width/2,a=p.y+p.height/2;t.translate(r,a),t.rotate(this._network.getElementUI(this._element).getAngle()),t.translate(-r,-a),Fi(t,g.getImage(f,d.width,d.height),f,d,this._element,this._network),t.restore()}else Fi(t,g.getImage(f,d.width,d.height),f,d,this._element,this._network);if(this._network._debug){var d=this._viewRect;qe.strokeRect(t,d,"#FCFC00",1),qe.strokeRect(t,d,"#FCFC00",1)}}}}}},_getIconsSize:function(t,e,i,n){var s=0,r=0,a=null,o=null,h=null;for(var l in t)if(o=Be.getImageAsset(t[l])){if("right"===e)a={x:s,y:r,width:o.getWidth(),height:o.getHeight()},s+=a.width+i;else if("left"===e)a={x:s-o.getWidth(),y:r,width:o.getWidth(),height:o.getHeight()},s-=a.width+i;else if("top"===e)a={x:s,y:r-o.getHeight(),width:o.getWidth(),height:o.getHeight()},r-=a.height+n;else{if("bottom"!==e)throw"Can not resolve '"+e+"' orientation";a={x:s,y:r,width:o.getWidth(),height:o.getHeight()},r+=a.height+n}h=null==h?Be.clone(a):Ge.unionRect(h,a)}return h?{width:Math.abs(h.width),height:Math.abs(h.height)}:null}}),De.canvas.EditAttachment=function(t,e){De.canvas.EditAttachment.superClass.constructor.call(this,t,e)},Be.ext("twaver.canvas.EditAttachment",De.canvas.Attachment,{paint:function(t){De.canvas.EditAttachment.superClass.paint.apply(this,arguments),this._viewRect=null,this.paintResizingPoints(t),this.paintEditPoints(t),this.paintRotatePoints(t)},paintResizingPoints:function(t){var e=this.resizingPoints.size();if(!(0>=e)){var i=2*this.resizePointSize,n=2*this.resizePointSize,s=this._network.getResizePointFillColor(),r=this._network.getResizePointOutlineWidth(),a=this._network.getResizePointOutlineColor(),o=this._element.getAngle(),h=this._element.getOriginalRect();t.lineWidth=r;for(var l=0;e>l;l++){var c=this.resizingPoints.get(l),u={x:c.x-this.resizePointSize,y:c.y-this.resizePointSize,width:2*this.resizePointSize,height:2*this.resizePointSize},d=this._getRotateRect(u,o,{x:h.x+h.width/2,y:h.y+h.height/2});t.save(),De.Util.rotateCanvas(t,d,o),Un.rect(t,d.x,d.y,i,n),t.restore()}t.fillStyle=s,t.strokeStyle=a,t.fill(),t.stroke()}},paintEditPoints:function(t){var e=this.editPoints.size();if(!(0>=e)){var i=this._network.getEditPointOutlineColor(),n=this._network.getEditPointFillColor(),s=this._network.getEditPointOutlineWidth();t.beginPath(),t.lineWidth=s;for(var r=0;e>r;r++){var a=this.editPoints.get(r);t.beginPath(),Un.circle(t,a.x,a.y,this.editPointSize,n,i),t.closePath()}}},paintRotatePoints:function(t){var e=this.rotatePoints.size();if(!(0>=e)){var i=this._network.getRotatePointOutlineColor(),n=this._network.getRotatePointFillColor(),s=this._network.getRotatePointOutlineWidth();t.beginPath(),t.lineWidth=s;for(var r=0;e>r;r++){var a=this.rotatePoints.get(r);t.beginPath(),Un.circle(t,a.x,a.y,this.rotatePointSize,n,i),t.closePath()}}},validate:function(){De.canvas.EditAttachment.superClass.validate.call(this),this.editPointSize=this._network.getEditPointSize(),this.resizePointSize=this._network.getResizePointSize(),this.rotatePointSize=this._network.getRotatePointSize(),this.resizingPoints=new De.List,this.editPoints=new De.List,this.rotatePoints=new De.List,this._element instanceof De.Node&&this._addResizingPoint(this._element),!(this._network.isRotatable(this._element)&&this._element instanceof On)||this._element instanceof De.ShapeNode||this._element instanceof De.Grid||this._element instanceof De.Group||this._addRotatePoint(this._element),this._element instanceof De.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof De.canvas.ShapeLinkUI&&this._addShapeLinkPoints(this._element),this._ui instanceof De.canvas.LinkUI&&this._addLinkControlPoint(this._ui)},_addResizingPoint:function(t){var e=t.getOriginalRect();if(e){var i=this._network.getResizePointSize();if(!(0>=i)){var n=new gn([{x:e.x,y:e.y},{x:e.x+e.width/2,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x,y:e.y+e.height/2},{x:e.x+e.width,y:e.y+e.height/2},{x:e.x,y:e.y+e.height},{x:e.x+e.width/2,y:e.y+e.height},{x:e.x+e.width,y:e.y+e.height}]),s=this._network.getResizePointOutlineWidth(),r=this._network.getResizePointOutlineColor(),a=this._network.getResizePointFillColor();this._addPoints(t.getRect(),n,s,r,a,!0)}}},_addRotatePoint:function(t){var e=t.getOriginalRect();if(e){var i=this._network.getRotatePointSize();if(!(0>=i)){var n=2*i,s=new De.List([{x:e.x+e.width/2,y:e.y-this._network.getRotatePointOffset()-n/2}]),r=t.getAngle();0!=r&&(s=this._rotatePointList(s,r,t.getOriginalRect()));var a=s.get(0),o={x:a.x-n/2,y:a.y-n/2,width:n,height:n},h=this._network.getRotatePointOutlineWidth(),l=this.rotatePointSize+h;Ge.grow(e,l,l);var c=Ge.unionRect(t.getRect(),o);this._viewRect=Ge.unionRect(c,this._viewRect),this.rotatePoints=s}}},_addShapeNodePoint:function(t){this._addEditPoints(t.getPoints())},_addShapeLinkPoints:function(t){this._addEditPoints(t.getPoints())},_addLinkControlPoint:function(t){if(bi.isOrthogonalLink(t._element)){var e=t.getControlPoint();if(e){var i=new De.List;i.add(e),this._addEditPoints(i)}}},_addEditPoints:function(t){var e=Ge.getRect(t);if(e){var i=this._network.getEditPointSize();if(!(0>=i)){var n=this._network.getEditPointOutlineWidth();this._addPoints(e,t,n,!1)}}},_addPoints:function(t,e,i,n,s,r){var a=r?this._network.getResizePointSize():this._network.getEditPointSize();if(!(0>a)){var o=a+i;Ge.grow(t,o,o),this._viewRect=Ge.unionRect(t,this._viewRect),1==r?this.resizingPoints=e:this.editPoints=e}},_rotatePoint:function(t,e,i){var n=Ge.createMatrix(e*Math.PI/180,i.x+i.width/2,i.y+i.height/2),s=n.transform(t);return s},_rotatePointList:function(t,e,i){var n=this,s=new De.List;return t.forEach(function(t){s.add(n._rotatePoint(t,e,i))}),s},_getRotateRect:function(t,e,i){var n=Ge.createMatrix(e*Math.PI/180,i.x,i.y),s={x:t.x+t.width/2,y:t.y+t.height/2},r=n.transform(s),a=new De.List([{x:r.x-t.width/2,y:r.y-t.height/2},{x:r.x+t.width/2,y:r.y-t.height/2},{x:r.x+t.width/2,y:r.y+t.height/2},{x:r.x-t.width/2,y:r.y+t.height/2}]);return Ge.getRect(a)}}),De.canvas.HTMLLabelAttachment=function(t,e){De.canvas.HTMLLabelAttachment.superClass.constructor.call(this,t,e),this._triangleDiv=De.Util.createDiv(),this._roundDiv=De.Util.createDiv(),this._contentDiv=De.Util.createDiv(),this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Be.ext("twaver.canvas.HTMLLabelAttachment",De.canvas.LabelAttachment,{validate:function(){var t=this._element.getStyle("attachment.htmllabel.hyperlink");t?(De.Util.setCSSStyle(this._triangleDiv,"pointer-events","auto"),De.Util.setCSSStyle(this._contentDiv,"pointer-events","auto")):(De.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),De.Util.setCSSStyle(this._contentDiv,"pointer-events","none")),De.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),De.Util.setCSSStyle(this._contentDiv,"white-space","nowrap");var e=(this.getFont("label.font"),this.getLabel());this._contentDiv.innerHTML=e,this._contentDiv.style.visibility="hidden",De.canvas.HTMLLabelAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(De.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(De.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(t){var e=this.isFill(),i=this.getOutlineWidth(),n=this._contentRect;if(this.getElementUI().setShadow(this,t),i>0||e){if(qe.drawRoundRect(t,n.x,n.y,n.width,n.height,this.getCornerRadius()),this._pointers){var s=this._pointers;t.moveTo(s[0].x,s[0].y),t.lineTo(s[1].x,s[1].y),t.lineTo(s[2].x,s[2].y)}if(t.closePath(),i>0&&(t.lineWidth=i,t.strokeStyle=this.getOutlineColor(),t.lineCap=this.getCap(),t.lineJoin=this.getJoin(),t.stroke()),e){var r=this.getFillColor(),a=this.getGradient();a?qe.fill(t,r,a,this.getGradientColor(),this._viewRect):t.fillStyle=r,t.fill()}}var o=(this.getFont("label.font"),this.getLabel(),this._network.getViewRect().x),h=this._network.getViewRect().y,l=this._network.getZoom(),c={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},u=c.x*l-o-this._contentDiv.offsetWidth/2*l+"px",d=c.y*l-h-this._contentDiv.offsetHeight/2*l+"px";this._contentDiv.style.left=u,this._contentDiv.style.top=d,this._contentDiv.style.setProperty("-webkit-transform","scale("+l+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null),this._network._debug&&qe.strokeRect(t,this._contentRect,"#AAAAAA")},setVisibility:function(t){this._contentDiv.style.visibility=t},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),De.canvas.HTMLAlarmAttachment=function(t,e){De.canvas.HTMLAlarmAttachment.superClass.constructor.call(this,t,e),this._triangleDiv=De.Util.createDiv(),this._roundDiv=De.Util.createDiv(),this._contentDiv=De.Util.createDiv(),De.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),De.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),De.Util.setCSSStyle(this._contentDiv,"white-space","nowrap"),De.Util.setCSSStyle(this._contentDiv,"pointer-events","none"),this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Be.ext("twaver.canvas.HTMLAlarmAttachment",De.canvas.AlarmAttachment,{validate:function(){var t=(this.getFont("alarm.font"),this._network.getAlarmLabel(this._element));this._contentDiv.innerHTML=t,this._contentDiv.style.visibility="hidden",De.canvas.HTMLAlarmAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(De.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(De.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(t){var e=this.isFill(),i=this.getOutlineWidth(),n=this._contentRect;if(this.getElementUI().setShadow(this,t),i>0||e){if(qe.drawRoundRect(t,n.x,n.y,n.width,n.height,this.getCornerRadius()),this._pointers){var s=this._pointers;t.moveTo(s[0].x,s[0].y),t.lineTo(s[1].x,s[1].y),t.lineTo(s[2].x,s[2].y)}if(t.closePath(),i>0&&(t.lineWidth=i,t.strokeStyle=this.getOutlineColor(),t.lineCap=this.getCap(),t.lineJoin=this.getJoin(),t.stroke()),e){var r=this.getFillColor(),a=this.getGradient();a?qe.fill(t,r,a,this.getGradientColor(),this._viewRect):t.fillStyle=r,t.fill()}}var o=(this.getFont("alarm.font"),this._network.getAlarmLabel(this._element),this._network.getViewRect().x),h=this._network.getViewRect().y,l=this._network.getZoom(),c={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},u=c.x*l-o-this._contentDiv.offsetWidth/2*l+"px",d=c.y*l-h-this._contentDiv.offsetHeight/2*l+"px";this._contentDiv.style.left=u,this._contentDiv.style.top=d,this._contentDiv.style.setProperty("-webkit-transform","scale("+l+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null),this._network._debug&&qe.strokeRect(t,this._contentRect,"#AAAAAB"),De.canvas.AlarmAttachment.superClass.paint.apply(this,arguments)},setVisibility:function(t){this._contentDiv.style.visibility=t},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),De.canvas.interaction.BaseInteraction=function(t){this.network=t},Be.ext("twaver.canvas.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},repaint:function(){this.network.repaintTopCanvas()},convertPointFromView:function(t){var e=t.x*this.network.getZoom()-this.network.getViewRect().x,i=t.y*this.network.getZoom()-this.network.getViewRect().y;return{x:e,y:i}},convertFromUIToMarkerRect:function(t,e,i){var n=this.network.getZoom();return{x:t.x*n-this.network.getViewRect().x+e*n,y:t.y*n-this.network.getViewRect().y+i*n,width:t.width*n,height:t.height*n}},getMarkerPoint:function(t){var e;if(He.isTouchable&&t.changedTouches&&t.changedTouches.length>0){var i=t.changedTouches[0];return e={x:i.clientX,y:i.clientY}}return e=He.isFirefox?{x:t.layerX,y:t.layerY}:{x:t.offsetX,y:t.offsetY}},paint:function(t){},addListener:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];je.addEventListener(e,"handle_"+e,this.network.getView(),this)}},removeListener:function(){for(var t=0;t<arguments.length;t++)je.removeEventListener(arguments[t],this.network.getView(),this)},_handle_mousedown:function(t){0===t.button&&(this._startLogical=this.network.getLogicalPoint(t),this._startClient=je.getClientPoint(t),this._startLogical&&je.handle_mousedown(this,t))},_handle_mousemove:function(t){this._endLogical={x:this._startLogical.x+(t.clientX-this._startClient.x)/this.network.getZoom(),y:this._startLogical.y+(t.clientY-this._startClient.y)/this.network.getZoom()}},_handle_mouseup:function(t){delete this._startClient,delete this._startLogical,delete this._endLogical}}),De.canvas.interaction.SelectInteraction=function(t){De.canvas.interaction.SelectInteraction.superClass.constructor.call(this,t)},Be.ext("twaver.canvas.interaction.SelectInteraction",De.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup"),this.end(),this.network.removeMarker(this)},paint:function(t){if(null!=this.startPoint&&null!=this.endPoint){var e=this.convertPointFromView(this.startPoint),i=this.convertPointFromView(this.endPoint),n=e.x,s=e.y,r=i.x,a=i.y,o=Ge.getRect([{x:n,y:s},{x:r,y:a}]);if(null!=o){t.beginPath();var h=this.network.getSelectOutlineWidth(),l=this.getIntersectMode()?this.network.getSelectFillColor():null;t.strokeStyle=this.network.getSelectOutlineColor(),t.lineWidth=h,Un.rect(t,o.x,o.y,o.width,o.height,l,this.network.getSelectOutlineColor()),t.closePath()}}},handle_mousedown:function(t){if(this.network.isValidEvent(t)&&!this.network.isMovingElement()&&!this.network.isEditingElement()&&!t.shiftKey){var e=this.network.getElementAt(t),i=this.network.getSelectionModel();e?Be.isCtrlDown(t)?i.contains(e)?i.removeSelection(e):i.appendSelection(e):i.contains(e)||i.setSelection(e):(Be.isCtrlDown(t)||i.clearSelection(),this.end(t),this.startPoint=this.network.getLogicalPoint(t),this.startPoint&&this.network.isRectSelectEnabled()&&this.addListener("mousemove"))}},handle_mouseup:function(t){this.end(t)},handle_mousemove:function(t){if(this.network.isMovingElement()||this.network.isEditingElement())return void this.end(t);var e=this.network.getLogicalPoint(t);e&&(this.network.setSelectingElement(!0),this.network.fireInteractionEvent(null==this.endPoint?{kind:"selectStart",event:t}:{kind:"selectBetween",event:t}),this.endPoint=e,this.repaint())},end:function(t){if(this.startPoint){if(this.endPoint&&this.startPoint.x!==this.endPoint.x&&this.startPoint.y!==this.endPoint.y){var e=Ge.getRect([this.startPoint,this.endPoint]),i=this.network.getElementsAtRect(e,this.getIntersectMode(),this.network.getRectSelectFilter());if(i&&i.size()>0){var n=this.network.getSelectionModel(),s=n.toSelection();i.forEach(function(t){n.contains(t)?s.remove(t):s.add(t)},this),n.setSelection(s)}this.network.fireInteractionEvent({kind:"selectEnd",event:t})}this.network.setSelectingElement(!1),this.removeListener("mousemove"),this.startPoint=null,this.endPoint=null,this.repaint()}},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()||"contain"!==this.network.getSelectMode()&&(this.startPoint.x>this.endPoint.x&&this.startPoint.y>this.endPoint.y)}}),De.canvas.interaction.MoveInteraction=function(t,e){this.lazyMode=e,De.canvas.interaction.MoveInteraction.superClass.constructor.call(this,t)},Be.ext("twaver.canvas.interaction.MoveInteraction",De.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","keydown","mouseout"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","keydown","mouseout"),this.end(),this.network.removeMarker(this)},handle_keydown:function(t){this.currentKeyEvent=t,this.addListener("keyup")},handle_keyup:function(t){this.currentKeyEvent=null,this.removeListener("keyup")},isParenting:function(){return this.pressPoint&&null!=this.currentKeyEvent&&80===this.currentKeyEvent.keyCode},parentProcess:function(t,e){var i=null;this.parent=null;var n=this;if(!e&&this.isParenting()){var s={},r=this.network.getLogicalPoint(t);s.x=r.x-1,s.y=r.y-1,s.width=2,s.height=2;var a=this.network.getElementsAtRect(s,!0);if(a&&a.size()>0)for(var o=a.size(),h=0;o>h;h++){var l=a.get(h);if(!n.network.getElementBox().getSelectionModel().contains(l)){n.parent=l;break}}}else this.parent=null;null!=this.parent&&(i=this.network.getElementUI(this.parent).getViewRect()),this.parentRect=null==i||e?null:i},paint:function(t){if(this.lazyMode){if(null==this.pressPoint||null==this.dragPoint)return;t.beginPath();var e=this.dragPoint.x-this.pressPoint.x,i=this.dragPoint.y-this.pressPoint.y,n=this.network.getMovableSelectedElements(),s=n.size(),r=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,a=this.network.getLazyMoveOutlineWidth(),o=this.network.getLazyMoveOutlineColor();t.strokeStyle=o,t.lineWidth=a,t.fillStyle=r;for(var h=0;s>h;h++){var l=n.get(h),c=this.network.getElementUI(l);if(c){var u=this.convertFromUIToMarkerRect(c.getViewRect(),e,i);Un.rect(t,u.x,u.y,u.width,u.height)}}t.fill(),t.stroke()}if(this.parentRect){t.beginPath();var r=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,a=this.network.getLazyMoveOutlineWidth(),o=this.network.getLazyMoveOutlineColor();t.strokeStyle=o,t.lineWidth=a,t.fillStyle=r;var u=this.parentRect;Un.rect(t,u.x,u.y,u.width,u.height),t.fill(),t.stroke()}},handle_mousedown:function(t){if(0===t.button&&this.network.isValidEvent(t)&&!this.network.isSelectingElement()&&!this.network.isEditingElement()){
var e=this.network.getElementAt(t);this.network.isMovable(e)&&(this.end(t),this.lastPoint=this.network.getLogicalPoint(t),this.lazyMode&&(this.pressPoint=this.lastPoint),this.lastPoint&&this.addListener("mousemove"))}},handle_mouseup:function(t){this.end(t)},handle_mouseout:function(t){this.end(t)},handle_mousemove:function(t){if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.network.hasMovableSelectedElements())return void this.end(t);var e=this.network.getLogicalPoint(t);e&&this.lastPoint&&(this.xoffset=e.x-this.lastPoint.x,this.yoffset=e.y-this.lastPoint.y,Math.abs(this.xoffset)<1&&Math.abs(this.yoffset)<1||(this.lazyMode?null==this.dragPoint?(this.network.fireInteractionEvent({kind:"lazyMoveStart",event:t}),this.network.setMovingElement(!0)):this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:t}):(this.lastPoint=e,this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:t})),this.network.moveSelectedElements(this.xoffset,this.yoffset)),this.parentProcess(t,!1),this.lazyMode&&(this.dragPoint=e),(this.lazyMode||this.isParenting())&&this.repaint()))},end:function(t){if(this.lazyMode){if(null!=this.dragPoint&&null!=this.pressPoint){var e=this,i=function(){e.network.fireInteractionEvent({kind:"lazyMoveEnd",event:t}),e.network.setMovingElement(!1)},n=this.dragPoint.x-this.pressPoint.x,s=this.dragPoint.y-this.pressPoint.y;this.network.moveSelectedElements(n,s,this.network.isLazyMoveAnimate(),i)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:t}));if(this.isParenting()){null==this.parent&&(this.parent=this.network.getCurrentSubNetwork());var e=this;this.network.getMovableSelectedElements().forEach(function(t){t.setParent(e.parent)},this.network)}this.parentProcess(t,!0),this.isParenting()&&this.repaint(),this.network.invalidateCanvasSize(),this.removeListener("mousemove"),this.lastPoint=null,this.dragPoint=null,this.pressPoint=null}}),De.canvas.interaction.ScrollInteraction=function(t){De.canvas.interaction.ScrollInteraction.superClass.constructor.call(this,t),this.hThumbRect=null,this.vThumbRect=null,this.scrollBarVisible=!1},Be.ext("twaver.canvas.interaction.ScrollInteraction",De.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseover","mouseout"),He.isFirefox?je.addEventListener("DOMMouseScroll","handleMouseWheel",this.network.getView(),this):je.addEventListener("mousewheel","handleMouseWheel",this.network.getView(),this),je.addEventListener("mouseup","handleMouseUp",t,this),je.addEventListener("mousemove","handleMouseMove",t,this),this.network.addPropertyChangeListener(this.handleViewRectChange,this),this.validateScrollBar(),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseover","mouseout"),He.isFirefox?je.removeEventListener("DOMMouseScroll",this.network.getView(),this):je.removeEventListener("mousewheel",this.network.getView(),this),je.removeEventListener("mouseup",t,this),je.removeEventListener("mousemove",t,this),this.network.removePropertyChangeListener(this.handleViewRectChange,this),this.network.removeMarker(this)},handleViewRectChange:function(t){("viewRect"==t.property||"canvasSizeChange"==t.property)&&this.validateScrollBar()},getScrollBarWidth:function(){return this.network.getScrollBarWidth()},getScrollBarColor:function(){return"#cccccc"},validateScrollBar:function(){if(this.hThumbRect=null,this.vThumbRect=null,0==this.network.isScrollBarVisible())return void this.repaint();var t=this.network.getViewRect().height,e=this.network.getViewRect().width,i=this.network.getViewRect().x,n=this.network.getViewRect().y,s=this.network.getCanvasSize(),r=s.width,a=s.height;if(r>e&&(0>i||i+e>r))return void this.repaint();if(a>t&&(0>n||n+t>a))return void this.repaint();var o=0,h=a>t,l=r>e,c=this.getScrollBarWidth();if(a>t){o=l?t*(t-c)/a:t*t/a;var u=n/(a-t)*(t-o-c);this.vThumbRect={x:e-c,y:u,width:c,height:o}}var d=0;if(r>e){d=h?e*(e-c)/r:e*e/r;var f=i/(r-e)*(e-d-c);this.hThumbRect={x:f,y:t-c,width:d,height:c}}this.network.setHScrollBarVisible(null!=this.hThumbRect),this.network.setVScrollBarVisible(null!=this.vThumbRect),this.repaint()},scrollXOffset:function(t){var e=this.network.getViewRect().height,i=this.network.getViewRect().width,n=this.network.getViewRect().x,s=this.network.getViewRect().y,r=30;t&&(r=-30),this.network.setViewRect(n+r,s,i,e)},scrollYOffset:function(t){var e=this.network.getViewRect().height,i=this.network.getViewRect().width,n=this.network.getViewRect().x,s=this.network.getViewRect().y,r=30;t&&(r=-30),this.network.setViewRect(n,s+r,i,e)},handle_mousedown:function(t){if(1!=this.network.isValidEvent(t)){var e=this.getMarkerPoint(t);this.hBarDownPoint=null,this.vBarDownPoint=null,null!=this.vThumbRect&&Ge.containsPoint(this.vThumbRect,e.x,e.y)&&(this.vBarDownPoint={x:t.screenX,y:t.screenY},this.vBarDownOffset=this.vBarDownPoint.y-this.vThumbRect.y),null!=this.hThumbRect&&Ge.containsPoint(this.hThumbRect,e.x,e.y)&&(this.hBarDownPoint={x:t.screenX,y:t.screenY},this.hBarDownOffset=this.hBarDownPoint.x-this.hThumbRect.x)}},handle_mouseover:function(t){1!=this.scrollBarVisible&&(this.scrollBarVisible=!0,this.repaint())},handle_mouseout:function(t){0!=this.scrollBarVisible&&(this.scrollBarVisible=!1,this.repaint())},handleMouseUp:function(t){this.vBarDownPoint=null,this.hBarDownPoint=null,this.repaint()},handleMouseMove:function(t){var e={x:t.screenX,y:t.screenY},i=this.network.getCanvasSize(),n=this.network.getViewRect().height,s=this.network.getViewRect().width,r=this.getScrollBarWidth();if(null!=this.hBarDownPoint){var a=e.x-this.hBarDownPoint.x;return this.hBarDownPoint=e,void this.network.setViewOffSet(a*i.width/(s-r),0)}if(null!=this.vBarDownPoint){var o=e.y-this.vBarDownPoint.y;return this.vBarDownPoint=e,void this.network.setViewOffSet(0,o*i.height/(n-r))}},handleMouseWheel:function(t){var e=!1;t.wheelDelta!==t.wheelDeltaX?(t.wheelDelta?t.wheelDelta>0&&(e=!0):t.detail<0&&(e=!0),this.scrollYOffset(e)):(t.wheelDelta?t.wheelDelta>0&&(e=!0):t.detail<0&&(e=!0),this.scrollYOffset(e))},paintRoundRect:function(t,e,i,n,s,r,a,o){t.beginPath(),t.globalAlpha=i,t.fillStyle=e,qe.drawRoundRect(t,n,s,r,a,o),t.fill()},paint:function(t){if(0!=this.network.isScrollBarVisible()&&(0!=this.scrollBarVisible||null!=this.hBarDownPoint||null!=this.vBarDownPoint)){var e=this.getScrollBarWidth(),i=this.network.getViewRect().height,n=this.network.getViewRect().width;t.save();var s,r=this.getScrollBarColor();null!=this.hThumbRect&&(s=t.createLinearGradient(this.hThumbRect.x,this.hThumbRect.y,this.hThumbRect.x,this.hThumbRect.y+this.hThumbRect.height),s.addColorStop(0,r),s.addColorStop(1,"#666666"),this.paintRoundRect(t,this.getScrollBarColor(),.5,0,i-e,n-e,e,e/2),this.paintRoundRect(t,s,.9,this.hThumbRect.x,this.hThumbRect.y+1,this.hThumbRect.width,this.hThumbRect.height-2,e/2)),null!=this.vThumbRect&&(s=t.createLinearGradient(this.vThumbRect.x,this.vThumbRect.y,this.vThumbRect.x+this.vThumbRect.width,this.vThumbRect.y),s.addColorStop(0,r),s.addColorStop(1,"#666666"),this.paintRoundRect(t,this.getScrollBarColor(),.5,n-e,0,e,i-e,e/2),this.paintRoundRect(t,s,.9,this.vThumbRect.x+1,this.vThumbRect.y,this.vThumbRect.width-2,this.vThumbRect.height,e/2)),t.restore()}}}),De.canvas.interaction.DefaultInteraction=function(t){De.canvas.interaction.DefaultInteraction.superClass.constructor.call(this,t)},Be.ext("twaver.canvas.interaction.DefaultInteraction",De.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove","keydown")},tearDown:function(){this.removeListener("mousedown","mousemove","keydown")},handle_mousedown:function(t){if(this.network.isValidEvent(t)){this.network.isFocusOnClick()&&De.Util.setFocus(this.network.getView());var e=this.network.getElementAt(t);2===t.detail?this.handleDoubleClicked(t,e):this.handleClicked(t,e)}},handleClicked:function(t,e){Li.handleClicked(this.network,t,e)},handleDoubleClicked:function(t,e){Li.handleDoubleClicked(this.network,t,e)},handle_keydown:function(t){Li.handleKeyDown(this.network,t)},handle_mousemove:function(t){var e=this.network.getElementAt(t),i=this._preElement,n=Mi(i),s=Mi(e);i!==e&&(i&&(n&&n.onMouseLeave&&n.onMouseLeave(i,this.network),this.network.onMouseLeave(i,t)),e&&(s&&s.onMouseEnter&&s.onMouseEnter(e,this.network),this.network.onMouseEnter(e,t))),e&&s&&s.onMouseMove&&s.onMouseMove(e,this.network),this.network.onMouseMove(e,t),this._preElement=e}}),De.canvas.interaction.PanInteraction=function(t){De.canvas.interaction.PanInteraction.superClass.constructor.call(this,t)},Be.ext("twaver.canvas.interaction.PanInteraction",De.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup"),this._oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown","mouseup")},handle_mousedown:function(t){this.network.isValidEvent(t)&&(this.lastPoint=this.getMarkerPoint(t),this.lastPoint&&(this.addListener("mousemove"),this.network.getView().style.cursor="pointer"))},handle_mouseup:function(t){this._clear()},handle_mousemove:function(t){if(this.lastPoint){var e=this.getMarkerPoint(t);if(e){var i=e.x-this.lastPoint.x,n=e.y-this.lastPoint.y;this.network.panByOffset(-i,-n),this.lastPoint=e}}},_clear:function(t){this.lastPoint&&(this.lastPoint=null,this.network.getView().style.cursor=this._oldCursor,this.removeListener("mousemove"))}}),De.canvas.interaction.CreateElementInteraction=function(t,e){e||(e=De.Node),this.elementFunction=De.Util.isTypeOf(e,De.Node)?function(t){var i=new e;return i instanceof De.Node&&i.setCenterLocation(t),i}:e,De.canvas.interaction.CreateElementInteraction.superClass.constructor.call(this,t)},Be.ext("twaver.canvas.interaction.CreateElementInteraction",De.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(t){var e=this.network.getLogicalPoint(t);if(e){var i=this.elementFunction(e);i&&this.network.addElementByInteraction(i)}}}),De.canvas.interaction.EditInteraction=function(t,e){this.lazyMode=e,this.pointIndex=-1,De.canvas.interaction.EditInteraction.superClass.constructor.call(this,t)},Be.ext("twaver.canvas.interaction.EditInteraction",De.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear(),this.network.removeMarker(this)},paint:function(t){if(1==this.lazyMode&&null!=this.resizingRect){t.lineWidth=this.network.getResizeLineWidth();var e=this.convertFromUIToMarkerRect(this.resizingRect,0,0);t.save(),De.Util.rotateCanvas(t,e,this.node.getAngle()),t.beginPath(),Un.rect(t,e.x,e.y,e.width,e.height,null,this.network.getResizeLineColor()),t.restore()}this.isStartRotate&&this.showRotateScale(t)},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.network.repaintTopCanvas()},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(t){this.cursorID=t,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},handle_mousedown:function(t){if(0===t.button)if(!Be.isAltDown(t)||this.network.isEditingElement())!this.network.isEditingElement()||this.isStart||this.isStartRotate||(this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:t,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?Be.isAltDown(t)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:t,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0?Be.isAltDown(t)?(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:t,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(t)));else{var e=this.network.getElementAt(t),i=this.network.getLogicalPoint(t);if(e instanceof De.ShapeNode){var n=this.getPointIndex(e.getPoints(),i,!0);n>0&&(this._handle_mousedown(t),this.pointIndex=n,this.shapeNode=e,e.addPoint(i,n),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:t,element:e,pointIndex:n}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:e,pointIndex:n}))}if(e instanceof De.ShapeLink){var s=new De.List(e.getPoints()),r=this.network.getElementUI(e);s.add(r.getFromPoint(),0),s.add(r.getToPoint());var n=this.getPointIndex(s,i)-1;n>0&&(this._handle_mousedown(t),this.pointIndex=n,this.shapeLink=e,e.addPoint(i,n),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:t,element:e,pointIndex:n}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:e,pointIndex:n}))}}},handle_mouseup:function(t){if(this.isStart){var e=this.network.getLogicalPoint(t);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var i=this,n=new De.animate.AnimateBounds(this.node,this.resizingRect,function(){i.network.fireInteractionEvent({kind:"lazyResizeEnd",event:t,element:i.node,resizeDirection:i.resizeDirection}),i.clear()});De.animate.AnimateManager.start(n)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:t,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:t,element:this.node,resizeDirection:this.resizeDirection});else this.shapeNode&&this.pointIndex>=0&&e?(this.shapeNode.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:t,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0&&e?(this.shapeLink.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:t,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI&&e&&(this.linkUI.setControlPoint(e),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:t,element:this.linkUI._element}))}this._handle_mouseup(t),this.lazyMode||this.clear()},handle_mousemove:function(t){if(this.network.isValidEvent(t)){if(this.isStartRotate&&this.node)return this._handleRotateElement(t,this.node),void(this.network.isShowRotateScale()&&this.repaint());if(this.isStart){if(this.shapeNode&&this.pointIndex>=0)return void this._handleMovingShapeNodePoint(t);if(this.shapeLink&&this.pointIndex>=0)return void this._handleMovingShapeLinkPoint(t);if(this.node&&this.resizeDirection)return void this._handleResizing(t);if(this.linkUI)return void this._handleMovingLinkControlPoint(t)}if(this.network.isSelectingElement()||this.network.isMovingElement()||0===this.network.getSelectionModel().size())return void this.clear();var e=this.network.getElementAt(t),i=this.network.getElementUI(e);if(!i||!i.getEditAttachment())return void this.clear();var n=this.network.getLogicalPoint(t);if(e instanceof De.Node){if(this.node=e,this._isEditingShapeNode(n)||this._isResizingNode(n))return void this.network.setEditingElement(!0);if(this._isRotatingElement(n))return this.network.setRotatingElement(!0),void this.network.setEditingElement(!0)}else if(e instanceof De.ShapeLink){if(this.shapeLink=e,this._isEditingShapeLink(n))return void this.network.setEditingElement(!0)}else if(i instanceof De.canvas.LinkUI){var s=this.network.getEditPointSize();if(bi.isOrthogonalLink(i._element)){this.linkUI=i;var r=this.linkUI.getControlPoint();return void(r&&this._contains(n,r,s)&&(this._setCrossCursor(),this.network.setEditingElement(!0)))}}this.clear()}},_isRotatingElement:function(t){var e=this.network.getRotatePointSize();if(0>=e)return!1;var i=this.node.getOriginalRect(),n=this.node.getAngle();return this._isRotating(t,"crosshair",i,n)},_isRotating:function(t,e,i,n){var s=this.network.getRotatePointSize(),r={x:i.x+i.width/2,y:i.y-this.network.getRotatePointOffset()-s},a=this._rotatePoint(r,n,i),o={x:a.x-s,y:a.y-s,width:2*s,height:2*s};return!!Ge.containsPoint(o,t)&&(this._removeCursor(),this._setCursor(e),!0)},_handleRotateElement:function(t,e){this._handle_mousemove(t);var i=this._calculateAngle(this.network.getLogicalPoint(t),e);e.setAngle(i)},_calculateAngle:function(t,e){var i=e.getCenterLocation();return Math.round(180*Math.atan2(i.x-t.x,t.y-i.y)/Math.PI+180)},_handleMovingShapeNodePoint:function(t){var e=this.network.getLogicalPoint(t);this.shapeNode.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:t,element:this.shapeNode,pointIndex:this.pointIndex})},_handleMovingShapeLinkPoint:function(t){var e=this.network.getLogicalPoint(t);this.shapeLink.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:t,element:this.shapeLink,pointIndex:this.pointIndex})},_handleMovingLinkControlPoint:function(t){this.linkUI.setControlPoint(this.network.getLogicalPoint(t)),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:t,element:this.linkUI._element})},_handleResizing:function(t){this._handle_mousemove(t);var e=this.node.getAngle(),i=this.node.getLocation(),n=this.node.getWidth()/2,s=this.node.getHeight()/2,r={x:i.x+n,y:i.y+s},a={x:-n,y:-s},o={x:-n,y:s},h={x:n,y:s},l={x:n,y:-s},c={x:0,y:-s},u={x:n,y:0},d={x:0,y:s},f={x:-n,y:0};if("northwest"===this.resizeDirection&&(this._transformPoint(h,r,e),a.x=this._endLogical.x,a.y=this._endLogical.y,r.x=(a.x+h.x)/2,r.y=(a.y+h.y)/2,this._reversPoint(a,r,e),this._reversPoint(h,r,e),this.resizingRect={x:a.x,y:a.y,width:h.x-a.x,height:h.y-a.y}),"north"===this.resizeDirection){var g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,r,e),c.y=g.y-r.y,this._transformPoint(c,r,e),this._transformPoint(d,r,e),r.x=(c.x+d.x)/2,r.y=(c.y+d.y)/2,this._reversPoint(c,r,e),this._reversPoint(d,r,e),this.resizingRect={x:r.x-this.node.getWidth()/2,y:r.y-(d.y-c.y)/2,width:this.node.getWidth(),height:d.y-c.y}}if("northeast"===this.resizeDirection&&(this._transformPoint(o,r,e),l.x=this._endLogical.x,l.y=this._endLogical.y,r.x=(o.x+l.x)/2,r.y=(o.y+l.y)/2,this._reversPoint(o,r,e),this._reversPoint(l,r,e),this.resizingRect={x:o.x,y:l.y,width:l.x-o.x,height:o.y-l.y}),"west"===this.resizeDirection){var g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,r,e),f.x=g.x-r.x,this._transformPoint(u,r,e),this._transformPoint(f,r,e),r.x=(u.x+f.x)/2,r.y=(u.y+f.y)/2,this._reversPoint(u,r,e),this._reversPoint(f,r,e),this.resizingRect={x:r.x-(u.x-f.x)/2,y:r.y-this.node.getHeight()/2,width:u.x-f.x,height:this.node.getHeight()}}if("east"===this.resizeDirection){var g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,r,e),u.x=g.x-r.x,this._transformPoint(u,r,e),this._transformPoint(f,r,e),r.x=(u.x+f.x)/2,r.y=(u.y+f.y)/2,this._reversPoint(u,r,e),this._reversPoint(f,r,e),this.resizingRect={x:r.x-(u.x-f.x)/2,y:r.y-this.node.getHeight()/2,width:u.x-f.x,height:this.node.getHeight()}}if("southwest"===this.resizeDirection&&(this._transformPoint(l,r,e),o.x=this._endLogical.x,o.y=this._endLogical.y,r.x=(o.x+l.x)/2,r.y=(o.y+l.y)/2,this._reversPoint(o,r,e),this._reversPoint(l,r,e),this.resizingRect={x:o.x,y:l.y,width:l.x-o.x,height:o.y-l.y}),"south"===this.resizeDirection){var g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,r,e),d.y=g.y-r.y,this._transformPoint(c,r,e),this._transformPoint(d,r,e),r.x=(c.x+d.x)/2,r.y=(c.y+d.y)/2,this._reversPoint(c,r,e),this._reversPoint(d,r,e),this.resizingRect={x:r.x-this.node.getWidth()/2,y:r.y-(d.y-c.y)/2,width:this.node.getWidth(),height:d.y-c.y}}"southeast"===this.resizeDirection&&(this._transformPoint(a,r,e),h.x=this._endLogical.x,h.y=this._endLogical.y,r.x=(a.x+h.x)/2,r.y=(a.y+h.y)/2,this._reversPoint(a,r,e),this._reversPoint(h,r,e),this.resizingRect={x:a.x,y:a.y,width:h.x-a.x,height:h.y-a.y}),this.lazyMode?(this.repaint(),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:t,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:t,element:this.node,resizeDirection:this.resizeDirection}))},_isEditingShapeNode:function(t){var e=this.network.getEditPointSize();if(this.node instanceof De.ShapeNode){this.shapeNode=this.node;for(var i=this.shapeNode.getPoints(),n=0,s=i.size();s>n;n++){var r=i.get(n);if(this._contains(t,r,e))return this._setCrossCursor(),this.pointIndex=n,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(t){for(var e=this.network.getEditPointSize(),i=this.shapeLink.getPoints(),n=0,s=i.size();s>n;n++){var r=i.get(n);if(this._contains(t,r,e))return this._setCrossCursor(),this.pointIndex=n,!0}return this.pointIndex=-1,!1},_isResizingNode:function(t){var e=this.network.getResizePointSize();if(0>=e)return!1;var i=this.node.getOriginalRect(),n=this.node.getAngle(),s={x:i.x,y:i.y},r=this._rotatePoint(s,n,i);return!!this._isResizing(t,r.x,r.y,"northwest","nwse-resize")||(s={x:i.x+i.width/2,y:i.y},r=this._rotatePoint(s,n,i),!!this._isResizing(t,r.x,r.y,"north","ns-resize")||(s={x:i.x+i.width,y:i.y},r=this._rotatePoint(s,n,i),!!this._isResizing(t,r.x,r.y,"northeast","nesw-resize")||(s={x:i.x,y:i.y+i.height/2},r=this._rotatePoint(s,n,i),!!this._isResizing(t,r.x,r.y,"west","ew-resize")||(s={x:i.x+i.width,y:i.y+i.height/2},r=this._rotatePoint(s,n,i),!!this._isResizing(t,r.x,r.y,"east","ew-resize")||(s={x:i.x,y:i.y+i.height},r=this._rotatePoint(s,n,i),!!this._isResizing(t,r.x,r.y,"southwest","nesw-resize")||(s={x:i.x+i.width/2,y:i.y+i.height},r=this._rotatePoint(s,n,i),!!this._isResizing(t,r.x,r.y,"south","ns-resize")||(s={x:i.x+i.width,y:i.y+i.height},r=this._rotatePoint(s,n,i),!!this._isResizing(t,r.x,r.y,"southeast","nwse-resize"))))))))},_rotatePoint:function(t,e,i){var n=Ge.createMatrix(e*Math.PI/180,i.x+i.width/2,i.y+i.height/2),s=n.transform(t);return s},_isResizing:function(t,e,i,n,s){var r=this.network.getResizePointSize();return!!this._contains(t,{x:e,y:i},r)&&(this.resizeDirection!==n&&(this._removeCursor(),s=this._changeCursorWithAngle(n,this.node.getAngle()),this._setCursor(s),this.resizeDirection=n),!0)},_getRect:function(t,e,i,n){var s=i>t?t:i,r=n>e?e:n,a=Math.abs(t-i),o=Math.abs(e-n);return{x:s,y:r,width:a,height:o}},_contains:function(t,e,i){var n={x:e.x-i,y:e.y-i,width:2*i,height:2*i};return Ge.containsPoint(n,t)},getPointIndex:function(t,e,i){if(t.size()<2)return 0;for(var n,s=t.get(0),r=1;r<t.size();r++){if(n=t.get(r),this.isPointOnLine(e,s,n,6))return r;s=n}return s=t.get(0),i&&this.isPointOnLine(e,s,n,6)?t.size():0},showRotateScale:function(t){var e,i,n,s,r,a=(new De.List,this.network.getRotateScaleWidth()),o=this.network.getRotateScaleHeight(),h=this.network.getRotatePointSize(),l=this.node.getAngle(),c=this.node.getOriginalRect(),u={x:c.x+c.width/2,y:c.y-this.network.getRotatePointOffset()-h},d=this._rotatePoint(u,l,c),f="13px Arial",g=l+"";this.node.getAngle()>=0&&this.node.getAngle()<=180?(i={x:d.x+h,y:d.y},n={x:i.x+a,y:i.y},s={x:n.x,y:n.y-o},r={x:i.x,y:s.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(i={x:d.x-h,y:d.y},n={x:i.x-a,y:i.y},s={x:n.x,y:n.y-o},r={x:i.x,y:s.y});var _=new De.List([i,n,s,r]),e=Be.math.getRect(_);t.fillStyle=this.network.getRotateScaleFillColor(),t.fillRect(e.x,e.y,e.width,e.height),t.fillStyle=this.network.getRotateScaleFontColor(),t.textBaseline="middle",t.textAlign="center",t.font=f,t.fillText(g,e.x+e.width/2,e.y+e.height/2)},isPointOnLine:function(t,e,i,n){0>n&&(n=0);var s=this.getDistanceFromPointToLine(t,e,i);return n>=s&&t.x>=Math.min(e.x,i.x)-n&&t.x<=Math.max(e.x,i.x)+n&&t.y>=Math.min(e.y,i.y)-n&&t.y<=Math.max(e.y,i.y)+n},getDistanceFromPointToLine:function(t,e,i){if(e.x===i.x)return Math.abs(t.x-e.x);var n=(i.y-e.y)/(i.x-e.x),s=(i.x*e.y-e.x*i.y)/(i.x-e.x);return Math.abs(n*t.x-t.y+s)/Math.sqrt(n*n+1)},_transformPoint:function(t,e,i){var n=Math.cos(i*Math.PI/180),s=Math.sin(i*Math.PI/180),r=t.x,a=t.y,o=r*n-a*s,h=r*s+a*n;t.x=o+e.x,t.y=h+e.y},_reversPoint:function(t,e,i){i*=-1;var n=Math.cos(i*Math.PI/180),s=Math.sin(i*Math.PI/180),r=t.x-e.x,a=t.y-e.y,o=r*n-a*s,h=r*s+a*n;t.x=o+e.x,t.y=h+e.y},_changeCursorWithAngle:function(t,e){var i,n=["auto","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];switch(t){case"northwest":i=1;break;case"north":i=2;break;case"northeast":i=3;break;case"east":i=4;break;case"southeast":i=5;break;case"south":i=6;break;case"southwest":i=7;break;case"west":i=8;break;default:i=0}return(e>=360||-360>=e)&&(e%=360),e>22.5&&67.5>=e&&(i+=1),-22.5>e&&e>=-67.5&&(i-=1),e>67.5&&112.5>=e&&(i+=2),-67.5>e&&e>=-112.5&&(i-=2),e>112.5&&157.5>=e&&(i+=3),-112.5>e&&e>=-157.5&&(i-=3),e>157.5&&202.5>=e&&(i+=4),-157.5>e&&e>=-202.5&&(i-=4),e>202.5&&247.5>=e&&(i+=5),-202.5>e&&e>=-247.5&&(i-=5),e>247.5&&292.5>=e&&(i+=6),-247.5>e&&e>=-292.5&&(i-=6),e>292.5&&337.5>=e&&(i+=7),-292.5>e&&e>=-337.5&&(i-=7),i>8&&(i-=8),0>=i&&(i+=8),n[i]}}),De.canvas.interaction.CreateLinkInteraction=function(t,e){e||(e=De.Link),this.linkFunction=De.Util.isTypeOf(e,De.Link)?function(t,i){var n=new e;return n instanceof De.Link&&(n.setFromNode(t),n.setToNode(i)),n}:e,De.canvas.interaction.CreateLinkInteraction.superClass.constructor.call(this,t)},Be.ext("twaver.canvas.interaction.CreateLinkInteraction",De.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this)},paint:function(t){t.beginPath();var e,i;t.lineWidth=this.network.getEditLineWidth();var n=this.network.getEditLineColor();this.currentNode&&this.currentNode!==this.fromNode&&(e=this.network.getElementUI(this.currentNode).getViewRect(),i=this.convertFromUIToMarkerRect(e,0,0),Un.rect(t,i.x,i.y,i.width,i.height,null,n)),this.fromNode&&(e=this.network.getElementUI(this.fromNode).getViewRect(),i=this.convertFromUIToMarkerRect(e,0,0),Un.rect(t,i.x,i.y,i.width,i.height,null,n)),this.currentPoint&&this.paintLine(t),t.closePath()},paintLine:function(t){var e=this.network.getEditLineColor(),i=this.convertPointFromView(this.fromNode.getCenterLocation()),n=i.x,s=i.y,r=this.currentPoint.x,a=this.currentPoint.y;t.strokeStyle=e,t.beginPath(),t.moveTo(n,s),t.lineTo(r,a),t.stroke()},clear:function(){this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(t){if(this.network.isValidEvent(t))if(this.fromNode){if(this.toNode=this.currentNode,this.toNode){var e=this.createLink();e&&this.network.addElementByInteraction(e)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.repaint()},handle_mousemove:function(t){var e=this.getMarkerPoint(t);if(e){if(this.network.isMovingElement()||this.network.isEditingElement())return void this.clear();var i=null;this.fromNode?(this.currentNode=this.getToNode(t),this.currentPoint=e,this.repaint()):(i=this.getFromNode(t),this.currentNode!==i&&(this.currentNode=i,this.repaint()))}},getFromNode:function(t){return this.getNode(t)},getToNode:function(t){return this.getNode(t)},getNode:function(t){var e=this.network.getElementAt(t);return e instanceof On&&this.network.isLinkable(e)&&this.network.getElementBox().getSelectionModel().isSelectable(e)?e:null}}),De.canvas.interaction.CreateShapeLinkInteraction=function(t,e){De.canvas.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,t),e||(e=De.ShapeLink),this.linkFunction=De.Util.isTypeOf(e,De.ShapeLink)?function(t,i,n){var s=new e;return s instanceof De.ShapeLink&&(s.setFromNode(t),s.setToNode(i),n&&s.setPoints(n)),s}:e},Be.ext("twaver.canvas.interaction.CreateShapeLinkInteraction",De.canvas.interaction.CreateLinkInteraction,{clear:function(){this.points=null,De.canvas.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(t){if(0===t.button){var e=this.network.getLogicalPoint(t);if(e){if(this.fromNode)if(this.toNode=this.currentNode,this.toNode){var i=this.createLink();i&&this.network.addElementByInteraction(i),this.clear()}else{if(this.points||(this.points=new De.List),this.points.size()>0){var n=this.points.get(this.points.size()-1);if(n.x===e.x&&n.y===e.y)return}this.points.add(e)}else this.fromNode=this.currentNode,this.points=null,this.currentNode=null,this.currentPoint=null;this.repaint()}}},paintLine:function(t){if(this.currentPoint){var e,i=new De.List;if(e=this.convertPointFromView(this.fromNode.getCenterLocation()),i.add(e,0),this.points&&this.points.size()>0)for(var n=this.points.size(),s=0;n>s;s++)e=this.convertPointFromView(this.points.get(s)),i.add(e);e=this.currentPoint,i.add(e),t.lineWidth=this.network.getEditLineWidth(),t.strokeStyle=this.network.getEditLineColor(),t.beginPath(),qe.drawLinePoints(t,i),t.stroke()}}}),De.canvas.interaction.CreateShapeNodeInteraction=function(t,e){e||(e=De.ShapeNode),this.shapeNodeFunction=De.Util.isTypeOf(e,De.ShapeNode)?function(t){var i=new e;return i instanceof De.ShapeNode&&t&&i.setPoints(t),i}:e,De.canvas.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,t),this.timeStamp=-1},Be.ext("twaver.canvas.interaction.CreateShapeNodeInteraction",De.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this),this.network.setEditingElement(!1)},clear:function(){this.points=null,this.currentPoint=null},paint:function(t){if(this.points&&this.points.size()>0&&this.currentPoint){for(var e,i=new De.List,n=this.points.size(),s=0;n>s;s++)e=this.convertPointFromView(this.points.get(s)),i.add(e);e=this.convertPointFromView(this.currentPoint),i.add(e),t.lineWidth=this.network.getEditLineWidth(),t.strokeStyle=this.network.getEditLineColor(),t.beginPath(),qe.drawLinePoints(t,i),t.stroke()}},handle_mousedown:function(t){if(0===t.button){var e=this.network.getLogicalPoint(t);if(e){if(2===t.detail||t.timeStamp-this.timeStamp<300){if(this.points){var i=this.shapeNodeFunction(this.points);
this.network.addElementByInteraction(i),this.clear();var n=this;setTimeout(function(){n.network.setEditingElement(!1)},0)}}else{if(this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new De.List),this.points.size()>0){var s=this.points.get(this.points.size()-1);if(s.x===e.x&&s.y===e.y)return}this.points.add(e)}this.timeStamp=t.timeStamp,this.repaint()}}},handle_mousemove:function(t){this.points&&(this.currentPoint=this.network.getLogicalPoint(t),this.repaint())}}),De.canvas.interaction.MagnifyInteraction=function(t,e,i,n,s){De.canvas.interaction.MagnifyInteraction.superClass.constructor.call(this,t),this.zoom=e||2,this.xRadius=i||100,this.yRadius=n||100,this.shape=s||"circle",this.borderColor="black",this.borderWidth=1,this.backgroundColor="white",this.markCanvas=je.createCanvas()},Be.ext("twaver.canvas.interaction.MagnifyInteraction",De.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousemove"),this.network.removeMarker(this)},paint:function(t){if(this.point){var e=this.network._zoom,i=this.zoom*e,n=this.point.x*e-this.network.viewRect.x-this.xRadius,s=this.point.y*e-this.network.viewRect.y-this.yRadius,r=2*this.xRadius,a=2*this.yRadius,o={x:this.point.x-this.xRadius/i,y:this.point.y-this.yRadius/i,width:r/i,height:a/i},h=this.borderWidth,l=je.createCanvas();l.width=r,l.height=a,this.network.toCanvasByRegion(o,i,l),t.save(),t.beginPath(),qe.drawVector(t,this.shape,null,n,s,r,a),t.clip(),t.fillStyle=this.backgroundColor,t.beginPath(),t.rect(n,s,r,a),t.fill(),t.drawImage(l,n,s),t.restore(),t.beginPath(),t.lineWidth=h,qe.drawVector(t,this.shape,null,n+h/2,s+h/2,r-h,a-h),t.strokeStyle=this.borderColor,t.stroke()}},handle_mousemove:function(t){this.point=this.network.getLogicalPoint(t),this.point&&this.repaint()},getZoom:function(){return this.zoom},setZoom:function(t){this.zoom=t,this.network.repaintTopCanvas()},getShape:function(){return this.shape},setShape:function(t){this.shape=t,this.network.repaintTopCanvas()},getXRadius:function(){return this.xRadius},setXRadius:function(t){this.xRadius=t,this.network.repaintTopCanvas()},getYRadius:function(){return this.yRadius},setYRadius:function(t){this.yRadius=t,this.network.repaintTopCanvas()},getBorderColor:function(){return this.borderColor},setBorderColor:function(t){this.borderColor=t,this.network.repaintTopCanvas()},getBorderWidth:function(){return this.borderWidth},setBorderWidth:function(t){this.borderWidth=t,this.network.repaintTopCanvas()},getBackgroundColor:function(){return this.backgroundColor},setBackgroundColor:function(t){this.backgroundColor=t,this.network.repaintTopCanvas()}}),De.canvas.interaction.TouchInteraction=function(t){De.canvas.interaction.TouchInteraction.superClass.constructor.call(this,t)},Be.ext("twaver.canvas.interaction.TouchInteraction",De.canvas.interaction.BaseInteraction,{setUp:function(){var t=this.network.getView();je.addEventListener("touchstart","handleTouchstart",t,this),je.addEventListener("touchmove","handleTouchmove",t,this),je.addEventListener("touchend","handleTouchend",t,this),je.addEventListener("touchcancel","handleTouchend",t,this),this.network.addMarker(this)},tearDown:function(){var t=this.network.getView();je.removeEventListener("touchstart",this.network.getView(),this),je.removeEventListener("touchmove",t,this),je.removeEventListener("touchend",t,this),je.removeEventListener("touchcancel",t,this),this.network.removeMarker(this)},handleTouchstart:function(t){if(je.preventDefault(t),t.touches&&1==t.touches.length){var e=this.network.getLogicalPoint(t),i=this.network.getElementAt(e);this._startTouchTime=new Date,this._startTouchPoint=e,this._startTouchClient=this.getMarkerPoint(t),i?(this._haveElementUnderTouch=!0,this._startTouchElement=i):(this._haveElementUnderTouch=!1,this._startTouchElement=null),this.timer=setTimeout(function(){Li.handleLongClicked(self.network,t,i)},1e3)}else t.touches&&2==t.touches.length&&(this._distance=Ci.getDistance(t),this._zoom=this.network.getZoom());this._touchCount=t.touches.length},handleTouchmove:function(t){if(je.preventDefault(t),2==this._touchCount&&t.touches&&2==t.touches.length)if(this.timer&&clearTimeout(this.timer),Math.abs(this._distance-Ci.getDistance(t))>=kn.TOUCH_ZOOM_THRESHOLD||this._zoomFlag){this._zoomFlag=!0;var e=Ci.getDistance(t)/this._distance;this.network.setTouchZoom(this._zoom*e,!1)}else{var i=this.getMarkerPoint(t),n=this._startTouchClient.x-i.x,s=this._startTouchClient.y-i.y;this.network.panByOffset(n,s),this._startTouchClient=i}else if(1==this._touchCount&&t.touches&&1==t.touches.length)if(this._haveElementUnderTouch||!this.network.isRectSelectEnabled()){var r=this.network.getLogicalPoint(t),a=this.network.getElementAt(r);if(this.network.isMovingElement()||null!=this._startTouchElement&&this._startTouchElement==a&&this.network.getMovableSelectedElements().contains(a)){var n=r.x-this._startTouchPoint.x,s=r.y-this._startTouchPoint.y;(Math.abs(n)>=kn.TOUCH_MOVE_THRESHOLD||Math.abs(s)>=kn.TOUCH_MOVE_THRESHOLD)&&(this._startTouchPoint=r,this.network.moveSelectedElements(n,s),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:t}),this.timer&&clearTimeout(this.timer)))}else{var n=r.x-this._startTouchPoint.x,s=r.y-this._startTouchPoint.y;(Math.abs(n)>=kn.TOUCH_MOVE_THRESHOLD||Math.abs(s)>=kn.TOUCH_MOVE_THRESHOLD)&&this.timer&&clearTimeout(this.timer);var i=this.getMarkerPoint(t),n=this._startTouchClient.x-i.x,s=this._startTouchClient.y-i.y;this.network.panByOffset(n,s),this._startTouchClient=i}}else{var o=this.network.getLogicalPoint(t);if(!o)return;var n=o.x-this._startTouchPoint.x,s=o.y-this._startTouchPoint.y;Math.abs(n)>=kn.TOUCH_RECT_SELECT_THRESHOLD&&Math.abs(s)>=kn.TOUCH_RECT_SELECT_THRESHOLD&&(this.network.setSelectingElement(!0),this._moveTouchPoint?this.network.fireInteractionEvent({kind:"selectBetween",event:t}):(this.network.fireInteractionEvent({kind:"selectStart",event:t}),this.timer&&clearTimeout(this.timer)),this._moveTouchPoint=o,this.repaint())}},handleTouchend:function(t){if(je.preventDefault(t),this.network.isMovingElement())this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:t});else if(this.network.isSelectingElement()){var e=Ge.getRect([this._startTouchPoint,this._moveTouchPoint]),i=this.network.getElementsAtRect(e,this.getIntersectMode(),this.network.getRectSelectFilter());if(i&&i.size()>0){var n=this.network.getSelectionModel(),s=n.toSelection();i.forEach(function(t){n.contains(t)?s.remove(t):s.add(t)},this),n.setSelection(s)}this.network.fireInteractionEvent({kind:"selectEnd",event:t}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}else if(this._startTouchPoint){this._zoomFlag=!1;var r=new Date,a=this.network.getLogicalPoint(t),o=this.network.getElementAt(this._startTouchPoint);a&&r.getTime()-this._startTouchTime.getTime()<=500&&Ge.getDistance(this._startTouchPoint,a)<=20&&(o?this.network.getSelectionModel().contains(o)||this.network.getSelectionModel().setSelection(o):this.network.getSelectionModel().clearSelection(),Li.handleClicked(this.network,t,o),this.timer&&clearTimeout(this.timer),this._endTouchTime&&r.getTime()-this._endTouchTime.getTime()<=500&&Ge.getDistance(this._endTouchPoint,a)<=20?(delete this._endTouchTime,delete this._endTouchPoint,Li.handleDoubleClicked(this.network,t,o)):(this._endTouchTime=r,this._endTouchPoint=a))}},paint:function(t){if(this._startTouchPoint&&this._moveTouchPoint){var e=this.convertPointFromView(this._startTouchPoint),i=this.convertPointFromView(this._moveTouchPoint),n=e.x,s=e.y,r=i.x,a=i.y,o=Ge.getRect([{x:n,y:s},{x:r,y:a}]);if(null!=o){t.beginPath();var h=this.network.getSelectOutlineWidth(),l=this.getIntersectMode()?this.network.getSelectFillColor():null;t.strokeStyle=this.network.getSelectOutlineColor(),t.lineWidth=h,Un.rect(t,o.x,o.y,o.width,o.height,l,this.network.getSelectOutlineColor()),t.closePath()}}},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()||"contain"!==this.network.getSelectMode()&&(this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y)}}),De.canvas.interaction.MSTouchInteraction=function(t){De.canvas.interaction.MSTouchInteraction.superClass.constructor.call(this,t),this._pointerMap={},this._pointerIdArray=[]},Be.ext("twaver.canvas.interaction.MSTouchInteraction",De.canvas.interaction.BaseInteraction,{setUp:function(){var t=this.network.getView();je.addEventListener("MSPointerDown","handleTouchstart",t,this),je.addEventListener("MSPointerMove","handleTouchmove",t,this),je.addEventListener("MSPointerUp","handleTouchend",t,this),je.addEventListener("MSPointerCancel","handleTouchend",t,this),this.network.addMarker(this)},tearDown:function(){var t=this.network.getView();je.removeEventListener("MSPointerDown",t,this),je.removeEventListener("MSPointerMove",t,this),je.removeEventListener("MSPointerUp",t,this),je.removeEventListener("MSPointerCancel",t,this),this.network.removeMarker(this)},handleTouchstart:function(t){if(this.network.isFocusOnClick()&&De.Util.setFocus(this.network._view),!this.network.isSelectingElement()||t.pointerType!=t.MSPOINTER_TYPE_MOUSE){var e=this.network.getLogicalPoint(t),i=new Date;if(t.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(t),this._pointerMap[t.pointerId]||(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t),1==this._pointerIdArray.length){var n=this.network.getElementAt(e);this._startTouchElement=n,this._startClientPoint={x:t.clientX,y:t.clientY},Li.handleClicked(this.network,t,n),this._startTouchTime&&this._startTouchPoint&&i.getTime()-this._startTouchTime.getTime()<=500&&Ge.getDistance(this._startTouchPoint,e)<=20?(Li.handleDoubleClicked(this.network,t,n),this._doubleClick=!0):(je.handle_mousedown(this,t),this._startTouchPoint=e,this._startTouchTime=i);var s=this.network.getSelectionModel();n?Be.isCtrlDown(t)?s.contains(n)?s.removeSelection(n):s.appendSelection(n):s.contains(n)||s.setSelection(n):Be.isCtrlDown(t)||s.clearSelection()}else 2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())}},handleTouchmove:function(t){if(null!=this._startTouchPoint&&0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(Ge.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=10)&&(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length)){var e=this._getDistance()/this._distance;this.network.setZoom(this._zoom*e,!1)}},handleTouchend:function(t){if(this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:t})),this.network.isSelectingElement()){var e=Ge.getRect([this._startTouchPoint,this._moveTouchPoint]),i=this.network.getElementsAtRect(e,this.getIntersectMode(),this.network.getRectSelectFilter());if(i&&i.size()>0){var n=this.network.getSelectionModel(),s=n.toSelection();i.forEach(function(t){n.contains(t)?s.remove(t):s.add(t)},this),n.setSelection(s)}this.network.fireInteractionEvent({kind:"selectEnd",event:t}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);for(var r=-1,a=0;a<this._pointerIdArray.length;a++)if(this._pointerIdArray[a]==t.pointerId){r=a;break}r>=0&&this._pointerIdArray.splice(r,1),delete this._pointerMap[t.pointerId],this._startTouchPoint=null,this._moveTouchPoint=null},_getDistance:function(){return Ge.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()||"contain"!==this.network.getSelectMode()&&(this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y)},handle_mousemove:function(t){var e={x:t.clientX,y:t.clientY};if(!(Ge.getDistance(this._startClientPoint,e)<3)&&this._startTouchPoint&&1==this._pointerIdArray.length)if(this._moveTouchPoint={x:this._startTouchPoint.x+(e.x-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(e.y-this._startClientPoint.y)/this.network.getZoom()},null==this._startTouchElement&&this.network.isRectSelectEnabled()){var i=this.network.getLogicalPoint(t);if(!i)return;this.network.setSelectingElement(!0),this.network.fireInteractionEvent(this._moveTouchPoint?{kind:"selectBetween",event:t}:{kind:"selectStart",event:t}),this.repaint()}else{var n=this.network.getElementAt(this._moveTouchPoint);if(null!=this._startTouchElement||this.network.isRectSelectEnabled()){if(this.network.isMovingElement()||null!=this._startTouchElement&&n==this._startTouchElement&&this.network.getMovableSelectedElements().contains(n)){var s=this._moveTouchPoint.x-this._startTouchPoint.x,r=this._moveTouchPoint.y-this._startTouchPoint.y;this.network.moveSelectedElements(s,r),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:t}))}}else{var s=this._startClientPoint.x-e.x,r=this._startClientPoint.y-e.y;this.network.panByOffset(s,r)}this._startClientPoint=e}},handle_mouseup:function(t){this.handleTouchend(t),this._pointerIdArray=[],this._pointerMap={}},paint:function(t){if(this._startTouchPoint&&this._moveTouchPoint&&!this._startTouchElement&&this.network.isRectSelectEnabled()){var e=this.convertPointFromView(this._startTouchPoint),i=this.convertPointFromView(this._moveTouchPoint),n=e.x,s=e.y,r=i.x,a=i.y,o=Ge.getRect([{x:n,y:s},{x:r,y:a}]);if(null!=o){t.beginPath();var h=this.network.getSelectOutlineWidth(),l=this.getIntersectMode()?this.network.getSelectFillColor():null;t.strokeStyle=this.network.getSelectOutlineColor(),t.lineWidth=h,Un.rect(t,o.x,o.y,o.width,o.height,l,this.network.getSelectOutlineColor()),t.closePath()}}}});var Hn=function(t,e){Be.registerImage(t,e),Wn[t]=1},Wn={};Hn("node_image",{w:32,h:24,origin:{x:0,y:0},v:[{shape:"path",data:"M32,23.5c0,0.276-0.224,0.5-0.5,0.5h-31C0.224,24,0,23.776,0,23.5v-2C0,21.224,0.224,21,0.5,21h31  c0.276,0,0.5,0.224,0.5,0.5V23.5z",gradient:{id:"SVGID_1_",type:"linear",x1:"15.9995",y1:"21",x2:"15.9995",y2:"24",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M15,22.3c0-0.165-0.134-0.3-0.3-0.3H3.3C3.134,22,3,22.135,3,22.3V24h12V22.3z",gradient:{id:"SVGID_2_",type:"linear",x1:"9",y1:"22",x2:"9",y2:"25",stop:[{offset:"0",color:"#69B4A5"},{offset:"0.1",color:"#61AD9C"}]}},{shape:"path",data:"M31,20H1V1c0-0.553,0.448-1,1-1h28c0.553,0,1,0.447,1,1V20z",gradient:{id:"SVGID_3_",type:"linear",x1:"15.9995",y1:"-0.1221",x2:"15.9995",y2:"19.9471",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:1,w:28,h:18,fill:"#FFFFFF"},{shape:"rect",x:3,y:2,w:26,h:16,gradient:{id:"SVGID_4_",type:"linear",x1:"15.9995",y1:"2.0654",x2:"15.9995",y2:"17.3835",stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#0089C1"}]}},{shape:"path",data:"9.649,17.034 6.815,17.034 9.935,2.966 12.768,2.966 z",fill:"#FFFFFF"},{shape:"path",data:"12.065,17.034 10.815,17.034 13.935,2.966 15.185,2.966 z",fill:"#FFFFFF"},{shape:"path",data:"14.065,17.034 13.315,17.034 16.435,2.966 17.185,2.966 z",fill:"#FFFFFF"}]}),Hn("group_image",{w:32,h:24,origin:{x:0,y:0},v:[{shape:"path",data:"M32,16.5c0,0.276-0.224,0.5-0.5,0.5h-24C7.224,17,7,16.776,7,16.5v-1C7,15.224,7.224,15,7.5,15h24   c0.276,0,0.5,0.224,0.5,0.5V16.5z",gradient:{id:"SVGID_1_",type:"linear",x1:"19.5",y1:"15",x2:"19.5",y2:"17",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M19,16.5c0-0.277-0.224-0.5-0.5-0.5h-8c-0.276,0-0.5,0.223-0.5,0.5V17h9V16.5z",gradient:{id:"SVGID_2_",type:"linear",x1:"14.4995",y1:"15.9209",x2:"14.4995",y2:"17.0459",stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M31,14H8V1c0-0.553,0.448-1,1-1h21c0.553,0,1,0.447,1,1V14z",gradient:{id:"SVGID_3_",type:"linear",x1:"19.5",y1:"0",x2:"19.5",y2:"14.0005",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:9,y:1,w:21,h:12,fill:"#FFFFFF"},{shape:"rect",x:10,y:2,w:19,h:10,gradient:{id:"SVGID_4_",type:"linear",x1:"19.5",y1:"1.9619",x2:"19.5",y2:"11.9744",stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M25,23.5c0,0.276-0.224,0.5-0.5,0.5h-24C0.224,24,0,23.776,0,23.5v-1C0,22.224,0.224,22,0.5,22h24   c0.276,0,0.5,0.224,0.5,0.5V23.5z",gradient:{id:"SVGID_5_",type:"linear",x1:"12.4995",y1:"22",x2:"12.4995",y2:"24",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M12,23.5c0-0.277-0.224-0.5-0.5-0.5h-8C3.224,23,3,23.223,3,23.5V24h9V23.5z",gradient:{id:"SVGID_6_",type:"linear",x1:"7.5",y1:"22.9209",x2:"7.5",y2:"24.0459",stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M24,21H1V8c0-0.553,0.448-1,1-1h21c0.553,0,1,0.447,1,1V21z",gradient:{id:"SVGID_7_",type:"linear",x1:"12.4995",y1:"7",x2:"12.4995",y2:"21.0005",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:8,w:21,h:12,fill:"#FFFFFF"},{shape:"rect",x:3,y:9,w:19,h:10,gradient:{id:"SVGID_8_",type:"linear",x1:"12.4995",y1:"8.9619",x2:"12.4995",y2:"18.9749",stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#0089C1"}]}}]}),Hn("subnetwork_image",{w:32,h:24,origin:{x:0,y:0},v:[{shape:"path",data:"M32,14.499c0,0.276-0.224,0.5-0.5,0.5h-20c-0.276,0-0.5-0.224-0.5-0.5v-1c0-0.276,0.224-0.5,0.5-0.5  h20c0.276,0,0.5,0.224,0.5,0.5V14.499z",gradient:{id:"SVGID_1_",type:"linear",x1:21.5,y1:12.999,x2:21.5,y2:14.9995,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M22,14.499c0-0.277-0.224-0.5-0.5-0.5h-7c-0.276,0-0.5,0.223-0.5,0.5v0.5h8V14.499z",gradient:{id:"SVGID_2_",type:"linear",x1:18,y1:13.9199,x2:18,y2:15.0449,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M31,11.499c0,0.276-0.224,0.5-0.5,0.5h-18c-0.276,0-0.5-0.224-0.5-0.5v-11c0-0.276,0.224-0.5,0.5-0.5  h18c0.276,0,0.5,0.224,0.5,0.5V11.499z",gradient:{id:"SVGID_3_",type:"linear",x1:21.5,y1:-.9502,x2:21.5,y2:12.5498,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:13,y:.999,w:17,h:10,fill:"#FFFFFF"},{shape:"rect",x:14,y:1.999,w:15,h:8,gradient:{id:"SVGID_4_",type:"linear",x1:21.5,y1:1.9312,x2:21.5,y2:9.6537,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M21,23.5c0,0.276-0.224,0.5-0.5,0.5h-20C0.224,24,0,23.776,0,23.5v-1C0,22.224,0.224,22,0.5,22h20  c0.276,0,0.5,0.224,0.5,0.5V23.5z",gradient:{id:"SVGID_5_",type:"linear",x1:10.4995,y1:22,x2:10.4995,y2:24,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:22,y:20.5,w:3,h:1.999,gradient:{id:"SVGID_6_",type:"linear",x1:-464.9424,y1:-722.2754,x2:-462.9424,y2:-722.2754,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"rect",x:28,y:16,w:2,h:3,gradient:{id:"SVGID_7_",type:"linear",x1:29,y1:16,x2:29,y2:19,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M11,23.5c0-0.277-0.224-0.5-0.5-0.5h-7C3.224,23,3,23.223,3,23.5V24h8V23.5z",gradient:{id:"SVGID_8_",type:"linear",x1:7,y1:22.9209,x2:7,y2:24.0459,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M20,20.5c0,0.276-0.224,0.5-0.5,0.5h-18C1.224,21,1,20.776,1,20.5v-11C1,9.224,1.224,9,1.5,9h18  C19.776,9,20,9.224,20,9.5V20.5z",gradient:{id:"SVGID_9_",type:"linear",x1:10.4995,y1:8.0508,x2:10.4995,y2:21.5513,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:10,w:17,h:10,fill:"#FFFFFF"},{shape:"rect",x:3,y:11,w:15,h:8,gradient:{id:"SVGID_10_",type:"linear",x1:10.4995,y1:10.9321,x2:10.4995,y2:18.6551,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#0089C1"}]}},{shape:"path",data:"M32,22.7c0,0.165-0.135,0.3-0.301,0.3h-5.4C26.134,23,26,22.865,26,22.7v-2.4  c0-0.165,0.134-0.3,0.299-0.3h5.4C31.865,20,32,20.135,32,20.3V22.7z",gradient:{id:"SVGID_11_",type:"linear",x1:29,y1:20,x2:29,y2:23,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}}]}),Hn("bus_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"rect",x:4,y:6,w:1,h:1,fill:"#232424"},{shape:"path",data:"M7,4c0,0.552-0.448,1-1,1H3C2.448,5,2,4.552,2,4V3c0-0.552,0.448-1,1-1h3c0.552,0,1,0.448,1,1V4z",gradient:{id:"SVGID_1_",type:"linear",x1:4.5,y1:2,x2:4.5,y2:5,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:3,y:3,w:3,h:1,fill:"#232424"},{shape:"rect",x:3,y:3,w:3,h:1,fill:"#FFFFFF"},{shape:"path",data:"M6,5.5C6,5.776,5.776,6,5.5,6h-2C3.224,6,3,5.776,3,5.5l0,0C3,5.224,3.224,5,3.5,5h2  C5.776,5,6,5.224,6,5.5L6,5.5z",gradient:{id:"SVGID_2_",type:"linear",x1:4.5,y1:6,x2:4.5,y2:5,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:12,y:6,w:1,h:1,fill:"#232424"},{shape:"path",data:"M15,4c0,0.552-0.447,1-1,1h-3c-0.553,0-1-0.448-1-1V3c0-0.552,0.447-1,1-1h3c0.553,0,1,0.448,1,1V4z",gradient:{id:"SVGID_3_",type:"linear",x1:12.5,y1:2,x2:12.5,y2:5,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:11,y:3,w:3,h:1,fill:"#232424"},{shape:"rect",x:11,y:3,w:3,h:1,fill:"#FFFFFF"},{shape:"path",data:"M14,5.5C14,5.776,13.777,6,13.5,6h-2C11.225,6,11,5.776,11,5.5l0,0C11,5.224,11.225,5,11.5,5h2  C13.777,5,14,5.224,14,5.5L14,5.5z",gradient:{id:"SVGID_4_",type:"linear",x1:12.5,y1:6,x2:12.5,y2:5,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:8,y:10,w:1,h:1,fill:"#232424"},{shape:"path",data:"M6,13c0-0.553,0.448-1,1-1h3c0.553,0,1,0.447,1,1v1c0,0.553-0.447,1-1,1H7c-0.552,0-1-0.447-1-1V13z",gradient:{id:"SVGID_5_",type:"linear",x1:-1428.3853,y1:-571.5747,x2:-1428.3853,y2:-568.5747,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:7,y:13,w:3,h:1,fill:"#232424"},{shape:"rect",x:7,y:13,w:3,h:1,fill:"#FFFFFF"},{shape:"path",data:"M7,11.5C7,11.223,7.224,11,7.5,11h2c0.277,0,0.5,0.223,0.5,0.5l0,0c0,0.275-0.223,0.5-0.5,0.5h-2  C7.224,12,7,11.775,7,11.5L7,11.5z",gradient:{id:"SVGID_6_",type:"linear",x1:-1428.3862,y1:-567.5737,x2:-1428.3862,y2:-568.5737,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M15,7.5C15,7.776,14.777,8,14.5,8h-12C2.224,8,2,7.776,2,7.5l0,0C2,7.224,2.224,7,2.5,7h12  C14.777,7,15,7.224,15,7.5L15,7.5z",gradient:{id:"SVGID_7_",type:"linear",x1:8.4995,y1:6.1152,x2:8.4995,y2:7.5558,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M15,9.5c0,0.275-0.223,0.5-0.5,0.5h-12C2.224,10,2,9.775,2,9.5l0,0C2,9.223,2.224,9,2.5,9h12  C14.777,9,15,9.223,15,9.5L15,9.5z",gradient:{id:"SVGID_8_",type:"linear",x1:8.4995,y1:8.1147,x2:8.4995,y2:9.556,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}}]}),Hn("data_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,12c0,0.553-0.447,1-1,1H7c-0.552,0-1-0.447-1-1V8c0-0.552,0.448-1,1-1h7c0.553,0,1,0.448,1,1V12   z",gradient:{id:"SVGID_1_",type:"linear",x1:10.5,y1:6.959,x2:10.5,y2:12.2259,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:7,y:8,w:7,h:4,fill:"#FFFFFF"},{shape:"rect",x:8,y:9,w:5,h:2,gradient:{id:"SVGID_2_",type:"linear",x1:10.5,y1:8.6997,x2:10.5,y2:11.0333,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M15,14.5c0,0.275-0.225,0.5-0.5,0.5h-8C6.224,15,6,14.775,6,14.5l0,0C6,14.223,6.224,14,6.5,14h8   C14.775,14,15,14.223,15,14.5L15,14.5z",gradient:{id:"SVGID_3_",type:"linear",x1:10.5,y1:13.125,x2:10.5,y2:14.5518,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:8,y:14,w:1,h:1,gradient:{id:"SVGID_4_",type:"linear",x1:8.4995,y1:14.0049,x2:8.4995,y2:14.9471,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M12,4H6c0,0-0.152-0.275-0.5-1C5.021,2,5.021,2,4,2C3.057,2,2,2,2,2C1.448,2,1,2.448,1,3v8  c0,0.553,0.448,1,1,1h3v-1H2V3h2.387l1.024,1.998L12,5v1h1V5C13,4.448,12.553,4,12,4z",gradient:{id:"SVGID_5_",type:"linear",x1:6.9995,y1:2.0527,x2:6.9995,y2:11.4757,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M12,5L5.411,4.998L4.387,3H2v8h3v-0.645V7.254V7c0-0.552,0.448-1,1-1h0.324h3.032H12V5z",gradient:{id:"SVGID_6_",type:"linear",x1:6.9995,y1:2.9902,x2:6.9995,y2:11.0032,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}}]}),Hn("grid_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,14c0,0.553-0.447,1-1,1H3c-0.552,0-1-0.447-1-1V3c0-0.552,0.448-1,1-1h11c0.553,0,1,0.448,1,1V14  z",gradient:{id:"SVGID_1_",type:"linear",x1:8.4995,y1:2.1255,x2:8.4995,y2:14.909,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:3,y:3,w:11,h:11,fill:"#FFFFFF"},{shape:"rect",x:3,y:5,w:11,h:1,gradient:{id:"SVGID_2_",type:"linear",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8043,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:3,y:8,w:11,h:1,gradient:{id:"SVGID_3_",type:"linear",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8043,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:3,y:11,w:11,h:1,gradient:{id:"SVGID_4_",type:"linear",x1:8.4995,y1:3.2095,x2:8.4995,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:11,y:3,w:1,h:11,gradient:{id:"SVGID_5_",type:"linear",x1:11.5,y1:3.209,x2:11.5,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:8,y:3,w:1,h:11,gradient:{id:"SVGID_6_",type:"linear",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:5,y:3,w:1,h:11,gradient:{id:"SVGID_7_",type:"linear",x1:5.5,y1:3.209,x2:5.5,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}}]}),Hn("databox_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M14.5,6h-12H2v0.5v7C2,13.776,2.224,14,2.5,14h12c0.276,0,0.5-0.224,0.5-0.5v-7V6H14.5z",gradient:{id:"SVGID_1_",type:"linear",x1:8.4995,y1:6.0625,x2:8.4995,y2:14.063,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M14.776,5.553l-1.553-3.105C13.101,2.201,12.775,2,12.5,2h-8C4.225,2,3.899,2.201,3.776,2.447  L2.224,5.553L2,6h0.5h12H15L14.776,5.553z",gradient:{id:"SVGID_2_",type:"linear",x1:8.5005,y1:3.104,x2:8.5005,y2:-5.6467,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"12,2 9.5,2 7.5,2 5,2 3,6 7.5,6 9.5,6 14,6 z",gradient:{id:"SVGID_3_",type:"linear",x1:8.5005,y1:9.2295,x2:8.5005,y2:5.4586,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M11.5,9c0,0.276-0.224,0.5-0.5,0.5H6C5.724,9.5,5.5,9.276,5.5,9l0,0c0-0.276,0.224-0.5,0.5-0.5h5  C11.276,8.5,11.5,8.724,11.5,9L11.5,9z",fill:"#FFFFFF"}]}),Hn("group_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,8.5C15,8.776,14.776,9,14.5,9h-10C4.224,9,4,8.776,4,8.5v-7C4,1.224,4.224,1,4.5,1h10    C14.776,1,15,1.224,15,1.5V8.5z",gradient:{id:"SVGID_1_",type:"linear",x1:9.5,y1:.9512,x2:9.5,y2:8.9787,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:5,y:2,w:9,h:6,fill:"#FFFFFF"},{shape:"rect",x:6,y:3,w:7,h:4,gradient:{id:"SVGID_2_",type:"linear",x1:9.5,y1:3.02,x2:9.5,y2:6.9606,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M16,10.5c0,0.276-0.224,0.5-0.5,0.5h-12C3.224,11,3,10.776,3,10.5l0,0C3,10.224,3.224,10,3.5,10h12    C15.776,10,16,10.224,16,10.5L16,10.5z",gradient:{id:"SVGID_3_",type:"linear",x1:9.5,y1:9.9941,x2:9.5,y2:10.9976,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:6,y:10.001,w:2,h:.999,gradient:{id:"SVGID_4_",type:"linear",x1:7,y1:10.0059,x2:7,y2:10.9472,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M12,12.5c0,0.276-0.224,0.5-0.5,0.5h-10C1.224,13,1,12.776,1,12.5v-7C1,5.224,1.224,5,1.5,5h10    C11.776,5,12,5.224,12,5.5V12.5z",gradient:{id:"SVGID_5_",type:"linear",x1:6.4995,y1:4.9512,x2:6.4995,y2:12.9792,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:6,w:9,h:6,fill:"#FFFFFF"},{shape:"rect",x:3,y:7,w:7,h:4,gradient:{id:"SVGID_6_",type:"linear",x1:6.4995,y1:7.02,x2:6.4995,y2:10.9611,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M13,14.5c0,0.276-0.224,0.5-0.5,0.5h-12C0.224,15,0,14.776,0,14.5l0,0C0,14.224,0.224,14,0.5,14h12    C12.776,14,13,14.224,13,14.5L13,14.5z",gradient:{id:"SVGID_7_",type:"linear",x1:6.4995,y1:13.9941,x2:6.4995,y2:14.9976,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:3,y:14.001,w:2,h:.999,gradient:{id:"SVGID_8_",type:"linear",x1:4,y1:14.0059,x2:4,y2:14.9472,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}}]}),Hn("link_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"line",p1:{x:2.5,y:2.5},p2:{x:13.5,y:13.5},lineColor:"url(#SVGID_1_)",lineWidth:1},{shape:"ellipse",cx:13,cy:13,rx:2,ry:2,gradient:{id:"SVGID_2_",type:"linear",x1:11.5371,y1:11.5371,x2:14.2155,y2:14.2155,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:13,cy:13,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:3,cy:3,rx:2,ry:2,gradient:{id:"SVGID_3_",type:"linear",x1:1.4956,y1:1.4956,x2:4.1473,y2:4.1473,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:3,cy:3,rx:1,ry:1,fill:"#FFFFFF"}]}),Hn("linksubnetwork_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,7.661c0-1.202-0.642-2.247-1.596-2.835C12.848,3.188,11.314,2,9.486,2  c-1.587,0-2.95,0.902-3.649,2.211C4.573,4.22,3.548,5.194,3.438,6.432C3.389,6.429,3.342,6.417,3.292,6.417  C2.026,6.417,1,7.443,1,8.708C1,9.975,2.026,11,3.292,11h8.371l0,0C13.506,11,15,9.506,15,7.661z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:1.959,x2:7.9995,y2:11.0921,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M3.292,10C2.58,10,2,9.42,2,8.708c0-0.712,0.58-1.292,1.292-1.292C3.286,7.422,3.332,7.427,3.379,7.43  l0.969,0.058L4.435,6.52C4.5,5.779,5.106,5.216,5.844,5.211l0.595-0.004l0.28-0.524C7.273,3.645,8.334,3,9.486,3  c1.342,0,2.535,0.863,2.971,2.147l0.116,0.341l0.307,0.189C13.581,6.11,14,6.851,14,7.661C14,8.951,12.951,10,11.661,10H3.292z",fill:"#FFFFFF"},{shape:"path",data:"M3.292,10h8.37c1.11,0,2.04-0.781,2.276-1.821c-0.131-0.615-0.5-1.158-1.058-1.501l-0.307-0.189  l-0.116-0.341C12.021,4.863,10.828,4,9.486,4C8.334,4,7.273,4.645,6.719,5.682l-0.28,0.524L5.844,6.211  C5.106,6.216,4.5,6.779,4.435,7.52L4.349,8.487L3.379,8.43C3.332,8.427,3.286,8.422,3.292,8.417c-0.535,0-0.994,0.328-1.19,0.792  C2.297,9.672,2.757,10,3.292,10z",gradient:{id:"SVGID_2_",type:"linear",x1:8.019,y1:4.084,x2:8.019,y2:9.8062,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"line",p1:{x:8.01,y:8.01},p2:{x:13.186,y:13.186},lineColor:"url(#SVGID_3_)",lineWidth:1},{shape:"ellipse",cx:8,cy:8,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:6.7881,y1:6.7881,x2:9.9924,y2:9.9924,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:8,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:13,cy:13,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:11.5791,y1:11.5791,x2:14.3132,y2:14.3132,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:13,cy:13,rx:1,ry:1,fill:"#FFFFFF"}]}),Hn("node_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,11.5c0,0.276-0.224,0.5-0.5,0.5h-13C1.224,12,1,11.776,1,11.5v-9C1,2.224,1.224,2,1.5,2h13  C14.776,2,15,2.224,15,2.5V11.5z",gradient:{id:"SVGID_1_",
type:"linear",x1:7.9995,y1:1.939,x2:7.9995,y2:11.9739,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:3,w:12,h:8,fill:"#FFFFFF"},{shape:"rect",x:3,y:4,w:10,h:6,gradient:{id:"SVGID_2_",type:"linear",x1:7.9995,y1:4.0513,x2:7.9995,y2:9.865,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M16,14.5c0,0.276-0.224,0.5-0.5,0.5h-15C0.224,15,0,14.776,0,14.5v-1C0,13.224,0.224,13,0.5,13h15  c0.276,0,0.5,0.224,0.5,0.5V14.5z",gradient:{id:"SVGID_3_",type:"linear",x1:7.9995,y1:13.0508,x2:7.9995,y2:14.9258,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M9,14.5C9,14.224,8.776,14,8.5,14h-5C3.224,14,3,14.224,3,14.5V15h6V14.5z",gradient:{id:"SVGID_4_",type:"linear",x1:5.9995,y1:14.0508,x2:5.9995,y2:15.9258,stop:[{offset:"0",color:"#69B4A5"},{offset:"0.1",color:"#61AD9C"},{offset:"0.4637",color:"#449981"},{offset:"0.7764",color:"#2C8E73"},{offset:"1",color:"#218A6E"}]}}]}),Hn("shapelink_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"line",p1:{x:7.5,y:2.5},p2:{x:2.5,y:7.5},lineColor:"url(#SVGID_1_)",lineWidth:1},{shape:"line",p1:{x:2.5,y:7.5},p2:{x:8.5,y:13.5},lineColor:"url(#SVGID_2_)",lineWidth:1},{shape:"line",p1:{x:9,y:13.186},p2:{x:13.5,y:6.5},lineColor:"url(#SVGID_3_)",lineWidth:1},{shape:"ellipse",cx:7,cy:3,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:5.5864,y1:1.5864,x2:8.4149,y2:4.4149,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:7,cy:3,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:2,cy:8,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:.5864,y1:6.5864,x2:3.4142,y2:9.4142,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:2,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:8,cy:13,rx:2,ry:2,gradient:{id:"SVGID_6_",type:"linear",x1:6.5869,y1:11.5869,x2:9.4147,y2:14.4147,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:8,cy:13,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:13,cy:7,rx:2,ry:2,gradient:{id:"SVGID_7_",type:"linear",x1:11.5859,y1:5.5859,x2:14.4144,y2:8.4144,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:13,cy:7,rx:1,ry:1,fill:"#FFFFFF"}]}),Hn("shapenode_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M14.5,3h-9l-4,4v7h13L9,8.5L14.5,3z M12.086,13H2.5V7.414L5.914,4h6.172l-4.5,4.5L12.086,13z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:3.209,x2:7.9995,y2:13.6621,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:6,cy:3,rx:2,ry:2,gradient:{id:"SVGID_2_",type:"linear",x1:4.5859,y1:1.5859,x2:7.4151,y2:4.4151,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:6,cy:3,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:13,cy:3,rx:2,ry:2,gradient:{id:"SVGID_3_",type:"linear",x1:11.5869,y1:1.5864,x2:14.4153,y2:4.4149,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:13,cy:3,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:9,cy:8,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:7.5864,y1:6.5864,x2:10.4149,y2:9.4149,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:9,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:2,cy:7,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:.5859,y1:5.5859,x2:3.4144,y2:8.4144,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:2,cy:7,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:12.825,cy:13,rx:2,ry:2,gradient:{id:"SVGID_6_",type:"linear",x1:11.4111,y1:11.5869,x2:14.2396,y2:14.4153,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:12.825,cy:13,rx:1,ry:1,fill:"#FFFFFF"}]}),Hn("shapesubnetwork_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,6.661c0-1.202-0.642-2.247-1.596-2.835C12.848,2.188,11.314,1,9.486,1  c-1.587,0-2.95,0.902-3.649,2.211C4.573,3.22,3.548,4.194,3.438,5.432C3.389,5.429,3.342,5.417,3.292,5.417  C2.026,5.417,1,6.443,1,7.708S2.026,10,3.292,10h8.371l0,0C13.506,10,15,8.505,15,6.661z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:1.3755,x2:7.9995,y2:9.733,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M3.292,9C2.58,9,2,8.42,2,7.708s0.58-1.292,1.292-1.292C3.286,6.422,3.332,6.427,3.379,6.43l0.969,0.058  L4.435,5.52C4.5,4.779,5.106,4.216,5.844,4.211l0.595-0.004l0.28-0.524C7.273,2.645,8.334,2,9.486,2  c1.342,0,2.535,0.863,2.971,2.147l0.116,0.341l0.307,0.189C13.581,5.11,14,5.851,14,6.661C14,7.951,12.951,9,11.661,9H3.292z",fill:"#FFFFFF"},{shape:"path",data:"M3.272,9h8.37c1.11,0,2.039-0.689,2.275-1.729c-0.131-0.615-0.499-1.249-1.057-1.593l-0.307-0.189  l-0.116-0.341C12.002,3.863,10.809,3,9.468,3C8.314,3,7.254,3.645,6.7,4.682L6.42,5.207L5.825,5.211  C5.087,5.216,4.481,5.779,4.416,6.52L4.33,7.487L3.36,7.43C3.313,7.427,3.267,7.422,3.272,7.417c-0.535,0-0.994,0.327-1.19,0.792  C2.278,8.672,2.738,9,3.272,9z",gradient:{id:"SVGID_2_",type:"linear",x1:7.9995,y1:3.459,x2:7.9995,y2:8.4597,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M11.516,7.102h-8l2.469,6h8.5L11.516,7.102z M5.024,8.123h5.905l1.938,3.979H6.662L5.024,8.123z",gradient:{id:"SVGID_3_",type:"linear",x1:7.4443,y1:7.1724,x2:10.1111,y2:12.8383,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"5,8.112 10.904,8.112 12.842,12.092 6.638,12.092 z",fill:"#FFFFFF"},{shape:"ellipse",cx:5,cy:8,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:3,y1:8,x2:7,y2:8,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:5,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:12,cy:8,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:10,y1:8,x2:14,y2:8,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:12,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:7,cy:12,rx:2,ry:2,gradient:{id:"SVGID_6_",type:"linear",x1:5,y1:12,x2:9,y2:12,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:7,cy:12,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:14,cy:12,rx:2,ry:2,gradient:{id:"SVGID_7_",type:"linear",x1:12,y1:12,x2:16,y2:12,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:14,cy:12,rx:1,ry:1,fill:"#FFFFFF"}]}),Hn("subnetwork_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"rect",x:10,y:14.001,w:2,h:1,gradient:{id:"SVGID_1_",type:"linear",x1:11,y1:14.0059,x2:11,y2:14.9481,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"rect",x:14,y:10.001,w:1,h:2,gradient:{id:"SVGID_2_",type:"linear",x1:14.5,y1:10.0117,x2:14.5,y2:11.8962,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M16,6.001c0,0.552-0.447,1-1,1H8c-0.552,0-1-0.448-1-1v-4c0-0.552,0.448-1,1-1h7   c0.553,0,1,0.448,1,1V6.001z",gradient:{id:"SVGID_3_",type:"linear",x1:11.5,y1:.96,x2:11.5,y2:6.2265,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:8,y:2.001,w:7,h:4,fill:"#FFFFFF"},{shape:"rect",x:9,y:3.001,w:5,h:2,gradient:{id:"SVGID_4_",type:"linear",x1:11.5,y1:2.7007,x2:11.5,y2:5.0337,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M16,8.501c0,0.276-0.225,0.5-0.5,0.5h-8c-0.276,0-0.5-0.224-0.5-0.5l0,0c0-0.276,0.224-0.5,0.5-0.5   h8C15.775,8.001,16,8.225,16,8.501L16,8.501z",gradient:{id:"SVGID_5_",type:"linear",x1:11.5,y1:7.126,x2:11.5,y2:8.5535,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:9,y:8.001,w:1,h:.999,gradient:{id:"SVGID_6_",type:"linear",x1:9.5,y1:8.0063,x2:9.5,y2:8.9477,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M9,12c0,0.553-0.447,1-1,1H1c-0.552,0-1-0.447-1-1V8c0-0.552,0.448-1,1-1h7c0.553,0,1,0.448,1,1V12z   ",gradient:{id:"SVGID_7_",type:"linear",x1:4.4995,y1:6.959,x2:4.4995,y2:12.2259,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:1,y:8,w:7,h:4,fill:"#FFFFFF"},{shape:"rect",x:2,y:9,w:5,h:2,gradient:{id:"SVGID_8_",type:"linear",x1:4.5,y1:8.6997,x2:4.5,y2:11.0333,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M9,14.5C9,14.776,8.775,15,8.5,15h-8C0.224,15,0,14.776,0,14.5l0,0C0,14.224,0.224,14,0.5,14h8   C8.775,14,9,14.224,9,14.5L9,14.5z",gradient:{id:"SVGID_9_",type:"linear",x1:4.4995,y1:13.125,x2:4.4995,y2:14.5518,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:14,w:1,h:1,gradient:{id:"SVGID_10_",type:"linear",x1:2.5,y1:14.0049,x2:2.5,y2:14.9471,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M16,14.501c0,0.276-0.224,0.5-0.5,0.5h-2c-0.276,0-0.5-0.224-0.5-0.5v-1c0-0.276,0.224-0.5,0.5-0.5  h2c0.276,0,0.5,0.224,0.5,0.5V14.501z",gradient:{id:"SVGID_11_",type:"linear",x1:14.5,y1:13.0117,x2:14.5,y2:14.8962,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}}]});var Un={_hitCanvas:null,getHitCanvas:function(t,e){null==this._hitCanvas&&(this._hitCanvas=je.createCanvas()),0==arguments.length&&(t=2,e=2),this._hitCanvas.setAttribute("width",""+t-1),this._hitCanvas.setAttribute("height",""+e-1),this._hitCanvas.setAttribute("width",""+t),this._hitCanvas.setAttribute("height",""+e);var i=this.getCtx(this._hitCanvas);return i.clearRect(0,0,t,e),this._hitCanvas},disposeHitCanvas:function(){this._hitCanvas=null},getCtx:function(t){return t.getContext("2d")},render:function(t,i,n){i!=e&&(t.fillStyle=i,t.fill()),n!=e&&(t.strokeStyle=n,t.stroke())},text:function(t,e,i,n,s,r){t.textAlign="center",t.textBaseline="middle",null!=s&&(t.fillStyle=s,t.fillText(e,i,n)),r&&(t.strokeStyle=r,t.strokeText(e,i,n))},circle:function(t,e,i,n,s,r){t.arc(e,i,n,0,2*Math.PI,!0),t.closePath(),this.render(t,s,r)},rect:function(t,e,i,n,s,r,a){t.rect(e,i,n,s),t.closePath(),this.render(t,r,a)},OUT_LEFT:1,OUT_TOP:2,OUT_RIGHT:4,OUT_BOTTOM:8,outcode:function(t,e,i,n,s,r){var a=0;return 0>=s?a|=this.OUT_LEFT|this.OUT_RIGHT:i>t?a|=this.OUT_LEFT:t>i+s&&(a|=this.OUT_RIGHT),0>=r?a|=this.OUT_TOP|this.OUT_BOTTOM:n>e?a|=this.OUT_TOP:e>n+r&&(a|=this.OUT_BOTTOM),a},intersectsLine:function(t,e,i,n,s,r,a,o){var h,l;if(0==(l=this.outcode(i,n,s,r,a,o)))return!0;for(;0!=(h=this.outcode(t,e,s,r,a,o));){if(0!=(h&l))return!1;if(0!=(h&(this.OUT_LEFT|this.OUT_RIGHT))){var c=s;0!=(h&this.OUT_RIGHT)&&(c+=a),e+=(c-t)*(n-e)/(i-t),t=c}else{var u=r;0!=(h&this.OUT_BOTTOM)&&(u+=o),t+=(u-e)*(i-t)/(n-e),e=u}}return!0}};De.vector={},De.vector.interaction={},De.vector.Network=function(t){De.vector.Network.superClass.constructor.apply(this,arguments),this.zoomManager=new De.vector.PhysicalZoomManager(this),this._view=je.createView("hidden"),this._rootCanvas=je.createCanvas(),this._topCanvas=je.createCanvas(),this._view.appendChild(this._rootCanvas),this._view.appendChild(this._topCanvas),this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0},this._zoom=1,this._elementUIMap={},this._zoomMap={},this._viewRectMap={},this.viewRect={x:0,y:0,width:0,height:0},this.hScrollBarVisible=!1,this.vScrollBarVisible=!1,this.markerList=new De.List,this._topAttachmentList=new De.List,this._hitTestTopAttachmentList=new De.List,this.setElementBox(t?t:new De.ElementBox),He.isTouchable?He.isMSTouchable?this.setDefaultInteractions(!1):this.setTouchInteractions():this.setDefaultInteractions(!1);var e=this;this._flowLink=function(){if(!(e.isMovingElement()||e.isSelectingElement()||e.isEditingElement()||e._box._layoutMovingElements)){e._flowLinkQuickFinder||(e._flowLinkQuickFinder=new De.QuickFinder(e._box,"link.flow","style"));var t=e._flowLinkQuickFinder.find(!0);t.forEach(function(t){t._styleMap["link.flow.offset"]=e.getLinkFlowOffset(t),e.invalidateElementUI(t)})}},this.setToolTipEnabled(De.Defaults.NETWORK_TOOLTIP_ENABLED),this._paintAll=!0,this._dirtyRects=new gn,this._invalidateMap={},this._invalidateAll=!0,e._count=0,e._invalidate=!0,function i(t){e._loopId=requestAnimationFrame(i),e._invalidate&&(e._count++,e._now=t,e.validate())}(0),De.imageUtil.addEventListener(this.invalidateElementUIs,this)},Be.ext("twaver.vector.Network",De.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","scrollBarWidth","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointSize","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","rotatePointSize","rotatePointFillColor","rotatePointOffset","rotatePointOutlineWidth","rotatePointOutlineColor","rotateScaleFillColor","rotateScaleFontColor","rotateScaleWidth","rotateScaleHeight","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter","selectionTolerance"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","scrollBarVisible","limitViewInCanvas","autoValidateCanvasSize","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","rotatingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation","showRotateScale","transparentSelectionEnable","edgeDetect","dragToPan","wheelToZoom","asyncZoomAndViewRect","debug","zoomDivVisible","showShadowInEdit"],_currentSubNetwork:null,_subNetworkAnimate:De.Defaults.NETWORK_SUBNETWORK_ANIMATE,_scrollBarWidth:10,_scrollBarVisible:!0,_limitViewInCanvas:!1,_autoValidateCanvasSize:!0,_makeVisibleOnSelected:De.Defaults.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:De.Defaults.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:De.Defaults.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:kn.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_elementUIFunction:De.Defaults.VECTORUI_FUNCTION,_doubleClickToUpSubNetwork:De.Defaults.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:De.Defaults.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:De.Defaults.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:De.Defaults.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:De.Defaults.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_selectOutlineColor:De.Defaults.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:De.Defaults.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:De.Defaults.NETWORK_SELECT_FILL_COLOR,_sendToTopOnSelected:De.Defaults.NETWORK_SENDTOTOP_ON_SELECTED,_lazyMoveOutlineColor:De.Defaults.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:De.Defaults.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:De.Defaults.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:De.Defaults.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:De.Defaults.NETWORK_LAZYMOVE_ANIMATE,_resizePointSize:De.Defaults.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:De.Defaults.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:De.Defaults.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:De.Defaults.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:De.Defaults.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:De.Defaults.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:De.Defaults.NETWORK_RESIZE_ANIMATE,_rotatePointSize:De.Defaults.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:De.Defaults.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:De.Defaults.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:De.Defaults.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:De.Defaults.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:kn.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:kn.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:kn.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:kn.NETWORK_ROTATE_SCALE_FONT_COLOR,_editPointSize:De.Defaults.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:De.Defaults.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:De.Defaults.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:De.Defaults.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:De.Defaults.NETWORK_EDIT_LINE_COLOR,_editLineWidth:De.Defaults.NETWORK_EDIT_LINE_WIDTH,_limitElementInPositiveLocation:!1,_linkFlowInterval:kn.NETWORK_LINK_FLOW_INTERVAL,_selectionTolerance:kn.NETWORK_SELECTION_TOLERANCE,_invalidateViewRectFlag:!1,_repaintTopFlag:!1,_invalidateCanvasSizeFlag:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_transparentSelectionEnable:De.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,_edgeDetect:!1,_dragToPan:!0,_wheelToZoom:!0,_asyncZoomAndViewRect:!1,_debug:!1,_zoomDivVisible:!0,_showShadowInEdit:!1,adjustBounds:function(t){var e=!1,i=this._view.style;if(i.left==t.x+"px"&&i.top==t.y+"px"&&i.width==t.width+"px"&&i.height==t.height+"px"&&(e=!0),De.vector.Network.superClass.adjustBounds.apply(this,arguments),1!=e){var n=this._view.offsetWidth,s=this._view.offsetHeight;this._rootCanvas.setAttribute("width",n),this._rootCanvas.setAttribute("height",s),this._topCanvas.setAttribute("width",n),this._topCanvas.setAttribute("height",s),this.setViewRect(this.viewRect.x,this.viewRect.y,n,s),"undefined"==typeof De.gis&&(De.Util.makeHighRes(this._rootCanvas),De.Util.makeHighRes(this._topCanvas)),this.invalidateElementVisibility()}},getLabel:function(t){return t.getStyle("network.label")||t.getName()},getLabel2:function(t){return t.getStyle("network.label")||t.getName2()},setZoomManager:function(t){var e=this.zoomManager;e!=t&&(this.zoomManager=t,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.validateCanvasSize(),this.invalidateElementUIs(),this.firePropertyChange("zoomManager",e,t))},getZoomManager:function(){return this.zoomManager},getRootCanvas:function(){return this._rootCanvas},getTopCanvas:function(){return this._topCanvas},validateImpl:function(){gi.twm(this);var t,e,i,n,s=this.getElementBox().getDatas()._as,r=s.length,a={},o=this._visibleFunction,h=1===this._box._layerBox.size()?this._box._layerBox._defaultLayer:null;for(t=0;r>t;t++)i=s[t],a[i._id]=this.isVisible(i,o,h);var l=this.getGraphicsZoom(),c=null,u={x:this.viewRect.x/l,y:this.viewRect.y/l,width:this.viewRect.width/l,height:this.viewRect.height/l};if(this._invalidateAll){if(this._visibleMap)for(t=0;r>t;t++)i=s[t],a[i._id]!==this._visibleMap[i._id]&&(n=this._elementUIMap[i._id],n&&n.invalidate());for(t=0;r>t;t++)i=s[t],n=this._elementUIMap[i._id],n&&n.validate();this._paintAll=!0}else if(this._paintAll){for(e in this._invalidateMap)n=this._elementUIMap[e],n&&n.invalidate();for(e in this._invalidateMap)n=this._elementUIMap[e],n&&n.validate()}else{for(e in this._invalidateMap)n=this._elementUIMap[e],n&&(this._dirtyRects.add(n.getZoomViewRect(!1)),n.invalidate());for(e in this._invalidateMap)n=this._elementUIMap[e],n&&(n.validate(),this._dirtyRects.add(n.getZoomViewRect(!0)))}this._paintAll?c=u:(this._dirtyRects.forEach(function(t){c=null==c?Be.cloneRect(t):Ge.unionRect(c,t)}),c?(Ge.grow(c,2,2),c=Ge.intersection(c,u)):c=u),this._visibleMap=a,c&&this.paintRoot(c),this.validateCanvasSize(),1==this._repaintTopFlag&&(this._repaintTopFlag=!1,this.paintTopCanvas())},isLinkFlowEnabled:function(){return!!this._linkFlowEnabled},setLinkFlowEnabled:function(t){t?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange("linkFlowEnabled",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange("linkFlowEnabled",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(t){var e=this._linkFlowInterval;this._linkFlowInterval=t,this.firePropertyChange("linkFlowInterval",e,t),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getElementBox:function(){return this._box},setElementBox:function(t){if(!t)throw"ElementBox can not be null";if(this._box!==t){var e=this._box;e&&(e.removeDataBoxChangeListener(this.handleElementBoxChange,this),e.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),e.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),e.removeIndexChangeListener(this.handleIndexChange,this),e.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),e.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),e.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||e.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=t,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new De.QuickFinder(this._box,"link.flow","style")),this._selectionModel?this._selectionModel._setDataBox(t):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.firePropertyChange("elementBox",e,this._box)}},handleElementBoxChange:function(t){var e=t.data;if("add"===t.kind)this.createElementUI(e),this.invalidateBundleLink(e);else if("remove"===t.kind){var i=this.getElementUI(e);i&&(this._dirtyRects.add(i.getZoomViewRect()),i.dispose(),delete this._elementUIMap[e.getId()]),e===this._currentSubNetwork&&null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null),delete this._invalidateMap[e._id]}else"clear"===t.kind&&(this._elementUIMap={},null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null),this._paintAll=!0);this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementPropertyChange:function(t){var e=t.source,i=this.getElementUI(e);i&&(this.invalidateElementUI(e),i.handlePropertyChange(t)),this.invalidateBundleLink(e),this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementBoxPropertyChange:function(){this.invalidateElementVisibility()},handleIndexChange:function(t){this.invalidateElementVisibility()},handleLayerBoxChange:function(){this.invalidateElementVisibility()},handleLayerPropertyChange:function(t){"editable"===t.property&&this.invalidateSelectedElementUIs(!0),this.invalidateElementVisibility()},handleLayerHierarchyChange:function(){this.invalidateElementVisibility()},handleSelectionChange:function(t){var e=this.getSelectionModel().getLastData();e&&("append"===t.kind||"set"===t.kind)&&(this.isMakeVisibleOnSelected()&&this.makeVisible(e),this.isSendToTopOnSelected()&&this.sendToTop(e)),t.datas.forEach(function(e){var i=this.getElementUI(e);i&&i.handleSelectionChange(t),this.invalidateElementUI(e)},this),this.invalidateElementVisibility()},sendToTop:function(t){if(this._box.contains(t)){for(var e=t;e._parent&&this.isVisible(e._parent)&&(e=e._parent););e!==t&&this._box.adjustElementIndex(e),this._box.adjustElementIndex(t)}},getViewRect:function(){return this.viewRect?Be.cloneRect(this.viewRect):{x:0,y:0,width:0,height:0}},getCanvasSize:function(){return{width:this.realWidth,height:this.realHeight}},setViewOffSet:function(t,e){var i=this.viewRect.x,n=this.viewRect.y,s=this.viewRect.width,r=this.viewRect.height;this.setViewRect(i+t,n+e,s,r)},setViewRect:function(t,e,i,n){1==this.isLimitViewInCanvas()&&(0>t&&(t=0),i>this.realWidth?t=0:t+i>this.realWidth&&(t=this.realWidth-i),0>e&&(e=0),n>this.realHeight?e=0:e+n>this.realHeight&&(e=this.realHeight-n));var s=this.viewRect;(null==this.viewRect||t!=this.viewRect.x||e!=this.viewRect.y||i!=this.viewRect.width||n!=this.viewRect.height)&&(this.viewRect={x:t,y:e,width:i,height:n},this.firePropertyChange("viewRect",s,this.viewRect),this.invalidateElementVisibility(),this._paintAll=!0)},isHScrollBarVisible:function(){return this.hScrollBarVisible},setHScrollBarVisible:function(t){this.hScrollBarVisible=t},isVScrollBarVisible:function(){return this.vScrollBarVisible},setVScrollBarVisible:function(t){this.vScrollBarVisible=t},setZoomVisibilityThresholds:function(t){var e=this._visibilityThresholds;this._zoomVisibilityThresholds=t,this.firePropertyChange("zoomVisibilityThresholds",e,t),this.invalidateElementVisibility()},getZoomVisibilityThresholds:function(){return this._zoomVisibilityThresholds||{}},invalidateElementVisibility:function(){this.invalidate()},repaintTopCanvas:function(){this._repaintTopFlag||(this._repaintTopFlag=!0,this.invalidate())},invalidateCanvasSize:function(t){this._invalidateCanvasSizeFlag||(this._invalidateCanvasSizeFlag=!0,this.invalidate())},validateCanvasSize:function(){0!=this._invalidateCanvasSizeFlag&&(this._invalidateCanvasSizeFlag=!1,this._validateCanvasSize())},_validateCanvasSize:function(){if(0==this.isAutoValidateCanvasSize())return this.realWidth=0,this.realHeight=0,void(this._unionBounds={x:0,y:0,width:0,height:0});var t,e=this.getElementBox().getDatas(),i=e.size();if(i>0){for(var n=0;i>n;n++){var s=e.get(n);if(this._visibleMap[s._id]){var r=this._elementUIMap[s._id];r&&(t=t?Ge.unionRect(t,r.getZoomViewRect(!0)):Be.cloneRect(r.getZoomViewRect(!0)))}}null==t&&(t={x:0,y:0,width:0,height:0});var a=this.getGraphicsZoom();if(this.realWidth==(t.x+t.width)*a&&this.realHeight==(t.y+t.height)*a)return;this.realWidth=(t.x+t.width)*a,this.realHeight=(t.y+t.height)*a,this._unionBounds={x:t.x*a,y:t.y*a,width:t.width*a,height:t.height*a}}else this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0};this.setViewRect(this.viewRect.x,this.viewRect.y,this.viewRect.width,this.viewRect.height),this.firePropertyChange("canvasSizeChange",null,this.viewRect)},getElementUI:function(t){return null==t?null:this._elementUIMap[t._id]},getUnionBounds:function(){return this._unionBounds},getZoomBodyRect:function(t){var e=this.getElementUI(t);return e?e.getZoomBodyRect():null},getShapeNodeZoomPoints:function(t,e){if(t._points){var i=this.getElementUI(t);if(i)return i._getZoomPoints()}return null},createElementUI:function(t){var e=this._elementUIMap[t.getId()];if(!e){if(e=this._elementUIFunction(this,t),!e){var i=t.getClassName(),n=i.substr(i.indexOf(".")+1)+"UI",s=De.vector[n];s&&(e=new s(this,t))}e&&(this._elementUIMap[t.getId()]=e)}return this._invalidateMap&&(this._invalidateMap[t._id]=t),e},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(t){if(!t)throw"ElementUIFunction can not be null";if(this._elementUIFunction!==t){var e=this._elementUIFunction;this._elementUIFunction=t,this.firePropertyChange("elementUIFunction",e,t),this._box.isEmpty()||(this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize())}},invalidateElementUI:function(t,e){if(!this._invalidateAll){if(this._invalidateMap[t._id]=t,this.getElementUI(t),t instanceof On){var i=t.getAgentLinks();null!=i&&i.forEach(this.invalidateElementUI,this);var n=t.getParent();n instanceof De.Group&&this.invalidateElementUI(n)}this.invalidateElementVisibility()}},invalidateElementUIs:function(t){this._invalidateAll=!0,this._invalidateMap={},this._visibleMap={},this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.invalidate()},invalidateSelectedElementUIs:function(t){this.getSelectionModel().getSelection().forEach(function(e){this.invalidateElementUI(e,t)},this)},invalidateBundleLink:function(t){if(t instanceof De.Link&&t._bundleLinks){var e=this._elementUIMap;t._bundleLinks.forEachSiblingLink(function(i){if(i!==t){var n=e[i._id];n&&n.invalidate(!1)}},this)}},paintRoot:function(t){var i=this._rootCanvas.getContext("2d");i.save();var n=this.getGraphicsZoom();i.beginPath(),i.rect(Math.round(t.x*n-this.viewRect.x),Math.round(t.y*n-this.viewRect.y),Math.round(t.width*n),Math.round(t.height*n)),i.clip(),i.clearRect(Math.round(t.x*n-this.viewRect.x),Math.round(t.y*n-this.viewRect.y),Math.round(t.width*n),Math.round(t.height*n)),this.visibleList=new De.List,this._topAttachmentList=new De.List,dn.draw(i,this);var s=this.getElementBox().getDatas()._as,r=s.length,a=this.zoomManager;a._zoomGraphicsBegin(i),this.paintBottom(i,t);var o,h,l,c,u=this._box._layerBox,n=this.getGraphicsZoom(),d={x:this.viewRect.x/n,y:this.viewRect.y/n,width:this.viewRect.width/n,height:this.viewRect.height/n};if(1===u.size())for(o=0;r>o;o++)h=s[o],this._visibleMap[h._id]?(l=this._elementUIMap[h._id],this._debug&&qe.strokeRect(i,t,"red"),null!=l&&this._isInView(l,t)&&(l.paint(i),l.setAttachmentVisible&&l.setAttachmentVisible(!0)),null!=l&&Ge.intersects(d,l.getZoomViewRect())?l.setAttachmentVisible&&l.setAttachmentVisible(!0):l.setAttachmentVisible&&l.setAttachmentVisible(!1),this.visibleList.add(h)):(l=this._elementUIMap[h._id],l&&l.setAttachmentVisible&&l.setAttachmentVisible(!1));else u.forEachByDepthFirst(function(e){for(o=0;r>o;o++)h=s[o],u.getLayerByElement(h)===e&&this._visibleMap[h._id]?(l=this._elementUIMap[h._id],null!=l&&this._isInView(l,t)&&(l.paint(i),l.setAttachmentVisible&&l.setAttachmentVisible(!0)),null!=l&&Ge.intersects(d,l.getZoomViewRect())?l.setAttachmentVisible&&l.setAttachmentVisible(!0):l.setAttachmentVisible&&l.setAttachmentVisible(!1),this.visibleList.add(h)):(l=this._elementUIMap[h._id],l&&l.setAttachmentVisible&&l.setAttachmentVisible(!1))},null,this);for(r=this._topAttachmentList.size(),o=0;r>o;o++)c=this._topAttachmentList.get(o),c.getElementUI().paintAttachment(i,c);if(this.paintTop(i,t),this._xyz!==e){var r,f=this._xyz,g=f.markText,_=f.type,p=(f.expired,f.innerHTML),v=0,m=0,y=this.viewRect;i.translate(this.viewRect.x/this.getZoom(),this.viewRect.y/this.getZoom()),i.scale(1/this.getZoom(),1/this.getZoom());var n=this.getZoom();g!=e&&null!=g&&""!=g||"2"==_?(i.font="15px Arial sans-serif",r=Be.g.getTextSize(i.font,p),i.fillStyle="red",v=y.width-r.width,m=y.height-20):(i.font="10px Arial sans-serif",r=Be.g.getTextSize(i.font,p),v=y.width/2-r.width/2,m=y.height/2),i.fillText(p,v,m)}i.restore(),this._invalidateMap={},this._invalidateAll=!1,this._paintAll=!1,this._dirtyRects=new gn},paintBottom:function(t,e){},paintTop:function(t,e){},_isInView:function(t,e){return Ge.intersects(e,t.getZoomViewRect())},paintTopCanvas:function(){var t=this._topCanvas.getContext("2d");t.clearRect(0,0,this._topCanvas.width,this._topCanvas.height),this.paintMarker(t)},paintMarker:function(t){for(var e=this.markerList.size(),i=0;e>i;i++){var n=this.markerList.get(i);n.paint(t)}},getLayerByElement:function(t){return this._box.getLayerBox().getLayerByElement(t)},getLogicalPoint2:function(t){return this.zoomManager._getLogicalPoint(t)},getLogicalPoint:function(t){return this.zoomManager._getLogicalPoint(t,!0)},getElementAt:function(t){if(null==this.visibleList)return null;var e;if(t.target?e=this.getLogicalPoint2(t):t.event?t.event.target&&(e=this.getLogicalPoint2(t.event)):e=t,null!=this._hitTestTopAttachmentList)for(var i=this._hitTestTopAttachmentList.size(),n=i-1;n>=0;n--){var s=this._hitTestTopAttachmentList.get(n);if(s.hit(e.x,e.y))return s.getElement()}if(null!=this.visibleList)for(var r=this.visibleList.size(),a=r-1;a>=0;a--){var o=this.visibleList.get(a),h=this.getElementUI(o);if(h&&h.hit(e.x,e.y))return o}return null},hitTest:function(t){var e=this.getElementAt(t);if(!e)return null;var i=this.getElementUI(e);if(!i)return null;var n;return n=t.target?this.getLogicalPoint2(t):t.event?this.getLogicalPoint2(t.event):t,i.hitTest(n.x,n.y);
},getElementsAtRect:function(t,i,n,s){var r=new De.List;if(null==this.visibleList)return r;s=s===e||s;for(var a=this.visibleList.size(),o=a-1;o>=0;o--){var h=this.visibleList.get(o),l=this.getElementUI(h);l&&(!n||n(l._element))&&(s&&this.isSelectable(l._element)||!s)&&(i?l.intersects(t)&&r.add(h):Ge.contains(t,l.getZoomViewRect(ui))&&r.add(h))}return r},getPosition:function(t,e,i,n,s,r){var a,o=e instanceof De.vector.ElementUI?e:this.getElementUI(e);if(o)if("from"===t||"to"===t){if(o.getFromPosition&&(a="from"===t?o.getFromPosition(n,s):o.getToPosition(n,s)))return i?{x:a.x-i.width/2,y:a.y-i.height/2}:a}else a="hotspot"===t?r?o.getZoomHotSpot(this.zoomManager):o.getHotSpot():Ye.get(t,r?o.getZoomBodyRect():o.getBodyRect(),i);if(!a&&e.getRect&&(a=Ye.get(t,e.getRect(),i)),a)return{x:a.x+n,y:a.y+s};throw"position '"+t+"' object '"+e+"'"},isValidEvent:function(t){if(!t)return!1;var e,i;if(t.currentTarget===this._view){if(He.isFirefox?(e=t.layerX,i=t.layerY):(e=t.offsetX,i=t.offsetY),1==this.isHScrollBarVisible()&&i>=this.viewRect.height-this.getScrollBarWidth())return!1;if(1==this.isVScrollBarVisible()&&e>=this.viewRect.width-this.getScrollBarWidth())return!1}return!0},addMarker:function(t){this.markerList.add(t),this.repaintTopCanvas()},removeMarker:function(t){this.markerList.remove(t),this.repaintTopCanvas()},clearMarker:function(){this.markerList.clear(),this.repaintTopCanvas()},isMovable:function(t){return!(!this._box.contains(t)||!t.isMovable())&&(!(t instanceof De.Link)&&(!(this._movableFunction&&!this._movableFunction(t))&&this.getLayerByElement(t).isMovable()))},hasMovableSelectedElements:function(){for(var t=this.getSelectionModel().getSelection(),e=0;e<t.size();e++){var i=t.get(e);if(this.isMovable(i))return!0}return!1},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(t){return this.isMovable(t)},this)},moveSelectedElements:function(t,e,i,n){if(0!==t||0!==e){var s=this.getMovableSelectedElementsRect();null!=s&&(this._limitElementInPositiveLocation&&(s.x+t<0&&(t=-s.x),s.y+e<0&&(e=-s.y)),De.Util.moveElements(this.getMovableSelectedElements(),t,e,i,n,this))}},getMovableSelectedElementsRect:function(){var t=this.getMovableSelectedElements();if(0===t.size())return null;for(var e=null,i=0,n=t.size();n>i;i++){var s=t.get(i);if(s instanceof On){var r=this.getElementUI(s);r&&(e=Ge.unionRect(e,r.getViewRect()))}}return e},isVisible:function(t,e,i){if(!this._box.contains(t))return!1;if(!t.isVisible())return!1;if(3!==arguments.length&&(e=this._visibleFunction),e&&!e(t))return!1;if(!(i||this._box._layerBox.getLayerByElement(t))._visible)return!1;if(xi.getSubNetwork(t)!==this._currentSubNetwork)return!1;if(!this.zoomManager.isElementVisible(t))return!1;if(t instanceof De.Link){if(!this._noAgentLinkVisible){if(!t._fromAgent||!t._toAgent)return!1;if(!this.isVisible(t._fromAgent,e,i)||!this.isVisible(t._toAgent,e,i))return!1}if(t.getBundleIndex()>0&&t.getBundleCount()>1&&!t.getStyle("link.bundle.expanded"))return!1}else for(var n=t._parent;n&&!n.ISubNetwork;){if(n instanceof De.Group&&(!n.isExpanded()||!this.isVisible(n,e,i)))return!1;n=n._parent}return!t.IDummy},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(t){var e=this._visibleFunction;this._visibleFunction=t,this.firePropertyChange("visibleFunction",e,t),this.invalidateElementVisibility()},isEditable:function(t){return!!this._box.contains(t)&&(!(this._editableFunction&&!this._editableFunction(t))&&this.getLayerByElement(t).isEditable())},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(t){var e=this._editableFunction;this._editableFunction=t,this.firePropertyChange("editableFunction",e,t),this.invalidateSelectedElementUIs(!0)},isRotatable:function(t){return!(this._rotatableFunction&&!this._rotatableFunction(t))},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(t){var e=this._rotatableFunction;this._rotatableFunction=t,this.firePropertyChange("rotatableFunction",e,t),this.invalidateSelectedElementUIs(!0)},isLinkable:function(t,e){return null==this._linkableFunction||this._linkableFunction(t,e)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(t){var e=this._linkableFunction;this._linkableFunction=t,this.firePropertyChange("linkableFunction",e,t),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getShadowColor:function(t){var e=t.getStyle("shadow.color");return!e&&this.isSelected(t)&&"shadow"===t.getStyle("select.style")?t.getStyle("select.color"):e},getSelectColor:function(t){return t.getStyle("select.color")},getAlarmLabel:function(t){var e=t.getAlarmState().getHighestNewAlarmSeverity();if(e){var i=t.getAlarmState().getNewAlarmCount(e)+e.nickName;return t.getAlarmState().hasLessSevereNewAlarms()&&(i+="+"),i}return null},getLinkHandlerLabel:function(t){return t.isBundleAgent()?"+("+t.getBundleCount()+")":null},setInteractions:function(t){var e=this._interactions;e&&e.forEach(function(t){t.tearDown()}),this._interactions=t,t&&t.forEach(function(t){t.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",e,t)},getInteractions:function(){return this._interactions},setDefaultInteractions:function(t){this.setInteractions([new De.vector.interaction.DefaultInteraction(this,t)])},setTouchInteractions:function(){this.setInteractions([new De.vector.interaction.DefaultInteraction(this,(!1)),new De.vector.interaction.TouchInteraction(this)])},setMSTouchInteractions:function(){this.setInteractions([new De.vector.interaction.MSTouchInteraction(this)])},setEditInteractions:function(t){this.setInteractions([new De.vector.interaction.EditInteraction(this,t),new De.vector.interaction.DefaultInteraction(this)])},setCreateElementInteractions:function(t){this.setInteractions([new De.vector.interaction.CreateElementInteraction(this,t),new De.vector.interaction.DefaultInteraction(this)])},setCreateLinkInteractions:function(t){this.setInteractions([new De.vector.interaction.CreateLinkInteraction(this,t),new De.vector.interaction.DefaultInteraction(this)])},setCreateShapeLinkInteractions:function(t){this.setInteractions([new De.vector.interaction.CreateShapeLinkInteraction(this,t),new De.vector.interaction.DefaultInteraction(this)])},setCreateShapeNodeInteractions:function(t){this.setInteractions([new De.vector.interaction.CreateShapeNodeInteraction(this,t),new De.vector.interaction.DefaultInteraction(this)])},setMagnifyInteractions:function(){this.setInteractions([new De.vector.interaction.DefaultInteraction(this),new De.vector.interaction.MagnifyInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(t){var e=this._hasEditInteraction;this._hasEditInteraction=t,this.firePropertyChange("hasEditInteraction",e,t)},addElementByInteraction:function(t){t.getParent()||t.setParent(this._currentSubNetwork),this._box.add(t),this.getSelectionModel().setSelection(t),this.fireInteractionEvent({kind:"createElement",element:t})},getToolTip:function(t){if(t){var e=t.getToolTip();return e?e:t.getName()}return null},isToolTipEnabled:function(){return!!this._toolTipEnabled},setToolTipEnabled:function(t){if(this._toolTipEnabled=t,t){if(!this._toolTipListener){var e=this;this._toolTipListener=function(t){if(e.isMovingElement())return void Ei.hideToolTip();var i=e.getElementAt(t);if(e._preElement!==i)if(e._preElement=i,i){var n=e.getToolTip(i);Ei.showToolTip({x:t.pageX,y:t.pageY},n);var s=Ei.getToolTipDiv();if(s.children.length>0){var r=e._view.getBoundingClientRect(),a=s.getBoundingClientRect();a.width+a.left>r.width+r.left&&(s.style.left=r.width+r.left-a.width+(Ve.documentElement.scrollLeft||Ve.body.scrollLeft)+"px"),a.height+a.top>r.height+r.top&&(s.style.top=r.height+r.top-a.height+(Ve.documentElement.scrollTop||Ve.body.scrollTop)+"px")}}else Ei.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!1),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Ei.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!1),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},setZoom:function(t,e){if(t=this.checkZoom(t),this.isAsyncZoomAndViewRect())var i=this._zoomMap[this._currentSubNetwork].zoom;else var i=this._zoom;if(t!=i){var n=this.getViewRect();e||(e={x:n.width/2,y:n.height/2});var s=this.viewRect,r=e.x-(e.x+s.x)*t/i,a=e.y-(e.y+s.y)*t/i;this.isAsyncZoomAndViewRect()?this._zoomMap[this._currentSubNetwork].zoom=t:this._zoom=t,this._paintAll=!0,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.zoomManager._invalidateZoom(),this.setViewRect(-r,-a,this.viewRect.width,this.viewRect.height),this._asyncZoomAndViewRect?this.firePropertyChange("zoom",i,this._zoomMap[this._currentSubNetwork].zoom):this.firePropertyChange("zoom",i,this._zoom)}},getZoom:function(){if(this.isAsyncZoomAndViewRect()){var t=this._zoomMap[this._currentSubNetwork];return t||(this._zoomMap[this._currentSubNetwork]={zoom:1}),this._zoomMap[this._currentSubNetwork].zoom}return this._zoom},getSizeZoom:function(t){return this.zoomManager.getSizeZoom(t)},getLocationZoom:function(){return this.zoomManager.getLocationZoom()},getGraphicsZoom:function(){return this.zoomManager.getGraphicsZoom()},zoomOverview:function(t){if(!(this._unionBounds.width<=0||this._unionBounds.width<=0)){var e=this.getZoom(),i=this._unionBounds,n=i.width/e,s=i.height/e,r=this.viewRect.width/n,a=this.viewRect.height/s,o=Math.min(r,a);this.setZoom(o);var h=this.getZoom(),l=this.viewRect.width/2-this._unionBounds.width/2*h/e,c=this.viewRect.height/2-this._unionBounds.height/2*h/e;if(this.setViewRect(this._unionBounds.x*h/e-l,this._unionBounds.y*h/e-c,this.viewRect.width,this.viewRect.height),1!=this.getLocationZoom()){var u=null==arguments[1]?5:arguments[1];if(u>0){u--;var d=this;setTimeout(function(){d.zoomOverview(t,u)},25)}}}},zoomReset:function(t){this.setZoom(1,t)},zoomIn:function(t){this.setZoom(1.2*this.getZoom(),t)},zoomOut:function(t){this.setZoom(this.getZoom()/1.2,t)},upSubNetwork:function(t,e){this._currentSubNetwork&&this.setCurrentSubNetwork(xi.getSubNetwork(this._currentSubNetwork),t,e)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(t,e,i){if(De.animate.AnimateManager.endAnimate(),e){if(this._currentSubNetwork===t)return;if(t&&!this._box.contains(t))throw t+" is not contained in this network's elementBox";var n=new De.animate.AnimateSubNetwork(this,t,i);De.animate.AnimateManager.start(n)}else this._setCurrentSubNetwork(t),i&&i()},_setCurrentSubNetwork:function(t){if(this._currentSubNetwork!==t){if(t&&!this._box.contains(t))throw t+" is not contained in this network's elementBox";if(this.isAsyncZoomAndViewRect()){var e=this._viewRectMap[this._currentSubNetwork];this._viewRectMap[this._currentSubNetwork]=e?this.viewRect:this.viewRect?this.viewRect:{x:0,y:0,width:this.viewRect.width,height:this.viewRect.height}}var i=this._currentSubNetwork;if(this._currentSubNetwork=t,this.firePropertyChange("currentSubNetwork",i,t),this.isAsyncZoomAndViewRect()){this._viewRectMap[this._currentSubNetwork]||(this._viewRectMap[this._currentSubNetwork]={x:0,y:0,width:this.viewRect.width,height:this.viewRect.height});var e=this._viewRectMap[this._currentSubNetwork];this.setViewRect(e.x,e.y,e.width,e.height),this.invalidateElementUIs()}this.invalidateElementVisibility(),this.invalidateCanvasSize(),this._paintAll=!0}},makeVisible:function(t){var e=this.getElementUI(t);if(e){var i=xi.getSubNetwork(t);if(i!==this._currentSubNetwork){var n=this;return void this.setCurrentSubNetwork(i,this.isSubNetworkAnimate(),function(){Be.callLater(n.makeVisible,n,[t])})}for(var s=t;(s=s.getParent())&&s!==i;)s instanceof De.Group&&s.setExpanded(!0);var r=e.getViewRect();if(r){var a,o=e.getZoomViewRect(this.zoomManager);a=r.x==o.x&&r.y==o.y&&r.width==o.width&&r.height==o.height?{x:r.x*this.getGraphicsZoom(),y:r.y*this.getGraphicsZoom(),width:r.width*this.getGraphicsZoom(),height:r.height*this.getGraphicsZoom()}:o,Ge.intersects(this.viewRect,a)||this.isVisible(t)&&Be.callLater(this.centerByLogicalPoint,this,[a.x+a.width/2,a.y+a.height/2])}}},centerByLogicalPoint:function(t,e,i){var n=t-this.viewRect.width/2,s=e-this.viewRect.height/2;this.setViewRect(n,s,this.viewRect.width,this.viewRect.height)},panByOffset:function(t,e){this.setViewOffSet(t,e)},getIconsNames:function(t){return t.getStyle("icons.names")},getIconsColors:function(t){return t.getStyle("icons.colors")},getLinkFlowStepping:function(t){var e=parseInt(t.getStyle("link.flow.stepping"));return e||(e=kn.NETWORK_LINK_FLOW_STEPPING),e},getLinkFlowOffset:function(t){var e=t.getStyle("link.flow.offset");return isNaN(e)&&(e=0),e+this.getLinkFlowStepping(t)},toCanvas:function(t,e,i,n,s,r){i||(i=je.createCanvas()),i.setAttribute("width",t),i.setAttribute("height",e),i._viewRect?(i._viewRect.width=t,i._viewRect.height=e):i._viewRect={x:0,y:0,width:t,height:e};var a=i.getContext("2d");if(a.translate(-s,-r),a.clearRect(0,0,t,e),dn.draw(a,this),0===this._view.clientWidth||0===this._view.clientHeight)return i;t/this.realWidth*this.getGraphicsZoom(),e/this.realHeight*this.getGraphicsZoom(),a.scale(n,n);var o=this.getElementBox().getDatas()._as,h=o.length;this._topAttachmentList=new De.List;var l,c,u,d,f,g,_=this.getElementBox().getLayerBox(),p=_.getRoots(),v=p.size();if(1===v)for(u=0;h>u;u++)d=o[u],this._visibleMap[d._id]&&(f=this._elementUIMap[d._id],null!=f&&f.paint(a));else for(l=0;v>l;l++)for(c=p.get(l),u=0;h>u;u++)d=o[u],_.getLayerByElement(d)===c&&this._visibleMap[d._id]&&(f=this._elementUIMap[d._id],null!=f&&f.paint(a));for(h=this._topAttachmentList.size(),u=0;h>u;u++)g=this._topAttachmentList.get(u),g.getElementUI().paintAttachment(a,g);return i},toCanvasByRegion:function(t,e,i){i||(i=je.createCanvas());var n=t.width*e,s=t.height*e;i.setAttribute("width",n),i.setAttribute("height",s),i._viewRect?(i._viewRect.width=n,i._viewRect.height=s):i._viewRect={x:0,y:0,width:n,height:s};var r=i.getContext("2d");if(r.clearRect(0,0,n,s),dn.draw(r,this),0===this._view.clientWidth||0===this._view.clientHeight)return i;r.save(),r.scale(e,e),r.beginPath(),r.translate(-t.x,-t.y);var a=this.getElementBox().getDatas()._as,o=a.length;this._topAttachmentList=new De.List;var h,l,c,u,d,f,g=this.getElementBox().getLayerBox(),_=g.getRoots(),p=_.size();if(1===p)for(c=0;o>c;c++)u=a[c],this._visibleMap[u._id]&&(d=this._elementUIMap[u._id],null!=d&&Ge.intersects(t,d.getZoomViewRect())&&d.paint(r));else for(h=0;p>h;h++)for(l=_.get(h),c=0;o>c;c++)u=a[c],g.getLayerByElement(u)===l&&this._visibleMap[u._id]&&(d=this._elementUIMap[u._id],null!=d&&Ge.intersects(t,d.getZoomViewRect())&&d.paint(r));for(o=this._topAttachmentList.size(),c=0;o>c;c++)f=this._topAttachmentList.get(c),f.getElementUI().paintAttachment(r,f);return r.restore(),i},getGroupChildrenRects:function(t){return this.zoomManager._getGroupChildrenRects(t)},convertPointFromView:function(t){return this.zoomManager._convertPointFromView(t)},getOffset:function(t,e){return this.zoomManager._getOffset(t,e)},panToCenter:function(){this.setViewRect((this.realWidth-this.viewRect.width)/2,(this.realHeight-this.viewRect.height)/2,this.viewRect.width,this.viewRect.height)},moveElementsToCenter:function(){if(this._limitViewInCanvas){var t=this.viewRect,e=this._unionBounds,i=t.x+t.width/2-e.x-e.width/2,n=t.y+t.height/2-e.y-e.height/2;De.Util.moveElements(this._box.toDatas(),i,n)}else{var i=this.viewRect.width/2-this._unionBounds.width/2,n=this.viewRect.height/2-this._unionBounds.height/2;this.setViewRect(this._unionBounds.x-i,this._unionBounds.y-n,this.viewRect.width,this.viewRect.height)}},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(t){var e=this._linkPathFunction;this._linkPathFunction=t,this.firePropertyChange("linkPathFunction",e,t),this.invalidateElementUIs()},invalidate:function(){this._invalidate||(this._invalidate=!0,this.fireViewEvent({kind:"invalidate"}))},validate:function(){this._invalidate&&(Oe||0!==this._view.offsetWidth||0!==this._view.offsetHeight)&&(this._invalidate=!1,this._isValidating=!0,this.fireViewEvent({kind:"validateStart"}),this.validateImpl(),this.fireViewEvent({kind:"validateEnd"}),this._isValidating=!1)},onClickElement:function(t,e){},onClickBackground:function(t){},onDoubleClickElement:function(t,e){},onDoubleClickBackground:function(t){},onLongClickElement:function(t,e){},onLongClickBackground:function(t){},onMouseMove:function(t,e){},onMouseEnter:function(t,e){},onMouseLeave:function(t,e){},setMovingElement:function(t){if(t!=this._movingElement){var e=this._movingElement;this._movingElement=t,this.firePropertyChange("movingElement",e,t),this._box._undoManager._enabled&&(t?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},setEditingElement:function(t){if(t!=this._editingElement){var e=this._editingElement;this._editingElement=t,this.firePropertyChange("editingElement",e,t),this._box._undoManager._enabled&&(t?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},dispose:function(){De.imageUtil.removeEventListener(this.invalidateElementUIs,this),this.setInteractions(null),cancelAnimationFrame(this._loopId)}}),De.vector.Overview=function(t){De.vector.Overview.superClass.constructor.apply(this,t),this._view=je.createView(),this._rootDiv=je.createDiv(),this._imageCanvas=je.createCanvas(),this._imageDiv=je.createDiv(),this._maskCanvas=je.createCanvas(),this._selectDiv=je.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,je.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this._exportImageCanvas=je.createCanvas(),this._imageCtx=this._imageCanvas.getContext("2d"),this.setNetwork(t),He.isTouchable?He.isMSTouchable?new De.vector.OverviewMSTouchInteraction(this):(new De.vector.OverviewTouchInteraction(this),new De.vector.OverviewInteraction(this)):new De.vector.OverviewInteraction(this)},Be.ext("twaver.vector.Overview",De.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:kn.OVERVIEW_FILL_COLOR,_outlineColor:kn.OVERVIEW_OUTLINE_COLOR,_outlineWidth:kn.OVERVIEW_OUTLINE_WIDTH,_selectColor:kn.OVERVIEW_SELECT_COLOR,_selectWidth:kn.OVERVIEW_SELECT_WIDTH,_padding:kn.OVERVIEW_PADDING,_animate:kn.OVERVIEW_ANIMATE,_maxPackingWidth:kn.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:kn.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(t){this._invalidateMask()},setNetwork:function(t){t!==this._network&&(this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),je.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=t,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),je.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate())},_handleNetworkPropertyChange:function(t){("zoom"===t.property||"currentSubNetwork"===t.property||"elementBox"===t.property||"dataBox"===t.property||"canvasSizeChange"===t.property)&&this.invalidate()},_handleNetworkViewChange:function(t){"validateEnd"===t.kind&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(t){this._isNetworkDirty&&this._isMaskDirty||(this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),Be.callLater(this.validate,this,null,t))},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,Be.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&0!==this._network.getViewRect().width&&0!==this._network.getViewRect().height&&!this._network._invalidate){var t,e=this._maxPackingWidth>0&&this._maxPackingHeight>0;t=e?{x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:{x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},Ge.grow(t,-this._padding,-this._padding),e&&(je.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),t.width=this._imageDiv._viewRect.width,t.height=this._imageDiv._viewRect.height);var i=this._network.getGraphicsZoom(),n=this._network._unionBounds;n=Ge.unionRect(n,{x:0,y:0,width:n.x,height:n.y}),n={x:n.x/i,y:n.y/i,width:n.width/i,height:n.height/i};var s={x:this._network.viewRect.x/i,y:this._network.viewRect.y/i,width:this._network.viewRect.width/i,height:this._network.viewRect.height/i},r=Ge.unionRect(n,s),a=Math.min(t.width/r.width,t.height/r.height),o=r.width*a,h=r.height*a,l=r.width*a,c=r.height*a,u=t.x+(t.width-l)/2,d=t.y+(t.height-c)/2;if(this._isNetworkDirty){var f={x:u,y:d,width:l,height:c};this._network.toCanvas(o,h,this._exportImageCanvas,a,r.x*a,r.y*a),this._imageCanvas.setAttribute("width",l),this._imageCanvas.setAttribute("height",c),this._imageCtx.drawImage(this._exportImageCanvas,0,0,o,h),je.setDiv(this._imageDiv,f,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var g={x:(s.x-r.x)*a,y:(s.y-r.y)*a,width:s.width*a,height:s.height*a},_=je.setCanvas(this._maskCanvas,u,d,l,c);_.lineWidth=0,_.fillStyle=this._fillColor,qe.drawVector(_,"rectangle",null,u,d,l,c),_.closePath(),_.fill(),_.stroke(),_.clearRect(u+g.x,d+g.y,g.width,g.height),_.lineWidth=this._outlineWidth,_.strokeStyle=this._outlineColor;var p=g.width-2*this._outlineWidth,v=g.height-2*this._outlineWidth;p=Math.min(p,l-2-g.x-this._outlineWidth),v=Math.min(v,c-2-g.y-this._outlineWidth),qe.drawVector(_,"rectangle",null,u+g.x+this._outlineWidth,d+g.y+this._outlineWidth,p,v),_.closePath(),_.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(t){return je.getLogicalPoint(this._view,t,1,this._rootDiv)},centerNetwork:function(t,e){var i=this._imageDiv._viewRect;if(Ge.containsPoint(i,t)){var n=this._network.getGraphicsZoom(),s=this._network._unionBounds;s=Ge.unionRect(s,{x:0,y:0,width:s.x,height:s.y}),s={x:s.x/n,y:s.y/n,width:s.width/n,height:s.height/n};var r={x:this._network.viewRect.x/n,y:this._network.viewRect.y/n,width:this._network.viewRect.width/n,height:this._network.viewRect.height/n},a=Ge.unionRect(s,r);this._network.centerByLogicalPoint((t.x-i.x)/i.width*a.width*n,(t.y-i.y)/i.height*a.height*n,e),this._invalidateMask()}}}),De.vector.OverviewTouchInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,je.addEventListener("touchstart","handleTouchstart",this.view,this)},Be.ext("twaver.vector.OverviewTouchInteraction",Object,{handleTouchstart:function(t){je.preventDefault(t),this.clear(),this.endPoint=this.overview.getLogicalPoint(t),Ci.isMultiTouch(t)&&(this.distance=Ci.getDistance(t),this.zoom=this.network.getZoom()),je.addEventListener("touchmove","handleTouchmove",this.view,this),je.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(t){if(this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(t),Ci.isSingleTouch(t))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var e=Ci.getDistance(t)/this.distance;this.network.setZoom(this.zoom*e,!1)}},handleTouchend:function(t){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(t);var e=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;e?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),e?Be.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,je.removeEventListener("touchmove",this.view,this),je.removeEventListener("touchend",this.view,this)),this.moved=!1}}),De.vector.OverviewMSTouchInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,this._pointerMap={},this._pointerIdArray=[],je.addEventListener("MSPointerDown","handleTouchstart",this.view,this),je.addEventListener("MSPointerMove","handleTouchmove",this.view,this),je.addEventListener("MSPointerUp","handleTouchend",this.view,this),je.addEventListener("MSPointerCancel","handleTouchend",this.view,this)},Be.ext("twaver.vector.OverviewMSTouchInteraction",Object,{handleTouchstart:function(t){je.preventDefault(t),t.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[t.pointerId]&&this.overview.getLogicalPoint(t)&&(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t),1==this._pointerIdArray.length?(this._startTouchPoint=this.overview.getLogicalPoint(t),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(t){if(0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(Ge.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=10))if(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length){var e=this._getDistance()/this._distance;this.network.setZoom(this._zoom*e,!1)}else if(1==this._pointerIdArray.length&&this._startTouchPoint){var i=this.overview.getLogicalPoint(t);if(null==i)return;this._startTouchPoint=i,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(t){var e=this.overview.getLogicalPoint(t);if(1==this._pointerIdArray.length&&e){var i=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&Ge.getDistance(this._endTouchPoint,e)<=10;i?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=e,this._endTouchTime=new Date),i?Be.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Ge.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),De.vector.OverviewInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,je.addEventListener("mousedown","handleMousedown",this.view,this)},Be.ext("twaver.vector.OverviewInteraction",Object,{handleMousedown:function(t){this.clear(),this.endPoint=this.overview.getLogicalPoint(t),Be.isCtrlDown(t)&&(this.startPoint=this.endPoint,je.setVisible(this.overview._selectDiv,!0)),je.addEventListener("mousemove","handleMousemove",this.view,this),je.addEventListener("mouseup","handleMouseup",this.view,this)},handleMouseup:function(t){if(this.endPoint=this.overview.getLogicalPoint(t),"detail"in t&&2===t.detail)Be.callLater(this.network.zoomReset,this.network,[this.endPoint,this.overview._animate]);else if(je.isVisible(this.overview._selectDiv)&&this.startPoint){var e=this.overview._imageDiv._viewRect,i=this.overview._selectDiv._viewRect.x,n=this.overview._selectDiv._viewRect.y,s=e.width/this.overview._selectDiv._viewRect.width,r=e.height/this.overview._selectDiv._viewRect.height,a=Math.min(s,r);this.network.setZoom(a*Math.min(this.network.getViewRect().width/this.network.getCanvasSize().width,this.network.getViewRect().height/this.network.getCanvasSize().height)*this.network.getZoom(),!1);var o=this.network.getCanvasSize().width*((i-e.x+this.overview._selectDiv._viewRect.width/2)/e.width),h=this.network.getCanvasSize().height*((n-e.y+this.overview._selectDiv._viewRect.height/2)/e.height);Be.callLater(this.network.centerByLogicalPoint,this.network,[o,h,this.overview._animate]),je.setVisible(this.overview._selectDiv,!1),je.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(t){var e=this.overview.getLogicalPoint(t);if(this.endPoint=e,je.isVisible(this.overview._selectDiv)&&this.startPoint){var i=e.x>this.startPoint.x?this.startPoint.x:e.x,n=e.x>this.startPoint.x?this.startPoint.y:e.y;e.x>this.startPoint.x&&e.y<this.startPoint.y&&(n=e.y),e.x<this.startPoint.x&&e.y>this.startPoint.y&&(n=this.startPoint.y);var s=this.overview._imageDiv._viewRect;i<s.x&&(i=s.x),i>s.x+s.width&&(i=s.x+s.width),n<s.y&&(n=s.y),n>s.y+s.height&&(n=s.y+s.height);var r=Math.abs(e.x-this.startPoint.x),a=Math.abs(e.y-this.startPoint.y);i+r>s.x+s.width&&(r=s.x+s.width-i),n+a>s.y+s.height&&(a=s.y+s.height-n),je.setDiv(this.overview._selectDiv,{x:i,y:n,width:r,height:a},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(e,!1)},clear:function(){this.endPoint&&(this.endPoint=null,je.removeEventListener("mousemove",this.view,this),je.removeEventListener("mouseup",this.view,this))}}),De.vector.ElementUI=function(t,e){this._network=t,this._element=e,this._attachments=new De.List,this._bodyBounds=new De.List,this._hitTest=!1,this._hitTest=!1,this._intersectTest=!1,this.invalidate(!0)},Be.ext("twaver.vector.ElementUI",Object,{getElement:function(){return this._element},getNetwork:function(){return this._network},handlePropertyChange:function(t){},handleSelectionChange:function(t){},invalidate:function(t){t===e&&(t=!0),t&&(this._invalidateAttachmentsFlag=!0),this._invalidateFlag||(this._hotSpot=null,this._bodyRect=null,this._invalidateFlag=!0,this.invalidateZoom(),this.setAttachmentVisible&&this.setAttachmentVisible(!1))},invalidateZoom:function(){this._zoomBodyRect=null,this._zoomViewRect=null,this._zoomHotSpot=null},updateStyle:function(){this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._glowBlur=this._element.getStyle("glow.blur"),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this._wholeAlpha=this._element.getStyle("whole.alpha")},validate:function(){var t=this;if(0!=this._invalidateFlag){this._bodyBounds.clear(),this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this.updateStyle(),this.validateImpl(),this._attachments.forEach(function(t){t.validate()});var e;this._bodyBounds.forEach(function(t){e=Ge.unionRect(e,t)}),null==e&&(e=Be.cloneRect(this._element.getLocation()),e.width=0,e.height=0),this._unionBodyBounds={x:e.x,y:e.y,width:e.width,height:e.height},this._attachments.forEach(function(i){e=i instanceof De.vector.EditAttachment?i.getElementUI()instanceof De.vector.LinkUI?Ge.unionRect(e,i._viewRect):Ge.unionRect(e,t._network.zoomManager._reverseElementZoomRect(t,i._viewRect)):i.getElementUI()instanceof De.vector.LinkUI?Ge.unionRect(e,t._network.zoomManager._getAttachmentZoomOutLineRect(i,i._viewRect)):i.getElementUI()instanceof De.vector.GroupUI&&i.getElementUI()._shapeRect?i instanceof De.vector.IconsAttachment?Ge.unionRect(e,i._viewRect):Ge.unionRect(e,t._network.zoomManager._getAttachmentZoomOutLineRect(i,i._viewRect)):Ge.unionRect(e,i._viewRect);
}),this._viewRect=e}},validateImpl:function(){},setGlow:function(t,e){"glow"===this._element.getStyle("outer.style")&&(e.shadowColor=this._outerColor,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=this._glowBlur)},clearGlow:function(t){(0!=t.shadowOffsetX||0!=t.shadowOffsetY||0!=t.shadowBlur)&&(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0)},setShadow:function(t,e){var i=this._network.zoomManager,n=t.isShadowable()&&this._shadowColor&&!this._editAttachment;if(e.shadowOffsetX===this._shadowXOffset&&e.shadowOffsetY===this._shadowYOffset&&e.shadowBlur===this._shadowBlur)return e;if(n||this._network._showShadowInEdit){var s=i.getGraphicsZoom(),r=i.getSizeZoom();s*=r,s>1&&(s=1),e.shadowOffsetX=this._shadowXOffset*s,e.shadowOffsetY=this._shadowYOffset*s,e.shadowBlur=this._shadowBlur*s,e.shadowColor=this._shadowColor}return e},clearShadow:function(t){(0!=t.shadowOffsetX||0!=t.shadowOffsetY||0!=t.shadowBlur)&&(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0)},appendShadowBound:function(t,e){var i=t.isShadowable()&&this._shadowColor&&!this._editAttachment;if(i){var n=this._network.zoomManager,s=n.getGraphicsZoom(),r=n.getSizeZoom();s*=r,s>1&&(s=1),this._shadowXOffset>0?e.width+=this._shadowXOffset:(e.x+=this._shadowXOffset,e.width+=-this._shadowXOffset),this._shadowYOffset>0?e.height+=this._shadowYOffset:(e.y+=this._shadowYOffset,e.height+=-this._shadowYOffset);var a=this._shadowBlur;a=Math.ceil(a/s),Ge.grow(e,a+1,a+1)}return e},appendGlowBound:function(t,e){if("glow"===this._element.getStyle("outer.style")){var i=this._network.zoomManager,n=i.getGraphicsZoom(),s=i.getSizeZoom();n*=s,n>1&&(n=1);var r=this._glowBlur;r=Math.ceil(r/n),Ge.grow(e,r+1,r+1)}},isShadowable:function(){return!(!this._shadowColor||!this._network.isSelected(this._element)||"shadow"!==this._element.getStyle("select.style"))},addAttachment:function(t){this._attachments.add(t),this.invalidate(!1)},removeAttachment:function(t){this._attachments.remove(t),this.invalidate(!1)},getAttachments:function(){return this._attachments},checkAttachments:function(){this.checkLabelAttachment(),this.checkLabel2Attachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var t=this._network.getLabel(this._element);null!=t&&""!==t?this._labelAttachment||(this._labelAttachment=new De.vector.LabelAttachment(this,kn.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkLabel2Attachment:function(){var t=this._network.getLabel2(this._element);null!=t&&""!==t?this._label2Attachment||(this._label2Attachment=new De.vector.Label2Attachment(this,kn.SHOW_LABEL2_IN_ATTACHMENT_DIV),this.addAttachment(this._label2Attachment)):this._label2Attachment&&(this.removeAttachment(this._label2Attachment),this._label2Attachment=null)},checkAlarmAttachment:function(){var t=this._network.getAlarmLabel(this._element);null!=t&&""!==t?this._alarmAttachment||(this._alarmAttachment=new De.vector.AlarmAttachment(this,kn.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var t=this._network.getIconsNames(this._element);t&&t.length>0?this._iconsAttachment||(this._iconsAttachment=new De.vector.IconsAttachment(this,kn.SHOW_ICON_IN_ATTACHMENT_DIV),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)&&this.isEditable()?this._editAttachment||(this._editAttachment=new De.vector.EditAttachment(this,kn.SHOW_EDIT_IN_ATTACHMENT_DIV),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},isEditable:function(){return!0},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getDyeColor:function(t){return this._innerColor?this._innerColor:this.getStyle(t)},getStyle:function(t){return this._element.getStyle(t)},getFont:function(t){var e=this._element.getStyle(t);return e?e:De.Defaults.FONT},paint:function(t){t.save(),t.globalAlpha=this._wholeAlpha,t.beginPath(),this.paintBody(t),this.clearShadow(t),this.clearGlow(t),t.closePath(),t.beginPath(),this.paintAttachments(t),t.closePath(),t.restore(),this._network._debug&&qe.strokeRect(t,this.getZoomViewRect(),"orange")},paintBody:function(t){},getZoomBodyRect:function(t){return this._network.zoomManager._getElementZoomRect(this,this.getBodyRect())},getZoomHotSpot:function(){return this._zoomHotSpot||(this._zoomHotSpot=this._network.zoomManager._getZoomHotSpot(this,this._hotSpot)),Be.clone(this._zoomHotSpot)},getZoomPointers:function(t,e){return this._network.zoomManager._getZoomPointers(t,this,e)},_getZoomViewRect:function(t,e,i){var n=this._network.zoomManager;if(e){var s=Be.cloneRect(n._getAttachmentZoomRect(e,t));return s}var r=n.getLocationZoom(),a=n.getSizeZoom(this),o=this._bodyRect?this._bodyRect:this.getBodyRect();t=t||{x:o.x,y:o.y,width:0,height:0};var h=o.x+o.width/2,l=o.y+o.height/2;return{x:h*r+(t.x-h)*a,y:l*r+(t.y-l)*a,width:t.width*a,height:t.height*a}},getZoomViewRect:function(t){var e=this._network.zoomManager,i=e.getLocationZoom();if(e.getGraphicsZoom(),1==i)return Be.cloneRect(this._viewRect);if(!this._zoomViewRect||t){var n,s=this._getZoomViewRect(Be.cloneRect(this._unionBodyBounds),!1);n=Ge.unionRect(n,s),this._attachments.forEach(function(t){n=t instanceof De.vector.EditAttachment?Ge.unionRect(n,t._viewRect):Ge.unionRect(n,t.getZoomViewRect())}),this._zoomViewRect=n}return Be.cloneRect(this._zoomViewRect)},paintAttachments:function(t){t.beginPath();for(var e=this._attachments.size(),i=0;e>i;i++){var n=this._attachments.get(i);1==this._hitTest&&0==n.isShowOnTop()&&this.paintAttachment(t,n),1==this._intersectTest&&this.paintAttachment(t,n),0==this._hitTest&&0==this._intersectTest&&(n.isShowOnTop()?this._network._topAttachmentList.add(n):this.paintAttachment(t,n))}},paintAttachment:function(t,e){var i=this._network.zoomManager;i.isAttachmentVisible(this._element)&&(e!=this._labelAttachment&&e!=this._label2Attachment||i.isLabelVisible(this._element))&&(e!=this._alarmAttachment||i.isAlarmBalloonVisible(this._element))&&(t.beginPath(),e.paint(t),this.clearShadow(t))},getViewRect:function(){return Be.cloneRect(this._viewRect)},getUnionBodyBounds:function(){return Be.cloneRect(this._unionBodyBounds)},addBodyBounds:function(t){t&&this._bodyBounds.add(t)},getBodyRect:function(t){return t==e&&(t=!0),this._bodyRect||(this._bodyRect=this.createBodyRect()),t?Be.cloneRect(this._bodyRect):this._bodyRect},getHotSpot:function(){return this._hotSpot?Be.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(t){this._hotSpot=t},hit:function(t,e){return!1},intersects:function(t){return!!Ge.contains(t,this.getZoomViewRect())},hitCanvasRectAtBody:function(t){var e=Un.getHitCanvas(t.width,t.height),i=Un.getCtx(e);if(i.save(),i.translate(-t.x,-t.y),this._element.getImage){var n=Be.getImageAsset(this._element.getImage());if(n&&n.getImage()instanceof Dn)return 1}this.paintBody(i);try{for(var s=i.getImageData(0,0,t.width,t.height),r=s.data,a=0;a<s.width;a++)for(var o=0;o<s.height;o++){var h=4*(o*s.width+a),l=r[h+3];if(0!==l)return i.restore(),1}}catch(c){if(Un.disposeHitCanvas(),Ge.contains(this.getUnionBodyBounds(),t))return 0}return i.restore(),-1},hitCanvasRectAtAttachments:function(t){var e=Un.getHitCanvas(t.width,t.height),i=Un.getCtx(e);i.save(),i.translate(-t.x,-t.y),this.paintAttachments(i);try{for(var n=i.getImageData(0,0,t.width,t.height),s=n.data,r=0;r<n.width;r++)for(var a=0;a<n.height;a++){var o=4*(a*n.width+r),h=s[o+3];if(0!==h)return i.restore(),1}}catch(l){Un.disposeHitCanvas()}return i.restore(),-1},hitCanvasRect:function(t){this._intersectTest=!0,1==this._hitTest&&(this._intersectTest=!1);var e=Ge.intersection(t,this.getZoomViewRect()),i=this.hitCanvasRectAtBody(e);if(1==i)return this._intersectTest=!1,!0;var n=this.hitCanvasRectAtAttachments(e);return 1==n?(this._intersectTest=!1,!0):(this._intersectTest=!1,0==i)},hitCanvasPoint:function(t,e){var i={x:t,y:e,width:0,height:0},n=this._network.getSelectionTolerance();if(n&&n>0&&Ge.grow(i,n,n),!Ge.intersects(this.getZoomViewRect(),i))return!1;this._hitTest=!0;var s=this.hitCanvasRect(i);return this._hitTest=!1,s},hitTest:function(t,e){var i={x:t,y:e,width:0,height:0},n=this._network.getSelectionTolerance();if(n&&n>0&&Ge.grow(i,n,n),!Ge.intersects(this.getZoomViewRect(),i))return null;for(var s=Ge.intersection(i,this.getZoomViewRect()),r=this._attachments.size(),a=0;r>a;a++){var o=this._attachments.get(a);if(o.hit(t,e))return o}var h=this.hitCanvasRectAtBody(s);return 1==h?this:0==h?this:null},dispose:function(){this._attachments.forEach(function(t){t.dispose()}),this._attachments.clear()}}),De.vector.NodeUI=function(t,e){De.vector.NodeUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.vector.NodeUI",De.vector.ElementUI,{invalidate:function(t){this.curInterval&&clearInterval(this.curInterval),De.vector.NodeUI.superClass.invalidate.call(this,t)},createBodyRect:function(){return this._element.getRect()},validateImpl:function(){De.vector.NodeUI.superClass.validateImpl.call(this);var t=this.getStyle("vector.shape"),e=this.getBodyRect();this._hotSpot=Ge.getHotSpot(e.x,e.y,e.width,e.height,t),this.validateBodyBounds()},validate:function(){0!=this._invalidateFlag&&De.vector.NodeUI.superClass.validate.call(this)},validateBodyBounds:function(){var t=this.getStyle("body.type");"default"===t?this.addBodyBounds(this.getDefaultBodyRect()):"vector"===t?this.addBodyBounds(this.getVectorBody()):"default.vector"===t?(this.addBodyBounds(this.getVectorBody()),this.addBodyBounds(this.getDefaultBodyRect())):"vector.default"===t&&(this.addBodyBounds(this.getDefaultBodyRect()),this.addBodyBounds(this.getVectorBody())),this._outerColor&&"border"===this.getStyle("outer.style")&&this.addBodyBounds(this.getOuterBorderRect()),!this._editAttachment&&"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.addBodyBounds(this.getSelectBorderRect())},getDefaultBodyRect:function(){var t=this._element,e=this.getBodyRect();if(!t.getImage()||"string"==typeof t.getImage()&&!Be.getImageAsset(t.getImage()))return e;Ge.addPadding(e,this._element,"image.padding",1);var i=Be.cloneRect(e);return this.appendGlowBound(this,i),this.appendShadowBound(this,i),e=i},getVectorBody:function(){var t=this.getPathRect("vector");return t},getOuterBorderRect:function(){return this._getBorderRect("outer")},getSelectBorderRect:function(){return this._getBorderRect("select")},_getBorderRect:function(t){var e=this._element,i=e.getStyle(t+".width");if(i>0){var n=this.getBodyRect();Ge.addPadding(n,e,t+".padding",1);var s=Be.cloneRect(n);return Ge.grow(s,2*i,2*i),s}return null},getPathRect:function(t,e){var i=this._element,n=this.getBodyRect();this._network.zoomManager.getSizeZoom(),e&&Ge.addPadding(n,i,t+".padding",1);var s=Be.cloneRect(n),r=i.getStyle(t+".outline.width");if(r>0)if(this._getZoomPoints){for(var a=this._element._points,o=a.size(),h=0,l=0;o>l;l++){if(0==l)var c=a.get(l),u=a.get(o-1),d=a.get(l+1);else if(l==o-1)var c=a.get(l),u=a.get(l-1),d=a.get(0);else var c=a.get(l),u=a.get(l-1),d=a.get(l+1);var f=Ge.getCenterPoint(u,d),g=Ge.getAngle(f,c),_=Math.abs(5*(r+1)*Math.sin(g));h=_>h?_:h,_=Math.abs(5*(r+1)*Math.cos(g)),h=_>h?_:h}Ge.grow(s,h,h)}else Ge.grow(s,r/2,r/2);return this.appendGlowBound(this,s),this.appendShadowBound(this,s),s},getZoomPathRect:function(t,e){var i=this._element,n=this.getZoomBodyRect();this._network.zoomManager.getSizeZoom(),e&&Ge.addPadding(n,i,t+".padding",1);var s=Be.cloneRect(n),r=i.getStyle(t+".outline.width");if(r>0)if(this._getZoomPoints){for(var a=this._getZoomPoints(),o=a.size(),h=0,l=0;o>l;l++){if(0==l)var c=a.get(l),u=a.get(o-1),d=a.get(l+1);else if(l==o-1)var c=a.get(l),u=a.get(l-1),d=a.get(0);else var c=a.get(l),u=a.get(l-1),d=a.get(l+1);var f=Ge.getCenterPoint(u,d),g=Ge.getAngle(f,c),_=Math.abs(5*(r+1)*Math.sin(g));h=_>h?_:h,_=Math.abs(5*(r+1)*Math.cos(g)),h=_>h?_:h}Ge.grow(s,h,h)}else Ge.grow(s,r/2,r/2);return this.appendGlowBound(this,s),this.appendShadowBound(this,s),s},paintBody:function(t){if(this._network.hasEditInteraction()&&this._network.isEditable(this._element)&&this.isEditable()&&this._network.isSelected(this._element)){var e,i=this._network.getElementBox(),n=i.getDatas();for(e=0;e<n.size();e++)if(n.get(e)instanceof De.Link){var s=n.get(e).getToNode(),r=n.get(e).getFromNode();i.adjustElementIndex(r),i.adjustElementIndex(s)}}this.curInterval&&clearInterval(this.curInterval);var a=this.getStyle("body.type");"default"===a?this.drawDefaultBody(t):"vector"===a?this.drawVectorBody(t):"default.vector"===a?(this.drawVectorBody(t),this.drawDefaultBody(t)):"vector.default"===a&&(this.drawDefaultBody(t),this.drawVectorBody(t)),this._outerColor&&"border"===this.getStyle("outer.style")&&this.drawOuterBorder(t),"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.drawSelectBorder(t)},drawOuterBorder:function(t){var e=this._element,i=e.getStyle("outer.width");if(i>0){var n=this.getZoomBodyRect();Ge.addPadding(n,e,"outer.padding",1),t.lineWidth=i,t.lineCap=e.getStyle("outer.cap"),t.lineJoin=e.getStyle("outer.join"),t.strokeStyle=this._outerColor,qe.drawVector(t,e.getStyle("outer.shape"),null,n),t.stroke()}},drawDefaultBody:function(t){var e,i=this._element;if(i.getImage()&&("string"!=typeof i.getImage()||(e=Be.getImageAsset(i.getImage())))){var n=this.getZoomBodyRect();if(Ge.addPadding(n,this._element,"image.padding",1),0!=i.getAngle()&&(t.save(),n=i.getOriginalRect(),n=this._network.zoomManager._getElementZoomRect(this,n),De.Util.rotateCanvas(t,n,i.getAngle())),this.setGlow(this,t),this.setShadow(this,t),e&&e.getImage()instanceof Dn){var s,r=e.getImage().frames,a=e.getImage().size,o=0;s=Nn(r,a,0),t.drawImage(s,n.x,n.y,n.width,n.height),this.curInterval=setInterval(function(){o=(o+r.length)%r.length,s=Nn(r,a,o),t.drawImage(s,n.x,n.y,n.width,n.height),o++},100)}else Fi(t,i.getImage(),this.getInnerColor(),n,i,this._network);0!=i.getAngle()&&t.restore()}},drawSelectBorder:function(t){this.clearGlow(t);var e=this._element,i=e.getStyle("select.width");if(i>0){var n=this.getZoomBodyRect();n=Be.cloneRect(n);var s=e.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();Ge.addPadding(n,e,"select.padding",1/s),Ge.grow(n,i/2/s,i/2/s),t.lineWidth=i/s,t.lineCap=e.getStyle("select.cap"),t.lineJoin=e.getStyle("select.join"),t.strokeStyle=e.getStyle("select.color"),qe.drawVector(t,e.getStyle("select.shape"),null,n),t.stroke()}},drawVectorBody:function(t){this.drawPath(t,"vector",!0,this._element.getStyle("vector.outline.pattern"));var e=this.getStyle("vector.deep"),i=this.getStyle("vector.fill.color");if(0!==e&&i&&"rectangle"===this.getStyle("vector.shape")){var n=this.getZoomBodyRect(),s=this._element.getAngle();if(0!=s){t.save();var r=this._element.getOriginalRect();r=this._network.zoomManager._getElementZoomRect(this,r),De.Util.rotateCanvas(t,r,s)}qe.draw3DRect(t,i,e,n),0!=s&&t.restore()}},drawPath:function(t,e,i,n,s,r,a){var o=this._network.zoomManager,h=this._element,l=null;l="group"==e?this._shapeRect:this.getZoomBodyRect(),i&&Ge.addPadding(l,h,e+".padding",1);var c=h.getStyle(e+".outline.width");this.setGlow(this,t),this.setShadow(this,t),0!=h.getAngle()&&(h instanceof Vn||(l=h.getOriginalRect(),l=o._getElementZoomRect(this,l)),t.save(),De.Util.rotateCanvas(t,l,h.getAngle()));var u,d=h.getStyle(e+".fill");if(d){u=this._innerColor&&!xi.hasDefault(this._element)?this._innerColor:h.getStyle(e+".fill.color");var f=h.getStyle(e+".gradient");f?qe.fill(t,u,f,h.getStyle(e+".gradient.color"),l):t.fillStyle=u}var g=h.getStyle(e+".shape"),_=h.getStyle("group.shape.roundrect.radius");d&&(t.beginPath(),s?qe.drawLinePoints(t,s,null,r,a):"roundrect"===g&&"group"===e?qe.drawVector(t,g,null,l,_):qe.drawVector(t,g,null,l),t.fill()),c>0&&(t.lineWidth=c,t.lineCap=h.getStyle(e+".cap"),t.lineJoin=h.getStyle(e+".join"),t.strokeStyle=h.getStyle(e+".outline.color"),t.beginPath(),s?qe.drawLinePoints(t,s,n,r,a):"roundrect"===g&&"group"===e?qe.drawVector(t,g,n,l,_):qe.drawVector(t,g,n,l),t.stroke()),0!=h.getAngle()&&t.restore()},hit:function(t,e){var i={x:t,y:e,width:0,height:0},n=this._network.getSelectionTolerance();if(n&&n>0&&Ge.grow(i,n,n),this._network._transparentSelectionEnable){var s=this.getBodyRect();if(Be.math.intersects(s,i))return!0}return!!Ge.intersects(this.getZoomViewRect(),i)&&this.hitCanvasPoint(t,e)},intersects:function(t){var e=De.vector.NodeUI.superClass.intersects.apply(this,arguments);if(1==e)return!0;if(this._network._transparentSelectionEnable){var i=this.getBodyRect();if(Be.math.intersects(i,t))return!0}return!!Ge.intersects(t,this.getZoomViewRect())&&this.hitCanvasRect(t)}}),De.vector.LinkUI=function(t,e){De.vector.LinkUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.vector.LinkUI",De.vector.ElementUI,{isEditable:function(){return!0},invalidate:function(t){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,this._angle=null,De.vector.LinkUI.superClass.invalidate.call(this,t)},invalidateZoom:function(){this._fromPoint=null,this._toPoint=null,this._linkPoints=null,De.vector.LinkUI.superClass.invalidateZoom.call(this)},validateImpl:function(){this.validateBodyBounds(),De.vector.LinkUI.superClass.validateImpl.call(this)},validateBodyBounds:function(){var t=this.getLinkPoints();if(t&&!(t.size()<2)){var e=this._element,i=Ge.getLineRect(t),n=e.getStyle("link.width"),s=n;if(this._outerColor){var r=e.getStyle("outer.width");s+=2*r}var a=!this._editAttachment&&"border"===e.getStyle("select.style")&&this._network.isSelected(this._element);if(a){var o=e.getStyle("select.width");s+=2*o}Ge.grow(i,s/2,s/2),e.getStyle("arrow.from")&&(this._network._edgeDetect?(this._network._debug&&(this._arrowFromRect=_n.getArrowRect(this,t,!0,e.getStyle("arrow.from.shape"),e.getStyle("arrow.from.width"),e.getStyle("arrow.from.height"),0,0,this._network.zoomManager)),i=Ge.unionRect(i,_n.getArrowRect(this,t,!0,e.getStyle("arrow.from.shape"),e.getStyle("arrow.from.width"),e.getStyle("arrow.from.height"),0,0,this._network.zoomManager))):(this._network._debug&&(this._arrowFromRect=_n.getArrowRect(this,t,!0,e.getStyle("arrow.from.shape"),e.getStyle("arrow.from.width"),e.getStyle("arrow.from.height"),e.getStyle("arrow.from.xoffset"),e.getStyle("arrow.from.yoffset"),this._network.zoomManager)),i=Ge.unionRect(i,_n.getArrowRect(this,t,!0,e.getStyle("arrow.from.shape"),e.getStyle("arrow.from.width"),e.getStyle("arrow.from.height"),e.getStyle("arrow.from.xoffset"),e.getStyle("arrow.from.yoffset"),this._network.zoomManager)))),e.getStyle("arrow.to")&&(this._network._edgeDetect?(this._network._debug&&(this._arrowToRect=_n.getArrowRect(this,t,!1,e.getStyle("arrow.to.shape"),e.getStyle("arrow.to.width"),e.getStyle("arrow.to.height"),0,0,this._network.zoomManager)),i=Ge.unionRect(i,_n.getArrowRect(this,t,!1,e.getStyle("arrow.to.shape"),e.getStyle("arrow.to.width"),e.getStyle("arrow.to.height"),0,0,this._network.zoomManager))):(this._network._debug&&(this._arrowToRect=_n.getArrowRect(this,t,!1,e.getStyle("arrow.to.shape"),e.getStyle("arrow.to.width"),e.getStyle("arrow.to.height"),e.getStyle("arrow.to.xoffset"),e.getStyle("arrow.to.yoffset"),this._network.zoomManager)),i=Ge.unionRect(i,_n.getArrowRect(this,t,!1,e.getStyle("arrow.to.shape"),e.getStyle("arrow.to.width"),e.getStyle("arrow.to.height"),e.getStyle("arrow.to.xoffset"),e.getStyle("arrow.to.yoffset"),this._network.zoomManager)))),this.appendShadowBound(this,i),this.addBodyBounds(i),this._growLinkJoinBounds(i,s)}},_growLinkJoinBounds:function(t,e){},createBodyRect:function(){var t=this.getHotSpot();return t?{x:t.x-1,y:t.y-1,width:2,height:2}:null},paintBody:function(t){if(this._network.hasEditInteraction()&&this._network.isEditable(this._element)&&this.isEditable()){if(this._network.isSelected(this._element)){var e,i,n=this._network.getElementBox(),s=n.getDatas();for(i=0;i<s.size();i++)if(s.get(i)instanceof De.Link){var r=s.get(i).getToNode(),a=s.get(i).getFromNode();n.adjustElementIndex(a),n.adjustElementIndex(r)}e=n.getDatas().indexOf(this._element),n.getDatas().removeAt(e),n.getDatas().add(this._element)}}else if(this._network.isSelected(this._element)){var n=this._network.getElementBox(),r=this._element.getToNode(),a=this._element.getFromNode();n.adjustElementIndex(a),n.adjustElementIndex(r)}var o=this.getLinkPoints();if(o&&!(o.size()<2)){var h=this._element,l=h.getStyle("link.width"),c=l;if(this._outerColor&&"border"===this.getStyle("outer.style")){var u=h.getStyle("outer.width");c+=2*u}var d=!this._editAttachment&&"border"===h.getStyle("select.style")&&this._network.isSelected(this._element);if(d){var f=h.getStyle("select.width");c+=2*f}this.setGlow(this,t),this.setShadow(this,t),t.lineCap=h.getStyle("link.cap"),t.lineJoin=h.getStyle("link.join");var g=h.getStyle("link.pattern");d&&this.drawLinePoints(t,o,c,h.getStyle("select.color"),g),this._outerColor&&"border"===this.getStyle("outer.style")&&this.drawLinePoints(t,o,l+2*u,this._outerColor,g),this.drawLinePoints(t,o,l,this._innerColor||h.getStyle("link.color"),g),_n.drawLinkArrow(this,t,o,this._network.zoomManager)}},drawLinePoints:function(t,e,i,n,s){if(t.lineWidth=i,t.strokeStyle=n,this._element.getStyle("link.flow")===!0&&s&&s.length>1){var r=new Ai(t,s[0],s[1]),a=this._element.getStyle("link.flow.offset"),o=Math.floor(a/(s[0]+s[1]));o>2&&(a-=(s[0]+s[1])*o),this._element.getStyle("link.flow.converse")?a<s[0]?r.overflow=s[0]-a:a>=s[0]&&a<=s[0]+s[1]?(r.overflow=s[1]-(a-s[0]),r.overflow&&(r.isLine=!1)):(a-=s[0]+s[1],r.overflow=s[0]-a):a<=s[1]?(r.overflow=a,a&&(r.isLine=!1)):a>s[1]&&a<=s[0]+s[1]?r.overflow=a-s[1]:(a-=s[0]+s[1],a&&(r.isLine=!1),r.overflow=a),this._element._styleMap["link.flow.offset"]=a,t.beginPath(),qe._drawLine(e,t),t.stroke(),t.shadowColor="transparent",t.beginPath();var h=this._element.getStyle("link.flow.color");h=h?h:kn.NETWORK_LINK_FLOW_COLOR,t.strokeStyle=h,qe._drawLine(e,r),t.stroke(),t.shadowColor=this._shadowColor}else t.beginPath(),qe.drawLinePoints(t,e,s),t.stroke()},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=Ge.calculateLineLength(this._linkPoints)),this._linkPoints},getFromPosition:function(t,e){var i=this.getFromPoint();return i?{x:i.x+t,y:i.y+e}:null},getToPosition:function(t,e){var i=this.getToPoint();return i?{x:i.x+t,y:i.y+e}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=bi.createFromPoint(this,this._network.zoomManager)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=bi.createToPoint(this,this._network.zoomManager)),this._toPoint},getZoomBodyRect:function(){return this.getBodyRect()},getZoomViewRect:function(){return this._viewRect},createLinkPoints:function(){var t=this._network.zoomManager,e=this.getStyle("link.type"),i=new De.List;if(bi.isOrthogonalOrFlexionalLink(this._element))i=bi.orthogonalAndFlexional(this,e,t);else if(this._element.isLooped()){var n=this._network.getElementUI(this._element.getFromAgent());null!=n&&(this._hotSpot=bi.fillLoopedPoints(this,n.getZoomBodyRect(),i))}else{if("arc"!==e&&"triangle"!==e&&"parallel"!==e)throw"Can not resolve link type '"+e+"'";var s=this.getFromPoint(),r=this.getToPoint();this._hotSpot=bi.fillBundlePoints(this,e,s,r,i,t)}if(this._network._linkPathFunction){var a=this._network._linkPathFunction(this,i);a&&(i=a)}return i},checkAttachments:function(){De.vector.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var t=this._network.getLinkHandlerLabel(this._element);null!=t&&""!==t?this._linkHandlerAttachment||(this._linkHandlerAttachment=new De.vector.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getControlPoint:function(){return bi.getControlPoint(this._element,this,this._network.zoomManager)},setControlPoint:function(t){if(t){var e=this.getStyle("link.type");if(bi.hasControlPoint(e)){var i=bi.getLinkSourceBounds(this,this._network.zoomManager),n=bi.getLinkTargetBounds(this,this._network.zoomManager);bi.setParamsByControlPoint(t,i,n,e,this._element)}}},getLineLength:function(){return this._lineLength},hit:function(t,e){var i={x:t,y:e,width:0,height:0},n=this._network.getSelectionTolerance();return n&&n>0&&Ge.grow(i,n,n),!!Ge.intersects(this._viewRect,i)&&this.hitCanvasPoint(t,e)},intersects:function(t){var e=De.vector.NodeUI.superClass.intersects.apply(this,arguments);if(1==e)return!0;if(0==Ge.intersects(t,this._viewRect))return!1;var i=this.getLinkPoints(),n=i.size();if(2==n)for(var s=0;n>s;s+=2){var r=i.get(s);if(n>s+1){var a=i.get(s+1);if(Un.intersectsLine(r.x,r.y,a.x,a.y,t.x,t.y,t.width,t.height))return!0}}return this.hitCanvasRect(t)},getAngle:function(){return!this._angle&&this._fromPoint&&this._toPoint&&(this._angle=Ge.getAngle(this._fromPoint,this._toPoint)),this._angle||0},getAbsoluteAngle:function(){var t={x:10,y:0},e=this._fromPoint,i=this._toPoint,n={x:i.x-e.x,y:i.y-e.y},s=180*Math.acos((n.x*t.x+n.y*t.y)/(Math.sqrt(t.x*t.x+t.y*t.y)*Math.sqrt(n.x*n.x+n.y*n.y)))/Math.PI;return s=e.y<=i.y?s:360-s,s=s%360*Math.PI/180},appendShadowBound:function(t,e){var i=t.isShadowable()&&this._shadowColor&&!this._editAttachment;if(i){this._shadowXOffset>0?e.width+=this._shadowXOffset:(e.x+=this._shadowXOffset,e.width+=-this._shadowXOffset),this._shadowYOffset>0?e.height+=this._shadowYOffset:(e.y+=this._shadowYOffset,e.height+=-this._shadowYOffset);var n=this._shadowBlur;Ge.grow(e,n+1,n+1)}return e}}),De.vector.GroupUI=function(t,e){De.vector.GroupUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.vector.GroupUI",De.vector.NodeUI,{isEditable:function(){return!this._element.isExpanded()},paintBody:function(t){this._shapeRect?this.drawExpandedGroup(t):De.vector.GroupUI.superClass.paintBody.apply(this,arguments)},validateBodyBounds:function(){if(this.getBodyRect(),this._shapeRect){var t=this.getPathRect("group",!1),e=this.getStyle("group.deep");Ge.grow(t,e+1,e+1),this.addBodyBounds(t)}else De.vector.GroupUI.superClass.validateBodyBounds.call(this)},getZoomBodyRect:function(){return this._element.isExpanded()?this.getBodyRect():De.vector.GroupUI.superClass.getZoomBodyRect.call(this)},getZoomViewRect:function(){return this._element.isExpanded()?this.getViewRect():De.vector.GroupUI.superClass.getZoomViewRect.call(this)},drawExpandedGroup:function(t){this.drawPath(t,"group",!1,this._element.getStyle("vector.outline.pattern"));var e=this.getStyle("group.deep"),i=this.getStyle("group.fill.color");0!==e&&i&&"rectangle"===this.getStyle("group.shape")&&qe.draw3DRect(t,i,e,this._shapeRect)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var t=this._element,e=this._network;if(t.isExpanded()){t.getChildren().forEach(function(t){var i=e.getElementUI(t);i&&i.validate()});var i=this.getChildrenRects();if(!i.isEmpty()){var n=t.getStyle("group.shape"),s=Ze[n];if(!s)throw"Can not resolve group shape '"+n+"'";this._shapeRect=s(i)}}return this._shapeRect?(Ge.addPadding(this._shapeRect,t,"group.padding",1),this._shapeRect):De.vector.GroupUI.superClass.createBodyRect.call(this)},appendShadowBound:function(t,e){var i=t.isShadowable()&&this._shadowColor&&!this._editAttachment;if(i){this._shadowXOffset>0?e.width+=this._shadowXOffset:(e.x+=this._shadowXOffset,e.width+=-this._shadowXOffset),this._shadowYOffset>0?e.height+=this._shadowYOffset:(e.y+=this._shadowYOffset,e.height+=-this._shadowYOffset);var n=this._shadowBlur;Ge.grow(e,n+1,n+1)}return e}}),De.vector.ShapeNodeUI=function(t,e){De.vector.ShapeNodeUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.vector.ShapeNodeUI",De.vector.NodeUI,{getDefaultBodyRect:function(){return this._element._points.size()<2?null:this._reverseZoomPathRect()},drawDefaultBody:function(t){this._element._points.size()<2||(this.drawPath(t,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._getZoomPoints(),this._element._segments,this._element.getStyle("shapenode.closed")),_n.drawLinkArrow(this,t,Ge.getPointObject(this._element._points,this._element._segments)))},invalidateZoom:function(){this._zoomPoints=null,De.vector.LinkUI.superClass.invalidateZoom.call(this)},_getZoomPoints:function(){return this._zoomPoints=this._network.zoomManager._getShapeNodeZoomPoints(this,this._element._points),this._zoomPoints},_reverseZoomPathRect:function(){return this._network.zoomManager._reverseElementZoomRect(this,this.getZoomPathRect("vector",!0))}}),De.vector.ShapeLinkUI=function(t,e){De.vector.ShapeLinkUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.vector.ShapeLinkUI",De.vector.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var t=this.getFromPoint(),e=this.getToPoint(),i=new De.List,n=this.getStyle("shapelink.type");i.add(t),null!=this._element._points&&i.addAll(this._network.zoomManager._getShapeLinkZoomPoints(this._element._points)),i.add(e);var s,r,a;if("lineto"===n);else if("quadto"===n){for(s=new De.List(i.get(0)),r=1,pointCount=i.size();r<pointCount;r++)s.add(r<pointCount-1?new De.List([i.get(r++),i.get(r)]):i.get(r));i=s}else if("cubicto"===n){for(s=new De.List(i.get(0)),r=1,pointCount=i.size();r<pointCount;r++)s.add(r<pointCount-2?new De.List([i.get(r++),i.get(r++),i.get(r)]):r<pointCount-1?new De.List([i.get(r++),i.get(r)]):i.get(r));i=s}else{if("orthogonalto"!==n)throw"Can not resolve shapelink type '"+n+"'";for(a=i.get(0),s=new De.List(a),r=1,pointCount=i.size();r<pointCount;r++)if(r<pointCount-1){var o=Be.clone(i.get(r)),h=o.x,l=o.y,c=h-a.x,u=l-a.y;Math.abs(c)>Math.abs(u)?(o.x=h,o.y=a.y):(o.x=a.x,o.y=l),a=o,s.add(a)}else s.add(i.get(r));i=s}var d,f,g,o,_,c,u,p=Ge.calculateLineLength(i)/2,v=i.size(),m=0,y=0;for(d=0;v>d;d++)if(o=i.get(d),0!=d){if(g=o,g instanceof gn&&(g=g._as),g instanceof Array?(_=Ge.calculateCurveLength(f,g,1),f=g[g.length-1]):(u=o.y-f.y,c=o.x-f.x,_=Math.sqrt(c*c+u*u),f=g),y+=_,p>=m&&y>=p){var A=p-m,x=i.get(d-1);x instanceof gn&&(x=x._as,x instanceof Array&&(x=x[x.length-1]));var w=i.get(d),b=Ge.getPathInfo(w,x,A,0,-1).point;this._hotSpot=Be.clone(b)}m=y}else f=o;return i},_growLinkJoinBounds:function(t,e){Ge.grow(t,3*e,3*e)}}),De.vector.GridUI=function(t,e){De.vector.GridUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.vector.GridUI",De.vector.NodeUI,{drawDefaultBody:function(t){this._element.getImage()?De.vector.GridUI.superClass.drawDefaultBody.apply(this,arguments):this.drawGridBody(t)},validateBodyBounds:function(){if(this._element.getImage())De.vector.GridUI.superClass.validateBodyBounds.call(this);else{var t=this.getBodyRect(),e=Be.clone(t),i=this._element.getStyle("outer.width");Ge.grow(e,i,i),this.appendShadowBound(this,e),this.addBodyBounds(e)}},_getZoomCellRect:function(t,e){var i=this._element.getCellRect(t,e),n=this._element.getRect(),s=n.x+n.width/2,r=n.y+n.height/2,a=this.getZoomBodyRect(),o=a.width/n.width,h=a.x+a.width/2,l=0==s?1:h/s;return{x:s*l+(i.x-s)*o,y:r*l+(i.y-r)*o,width:i.width*o,height:i.height*o}},drawGridBody:function(t){var e=this.getStyle("grid.fill"),i=this.getStyle("grid.deep"),n=this.getStyle("grid.cell.deep");if(e||0!==i||0!==n){t.beginPath();var s=this.getZoomBodyRect(),r=this.getDyeColor("grid.fill.color");
if(this.setGlow(this,t),this.setShadow(this,t),e&&(t.fillStyle=r,t.rect(s.x,s.y,s.width,s.height),t.fill()),t.closePath(),this.clearShadow(t),t.beginPath(),0!=i&&qe.draw3DRect(t,r,i,s.x,s.y,s.width,s.height),t.closePath(),0!=n)for(var a=this.getStyle("grid.row.count"),o=this.getStyle("grid.column.count"),h=0;a>h;h++)for(var l=0;o>l;l++){var c=this._getZoomCellRect(h,l);null!=c&&(t.beginPath(),qe.draw3DRect(t,r,n,c.x,c.y,c.width,c.height),t.closePath())}}}}),De.vector.RotatableNodeUI=function(t,e){De.vector.RotatableNodeUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.vector.RotatableNodeUI",De.vector.NodeUI,{isEditable:function(){return!1},getDefaultBodyRect:function(){var t=this._element,e=Be.getImageAsset(t.getImage()),i=this.getBodyRect();return e?(Ge.addPadding(i,this._element,"image.padding",1),i):i},drawDefaultBody:function(t){var e=this._element,i=Be.getImageAsset(e.getImage());if(i){var n=this.getBodyRect();if(Ge.addPadding(n,this._element,"image.padding",1),i.getImage()){var s=this._element._getOrignalWidth(),r=this._element._getOrignalHeight(),a=this._element._getRotateRect();t.save(),t.translate(n.x-a.x+s/2,n.y-a.y+r/2),t.rotate(this._element._angle*Math.PI/180),t.drawImage(i.getImage(this._innerColor),-s/2,-r/2,s,r),t.restore()}else if(i.getSrc());else if(!i.getFunction())throw"ImageAsset '"+e.getImage()+" ' is empty"}}}),De.vector.HTMLNodeUI=function(t,e){De.vector.HTMLNodeUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.vector.HTMLNodeUI",De.vector.NodeUI,{checkAttachments:function(){De.vector.NodeUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var t=this._element.getStyle("attachment.label.style");if(t&&"none"===t)return void De.vector.HTMLNodeUI.superClass.checkLabelAttachment.call(this);var e=this._network.getLabel(this._element);null!=e&&""!==e?this._labelAttachment||(this._labelAttachment=new De.vector.HTMLLabelAttachment(this,kn.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkLabel2Attachment:function(){var t=this._element.getStyle("attachment.label2.style");if(t&&"none"===t)return void De.vector.HTMLNodeUI.superClass.checkLabel2Attachment.call(this);var e=this._network.getLabel2(this._element);null!=e&&""!==e?this._label2Attachment||(this._label2Attachment=new De.vector.HTMLLabel2Attachment(this,kn.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._label2Attachment)):this._label2Attachment&&(this.removeAttachment(this._label2Attachment),this._label2Attachment=null)},checkAlarmAttachment:function(){var t=this._element.getStyle("attachment.alarm.style");if(t&&"none"===t)return void De.vector.HTMLNodeUI.superClass.checkAlarmAttachment.call(this);var e=this._network.getAlarmLabel(this._element);null!=e&&""!==e?this._alarmAttachment||(this._alarmAttachment=new De.vector.HTMLAlarmAttachment(this,(!1)),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},setAttachmentVisible:function(t){t?(this._labelAttachment&&this._labelAttachment.setVisibility("visible"),this._label2Attachment&&this._label2Attachment.setVisibility("visible"),this._alarmAttachment&&this._alarmAttachment.setVisibility("visible")):(this._labelAttachment&&this._labelAttachment.setVisibility("hidden"),this._label2Attachment&&this._label2Attachment.setVisibility("hidden"),this._alarmAttachment&&this._alarmAttachment.setVisibility("hidden"))}}),De.vector.HTMLLinkUI=function(t,e){De.vector.HTMLLinkUI.superClass.constructor.call(this,t,e)},Be.ext("twaver.vector.HTMLLinkUI",De.vector.LinkUI,{checkAttachments:function(){De.vector.LinkUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var t=this._element.getStyle("attachment.label.style");if(t&&"none"===t)return void De.vector.HTMLLinkUI.superClass.checkLabelAttachment.call(this);var e=this._network.getLabel(this._element);null!=e&&""!==e?this._labelAttachment||(this._labelAttachment=new De.vector.HTMLLabelAttachment(this,kn.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkLabel2Attachment:function(){var t=this._element.getStyle("attachment.label2.style");if(t&&"none"===t)return void De.vector.HTMLNodeUI.superClass.checkLabelAttachment.call(this);var e=this._network.getLabel2(this._element);null!=e&&""!==e?this._label2Attachment||(this._label2Attachment=new De.vector.HTMLLabel2Attachment(this,kn.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._label2Attachment)):this._label2Attachment&&(this.removeAttachment(this._label2Attachment),this._label2Attachment=null)},checkAlarmAttachment:function(){var t=this._element.getStyle("attachment.alarm.style");if(t&&"none"===t)return void De.vector.HTMLLinkUI.superClass.checkAlarmAttachment.call(this);var e=this._network.getAlarmLabel(this._element);null!=e&&""!==e?this._alarmAttachment||(this._alarmAttachment=new De.vector.HTMLAlarmAttachment(this,(!1)),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},setAttachmentVisible:function(t){t?(this._labelAttachment&&this._labelAttachment.setVisibility("visible"),this._label2Attachment&&this._label2Attachment.setVisibility("visible"),this._alarmAttachment&&this._alarmAttachment.setVisibility("visible")):(this._labelAttachment&&this._labelAttachment.setVisibility("hidden"),this._label2Attachment&&this._label2Attachment.setVisibility("hidden"),this._alarmAttachment&&this._alarmAttachment.setVisibility("hidden"))}}),De.vector.Attachment=function(t,e){this._ui=t,this._element=this._ui.getElement(),this._network=t.getNetwork(),this._showOnTop=e,e&&this._network._hitTestTopAttachmentList.add(this)},Be.ext("twaver.vector.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},isShowOnTop:function(){return this._showOnTop===!0},setShowOnTop:function(t){this._showOnTop=t},getStyle:function(t){return this._ui.getStyle(t)},getFont:function(t){return this._ui.getFont(t)},getViewRect:function(){return Be.clone(this._viewRect)},getAlpha:function(){return 1},validate:function(){},paint:function(t){},getZoomViewRect:function(){var t=this._network.zoomManager._getAttachmentZoomOutLineRect(this,this._viewRect);return t},hit:function(t,e){return!!Ge.containsPoint(this.getZoomViewRect(),t,e)&&this.hitCanvasRect({x:t-1,y:e-1,width:2,height:2})},hitCanvasRect:function(t){var e=Un.getHitCanvas(t.width,t.height),i=Un.getCtx(e);i.save(),i.translate(-t.x,-t.y),this.paint(i);try{for(var n=i.getImageData(0,0,t.width,t.height),s=n.data,r=0;r<n.width;r++)for(var a=0;a<n.height;a++){var o=4*(a*n.width+r),h=s[o+3];if(0!==h)return i.restore(),!0}}catch(l){Un.disposeHitCanvas()}return i.restore(),!1},dispose:function(){this._network._hitTestTopAttachmentList.remove(this)},_rotatePoint:function(t,e,i){var n=Ge.createMatrix(e*Math.PI/180,i.x+i.width/2,i.y+i.height/2),s=n.transform(t);return s},_rotatePointList:function(t,e,i){var n=this,s=new De.List;return t.forEach(function(t){s.add(n._rotatePoint(t,e,i))}),s}}),De.vector.BasicAttachment=function(t,e){De.vector.BasicAttachment.superClass.constructor.call(this,t,e),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0}},Be.ext("twaver.vector.BasicAttachment",De.vector.Attachment,{paint:function(t){De.vector.BasicAttachment.superClass.paint.apply(this,arguments);var e=this.isFill(),i=this.getOutlineWidth(),n=this._network.zoomManager._getAttachmentZoomOutLineRect(this,this._roundRect);if(this.getElementUI().setGlow(this,t),this.getElementUI().setShadow(this,t),i>0||e){if(qe.drawRoundRect(t,n.x,n.y,n.width,n.height,this.getCornerRadius()),this._network._debug&&qe.strokeRect(t,n,"#C71585"),this._pointers){var s=this._ui.getZoomPointers(this,this._pointers);t.moveTo(s[0].x,s[0].y),t.lineTo(s[1].x,s[1].y),t.lineTo(s[2].x,s[2].y)}if(t.closePath(),i>0&&(t.lineWidth=i,t.strokeStyle=this.getOutlineColor(),t.lineCap=this.getCap(),t.lineJoin=this.getJoin(),t.stroke()),e){var r=this.getFillColor(),a=this.getGradient();a?qe.fill(t,r,a,this.getGradientColor(),this._viewRect):t.fillStyle=r,t.fill()}}},validate:function(){De.vector.BasicAttachment.superClass.validate.call(this),this.calculateMeasure();var t=this.getOutlineWidth();(null==t||0>=t)&&(t=1),this._viewRect=Ge.getRect(this._pointers),this._viewRect=Ge.unionRect(this._viewRect,this._roundRect),t>0&&Ge.grow(this._viewRect,2*t,2*t),this._viewRect=this._ui.appendShadowBound(this,this._viewRect);var e=this._element instanceof De.Link&&this._element.getStyle("link.label.rotatable");if(e){var i=this._viewRect.x+this._viewRect.width/2,n=this._viewRect.y+this._viewRect.height/2,s=Math.sqrt(this._viewRect.height*this._viewRect.height+this._viewRect.width*this._viewRect.width);this._viewRect={x:i-s,y:n-s,width:2*s,height:2*s}}},calculateMeasure:function(){var t=this.getContentWidth(),e=this.getContentHeight(),i=this.getCornerRadius(),n=this.getPointerLength(),s=this.getPointerWidth(),r=this.getPosition(),a=this.getXOffset(),o=this.getYOffset(),h=this._roundRect;h.width=t+i,h.height=e;var l;if(this._ui._element instanceof De.Link){var c,u=this._ui.getLinkPoints();c=this._ui.getLineLength?this._ui.getLineLength():this._ui._element.getLineLength(),Math.abs(a)>0&&Math.abs(a)<1?"from"===r?a*=c:"to"===r?a=c*(1-a):(a/=2,a+=.5,a*=c):"from"===r?a=a:"to"===r?a=c-a:a+=c/2;var d,f=Ge.calculatePointInfoAlongLine(u,!0,a,o),g=f.point;f.angle,d="from"===r?this._ui.getFromPoint():"to"===r?this._ui.getToPoint():this._ui._hotSpot,a=g.x-d.x,o=g.y-d.y}if(n>0){var _=this.getDirection();l=this._network.getPosition(r,this._ui,null,a,o,!1);var p;if("aboveleft"===_)h.y=l.y-n-h.height,h.x=l.x-(h.width-i),p=Math.max(l.x-s,l.x-(h.width-i)+i/2),this._pointers=[l,{x:l.x,y:l.y-n},{x:p,y:l.y-n}];else if("aboveright"===_)h.y=l.y-n-h.height,h.x=l.x-i,p=Math.min(l.x+s,l.x-i+h.width-i/2),this._pointers=[l,{x:l.x,y:l.y-n},{x:p,y:l.y-n}];else if("belowleft"===_)h.y=l.y+n,h.x=l.x-(h.width-i),p=Math.max(l.x-s,l.x-(h.width-i)+i/2),this._pointers=[l,{x:l.x,y:l.y+n},{x:p,y:l.y+n}];else if("belowright"===_)h.y=l.y+n,h.x=l.x-i,p=Math.min(l.x+s,l.x-i+h.width-i/2),this._pointers=[l,{x:l.x,y:l.y+n},{x:p,y:l.y+n}];else if("leftabove"===_)h.y=l.y+i-h.height,h.x=l.x-n-h.width,p=Math.max(l.y-s,l.y+i-h.height+i/2),this._pointers=[l,{x:l.x-n,y:l.y},{x:l.x-n,y:p}];else if("leftbelow"===_)h.y=l.y-i,h.x=l.x-n-h.width,p=Math.min(l.y+s,l.y-i+h.height-i/2),this._pointers=[l,{x:l.x-n,y:l.y},{x:l.x-n,y:p}];else if("rightabove"===_)h.y=l.y+i-h.height,h.x=l.x+n,p=Math.max(l.y-s,l.y+i-h.height+i/2),this._pointers=[l,{x:l.x+n,y:l.y},{x:l.x+n,y:p}];else if("rightbelow"===_)h.y=l.y-i,h.x=l.x+n,p=Math.min(l.y+s,l.y-i+h.height-i/2),this._pointers=[l,{x:l.x+n,y:l.y},{x:l.x+n,y:p}];else if("above"===_)h.y=l.y-n-h.height,h.x=l.x-h.width/2,p=Math.min(t/2,s/2),this._pointers=[l,{x:l.x-p,y:l.y-n},{x:l.x+p,y:l.y-n}];else if("below"===_)h.y=l.y+n,h.x=l.x-h.width/2,p=Math.min(t/2,s/2),this._pointers=[l,{x:l.x-p,y:l.y+n},{x:l.x+p,y:l.y+n}];else if("left"===_)h.y=l.y-h.height/2,h.x=l.x-n-h.width,p=Math.min(e/2,s/2),this._pointers=[l,{x:l.x-n,y:l.y+p},{x:l.x-n,y:l.y-p}];else{if("right"!==_)throw"Can not resolve '"+_+"' attachment direction";h.y=l.y-h.height/2,h.x=l.x+n,p=Math.min(e/2,s/2),this._pointers=[l,{x:l.x+n,y:l.y+p},{x:l.x+n,y:l.y-p}]}}else l=this._network.getPosition(r,this._ui,{width:h.width,height:h.height},a,o,!1),h.x=l.x,h.y=l.y,this._pointers=null;this._contentRect.x=h.x+(h.width-t)/2,this._contentRect.y=h.y+(h.height-e)/2,this._contentRect.width=t,this._contentRect.height=e;var v=this.getPadding();0!=v&&Ge.grow(h,v,v),v=this.getPaddingLeft(),0!=v&&(h.x-=v,h.width+=v),v=this.getPaddingRight(),0!=v&&(h.width+=v),v=this.getPaddingTop(),0!=v&&(h.y-=v,h.height+=v),v=this.getPaddingBottom(),0!=v&&(h.height+=v),h.width<0&&(h.width=h.width,h.x-=h.width),h.height<0&&(h.height=-h.height,h.y-=h.height)},getContentWidth:function(){return De.Defaults.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return De.Defaults.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return De.Defaults.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return De.Defaults.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return De.Defaults.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return De.Defaults.ATTACHMENT_POSITION},getXOffset:function(){return De.Defaults.ATTACHMENT_XOFFSET},getYOffset:function(){return De.Defaults.ATTACHMENT_YOFFSET},getPadding:function(){return De.Defaults.ATTACHMENT_PADDING},getPaddingLeft:function(){return De.Defaults.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return De.Defaults.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return De.Defaults.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return De.Defaults.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return De.Defaults.ATTACHMENT_DIRECTION},isFill:function(){return De.Defaults.ATTACHMENT_FILL},getFillColor:function(){return De.Defaults.ATTACHMENT_FILL_COLOR},getGradient:function(){return De.Defaults.ATTACHMENT_GRADIENT},getGradientColor:function(){return De.Defaults.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return De.Defaults.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return De.Defaults.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return De.Defaults.ATTACHMENT_CAP},getJoin:function(){return De.Defaults.ATTACHMENT_JOIN},isShadowable:function(){return De.Defaults.ATTACHMENT_SHADOWABLE},getRoundRect:function(){return Be.clone(this._roundRect)},getContentRect:function(){return Be.clone(this._contentRect)}}),De.vector.LabelAttachment=function(t,e){De.vector.LabelAttachment.superClass.constructor.call(this,t,e)},Be.ext("twaver.vector.LabelAttachment",De.vector.BasicAttachment,{paint:function(t){var e=this._element instanceof De.Link&&this._element.getStyle("link.label.rotatable");if(e){t.save();var i=this.getZoomViewRect(),n=i.x+i.width/2,s=i.y+i.height/2;t.translate(n,s),t.rotate(this._network.getElementUI(this._element).getAngle()),t.translate(-n,-s)}De.vector.LabelAttachment.superClass.paint.apply(this,arguments);var r=this._network.zoomManager,a=r._getAttachmentZoomRect(this,this._contentRect),o=this._element.getStyle("label.align"),h=this._element&&this._element.getStyle("label.rotate.angle");if(0!==h&&(t.save(),De.Util.rotateCanvas(t,this._contentRect,h)),r._drawText(this,t,this.text,a,this.font,this.getStyle("label.color"),o),(e||0!==h)&&t.restore(),this._network._debug){var l=this._viewRect;qe.strokeRect(t,l,"#AAABBB")}},validate:function(){this.font=this.getFont("label.font");var t=this.getLabel(),e=Be.g.getTextSize(this.font,t),i=this.getMaxLength();0!==i&&e.width>i?(this.text=Be.g.getCollapseTextInLength(this.font,t,i),this._textSize=Be.g.getTextSize(this.font,this.text)):(this.text=t,this._textSize=e),De.vector.LabelAttachment.superClass.validate.call(this);var n=this._viewRect,s=this._element&&this._element.getStyle("label.rotate.angle");if(0!==s){var r=new De.List;r.add({x:n.x,y:n.y}),r.add({x:n.x+n.width,y:n.y}),r.add({x:n.x+n.width,y:n.y+n.height}),r.add({x:n.x,y:n.y+n.height}),r=this._rotatePointList(r,s,n);var a=De.Util.getRect(r);this._viewRect=a}},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},getMaxLength:function(){return this.getStyle("label.maxlength")},isShadowable:function(){return this.getStyle("label.shadowable")}}),De.vector.Label2Attachment=function(t,e){De.vector.Label2Attachment.superClass.constructor.call(this,t,e)},Be.ext("twaver.vector.Label2Attachment",De.vector.BasicAttachment,{paint:function(t){var e=this._element instanceof De.Link&&this._element.getStyle("link.label.rotatable");if(e){t.save();var i=this.getZoomViewRect(),n=i.x+i.width/2,s=i.y+i.height/2;t.translate(n,s),t.rotate(this._network.getElementUI(this._element).getAngle()),t.translate(-n,-s)}De.vector.Label2Attachment.superClass.paint.apply(this,arguments);var r=this._network.zoomManager,a=r._getAttachmentZoomRect(this,this._contentRect),o=this._element.getStyle("label.align"),h=this._element&&this._element.getStyle("label2.rotate.angle");if(0!==h&&(t.save(),De.Util.rotateCanvas(t,this._contentRect,h)),r._drawText(this,t,this.text,a,this.font,this.getStyle("label2.color"),o),(e||0!==h)&&t.restore(),this._network._debug){var l=r.getAttachmentSizeZoom(this),c=a;c.width*=l,c.height*=l,qe.strokeRect(t,c,"#AAABBB")}},validate:function(){this.font=this.getFont("label2.font");var t=this.getLabel(),e=Be.g.getTextSize(this.font,t),i=this.getMaxLength();0!==i&&e.width>i?(this.text=Be.g.getCollapseTextInLength(this.font,t,i),this._textSize=Be.g.getTextSize(this.font,this.text)):(this.text=t,this._textSize=e),De.vector.LabelAttachment.superClass.validate.call(this);var n=this._viewRect,s=this._element&&this._element.getStyle("label2.rotate.angle");if(0!==s){var r=new De.List;r.add({x:n.x,y:n.y}),r.add({x:n.x+n.width,y:n.y}),r.add({x:n.x+n.width,y:n.y+n.height}),r.add({x:n.x,y:n.y+n.height}),r=this._rotatePointList(r,s,n);var a=De.Util.getRect(r);this._viewRect=a}},getLabel:function(){return this._network.getLabel2(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label2.corner.radius")},getPointerLength:function(){return this.getStyle("label2.pointer.length")},getPointerWidth:function(){return this.getStyle("label2.pointer.width")},getPosition:function(){return this.getStyle("label2.position")},getXOffset:function(){return this.getStyle("label2.xoffset")},getYOffset:function(){return this.getStyle("label2.yoffset")},getPadding:function(){return this.getStyle("label2.padding")},getPaddingLeft:function(){return this.getStyle("label2.padding.left")},getPaddingRight:function(){return this.getStyle("label2.padding.right")},getPaddingTop:function(){return this.getStyle("label2.padding.top")},getPaddingBottom:function(){return this.getStyle("label2.padding.bottom")},getDirection:function(){return this.getStyle("label2.direction")},isFill:function(){return this.getStyle("label2.fill")},getFillColor:function(){return this.getStyle("label2.fill.color")},getGradient:function(){return this.getStyle("label2.gradient")},getGradientColor:function(){return this.getStyle("label2.gradient.color")},getOutlineWidth:function(){return this.getStyle("label2.outline.width")},getOutlineColor:function(){return this.getStyle("label2.outline.color")},getCap:function(){return this.getStyle("label2.cap")},getJoin:function(){return this.getStyle("label2.join")},getAlpha:function(){return this.getStyle("label2.alpha")},getMaxLength:function(){return this.getStyle("label2.maxlength")},isShadowable:function(){return this.getStyle("label2.shadowable")}}),De.vector.AlarmAttachment=function(t,e){De.vector.AlarmAttachment.superClass.constructor.call(this,t,e)},Be.ext("twaver.vector.AlarmAttachment",De.vector.BasicAttachment,{paint:function(t){De.vector.AlarmAttachment.superClass.paint.apply(this,arguments);var e=this._network.zoomManager,i=e._getAttachmentZoomRect(this,this._contentRect);e._drawText(this,t,this.text,i,this.font,this.getStyle("alarm.color"))},validate:function(){this.font=this.getFont("alarm.font"),this.text=this._network.getAlarmLabel(this._element),this._textSize=qe.getTextSize(this.font,this.text),this._fillColor=this._network.getAlarmFillColor(this._element),De.vector.AlarmAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return null!=this._fillColor},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),De.vector.LinkHandlerAttachment=function(t,e){De.vector.LinkHandlerAttachment.superClass.constructor.call(this,t,e)},Be.ext("twaver.vector.LinkHandlerAttachment",De.vector.BasicAttachment,{paint:function(t){var e=this._network.zoomManager;De.vector.LinkHandlerAttachment.superClass.paint.apply(this,arguments);var i=e._getAttachmentZoomRect(this,this._contentRect);e._drawText(this,t,this.linkHandlerLabel,i,this.linkHandlerFont,this.getStyle("link.handler.color"))},validate:function(){this.linkHandlerFont=this.getFont("link.handler.font"),this.linkHandlerLabel=this._network.getLinkHandlerLabel(this._element),this._textSize=qe.getTextSize(this.linkHandlerFont,this.linkHandlerLabel),De.vector.LinkHandlerAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),De.vector.IconsAttachment=function(t,e){De.vector.IconsAttachment.superClass.constructor.call(this,t,e)},Be.ext("twaver.vector.IconsAttachment",De.vector.Attachment,{isShadowable:function(){return De.Defaults.ATTACHMENT_SHADOWABLE},validate:function(){if(De.vector.IconsAttachment.superClass.validate.call(this),this.iconsNames=this._network.getIconsNames(this._element),this.iconsNames&&0!=this.iconsNames.length){var t=this._makeGroup(this.iconsNames),e=this._makeGroup(this._network.getIconsColors(this._element)),n=this._network.zoomManager;len=t.length,this.iconsOrientation=this._makeArray(this._element.getStyle("icons.orientation"),len,"right"),this.iconsPosition=this._makeArray(this._element.getStyle("icons.position"),len,"topleft.bottomright"),this.iconsXoffset=this._makeArray(this._element.getStyle("icons.xoffset"),len,0),this.iconsYoffset=this._makeArray(this._element.getStyle("icons.yoffset"),len,0),this.iconsXgap=this._makeArray(this._element.getStyle("icons.xgap"),len,1),this.iconsYgap=this._makeArray(this._element.getStyle("icons.ygap"),len,1),this.locations=[],this.iconsSizes=[],this.iconsOrientations=[];var s,r,a;for(i=0;i<len;i++){var o=t[i],a=this.iconsOrientation[i]||"right",h=this.iconsPosition[i]||"topleft.bottomright",l=this.iconsXgap[i]||1,c=this.iconsYgap[i]||1,u=this.iconsXoffset[i]||0,d=this.iconsYoffset[i]||0;if(this._ui._element instanceof De.Link){var f,g=this._ui.getLinkPoints();f=this._ui.getLineLength?this._ui.getLineLength():this._ui._element.getLineLength(),Math.abs(u)>0&&Math.abs(u)<1?"from"===h?u*=f:"to"===h?u=f*(1-u):(u/=2,u+=.5,u*=f):"from"===h?u=u:"to"===h?u=f-u:u+=f/2;var _,p=Ge.calculatePointInfoAlongLine(g,!0,u,d),v=p.point;p.angle,_="from"===h?this._ui.getFromPoint():"to"===h?this._ui.getToPoint():this._ui._hotSpot,u=v.x-_.x,d=v.y-_.y}r=null,s=this._getIconsSize(o,a,l,c,n),s&&(r=this._network.getPosition(h,this._ui,s,u,d),this._iconLocation=r,"top"===a?r.y+=s.height:"left"===a&&(r.x+=s.width)),this.locations.push(r),this.iconsSizes.push(s),this.iconsOrientations.push(a)}var m=null;for(i=0;i<this.locations.length;i++)r=this.locations[i],s=this.iconsSizes[i],a=this.iconsOrientations[i],null!=r&&(m=null==m?"top"===a?{x:r.x,y:r.y-s.height,width:s.width,height:s.height}:"left"===a?{x:r.x-s.width,y:r.y,width:s.width,height:s.height}:{x:r.x,y:r.y,width:s.width,height:s.height}:"top"===a?Ge.unionRect(m,{x:r.x,y:r.y-s.height,width:s.width,height:s.height}):"left"===a?Ge.unionRect(m,{x:r.x-s.width,y:r.y,width:s.width,height:s.height}):Ge.unionRect(m,{x:r.x,y:r.y,width:s.width,height:s.height}));this._viewRect=n?m||this.getElementUI().getViewRect():m||{x:this._element.getLocation().x,y:this._element.getLocation().y,width:0,height:0},this.iconsGroups=t,this.colorGroups=e;var y=this._element instanceof De.Link&&this._element.getStyle("link.icons.rotatable");for(i=0;i<len;i++)if(y instanceof Array&&y[i]&&this._viewRect){var A=this._viewRect.x+this._viewRect.width/2,x=this._viewRect.y+this._viewRect.height/2,w=Math.sqrt(this._viewRect.height*this._viewRect.height+this._viewRect.width*this._viewRect.width);this._viewRect={x:A-w/2,y:x-w/2,width:w,height:w}}}},_makeGroup:function(t){if(!Array.isArray(t))return[[t]];var e,i,n,s=[],r=!1,a=t.length;for(e=0;a>e;e++)i=t[e],Array.isArray(i)?(r=!0,s.push(i)):(n=[i],s.push(n));return r||(s.length=0,s.push(t)),s},_makeArray:function(t,e,i){if(Array.isArray(t))return t;for(var n=[],s=0;e>s;s++)n.push(t||i);return n},paint:function(t){if(De.vector.IconsAttachment.superClass.paint.apply(this,arguments),this.iconsNames&&0!=this.iconsNames.length&&this.locations){var e,i,n,s,r,a,o,h,l,c,u=this._network.zoomManager;for(e=0;e<this.iconsGroups.length;e++)if(i=this.locations[e]){r=i.x,a=i.y,s=this.iconsGroups[e],o=this.colorGroups[e],h=this.iconsOrientation[e],l=this.iconsXgap[e]||1,c=this.iconsYgap[e]||1,n=0;for(var d in s){var f=null,g=null;o&&o.length>n&&(g=o[n++]);var _=Be.getImageAsset(s[d]);if(null!=_){if(u&&this._ui instanceof De.vector.GroupUI&&this._ui._shapeRect){var p=u.getAttachmentSizeZoom(this),v=_.getWidth()*p,m=_.getHeight()*p;if("right"===h)f={x:r,y:a,width:v,height:m},r+=f.width+l;else if("left"===h)f={x:r-v,y:a,width:v,height:m},r-=f.width+l;else if("top"===h)f={x:r,y:a-m,width:v,height:m},a-=f.height+c;else{if("bottom"!==h)throw"Can not resolve '"+h+"' orientation";f={x:r,y:a,width:v,height:m},a+=f.height+c}}else{if("right"===h)f={x:r,y:a,width:_.getWidth(),height:_.getHeight()},r+=f.width+l;else if("left"===h)f={x:r-_.getWidth(),y:a,width:_.getWidth(),height:_.getHeight()},r-=f.width+l;else if("top"===h)f={x:r,y:a-_.getHeight(),width:_.getWidth(),height:_.getHeight()},a-=f.height+c;else{if("bottom"!==h)throw"Can not resolve '"+h+"' orientation";f={x:r,y:a,width:_.getWidth(),height:_.getHeight()},a+=f.height+c}f=u._getAttachmentZoomOutLineRect(this,f)}var y=this._element instanceof De.Link&&this._element.getStyle("link.icons.rotatable");if(y instanceof Array&&y[e]){t.save();var A=f,r=A.x+A.width/2,a=A.y+A.height/2;t.translate(r,a),t.rotate(this._network.getElementUI(this._element).getAbsoluteAngle()),t.translate(-r,-a),Fi(t,_.getImage(g,f.width,f.height),g,f,this._element,this._network),t.restore()}else Fi(t,_.getImage(g,f.width,f.height),g,f,this._element,this._network);if(this._network._debug){var f=this._viewRect;qe.strokeRect(t,f,"#FCFC00",1),qe.strokeRect(t,f,"#FCFC00",1)}}}}}},_getIconsSize:function(t,e,i,n,s){var r=0,a=0,o=null,h=null,l=null;for(var c in t)if(h=Be.getImageAsset(t[c])){if("right"===e)o={x:r,y:a,width:h.getWidth(),height:h.getHeight()},r+=o.width+i;else if("left"===e)o={x:r-h.getWidth(),y:a,width:h.getWidth(),height:h.getHeight()},r-=o.width+i;else if("top"===e)o={x:r,y:a-h.getHeight(),width:h.getWidth(),height:h.getHeight()},a-=o.height+n;else{if("bottom"!==e)throw"Can not resolve '"+e+"' orientation";o={x:r,y:a,width:h.getWidth(),height:h.getHeight()},a+=o.height+n}l=null==l?Be.clone(o):Ge.unionRect(l,o)}return l?s&&this._ui instanceof De.vector.GroupUI&&this._ui._shapeRect?{width:Math.abs(l.width)*s.getAttachmentSizeZoom(this),height:Math.abs(l.height)*s.getAttachmentSizeZoom(this)}:{width:Math.abs(l.width),height:Math.abs(l.height)}:null}}),De.vector.EditAttachment=function(t,e){De.vector.EditAttachment.superClass.constructor.call(this,t,e)},Be.ext("twaver.vector.EditAttachment",De.vector.Attachment,{paint:function(t){De.vector.EditAttachment.superClass.paint.apply(this,arguments),this.paintResizingPoints(t),this.paintEditPoints(t),this.paintRotatePoints(t)},paintResizingPoints:function(t){var e=this.resizingPoints.size();if(!(0>=e)){var i=this._element.getStyle("edit.physicalZoom")?1:this._network.getGraphicsZoom(),n=this.resizePointSize/i,s=2*n,r=2*n,a=this._network.getResizePointFillColor(),o=this._network.getResizePointOutlineWidth()/i,h=this._network.getResizePointOutlineColor(),l=this._element.getAngle(),c=this._network.zoomManager,u=c._getElementZoomRect(this.getElementUI(),this._element.getOriginalRect());
t.lineWidth=o;for(var d=this.resizingPoints,f=0;e>f;f++){var g=d.get(f),_={x:g.x-n,y:g.y-n,width:2*n,height:2*n},p=this._getRotateRect(_,l,{x:u.x+u.width/2,y:u.y+u.height/2});t.save(),De.Util.rotateCanvas(t,p,l),Un.rect(t,p.x,p.y,s,r),t.restore()}if(t.fillStyle=a,t.strokeStyle=h,t.fill(),t.stroke(),this._network._debug){var v=this.getViewRect("resize");qe.strokeRect(t,v,"#CCDDCC");var v=c._getElementZoomRect(this.getElementUI(),this.getElementUI()._viewRect);qe.strokeRect(t,v,"#FD7766")}}},paintEditPoints:function(t){var e=this.editPoints.size();if(!(0>=e)){var i=this._element.getStyle("edit.physicalZoom")?1:this._network.getGraphicsZoom(),n=this._network.getEditPointOutlineColor(),s=this._network.getEditPointFillColor(),r=this._network.getEditPointOutlineWidth()/i;t.beginPath(),t.lineWidth=r;for(var a=this.editPoints,o=0;e>o;o++){var h=a.get(o);t.beginPath(),Un.circle(t,h.x,h.y,this.editPointSize,s,n),t.closePath()}if(this._network._debug){var l=this.getViewRect("edit");qe.strokeRect(t,l,"#AAABBC")}}},paintRotatePoints:function(t){var e=this.rotatePoints.size();if(!(0>=e)){var i=this._element.getStyle("edit.physicalZoom")?1:this._network.getGraphicsZoom(),n=this._network.getRotatePointOutlineColor(),s=this._network.getRotatePointFillColor(),r=this._network.getRotatePointOutlineWidth()/i;t.beginPath(),t.lineWidth=r;for(var a=this.rotatePoints,o=0;e>o;o++){var h=a.get(o);t.beginPath(),Un.circle(t,h.x,h.y,this.rotatePointSize/i,s,n),t.closePath(),t.beginPath()}if(this._network._debug){var l=this.getViewRect("rotate");qe.strokeRect(t,l,"green")}}},getViewRect:function(t){if(t){if("resize"===t)return this._resizeRect;if("rotate"===t)return this._rotateRect;if("edit"===t)return this._editRect}return this._viewRect||{x:0,y:0,width:0,height:0}},validate:function(){De.vector.EditAttachment.superClass.validate.call(this);var t=this._network.getGraphicsZoom();this.editPointSize=this._network.getEditPointSize(),this.resizePointSize=this._network.getResizePointSize(),this.rotatePointSize=this._network.getRotatePointSize(),this.resizingPoints=new De.List,this.editPoints=new De.List,this.rotatePoints=new De.List,this._element instanceof De.Node&&this._addResizingPoint(this._element),!(this._network.isRotatable(this._element)&&this._element instanceof On)||this._element instanceof De.ShapeNode||this._element instanceof De.Grid||this._element instanceof De.Group||this._addRotatePoint(this._element),this._element instanceof De.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof De.vector.ShapeLinkUI&&this._addShapeLinkPoints(this._element),this._ui instanceof De.vector.LinkUI&&this._addLinkControlPoint(this._ui);var e=this._network.getResizePointOutlineWidth()/t,i=this.getElementUI().getZoomBodyRect(),n=2*Math.sqrt(2);if(this._resizeOffset=(this.resizePointSize+e+1)*n,Ge.grow(i,this._resizeOffset,this._resizeOffset),this._resizeRect=i,e=this._network.getEditPointOutlineWidth()/t,this.editPoints.size()>0){var s=Ge.getRect(this.editPoints);Ge.grow(s,2*this.editPointSize+2*e),i=Ge.unionRect(i,s)}this._editRect=s,e=this._network.getRotatePointOutlineWidth()/t;var r=this.rotatePointSize;if(this.rotatePoints.size()>0){var a=this.rotatePoints.get(0),o={x:a.x-r-e-1,y:a.y-r-e-1,width:2*r+2*e+2,height:2*r+2*e+2};i=Ge.unionRect(i,o),this._rotateRect=o}this._viewRect=i},_addResizingPoint:function(t){var e=this._network.zoomManager._getElementZoomRect(this.getElementUI(),t.getOriginalRect());if(e){var i=this._network.getResizePointSize();if(!(0>=i)){var n=new gn([{x:e.x,y:e.y},{x:e.x+e.width/2,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x,y:e.y+e.height/2},{x:e.x+e.width,y:e.y+e.height/2},{x:e.x,y:e.y+e.height},{x:e.x+e.width/2,y:e.y+e.height},{x:e.x+e.width,y:e.y+e.height}]),s=this._network.getResizePointOutlineWidth(),r=this._network.getResizePointOutlineColor(),a=this._network.getResizePointFillColor();this._addPoints(t.getRect(),n,s,r,a,!0)}}},_addRotatePoint:function(t){var e=this._network.zoomManager._getElementZoomRect(this.getElementUI(),t.getOriginalRect());if(e){var i=this._network.getRotatePointSize()/this._network.getGraphicsZoom();if(!(0>=i)){var n=2*i,s=new De.List([{x:e.x+e.width/2,y:e.y-this._network.getRotatePointOffset()/this._network.getGraphicsZoom()-i}]),r=t.getAngle();0!=r&&(s=this._rotatePointList(s,r,e));var a=s.get(0),o={x:a.x-n/2,y:a.y-n/2,width:n,height:n},h=this._network.getRotatePointOutlineWidth(),l=this.rotatePointSize+h;Ge.grow(e,l,l),Ge.unionRect(t.getRect(),o),this.rotatePoints=s}}},_addShapeNodePoint:function(t){var e=this._network.zoomManager._getShapeNodeZoomPoints(this.getElementUI(),t.getPoints());this._addEditPoints(e)},_addShapeLinkPoints:function(t){var e=this._network.zoomManager._getShapeLinkZoomPoints(t.getPoints());this._addEditPoints(e)},_addLinkControlPoint:function(t){var e,i=new De.List,n=t._element.getFromAgent();e=n?t._element.getFromAgent():t._element.getFromNode();var s=t._element.getStyle("link.from.xoffset"),r=t._element.getStyle("link.from.yoffset"),a=e.getCenterLocation(),o={x:a.x+s,y:a.y+r};i.add(o);var h,l=t._element.getToAgent();h=l?t._element.getToAgent():t._element.getToNode();var c=t._element.getStyle("link.to.xoffset"),u=t._element.getStyle("link.to.yoffset"),d=h.getCenterLocation(),f={x:d.x+c,y:d.y+u};if(i.add(f),bi.isOrthogonalLink(t._element)&&t.getControlPoint()){var g=t.getControlPoint();g&&i.add(g)}var _=this.editPoints.size();if(_>0)for(var p=0;_>p;p++)i.add(this.editPoints.get(p));this._addEditPoints(i)},_addEditPoints:function(t){var e=Ge.getRect(t);if(e){var i=this._network.getEditPointSize();if(!(0>=i)){var n=this._network.getEditPointOutlineWidth();this._addPoints(e,t,n,!1)}}},_addPoints:function(t,e,i,n,s,r){var a=r?this._network.getResizePointSize():this._network.getEditPointSize();if(!(0>a)){var o=a+i;Ge.grow(t,o,o),1==r?this.resizingPoints=e:this.editPoints=e}},_rotatePoint:function(t,e,i){var n=Ge.createMatrix(e*Math.PI/180,i.x+i.width/2,i.y+i.height/2),s=n.transform(t);return s},_rotatePointList:function(t,e,i){var n=this,s=new De.List;return t.forEach(function(t){s.add(n._rotatePoint(t,e,i))}),s},_getRotateRect:function(t,e,i){var n=Ge.createMatrix(e*Math.PI/180,i.x,i.y),s={x:t.x+t.width/2,y:t.y+t.height/2},r=n.transform(s),a=new De.List([{x:r.x-t.width/2,y:r.y-t.height/2},{x:r.x+t.width/2,y:r.y-t.height/2},{x:r.x+t.width/2,y:r.y+t.height/2},{x:r.x-t.width/2,y:r.y+t.height/2}]);return Ge.getRect(a)}}),De.vector.HTMLLabelAttachment=function(t,e){De.vector.HTMLLabelAttachment.superClass.constructor.call(this,t,e),this._triangleDiv=De.Util.createDiv(),this._roundDiv=De.Util.createDiv(),this._contentDiv=De.Util.createDiv(),this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Be.ext("twaver.vector.HTMLLabelAttachment",De.vector.LabelAttachment,{validate:function(){var e=this._element.getStyle("attachment.htmllabel.hyperlink");e?(De.Util.setCSSStyle(this._triangleDiv,"pointer-events","auto"),De.Util.setCSSStyle(this._contentDiv,"pointer-events","auto")):(De.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),De.Util.setCSSStyle(this._contentDiv,"pointer-events","none")),De.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),De.Util.setCSSStyle(this._contentDiv,"white-space","nowrap");var i=(this.getFont("label.font"),this.getLabel());i!==this.text&&(this.text&&("object"==typeof this.text?t.jquery?t.jquery(this.text).remove():this._contentDiv.removeChild(this.text):this._contentDiv.innerHTML=""),i&&("object"==typeof i?t.jquery?t.jquery(this._contentDiv).append(i):this._contentDiv.appendChild(i):this._contentDiv.innerHTML=i),this.text=i),this._contentDiv.style.visibility="hidden",De.vector.HTMLLabelAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(De.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(De.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(t){var e=this.isFill(),i=this.getOutlineWidth(),n=this._contentRect;if(this.getElementUI().setGlow(this,t),this.getElementUI().setShadow(this,t),i>0||e){if(qe.drawRoundRect(t,n.x,n.y,n.width,n.height,this.getCornerRadius()),this._pointers){var s=this._ui.getZoomPointers(this,this._pointers);t.moveTo(s[0].x,s[0].y),t.lineTo(s[1].x,s[1].y),t.lineTo(s[2].x,s[2].y)}if(t.closePath(),i>0&&(t.lineWidth=i,t.strokeStyle=this.getOutlineColor(),t.lineCap=this.getCap(),t.lineJoin=this.getJoin(),t.stroke()),e){var r=this.getFillColor(),a=this.getGradient();a?qe.fill(t,r,a,this.getGradientColor(),this._viewRect):t.fillStyle=r,t.fill()}}var o=(this.getFont("label.font"),this.getLabel(),this._network.getViewRect().x),h=this._network.getViewRect().y,l=this._network.getZoom(),c={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},u=c.x*l-o-this._contentDiv.offsetWidth/2*l+"px",d=c.y*l-h-this._contentDiv.offsetHeight/2*l+"px";this._contentDiv.style.left=u,this._contentDiv.style.top=d,this._contentDiv.style.setProperty("-webkit-transform","scale("+l+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null),this._network._debug&&(qe.strokeRect(t,this._contentRect,"blue"),qe.strokeRect(t,this._roundRect,"red"),qe.strokeRect(t,this._viewRect,"green"));var f=this._element instanceof De.Link&&this._element.getStyle("link.label.rotatable");if(f){var g=this.getZoomViewRect(),_=(g.x+g.width/2,g.y+g.height/2,180*this._network.getElementUI(this._element).getAbsoluteAngle()/Math.PI);this._contentDiv.offsetWidth/2*l,this._contentDiv.offsetHeight/2*l,He.isFirefox?De.Util.setCSSStyle(this._contentDiv,"-moz-transform","translate(0px,0px) rotate("+_+"deg) scale("+l+")"):He.isOpera?De.Util.setCSSStyle(this._contentDiv,"-o-transform","translate(0px,0px) rotate("+_+"deg) scale("+l+")"):He.isChrome||He.isSafari?De.Util.setCSSStyle(this._contentDiv,"-webkit-transform","translate(0px, 0px) rotate("+_+"deg) scale("+l+")"):He.isIE?De.Util.setCSSStyle(this._contentDiv,"-ms-transform","translate(0px,0px) rotate("+_+"deg) scale("+l+")"):De.Util.setCSSStyle(this._contentDiv,"transform","translate(0px,0px) rotate("+_+"deg) scale("+l+")")}},setVisibility:function(t){this._contentDiv.style.visibility=t},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),De.vector.HTMLLabel2Attachment=function(t,e){De.vector.HTMLLabel2Attachment.superClass.constructor.call(this,t,e),this._triangleDiv=De.Util.createDiv(),this._roundDiv=De.Util.createDiv(),this._contentDiv=De.Util.createDiv(),this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Be.ext("twaver.vector.HTMLLabel2Attachment",De.vector.LabelAttachment,{validate:function(){var e=this._element.getStyle("attachment.htmllabel2.hyperlink");e?(De.Util.setCSSStyle(this._triangleDiv,"pointer-events","auto"),De.Util.setCSSStyle(this._contentDiv,"pointer-events","auto")):(De.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),De.Util.setCSSStyle(this._contentDiv,"pointer-events","none")),De.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),De.Util.setCSSStyle(this._contentDiv,"white-space","nowrap");var i=(this.getFont("label2.font"),this.getLabel());i!==this.text&&(this.text&&("object"==typeof this.text?t.jquery?t.jquery(this.text).remove():this._contentDiv.removeChild(this.text):this._contentDiv.innerHTML=""),i&&("object"==typeof i?t.jquery?t.jquery(this._contentDiv).append(i):this._contentDiv.appendChild(i):this._contentDiv.innerHTML=i),this.text=i),this._contentDiv.style.visibility="hidden",De.vector.HTMLLabelAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(De.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(De.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(t){var e=this.isFill(),i=this.getOutlineWidth(),n=this._contentRect;if(this.getElementUI().setGlow(this,t),this.getElementUI().setShadow(this,t),i>0||e){if(qe.drawRoundRect(t,n.x,n.y,n.width,n.height,this.getCornerRadius()),this._pointers){var s=this._ui.getZoomPointers(this,this._pointers);t.moveTo(s[0].x,s[0].y),t.lineTo(s[1].x,s[1].y),t.lineTo(s[2].x,s[2].y)}if(t.closePath(),i>0&&(t.lineWidth=i,t.strokeStyle=this.getOutlineColor(),t.lineCap=this.getCap(),t.lineJoin=this.getJoin(),t.stroke()),e){var r=this.getFillColor(),a=this.getGradient();a?qe.fill(t,r,a,this.getGradientColor(),this._viewRect):t.fillStyle=r,t.fill()}}var o=(this.getFont("label2.font"),this.getLabel(),this._network.getViewRect().x),h=this._network.getViewRect().y,l=this._network.getZoom(),c={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},u=c.x*l-o-this._contentDiv.offsetWidth/2*l+"px",d=c.y*l-h-this._contentDiv.offsetHeight/2*l+"px";this._contentDiv.style.left=u,this._contentDiv.style.top=d,this._contentDiv.style.setProperty("-webkit-transform","scale("+l+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null),this._network._debug&&(qe.strokeRect(t,this._contentRect,"blue"),qe.strokeRect(t,this._roundRect,"red"),qe.strokeRect(t,this._viewRect,"green"));var f=this._element instanceof De.Link&&this._element.getStyle("link.label2.rotatable");if(f){var g=this.getZoomViewRect(),_=(g.x+g.width/2,g.y+g.height/2,180*this._network.getElementUI(this._element).getAbsoluteAngle()/Math.PI);this._contentDiv.offsetWidth/2*l,this._contentDiv.offsetHeight/2*l,He.isFirefox?De.Util.setCSSStyle(this._contentDiv,"-moz-transform","translate(0px,0px) rotate("+_+"deg) scale("+l+")"):He.isOpera?De.Util.setCSSStyle(this._contentDiv,"-o-transform","translate(0px,0px) rotate("+_+"deg) scale("+l+")"):He.isChrome||He.isSafari?De.Util.setCSSStyle(this._contentDiv,"-webkit-transform","translate(0px, 0px) rotate("+_+"deg) scale("+l+")"):He.isIE?De.Util.setCSSStyle(this._contentDiv,"-ms-transform","translate(0px,0px) rotate("+_+"deg) scale("+l+")"):De.Util.setCSSStyle(this._contentDiv,"transform","translate(0px,0px) rotate("+_+"deg) scale("+l+")")}},setVisibility:function(t){this._contentDiv.style.visibility=t},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv},getLabel:function(){return this._network.getLabel2(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label2.corner.radius")},getPointerLength:function(){return this.getStyle("label2.pointer.length")},getPointerWidth:function(){return this.getStyle("label2.pointer.width")},getPosition:function(){return this.getStyle("label2.position")},getXOffset:function(){return this.getStyle("label2.xoffset")},getYOffset:function(){return this.getStyle("label2.yoffset")},getPadding:function(){return this.getStyle("label2.padding")},getPaddingLeft:function(){return this.getStyle("label2.padding.left")},getPaddingRight:function(){return this.getStyle("label2.padding.right")},getPaddingTop:function(){return this.getStyle("label2.padding.top")},getPaddingBottom:function(){return this.getStyle("label2.padding.bottom")},getDirection:function(){return this.getStyle("label2.direction")},isFill:function(){return this.getStyle("label2.fill")},getFillColor:function(){return this.getStyle("label2.fill.color")},getGradient:function(){return this.getStyle("label2.gradient")},getGradientColor:function(){return this.getStyle("label2.gradient.color")},getOutlineWidth:function(){return this.getStyle("label2.outline.width")},getOutlineColor:function(){return this.getStyle("label2.outline.color")},getCap:function(){return this.getStyle("label2.cap")},getJoin:function(){return this.getStyle("label2.join")},getAlpha:function(){return this.getStyle("label2.alpha")},isShadowable:function(){return this.getStyle("label2.shadowable")}}),De.vector.HTMLAlarmAttachment=function(t,e){De.vector.HTMLAlarmAttachment.superClass.constructor.call(this,t,e),this._triangleDiv=De.Util.createDiv(),this._roundDiv=De.Util.createDiv(),this._contentDiv=De.Util.createDiv(),De.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),De.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),De.Util.setCSSStyle(this._contentDiv,"white-space","nowrap"),De.Util.setCSSStyle(this._contentDiv,"pointer-events","none"),this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Be.ext("twaver.vector.HTMLAlarmAttachment",De.vector.AlarmAttachment,{validate:function(){var t=(this.getFont("alarm.font"),this._network.getAlarmLabel(this._element));this._contentDiv.innerHTML=t,this._contentDiv.style.visibility="hidden",De.vector.HTMLAlarmAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(De.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(De.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(t){var e=this.isFill(),i=this.getOutlineWidth(),n=this._contentRect;if(this.getElementUI().setShadow(this,t),i>0||e){if(qe.drawRoundRect(t,n.x,n.y,n.width,n.height,this.getCornerRadius()),this._pointers){var s=this._ui.getZoomPointers(this,this._pointers);t.moveTo(s[0].x,s[0].y),t.lineTo(s[1].x,s[1].y),t.lineTo(s[2].x,s[2].y)}if(t.closePath(),i>0&&(t.lineWidth=i,t.strokeStyle=this.getOutlineColor(),t.lineCap=this.getCap(),t.lineJoin=this.getJoin(),t.stroke()),e){var r=this.getFillColor(),a=this.getGradient();a?qe.fill(t,r,a,this.getGradientColor(),this._viewRect):t.fillStyle=r,t.fill()}}var o=(this.getFont("alarm.font"),this._network.getAlarmLabel(this._element),this._network.getViewRect().x),h=this._network.getViewRect().y,l=this._network.getZoom(),c={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},u=c.x*l-o-this._contentDiv.offsetWidth/2*l+"px",d=c.y*l-h-this._contentDiv.offsetHeight/2*l+"px";this._contentDiv.style.left=u,this._contentDiv.style.top=d,this._contentDiv.style.setProperty("-webkit-transform","scale("+l+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null),this._network._debug&&qe.strokeRect(t,this._contentRect,"#DDDDDD"),De.vector.AlarmAttachment.superClass.paint.apply(this,arguments)},setVisibility:function(t){this._contentDiv.style.visibility=t},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),De.vector.BaseZoomManager=function(t){this.network=t,this.visibilityThresholds=t.visibilityThresholds},Be.ext("twaver.vector.BaseZoomManager",Object,{getZoom:function(){return this.network.getZoom()},getGraphicsZoom:function(){return 1},getSizeZoom:function(t){return 1},getAttachmentSizeZoom:function(t){var e=t.getElementUI();return this.getSizeZoom(e)},getLocationZoom:function(){return 1},_getZoomVisibilityThresholds:function(){return this.network.getZoomVisibilityThresholds()},_convertPointFromView:function(t){var e=t.x*this.getGraphicsZoom()-this.network.getViewRect().x,i=t.y*this.getGraphicsZoom()-this.network.getViewRect().y;return{x:e,y:i}},_getElementViewRect:function(t,e){var i=this.getLocationZoom(),n=this.getSizeZoom(t);if(1==i&&1==n)return e;var s=this._getZoomPoint(t),r=s.x,a=s.y;return null==e&&console.log("View rect is null"),{x:r*i+(e.x-r)*n,y:a*i+(e.y-a)*n,width:e.width*n,height:e.height*n}},_invalidateZoom:function(){this.network.invalidateElementUIs()},_getGroupChildrenRects:function(t){var e=new gn;return t.getChildren().forEach(function(t){if(t instanceof On){var i=this.network.getElementUI(t);if(i){var n=i.getZoomViewRect(this);n&&e.add(n)}}},this),e},_zoomGraphicsBegin:function(t){var e=this.network,i=this.getGraphicsZoom();t.scale(i,i),t.translate(-e.viewRect.x/i,-e.viewRect.y/i)},_getEditZoomPoints:function(t,e){var i=this.getLocationZoom(),n=this.getSizeZoom(t);if(1==i&&1==n||t instanceof De.vector.LinkUI&&!(t instanceof De.vector.ShapeLinkUI))return e;var s;s=t instanceof De.vector.ShapeLinkUI?Ge.getCenterPoint(Ge.getRect(e)):this._getZoomPoint(t);var r=s.x,a=s.y;if(e.forEach){var o,h=new gn;return e.forEach(function(t){t instanceof gn?(o=new gn,t.forEach(function(t){o.add({x:r*i+(t.x-r)*n,y:a*i+(t.y-a)*n})}),h.add(o)):h.add({x:r*i+(t.x-r)*n,y:a*i+(t.y-a)*n})}),h}return e.x?{x:r*i+(e.x-r)*n,y:a*i+(e.y-a)*n}:void 0},_getShapeNodeZoomPoints:function(t,e,i){var n=this.getLocationZoom(),s=this.getSizeZoom(t);if(1==n&&1==s)return e;i&&(n=1/n,s=1/s);var r,a=Ge.getRect(e),o=a.x+a.width/2,h=a.y+a.height/2,l=new gn;return e.forEach(function(t){t instanceof gn?(r=new gn,t.forEach(function(t){r.add({x:o*n+(t.x-o)*s,y:h*n+(t.y-h)*s})}),l.add(r)):l.add({x:o*n+(t.x-o)*s,y:h*n+(t.y-h)*s})}),l},_getShapeLinkZoomPoints:function(t,e){var i=this.getLocationZoom(),n=i;if(1==i&&1==n)return t;e&&(i=1/i,n=1/n);var s,r=Ge.getRect(t),a=r.x+r.width/2,o=r.y+r.height/2,h=new gn;return t.forEach(function(t){t instanceof gn?(s=new gn,t.forEach(function(t){s.add({x:a*i+(t.x-a)*n,y:o*i+(t.y-o)*n})}),h.add(s)):h.add({x:a*i+(t.x-a)*n,y:o*i+(t.y-o)*n})}),h},_getLogicalPoint:function(t,e){var i,n=e?this.getZoom():this.getGraphicsZoom(),s=this.network;if(He.isTouchable&&t.changedTouches&&t.changedTouches.length>0){var r=s._view.getBoundingClientRect(),a=t.changedTouches[0],o=He.isAndroid?0:Ci.scrollLeft(),h=He.isAndroid?0:Ci.scrollTop();return i={x:(a.clientX+s.viewRect.x-r.left-o)/n,y:(a.clientY+s.viewRect.y-r.top-h)/n}}return i=He.isFirefox?{x:(t.layerX+s.viewRect.x)/n,y:(t.layerY+s.viewRect.y)/n}:{x:(t.offsetX+s.viewRect.x)/n,y:(t.offsetY+s.viewRect.y)/n}},_getVisibleRect:function(t){return t},_getElementZoomRect:function(t,e){var i=this.getLocationZoom(),n=this.getSizeZoom(t);if(1==i&&1==n)return Be.cloneRect(e);var s=null!=t?this._getZoomPoint(t):{x:e.x+e.width/2,y:e.y+e.height/2},r=s.x,a=s.y;return{x:r*i+(e.x-r)*n,y:a*i+(e.y-a)*n,width:e.width*n,height:e.height*n}},_reverseElementZoomRect:function(t,e){var i=this.getLocationZoom(),n=this.getSizeZoom(t);if(1==i&&1==n)return Be.cloneRect(e);var s=null!=t?this._getZoomPoint(t):{x:e.x+e.width/2,y:e.y+e.height/2},r=s.x,a=s.y;return{x:r+(e.x-r*i)/n,y:a+(e.y-a*i)/n,width:e.width/n,height:e.height/n}},_getZoomContentRect:function(t,i,n,s,r,a){var o=this.getSizeZoom(t.getElementUI()),h=this.getAttachmentSizeZoom(t),l=t.getElementUI();return a==e?l instanceof De.vector.GroupUI&&l._shapeRect?{x:s.x*r+1*(i.x-s.x)+(n.x-i.x)*h,y:s.y*r+1*(i.y-s.y)+(n.y-i.y)*h,width:n.width,height:n.height}:{x:s.x*r+(i.x-s.x)*o+(n.x-i.x)*h,y:s.y*r+(i.y-s.y)*o+(n.y-i.y)*h,width:n.width,height:n.height}:{x:s.x*r+(i.x-s.x)*o+(n.x-i.x)*h,y:s.y*r+(i.y-s.y)*o+(n.y-i.y)*h+a*(t.textHeight-4)*h,width:n.width,height:t.textHeight}},_getAttachmentZoomRect:function(t,i,n){var s=this.getLocationZoom(),r=t.getElementUI(),a=this.getSizeZoom(t.getElementUI()),o=this.getAttachmentSizeZoom(t),h=t._pointers;if(1==s&&1==o&&1==a)return n==e?i:{x:i.x,y:i.y+n*(t.textHeight-4),width:i.width,height:t.textHeight};var r=t.getElementUI(),l=this._getZoomPoint(r,t),c=(l.x,l.y,t.getPosition?t.getPosition():"center"),u=h?h[0]:Xn.get(c,i);return n==e?r instanceof De.vector.LinkUI||r instanceof De.vector.GroupUI&&r._shapeRect?this._getZoomContentRect(t,u,i,l,1):this._getZoomContentRect(t,u,i,l,s):this._getZoomContentRect(t,u,i,l,s,n)},_getZoomPoint:function(t,e){var i,n,s=t._element;if(s instanceof De.Follower&&s.getHost()&&s.getHost()instanceof De.Grid)return i=s.getHost(),n=i.getRect(),{x:n.x+n.width/2,y:n.y+n.height/2};if(n=t.getBodyRect(),t instanceof De.vector.LinkUI&&e&&e.getPosition){if(e.getXOffset(),e.getYOffset(),"from"===e.getPosition())return t._fromPoint;if("to"===e.getPosition())return t._toPoint}return{x:n.x+n.width/2,y:n.y+n.height/2}},_getZoomPointers:function(t,e,i){if(i){var n=this._getZoomPoint(e),s=this.getLocationZoom(),r=this.getSizeZoom(e),a=this.getAttachmentSizeZoom(t),o=i[0];return e instanceof De.vector.LinkUI?[{x:n.x+(o.x-n.x)*r,y:n.y+(o.y-n.y)*r},{x:n.x+(o.x-n.x)*r+(i[1].x-o.x)*a,y:n.y+(o.y-n.y)*r+(i[1].y-o.y)*a},{x:n.x+(o.x-n.x)*r+(i[2].x-o.x)*a,y:n.y+(o.y-n.y)*r+(i[2].y-o.y)*a}]:e instanceof De.vector.GroupUI&&e._shapeRect?[{x:n.x+1*(o.x-n.x),y:n.y+1*(o.y-n.y)},{x:n.x+1*(o.x-n.x)+(i[1].x-o.x)*a,y:n.y+1*(o.y-n.y)+(i[1].y-o.y)*a},{x:n.x+1*(o.x-n.x)+(i[2].x-o.x)*a,y:n.y+1*(o.y-n.y)+(i[2].y-o.y)*a}]:[{x:n.x*s+(o.x-n.x)*r,y:n.y*s+(o.y-n.y)*r},{x:n.x*s+(o.x-n.x)*r+(i[1].x-o.x)*a,y:n.y*s+(o.y-n.y)*r+(i[1].y-o.y)*a},{x:n.x*s+(o.x-n.x)*r+(i[2].x-o.x)*a,y:n.y*s+(o.y-n.y)*r+(i[2].y-o.y)*a}]}},_getZoomHotSpot:function(t,e){if(e){var i=this._getZoomPoint(t),n=this.getLocationZoom(),s=this.getSizeZoom(t);return{x:i.x*n+(e.x-i.x)*s,y:i.y*n+(e.y-i.y)*s}}return null},limitZoom:function(t){return t},_isVisible:function(t){var e,i=this._getZoomVisibilityThresholds(),n=i[t];if(null!=n){var s=i.zoomName;if(e="sizeZoom"==s?this.getSizeZoom():"locationZoom"==s?this.getLocationZoom():"graphicsZoom"==s?this.getGraphicsZoom():this.getZoom(),n>e)return!1}return!0},isElementVisible:function(t){var e=this.getZoom(),i=this._isVisible("element",e);return i&&t instanceof De.Link?this.isLinkVisible(t):i},isLinkVisible:function(t){var e=this.getZoom();return this._isVisible("link",e)},isLabelVisible:function(t){var e=this.getZoom();return this._isVisible("label",e)},isAttachmentVisible:function(t){var e=this.getZoom();return this._isVisible("attachment",e)},isAlarmBalloonVisible:function(t){var e=this.getZoom();return this._isVisible("alarmBallon",e)},_getAttachmentOutLineWidth:function(t){return t.getOutlineWidth()},_getAttachmentZoomOutLineRect:function(t,e){var i=this.getLocationZoom(),n=this.getAttachmentSizeZoom(t);if(1==i&&1==n)return e;var s=this._getAttachmentZoomRect(t,e,null),r=t.getElement();return this.isAttachmentVisible(r)?(t instanceof De.vector.LabelAttachment||t instanceof De.vector.Label2Attachment)&&!this.isLabelVisible(r)?{x:s.x,y:s.x,width:0,height:0}:t instanceof De.vector.AlarmAttachment&&!this.isAlarmBalloonVisible(r)?{x:s.x,y:s.x,width:0,height:0}:{x:s.x,y:s.y,width:s.width*n,height:s.height*n}:{x:s.x,y:s.x,width:0,height:0}},_drawText:function(t,e,i,n,s,r,a){var o=this.getLocationZoom(),h=this.getAttachmentSizeZoom(t);1!=o&&1!=h?(e.translate(n.x,n.y),e.scale(h,h),qe.drawText(e,i,{x:0,y:0,width:n.width,height:n.height},s,r,a),e.scale(1/h,1/h),e.translate(-n.x,-n.y)):qe.drawText(e,i,n,s,r,a)},_getOffset:function(t,e){var i=this.getLocationZoom();return{x:(t.x-e.x)/i,y:(t.y-e.y)/i}}});var Xn={"topleft.topleft":function(t){return{x:t.x+t.width,y:t.y+t.height}},"topleft.topright":function(t){return{x:t.x,y:t.y+t.height}},"top.top":function(t){return{x:t.x+t.width/2,y:t.y+t.height}},"topright.topleft":function(t){return{x:t.x+t.width,y:t.y+t.height}},"topright.topright":function(t){return{x:t.x,y:t.y+t.height}},topleft:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},top:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},topright:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},"topleft.bottomleft":function(t){return{x:t.x+t.width,y:t.y}},"topleft.bottomright":function(t){return{x:t.x,y:t.y}},"top.bottom":function(t){return{x:t.x+t.width/2,y:t.y}},"topright.bottomleft":function(t){return{x:t.x+t.width,y:t.y}},"topright.bottomright":function(t){return{x:t.x,y:t.y}},"left.left":function(t){return{x:t.x+t.width,y:t.y+t.height/2}},left:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},"left.right":function(t){return{x:t.x,y:t.y+t.height/2}},center:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},"right.left":function(t){return{x:t.x+t.width,y:t.y+t.height/2}},right:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},"right.right":function(t){return{x:t.x,y:t.y+t.height/2}},"bottomleft.topleft":function(t){return{x:t.x+t.width,y:t.y+t.height}},"bottomleft.topright":function(t){return{x:t.x,y:t.y+t.height}},"bottom.top":function(t){return{x:t.x+t.width/2,y:t.y+t.height}},"bottomright.topleft":function(t){return{x:t.x+t.width,y:t.y+t.height}},"bottomright.topright":function(t){return{x:t.x,y:t.y+t.height}},bottomleft:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},bottom:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},bottomright:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},"bottomleft.bottomleft":function(t){return{x:t.x+t.width,y:t.y}},"bottomleft.bottomright":function(t){return{x:t.x,y:t.y}},"bottom.bottom":function(t){return{x:t.x+t.width/2,y:t.y}},"bottomright.bottomleft":function(t){return{x:t.x+t.width,y:t.y}},"bottomright.bottomright":function(t){return{x:t.x,y:t.y}},from:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},to:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},get:function(t,e){if(!e)throw"rect can not be null";var i=Xn[t];if(i)return i(e);throw"Can not resolve '"+t+"' position"}};De.vector.PhysicalZoomManager=function(t){De.vector.PhysicalZoomManager.superClass.constructor.apply(this,arguments)},Be.ext("twaver.vector.PhysicalZoomManager",De.vector.BaseZoomManager,{getGraphicsZoom:function(){return this.getZoom()},_invalidateZoom:function(){}}),De.vector.LogicalZoomManager=function(t,e){De.vector.LogicalZoomManager.superClass.constructor.apply(this,arguments),this.sizeChange=e},Be.ext("twaver.vector.LogicalZoomManager",De.vector.BaseZoomManager,{getLocationZoom:function(){return this.getZoom()},getSizeZoom:function(t){return this.sizeChange?this.getZoom():1}}),De.vector.MixedZoomManager=function(t,e){De.vector.MixedZoomManager.superClass.constructor.call(this,t,e)},Be.ext("twaver.vector.MixedZoomManager",De.vector.LogicalZoomManager,{}),function(){function t(t){n[t]=function(){return this.getZoom()>1?e[t].apply(this,arguments):i[t].apply(this,arguments)}}var e=De.vector.LogicalZoomManager.prototype,i=De.vector.PhysicalZoomManager.prototype,n=De.vector.MixedZoomManager.prototype;for(var s in i)"function"==typeof i[s]&&"constructor"!=s&&(e.hasOwnProperty(s)||i.hasOwnProperty(s))&&t(s);n._invalidateZoom=function(){this.network.invalidateElementUIs()}}(),De.vector.interaction.BaseInteraction=function(t){this.network=t},Be.ext("twaver.vector.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},repaint:function(){this.network.repaintTopCanvas()},getOffset:function(t,e){return this.network.getOffset(t,e)},convertPointFromView:function(t){return this.network.convertPointFromView(t)},convertFromUIToMarkerRect:function(t,e,i,n){var s=this.network.zoomManager,r=s.getLocationZoom(),a=s.getGraphicsZoom(),o=s.getSizeZoom(this.network.getElementUI(n));return{x:t.x*r*a-this.network.getViewRect().x+e*r*a,y:t.y*r*a-this.network.getViewRect().y+i*r*a,width:t.width*o*a,height:t.height*o*a}},getMarkerPoint:function(t){var e;if(He.isTouchable&&t.changedTouches&&t.changedTouches.length>0){var i=t.changedTouches[0];return e={x:i.clientX,y:i.clientY}}return e=He.isFirefox?{x:t.layerX,y:t.layerY}:{x:t.offsetX,y:t.offsetY}},paint:function(t){},addListener:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];je.addEventListener(e,"handle_"+e,this.network.getView(),this)}},removeListener:function(){for(var t=0;t<arguments.length;t++)je.removeEventListener(arguments[t],this.network.getView(),this)},_handle_mousedown:function(t){0===t.button&&(this._startLogical=this.network.getLogicalPoint2(t),this._startClient=je.getClientPoint(t),this._startLogical&&je.handle_mousedown(this,t))},_handle_mousemove:function(t){this._endLogical={x:this._startLogical.x+(t.clientX-this._startClient.x)/this.network.getGraphicsZoom(),y:this._startLogical.y+(t.clientY-this._startClient.y)/this.network.getGraphicsZoom()}},_handle_mouseup:function(t){delete this._startClient,delete this._startLogical,delete this._endLogical}}),De.vector.interaction.DefaultInteraction=function(t,e){De.vector.interaction.DefaultInteraction.superClass.constructor.call(this,t),this.lazyMode=e},Be.ext("twaver.vector.interaction.DefaultInteraction",De.vector.interaction.BaseInteraction,{
setUp:function(){this.addListener("mousedown","mouseover","mouseout","keydown"),He.isFirefox?je.addEventListener("DOMMouseScroll","handleMouseWheel",this.network.getView(),this):je.addEventListener("mousewheel","handleMouseWheel",this.network.getView(),this),je.addEventListener("mouseup","handle_mouseup",t,this),je.addEventListener("dblclick","handleDoubleClicked",this.network.getView(),this),this._oldCursor=this.network.getView().style.cursor,this.network.addPropertyChangeListener(this.handleViewRectChange,this),this.validateScrollBar(),this.network.addMarker(this),this.network.getView().oncontextmenu=function(t){t.preventDefault()},this._createZoomDiv()},tearDown:function(){this.removeListener("mousedown","mouseover","mouseout","keydown"),He.isFirefox?je.removeEventListener("DOMMouseScroll",this.network.getView(),this):je.removeEventListener("mousewheel",this.network.getView(),this),je.removeEventListener("mouseup",t,this),je.removeEventListener("dblclick",this.network.getView(),this),this.network.removePropertyChangeListener(this.handleViewRectChange,this),this.end(),this.network.removeMarker(this),this._zoomDiv=null},_createZoomDiv:function(){if(null==this._zoomDiv){this._zoomDiv=Ve.createElement("div"),this._zoomLabel=Ve.createElement("span"),this._zoomLabel.style.display="block",this._zoomLabel.style.textAlign="center";var e=Ve.createElement("button");e.innerHTML="Reset to default",this._zoomDiv.appendChild(this._zoomLabel),this._zoomDiv.appendChild(e);var i=kn,n=this._zoomDiv.style;n.position="absolute",n.color=i.TOOLTIP_COLOR,n.background=i.TOOLTIP_BACKGROUND,n.fontSize=i.TOOLTIP_FONT_SIZE,n.padding=i.TOOLTIP_PADDING,n.border=i.TOOLTIP_BORDER,n.borderRadius=i.TOOLTIP_BORDER_RADIUS,n.boxShadow=i.TOOLTIP_BOX_SHADOW,n.zIndex=i.TOOLTIP_ZINDEX,n.setProperty&&n.setProperty("-webkit-box-shadow",i.TOOLTIP_BOX_SHADOW,null);var s=this;e.onclick=function(t){s.network.setZoom(1),s._setZoomDivVisible(!1)};var r=this._zoomDiv,a=function(){return r.style.opacity=parseFloat(r.style.opacity)-.05,parseFloat(r.style.opacity)<=.05?(s._setZoomDivVisible(!1),void(r._clearTimeout=null)):void(r._clearTimeout=setTimeout(r._clearFunc,100))};r._clearFunc=a,r.onmouseover=function(e){e||(e=t.event);for(var i=e.relatedTarget?e.relatedTarget:e.fromElement;i&&i!=r;)i=i.parentNode;i!=r&&(r._clearTimeout&&(clearTimeout(r._clearTimeout),r._clearTimeout=null),r.style.opacity=1)},r.onmouseout=function(e){e||(e=t.event);for(var i=e.relatedTarget?e.relatedTarget:e.toElement;i&&i!=r;)i=i.parentNode;i!=r&&(r._clearTimeout=setTimeout(r._clearFunc,10))}}},_isZoomDivVisible:function(){return null!=this._zoomDiv&&null!=this._zoomDiv.parentNode},_getZoomDiv:function(){return this._zoomDiv||this._createZoomDiv(),this._zoomDiv},_setZoomDivVisible:function(t,e,i){var n=this._getZoomDiv();t?(this._zoomLabel.innerHTML=i,n.style.opacity=1,this._isZoomDivVisible()||this.network.getView().appendChild(n),n.style.left=kn.TOOLTIP_XOFFSET+"px",n.style.top=kn.TOOLTIP_YOFFSET+"px",n._clearTimeout&&(clearTimeout(n._clearTimeout),n._clearTimeout=null),n._clearTimeout=setTimeout(n._clearFunc,250)):n.parentNode&&n.parentNode.removeChild(n)},handleViewRectChange:function(t){("viewRect"==t.property||"canvasSizeChange"==t.property)&&this.validateScrollBar()},getScrollBarWidth:function(){return this.network.getScrollBarWidth()},getScrollBarColor:function(){return"#cccccc"},validateScrollBar:function(){if(this.hThumbRect=null,this.vThumbRect=null,0==this.network.isScrollBarVisible())return void this.repaint();var t=this.network.getViewRect().height,e=this.network.getViewRect().width,i=this.network.getViewRect().x,n=this.network.getViewRect().y,s=this.network.getCanvasSize(),r=this.network._unionBounds,a=r.x,o=r.y,h=r.width,l=r.height,c=s.width,u=s.height,d=e,f=t,g=!1,_=!1;(i>a||c>e+i)&&(_=!0),(n>o||u>n+t)&&(g=!0);var p,v,m,y=0,A=0,x=0,w=0,b=d,S=f,C=this.getScrollBarWidth();_&&(g&&(b-=C),w=C,A=f-C,i>a&&i+e>c?(p=i-a,p=p*b/(p+d),y=p,x=b-p):a>i&&c>i+e?(p=c-(i+e),p=b*p/(p+d),y=0,x=b-p):(v=i-a,m=c-(i+e),v=b*v/h,m=b*m/h,y=v,x=d-v-m),this.hThumbRect={x:y,y:A,width:x,height:w}),y=0,A=0,x=0,w=0,b=d,S=f,g&&(_&&(S-=C),x=C,y=d-C,n>o&&n+t>u?(p=n-o,p=S*p/(p+f),A=p,w=S-p):o>n&&u>n+t?(p=u-(n+t),p=S*p/(p+f),A=0,w=S-p):(v=n-o,m=u-(n+t),v=S*v/l,m=S*m/l,A=v,w=S-v-m),this.vThumbRect={x:y,y:A,width:x,height:w}),this.network.setHScrollBarVisible(null!=this.hThumbRect),this.network.setVScrollBarVisible(null!=this.vThumbRect),this.repaint()},scrollXOffset:function(t){var e=this.network.getViewRect().height,i=this.network.getViewRect().width,n=this.network.getViewRect().x,s=this.network.getViewRect().y,r=30;t&&(r=-30),this.network.setViewRect(n+r,s,i,e)},scrollYOffset:function(t){var e=this.network.getViewRect().height,i=this.network.getViewRect().width,n=this.network.getViewRect().x,s=this.network.getViewRect().y,r=30;t&&(r=-30),this.network.setViewRect(n,s+r,i,e)},handle_mouseover:function(t){1!=this.scrollBarVisible&&(this.scrollBarVisible=!0,this.repaint())},handle_mouseout:function(t){0!=this.scrollBarVisible&&(this.scrollBarVisible=!1,this.repaint(),this.end(t))},handle_keydown:function(t){this.currentKeyEvent=t,this.addListener("keyup"),Li.handleKeyDown(this.network,t)},handle_keyup:function(t){this.currentKeyEvent=null,this.removeListener("keyup")},start:function(e){this.end(e,!0),this.lastPoint=this.network.getLogicalPoint2(e),this.startPoint=this.network.getLogicalPoint2(e),this.lastPanPoint=this.getMarkerPoint(e),this.lazyMode&&(this.pressPoint=this.lastPoint),je.addEventListener("mousemove","handle_mousemove",t,this)},end:function(e,i){if(this.vBarDownPoint=null,this.hBarDownPoint=null,i||(this.network.getView().style.cursor=this._oldCursor),this.isMoving){if(this.lazyMode){if(null!=this.dragPoint&&null!=this.pressPoint){var n=this,s=function(){n.network.fireInteractionEvent({kind:"lazyMoveEnd",event:e}),n.network.setMovingElement(!1)},r=this.getOffset(this.dragPoint,this.pressPoint),a=r.x,o=r.y;this.network.moveSelectedElements(a,o,this.network.isLazyMoveAnimate(),s)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:e}));if(this.isParenting()){null==this.parent&&(this.parent=this.network.getCurrentSubNetwork());var n=this;this.network.getMovableSelectedElements().forEach(function(t){t.setParent(n.parent)},this.network)}this.parentProcess(e,!0),this.isParenting()&&this.repaint(),this.network.invalidateCanvasSize(),this.lastPoint=null,this.dragPoint=null,this.pressPoint=null,this.repaint()}if(this.isSelecting&&this.startPoint){if(this.endPoint&&this.startPoint.x!==this.endPoint.x&&this.startPoint.y!==this.endPoint.y){var h=Ge.getRect([this.startPoint,this.endPoint]),l=this.network.getElementsAtRect(h,this.getIntersectMode(),this.network.getRectSelectFilter());if(l&&l.size()>0){var c=this.network.getSelectionModel(),u=c.toSelection();l.forEach(function(t){c.contains(t)?u.remove(t):u.add(t)},this),c.setSelection(u)}this.network.fireInteractionEvent({kind:"selectEnd",event:e})}this.network.setSelectingElement(!1),this.startPoint=null,this.endPoint=null,this.repaint()}this.isMouseDown=!1,je.removeEventListener("mousemove",t,this)},_isDragToSelect:function(t){return!this.network._dragToPan},handle_mousedown:function(t){var e=this.network;if(t.target==e.getView()||t.target==e._topCanvas||t.target==e._rootCanvas){if(this.isMoving=!1,this.isSelecting=!1,this.hBarDownPoint=null,this.vBarDownPoint=null,this._setZoomDivVisible(!1),!this.network.isValidEvent(t)){var i=this.getMarkerPoint(t);return this.start(t),null!=this.vThumbRect&&Ge.containsPoint(this.vThumbRect,i.x,i.y)&&(this.vBarDownPoint={x:t.screenX,y:t.screenY},this.vBarDownOffset=this.vBarDownPoint.y-this.vThumbRect.y),void(null!=this.hThumbRect&&Ge.containsPoint(this.hThumbRect,i.x,i.y)&&(this.hBarDownPoint={x:t.screenX,y:t.screenY},this.hBarDownOffset=this.hBarDownPoint.x-this.hThumbRect.x))}this.network.isFocusOnClick()&&De.Util.setFocus(this.network.getView());var n=this.network.getElementAt(t);if(this.network.isSelectingElement()||this.network.isEditingElement()||null==n||(this.network.isMovable(n)&&this.network.getElementBox().getSelectionModel().isSelectable(n)?this.isMoving=!0:this.network.getView().style.cursor="pointer",this.start(t)),!this.network.isSelectingElement()&&!this.network.isEditingElement()){var s=this.network.getSelectionModel();null==n||n&&!this.network.getElementBox().getSelectionModel().isSelectable(n)?(Be.isCtrlDown(t)?this.isSelecting=!0:this._isDragToSelect(t)?(this.isSelecting=!0,s.clearSelection()):this.network.isRectSelectEnabled()&&(s.clearSelection(),this.network.getView().style.cursor="pointer"),this.start(t)):Be.isCtrlDown(t)?s.contains(n)?s.removeSelection(n):s.appendSelection(n):s.contains(n)||s.setSelection(n)}this.handleClicked(t,n),this.isMouseDown=!0}},handle_mousemove:function(t){this._setZoomDivVisible(!1);var e=this.network.getLogicalPoint2(t);if(e){var i={x:t.screenX,y:t.screenY},n=this.network.getCanvasSize(),s=this.network.getViewRect().height,r=this.network.getViewRect().width,a=this.getScrollBarWidth();if(null!=this.hBarDownPoint){var o=i.x-this.hBarDownPoint.x;return this.hBarDownPoint=i,void this.network.setViewOffSet(o*n.width/(r-a),0)}if(null!=this.vBarDownPoint){var h=i.y-this.vBarDownPoint.y;return this.vBarDownPoint=i,void this.network.setViewOffSet(0,h*n.height/(s-a))}if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.isMoving||!this.isMouseDown||Be.isCtrlDown(t))if(this.isSelecting&&(Be.isCtrlDown(t)||this._isDragToSelect()))this.network.setSelectingElement(!0),this.network.fireInteractionEvent(null==this.endPoint?{kind:"selectStart",event:t}:{kind:"selectBetween",event:t}),this.endPoint=e,this.repaint();else if(this.isMoving||this.isSelecting||!this.isMouseDown)this.end(t);else{if(!this.lastPanPoint||!this.network._dragToPan)return;var e=this.getMarkerPoint(t);if(!e)return;var l=e.x-this.lastPanPoint.x,c=e.y-this.lastPanPoint.y;this.network.panByOffset(-l,-c),this.lastPanPoint=e}else{var u=this.getOffset(e,this.lastPoint);if(this.xoffset=u.x,this.yoffset=u.y,Math.abs(this.xoffset)<1&&Math.abs(this.yoffset)<1)return;this.lazyMode?null==this.dragPoint?(this.network.fireInteractionEvent({kind:"lazyMoveStart",event:t}),this.network.setMovingElement(!0)):this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:t}):(this.lastPoint=e,this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:t})),this.network.moveSelectedElements(this.xoffset,this.yoffset)),this.parentProcess(t,!1),this.lazyMode&&(this.dragPoint=e),(this.lazyMode||this.isParenting())&&this.repaint()}}},handleMouseWheel:function(t){if(Ve.activeElement===this.network.getView()){if(!this.network._wheelToZoom)return void this._handleMouseWheelScroll(t);je.preventDefault(t);var e={x:t.offsetX||t.layerX,y:t.offsetY||t.layerY},i=this.network.getZoom();t.wheelDelta&&t.wheelDelta>0||t.detail&&t.detail<0?this.network.setZoom(1.1*i,e):this.network.setZoom(i/1.1,e),this._setZoomDivVisible(this.network.isZoomDivVisible(),t,"Zoom : "+parseFloat(this.network.getZoom().toFixed(4)))}},_handleMouseWheelScroll:function(t){je.preventDefault(t);var e=!1,i=this._getVisibleScrollBar();null!=i&&(e=t.wheelDelta?t.wheelDelta>0:t.detail<0,"v"==i?this.scrollYOffset(e):this.scrollXOffset(e))},handle_mouseup:function(t){this.end(t)},isParenting:function(){return this.pressPoint&&null!=this.currentKeyEvent&&80===this.currentKeyEvent.keyCode},parentProcess:function(t,e){var i=null;this.parent=null;var n=this;if(!e&&this.isParenting()){var s={},r=this.network.getLogicalPoint2(t);s.x=r.x-1,s.y=r.y-1,s.width=2,s.height=2;var a=this.network.getElementsAtRect(s,!0);if(a&&a.size()>0)for(var o=a.size(),h=0;o>h;h++){var l=a.get(h);if(!n.network.getElementBox().getSelectionModel().contains(l)){n.parent=l;break}}}else this.parent=null;null!=this.parent&&(i=this.network.getElementUI(this.parent).getViewRect()),this.parentRect=null==i||e?null:i},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()||"contain"!==this.network.getSelectMode()&&(this.startPoint.x>this.endPoint.x&&this.startPoint.y>this.endPoint.y)},_getVisibleScrollBar:function(){return 0==this.network.isScrollBarVisible()?null:null!=this.vThumbRect?"v":null!=this.hThumbRect?"h":null},paintScroll:function(t){if(0!=this.network.isScrollBarVisible()&&(0!=this.scrollBarVisible||null!=this.hBarDownPoint||null!=this.vBarDownPoint)){var e=this.getScrollBarWidth(),i=this.network.getViewRect().height,n=this.network.getViewRect().width;t.save();var s,r=this.getScrollBarColor();null!=this.hThumbRect&&(s=t.createLinearGradient(this.hThumbRect.x,this.hThumbRect.y,this.hThumbRect.x,this.hThumbRect.y+this.hThumbRect.height),s.addColorStop(0,r),s.addColorStop(1,"#666666"),this.paintRoundRect(t,this.getScrollBarColor(),.5,0,i-e,n-e,e,e/2),this.paintRoundRect(t,s,.9,this.hThumbRect.x,this.hThumbRect.y+1,this.hThumbRect.width,this.hThumbRect.height-2,e/2)),null!=this.vThumbRect&&(s=t.createLinearGradient(this.vThumbRect.x,this.vThumbRect.y,this.vThumbRect.x+this.vThumbRect.width,this.vThumbRect.y),s.addColorStop(0,r),s.addColorStop(1,"#666666"),this.paintRoundRect(t,this.getScrollBarColor(),.5,n-e,0,e,i-e,e/2),this.paintRoundRect(t,s,.9,this.vThumbRect.x+1,this.vThumbRect.y,this.vThumbRect.width-2,this.vThumbRect.height,e/2)),t.restore()}},paintRoundRect:function(t,e,i,n,s,r,a,o){t.beginPath(),t.globalAlpha=i,t.fillStyle=e,qe.drawRoundRect(t,n,s,r,a,o),t.fill()},paint:function(t){if(this.paintScroll(t),this.network.isSelectingElement()){if(null==this.startPoint||null==this.endPoint)return;var e=this.convertPointFromView(this.startPoint),i=this.convertPointFromView(this.endPoint),n=e.x,s=e.y,r=i.x,a=i.y,o=Ge.getRect([{x:n,y:s},{x:r,y:a}]);if(null!=o){t.beginPath();var h=this.network.getSelectOutlineWidth(),l=this.getIntersectMode()?this.network.getSelectFillColor():null;t.strokeStyle=this.network.getSelectOutlineColor(),t.lineWidth=h,Un.rect(t,o.x,o.y,o.width,o.height,l,this.network.getSelectOutlineColor()),t.closePath()}}else{if(this.lazyMode){if(null==this.pressPoint||null==this.dragPoint)return;t.beginPath();var c=this.getOffset(this.dragPoint,this.pressPoint),u=c.x,d=c.y,f=this.network.getMovableSelectedElements(),g=f.size(),_=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,h=this.network.getLazyMoveOutlineWidth(),p=this.network.getLazyMoveOutlineColor();t.strokeStyle=p,t.lineWidth=h,t.fillStyle=_;for(var v=0;g>v;v++){var m=f.get(v),y=this.network.getElementUI(m);if(y){var A=this.convertFromUIToMarkerRect(y.getViewRect(),u,d);Un.rect(t,A.x,A.y,A.width,A.height)}}t.fill(),t.stroke()}if(this.parentRect){t.beginPath();var _=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,h=this.network.getLazyMoveOutlineWidth(),p=this.network.getLazyMoveOutlineColor();t.strokeStyle=p,t.lineWidth=h,t.fillStyle=_;var A=this.parentRect;Un.rect(t,A.x,A.y,A.width,A.height),t.fill(),t.stroke()}}},handleClicked:function(t,e){Li.handleClicked(this.network,t,e)},handleDoubleClicked:function(t){var e=this.network.getElementAt(t);Li.handleDoubleClicked(this.network,t,e)}}),De.vector.interaction.CreateElementInteraction=function(t,e){e||(e=De.Node),this.elementFunction=De.Util.isTypeOf(e,De.Node)?function(t){var i=new e;return i instanceof De.Node&&i.setCenterLocation(t),i}:e,De.vector.interaction.CreateElementInteraction.superClass.constructor.call(this,t)},Be.ext("twaver.vector.interaction.CreateElementInteraction",De.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(t){var e=this.network.getLogicalPoint2(t);if(e){var i=this.elementFunction(e);i&&this.network.addElementByInteraction(i)}}}),De.vector.interaction.EditInteraction=function(t,e){this.lazyMode=e,this.pointIndex=-1,this.linkPointsType=null,De.vector.interaction.EditInteraction.superClass.constructor.call(this,t)},Be.ext("twaver.vector.interaction.EditInteraction",De.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear(),this.network.removeMarker(this)},paint:function(t){if(1==this.lazyMode&&null!=this.resizingRect){t.lineWidth=this.network.getResizeLineWidth();var e=this.convertFromUIToMarkerRect(this.resizingRect,0,0,this.node);t.save(),De.Util.rotateCanvas(t,e,this.node.getAngle()),t.beginPath(),Un.rect(t,e.x,e.y,e.width,e.height,null,this.network.getResizeLineColor()),t.restore()}this.isStartRotate&&this.showRotateScale(t)},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.network.repaintTopCanvas()},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(t){this.cursorID=t,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},handle_mousedown:function(t){if(0===t.button)if(!Be.isAltDown(t)||this.network.isEditingElement())!this.network.isEditingElement()||this.isStart||this.isStartRotate||(this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:t,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?Be.isAltDown(t)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:t,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink?Be.isAltDown(t)?this.pointIndex>=0&&(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:t,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(t)));else{var e=this.network.getElementAt(t),i=this.network.getLogicalPoint2(t);if(e instanceof De.ShapeNode){var n=this.getPointIndex(this.network.getShapeNodeZoomPoints(e),i,!0);n>0&&(this._handle_mousedown(t),this.pointIndex=n,this.shapeNode=e,e.addPoint(i,n),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:t,element:e,pointIndex:n}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:e,pointIndex:n}))}if(e instanceof De.ShapeLink){var s=new De.List(e.getPoints()),r=this.network.getElementUI(e);s.add(r.getFromPoint(),0),s.add(r.getToPoint());var n=this.getPointIndex(s,i)-1;n>0&&(this._handle_mousedown(t),this.pointIndex=n,this.shapeLink=e,e.addPoint(i,n),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:t,element:e,pointIndex:n}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:e,pointIndex:n}))}}},handle_mouseup:function(t){if(this.isStart){var e=this.network.getLogicalPoint2(t);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var i=this,n=new De.animate.AnimateBounds(this.node,this.resizingRect,function(){i.network.fireInteractionEvent({kind:"lazyResizeEnd",event:t,element:i.node,resizeDirection:i.resizeDirection}),i.clear()});De.animate.AnimateManager.start(n)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:t,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:t,element:this.node,resizeDirection:this.resizeDirection});else this.shapeNode&&this.pointIndex>=0&&e?(this._resetShapeNodePoints(e),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:t,element:this.shapeNode,pointIndex:this.pointIndex})):e&&(this.shapeLink||this.linkUI)&&("from"===this.linkPointsType?this._setFromPoint(e):"to"===this.linkPointsType?this._setToPoint(e):"shapeControl"===this.linkPointsType?(this._resetShapeLinkPoints(e),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:t,element:this.shapeLink,pointIndex:this.pointIndex})):"control"===this.linkPointsType&&bi.isOrthogonalLink(this.linkUI._element)&&this.linkUI.getControlPoint()&&(this._setLinkControlPoint(e),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:t,element:this.linkUI._element})))}this._handle_mouseup(t),this.lazyMode||this.clear()},handle_mousemove:function(t){var e=this.network.getEditPointSize();if(this.network.isValidEvent(t)){if(this.isStartRotate&&this.node)return this._handleRotateElement(t,this.node),void(this.network.isShowRotateScale()&&this.repaint());if(this.isStart){if(this.shapeNode&&this.pointIndex>=0)return void this._handleMovingShapeNodePoint(t);if(this.node&&this.resizeDirection)return void this._handleResizing(t);if((this.shapeLink||this.linkUI)&&this.linkPointsType){if("from"===this.linkPointsType)return void this._handleMovingFromPoint(t);if("to"===this.linkPointsType)return void this._handleMovingToPoint(t);if("shapeControl"===this.linkPointsType)return void this._handleMovingShapeLinkPoint(t);if("control"===this.linkPointsType&&bi.isOrthogonalLink(this.linkUI._element)&&this.linkUI.getControlPoint())return void this._handleMovingLinkControlPoint(t)}}if(this.network.isSelectingElement()||this.network.isMovingElement()||0===this.network.getSelectionModel().size())return void this.clear();var i=this.network.getElementAt(t),n=this.network.getElementUI(i);if(!n||!n.getEditAttachment())return void this.clear();var s=this.network.getLogicalPoint2(t);if(i instanceof De.Node){if(this.node=i,this._isEditingShapeNode(s)||this._isResizingNode(s))return void this.network.setEditingElement(!0);if(this._isRotatingElement(s))return this.network.setRotatingElement(!0),void this.network.setEditingElement(!0)}else if(i instanceof De.Link){i instanceof De.ShapeLink?this.shapeLink=i:n instanceof De.vector.LinkUI&&(this.linkUI=n);var r,a=i.getFromAgent();r=a?i.getFromAgent():i.getFromNode();var o,h=i.getStyle("link.from.xoffset"),l=i.getStyle("link.from.yoffset"),c=r.getCenterLocation(),u={x:c.x+h,y:c.y+l},d=i.getToAgent();o=d?i.getToAgent():i.getToNode();var f=i.getStyle("link.to.xoffset"),g=i.getStyle("link.to.yoffset"),_=o.getCenterLocation(),p={x:_.x+f,y:_.y+g};if(u&&this._contains(s,u,e))return this.linkPointsType="from",this._setCrossCursor(),void this.network.setEditingElement(!0);if(p&&this._contains(s,p,e))return this.linkPointsType="to",this._setCrossCursor(),void this.network.setEditingElement(!0);if(i instanceof De.ShapeLink){if(this._isEditingShapeLink(s))return this.linkPointsType="shapeControl",void this.network.setEditingElement(!0)}else if(n instanceof De.vector.LinkUI){if(bi.isOrthogonalLink(n._element)){var v=this.linkUI.getControlPoint();if(v&&this._contains(s,v,e))return this.linkPointsType="control",this._setCrossCursor(),void this.network.setEditingElement(!0)}return void(this.linkPointsType=null)}this.linkPointsType=null}this.clear()}},_isRotatingElement:function(t){var e=this.network.getRotatePointSize();if(0>=e)return!1;var i=this.network.zoomManager,n=this.network.getElementUI(this.node),s=i.getSizeZoom(n),r=i._getElementZoomRect(n,this.node.getOriginalRect()),a=this.node.getAngle();return this._isRotating(t,"crosshair",r,a,s)},_isRotating:function(t,e,i,n,s){var r=this.network.getRotatePointSize()/this.network.getGraphicsZoom(),a={x:i.x+i.width/2,y:i.y-this.network.getRotatePointOffset()/this.network.getGraphicsZoom()-r},o=this._rotatePoint(a,n,i),h={x:o.x-r,y:o.y-r,width:2*r,height:2*r};return!!Ge.containsPoint(h,t)&&(this._removeCursor(),this._setCursor(e),!0)},_handleRotateElement:function(t,e){this._handle_mousemove(t);var i=this._calculateAngle(this.network.getLogicalPoint2(t),e);e.setAngle(i)},_calculateAngle:function(t,e){var i=this.network.getZoomBodyRect(e),n=Ge.getCenterPoint(i);return Math.round(180*Math.atan2(n.x-t.x,t.y-n.y)/Math.PI+180)},_resetShapeNodePoints:function(t){var e=this.network.getShapeNodeZoomPoints(this.shapeNode);e.set(this.pointIndex,t);var i=this.network.getElementUI(this.shapeNode),n=this.network.zoomManager._getShapeNodeZoomPoints(i,e,!0);this.shapeNode.setPoints(n)},_handleMovingShapeNodePoint:function(t){var e=this.network.getLogicalPoint2(t);this._resetShapeNodePoints(e),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:t,element:this.shapeNode,pointIndex:this.pointIndex})},_resetShapeLinkPoints:function(t){var e=this.network.zoomManager._getShapeLinkZoomPoints(this.shapeLink._points);e.set(this.pointIndex,t);var i=this.network.zoomManager._getShapeLinkZoomPoints(e,!0);this.shapeLink.setPoints(i)},_handleMovingShapeLinkPoint:function(t){var e=this.network.getLogicalPoint2(t);this._resetShapeLinkPoints(e),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:t,element:this.shapeLink,pointIndex:this.pointIndex})},_setLinkControlPoint:function(t){var e=this.linkUI.getControlPoint(),i=this.linkUI.getControlPoint(),n=(this.network.zoomManager,{x:t.x-i.x,y:t.y-i.y});e.x+=n.x,e.y+=n.y,this.linkUI.setControlPoint(e)},_handleMovingLinkControlPoint:function(t){var e=this.network.getLogicalPoint2(t);this._setLinkControlPoint(e),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:t,element:this.linkUI._element})},_setFromPoint:function(t){var e;if(this.linkUI)e=this.linkUI._element;else{if(!this.shapeLink)return;e=this.shapeLink}var i,n=e.getFromAgent();i=n?e.getFromAgent().getCenterLocation():e.getFromNode().getCenterLocation();var s={x:t.x-i.x,y:t.y-i.y};e.setStyle("link.from.xoffset",s.x),e.setStyle("link.from.yoffset",s.y)},_handleMovingFromPoint:function(t){var e=this.network.getLogicalPoint2(t);this._setFromPoint(e)},_setToPoint:function(t){var e;if(this.linkUI)e=this.linkUI._element;else{if(!this.shapeLink)return;e=this.shapeLink}var i,n=e.getToAgent();i=n?e.getToAgent().getCenterLocation():e.getToNode().getCenterLocation();var s={x:t.x-i.x,y:t.y-i.y};e.setStyle("link.to.xoffset",s.x),e.setStyle("link.to.yoffset",s.y)},_handleMovingToPoint:function(t){var e=this.network.getLogicalPoint2(t);this._setToPoint(e)},convertFromUIToMarkerRect:function(t,e,i,n){var s=this.network.zoomManager,r=s.getLocationZoom(),a=s.getGraphicsZoom(),o=this.network.getElementUI(n),h=s.getSizeZoom(o),l=t.x+t.width/2,c=t.y+t.height/2,u=l-t.x,d=c-t.y;return{x:l*r*a-this.network.getViewRect().x+e*r*a-u*h*a,y:c*r*a-this.network.getViewRect().y+i*r*a-d*h*a,width:t.width*h*a,height:t.height*h*a}},_getReverseZoomPoint:function(t,e,i){var n=this.network.zoomManager,s=n.getLocationZoom(),r=n.getSizeZoom(this.network.getElementUI(t));return e.x*=s,e.y*=s,{x:e.x/s+(i.x-e.x)/r,y:e.y/s+(i.y-e.y)/r}},_getReverseZoomRect:function(t,e){var i=this.network.zoomManager,n=i.getLocationZoom(),s=i.getSizeZoom(r);if(n==s)return t;var r=this.network.getElementUI(e),a=r.getBodyRect(),o=a.x+a.width/2,h=a.y+a.height/2,l={x:o*n+(t.x-o)*s,y:h*n+(t.y-h)*s,width:t.width*s,height:t.height*s};return o=l.x+l.width/2,h=l.y+l.height/2,{x:o/n+(l.x-o)*s,y:h/n+(l.y-h)*s,width:t.width,height:t.height}},_handleResizing:function(t){this._handle_mousemove(t);var e=this.node.getAngle(),i=this.node.getLocation(),n=this.node.getWidth()/2,s=this.node.getHeight()/2,r={x:i.x+n,y:i.y+s},a={x:-n,y:-s},o={x:-n,y:s},h={x:n,y:s},l={x:n,y:-s},c={x:0,y:-s},u={x:n,y:0},d={x:0,y:s},f={x:-n,y:0},g=this._getReverseZoomPoint(this.node,Be.clone(r),this._endLogical);if("northwest"===this.resizeDirection&&(this._transformPoint(h,r,e),a.x=g.x,a.y=g.y,r.x=(a.x+h.x)/2,r.y=(a.y+h.y)/2,this._reversPoint(a,r,e),this._reversPoint(h,r,e),this.resizingRect={x:a.x,y:a.y,width:h.x-a.x,height:h.y-a.y},Be.isShiftDown(t)&&this._revertResizeRect(this.node,this.resizingRect,1)),"north"===this.resizeDirection){var _={x:g.x,y:g.y};this._reversPoint(_,r,e),c.y=_.y-r.y,this._transformPoint(c,r,e),this._transformPoint(d,r,e),r.x=(c.x+d.x)/2,r.y=(c.y+d.y)/2,this._reversPoint(c,r,e),this._reversPoint(d,r,e),this.resizingRect={x:r.x-this.node.getWidth()/2,y:r.y-(d.y-c.y)/2,width:this.node.getWidth(),height:d.y-c.y}}if("northeast"===this.resizeDirection&&(this._transformPoint(o,r,e),l.x=g.x,l.y=g.y,r.x=(o.x+l.x)/2,r.y=(o.y+l.y)/2,this._reversPoint(o,r,e),this._reversPoint(l,r,e),this.resizingRect={x:o.x,y:l.y,width:l.x-o.x,height:o.y-l.y},Be.isShiftDown(t)&&this._revertResizeRect(this.node,this.resizingRect,2)),"west"===this.resizeDirection){var _={x:g.x,y:g.y};this._reversPoint(_,r,e),f.x=_.x-r.x,this._transformPoint(u,r,e),this._transformPoint(f,r,e),r.x=(u.x+f.x)/2,r.y=(u.y+f.y)/2,this._reversPoint(u,r,e),this._reversPoint(f,r,e),this.resizingRect={x:r.x-(u.x-f.x)/2,y:r.y-this.node.getHeight()/2,width:u.x-f.x,height:this.node.getHeight()}}if("east"===this.resizeDirection){var _={x:g.x,y:g.y};this._reversPoint(_,r,e),u.x=_.x-r.x,this._transformPoint(u,r,e),this._transformPoint(f,r,e),r.x=(u.x+f.x)/2,r.y=(u.y+f.y)/2,this._reversPoint(u,r,e),this._reversPoint(f,r,e),this.resizingRect={x:r.x-(u.x-f.x)/2,y:r.y-this.node.getHeight()/2,width:u.x-f.x,height:this.node.getHeight()}}if("southwest"===this.resizeDirection&&(this._transformPoint(l,r,e),o.x=g.x,o.y=g.y,r.x=(o.x+l.x)/2,r.y=(o.y+l.y)/2,this._reversPoint(o,r,e),this._reversPoint(l,r,e),this.resizingRect={x:o.x,y:l.y,width:l.x-o.x,height:o.y-l.y},Be.isShiftDown(t)&&this._revertResizeRect(this.node,this.resizingRect,4)),"south"===this.resizeDirection){var _={x:g.x,y:g.y};this._reversPoint(_,r,e),d.y=_.y-r.y,this._transformPoint(c,r,e),this._transformPoint(d,r,e),r.x=(c.x+d.x)/2,r.y=(c.y+d.y)/2,this._reversPoint(c,r,e),this._reversPoint(d,r,e),this.resizingRect={x:r.x-this.node.getWidth()/2,y:r.y-(d.y-c.y)/2,width:this.node.getWidth(),height:d.y-c.y}}"southeast"===this.resizeDirection&&(this._transformPoint(a,r,e),h.x=g.x,h.y=g.y,r.x=(a.x+h.x)/2,r.y=(a.y+h.y)/2,this._reversPoint(a,r,e),this._reversPoint(h,r,e),this.resizingRect={x:a.x,y:a.y,width:h.x-a.x,height:h.y-a.y},Be.isShiftDown(t)&&this._revertResizeRect(this.node,this.resizingRect,3)),this.resizingRect=this._getReverseZoomRect(this.resizingRect,this.node),this.lazyMode?(this.repaint(),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:t,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:t,element:this.node,resizeDirection:this.resizeDirection}))},_revertResizeRect:function(t,e,i){var n=t.getOriginalRect(),s=Math.max(e.width/n.width,e.height/n.height),r=n.width*s,a=n.height*s,o=e.x,h=e.y;1==i?(o+=e.width-r,h+=e.height-a):2==i?h+=e.height-a:3==i||4==i&&(o+=e.width-r),e.x=o,e.y=h,
e.width=r,e.height=a},_isEditingShapeNode:function(t){var e=this.network.getEditPointSize();if(this.node instanceof De.ShapeNode){this.shapeNode=this.node;for(var i=this.network.getShapeNodeZoomPoints(this.node),n=0,s=i.size();s>n;n++){var r=i.get(n);if(this._contains(t,r,e))return this._setCrossCursor(),this.pointIndex=n,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(t){for(var e=this.network.getEditPointSize(),i=this.network.zoomManager._getShapeLinkZoomPoints(this.shapeLink.getPoints()),n=0,s=i.size();s>n;n++){var r=i.get(n);if(this._contains(t,r,e))return this._setCrossCursor(),this.pointIndex=n,!0}return this.pointIndex=-1,!1},_isResizingNode:function(t){var e=this.network.getResizePointSize();if(0>=e)return!1;var i=this.network.zoomManager,n=this.network.getElementUI(this.node),s=i._getElementZoomRect(n,this.node.getOriginalRect()),r=this.node.getAngle(),a={x:s.x,y:s.y},o=this._rotatePoint(a,r,s);return!!this._isResizing(t,o.x,o.y,"northwest","nwse-resize")||(a={x:s.x+s.width/2,y:s.y},o=this._rotatePoint(a,r,s),!!this._isResizing(t,o.x,o.y,"north","ns-resize")||(a={x:s.x+s.width,y:s.y},o=this._rotatePoint(a,r,s),!!this._isResizing(t,o.x,o.y,"northeast","nesw-resize")||(a={x:s.x,y:s.y+s.height/2},o=this._rotatePoint(a,r,s),!!this._isResizing(t,o.x,o.y,"west","ew-resize")||(a={x:s.x+s.width,y:s.y+s.height/2},o=this._rotatePoint(a,r,s),!!this._isResizing(t,o.x,o.y,"east","ew-resize")||(a={x:s.x,y:s.y+s.height},o=this._rotatePoint(a,r,s),!!this._isResizing(t,o.x,o.y,"southwest","nesw-resize")||(a={x:s.x+s.width/2,y:s.y+s.height},o=this._rotatePoint(a,r,s),!!this._isResizing(t,o.x,o.y,"south","ns-resize")||(a={x:s.x+s.width,y:s.y+s.height},o=this._rotatePoint(a,r,s),!!this._isResizing(t,o.x,o.y,"southeast","nwse-resize"))))))))},_rotatePoint:function(t,e,i){var n=Ge.createMatrix(e*Math.PI/180,i.x+i.width/2,i.y+i.height/2),s=n.transform(t);return s},_isResizing:function(t,e,i,n,s){var r=this.network.getGraphicsZoom(),a=this.network.getResizePointSize()/r;return!!this._contains(t,{x:e,y:i},a)&&(this.resizeDirection!==n&&(this._removeCursor(),s=this._changeCursorWithAngle(n,this.node.getAngle()),this._setCursor(s),this.resizeDirection=n),!0)},_getRect:function(t,e,i,n){var s=i>t?t:i,r=n>e?e:n,a=Math.abs(t-i),o=Math.abs(e-n);return{x:s,y:r,width:a,height:o}},_contains:function(t,e,i){var n={x:e.x-i,y:e.y-i,width:2*i,height:2*i};return Ge.containsPoint(n,t)},getPointIndex:function(t,e,i){if(t.size()<2)return 0;for(var n,s=t.get(0),r=1;r<t.size();r++){if(n=t.get(r),this.isPointOnLine(e,s,n,6))return r;s=n}return s=t.get(0),i&&this.isPointOnLine(e,s,n,6)?t.size():0},showRotateScale:function(t){var e,i,n,s,r,a=(new De.List,this.network.getRotateScaleWidth()),o=this.network.getRotateScaleHeight(),h=this.network.getRotatePointSize(),l=this.node.getAngle(),c=this.network.zoomManager,u=this.network.getElementUI(this.node),d=c._getElementZoomRect(u,this.node.getOriginalRect()),f={x:d.x+d.width/2,y:d.y-this.network.getRotatePointOffset()-h},g=this._rotatePoint(f,l,d),_="13px Arial",p=l+"",v=this.network.getViewRect();1===c.getLocationZoom()&&(t.translate(-v.x,-v.y),t.scale(this.network.getZoom(),this.network.getZoom())),this.node.getAngle()>=0&&this.node.getAngle()<=180?(i={x:g.x+h,y:g.y},n={x:i.x+a,y:i.y},s={x:n.x,y:n.y-o},r={x:i.x,y:s.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(i={x:g.x-h,y:g.y},n={x:i.x-a,y:i.y},s={x:n.x,y:n.y-o},r={x:i.x,y:s.y});var m=new De.List([i,n,s,r]),e=Be.math.getRect(m);1!==c.getLocationZoom()&&(e.x-=v.x,e.y-=v.y),t.fillStyle=this.network.getRotateScaleFillColor(),t.fillRect(e.x,e.y,e.width,e.height),t.fillStyle=this.network.getRotateScaleFontColor(),t.textBaseline="middle",t.textAlign="center",t.font=_,t.fillText(p,e.x+e.width/2,e.y+e.height/2),1===c.getLocationZoom()&&(t.scale(1/this.network.getZoom(),1/this.network.getZoom()),t.translate(v.x,v.y))},isPointOnLine:function(t,e,i,n){0>n&&(n=0);var s=this.getDistanceFromPointToLine(t,e,i);return n>=s&&t.x>=Math.min(e.x,i.x)-n&&t.x<=Math.max(e.x,i.x)+n&&t.y>=Math.min(e.y,i.y)-n&&t.y<=Math.max(e.y,i.y)+n},getDistanceFromPointToLine:function(t,e,i){if(e.x===i.x)return Math.abs(t.x-e.x);var n=(i.y-e.y)/(i.x-e.x),s=(i.x*e.y-e.x*i.y)/(i.x-e.x);return Math.abs(n*t.x-t.y+s)/Math.sqrt(n*n+1)},_transformPoint:function(t,e,i){var n=Math.cos(i*Math.PI/180),s=Math.sin(i*Math.PI/180),r=t.x,a=t.y,o=r*n-a*s,h=r*s+a*n;t.x=o+e.x,t.y=h+e.y},_reversPoint:function(t,e,i){i*=-1;var n=Math.cos(i*Math.PI/180),s=Math.sin(i*Math.PI/180),r=t.x-e.x,a=t.y-e.y,o=r*n-a*s,h=r*s+a*n;t.x=o+e.x,t.y=h+e.y},_changeCursorWithAngle:function(t,e){var i,n=["auto","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];switch(t){case"northwest":i=1;break;case"north":i=2;break;case"northeast":i=3;break;case"east":i=4;break;case"southeast":i=5;break;case"south":i=6;break;case"southwest":i=7;break;case"west":i=8;break;default:i=0}return(e>=360||-360>=e)&&(e%=360),e>22.5&&67.5>=e&&(i+=1),-22.5>e&&e>=-67.5&&(i-=1),e>67.5&&112.5>=e&&(i+=2),-67.5>e&&e>=-112.5&&(i-=2),e>112.5&&157.5>=e&&(i+=3),-112.5>e&&e>=-157.5&&(i-=3),e>157.5&&202.5>=e&&(i+=4),-157.5>e&&e>=-202.5&&(i-=4),e>202.5&&247.5>=e&&(i+=5),-202.5>e&&e>=-247.5&&(i-=5),e>247.5&&292.5>=e&&(i+=6),-247.5>e&&e>=-292.5&&(i-=6),e>292.5&&337.5>=e&&(i+=7),-292.5>e&&e>=-337.5&&(i-=7),i>8&&(i-=8),0>=i&&(i+=8),n[i]}}),De.vector.interaction.CreateLinkInteraction=function(t,e){e||(e=De.Link),this.linkFunction=De.Util.isTypeOf(e,De.Link)?function(t,i){var n=new e;return n instanceof De.Link&&(n.setFromNode(t),n.setToNode(i)),n}:e,De.vector.interaction.CreateLinkInteraction.superClass.constructor.call(this,t)},Be.ext("twaver.vector.interaction.CreateLinkInteraction",De.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this)},paint:function(t){t.beginPath();var e,i;t.lineWidth=this.network.getEditLineWidth();var n=this.network.getEditLineColor();this.currentNode&&this.currentNode!==this.fromNode&&(e=this.network.getElementUI(this.currentNode).getZoomViewRect(!0),i=this.convertFromUIToMarkerRect(e,0,0),Un.rect(t,i.x,i.y,i.width,i.height,null,n)),this.fromNode&&(e=this.network.getElementUI(this.fromNode).getZoomViewRect(!0),i=this.convertFromUIToMarkerRect(e,0,0),Un.rect(t,i.x,i.y,i.width,i.height,null,n)),this.currentPoint&&this.paintLine(t),t.closePath()},convertFromUIToMarkerRect:function(t,e,i){var n=this.network.zoomManager,s=n.getGraphicsZoom();return{x:t.x*s-this.network.getViewRect().x+e*s,y:t.y*s-this.network.getViewRect().y+i*s,width:t.width*s,height:t.height*s}},getZoomNodeRectOrPoint:function(t,e){var i=this.network.getElementUI(t).getZoomBodyRect();return e?{x:i.x+i.width/2,y:i.y+i.height/2}:i},paintLine:function(t){var e=this.network.getEditLineColor(),i=this.network.getElementUI(this.fromNode).getZoomBodyRect(),n=this.convertPointFromView({x:i.x+i.width/2,y:i.y+i.height/2}),s=n.x,r=n.y,a=this.currentPoint.x,o=this.currentPoint.y;t.strokeStyle=e,t.beginPath(),t.moveTo(s,r),t.lineTo(a,o),t.stroke()},clear:function(){this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(t){if(this.network.isValidEvent(t))if(this.fromNode){if(this.toNode=this.currentNode,this.toNode){var e=this.createLink();e&&this.network.addElementByInteraction(e)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.repaint()},handle_mousemove:function(t){var e=this.getMarkerPoint(t);if(e){if(this.network.isMovingElement()||this.network.isEditingElement())return void this.clear();var i=null;this.fromNode?(this.currentNode=this.getToNode(t,this.fromNode),this.currentPoint=e,this.repaint()):(i=this.getFromNode(t),this.currentNode!==i&&(this.currentNode=i,this.repaint()))}},getFromNode:function(t){return this.getNode(t)},getToNode:function(t,e){return this.getNode(t,e)},getNode:function(t,e){var i=this.network.getElementAt(t);return i instanceof On&&this.network.isLinkable(i,e)&&this.network.getElementBox().getSelectionModel().isSelectable(i)?i:null}}),De.vector.interaction.CreateShapeLinkInteraction=function(t,e){De.vector.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,t),e||(e=De.ShapeLink),this.linkFunction=De.Util.isTypeOf(e,De.ShapeLink)?function(t,i,n){var s=new e;if(s instanceof De.ShapeLink&&(s.setFromNode(t),s.setToNode(i),n)){var r=this.network.zoomManager;s.setPoints(r._getShapeLinkZoomPoints(n,!0))}return s}:e},Be.ext("twaver.vector.interaction.CreateShapeLinkInteraction",De.vector.interaction.CreateLinkInteraction,{clear:function(){this.points=null,De.vector.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(t){if(0===t.button){var e=this.network.getLogicalPoint2(t);if(e){if(this.fromNode)if(this.toNode=this.currentNode,this.toNode){var i=this.createLink();i&&this.network.addElementByInteraction(i),this.clear()}else{if(this.points||(this.points=new De.List),this.points.size()>0){var n=this.points.get(this.points.size()-1);if(n.x===e.x&&n.y===e.y)return}this.points.add(e)}else this.fromNode=this.currentNode,this.points=null,this.currentNode=null,this.currentPoint=null;this.repaint()}}},paintLine:function(t){if(this.currentPoint){var e,i=new De.List;if(e=this.convertPointFromView(this.getZoomNodeRectOrPoint(this.fromNode,!0)),i.add(e,0),this.points&&this.points.size()>0)for(var n=this.points.size(),s=0;n>s;s++)e=this.convertPointFromView(this.points.get(s)),i.add(e);e=this.currentPoint,i.add(e),t.lineWidth=this.network.getEditLineWidth(),t.strokeStyle=this.network.getEditLineColor(),t.beginPath(),qe.drawLinePoints(t,i),t.stroke()}}}),De.vector.interaction.CreateShapeNodeInteraction=function(t,e){e||(e=De.ShapeNode),this.shapeNodeFunction=De.Util.isTypeOf(e,De.ShapeNode)?function(t){var i=new e;if(i instanceof De.ShapeNode){var n=this.network.zoomManager,s=this.network.createElementUI(i);if(t){var r=n._getShapeNodeZoomPoints(s,t,!0);s.invalidateZoom(),i.setPoints(r)}}return i}:e,De.vector.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,t),this.timeStamp=-1},Be.ext("twaver.vector.interaction.CreateShapeNodeInteraction",De.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this),this.network.setEditingElement(!1)},clear:function(){this.points=null,this.currentPoint=null},paint:function(t){if(this.points&&this.points.size()>0&&this.currentPoint){for(var e,i=new De.List,n=this.points.size(),s=0;n>s;s++)e=this.convertPointFromView(this.points.get(s)),i.add(e);e=this.convertPointFromView(this.currentPoint),i.add(e),t.lineWidth=this.network.getEditLineWidth(),t.strokeStyle=this.network.getEditLineColor(),t.beginPath(),qe.drawLinePoints(t,i),t.stroke()}},handle_mousedown:function(t){if(0===t.button){var e=this.network.getLogicalPoint2(t);if(e){if(2===t.detail||t.timeStamp-this.timeStamp<300){if(this.points){var i=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(i),this.clear();var n=this;setTimeout(function(){n.network.setEditingElement(!1)},0)}}else{if(this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new De.List),this.points.size()>0){var s=this.points.get(this.points.size()-1);if(s.x===e.x&&s.y===e.y)return}this.points.add(e)}this.timeStamp=t.timeStamp,this.repaint()}}},handle_mousemove:function(t){this.points&&(this.currentPoint=this.network.getLogicalPoint2(t),this.repaint())}}),De.vector.interaction.MagnifyInteraction=function(t,e,i,n,s){De.vector.interaction.MagnifyInteraction.superClass.constructor.call(this,t),this.scale=e||2,this.xRadius=i||100,this.yRadius=n||100,this.shape=s||"circle",this.borderColor="black",this.borderWidth=1,this.backgroundColor="white",this.markCanvas=je.createCanvas()},Be.ext("twaver.vector.interaction.MagnifyInteraction",De.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove"),this.addListener("mousewheel"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousemove"),this.removeListener("mousewheel"),this.network.removeMarker(this)},paint:function(t){if(this.point){var e=this.network.zoomManager,i=e.getLocationZoom(),n=e.getGraphicsZoom(),s=(e.getSizeZoom(),this.network.getZoom(),this.xRadius/this.scale/n),r=this.yRadius/this.scale/n;if("mousewheel"===this.mouseFlag){var a={x:this.zoomPoint.x-s,y:this.zoomPoint.y-r,width:2*s,height:2*r};this.network.toCanvasByRegion(a,this.scale*n,this.markCanvas,"white");var o={x:this.zoomPoint.x-this.xRadius-this.network.viewRect.x,y:this.zoomPoint.y-this.yRadius-this.network.viewRect.y,width:this.markCanvas.width,height:this.markCanvas.height}}else{var a={x:this.point.x*i-s,y:this.point.y*i-r,width:2*s,height:2*r};this.network.toCanvasByRegion(a,this.scale*n,this.markCanvas,"white");var o={x:this.point.x*i*n-this.xRadius-this.network.viewRect.x,y:this.point.y*i*n-this.yRadius-this.network.viewRect.y,width:this.markCanvas.width,height:this.markCanvas.height}}t.save(),t.beginPath(),qe.drawVector(t,this.shape,null,o.x,o.y,2*a.width*n,2*a.height*n),t.clip(),t.fillStyle=this.backgroundColor,t.beginPath(),t.rect(o.x,o.y,o.width,o.height),t.fill(),t.drawImage(this.markCanvas,o.x,o.y),t.restore(),t.beginPath(),t.lineWidth=this.borderWidth,qe.drawVector(t,this.shape,null,o.x+this.borderWidth/2,o.y+this.borderWidth/2,2*a.width*n-this.borderWidth,2*a.height*n-this.borderWidth),t.strokeStyle=this.borderColor,t.stroke(),this.mouseFlag=null}},handle_mousemove:function(t){this.point=this.network.getLogicalPoint(t),this.point&&(this.mouseFlag="mousemove",this.repaint())},handle_mousewheel:function(t){var e=this.network.zoomManager,i=e.getLocationZoom();1!==i&&(this.zoomPoint=this.network.getLogicalPoint2(t)),this.zoomPoint&&(this.mouseFlag="mousewheel",this.repaint())},getScale:function(){return this.scale},setScale:function(t){this.scale=t,this.network.repaintTopCanvas()},getShape:function(){return this.shape},setShape:function(t){this.shape=t,this.network.repaintTopCanvas()},getXRadius:function(){return this.xRadius},setXRadius:function(t){this.xRadius=t,this.network.repaintTopCanvas()},getYRadius:function(){return this.yRadius},setYRadius:function(t){this.yRadius=t,this.network.repaintTopCanvas()},getBorderColor:function(){return this.borderColor},setBorderColor:function(t){this.borderColor=t,this.network.repaintTopCanvas()},getBorderWidth:function(){return this.borderWidth},setBorderWidth:function(t){this.borderWidth=t,this.network.repaintTopCanvas()},getBackgroundColor:function(){return this.backgroundColor},setBackgroundColor:function(t){this.backgroundColor=t,this.network.repaintTopCanvas()}}),De.vector.interaction.TouchInteraction=function(t){De.vector.interaction.TouchInteraction.superClass.constructor.call(this,t)},Be.ext("twaver.vector.interaction.TouchInteraction",De.vector.interaction.BaseInteraction,{setUp:function(){var t=this.network.getView();je.addEventListener("touchstart","handleTouchstart",t,this),je.addEventListener("touchmove","handleTouchmove",t,this),je.addEventListener("touchend","handleTouchend",t,this),je.addEventListener("touchcancel","handleTouchend",t,this)},tearDown:function(){var t=this.network.getView();je.removeEventListener("touchstart",t,this),je.removeEventListener("touchmove",t,this),je.removeEventListener("touchend",t,this),je.removeEventListener("touchcancel",t,this)},handleTouchstart:function(t){if(je.preventDefault(t),1==t.touches.length){var e=this.network.getLogicalPoint2(t),i=this._element=this.network.getElementAt(e);this._startTouchTime=new Date,this._currentTouchPoint=e,this._startTouchClient=this._currentTouchClient=this.getMarkerPoint(t),i?this.network.getSelectionModel().contains(i)||this.network.getSelectionModel().setSelection(i):this.network.getSelectionModel().clearSelection(),Li.handleClicked(this.network,t,i),this._endTouchTime&&this._startTouchTime.getTime()-this._endTouchTime.getTime()<=500&&Ge.getDistance(this._endTouchClient,this._startTouchClient)<=20?(delete this._endTouchTime,delete this._endTouchClient,Li.handleDoubleClicked(this.network,t,i)):(this._endTouchTime=this._startTouchTime,this._endTouchClient=this._startTouchClient)}else this._distance=Ci.getDistance(t),this._zoom=this.network.getZoom()},handleTouchmove:function(t){if(je.preventDefault(t),t.touches.length>1){var e=Ci.getDistance(t);if(Math.abs(e-this._distance)<20)return;var i=e/this._distance;this.network.setZoom(this._zoom*i,!1)}else if(null==this._zoom){var n=this.getMarkerPoint(t);if(Ge.getDistance(this._startTouchClient,n)<20)return;if(this._element){var s=this.network.getLogicalPoint2(t),r=this.getOffset(s,this._currentTouchPoint),a=r.x,o=r.y;this._currentTouchPoint=s,this.network.moveSelectedElements(a,o),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:t}))}else{var a=this._currentTouchClient.x-n.x,o=this._currentTouchClient.y-n.y;this.network.panByOffset(a,o),this._currentTouchClient=n}}},handleTouchend:function(t){je.preventDefault(t),this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:t})),0===t.touches.length&&(this._distance=null,this._zoom=null,this._element=null,this._startTouchTime=null,this._currentTouchPoint=null,this._startTouchClient=this._currentTouchClient=null)}}),De.vector.interaction.MSTouchInteraction=function(t){De.vector.interaction.MSTouchInteraction.superClass.constructor.call(this,t),this._pointerMap={},this._pointerIdArray=[]},Be.ext("twaver.vector.interaction.MSTouchInteraction",De.vector.interaction.BaseInteraction,{setUp:function(){var t=this.network.getView();je.addEventListener("MSPointerDown","handleTouchstart",t,this),je.addEventListener("MSPointerMove","handleTouchmove",t,this),je.addEventListener("MSPointerUp","handleTouchend",t,this),je.addEventListener("MSPointerCancel","handleTouchend",t,this),this.network.addMarker(this)},tearDown:function(){var t=this.network.getView();je.removeEventListener("MSPointerDown",t,this),je.removeEventListener("MSPointerMove",t,this),je.removeEventListener("MSPointerUp",t,this),je.removeEventListener("MSPointerCancel",t,this),this.network.removeMarker(this)},handleTouchstart:function(t){if(this.network.isFocusOnClick()&&De.Util.setFocus(this.network._view),!this.network.isSelectingElement()||t.pointerType!=t.MSPOINTER_TYPE_MOUSE){var e=this.network.getLogicalPoint2(t),i=new Date;if(t.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(t),this._pointerMap[t.pointerId]||(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t),1==this._pointerIdArray.length){var n=this.network.getElementAt(e);this._startTouchElement=n,this._startClientPoint={x:t.clientX,y:t.clientY};var s=this.network.getSelectionModel();n?Be.isCtrlDown(t)?s.contains(n)?s.removeSelection(n):s.appendSelection(n):s.contains(n)||s.setSelection(n):Be.isCtrlDown(t)||s.clearSelection(),Li.handleClicked(this.network,t,n),this._startTouchTime&&this._startTouchPoint&&i.getTime()-this._startTouchTime.getTime()<=500&&Ge.getDistance(this._startTouchPoint,e)<=20?(Li.handleDoubleClicked(this.network,t,n),this._doubleClick=!0):(je.handle_mousedown(this,t),this._startTouchPoint=e,this._startTouchTime=i)}else 2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())}},handleTouchmove:function(t){if(null!=this._startTouchPoint&&0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(Ge.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=10)&&(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length)){var e=this._getDistance()/this._distance;this.network.setZoom(this._zoom*e,!1)}},handleTouchend:function(t){if(this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:t})),this.network.isSelectingElement()){var e=Ge.getRect([this._startTouchPoint,this._moveTouchPoint]),i=this.network.getElementsAtRect(e,this.getIntersectMode(),this.network.getRectSelectFilter());if(i&&i.size()>0){var n=this.network.getSelectionModel(),s=n.toSelection();i.forEach(function(t){n.contains(t)?s.remove(t):s.add(t)},this),n.setSelection(s)}this.network.fireInteractionEvent({kind:"selectEnd",event:t}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);for(var r=-1,a=0;a<this._pointerIdArray.length;a++)if(this._pointerIdArray[a]==t.pointerId){r=a;break}r>=0&&this._pointerIdArray.splice(r,1),delete this._pointerMap[t.pointerId],this._moveTouchPoint=null},_getDistance:function(){return Ge.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()||"contain"!==this.network.getSelectMode()&&(this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y)},handle_mousemove:function(t){var e={x:t.clientX,y:t.clientY};if(!(Ge.getDistance(this._startClientPoint,e)<3)&&this._startTouchPoint&&1==this._pointerIdArray.length)if(this._moveTouchPoint={x:this._startTouchPoint.x+(e.x-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(e.y-this._startClientPoint.y)/this.network.getZoom()},null==this._startTouchElement&&this.network.isRectSelectEnabled()){var i=this.network.getLogicalPoint2(t);if(!i)return;this.network.setSelectingElement(!0),this.network.fireInteractionEvent(this._moveTouchPoint?{kind:"selectBetween",event:t}:{kind:"selectStart",event:t}),this.repaint()}else{var n=this.network.getElementAt(this._moveTouchPoint);if(null!=this._startTouchElement||this.network.isRectSelectEnabled()){if(this.network.isMovingElement()||null!=this._startTouchElement&&n==this._startTouchElement&&this.network.getMovableSelectedElements().contains(n)){var s=this._moveTouchPoint.x-this._startTouchPoint.x,r=this._moveTouchPoint.y-this._startTouchPoint.y;this.network.moveSelectedElements(s,r),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:t}))}}else{var s=this._startClientPoint.x-e.x,r=this._startClientPoint.y-e.y;this.network.panByOffset(s,r)}this._startClientPoint=e}},handle_mouseup:function(t){this.handleTouchend(t),this._pointerIdArray=[],this._pointerMap={}},paint:function(t){if(this._startTouchPoint&&this._moveTouchPoint&&!this._startTouchElement&&this.network.isRectSelectEnabled()){var e=this.convertPointFromView(this._startTouchPoint),i=this.convertPointFromView(this._moveTouchPoint),n=e.x,s=e.y,r=i.x,a=i.y,o=Ge.getRect([{x:n,y:s},{x:r,y:a}]);if(null!=o){t.beginPath();var h=this.network.getSelectOutlineWidth(),l=this.getIntersectMode()?this.network.getSelectFillColor():null;t.strokeStyle=this.network.getSelectOutlineColor(),t.lineWidth=h,Un.rect(t,o.x,o.y,o.width,o.height,l,this.network.getSelectOutlineColor()),t.closePath()}}}}),De.XmlSerializer=function(t,e,i){this.dataBox=t,this.settings=e?e:new De.SerializationSettings,this.filterFunction=i,this.ref=0,this.refMap={},this.idMap={},this.xmlString=""},Be.ext("twaver.XmlSerializer",Object,{serialize:function(){return this.xmlString="<twaver version='"+De.Util.getVersion()+"' platform='html5'>\n",this.serializeBody(),this.xmlString+="</twaver>\n",this.xmlString},serializeBody:function(){this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable&&(this.xmlString+="<dataBox class='"+this.dataBox.getClassName()+"'>\n",this.dataBox.serializeXml(this,this.dataBox.newInstance()),this.xmlString+="</dataBox>\n"),this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(t){this.refMap[t.getId()]=this.ref++,t.getChildren().forEach(this.initRefs,this)},isSerializable:function(t){return!!this.dataBox.contains(t)&&!(this.filterFunction&&!this.filterFunction(t))},serializeData:function(t){if(this.isSerializable(t)){var e=t.newInstance(),i=this.refMap[t.getId()];this.xmlString+="<data class='"+t.getClassName()+"' ref='"+i+"'",null!=this.settings.getPropertyType("id")&&(this.xmlString+=" id='"+t.getId()+"'"),this.xmlString+=">\n",t.serializeXml(this,e),this.xmlString+="</data>\n"}t.getChildren().forEach(this.serializeData,this)},serializePropertyXml:function(t,e,i){var n=this.settings.getPropertyType(e);if(n){var s=Be.getValue(t,e,n),r=Be.getValue(i,e,n);s!==r&&this.serializeValue("p",e,s,r,n)}},serializeStyleXml:function(t,e,i){var n=this.settings.getStyleType(e);if(n){var s=t.getStyle(e),r=i.getStyle(e);s!=r&&this.serializeValue("s",e,s,r,n)}},serializeClientXml:function(t,e,i){var n=this.settings.getClientType(e);if(null!=n){var s=t.getClient(e),r=i.getClient(e);s!=r&&this.serializeValue("c",e,s,r,n)}},serializeValue:function(t,e,i,n,s){if(null==i)this.xmlString+="\t<"+t+" n='"+e+"' none=''/>\n";else if("cdata"===s)this.xmlString+="\t<"+t+" n='"+e+"'><![CDATA["+i+"]]></"+t+">\n";else if("data"===s){var r=this.refMap[i.getId()];null!=r&&(this.xmlString+="\t<"+t+" n='"+e+"' ref='"+r+"'/>\n")}else"point"===s?n&&i.x===n.x&&i.y===n.y||(this.xmlString+="\t<"+t+" n='"+e+"' x='"+i.x+"' y='"+i.y+"'/>\n"):"list.point"===s?(this.xmlString+="\t<"+t+" n='"+e+"'>\n",i.forEach(function(t){this.xmlString+="\t\t<p x='"+t.x+"' y='"+t.y+"'/>\n"},this),this.xmlString+="\t</"+t+">\n"):"list.string"===s||"list.number"===s?(this.xmlString+="\t<"+t+" n='"+e+"'>\n",i.forEach(function(t){this.xmlString+="\t\t<s>"+t+"</s>\n"},this),this.xmlString+="\t</"+t+">\n"):this.xmlString+="rectangle"===s?"\t<"+t+" n='"+e+"' x='"+i.x+"' y='"+i.y+"' w='"+i.width+"' h='"+i.height+"'/>\n":"\t<"+t+" n='"+e+"'>"+i+"</"+t+">\n"},deserialize:function(t,e){Be.isDeserializing=!0,this.xmlString=t;var i=Be.xml(t).documentElement;this.refMap={},this.idMap={};var n,s,r,a=new gn,o=new gn,h=i.getElementsByTagName("data"),l=h.length;for(r=0;l>r;r++){s=h[r];var c=s.getAttribute("class"),u=this.settings.getPropertyType("id");if(u&&s.hasAttribute("id")){var d=null;if("string"===u)d=s.getAttribute("id");else if("int"===u)d=parseInt(s.getAttribute("id"));else{if("number"!==u)throw"Unsupported id type '"+u+"'";d=parseFloat(s.getAttribute("id"))}if("remove"===s.getAttribute("action")){this.dataBox.removeById(d);continue}n=this.dataBox.getDataById(d),n||(n=Be.newInstance(c,d))}else n=Be.newInstance(c);if(s.hasAttribute("ref")){var f=s.getAttribute("ref");this.refMap[f]=n}a.add(n),o.add(s),this.idMap[n.getId()]=n}for(this.dataBox.forEach(function(t){this.idMap[t.getId()]=t},this),l=a.size(),r=0;l>r;r++)n=a.get(r),s=o.get(r),n.deserializeXml(this,s);for(r=0;l>r;r++)n=a.get(r),this.dataBox.containsById(n.getId())||(e&&!n.getParent()&&n.setParent(e),this.dataBox.add(n));this.settings.isDataBoxSerializable&&1===i.getElementsByTagName("dataBox").length&&this.dataBox.deserializeXml(this,i.getElementsByTagName("dataBox")[0]),Be.isDeserializing=!1},deserializePropertyXml:function(t,e,i){var n=this.settings.getPropertyType(i);n&&Be.setValue(t,i,this.deserializeValue(e,n))},deserializeStyleXml:function(t,e,i){var n=this.settings.getStyleType(i);n&&t.setStyle(i,this.deserializeValue(e,n))},deserializeClientXml:function(t,e,i){var n=this.settings.getClientType(i);n&&t.setClient(i,this.deserializeValue(e,n))},deserializeValue:function(t,e){if(t.hasAttribute("@none"))return null;if("string"===e)return t.textContent;if("number"===e)return parseFloat(t.textContent);if("boolean"===e)return"true"===t.textContent;if("int"===e)return parseInt(t.textContent);if("point"===e)return{x:parseFloat(t.getAttribute("x")),y:parseFloat(t.getAttribute("y"))};if("data"===e){var i=t.getAttribute("ref"),n=this.refMap[i];return n?n:this.idMap[i]}var s,r,a,o;if("list.point"===e){var h=new gn,l=t.getElementsByTagName("p");for(s=l.length,o=0;s>o;o++){var c=l[o];h.add({x:parseFloat(c.getAttribute("x")),y:parseFloat(c.getAttribute("y"))})}return h}if("list.string"===e){var u=new gn;for(a=t.getElementsByTagName("s"),s=a.length,o=0;s>o;o++)u.add(a[o].textContent);return u}if("list.number"===e){for(r=new gn,a=t.getElementsByTagName("s"),s=a.length,o=0;s>o;o++)r.add(parseFloat(a[o].textContent));return r}if("array.string"===e)return t.textContent.split(",");if("array.number"===e){for(r=t.textContent.split(","),s=r.length,o=0;s>o;o++)r[o]=parseFloat(r[o]);return r}return"rectangle"===e?{x:parseFloat(t.getAttribute("x")),y:parseFloat(t.getAttribute("y")),width:parseFloat(t.getAttribute("w")),height:parseFloat(t.getAttribute("h"))}:t.textContent}}),Be.addMethod(De.Data,{serializeXml:function(t,e){if(t.settings.isClientSerializable&&this._clientMap)for(var i in this._clientMap)this.serializeClientXml(t,i,e);this.serializePropertyXml(t,"name",e),this.serializePropertyXml(t,"icon",e),this.serializePropertyXml(t,"toolTip",e),this.serializePropertyXml(t,"parent",e)},serializePropertyXml:function(t,e,i){t.serializePropertyXml(this,e,i)},serializeClientXml:function(t,e,i){t.serializeClientXml(this,e,i)},deserializeXml:function(t,e){var i,n,s,r,a=e.getElementsByTagName("p"),o=a.length;for(i=0;o>i;i++)n=a[i],n.hasAttribute("n")&&this.deserializePropertyXml(t,n,n.getAttribute("n"));if(t.settings.isClientSerializable)for(s=e.getElementsByTagName("c"),o=s.length,i=0;o>i;i++)r=s[i],r.hasAttribute("n")&&this.deserializeClientXml(t,r,r.getAttribute("n"))},deserializePropertyXml:function(t,e,i){t.deserializePropertyXml(this,e,i)},deserializeClientXml:function(t,e,i){t.deserializeClientXml(this,e,i)}}),Be.addMethod(De.Element,{serializeXml:function(t,e){if(t.settings.isStyleSerializable&&this._styleMap)for(var i in this._styleMap)this.serializeStyleXml(t,i,e);De.Element.superClass.serializeXml.call(this,t,e),this.serializePropertyXml(t,"layerId",e),this._alarmState.getHighestNativeAlarmSeverity()&&"alarmstate"===t.settings.getPropertyType("alarmState")&&(t.xmlString+="\t<p n='alarmState'>\n",De.AlarmSeverity.forEach(function(e){var i=this.getNewAlarmCount(e);i>0&&(t.xmlString+="\t\t<n n='"+e.name+"' c='"+i+"'/>\n")},this._alarmState),De.AlarmSeverity.forEach(function(e){var i=this.getAcknowledgedAlarmCount(e);i>0&&(t.xmlString+="\t\t<a n='"+e.name+"' c='"+i+"'/>\n")},this._alarmState),t.xmlString+="\t</p>\n")},serializeStyleXml:function(t,e,i){t.serializeStyleXml(this,e,i)},deserializeXml:function(t,e){if(De.Element.superClass.deserializeXml.call(this,t,e),t.settings.isStyleSerializable){var i,n,s=e.getElementsByTagName("s"),r=s.length;for(i=0;r>i;i++)n=s[i],n.hasAttribute("n")&&this.deserializeStyleXml(t,n,n.getAttribute("n"))}},deserializeStyleXml:function(t,e,i){t.deserializeStyleXml(this,e,i)},deserializePropertyXml:function(t,e,i){if("alarmState"===i){if("alarmstate"===t.settings.getPropertyType("alarmState")){var n,s,r,a=e.getElementsByTagName("n");for(s=0;s<a.length;s++)r=a[s],n=De.AlarmSeverity.getByName(r.getAttribute("n")),this._alarmState.setNewAlarmCount(n,parseInt(r.getAttribute("c")));for(a=e.getElementsByTagName("a"),s=0;s<a.length;s++)r=a[s],n=De.AlarmSeverity.getByName(r.getAttribute("n")),this._alarmState.setAcknowledgedAlarmCount(n,parseInt(r.getAttribute("c")))}}else De.Element.superClass.deserializePropertyXml.call(this,t,e,i)}}),Be.addMethod(On,{serializeXml:function(t,e){On.superClass.serializeXml.call(this,t,e),this.serializePropertyXml(t,"image",e),
this.serializePropertyXml(t,"location",e),Be.num(this._width)&&this._width>=0&&this.serializePropertyXml(t,"width",e),Be.num(this._height)&&this._height>=0&&this.serializePropertyXml(t,"height",e)}}),Be.addMethod(De.Link,{serializeXml:function(t,e){De.Link.superClass.serializeXml.call(this,t,e),this.serializePropertyXml(t,"fromNode",e),this.serializePropertyXml(t,"toNode",e)}}),Be.addMethod(De.Follower,{serializeXml:function(t,e){De.Follower.superClass.serializeXml.call(this,t,e),this.serializePropertyXml(t,"host",e)}}),Be.addMethod(Vn,{serializeXml:function(t,e){Vn.superClass.serializeXml.call(this,t,e),this.serializePropertyXml(t,"expanded",e)}}),Be.addMethod(De.ShapeNode,{serializeXml:function(t,e){De.ShapeNode.superClass.serializeXml.call(this,t,e),this.serializePropertyXml(t,"points",e),this.serializePropertyXml(t,"segments",e)}}),Be.addMethod(De.ShapeLink,{serializeXml:function(t,e){De.ShapeLink.superClass.serializeXml.call(this,t,e),this.serializePropertyXml(t,"points",e)}}),Be.addMethod(De.RotatableNode,{serializeXml:function(t,e){De.RotatableNode.superClass.serializeXml.call(this,t,e),this.serializePropertyXml(t,"angle",e)}}),Be.addMethod(De.DataBox,{serializeXml:function(t,e){if(t.settings.isClientSerializable&&this._clientMap)for(var i in this._clientMap)this.serializeClientXml(t,i,e);this.serializePropertyXml(t,"name",e),this.serializePropertyXml(t,"icon",e),this.serializePropertyXml(t,"toolTip",e)},serializePropertyXml:function(t,e,i){t.serializePropertyXml(this,e,i)},serializeClientXml:function(t,e,i){t.serializeClientXml(this,e,i)},deserializeXml:function(t,e){var i,n,s,r,a=e.getElementsByTagName("p"),o=a.length;for(i=0;o>i;i++)n=a[i],n.hasAttribute("n")&&this.deserializePropertyXml(t,n,n.getAttribute("n"));if(t.settings.isClientSerializable)for(s=e.getElementsByTagName("c"),o=s.length,i=0;o>i;i++)r=s[i],r.hasAttribute("n")&&this.deserializeClientXml(t,r,r.getAttribute("n"))},deserializePropertyXml:function(t,e,i){t.deserializePropertyXml(this,e,i)},deserializeClientXml:function(t,e,i){t.deserializeClientXml(this,e,i)}}),Be.addMethod(De.ElementBox,{serializeXml:function(t,e){if(t.settings.isLayerBoxSerializable&&(t.xmlString+="\t<layerBox>\n",this._layerBox.forEachByDepthFirst(function(e){t.xmlString+=this._layerBox.getDefaultLayer()===e?"\t\t<layer ":"\t\t<layer id='"+e.getId()+"' ",e.getName()&&(t.xmlString+="name='"+e.getName()+"' "),t.xmlString+="visible='"+e.isVisible()+"' editable='"+e.isEditable()+"' movable='"+e.isMovable()+"'/>\n"},null,this),t.xmlString+="\t</layerBox>\n"),t.settings.isStyleSerializable&&this._styleMap)for(var i in this._styleMap)this.serializeStyleXml(t,i,e);De.ElementBox.superClass.serializeXml.call(this,t,e)},serializeStyleXml:function(t,e,i){t.serializeStyleXml(this,e,i)},deserializeStyleXml:function(t,e,i){t.deserializeStyleXml(this,e,i)},deserializeXml:function(t,e){if(De.ElementBox.superClass.deserializeXml.call(this,t,e),t.settings.isLayerBoxSerializable&&1==e.getElementsByTagName("layerBox").length)for(var i=e.getElementsByTagName("layerBox")[0].getElementsByTagName("layer"),n=0;n<i.length;n++){var s,r=i[n];if(r.hasAttribute("id")){var a=t.settings.getPropertyType("layerId");if("string"===a)s=new De.Layer(r.getAttribute("id"));else if("int"===a)s=new De.Layer(parseInt(r.getAttribute("id")));else{if("number"!==a)throw"Unsupported layer id type '"+a+"'";s=new De.Layer(parseFloat(r.getAttribute("id")))}this._layerBox.getDataById(s.getId())?s=this._layerBox.getDataById(s.getId()):this._layerBox.add(s)}else s=this._layerBox.getDefaultLayer(),this._layerBox.moveToBottom(s);r.hasAttribute("name")&&s.setName(r.getAttribute("name")),r.hasAttribute("visible")&&s.setVisible("true"===r.getAttribute("visible")),r.hasAttribute("editable")&&s.setEditable("true"===r.getAttribute("editable")),r.hasAttribute("movable")&&s.setMovable("true"===r.getAttribute("movable"))}if(t.settings.isStyleSerializable)for(var o=e.getElementsByTagName("s"),h=o.length,n=0;h>n;n++){var l=o[n];l.hasAttribute("n")&&this.deserializeStyleXml(t,l,l.getAttribute("n"))}}}),De.JsonSerializer=function(t,e,i){this.dataBox=t,this.settings=e?e:new De.SerializationSettings,this.filterFunction=i,this.ref=0,this.refMap={},this.idMap={},this.jsonObject={}},Be.ext("twaver.JsonSerializer",Object,{serialize:function(){return this.jsonObject={version:De.Util.getVersion(),platform:"html5"},this.settings.isImageSerializable&&(this.jsonObject.images={}),this.serializeBody(),JSON.stringify(this.jsonObject)},serializeBody:function(){if(this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable){var t={"class":this.dataBox.getClassName(),p:{},s:{},c:{}};this.jsonObject.dataBox=t,this.dataBox.serializeJson(this,this.dataBox.newInstance(),t),Be.isEmptyObject(t.p)&&delete t.p,Be.isEmptyObject(t.s)&&delete t.s,Be.isEmptyObject(t.c)&&delete t.c}this.jsonObject.datas=[],this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(t){this.refMap[t.getId()]=this.ref++,t.getChildren().forEach(this.initRefs,this)},isSerializable:function(t){return!!this.dataBox.contains(t)&&!(this.filterFunction&&!this.filterFunction(t))},serializeData:function(t){if(this.isSerializable(t)){var e=t.newInstance(),i=this.refMap[t.getId()],n={"class":t.getClassName(),ref:i,p:{},s:{},c:{}};if(this.settings.getPropertyType("id")&&(this.jsonObject.id=t.getId()),this.jsonObject.datas.push(n),t.serializeJson(this,e,n),Be.isEmptyObject(n.p)&&delete n.p,Be.isEmptyObject(n.s)&&delete n.s,Be.isEmptyObject(n.c)&&delete n.c,this.settings.isImageSerializable&&t.getImage){var s=t.getImage();if("string"==typeof s&&!Wn[s]&&!this.jsonObject.images[s]){var r=Be.getImageAsset(s),a=r&&r.getImage();a&&!nn(a)&&(this.jsonObject.images[s]=a)}}}t.getChildren().forEach(this.serializeData,this)},serializePropertyJson:function(t,e,i,n){var s=this.settings.getPropertyType(e);if(s){var r=Be.getValue(t,e,s),a=Be.getValue(i,e,s);r!==a&&this.serializeValue(e,r,a,s,n.p)}},serializeStyleJson:function(t,e,i,n){var s=this.settings.getStyleType(e);if(s){var r=t.getStyle(e),a=i.getStyle(e);r!=a&&this.serializeValue(e,r,a,s,n.s)}},serializeClientJson:function(t,e,i,n){var s=this.settings.getClientType(e);if(null!=s){var r=t.getClient(e),a=i.getClient(e);r!=a&&this.serializeValue(e,r,a,s,n.c)}},serializeValue:function(t,e,i,n,s){if(null==e)s[t]=null;else if(e instanceof gn)s[t]=e._as;else if("data"===n){var r=this.refMap[e.getId()];null!=r&&(s[t]=r)}else s[t]=e},deserialize:function(t,e){Be.isDeserializing=!0,this.jsonObject=JSON.parse(t);var i=this.jsonObject.images;this.settings.isImageSerializable&&i&&Object.keys(i).forEach(function(t){Be.registerImage(t,i[t])}),this.refMap={},this.idMap={};for(var n,s=new gn,r=new gn,a=this.jsonObject.datas.length,o=0;a>o;o++){var h=this.jsonObject.datas[o],l=h["class"],c=this.settings.getPropertyType("id");if(c&&null!=h.id){if("remove"===h.action){this.dataBox.removeById(h.id);continue}n=this.dataBox.getDataById(h.id),n||(n=Be.newInstance(l,h.id))}else n=Be.newInstance(l);null!=h.ref&&(this.refMap[h.ref]=n),s.add(n),r.add(h),this.idMap[n.getId()]=n}for(this.dataBox.forEach(function(t){this.idMap[t.getId()]=t},this),a=s.size(),o=0;a>o;o++)n=s.get(o),n.deserializeJson(this,r.get(o));for(o=0;a>o;o++)n=s.get(o),this.dataBox.containsById(n.getId())||(e&&!n.getParent()&&n.setParent(e),this.dataBox.add(n));this.settings.isDataBoxSerializable&&this.jsonObject.dataBox&&this.dataBox.deserializeJson(this,this.jsonObject.dataBox),Be.isDeserializing=!1},deserializePropertyJson:function(t,e,i){var n=this.settings.getPropertyType(i);n&&Be.setValue(t,i,this.deserializeValue(e,n))},deserializeStyleJson:function(t,e,i){var n=this.settings.getStyleType(i);n&&t.setStyle(i,this.deserializeValue(e,n))},deserializeClientJson:function(t,e,i){var n=this.settings.getClientType(i);n&&t.setClient(i,this.deserializeValue(e,n))},deserializeValue:function(t,e){if("data"===e){var i=this.refMap[t];return i?i:this.idMap[t]}return"array.number"===e?t:t instanceof Array?new gn(t):t}}),Be.addMethod(De.Data,{serializeJson:function(t,e,i){if(t.settings.isClientSerializable&&this._clientMap)for(var n in this._clientMap)this.serializeClientJson(t,n,e,i);this.serializePropertyJson(t,"name",e,i),this.serializePropertyJson(t,"icon",e,i),this.serializePropertyJson(t,"toolTip",e,i),this.serializePropertyJson(t,"parent",e,i)},serializePropertyJson:function(t,e,i,n){t.serializePropertyJson(this,e,i,n)},serializeClientJson:function(t,e,i,n){t.serializeClientJson(this,e,i,n)},deserializeJson:function(t,e){var i;for(i in e.p)this.deserializePropertyJson(t,e.p[i],i);if(t.settings.isClientSerializable)for(i in e.c)this.deserializeClientJson(t,e.c[i],i)},deserializePropertyJson:function(t,e,i){t.deserializePropertyJson(this,e,i)},deserializeClientJson:function(t,e,i){t.deserializeClientJson(this,e,i)}}),Be.addMethod(De.Element,{serializeJson:function(t,e,i){if(t.settings.isStyleSerializable&&this._styleMap)for(var n in this._styleMap)this.serializeStyleJson(t,n,e,i);if(De.Element.superClass.serializeJson.call(this,t,e,i),this.serializePropertyJson(t,"layerId",e,i),this._alarmState.getHighestNativeAlarmSeverity()&&"alarmstate"===t.settings.getPropertyType("alarmState")){var s={n:{},a:{}};i.p.alarmState=s,De.AlarmSeverity.forEach(function(t){var e=this.getNewAlarmCount(t);e>0&&(s.n[t.name]=e)},this._alarmState),De.AlarmSeverity.forEach(function(t){var e=this.getAcknowledgedAlarmCount(t);e>0&&(s.a[t.name]=e)},this._alarmState),Be.isEmptyObject(s.n)&&delete s.n,Be.isEmptyObject(s.a)&&delete s.a,Be.isEmptyObject(s)&&delete i.p.alarmState}},serializeStyleJson:function(t,e,i,n){t.serializeStyleJson(this,e,i,n)},deserializeJson:function(t,e){if(De.Element.superClass.deserializeJson.call(this,t,e),t.settings.isStyleSerializable)for(var i in e.s)this.deserializeStyleJson(t,e.s[i],i)},deserializeStyleJson:function(t,e,i){t.deserializeStyleJson(this,e,i)},deserializePropertyJson:function(t,e,i){if("alarmState"===i){if("alarmstate"===t.settings.getPropertyType("alarmState")){var n;for(n in e.n)this._alarmState.setNewAlarmCount(De.AlarmSeverity.getByName(n),e.n[n]);for(n in e.a)this._alarmState.setAcknowledgedAlarmCount(De.AlarmSeverity.getByName(n),e.a[n])}}else De.Element.superClass.deserializePropertyJson.call(this,t,e,i)}}),Be.addMethod(On,{serializeJson:function(t,e,i){On.superClass.serializeJson.call(this,t,e,i),this.serializePropertyJson(t,"image",e,i),this.serializePropertyJson(t,"location",e,i),Be.num(this._width)&&this._width>=0&&this.serializePropertyJson(t,"width",e,i),Be.num(this._height)&&this._height>=0&&this.serializePropertyJson(t,"height",e,i)}}),Be.addMethod(De.Link,{serializeJson:function(t,e,i){De.Link.superClass.serializeJson.call(this,t,e,i),this.serializePropertyJson(t,"fromNode",e,i),this.serializePropertyJson(t,"toNode",e,i)}}),Be.addMethod(De.Follower,{serializeJson:function(t,e,i){De.Follower.superClass.serializeJson.call(this,t,e,i),this.serializePropertyJson(t,"host",e,i)}}),Be.addMethod(Vn,{serializeJson:function(t,e,i){Vn.superClass.serializeJson.call(this,t,e,i),this.serializePropertyJson(t,"expanded",e,i)}}),Be.addMethod(De.ShapeNode,{serializeJson:function(t,e,i){De.ShapeNode.superClass.serializeJson.call(this,t,e,i),this.serializePropertyJson(t,"points",e,i),this.serializePropertyJson(t,"segments",e,i)}}),Be.addMethod(De.ShapeLink,{serializeJson:function(t,e,i){De.ShapeLink.superClass.serializeJson.call(this,t,e,i),this.serializePropertyJson(t,"points",e,i)}}),Be.addMethod(De.RotatableNode,{serializeJson:function(t,e,i){De.RotatableNode.superClass.serializeJson.call(this,t,e,i),this.serializePropertyJson(t,"angle",e,i)}}),Be.addMethod(De.DataBox,{serializeJson:function(t,e,i){if(t.settings.isClientSerializable&&this._clientMap)for(var n in this._clientMap)this.serializeClientJson(t,n,e,i);this.serializePropertyJson(t,"name",e,i),this.serializePropertyJson(t,"icon",e,i),this.serializePropertyJson(t,"toolTip",e,i)},serializePropertyJson:function(t,e,i,n){t.serializePropertyJson(this,e,i,n)},serializeClientJson:function(t,e,i,n){t.serializeClientJson(this,e,i,n)},deserializeJson:function(t,e){var i;for(i in e.p)this.deserializePropertyJson(t,e.p[i],i);if(t.settings.isClientSerializable)for(i in e.c)this.deserializeClientJson(t,e.c[i],i)},deserializePropertyJson:function(t,e,i){t.deserializePropertyJson(this,e,i)},deserializeClientJson:function(t,e,i){t.deserializeClientJson(this,e,i)}}),Be.addMethod(De.ElementBox,{serializeJson:function(t,e,i){if(t.settings.isLayerBoxSerializable&&(i.layers=[],this._layerBox.forEachByDepthFirst(function(t){var e={};i.layers.push(e),this._layerBox.getDefaultLayer()!==t&&(e.id=t.getId()),t.getName()&&(e.name=t.getName()),e.visible=t.isVisible(),e.editable=t.isEditable(),e.movable=t.isMovable()},null,this)),t.settings.isStyleSerializable&&this._styleMap)for(var n in this._styleMap)this.serializeStyleJson(t,n,e,i);De.ElementBox.superClass.serializeJson.call(this,t,e,i)},serializeStyleJson:function(t,e,i,n){t.serializeStyleJson(this,e,i,n)},deserializeStyleJson:function(t,e,i){t.deserializeStyleJson(this,e,i)},deserializeJson:function(t,e){if(De.ElementBox.superClass.deserializeJson.call(this,t,e),t.settings.isLayerBoxSerializable&&e.layers&&e.layers)for(var i=e.layers.length,n=0;i>n;n++){var s,r=e.layers[n];null!=r.id?(s=new De.Layer(r.id),this._layerBox.getDataById(s.getId())?s=this._layerBox.getDataById(s.getId()):this._layerBox.add(s)):(s=this._layerBox.getDefaultLayer(),this._layerBox.moveToBottom(s)),r.name&&s.setName(r.name),null!=r.visible&&s.setVisible(r.visible),null!=r.editable&&s.setEditable(r.editable),null!=r.movable&&s.setMovable(r.movable)}if(t.settings.isStyleSerializable)for(var a in e.s)this.deserializeStyleJson(t,e.s[a],a)}}),De.layout.SpringLayouter=function(t){this._network=t,this._damper=1,this._maxMotion=0,this._motionRatio=0,this._isAdjusting=!1,this._timer=null,this._snodeMap={},this._snodes=new gn,this._slinks=new gn,this._network.getElementBox().addDataBoxChangeListener(this._handleDataBoxChange,this),this._network.getElementBox().addDataPropertyChangeListener(this._handleDataPropertyChange,this),this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this)},Be.ext("twaver.layout.SpringLayouter",Object,{_nodeRepulsionFactor:.6,_linkRepulsionFactor:.6,_limitBounds:null,_interval:50,_stepCount:10,_motionLimit:.01,start:function(){if(!this._timer){var e=this,i=function(){e.relax.call(e)};this._timer=t.setInterval(i,this._interval),this._damper=1}},stop:function(){this._timer&&(t.clearInterval(this._timer),this._timer=null)},relax:function(){if(!(this._damper<.1&&this._maxMotion<this._motionLimit)){this._rebuild();for(var t=this._snodes.size(),e=0;e<this._stepCount;e++){this._slinks.forEach(this._relaxLink,this);for(var i=0;t>i;i++)for(var n=0;t>n;n++){var s=this._snodes.get(i),r=this._snodes.get(n);s!=r&&this._relaxNodePair(s,r)}this._moveNodes()}this._isAdjusting=!0;for(var e=0;t>e;e++){var a=this._snodes.get(e);a.fix||a.element.setLocation(a.x,a.y)}this._isAdjusting=!1}},isRunning:function(){return!!this._timer},getNetwork:function(){return this._network},isVisible:function(t){return this._network.isVisible(t)},isMovable:function(t){return!!this._network.isMovable(t)&&(!this._network.getSelectionModel().contains(t)&&!(t instanceof Vn))},getNodeRepulsionFactor:function(){return this._nodeRepulsionFactor},setNodeRepulsionFactor:function(t){.02>t&&(t=.02),this._nodeRepulsionFactor=t,this._damper=1},getLinkRepulsionFactor:function(){return this._linkRepulsionFactor},setLinkRepulsionFactor:function(t){.02>t&&(t=.02),this._linkRepulsionFactor=t,this._damper=1},getStepCount:function(){return this._stepCount},setStepCount:function(t){this._stepCount=t,this._damper=1},getInterval:function(){return this._interval},setInterval:function(e){if(this._interval!==e&&(this._interval=e,this._timer)){t.clearInterval(this._timer);var i=this,n=function(){i.relax.call(i)};this._timer=t.setInterval(n,this._interval)}},getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(t){this._limitBounds=t,this._damper=1},_handleDataPropertyChange:function(t){this._isAdjusting||(this._damper=1)},_handleDataBoxChange:function(t){this._damper=0===this._network.getElementBox().size()?0:1},_handleNetworkPropertyChange:function(t){if("elementBox"===t.property){var e=t.oldValue;null!=e&&(e.removeDataBoxChangeListener(this._handleDataBoxChange,this),e.removeDataPropertyChangeListener(this._handleDataPropertyChange,this)),this._network.getElementBox().addDataBoxChangeListener(this._handleDataBoxChange,this),this._network.getElementBox().addDataPropertyChangeListener(this._handleDataPropertyChange,this)}},_relaxLink:function(t){var e=t.toNode.x-t.fromNode.x,i=t.toNode.y-t.fromNode.y,n=Math.sqrt(e*e+i*i),s=.25*e,r=.25*i;s/=100*t.length;var a=t.length,o=100*a,h=r;r/=o,h/=100*t.length,t.toNode.dx=t.toNode.dx-s*n,t.toNode.dy=t.toNode.dy-r*n,t.fromNode.dx=t.fromNode.dx+s*n,t.fromNode.dy=t.fromNode.dy+r*n},_relaxNodePair:function(t,e){var i=0,n=0,s=t.x-e.x,r=t.y-e.y,a=s*s+r*r;0===a?(i=De.Util.random(),n=De.Util.random()):36e4>a&&(i=s/a,n=r/a);var o=t.repulsion*e.repulsion/100,h=.25*o;t.dx+=i*h,t.dy+=n*h,e.dx-=i*h,e.dy-=n*h},_moveNodes:function(){for(var t=this._maxMotion,e=0,i=0,n=this._snodes.size();n>i;i++){var s=this._snodes.get(i),r=s.dx,a=s.dy;r*=this._damper,a*=this._damper,s.dx=r/2,s.dy=a/2;var o=Math.sqrt(r*r+a*a);if(!s.fix)if(s.x=s.x+Math.max(-30,Math.min(30,r)),s.y=s.y+Math.max(-30,Math.min(30,a)),this._limitBounds){s.x<this._limitBounds.x&&(s.x=this._limitBounds.x,this._adjustLocation(1,0)),s.y<this._limitBounds.y&&(s.y=this._limitBounds.y,this._adjustLocation(0,1));var h,l=this._network.getElementUI(s.element);h=l?l._viewRect:s.element.getRect(),h&&(s.x+h.width>this._limitBounds.x+this._limitBounds.width&&(s.x=this._limitBounds.x+this._limitBounds.width-h.width,this._adjustLocation(-1,0)),s.y+h.height>this._limitBounds.y+this._limitBounds.height&&(s.y=this._limitBounds.y+this._limitBounds.height-h.height,this._adjustLocation(0,-1)))}else s.x<1&&this._adjustLocation(1,0),s.y<1&&this._adjustLocation(0,1);e=Math.max(o,e)}this._maxMotion=e,this._motionRatio=this._maxMotion>0?t/this._maxMotion-1:0,this._damp()},_damp:function(){this._motionRatio<=.001&&((this._maxMotion<.2||this._maxMotion>1&&this._damper<.9)&&this._damper>.01?this._damper-=.01:this._maxMotion<.4&&this._damper>.003?this._damper-=.003:this._damper>1e-4&&(this._damper-=1e-4)),this._maxMotion<this._motionLimit&&(this._damper=0)},_rebuild:function(){this._snodeMap={},this._snodes.clear(),this._slinks.clear(),this._network.getElementBox().forEach(function(t){this.isVisible(t)&&(t instanceof De.Link?this._addLink(t):t instanceof On&&this._addNode(t))},this)},_addNode:function(t){var e=this._snodeMap[t.getId()];return e?e:(e={},e.element=t,e.repulsion=this._getRepulsion(t),e.x=t.getX(),e.y=t.getY(),e.dx=0,e.dy=0,e.fix=!this.isMovable(t),this._snodeMap[t.getId()]=e,this._snodes.add(e),e)},_addLink:function(t){var e={};e.fromNode=this._addNode(t.getFromNode()),e.toNode=this._addNode(t.getToNode()),e.element=t;var i,n,s=this._network.getElementUI(t.getToNode()),r=this._network.getElementUI(t.getFromNode());s&&s._viewRect&&r&&r._viewRect?(i=s._viewRect.width+r._viewRect.width,n=s._viewRect.height+r._viewRect.height):(i=t.getToNode().getWidth()+t.getFromNode().getWidth(),n=t.getToNode().getHeight()+t.getFromNode().getHeight()),e.length=Math.floor(Math.sqrt(i*i+n*n)*this._linkRepulsionFactor),e.length<=0&&(e.length=100),this._slinks.add(e)},_getRepulsion:function(t){var e,i=this._network.getElementUI(t);if(i&&i._viewRect){var n=i._viewRect;e=Math.floor(Math.sqrt(n.width*n.width+n.height*n.height)*this._nodeRepulsionFactor)}else e=100;return 0>=e&&(e=100),e},_adjustLocation:function(t,e){for(var i=0,n=this._snodes.size();n>i;i++){var s,r=this._snodes.get(i),a=this._network.getElementUI(r.element);if(s=a?a._viewRect:r.element.getRect(),!s)return;t>0?(!this._limitBounds||r.x+s.width+t<this._limitBounds.x+this._limitBounds.width)&&(r.x+=t):(!this._limitBounds||r.x+t>this._limitBounds.x)&&(r.x+=t),e>0?(!this._limitBounds||r.y+s.height+e<this._limitBounds.y+this._limitBounds.height)&&(r.y+=e):(!this._limitBounds||r.y+e>this._limitBounds.y)&&(r.y+=e)}}}),De.layout.CloudLayouter=function(t){De.layout.CloudLayouter.superClass.constructor.apply(this,arguments),this._network=t,this._centerX=0,this._centerY=0,this._radius=1,this._rect=null,this._localPoint=null,this._lastWidth=-1e3,this._lastHeight=-1e3,this._nodes=new gn,this._sa=0,this._ca=0,this._sb=0,this._cb=0,this._sc=0,this._cc=0,this._lasta=0,this._lastb=0,this._active=!1,this._horizontalElliptical=1,this._verticalElliptical=1,this._timer=null,this._centering=!1,this._centeringNode=null,this._freeze=!1,this._network.setInteractions("twaver.network.Network"===this._network.getClassName()?[new De.network.interaction.SelectInteraction(this._network)]:[new De.canvas.interaction.SelectInteraction(this._network)])},Be.ext("twaver.layout.CloudLayouter",De.PropertyChangeDispatcher,{__accessor:["updateNodeFunction","mouseMoveFunction","mouseOverFunction","percentPadding","ceaseRate","ceaseLimit"],__bool:["elliptical","active","updateLayoutRectOnResized","reloadOnDataBoxChanged"],_moveSpeed:2,_ceaseRate:.9,_ceaseLimit:.01,_percentPadding:.2,_elliptical:!0,_interval:50,_reloadOnDataBoxChanged:!0,_updateLayoutRectOnResized:!0,getNetwork:function(){return this._network},isLayoutable:function(t){return this._network.isVisible(t)&&this._network.isMovable(t)},start:function(e){if(0===arguments.length&&(e=!0),!this._timer){this._installListeners(),e&&this.updateLayoutRect(!0);var i=this,n=function(){i._update.call(i)};this._timer=t.setInterval(n,this._interval),this._update()}},stop:function(){this._timer&&(t.clearInterval(this._timer),this._timer=null)},isRunning:function(){return!!this._timer},getInterval:function(){return this._interval},setInterval:function(e){if(this._interval!==e){var i=this._interval;if(this._interval=e,this._timer){t.clearInterval(this._timer);var n=this,s=function(){n._update.call(n)};this._timer=t.setInterval(s,this._interval)}this.firePropertyChange("interval",i,e)}},getMoveSpeed:function(){return this._moveSpeed},setMoveSpeed:function(t){var e=this._moveSpeed;this._moveSpeed=t,this.firePropertyChange("moveSpeed",e,t)},getLayoutRect:function(){var t=this._network.getView().offsetWidth/this._network.getZoom(),e=this._network.getView().offsetHeight/this._network.getZoom(),i=t*this._percentPadding,n=e*this._percentPadding;return{x:i,y:n,width:t-2*i,height:e-2*n}},getCount:function(){return this._nodes.size()},updateLayoutRect:function(t){var e=this._radius;if(this._rect=this.getLayoutRect(),this._rect.width<=2&&(this._rect.width=2),this._rect.height<=2&&(this._rect.height=2),this._radius=Math.min(this._rect.width/2,this._rect.height/2),this.isElliptical()?(this._horizontalElliptical=this._rect.width/2/this._radius,this._verticalElliptical=this._rect.height/2/this._radius):(this._horizontalElliptical=1,this._verticalElliptical=1),this._centerX=this._rect.x+this._rect.width/2,this._centerY=this._rect.y+this._rect.height/2,t)this.reload();else{this._lasta=1,this._lastb=1;for(var i=this._nodes.size(),n=0;i>n;n++){var s=this._nodes.get(n);s.cx*=this._radius/e,s.cy*=this._radius/e,s.cz*=this._radius/e}this._freeze?this._updateNodes(0,0,0):this._update()}this._lastWidth=this._network.getView().offsetWidth,this._lastHeight=this._network.getView().offsetHeight},reload:function(){this._freeze=!1,this._centeringNode=null,this._localPoint=null,this._centering=!1,this._nodes=new gn,this._box.forEach(function(t){if(t&&this.isLayoutable(t)){var e={};e.node=t,this._nodes.add(e)}},this),this._sineCosine(0,0,0),this._active=!1,this._lasta=1,this._lastb=1;for(var t=0,e=0,i=this._nodes.size(),n=0;i>n;n++){t=Math.acos(-1+(2*(n+1)-1)/i),e=Math.sqrt(i*Math.PI)*t;var s=this._nodes.get(n);s.cx=this._radius*Math.cos(e)*Math.sin(t),s.cy=this._radius*Math.sin(e)*Math.sin(t),s.cz=this._radius*Math.cos(t)}},_sineCosine:function(t,e,i){var n=Math.PI/180;this._sa=Math.sin(t*n),this._ca=Math.cos(t*n),this._sb=Math.sin(e*n),this._cb=Math.cos(e*n),this._sc=Math.sin(i*n),this._cc=Math.cos(i*n)},handleSelectionChange:function(t){this.centerNode(this._network.getSelectionModel().getLastData())},handleDataBoxChange:function(t){(this._reloadOnDataBoxChanged||"clear"===t.kind)&&this.reload()},handleMouseMove:function(t){this._centering||this._updateLogicalPoint(t),this._active=!this._mouseMoveFunction||this._mouseMoveFunction(t)},handleMouseOver:function(t){this._centering||this._updateLogicalPoint(t),this._active=!this._mouseOverFunction||this._mouseOverFunction(t)},_updateLogicalPoint:function(t){this._localPoint=this._network.getLogicalPoint(t)},handleRollOut:function(t){this._active=!1},handleResize:function(t){if("validateEnd"===t.kind){if(!this._updateLayoutRectOnResized)return;if(Math.abs(this._network.getView().offsetWidth-this._lastWidth)<=2&&Math.abs(this._network.getView().offsetHeight-this._lastHeight)<=2)return;this.updateLayoutRect()}},handleNetworkPropertyChange:function(t){"elementBox"===t.property&&(this._box.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._box=this._network.getElementBox(),this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this.reload()),"zoom"===t.property&&(this._localPoint=null,this.updateLayoutRect())},_adjustIndex:function(){this._nodes.sort(this._sortFunction);for(var t=this._nodes.size(),e=0;t>e;e++){var i=this._nodes.get(e).node,n=this._box.getDatas().indexOf(i);this._box.getDatas().removeAt(n),this._box.getDatas().add(i,e),this._box.fireIndexChange(i,n,e),this.updateNode(i,e,t,this._nodes.get(e).alpha)}},_sortFunction:function(t,e){return e.cz>t.cz?1:e.cz<t.cz?-1:0},updateNode:function(t,e,i,n){this._updateNodeFunction&&this._updateNodeFunction(t,e,i,n)},_update:function(){if(!this._freeze){var t,e;if(this._centering&&this._centeringNode){var i=this.isAtCenter(this._centeringNode.node,this._centeringNode.perspective,this._centeringNode.cx,this._centeringNode.cy,this._centeringNode.cz);if(i)return this._freeze=!0,this._centering=!1,void(this._centeringNode=null)}if(!this._freeze&&(this._active||this._centering)&&this._localPoint?this.isElliptical()?(t=(this._centerY-this._localPoint.y)/(this._rect.height/2)*this._moveSpeed,e=(this._localPoint.x-this._centerX)/(this._rect.width/2)*this._moveSpeed):(t=(this._centerY-this._localPoint.y)/this._radius*this._moveSpeed,e=(this._localPoint.x-this._centerX)/this._radius*this._moveSpeed):(t=this._lasta*this._ceaseRate,e=this._lastb*this._ceaseRate),this._lasta=t,this._lastb=e,Math.abs(t)>this._ceaseLimit||Math.abs(e)>this._ceaseLimit){var n=0;this._sineCosine(t,e,n);for(var s=0,r=this._nodes.size();r>s;s++){var a=this._nodes.get(s),o=a.cx,h=a.cy*this._ca+a.cz*-this._sa,l=a.cy*this._sa+a.cz*this._ca,c=o*this._cb+l*this._sb,u=h,d=o*-this._sb+l*this._cb,f=c*this._cc+u*-this._sc,g=c*this._sc+u*this._cc,_=d;a.cx=f,a.cy=g,a.cz=_;var p=2*this._radius;p/=p+_,a.perspective=p,a.alpha=(this._radius-_)/(2*this._radius);var v=this._horizontalElliptical*f*p-2*this._horizontalElliptical+this._centerX,m=g*p*this._verticalElliptical+this._centerY;a.node.setCenterLocation(v,m)}this._adjustIndex()}}},centerNode:function(t){if(t&&this.isLayoutable(t)){if(this._centeringNode&&t===this._centeringNode.node&&this._freeze)return;for(var e=0,i=this._nodes.size();i>e;e++){var n=this._nodes.get(e);if(n&&t===n.node){this._centering=!0,this._freeze=!1,this._active=!0,this._centeringNode=n,this._localPoint=this.createControlPoint(this._centeringNode.node);break}}}else this._centering=!1,this._freeze=!1,this._active=!1,this._localPoint=null},createControlPoint:function(t){var e=t.getCenterLocation(),i=this.getLayoutRect(),n=i.x+i.width/2,s=i.y+i.height/2,r=Math.atan2(e.y-s,e.x-n),a=i.width+i.height;return{x:n+a*Math.cos(r),y:s+a*Math.sin(r)}},isAtCenter:function(t,e,i,n,s){if(this._moveSpeed<=0)return!0;var r=16/this._moveSpeed;return r>20?r=20:2>r&&(r=2),-s/Math.sqrt(i*i+n*n)>r},_updateNodes:function(t,e,i){this._sineCosine(t,e,i);for(var n=0,s=this._nodes.size();s>n;n++){var r=this._nodes.get(n),a=r.cx,o=r.cy*this._ca+r.cz*-this._sa,h=r.cy*this._sa+r.cz*this._ca,l=a*this._cb+h*this._sb,c=o,u=a*-this._sb+h*this._cb,d=l*this._cc+c*-this._sc,f=l*this._sc+c*this._cc,g=u;r.cx=d,r.cy=f,r.cz=g;var _=2*this._radius;_/=_+g,r.perspective=_;var p=this._horizontalElliptical*d*_-2*this._horizontalElliptical+this._centerX,v=f*_*this._verticalElliptical+this._centerY;r.node.setCenterLocation(p,v)}this._adjustIndex()},_installListeners:function(){this._box=this._network.getElementBox(),this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._network.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._network.addViewListener(this.handleResize,this),je.addEventListener("mouseout","handleRollOut",this._network.getView(),this),je.addEventListener("mousemove","handleMouseMove",this._network.getView(),this),je.addEventListener("mouseover","handleMouseOver",this._network.getView(),this),this._network.addPropertyChangeListener(this.handleNetworkPropertyChange,this)},_uninstallListeners:function(){this._box.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._network.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this),this._network.removeViewListener(this.handleResize,this),je.removeEventListener("mouseout",this._network.getView(),this),je.removeEventListener("mousemove",this._network.getView(),this),je.removeEventListener("mouseover",this._network.getView(),this),this._network.removePropertyChangeListener(this.handleNetworkPropertyChange,this)}}),De.layout.AutoLayouter=function(t){this._box=t},Be.ext("twaver.layout.AutoLayouter",Object,{_expandGroup:!1,_repulsion:1,_type:null,_animate:!0,_explicitXOffset:Number.NaN,_explicitYOffset:Number.NaN,_xOffset:0,_yOffset:0,isExpandGroup:function(){return this._expandGroup},setExpandGroup:function(t){this._expandGroup=t},getRepulsion:function(){return this._repulsion},setRepulsion:function(t){this._repulsion=t},getType:function(){return this._type},isAnimate:function(){return this._animate},setAnimate:function(t){this._animate=t},getElementBox:function(){return this._box},getExplicitXOffset:function(){return this._explicitXOffset},setExplicitXOffset:function(t){this._explicitXOffset=t},getExplicitYOffset:function(){return this._explicitYOffset},setExplicitYOffset:function(t){this._explicitYOffset=t},getDimension:function(t){if(t instanceof Vn&&t.getChildrenSize()>0){for(var e=null,i=0,n=t.getChildrenSize();n>i;i++){var s=t.getChildAt(i);s instanceof On&&(e=e?Ge.unionRect(e,s.getRect()):s.getRect())}return e?{width:e.width,height:e.height}:null}return{width:t.getWidth(),height:t.getHeight()}},isVisible:function(t){return!0},isMovable:function(t){return!0},getGroupLayoutType:function(t){return this._type},getElements:function(){var t,e=this._box,i=e.getSelectionModel().size()>1;i?t=e.getSelectionModel().getSelection():(t=new gn,e.forEachByBreadthFirst(t.add,null,t)),this._xOffset=-1,this._yOffset=-1;for(var n=new gn,s=0,r=t.size();r>s;s++){var a=t.get(s);this.isVisible(a)&&(a instanceof De.Link?n.add(a):this.isMovable(a)&&a instanceof On&&(n.add(a),i&&((this._xOffset<0||a.getX()<this._xOffset)&&(this._xOffset=a.getX()),(this._yOffset<0||a.getY()<this._yOffset)&&(this._yOffset=a.getY()))))}return i||(this._xOffset=isNaN(this._explicitXOffset)?50/this._repulsion:this._explicitXOffset,this._yOffset=isNaN(this._explicitYOffset)?50/this._repulsion:this._explicitYOffset),n},getLayoutResult:function(t){var e={};return this.doLayoutImpl(t,null,e),e},doLayout:function(t,e){return this.doLayoutImpl(t,e)},doLayoutImpl:function(t,e,i){var n=this,s=e;e=function(){n._box._layoutMovingElements=!1,s&&s()},this._type=t;var r=null;if("round"===t?r=new sr:"symmetry"===t?r=new mr:"hierarchic"===t?r=new Lr:("topbottom"===t||"bottomtop"===t||"rightleft"===t||"leftright"===t)&&(r=new Xs),null==r)return!1;n._box._layoutMovingElements=!0;
var a={},o=this.getElements(),h=new yr(this,o,(!0),null);o=h.process();var l=new fr(this,o,t,(!0),null);try{r.i2(l)}catch(c){return h.resetGroup(),null!=e&&e(),!1}var u,d;for(u in l._a){d=l._a[u];var f=l.g4(d);a[u]={x:f.x+this._xOffset,y:f.y+this._yOffset}}var g;if("rightleft"===t||"leftright"===t||"bottomtop"===t){var _=yr.createMatrix(t),p=Number.MAX_VALUE,v=Number.MAX_VALUE;for(u in a){d=l._a[u],g=a[u];var m=_.transform(g);g.x=m.x,g.y=m.y;var y;"rightleft"===t||"leftright"===t?(y=m.x-l.g9(d)/2/this._repulsion,p>y&&(p=y),y=m.y-l.gj(d)/2/this._repulsion,v>y&&(v=y)):(y=m.x-l.gj(d)/2/this._repulsion,p>y&&(p=y),y=m.y-l.g9(d)/2/this._repulsion,v>y&&(v=y))}for(u in a)d=l._a[u],g=a[u],g.x=g.x-p+this._xOffset,g.y=g.y-v+this._yOffset}if(null==i&&this._animate){var A=new gn,x=new gn;for(u in a)A.add(l._a[u].node),x.add(a[u]);De.animate.AnimateManager.endAnimate(),De.animate.AnimateManager.start(new De.animate.AnimateCenterLocation(A,x,function(){h.resetGroup(),null!=e&&Be.callLater(e)}))}else{for(u in a)d=l._a[u],g=a[u],null==i?d.node.setCenterLocation(g.x,g.y):i[d.node.getId()]=g;h.resetGroup(),null!=e&&Be.callLater(e)}return!0}});var Gn=function(t,e){this.x=t,this.y=e};Be.ext(Gn,Object,{equals:function(t){return this===t||t instanceof Gn&&(t.x==this.x&&t.y==this.y)}});var Zn=function(t,e){this.width=t,this.height=e};Be.ext(Zn,Object,{});var Yn=function(t,e){this.x=t,this.y=e};Be.ext(Yn,Object,{});var jn=function(){2===arguments.length?(jn.superClass.constructor.call(this,arguments[1].width,arguments[1].height),this.x=arguments[0].x,this.y=arguments[0].y):(jn.superClass.constructor.call(this,arguments[2],arguments[3]),this.x=arguments[0],this.y=arguments[1])};Be.ext(jn,Zn,{});var qn=function(t,e){if(qn.a2(t.x,e.x))this._a=1,this._b=0,this._c=-t.x;else{this._b=-1;var i=(e.y-t.y)/(e.x-t.x),n=t.y-t.x*i;this._a=i,this._c=n}};Be.ext(qn,Object,{a3:function(){return this._a},a4:function(){return this._b},a5:function(){return this._c}}),qn.a6=function(t,e){if(qn.a1(t.a3())&&qn.a1(e.a3()))return null;if(qn.a1(t.a4())&&qn.a1(e.a4()))return null;if(qn.a1(e.a4())){var i=t;t=e,e=i}var n,s,r=t.a3(),a=t.a4(),o=-t.a5();qn.a1(t.a3())?(n=e.a4(),s=-e.a5()):(n=e.a4()-e.a3()/t.a3()*t.a4(),s=-e.a5()-e.a3()/t.a3()*-t.a5());var h=s/n,l=(o-h*a)/r;return new Gn(l,h)},qn.a1=function(t){return qn.a2(t,0)},qn.a2=function(t,e){return Math.abs(t-e)<1e-5};var Kn=function(t){if(this._a=new vs,t)for(var e=0;e<t.size();e++)this._a.aa(t.get(e))};Be.ext(Kn,Object,{c:function(){return this._a.ah()},d:function(){return this._a.ah()},a:function(){for(var t=new gn,e=this.c();e.i1();e.i2())t.add(e.i6(),0);return new Kn(t)},b:function(){return this._a.ay()}});var Qn=function(t,e){this.x=t,this.y=e};Be.ext(Qn,Object,{a:function(t,e){this.x=t,this.y=e}});var Jn=function(t,e){this.x=t||0,this.y=e||0};Be.ext(Jn,Object,{b:function(){return new Jn(this.x,this.y)},a:function(t){this.z=t},c:function(){return this.x},d:function(){return this.y},f:function(t,e){this.x=t,this.y=e}});var $n=function(t){this._c=new vs,t?(this.ac(t.a8().b()),this.ad(t.a9().b())):(this.ac(new Jn),this.ad(new Jn))};Be.ext($n,Object,{a6:function(){return this.a5(this)},ac:function(t){t.a(this),this._a=t},ad:function(t){t.a(this),this._b=t},a8:function(){return this._a},a9:function(){return this._b},a1:function(t,e){return this.a4(t,e,this.aa())},a2:function(){return this._c.ay()},a7:function(t){return this._c.ak(t)},aa:function(){return 0===this._c.ay()?null:this._c.as()},a3:function(){this._c.af()},i2:function(t){var e=this.a7(t);return null!=e?new Gn(e.x,e.y):null},i1:function(){return this.a2()},i6:function(){var t=this.a8();return new Gn(t.c(),t.d())},i7:function(){var t=this.a9();return new Gn(t.c(),t.d())},i8:function(t){this.a8().f(t.x,t.y)},i9:function(t){this.a9().f(t.x,t.y)},i3:function(t,e,i){var n=this.a7(t);null!=n&&n.a(e,i)},i4:function(t,e){this.a1(t,e)},i5:function(){this.a3()}});var ts=function(t){ts.superClass.constructor.call(this,t)};Be.ext(ts,$n,{a5:function(t){return new ts(t)},a4:function(t,e,i){var n=new Qn(t,e);return this.ab(n,i),n},ab:function(t,e){this._c.an(t,this._c.al(e))}});var es=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this._s=!1,this._w=30,this._h=30,this._x=t-this._w/2,this._y=e-this._h/2}else{var i=arguments[0];this._s=i._s,this._w=i._w,this._h=i._h,this._x=i._x,this._y=i._y}};Be.ext(es,Object,{m3:function(){return this.m2(this)},m4:function(){return this._x+this._w/2},m5:function(){return this._y+this._h/2},m6:function(t,e){this._x=t-this._w/2,this._y=e-this._h/2},i1:function(){return this._x},i2:function(){return this._y},i5:function(t,e){this._x=t,this._y=e},i3:function(){return this._w},i4:function(){return this._h},i6:function(t,e){var i=(this._w-t)/2,n=(this._h-e)/2;this._x+=i,this._y+=n,this._w=t,this._h=e},m1:function(t){var e,i,n,s;t.width<=0?(e=this._x,i=this._x+this._w,n=this._y,s=this._y+this._h):(e=Math.min(this._x,t.x),i=Math.max(this._x+this._w,t.x+t.width),n=Math.min(this._y,t.y),s=Math.max(this._y+this._h,t.y+t.height)),t.x=e,t.y=n,t.width=i-e,t.height=s-n}});var is=function(t){t?is.superClass.constructor.call(this,t):is.superClass.constructor.call(this,0,0)};Be.ext(is,es,{m2:function(t){return new is(t)}});var ns={};ns.a2=function(t){var e=Vs.a2(Rr.a(t.xa()));return ns.a4(t,e,ns.a3(t,e))},ns.a3=function(t,e){for(var i=t.x9();i.i1();i.i2())e.i7(i.i9(),-1);for(var n=0,s=new bs(t.xa()),r=t.x9();r.i1();r.i2()){var a=r.i9();-1===e.i2(a)&&ns.a(a,s,e,n++)}return n},ns.a6=function(t){for(var e=new ms,i=ns.a2(t),n=0;n<i.length-1;n++){var s=t.xo(i[n].x2(),i[n+1].x3());e.aa(s)}return e},ns.a4=function(t,e,i){for(var n=[],s=0;i>s;s++)n[s]=new Ns;for(var r=t.x9();r.i1();r.i2())n[e.i2(r.i9())].ae(r.i9());return n},ns.a=function(t,e,i,n){for(e.c(t),i.i7(t,n);!e.a();){t=e.b();for(var s=t.ag();null!=s;s=s.a8()){var r=s.a3();-1===i.i2(r)&&(i.i7(r,n),e.c(r))}for(var a=t.ae();null!=a;a=a.a7()){var o=a.a2();-1===i.i2(o)&&(i.i7(o,n),e.c(o))}}},ns.a1=function(t,e,i){var n=new ds(e,i);return n.a8(t),n._i},ns.a5=function(t,e,i){for(var n=[],s=0;i>s;s++)n[s]=new ms;for(var r=t.xf();r.i1();r.i2())n[e.i2(r.i8())].aa(r.i8());return n},ns.a7=function(t){var e=new ms,i=Vs.a3(Rr.b(t.xa())),n=Vs.a4(Rr.a(t.xh())),s=ns.a1(t,n,i),r=ns.a5(t,n,s);if(r.length>1){for(var a=new Ns,o=0;o<r.length;o++){var h=r[o],l=null;if(1===h.ay()){var c=h.c2();1===c.a2().ad()?l=c.a2():1===c.a3().ad()&&(l=c.a3())}else{for(var u=h.c1();u.i1();u.i2()){var d=u.i8();if(i.i4(d.a2()))if(null==l)l=d.a2();else if(l!==d.a2()){l=null;break}if(i.i4(d.a3()))if(null!=l){if(l!==d.a3()){l=null;break}}else l=d.a3()}if(null!=l){var f=h.c2();l=f.a2()!==l?f.a2():f.a3()}}null!=l&&a.aa(l)}for(var g,_=a.x4();!a.ar();_=g)g=a.x4(),e.ac(t.xo(_,g))}return e};var ss=function(){this._c=0,this._d=0,this._e=0,this._b=!0,this._f=!1};Be.ext(ss,Object,{a6:function(t){this._f=t},a7:function(t){this._b=t},a8:function(t){0!==t.x0()&&this.a9(t,t.x9().i9())},a9:function(t,e){if(this._xx=t.xk(),this._c=t.xl(),this._d=0,this._e=0,this.a0(e),this._b)for(var i=t.x9();i.i1();i.i2()){var n=i.i9();null==this._xx.i1(n)&&(this.a1(n),this.a0(n))}t.xi(this._xx),t.xj(this._c)},a0:function(t){var e=++this._d;this._xx.z1(t,ss._B),this.a5(t,e);for(var i=this._f?t.ap():t.af();i.i1();i.i2()){var n=i.i8();if(!this._c.i4(n)){this._c.i7(n,!0);var s=n.a1(t);null==this._xx.i1(s)?(this.a3(n,s,!0),this.a0(s),this.a2(n,s)):this.a3(n,s,!1)}}this.a4(t,e,++this._e),this._xx.z1(t,ss._C)},a5:function(t,e){},a4:function(t,e,i){},a3:function(t,e,i){},a2:function(t,e){},a1:function(t){}}),ss._B={},ss._C={};var rs=function(t){this._a=t};Be.ext(rs,ss,{a5:function(t,e){var i=this._a._ah.i2(t);this._a._ad[i].ae(t)}});var as=function(t){this._a=t};Be.ext(as,ss,{a2:function(t,e){var i=t.a1(e),n=this._a[i.al()],s=this._a[e.al()];s._a+1>n._a?(n._c=n._a,n._b=n._d,n._a=s._a+1,n._d=t):s._a+1>n._c&&(n._c=s._a+1,n._b=t)}});var os=function(t){this._a=t};Be.ext(os,ss,{a3:function(t,e,i){i&&t.a2()===e&&this._a.ac(t)}});var hs=function(){this._a=0,this._c=0};Be.ext(hs,Object,{});var ls=function(){this._a=0};Be.ext(ls,Object,{a1:function(t,e){this._a=0;for(var i=e.length-1;i>=0;i--)e[i]=-1;for(var n=t.x9();n.i1();n.i2()){var s=n.i9();if(0===s.ak()){this.a2(s,s.al(),e);break}}for(var r=t.x9();r.i1();r.i2()){var a=r.i9(),o=a.al();-1===e[o]&&this.a2(a,o,e)}},a2:function(t,e,i){i[e]=-2;for(var n=t.ag();null!=n;){var s=n.a3(),r=s.al();switch(i[r]){case-1:this.a2(s,r,i);case-2:default:n=n.a8()}}i[e]=this._a++}});var cs={};cs.a1=function(t){var e=new us;return e.a8(t),e._n},cs.a2=function(t){var e=t.x9(),i=null,n=0;for(e.i4();e.i1();e.i2())0===e.i9().ak()&&(i=e.i9(),n++);if(1===n)return i;for(n=0,e.i4();e.i1();e.i2())0===e.i9().ao()&&(i=e.i9(),n++);return 1===n?i:cs.a8(t)},cs.a8=function(t){var e=Rr.a(t.x0()),i=Vs.a2(e);return cs.a6(t,i)},cs.a6=function(t,e){var i=t.xd(),n=Rr.d(1),s=Rr.a(t.x0(),-1),r=cs.a4(t,i);cs.a7(i,e,n,s,-1);for(var a=r.c1();a.i1();a.i2())t.x3(a.i8());return n[0]},cs.a7=function(t,e,i,n,s){for(var r=0,a=t.ag();null!=a;a=a.a8()){var o=a.a3(),h=cs.a7(o,e,i,n,s);h>s&&(s=h),r+=n[o.al()]}for(var l=r*(t._g.xa()-1-r),c=t.ag();null!=c;c=c.a8())for(var u=c.a3(),d=c.a8();null!=d;d=d.a8()){var f=d.a3();l+=n[u.al()]*n[f.al()]}return e.i7(t,l),n[t.al()]=r+1,l>s&&(s=l,i[0]=t),s},cs.a4=function(t,e){var i=new ms,n=new os(i);n.a6(!1),n.a9(t,e);for(var s=i.c1();s.i1();s.i2())t.x3(s.i8());return i},cs.a3=function(t){return cs.a4(t,cs.a2(t))};var us=function(){this._n=!0,this.a6(!1)};Be.ext(us,ss,{a3:function(t,e,i){i||(this._n=!1)},a1:function(t){this._n=!1}});var ds=function(t,e){this._i=0,this._m=e,this._j=t,this._l=!1};Be.ext(ds,ss,{a8:function(t){this._h=Rr.a(t.x0()),this._k=Rr.a(t.x0()),this._g=new bs(t.xh()),ds.superClass.a8.call(this,t)},a5:function(t,e){this._k[t.al()]=this._h[t.al()]=e},a3:function(t,e,i){if(this._g.c(t),!i){var n=t.a1(e);this._h[n.al()]=Math.min(this._h[n.al()],this._k[e.al()])}},a1:function(t){this._l=!1},a2:function(t,e){var i=t.a1(e);if(this._h[e.al()]>=this._k[i.al()]){for(;this._g.d()!==t;this._j.i5(this._g.b(),this._i));this._j.i5(this._g.b(),this._i),this._i++,this._g.a()?this._l?this._m.i5(i,!0):this._l=!0:this._m.i5(i,!0)}this._h[i.al()]=Math.min(this._h[i.al()],this._h[e.al()])}});var fs=function(t,e){this._h=!1,this._i=t,this._g=e};Be.ext(fs,Object,{z1:function(t,e){t._c[this._i]=e},i1:function(t){return t._c[this._i]},i5:function(t,e){t._c[this._i]=e},i4:function(t){return t._c[this._i]},i7:function(t,e){t._c[this._i]=e},i2:function(t){var e=t._c[this._i];return null==e?0:e},i6:function(t,e){t._c[this._i]=e},i3:function(t){var e=t._c[this._i];return null==e?0:e},c:function(){return this._h},d:function(){this._h=!0}});var gs=function(t,e){this._c=!1,this._d=t,this._b=e};Be.ext(gs,Object,{i8:function(t,e){t._c[this._d]=e},i1:function(t){return t._c[this._d]},i7:function(t,e){t._c[this._d]=e},i4:function(t){var e=t._c[this._d];return null!=e&&e},i5:function(t,e){t._c[this._d]=e},i2:function(t){var e=t._c[this._d];return null==e?0:e},i6:function(t,e){t._c[this._d]=e},i3:function(t){var e=t._c[this._d];return null==e?0:e},a:function(){return this._c},b:function(){this._c=!0}});var _s=function(t){this._bb=t,this.i4()};Be.ext(_s,Object,{i1:function(){return null!=this._aa},i2:function(){this._aa=this._aa._a},i3:function(){this._aa=this._aa._b},i4:function(){this._aa=this._bb._b},i5:function(){this._aa=this._bb._c},i7:function(){return this._bb.ay()},i6:function(){return this._aa._c}});var ps=function(t){ps.superClass.constructor.call(this,t)};Be.ext(ps,_s,{i8:function(){return this.i6()}});var vs=function(t){if(this._id=Be.id(),this._a=0,t)for(t.i4();t.i1();t.i2())this.ae(t.i6())};Be.ext(vs,Object,{ac:function(t){var e=this.ag(t);return null==this._b?this._b=this._c=e:(this._b._b=e,e._a=this._b,this._b=e),this._a++,e},ae:function(t){var e=this.ag(t);return null==this._c?this._b=this._c=e:(this._c._a=e,e._b=this._c,this._c=e),this._a++,e},z1:function(t){t._b=null,t._a=null,null==this._c?this._b=this._c=t:(this._c._a=t,t._b=this._c,this._c=t),this._a++},ad:function(t){t._b=null,t._a=null,null==this._b?this._b=this._c=t:(this._b._b=t,t._a=this._b,this._b=t),this._a++},aa:function(t){return this.ae(t),!0},ab:function(t){for(;t.i1();t.i2())this.ae(t.i6())},ao:function(t,e){if(e===this._b)return this.ac(t);if(null==e)return this.ae(t);var i=this.ag(t);return this.aq(i,e),i},aq:function(t,e){if(null==e)this.ad(t);else if(e===this._b)this.ad(t);else{if(null==this._c)t._b=null,t._a=null,this._b=this._c=t;else{var i=e._b;e._b=t,t._a=e,i._a=t,t._b=i}this._a++}},ap:function(t,e){if(null==e)this.z1(t);else if(e===this._c)this.z1(t);else{if(null==this._b)t._b=null,t._a=null,this._b=this._c=t;else{var i=e._a;e._a=t,t._a=i,i._b=t,t._b=e}this._a++}},an:function(t,e){if(e===this._c)return this.ae(t);if(null==e)return this.ac(t);var i=this.ag(t);return this.ap(i,e),i},ay:function(){return this._a},ar:function(){return 0===this._a},af:function(){this._b=this._c=null,this._a=0},am:function(){return this._b._c},at:function(){var t=this.am();return this.aw(this._b),t},as:function(){return this._c._c},au:function(){return this.aw(this._c)},ak:function(t){for(var e=0,i=this._b;null!=i;){if(t===e)return i._c;i=i._a,e++}return null},aj:function(t){return null==t._a?this._b:t._a},ai:function(t){return null==t._b?this._c:t._b},aw:function(t){return t!==this._b?t._b._a=t._a:this._b=t._a,t!==this._c?t._a._b=t._b:this._c=t._b,this._a--,t._c},av:function(t){return this.aw(t._aa)},ah:function(){return new _s(this)},al:function(t){for(var e=this._b;null!=e;){if(null==e._c&&null==t)return e;if(e._c===t)return e;e=e._a}return null},a0:function(){for(var t=Rr.d(this._a),e=0,i=this._b;null!=i;)t[e]=i._c,i=i._a,e++;return t},ax:function(){for(var t=this._b;null!=t;t=t._b){var e=t._a;t._a=t._b,t._b=e}var i=this._b;this._b=this._c,this._c=i},a1:function(t){var e=this.a0();e.sort(t);for(var i=0,n=this._b;null!=n;)n._c=e[i],n=n._a,i++},a2:function(){var t=this.a0();t.sort(Rr.c);for(var e=0,i=this._b;null!=i;)i._c=t[e],i=i._a,e++},az:function(t){null==this._b?(this._b=t._b,this._c=t._c):null!=t._b&&(this._c._a=t._b,t._b._b=this._c,this._c=t._c),this._a+=t._a,t._b=t._c=null,t._a=0},ag:function(t){return new xs(t)}});var ms=function(t){ms.superClass.constructor.call(this,t)};Be.ext(ms,vs,{c1:function(){return new ps(this)},c2:function(){return this.am()},c3:function(){return this.at()}});var ys=function(){this._c=0};Be.ext(ys,Object,{a:function(t){this._c++,t._b=this._b,t._a=null,null!=this._b?(this._b._a=t,this._b=t):this._b=this._a=t},b:function(t,e){if(null==e)return void this.a(t);var i=e._b;null!=i?i._a=t:this._a=t,t._b=i,t._a=e,e._b=t,this._c++},c:function(t){var e=t._a,i=t._b;this._c--,null!=e?e._b=i:this._b=i,null!=i?i._a=e:this._a=e}});var As=function(t,e){this._p=t,this._j=e,this._o=t._o[e]};Be.ext(As,Object,{i1:function(){return null!=this._o},i2:function(){this._o=this._o._k[this._j]},i3:function(){this._o=this._o._f[this._j]},i4:function(){this._o=this._p._o[this._j]},i5:function(){this._o=this._p._q[this._j]},i7:function(){return this._p._n[this._j]},i6:function(){return this._o},i8:function(){return this._o}});var xs=function(t){this._c=t};Be.ext(xs,Object,{a:function(){return this._a},b:function(){return this._b},c:function(t){this._c=t},d:function(){return this._c}});var ws=function(t,e,i,n){this._r=t,this._s=e,this._q=i,this._p=n};Be.ext(ws,Object,{i1:function(t){return this._p[t.a5()]},i3:function(t){return this._r[t.a5()]},i2:function(t){return this._s[t.a5()]},i4:function(t){return this._q[t.a5()]},i8:function(t,e){this._p[t.a5()]=e},i6:function(t,e){this._r[t.a5()]=e},i5:function(t,e){this._s[t.a5()]=e},i7:function(t,e){this._q[t.a5()]=e}});var bs=function(t){this._a=Rr.d(t),this._b=-1};Be.ext(bs,Object,{d:function(){return this._a[this._b]},b:function(){return this._a[this._b--]},c:function(t){this._a[++this._b]=t},a:function(){return this._b<0}});var Ss=function(){};Be.ext(Ss,Object,{a0:function(t){this._c=Rr.d(t)}});var Cs=function(t,e,i,n,s,r,a){this._g=0,t.xt(this,e,i,n,s,r,a)};Be.ext(Cs,Ss,{a5:function(){return this._h._u&&this._h.b1(),this._g},a2:function(){return this._d},a3:function(){return this._e},a1:function(t){return this._d!==t?this._d:this._e},a4:function(){for(var t=0;1>=t;t++)this._k[t]=null,this._f[t]=null},a8:function(){return this._k[0]},a7:function(){return this._k[1]},a6:function(t,e,i,n){this.a0(n),this._h=t,this._k=Rr.d(2),this._f=Rr.d(2),this._d=e,this._e=i}});var Ts=function(t){this._j=0,this._h=t,this.i4()};Be.ext(Ts,Object,{i2:function(){this._k=this._k._k[this._j],null==this._k&&0===this._j&&(this._k=this._h._o[1],this._j=1)},i3:function(){this._k=this._k._f[this._j],null==this._k&&1===this._j&&(this._k=this._h._q[0],this._j=0)},i4:function(){this._k=this._h._o[0],null==this._k?(this._k=this._h._o[1],this._j=1):this._j=0},i5:function(){this._k=this._h._q[1],null==this._k?(this._k=this._h._q[0],this._j=0):this._j=1},i1:function(){return null!=this._k},i6:function(){return this._k},i8:function(){return this._k},i7:function(){return this._h.ad()}});var Es=function(){this._a=ar._A,this._b=ar._A,this._c=new gn};Be.ext(Es,Object,{i1:function(){return this._c.size()},i2:function(t){return this._c.get(t)},i3:function(t,e,i){this._c.set(t,new Gn(e,i))},i4:function(t,e){this._c.add(new Gn(t,e))},i5:function(){this._c.clear()},i6:function(){return this._a},i7:function(){return this._b},i8:function(t){this._a=t},i9:function(t){this._b=t}});var Ls=function(){this._x=0,this._y=0,this._w=0,this._h=0};Be.ext(Ls,Object,{i5:function(t,e){this._x=t,this._y=e},i6:function(t,e){this._w=t,this._h=e},i4:function(){return this._h},i3:function(){return this._w},i1:function(){return this._x},i2:function(){return this._y}});var Ms=function(t,e,i,n){this._m=t,this._n=e,this._l=i,this._k=n};Be.ext(Ms,Object,{i1:function(t){return this._k[t.al()]},i3:function(t){return this._m[t.al()]},i2:function(t){return this._n[t.al()]},i4:function(t){return this._l[t.al()]},z1:function(t,e){this._k[t.al()]=e},i6:function(t,e){this._m[t.al()]=e},i7:function(t,e){this._n[t.al()]=e},i5:function(t,e){this._l[t.al()]=e}});var Ps=function(t,e){this._b=t,this._r=e,this._a=[];for(var i=this._b-1;i>=0;i--)this._a.push(i);this._c=new gn};Be.ext(Ps,Object,{a1:function(t){var e;if(0===this._a.length){this.a2(t,this._b,this._b+this._r);for(var i=this._b+this._r-1;i>this._b;i--)this._a.push(i);e=this._b,this._b+=this._r}else e=this._a.pop();return e},b:function(t){var e=this.a1(t),i=new fs(e,this);return this._c.add(i),this.a4(t,e),i},c:function(t){var e=this.a1(t),i=new gs(e,this);return this._c.add(i),this.a4(t,e),i},a2:function(t,e,i){for(var n=t._a;null!=n;n=n._a){var s=Rr.d(i);Rr.f(n._c,s,e),n._c=s}},a3:function(t,e,i){var n=Rr.d(i);Rr.f(t._c,n,e),t._c=n},a4:function(t,e){for(var i=t._a;null!=i;i=i._a)i._c[e]=null},a5:function(t,e){if(t instanceof fs){var i=t;if(i.c())throw"Error";i.d();var n=t._i;this._a.indexOf(n)<0&&(this.a4(e,n),this._a.push(n),this._c.remove(t))}},a6:function(t,e){if(t instanceof gs){var i=t;if(i.a())throw"Error";i.b();var n=i._d;this._a.indexOf(n)<0&&(this.a4(e,n),this._a.push(n),this._c.remove(t))}}});var ks=function(t){this._id=Be.id(),this._p=0,t.xs(this)};Be.ext(ks,Ss,{ad:function(){return this._n[0]+this._n[1]},ak:function(){return this._n[1]},ao:function(){return this._n[0]},al:function(){return this._g._y&&this._g.c(),this._p},ag:function(){return this._o[0]},ae:function(){return this._o[1]},af:function(){return new Ts(this)},am:function(){return new As(this,1)},ap:function(){return new As(this,0)},an:function(){return new Rs(this)},aq:function(){return new Is(this,1)},aw:function(){return new Is(this,0)},ah:function(t){for(var e=this._o[0];null!=e;e=e._k[0])if(e.a3()===t)return e;return null},ai:function(t){for(var e=this._o[1];null!=e;e=e._k[1])if(e.a2()===t)return e;return null},aj:function(t){var e=this.ah(t);return null==e&&(e=this.ai(t)),e},au:function(t){this.at(t,1,Rr.d(this.ak()))},av:function(t){this.at(t,0,Rr.d(this.ao()))},as:function(t,e){this.a0(e),this._g=t,this._o=Rr.d(2),this._q=Rr.d(2),this._n=Rr.a(2)},ab:function(t,e,i,n,s){if(null==e)return void this.aa(t,i,n);var r;if(r=e._d===e._e?n:this!==e._d?1:0,0===s){var a=e._k[r];t._f[n]=e,t._k[n]=a,e._k[r]=t,null==a?this._q[i]=t:a._d===a._e?a._f[n]=t:a._f[this!==a._d?1:0]=t}else{var o=e._f[r];t._k[n]=e,t._f[n]=o,e._f[r]=t,null==o?this._o[i]=t:o._d===o._e?o._k[n]=t:o._k[this!==o._d?1:0]=t}this._n[i]++},aa:function(t,e,i){var n=this._q[e];t._k[i]=null,null==n?(this._o[e]=t,t._f[i]=null):(t._f[i]=n,n._d===n._e?n._k[i]=t:n._k[this!==n._d?1:0]=t),this._q[e]=t,this._n[e]++},ar:function(t,e,i){var n,s;n=t._k[i],s=t._f[i],null==n?this._q[e]=s:n._f[n._d!==this?1:0]=s,null==s?this._o[e]=n:s._k[s._d!==this?1:0]=n,this._n[e]--},ac:function(){for(var t=0;1>=t;t++)this._o[t]=null,this._q[t]=null,this._n[t]=0},at:function(t,e,i){if(!(this._n[e]<2)){var n,s=this._n[e],r=0;for(n=this._o[e];null!=n;n=n._k[e])i[r]=n,r++;Rr.s(i,s,t);var a=this._o[e]=i[0];a._f[e]=null;for(var o=1;s>o;)n=i[o],n._f[e]=a,a._k[e]=n,o++,a=n;this._q[e]=n,n._k[e]=null}}});var Is=function(t,e){Is.superClass.constructor.call(this,t,e),this._h=1!==e?1:0};Be.ext(Is,As,{i6:function(){return this.i9()},i9:function(){return 0!==this._h?this._o._e:this._o._d}});var Rs=function(t){Rs.superClass.constructor.call(this,t)};Be.ext(Rs,Ts,{i6:function(){return this._k.a1(this._h)},i9:function(){return this._k.a1(this._h)}});var Ds=function(t){Ds.superClass.constructor.call(this,t)};Be.ext(Ds,_s,{i9:function(){return this.i6()}});var Bs=function(t){this._o=t,this._c=t._a};Be.ext(Bs,Object,{i1:function(){return null!=this._c},i2:function(){this._c=this._c._a},i3:function(){this._c=this._c._b},i5:function(){this._c=this._o._b},i4:function(){this._c=this._o._a},i7:function(){return this._o._c},i6:function(){return this._c},i9:function(){return this._c},i8:function(){return this._c}});var Ns=function(t){if(t&&t.length){Ns.superClass.constructor.call(this);for(var e=0;e<t.length;e++)this.ae(t[e])}else Ns.superClass.constructor.call(this,t)};Be.ext(Ns,vs,{x1:function(){return new Ds(this)},x2:function(){return this.am()},x3:function(){return this.as()},x4:function(){return this.at()}});var zs=function(t){this._d=t,zs.superClass.constructor.call(this)};Be.ext(zs,Ns,{});var Os=function(t){this._a=t,this._b=new ms,this._c=new Ns};Be.ext(Os,Object,{a:function(){for(var t=this._a.x9();t.i1();t.i2())this.e(t.i9())},b:function(){this.c(),this.d()},c:function(){for(;!this._c.ar();){var t=this._c.x4();this._a.xq(t)||this.g(t)}},d:function(){for(;!this._b.ar();){var t=this._b.c3();this._a.xp(t)||this.f(t)}},e:function(t){for(var e=t.af();e.i1();e.i2())this._b.ac(e.i8()),this._a.h1(e.i8());this._c.ac(t),this._a.h2(t)},f:function(t){this._a.u1(t)},g:function(t){this._a.h3(t)}}),Os.h=function(t,e){for(e.i4();e.i1();e.i2()){var i=e.i8();t.xq(i.a2())||t.h3(i.a2()),t.xq(i.a3())||t.h3(i.a3()),t.xp(i)||t.u1(i)}},Os.i=function(t,e){for(e.i4();e.i1();e.i2()){var i=e.i8();t.xp(i)&&t.h1(i),0===i.a2().ad()&&t.h2(i.a2()),0===i.a3().ad()&&t.h2(i.a3())}};var Fs=function(){this._g=arguments[0],this._f=this._g.xk(),this._h=this._g.xk(),this._d=new vs,this._e=0,1!==arguments.length&&this.a(arguments[1],arguments[2],arguments[3],arguments[4])};Be.ext(Fs,Object,{a:function(t,e,i,n){for(var s=Rr.d(i-e+1),r=e;i>=r;r++)s[r]=new zs(r);for(var a=this._g.x9();a.i1();a.i2()){var o=a.i9();(null==n||n.i4(o))&&(this._f.z1(o,s[t.i2(o)-e].ac(o)),this._e++)}for(var h=0;h<s.length;h++)for(var l=s[h],c=this._d.ae(l),u=l.x1();u.i1();u.i2())this._h.z1(u.i9(),c)},c:function(){this._g.xi(this._h),this._g.xi(this._f)},e:function(){return 0===this._e},g:function(){for(;this._d.am().ar();this._d.at());this._e--;var t=this._d.am().x4();return this._h.z1(t,null),this._f.z1(t,null),t},f:function(){for(;this._d.as().ar();this._d.au());this._e--;var t=this._d.as().x4();return this._h.z1(t,null),this._f.z1(t,null),t},d:function(t){var e=this._f.i1(t),i=this._h.i1(t),n=i.d(),s=null,r=i.a();null!=r?(s=r.d(),this._h.z1(t,r)):(s=new zs(n._d+1),this._h.z1(t,this._d.ae(s))),n.aw(e),this._f.z1(t,s.ac(t))},b:function(t){var e=this._f.i1(t),i=this._h.i1(t),n=i.d(),s=null,r=i.b();null!=r?(s=r.d(),this._h.z1(t,r)):(s=new zs(n._d-1),this._h.z1(t,this._d.ac(s))),n.aw(e),this._f.z1(t,s.ac(t))}});var Vs={};Vs.a1=function(t){return new Ms(t,null,null,null)},Vs.a2=function(t){return new Ms(null,t,null,null)},Vs.a3=function(t){return new Ms(null,null,t,null)},Vs.a4=function(t){return new ws(null,t,null,null)},Vs.a5=function(t){return new ws(null,null,t,null)},Vs.a6=function(t){return new ws(null,null,null,t)};var Us=function(){if(2===arguments.length){this._a=new vs,this._b=new vs,this._c=0;var t=arguments[0],e=arguments[1],i=new Hs(t._j2.gj(e)/2,0);this._a.ac(i),i=new Hs(t._j2.gj(e)/2,0),this._b.ac(i)}else this._a=arguments[1],this._b=arguments[2],this._c=arguments[3]};Be.ext(Us,Object,{});var Hs=function(t,e){this._b=t,this._a=e};Be.ext(Hs,Object,{});var Ws=function(){this._cx=!0,this._cs=new er,this._ct=new $s,this._cw=new tr};Be.ext(Ws,Object,{i5:function(t){this._cx=t},k:function(){var t=new ir(this);return this._cx&&(this._cs.w1(t),t=this._cs),this._cw.w1(t),t=this._cw,this._ct.w1(t),t=this._ct},i2:function(t){this.k().i2(t)},i1:function(t){return this.k().i1(t)}});var Xs=function(){Xs.superClass.constructor.call(this),this._jv=20,this._jw=40,this._jx=function(t,e){var i=t.a3(),n=e.a3(),s=i._g;return Math.floor(100*(s.g5(i)-s.g5(n)))}};Be.ext(Xs,Ws,{i4:function(t){return cs.a1(t)},i3:function(t){if(!this.i4(t))throw"Error";var e=cs.a3(t);if(this._j2=t,this._j3=new Gs(t),gr.c(t),this._jy=t.xk(),!t.xb()){this.bu();var i=this._j3.c1();this.f(i),this.b(this._j3),this.c(this._j3)}for(var n;!e.ar();t.x3(n))n=e.c3(),gr.b(t.g2(n))},bu:function(){if(null!=this._jx)for(var t=this._j2.x9();t.i1();t.i2())t.i9().av(this._jx)},c:function(t){for(var e=this.a2(t),i=Rr.a(e.length),n=0;n<e.length;n++){for(var s=e[n],r=0,a=s.ah();a.i1();a.i2()){var o=a.i6();r=Math.max(r,this._j2.g9(o))}i[n]=r}for(var h=-this._jw,l=0;l<e.length;l++){h+=this._jw+i[l];for(var c=e[l],u=c.ah();u.i1();u.i2()){var d=u.i6();this._j2.s2(d,this._j2.g5(d),h-i[l]/2)}}},a2:function(t){for(var e=Rr.d(t.b()),i=0,n=t.b();n>i;i++)e[i]=new vs;return t.c1(),this.a1(t.c1(),0,e),e},a1:function(t,e,i){i[e].ae(t);for(var n=t.aw();n.i1();n.i2())this.a1(n.i9(),e+1,i)},b:function(t){var e=t.c1();this._j2.s2(e,0,this._j2.g6(e)),this.g(e)},g:function(t){for(var e=t.aw();e.i1();e.i2()){var i=e.i9(),n=this._jy.i1(i);this._j2.s2(i,this._j2.g5(t)+n._c,this._j2.g6(i)),this.g(i)}},f:function(t){if(this._j3.c2(t))return void this._jy.z1(t,new Us(this,t));var e=t.aw(),i=e.i9();e.i2(),this.f(i);var n=this._jy.i1(i),s=new Us(this,n._a,n._b,0);if(!e.i1())return s._a.ac(new Hs(this._j2.gj(t)/2,0)),s._b.ac(new Hs(this._j2.gj(t)/2,0)),void this._jy.z1(t,s);for(;e.i1();){i=e.i9(),e.i2(),this.f(i),n=this._jy.i1(i);for(var r=s._b.ah(),a=n._a.ah(),o=2147483647,h=0,l=0;r.i1()&&a.i1();){var c=r.i6();r.i2();var u=a.i6();a.i2(),l+=c._a,h+=u._a,o=Math.min(o,h-l-c._b-u._b)}n._c=this._jv-o,h+=n._c;var d=n._b.am();if(d._a=n._c,r.i1()&&!a.i1())for(var f=l-this.a3(n._b);r.i1();f=0){var g=r.i6();r.i2(),n._b.ae(new Hs(g._b,g._a+f))}else if(!r.i1()&&a.i1()){var _=this.a3(s._a);for(_=h-_;a.i1();_=0){var p=a.i6();a.i2(),s._a.ae(new Hs(p._b,p._a+_))}}s._b=n._b}this._jy.z1(t,s);for(var v=-n._c/2,m=t.aw();m.i1();){var y=m.i9();m.i2();var A=this._jy.i1(y);A._c+=v;var x=A._b.am();x._a+=v,x=A._a.am(),x._a+=v}s._a.ac(new Hs(this._j2.gj(t)/2,0)),s._b.ac(new Hs(this._j2.gj(t)/2,0))},a3:function(t){for(var e=0,i=t.ah();i.i1();i.i2()){var n=i.i6();e+=n._a}return e}});var Gs=function(t){this._b=t,this.a()};Be.ext(Gs,Object,{c1:function(){return null==this._a&&this.a(),this._a},b:function(){return null==this._a?-1:this.d(this._a)},d:function(t){for(var e=0,i=t.aw();i.i1();i.i2())e=Math.max(e,this.d(i.i9()));return e+1},c2:function(t){return 0===t.ao()},a:function(){for(var t=this._b.x9();t.i1();t.i2())if(0===t.i9().ak())return void(this._a=t.i9())}});var Zs=function(t){this._d=0,this._e=0,this._f=0,this._a=0,this._b=0,this._g=t,this._c=new vs};Be.ext(Zs,Object,{a:function(){return this._d+this._e+this._f}});var Ys=function(){Ys.superClass.constructor.call(this),this._kl=340,this._km=360,this._kk=40,this._ko=.5};Be.ext(Ys,Ws,{ic:function(){return this._km},ia:function(){return this._kl},i9:function(){return this._ko},i3:function(t){if(!cs.a1(t))throw"Error";this._a=t;var e=this.i8(),i=cs.a4(t,e);gr.c(t),this._kn=Rr.d(t.x0());for(var n=t.x9();n.i1();n.i2()){var s=n.i9();s!==e?this.aa(s,new Zs(this._kk+this.q(s.aq().i9()))):this.aa(s,new Zs(this._kk))}this.s(e),t.s2(e,0,0),this.t(e);for(var r;!i.ar();t.x3(r))r=i.c3()},i4:function(t){return cs.a1(t)},i0:function(t){return this._kn[t.al()]},i8:function(){return cs.a2(this._a)},i7:function(t){for(var e,i=this.ib(t);e=this.i6(t),!(i>=e);)for(var n=t.aw();n.i1();n.i2()){var s=n.i9();this.i0(s)._g*=1+this._ko}var r=(i-e)/(2*t.ao());e=0;for(var a=t.aw();a.i1();a.i2()){var o=this.i0(a.i9());o._d+=r,o._e+=r,e+=o._d+o._e}this.id(t)},id:function(t){for(var e=Rr.d(t.ao()),i=0,n=t.ap();n.i1();)e[i]=n.i8(),n.i2(),i++;var s=this;e.sort(function(t,e){var i=t.a3(),n=e.a3(),r=s.i0(i).a()-s.i0(n).a();return r>0?1:r>=0?0:-1});for(var r=0;r<e.length;r++)this._a.h1(e[r]);for(var a=0;a<e.length;a+=2)this._a.u1(e[a]);for(i=e.length-1,i%2===0&&i--;i>0;i-=2)this._a.u1(e[i])},ib:function(t){return 0===t.ak()?this._km:2===t.ao()?Math.min(180,this._kl):this._kl},i6:function(t){for(var e=0,i=t.ap();i.i1();i.i2()){for(var n,s=i.i8(),r=s.a3(),a=this.i0(r),o=-a._g,h=a._b,l=a._c,c=0,u=c+1,d=l._b,f=d.d();u>c;u=(n.y-h)/(n.x-o))n=f,d=l.ai(d),f=d.d(),c=(f.y-n.y)/(f.x-n.x);for(a._d=180*-Math.atan(u)/Math.PI,c=0,u=c-1,d=l._b,f=d.d();d.a().d().x===f.x;f=d.d())d=d.a();for(var g;c>u;u=(g.y-h)/(g.x-o))g=f,d=l.aj(d),f=d.d(),c=(f.y-g.y)/(f.x-g.x);a._e=180*Math.atan(u)/Math.PI,e+=a._d+a._e}return e},aa:function(t,e){this._kn[t.al()]=e},p:function(t){var e=this.i0(t),i=new vs,n=2*this.q(t);i.aa(new Gn(0,0)),i.aa(new Gn(0,n)),i.aa(new Gn(n,n)),i.aa(new Gn(n,0)),e._c=i,e._a=n/2,e._b=n/2},r:function(t){if(0===t.ao())this.p(t);else{var e=this.i0(t),i=this.q(t),n=new vs;n.aa(new Gn((-i),(-i))),n.aa(new Gn((-i),i)),n.aa(new Gn(i,(-i))),n.aa(new Gn(i,i));for(var s=t.aw();s.i1();s.i2()){var r=this.i0(s.i9());n.az(r._c)}for(var a=ar.h(n),o=Number.MAX_VALUE,h=Number.MAX_VALUE,l=Number.MIN_VALUE,c=Number.MIN_VALUE,u=a.ah();u.i1();u.i2()){var d=u.i6();d.x<o&&(o=d.x),d.x>l&&(l=d.x),d.y<h&&(h=d.y),d.y>c&&(c=d.y)}for(var f=new vs,g=a.ah();g.i1();g.i2()){var _=g.i6();f.aa(new Gn(_.x-o,_.y-h))}e._c=f,e._a=-o,e._b=-h}},s:function(t){if(0===t.ao())this.r(t);else{for(var e=t.aw();e.i1();e.i2())this.s(e.i9());this.i7(t);for(var i=0,n=t.aw();n.i1();n.i2()){var s=n.i9(),r=this.i0(s),a=180-(360-this.ib(t))/2-i-(r._e+r._f);i+=r.a(),a=a/180*Math.PI;for(var o=Math.sin(a),h=Math.cos(a),l=r._c._b;null!=l;l=l.a()){var c=l.d(),u=c.x+r._g,d=c.y-r._b,f=new Gn(u*h-o*d,u*o+h*d);l.c(f)}var g=r._a+r._g;r._a=g*h,r._b=g*o}this.r(t)}},t:function(t){var e=this._a.g4(t),i=0;if(t.ak()>0){var n=t.aq().i9(),s=this._a.g4(n);i=Math.PI+Math.atan2(s.y-e.y,s.x-e.x)}for(var r=t.aw();r.i1();r.i2()){var a=r.i9(),o=this.i0(a);if(0!==i){var h=Math.cos(i),l=Math.sin(i),c=o._a*h-l*o._b,u=o._a*l+h*o._b;o._a=c,o._b=u}this._a.s2(a,e.x+o._a,e.y+o._b),this.t(a)}},q:function(t){return 1.41*(Math.max(this._a.gj(t),this._a.g9(t))/2)}});var js=function(){};Be.ext(js,Object,{i2:function(t){return t.ad()},i1:function(t){throw"Error"},i3:function(t){throw"Error"},i4:function(t){throw"Error"}});var qs=function(t){this._a=t};Be.ext(qs,Object,{i2:function(t){for(var e=0,i=t.an();i.i1();i.i2())null!=this._a.i1(i.i9())&&e++;return e},i4:function(t){return null==this._a.i1(t)},i1:function(t){throw"Error"},i3:function(t){throw"Error"}});var Ks=function(){Ks.superClass.constructor.call(this),this._kq=!1,this._kp=90};Be.ext(Ks,Ys,{a:function(t,e){this._kr=e,this._ks=t,this._kq=!0},i7:function(t){if(!this.u(t))return void Ks.superClass.i7.call(this,t);for(var e=this.i9(),i=this.ib(t),n=(360-i)/2+i,s=new ms(t.ap());;){var r=this.i6(t);r=(360-i)/2;for(var a=null,o=null,h=s._b;null!=h;h=h.a()){
var l=h.d(),c=l.a3(),u=this.i0(c),d=this._ks.i3(l),f=d-(r+u._e);if(f>=0&&d+u._d>=n&&(f=r+u.a()<=n?n-r-u.a():2*(n-(d+u._d))),u._f=0,f>=0)u._f=f,a=h,o=u;else{for(-f>u._d+u._e?f=(u._d+u._e)/2:f/=-2,r-=f,n>=r&&r+u.a()>n&&(r+=f,f=r+u.a()-n,r-=f);null!=a&&f>o._f;o=this.i0(a.d().a3()))if(f-=o._f,o._f=0,a=a.b(),null==a){o=null;break}null!=a?o._f-=f:r+=f}r+=u.a()}if(n>=r){for(var g=0,_=(360-i)/2,p=t.ap();p.i1();p.i2()){var v=p.i8(),m=v.a3(),y=this._ks.i3(v),A=this.i0(m),x=_+A._f+A._e;g<Math.abs(x-y)&&(g=Math.abs(x-y)),_+=A.a()}if(g<=this._kp)break}for(var w=t.aw();w.i1();w.i2()){var b=w.i9();this.i0(b)._g*=1+e}}},ib:function(t){return this.u(t)?0===t.ak()?this.ic():this.ia():Ks.superClass.ib.call(this,t)},u:function(t){return!(!this._kq||0===t.ao())&&null!=this._ks.i1(t.ag())}});var Qs=function(t){this._a=t};Be.ext(Qs,Object,{i1:function(t){return this._a.i1(t)},i2:function(t){throw"Error"},i3:function(t){throw"Error"},i4:function(t){throw"Error"}});var Js=function(){};Be.ext(Js,Object,{w1:function(t){this._bb=t},w2:function(){return this._bb},w4:function(t){null!=this._bb&&this._bb.i2(t)},w3:function(t){return null==this._bb||this._bb.i1(t)}});var $s=function(){this._cg=45,this._ce=400,this._ch=400,this._cf=0};Be.ext($s,Js,{i1:function(t){if(null!=this.w2()){for(var e=!0,i=t.xk(),n=ns.a3(t,i),s=Rr.d(n),r=Rr.d(n),a=0;n>a;a++)s[a]=new Ns,r[a]=new ms;for(var o=t.xf();o.i1();o.i2()){var h=o.i8();r[i.i2(h.a2())].aa(h),t.h1(h)}for(var l=t.x9();l.i1();l.i2()){var c=l.i9();s[i.i2(c)].aa(c),t.h2(l.i9())}for(var u=0;n>u;u++){for(var d=s[u].x1();d.i1();d.i2())t.h3(d.i9());for(var f=r[u].c1();f.i1();f.i2())t.u1(f.i8());e=this.w3(t);for(var g=r[u].c1();g.i1();g.i2())t.h1(g.i8());for(var _=s[u].x1();_.i1();_.i2())t.h2(_.i9());if(!e)break}for(var p=0;n>p;p++)for(var v=s[p].x1();v.i1();v.i2())t.h3(v.i9());for(var m=0;n>m;m++)for(var y=r[m].c1();y.i1();y.i2())t.u1(y.i8());return t.xi(i),e}return!0},i2:function(t){if(!t.xb()){for(var e=t.xk(),i=ns.a3(t,e),n=Rr.d(i),s=Rr.d(i),r=Rr.d(i),a=Rr.d(i),o=0;i>o;o++)n[o]=new Ns,s[o]=new ms;for(var h=t.xf();h.i1();h.i2()){var l=h.i8();s[e.i2(l.a2())].aa(l),t.h1(l)}for(var c=t.x9();c.i1();c.i2()){var u=c.i9();n[e.i2(u)].aa(u),t.h2(c.i9())}for(var d=0;i>d;d++){for(var f=n[d].x1();f.i1();f.i2())t.h3(f.i9());for(var g=s[d].c1();g.i1();g.i2())t.u1(g.i8());this.w4(t);var _=t.g3();r[d]=new jn(_.x,_.y,_.width,_.height);var p={};if(a[d]=p,this._cf>0){var v=this._cg+Math.ceil((_.width+1)/this._cf)*this._cf,m=this._cg+Math.ceil((_.height+1)/this._cf)*this._cf;p.x=_.x,p.y=_.y,p.width=v,p.height=m}else p.x=_.x,p.y=_.y,p.width=_.width+this._cg,p.height=_.height+this._cg;for(var y=s[d].c1();y.i1();y.i2())t.h1(y.i8());for(var A=n[d].x1();A.i1();A.i2())t.h2(A.i9())}for(var x=0;i>x;x++)for(var w=n[x].x1();w.i1();w.i2())t.h3(w.i9());for(var b=0;i>b;b++)for(var S=s[b].c1();S.i1();S.i2())t.u1(S.i8());if(gr.a(a,null,this._ce/this._ch),this._cf<=0)for(var C=0;C<a.length;C++)this.w5(t,n[C],s[C],new Gn(a[C].x,a[C].y),r[C]);else for(var T=0;T<a.length;T++){var E=Math.floor((a[T].x-r[T].x)/this._cf)*this._cf,L=Math.floor((a[T].y-r[T].y)/this._cf)*this._cf,M=r[T].x+E,P=r[T].y+L;this.w5(t,n[T],s[T],new Gn(M,P),r[T])}t.xi(e)}},w5:function(t,e,i,n,s){for(var r=-s.x+n.x,a=-s.y+n.y,o=e.x1();o.i1();o.i2()){var h=t.ga(o.i9());t.s4(o.i9(),new Gn(h.x+r,h.y+a))}for(var l=i.c1();l.i1();l.i2()){for(var c=l.i8(),u=new gn,d=t.gp(c).c();d.i1();d.i2()){var f=d.i6();u.add(new Gn(f.x+r,f.y+a))}t.s5(c,new Kn(u))}}});var tr=function(){};Be.ext(tr,Js,{i1:function(t){return this.w3(t)},i2:function(t){this.w7(t),null!=this.w2()&&this.w4(t),this.w6(t)},w7:function(t){this.e(t),this.k(t),this.i(t)},e:function(t){for(var e=t.x9();e.i1();e.i2()){var i=t.g4(e.i9());t.s1(e.i9(),i)}},w6:function(t){this.l(t),this.j(t),this.f(t)},l:function(t){for(var e=t.x9();e.i1();e.i2()){var i=t.g4(e.i9());t.s1(e.i9(),i)}},j:function(t){for(var e=t.xf();e.i1();e.i2()){var i=t.g7(e.i8()),n=i.i6();i.i8(n),n=i.i7(),i.i9(n);for(var s=0;s<i.i1();s++){var r=i.i2(s);i.i3(s,r.x,r.y)}}},k:function(t){for(var e=t.xf();e.i1();e.i2()){var i=t.g7(e.i8()),n=i.i6();i.i8(n),n=i.i7(),i.i9(n);for(var s=0;s<i.i1();s++){var r=i.i2(s);i.i3(s,r.x,r.y)}}},f:function(t){null!=this._ca&&(t.x1("A",this._ca),this._ca=null,this._b6=null),null!=this._b8&&(t.x1("B",this._b8),this._b8=null,this._b9=null)},i:function(t){this._ca=t.xc("A"),null!=this._ca&&(this._b6=new Qs(this._ca),t.x1("A",this._b6)),this._b8=t.xc("B"),null!=this._b8&&(this._b9=new Qs(this._b8),t.x1("B",this._b9))}});var er=function(){this._a=new ms,this._c=10};Be.ext(er,Js,{i2:function(t){this._b=t.xl(),this.w9(t),this.w4(t),this.c(t),this.w8(t,this._b),t.xj(this._b)},i1:function(t){if(null==this.w2())return!0;this._b=t.xl(),this.w9(t);var e=this.w3(t);return this.c(t),t.xj(this._b),e},w8:function(t,e){for(var i=t.xf();i.i1();i.i2()){var n=i.i8();if(null!=e.i1(n)){var s=e.i1(n);gr.g(t,n,s,this._c)}}},w9:function(t){for(var e=t.xk(),i=t.x9();i.i1();i.i2()){for(var n=i.i9(),s=n.af();s.i1();s.i2()){var r=s.i8(),a=r.a1(n),o=e.i1(a);if(o!==r)if(null==o)e.z1(a,r);else{null==this._b.i1(o)&&this._b.i8(o,new ms);var h=this._b.i1(o);h.aa(r),this._a.ac(r),t.h1(r)}}for(var l=n.af();l.i1();l.i2()){var c=l.i8(),u=c.a1(n);e.z1(u,null)}}t.xi(e)},c:function(t){for(;!this._a.ar();t.u1(this._a.c3()));}});var ir=function(t){this._a=t};Be.ext(ir,Object,{i2:function(t){this._a.i3(t)},i1:function(t){return this._a.i4(t)}});var nr=function(){nr.superClass.constructor.call(this),this._jo=30,this._jp=new or,this._jt=5};Be.ext(nr,Ws,{i4:function(t){return!0},i3:function(t){this._ju=t,gr.c(t);for(var e=this._jp.i1(t),i=0,n=t.x9();n.i1();n.i2())i=Math.max(i,this.e(n.i9()));i<this._jt&&(i=this._jt),this.a(e,i)},a:function(t,e){var i=t.i7(),n=2*Math.PI/i,s=0,r=Rr.a(i);t.i4();for(var a=0;i>a;)r[a]=this.e(t.i9())+this._jo,s+=r[a],a++,t.i2();var o=s/i,h=s/(2*Math.PI);e>h&&(h=e),t.i4();for(var l=0,c=0;i>c;){var u=n/o*r[c];l+=u/2;var d=Math.cos(l)*h,f=Math.sin(l)*h;l+=u/2,this._ju.s2(t.i9(),d,f),c++,t.i2()}return h},e:function(t){var e=this._ju.gj(t),i=this._ju.g9(t);return i>=e?i:e}});var sr=function(){sr.superClass.constructor.call(this),this._jm=new nr,this._jk=new Ks};Be.ext(sr,Ws,{i4:function(t){return!0},i3:function(t){if(!(t.x0()<2)){this._jn=t,gr.c(this._jn),gr.e(this._jn);var e=new dr(this._jn);e.a1(),e.h();var i=new Os(this._jn);i.a();for(var n=e.x9();n.i1();n.i2()){var s=n.i9(),r=e.c2(s);if(r.ay()>1){var a=e.d1(s);Os.h(this._jn,a.c1()),this._jm.i3(this._jn);var o=this._jn.g3();e.s7(s,o.width,o.height)}else if(1===r.ay()){var h=r.x2();e.s8(s,this._jn.gm(h)),this._jn.s2(h,0,0)}else e.s7(s,1,1);Os.i(this._jn,this._jn.xf())}i.b();var l=this.a7(e);cs.a4(e,l);var c=e.xk(),u=e.xl();this.a2(e,u,c),this.a1(e,u),this.a3(e,l,u),this._jk.a(u,c),this._jk.i3(e),this.a5(e,l,c);for(var d=e.x9();d.i1();d.i2())for(var f=d.i9(),g=e.g4(f),_=e.c2(f).x1();_.i1();_.i2()){var p=_.i9();this._jn.s2(p,g.x+this._jn.g5(p),g.y+this._jn.g6(p))}}},a7:function(t){for(var e=-1,i=null,n=t.x9();n.i1();n.i2()){var s=n.i9();t.c2(s).ay()>e&&(i=s,e=t.c2(s).ay())}return i},a1:function(t,e){for(var i=function(t,i){var n=e.i3(t)-e.i3(i);return n>0?1:n>=0?0:-1},n=t.x9();n.i1();n.i2())n.i9().av(i)},a2:function(t,e,i){for(var n=Rr.a(this._jn.x0()),s=t.x9();s.i1();s.i2())for(var r=s.i9(),a=t.c2(r),o=a.x1();o.i1();o.i2()){var h=o.i9();n[h.al()]=r.al()}var l=cs.a2(t);this.a4(t,l,n,e,i)},a3:function(t,e,i){if(t.c2(e).ay()>1){for(var n=0,s=0,r=0,a=e.ap();a.i1();a.i2()){var o=a.i8(),h=i.i3(o);h-n>s&&(s=h-n,r=(n+h)/2),n=h}360-n>s&&(r=(360+n)/2),this.a6(t,e,r);for(var l=e.ap();l.i1();l.i2()){var c=l.i8(),u=i.i3(c);for(u-=r;0>u;u+=360);i.i6(c,u)}e.av(function(t,e){var n=i.i3(t)-i.i3(e);return n>0?1:n>=0?0:-1})}},a4:function(t,e,i,n,s){for(var r=e.al(),a=s.i3(e),o=e.ap();o.i1();o.i2()){for(var h=o.i8(),l=t.b(h),c=0,u=0,d=0,f=0,g=l.c1();g.i1();g.i2()){var _=g.i8(),p=null,v=null;i[_.a2().al()]===r?(p=_.a2(),v=_.a3()):(p=_.a3(),v=_.a2()),d-=this._jn.g5(p),f+=this._jn.g6(p),c-=this._jn.g5(v),u+=this._jn.g6(v)}if(0!==d||0!==f){var m;for(m=180*Math.atan2(f,d)/Math.PI-a;0>m;m+=360);n.i6(h,m)}if(0!==c&&0!==u){var y=180*Math.atan2(u,c)/Math.PI;0>y&&(y+=360),s.i6(h.a3(),y)}this.a4(t,h.a3(),i,n,s)}},a5:function(t,e,i){for(var n=t.g4(e),s=e.ap();s.i1();s.i2()){var r=s.i8(),a=r.a3(),o=t.g4(a),h=o.x-n.x,l=o.y-n.y,c=180*Math.atan2(l,h)/Math.PI;if(null!=i.i1(a)){var u=i.i3(a);c+=u}this.a6(t,a,c),this.a5(t,a,i)}},a6:function(t,e,i){i=i/180*Math.PI;var n=t.c2(e);if(!(n.ay()<=1))for(var s=n.x1();s.i1();s.i2()){var r=s.i9(),a=this._jn.g5(r),o=this._jn.g6(r),h=Math.cos(i),l=Math.sin(i),c=a*h-l*o,u=a*l+h*o;this._jn.s2(r,c,u)}}});var rr=function(){this._a=(new Date).getTime()};Be.ext(rr,Object,{b:function(){return(new Date).getTime()-this._a}});var ar={};ar._A=new Gn(0,0),ar.b=function(t,e,i){return ar.c(t.x,t.y,e.x,e.y,i.x,i.y)},ar.c=function(t,e,i,n,s,r){i-=t,n-=e,s-=t,r-=e;var a=s*n-r*i;return Math.abs(a)<1e-5?0:a>=0?0>=a?0:-1:1},ar.d=function(t,e,i){return ar.b(t,e,i)>0},ar.f=function(t,e,i){return ar.b(t,e,i)<0},ar.g=function(t,e,i){return 0===ar.b(t,e,i)},ar.h=function(t){return ar.i(t)},ar.i=function(t){var e=new vs(t.ah()),i=new vs;if(e.a2(),e.ar())return i;var n=e.at();for(i.ae(n);!e.ar()&&n.equals(e.am());e.at());if(e.ar())return i;n=e.at();for(var s=i.ae(n),r=e.ah();r.i1();r.i2()){var a=r.i6();if(!a.equals(n))if(n=a,2===i.ay()&&ar.g(i.am(),i.as(),a))s.c(a);else{var o;for(o=s;!ar.f(i.ai(o).d(),o.d(),a);o=i.ai(o));var h;for(h=s;!ar.d(i.aj(h).d(),h.d(),a);h=i.aj(h));for(;h!==i.aj(o);i.aw(i.aj(o)));s=i.an(a,o)}}return i},ar.j=function(){return ar.k(Number.MAX_VALUE)},ar.k=function(t){return Math.floor(De.Util.random()*t)},ar.l=function(t,e){return De.Util.random()*(e-t)+t};var or=function(){};Be.ext(or,Object,{i1:function(t){this._b=t;var e=new ms;e=ns.a6(t),e.az(ns.a7(t));for(var i=this.a1();!e.ar();t.x5(e.c3()));return i.x1()},a1:function(){if(this._b.x0()<3)return new Ns(this._b.x9());for(var t=this._b.xk(),e=this._b.xk(),i=this._b.xl(),n=new Fs(this._b,new js,0,this.a3(this._b)),s=this._b.x0(),r=new ms,a=new ms,o=new Os(this._b);s>3;s--){for(var h=n.g(),l=h.an();l.i1();l.i2())t.z1(l.i9(),s),e.i5(l.i9(),!1);for(var c=h.an();c.i1();c.i2())for(var u=c.i9(),d=u.ap();d.i1();d.i2()){var f=d.i8();t.i2(f.a3())===s&&(a.aa(f),e.i5(f.a2(),!0),e.i5(f.a3(),!0))}if(a.ay()<h.ad()-1){for(var g=null,_=h.an();_.i1();_.i2()){var p=_.i9();if(t.i2(p)===s&&!e.i4(p))if(null==g)g=p;else{var v=this._b.xo(g,p);i.i7(v,!0),a.aa(v),g=null}}if(null!=g)for(var m=h.an();m.i1();m.i2()){var y=m.i9();if(y!==g&&null==y.aj(g)){var A=this._b.xo(g,y);i.i7(A,!0),a.aa(A);break}}if(a.ay()<h.ad()-1){for(var x=2147483647,w=null,b=h.an();b.i1();b.i2()){var S=b.i9();S.ad()<x&&(w=S,x=S.ad())}for(var C=h.an();C.i1();C.i2()){var T=C.i9();if(null==w.aj(T)&&w!==T){var E=this._b.xo(w,T);if(i.i7(E,!0),a.aa(E),a.ay()>=h.ad()-1)break}}}}for(var L=h.an();L.i1();L.i2())n.b(L.i9());for(var M=a.c1();M.i1();M.i2()){var P=M.i8();i.i4(P)&&(n.d(P.a2()),n.d(P.a3()))}r.az(a),o.e(h)}o.b(),n.c();for(var k=r.c1();k.i1();k.i2()){var I=k.i8();null!=I._h&&(i.i4(I)?this._b.x5(I):this._b.h1(I))}var R=this.a4(this._b),D=new Ns,B=R.ak(0),N=R.ak(1),z=null;z=B.a2()===N.a2()||B.a2()===N.a3()?B.a3():B.a2(),D.aa(z);for(var O=R.c1();O.i1();O.i2()){var F=O.i8();z=F.a1(z),D.aa(z)}for(var V=r.c1();V.i1();V.i2()){var U=V.i8();i.i4(U)||null!=U._h||this._b.u1(U)}return this._b.xi(e),this._b.xj(i),this._b.xi(t),this.a2(D),D},a2:function(t){if(t.ay()<this._b.x0()){for(var e=this._b.xk(),i=t._b;null!=i;i=i.a()){var n=i.d();e.z1(n,i)}var s;for(s=new Fs(this._b,new qs(e),0,t.ay(),new qs(e));!s.e();){for(var r=s.f(),a=r.an();a.i1();a.i2()){var o=a.i9();if(null!=e.i1(o)){var h=e.i1(o),l=t.ai(h).d(),c=null;c=null!=r.aj(l)?t.ao(r,h):t.an(r,h),e.z1(r,c);break}}for(var u=r.an();u.i1();u.i2()){var d=u.i9();null==e.i1(d)&&s.d(d)}}this._b.xi(e),s.c()}},a3:function(t){for(var e=0,i=t.x9();i.i1();i.i2())e=Math.max(e,i.i9().ad());return e},a4:function(t){for(var e=[],i=0,n=t.x0();n>i;i++)e[i]=new hs;var s=new as(e);s.a6(!1),s.a8(t);for(var r=-1,a=null,o=t.x9();o.i1();o.i2()){var h=o.i9(),l=e[h.al()];l._a+l._c>r&&(r=l._a+l._c,a=h)}for(var c=new ms,u=a,d=e[u.al()]._d;null!=d;d=e[u.al()]._d)c.ac(d),u=d.a1(u);u=a;for(var f=e[u.al()]._b;null!=f;f=e[u.al()]._d)c.ae(f),u=f.a1(u);return c}});var hr=function(){this._v=new ys,this._x=new ys,this._z=new Ps(3,5),this._w=new Ps(3,5),this._y=!1,this._u=!1,this._t={}};Be.ext(hr,Object,{xm:function(){var t=new ks(this);return t},xo:function(t,e){return this.xn(t,null,e,null,0,0)},xn:function(t,e,i,n,s,r){return new Cs(this,t,e,i,n,s,r)},x4:function(t){this.b3(t)},b3:function(t){for(var e;null!=(e=t._o[0]);)this.x5(e);for(;null!=(e=t._o[1]);)this.x5(e);this._v.c(t),t._g=null,this._y=!0},x5:function(t){this.a11(t)},a11:function(t){if(t._h!==this)throw"Error";var e=t.a2(),i=t.a3();this.a12(t,e,i),this._x.c(t),t._h=null,this._u=!0},x7:function(t){t._p=this._v._c,t._g=this,t.ac(),t._c.length<this._z._b&&this._z.a3(t,t._c.length,this._z._b),this._v.a(t),this._y=!0},x8:function(t){if(null!=t._h)throw"Error";t._c.length<this._w._b&&this._w.a3(t,t._c.length,this._w._b),null==t._a||t._a._h!==this?this._x.a(t):this._x.b(t,t._a),t._h=this,t.a4(),this.b2(t,t.a2(),null,t.a3(),null,0,0),this._u=!0},xr:function(t,e,i){var n=t.a2(),s=t.a3();null==t._h?(t._d=e,t._e=i):(n!==e&&(n.ar(t,0,0),t._d=e,e.ab(t,null,0,0,0)),s!==i&&(s.ar(t,1,1),t._e=i,i.ab(t,null,1,1,0)))},x3:function(t){this.xr(t,t.a3(),t.a2())},h1:function(t){this.a11(t)},u1:function(t){this.x8(t)},h2:function(t){this.x4(t)},h3:function(t){this.x7(t)},xa:function(){return this._v._c},x0:function(){return this._v._c},xh:function(){return this._x._c},xg:function(){return this._x._c},xb:function(){return 0===this._v._c},xq:function(t){return t._g===this},xp:function(t){return t._h===this},xd:function(){return this._v._a},x9:function(){return new Bs(this._v)},xf:function(){return new Bs(this._x)},x2:function(t,e){var i=Rr.d(this.xh());if(null!=t&&null!=e)for(var n=this.x9();n.i1();n.i2())n.i9().at(t,1,i),n.i9().at(e,0,i);else if(null==e&&null!=t)for(var s=this.x9();s.i1();s.i2())s.i9().at(t,1,i);else if(null!=e&&null==t)for(var r=this.x9();r.i1();r.i2())r.i9().at(e,0,i)},xk:function(){return this._z.b(this._v)},xl:function(){return this._w.c(this._x)},xi:function(t){this._z.a5(t,this._v)},xj:function(t){this._w.a6(t,this._x)},xc:function(t){return this._t[t]},x1:function(t,e){this._t[t]=e},x6:function(t){delete this._t[t]},b2:function(t,e,i,n,s,r,a){e.ab(t,i,0,0,r),n.ab(t,s,1,1,a)},a12:function(t,e,i){e.ar(t,0,0),i.ar(t,1,1)},c:function(){for(var t=0,e=this.x9();e.i1();e.i2())e.i9()._p=t++;this._y=!1},b1:function(){for(var t=0,e=this.xf();e.i1();e.i2())e.i8()._g=t++;this._u=!1},xs:function(t){t.as(this,this._z._b),t._p=this._v._c,this._v.a(t)},xt:function(t,e,i,n,s,r,a){t.a6(this,e,n,this._w._b),t._g=this._x._c,this._x.a(t),this.b2(t,t.a2(),i,t.a3(),s,r,a)}});var lr=function(){lr.superClass.constructor.call(this)};Be.ext(lr,hr,{gb:function(t){return this.g1(t)},g7:function(t){return this.g2(t)},g5:function(t){var e=this.g1(t);return e.i1()+e.i3()/2},g6:function(t){var e=this.g1(t);return e.i2()+e.i4()/2},g4:function(t){return new Gn(this.g5(t),this.g6(t))},gi:function(t){return this.g1(t).i1()},gh:function(t){return this.g1(t).i2()},ga:function(t){var e=this.g1(t);return new Gn(e.i1(),e.i2())},gj:function(t){return this.g1(t).i3()},g9:function(t){return this.g1(t).i4()},gm:function(t){return new Zn(this.gj(t),this.g9(t))},s1:function(t,e){this.s2(t,e.x,e.y)},s2:function(t,e,i){var n=this.g1(t);n.i5(e-n.i3()/2,i-n.i4()/2)},s7:function(t,e,i){this.g1(t).i6(e,i)},s8:function(t,e){this.s7(t,e.width,e.height)},s3:function(t,e,i){this.g1(t).i5(e,i)},s4:function(t,e){this.s3(t,e.x,e.y)},gp:function(t){for(var e=this.g2(t),i=new gn,n=0;n<e.i1();n++)i.add(e.i2(n));return new Kn(i)},gf:function(t){for(var e=this.g2(t),i=new vs,n=0;n<e.i1();n++)i.aa(e.i2(n));return i},gc:function(t){var e=new gn;e.add(this.gs(t));for(var i=this.gp(t).d();i.i1();i.i2())e.add(i.i6());return e.add(this.gl(t)),new Kn(e)},gd:function(t){var e=new vs;e.aa(this.gs(t));for(var i=this.gp(t).d();i.i1();i.i2())e.aa(i.i6());return e.aa(this.gl(t)),e},m1:function(t,e){var i=this.g2(t);i.i5();var n=e.ah(),s=n.i6();this.gx(t,s);var r=e.as();for(n.i2();n.i6()!==r;n.i2()){var a=n.i6();i.i4(a.x,a.y)}this.gy(t,r)},s5:function(t,e){var i=this.g2(t);i.i5();for(var n=e.d();n.i1();n.i2()){var s=n.i6();i.i4(s.x,s.y)}},s6:function(t,e){var i=this.g2(t);i.i5();for(var n=e.ah();n.i1();n.i2()){var s=n.i6();i.i4(s.x,s.y)}},m2:function(t,e,i){this.gx(t,e),this.gy(t,i)},gn:function(t){return this.g2(t).i6()},gk:function(t){return this.g2(t).i7()},gt:function(t,e){this.g2(t).i8(e)},gz:function(t,e){this.g2(t).i9(e)},gs:function(t){var e=this.g2(t).i6();if(null==e)return this.g4(t.a2());var i=new Gn(this.g5(t.a2())+e.x,this.g6(t.a2())+e.y);return i},gl:function(t){var e=this.g2(t).i7();if(null==e)return this.g4(t.a3());var i=new Gn(this.g5(t.a3())+e.x,this.g6(t.a3())+e.y);return i},gx:function(t,e){var i=new Gn(e.x-this.g5(t.a2()),e.y-this.g6(t.a2()));this.g2(t).i8(i)},gy:function(t,e){var i=new Gn(e.x-this.g5(t.a3()),e.y-this.g6(t.a3()));this.g2(t).i9(i)},g8:function(){for(var t=new ms,e=this.xf();e.i1();e.i2())t.aa(e.i8());return t},g3:function(){for(var t,e,i=t=Number.MAX_VALUE,n=e=Number.MIN_VALUE,s=this.x9();s.i1();s.i2()){var r=this.ga(s.i9()),a=this.gm(s.i9());i=Math.min(r.x,i),t=Math.min(r.y,t),n=Math.max(r.x+a.width,n),e=Math.max(r.y+a.height,e)}for(var o=this.xf();o.i1();o.i2())for(var h=this.gp(o.i8()).c();h.i1();h.i2()){var l=h.i6();i=Math.min(l.x,i),t=Math.min(l.y,t),n=Math.max(l.x,n),e=Math.max(l.y,e)}return{x:Math.floor(i),y:Math.floor(t),width:Math.floor(n-i),height:Math.floor(e-t)}}});var cr=function(){cr.superClass.constructor.call(this),this.a(new is,new ts)};Be.ext(cr,lr,{a:function(t,e){this._a3=t,this._a4=e},xo:function(t,e){return this.l2(t,e,this._a4.a6())},l2:function(t,e,i){return this.l1(t,null,e,null,0,0,i)},xn:function(t,e,i,n,s,r){return this.l1(t,e,i,n,s,r,this._a4.a6())},l1:function(t,e,i,n,s,r,a){var o=new Cs(this,t,e,i,n,s,r);return o._l=a,o},xm:function(){var t=new ks(this);return t._r=this._a3.m3(),t},g3:function(){for(var t={x:0,y:0,width:-1,height:-1},e=this.x9();e.i1();e.i2())e.i9()._r.m1(t);return t},g1:function(t){return t._r},g2:function(t){return t._l},g5:function(t){return t._r.m4()},g6:function(t){return t._r.m5()},gi:function(t){return t._r.i1()},gh:function(t){return t._r.i2()},gj:function(t){return t._r.i3()},g9:function(t){return t._r.i4()},s2:function(t,e,i){t._r.m6(e,i)},s7:function(t,e,i){t._r.i6(e,i)},s3:function(t,e,i){t._r.i5(e,i)}});var ur=function(){ur.superClass.constructor.call(this),this._ap=this.xk(),this._as=this.xl()};Be.ext(ur,lr,{g1:function(t){var e=this._ap.i1(t);return null==e&&(e=new Ls,this._ap.z1(t,e)),e},g2:function(t){var e=this._as.i1(t);return null==e&&(e=new Es,this._as.i8(t,e)),e}});var dr=function(t){dr.superClass.constructor.call(this),this._ay=t,this._a0=this.xk(),this._au=this.xl()};Be.ext(dr,ur,{c2:function(t){var e=this._a0.i1(t);return e},a2:function(t,e){this._a0.z1(t,e)},h:function(){null==this._az&&(this._az=this.xk());for(var t=Rr.a(this._ay.x0()+1),e=1,i=this.x9();i.i1();){for(var n=this.c2(i.i9()),s=n.x1();s.i1();s.i2()){var r=s.i9();t[r.al()]=e}for(var a=new ms,o=n.x1();o.i1();o.i2())for(var h=o.i9(),l=t[h.al()],c=h.ap();c.i1();c.i2()){var u=c.i8(),d=u.a3(),f=t[d.al()];f===l&&a.ac(u)}this._az.z1(i.i9(),a),i.i2(),e++}},d1:function(t){return this._az.i1(t)},b:function(t){return this._au.i1(t)},a3:function(t,e){this._au.i8(t,e)},a1:function(){var t=this._ay.xk(),e=Vs.a4(Rr.a(this._ay.xh())),i=ns.a1(this._ay,e,t),n=ns.a5(this._ay,e,i);this.d2(t,n),this._ay.xi(t)},c1:function(t){for(var e=null,i=-1,n=0,s=t.length;s>n;n++){var r=t[n];r.ay()>i&&(e=r,i=r.ay())}return e},d2:function(t,e){for(var i=this._ay.xl(),n=this._ay.xk(),s=e.length,r=0;s>r;r++)for(var a=e[r],o=a.c1();o.i1();o.i2())i.i8(o.i8(),a);var h=this.c1(e);this.a4(h,t,i,new gn,n);var l={};s=e.length;for(var c=0;s>c;c++){var u=e[c];if(u.ay()>1){var d=this.xm();l[u._id]=d}}for(var f=this._ay.x9();f.i1();f.i2()){var g=f.i9();if(t.i4(g)&&null==n.i1(g)){var _=this.xm();l[g._id]=_;var p=new Ns;p.aa(g),this.a2(_,p)}}var v=Rr.d(2);s=e.length;for(var m=0;s>m;m++){var y=e[m];if(1===y.ay()){var A=y.c2();v[0]=A.a2(),v[1]=A.a3();for(var x=0;2>x;x++){var w=v[x];if(1===w.ad()){var b=this.xm();l[w._id]=b;var S=new Ns;S.aa(w),this.a2(b,S)}}}}for(var C=this._ay.x9();C.i1();C.i2()){var T=C.i9();if(null!=n.i1(T))for(var E=n.i1(T),L=l[E._id],M=T.af();M.i1();M.i2()){var P=M.i8();if(i.i1(P)!==E){var k=l[i.i1(P)._id];if(null==k){var I=P.a1(T),R=n.i1(I);k=null!=R?l[R._id]:l[I._id]}var D=L.aj(k),B=null;null==D?(D=this.xo(L,k),B=new ms):B=this.b(D),B.aa(P),this.a3(D,B)}}else if(t.i4(T))for(var N=l[T._id],z=T.af();z.i1();z.i2()){var O=z.i8(),F=O.a1(T),V=l[F._id];if(null!=V){var U=N.aj(V);if(null==U){var H=this.xo(N,V),W=new ms;W.aa(O),this.a3(H,W)}}}}if(2===this._ay.x0()&&1===this._ay.xg()){var X=this._ay.xf().i8(),G=l[X.a2()._id],Z=l[X.a3()._id];if(null!=Z&&null!=G&&null==Z.aj(G)){var Y=this.xo(G,Z),j=new ms;j.aa(X),this.a3(Y,j)}}var q=Rr.a(this._ay.x0()),K=1;s=e.length;for(var Q=0;s>Q;Q++){var J=e[Q],$=l[J._id];if(null!=$){var tt=this.c2($);null==tt&&(tt=new Ns,this.a2($,tt));for(var et=J.c1();et.i1();et.i2()){var it=et.i8(),nt=it.a2();q[nt.al()]===K||t.i4(nt)&&n.i1(nt)!==J||(q[nt.al()]=K,tt.aa(nt)),nt=it.a3(),q[nt.al()]===K||t.i4(nt)&&n.i1(nt)!==J||(q[nt.al()]=K,tt.aa(nt))}}}this._ay.xj(i),this._ay.xi(n)},a4:function(t,e,i,n,s){if(!n.contains(t)){n.add(t);for(var r=[],a=t.c1();a.i1();a.i2()){var o=a.i8();r[0]=o.a2(),r[1]=o.a3();for(var h=0;2>h;h++){var l=r[h];if(e.i4(l)&&null==s.i1(l)){t.ay()>1&&s.z1(l,t);for(var c=l.af();c.i1();c.i2()){var u=i.i1(c.i8());this.a4(u,e,i,n,s)}}}}}}});var fr=function(t,e,i,n,s){this._a={},fr.superClass.constructor.call(this);var r,a,o=new gn;for(r=0,a=e.size();a>r;r++){var h=e.get(r);if(h instanceof De.Link)o.add(h);else{var l=n&&null==s&&h instanceof Vn;l&&h.setExpanded(!0);var c=t.getDimension(h);if(l&&h.setExpanded(!1),null==c)continue;var u=this.xm(),d=t._repulsion;"rightleft"===i||"leftright"===i?this.s7(u,c.height*d,c.width*d):this.s7(u,c.width*d,c.height*d),u.node=h,this._a[h.getId()]=u}}for(r=0,a=o.size();a>r;r++){var f=o.get(r),g=f.getFromAgent(),_=f.getToAgent(),p=this._a[g.getId()],v=this._a[_.getId()];null!=p&&null!=v&&p!==v&&this.xo(p,v)}};Be.ext(fr,cr,{});var gr={};gr._D=new Kn,gr._E=new Gn(0,0),gr.b=function(t){if(t.i1()>0){for(var e=new gn,i=t.i1()-1;i>=0;i--)e.add(t.i2(i));t.i5();for(var n=0,s=e.size();s>n;n++){var r=e.get(n);t.i4(r.x,r.y)}}var a=t.i6();t.i8(t.i7()),t.i9(a)},gr.c=function(t){gr.d(t,!0)},gr.d=function(t,e){if(e)for(var i=t.xf();i.i1();i.i2()){var n=i.i8();t.gt(n,gr._E),t.gz(n,gr._E),t.s5(n,gr._D)}else for(var s=t.xf();s.i1();s.i2())t.s5(s.i8(),gr._D)},gr.e=function(t){for(var e=new Gn(0,0),i=t.xf();i.i1();i.i2()){var n=i.i8();t.gt(n,e),t.gz(n,e)}},gr.f=function(t,e,i,n){for(var s=t.gc(e).b(),r=Rr.d(s),a=0,o=t.gc(e).c();o.i1();o.i2()){var h=o.i6();(0>=a||!h.equals(r[a-1]))&&(r[a]=new Gn(h.x,h.y),a++)}if(s=a,!(2>s)){var l=new gn,c=new Yn(r[1].x-r[0].x,r[1].y-r[0].y),u=gr.i(c);u.x*=n,u.y*=n;for(var d=gr.h(r[0],u),f=gr.h(r[1],u),g=new qn(d,f),_=1;s-1>_;_++){var p=g,v=gr.i(new Yn(r[_+1].x-r[_].x,r[_+1].y-r[_].y));v.x*=n,v.y*=n;var m=gr.h(r[_],v),y=gr.h(r[_+1],v);g=new qn(m,y);var A=qn.a6(p,g);null!=A&&l.add(new Gn(A.x,A.y))}var x=new Yn(r[s-1].x-r[s-2].x,r[s-1].y-r[s-2].y);x=gr.i(x),x.x*=n,x.y*=n;var w=gr.h(r[s-1],x),b=new Kn(l);e.a2()===i.a2()?(t.s5(i,b),t.m2(i,d,w)):(t.s5(i,b.a()),t.m2(i,w,d))}},gr.g=function(t,e,i,n){for(var s=n,r=i.c1();r.i1();r.i2()){var a=r.i8();gr.f(t,e,a,s),0>s&&(s-=n),s=-s}},gr.a=function(t,e,i){return gr.j(t,e,i,1)},gr.l=function(t,e,i){if(null==t||t.length<1)return null!=e&&(e.x=0,e.y=0,e.width=0,e.height=0),{width:0,height:0};for(var n=0,s=0,r=0;r<t.length;r++){var a=t[r];n=Math.max(n,a.width),s=Math.max(s,a.height)}var o,h,l=n*s*t.length,c=Math.sqrt(l/i),u=l/c,d=Math.floor(u/n),f=Math.ceil(u/n),g=Math.ceil(t.length/d),_=Math.ceil(t.length/f);f*_>d*g?(o=d,h=g):(o=f,h=_);var p,v=0,m=0,y=0,A=0;if(n>s)for(var x=0;x<t.length;x++)p=t[x],p.x=m*n,p.y=v*s,y=Math.max(y,p.x+p.width),A=Math.max(A,p.y+p.height),++m>=o&&(v++,m=0);else for(var w=0;w<t.length;w++)p=t[w],p.x=m*n,p.y=v*s,y=Math.max(y,p.x+p.width),A=Math.max(A,p.y+p.height),++v>=h&&(m++,v=0);return null!=e&&(e.x=0,e.y=0,e.width=y,e.height=A),{width:h,height:o}},gr.j=function(t,e,i,n){if(null==t||t.length<1)return null!=e&&(e.x=0,e.y=0,e.width=0,e.height=0),0;for(var s,r,a=s=t[0].width,o=r=t[0].height,h=t.length,l=1;h>l;l++){var c=t[l].width;a=Math.min(a,c),s=Math.max(s,c);var u=t[l].height;o=Math.min(o,u),r=Math.max(r,u)}if(o/r>.95&&a/s>.95)return gr.l(t,e,i).width;for(var d=new vs,f=0,g=0;h>g;g++){var _=t[g];d.aa(t[g]),f=Math.floor(f+_.width*_.height)}d.a1(function(t,e){var i=Math.floor(e.height)-Math.floor(t.height);return 0===i?Math.floor(e.width)-Math.floor(t.width):i});var p=0,v=0,m=Math.floor(i*Math.sqrt(f/i)),y=m,A=0,x=new vs;do{var w=new vs;x.aa(w);for(var b,S,C=b=S=0,T=d.ah();T.i1();T.i2()){var E=T.i6();C+E.width>y&&w.ay()>0?(S=Math.max(S,C),w=new vs,w.aa(E),x.aa(w),C=Math.floor(E.width)):(w.aa(E),C=Math.floor(C+E.width)),1===w.ay()&&(b=Math.floor(b+w.am().height))}S=Math.max(S,C),i*b>S&&A!==S&&(x.af(),y=Math.floor(1.1*y),A=S)}while(x.ar());for(var L=0,M=x.ah();M.i1();M.i2()){for(var P=0,k=M.i6(),I=k.ah();I.i1();I.i2()){var R=I.i6();R.x=P,R.y=L,P+=R.width}p=Math.max(p,P),L+=gr.k(k),v=Math.max(v,L)}return null!=e&&(e.x=0,e.y=0,e.width=p,e.height=v),x.ay()},gr.k=function(t){for(var e=0,i=t.ah();i.i1();i.i2())e=Math.max(i.i6().height,e);return e},gr.h=function(t,e){return new Gn(t.x+e.x,t.y+e.y)},gr.i=function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y);return new Yn(-t.y/e,t.x/e)};var _r=function(t){this._a=t,this._b=!1};Be.ext(_r,Object,{a:function(){return this._b},b:function(){return this._a},c:function(){return 1===this._a},d:function(){return 2===this._a},e:function(){return 4===this._a},f:function(){return 8===this._a},g:function(){return 0===this._a}}),_r.h=function(t,e){var i=t.xc("A");return null==i?null:i.i1(e)},_r.i=function(t,e){var i=t.xc("B");return null==i?null:i.i1(e)},_r.j=function(t){switch(t){case 1:return _r.k;case 2:return _r.l}return null},_r.k=new _r(1),_r.l=new _r(2);var pr=function(t,e,i,n,s){this._o=0,this._l=0,this._i=0,this._d=0,this._f=0,this._b=t,this._a=1e-4,this._r=e,this._p=1,this._e=(s.gj(t)+s.g9(t))/4;var r=.45*i*Math.sqrt(n);this._k=ar.l(-r,r),this._h=ar.l(-r,r),this._g=ar.l(-r,r)};Be.ext(pr,Object,{});var vr=function(){this._a=0,this._c=0,this._b=0};Be.ext(vr,Object,{});var mr=function(){mr.superClass.constructor.call(this),this._dj=0,this._dh=0,this._dq=0,this._dp=0,this._dt=0,this._de=0,this._d3=0,this._dr=0,this._ed=0,this._dw=.65,this._ea=1,this._dl=80,this._dx=3,this._d8=!0,this._eb=3e5,this._ee=2,this._di=2,this._df=1e3};Be.ext(mr,Ws,{i4:function(t){return!0},i3:function(t){if(null!=t&&(this._d5=t,this.s(t))){var e=new vr,i=0,n=Math.floor(this._dx*this._dz.length*this._dz.length+20*this._dz.length);n=Math.max(n,1e4);var s=this._ea*this._ea*this._dz.length,r=this._df;try{for(;this._dj>s&&n>i;i++){var a=this.b(2147483647&i);0===r--&&(this._dy.b()>this._eb&&(i=n),r=this._df),this.h(a,e),this.d(a,e),this.i(a,e),this._d8?(this.g(a,e),this.j(a,e)):(this.f(a,e),this.c(a,e));var o=Math.sqrt(e._a*e._a+e._c*e._c+e._b*e._b);this.ac(a,e,o),this.aa(a,e,o)}}catch(h){}finally{this.r()}}},s:function(t){if(null==t||t.xa()<1)return!1;this._d5=t,this._dp=1,this._dy=new rr,this._dt=t.x0(),this._d2=Rr.d(this._dt),this._df=1+1e5/this._dt,this._ed=1/(2*this._di),this._de=this._ed*this._ee/(.05*this._dl),this._d3=Math.pow(this._dl,-1)*this._ed,this._dr=Math.pow(this._dl,3)*this._ed,this._dj=0,this._du=new vr,this._dq=Math.max(20*this._dl,10);var e=Math.max(.1,Math.min(this._dw*this._dl,this._dq)),i=this._dt;gr.c(t),this._dz=Rr.d(i);for(var n=t.x9();n.i1();n.i2()){var s=n.i9(),r=new pr(s,e,this._dl,this._dt,t);this._dz[--i]=r,this._dj+=r._r,this._dh+=r._r*r._r,this._du._a+=r._k,this._du._c+=r._h,this._du._b+=r._g,this._d2[s.al()]=r}return this._d8=!1,this._dz.length>0},b:function(t){var e=this._dz.length,i=e-t%e-1,n=ar.k(i+1),s=this._dz[n];return this._dz[n]=this._dz[i],this._dz[i]=s,s},f:function(t,e){for(var i,n,s=i=n=0,r=t._b.ae();null!=r;r=r.a7()){var a,o=this._d2[r.a2().al()],h=o._k-t._k,l=o._h-t._h,c=o._g-t._g,u=h*h+l*l+c*c,d=Math.sqrt(u),f=d-(o._e+t._e);0>=f||(a=f*f*this._d3/d,s+=h*a,i+=l*a,n+=c*a)}for(var g=t._b.ag();null!=g;g=g.a8()){var _,p=this._d2[g.a3().al()],v=p._k-t._k,m=p._h-t._h,y=p._g-t._g,A=v*v+m*m+y*y,x=Math.sqrt(A),w=x-(p._e+t._e);0>=w||(_=w*w*this._d3/x,s+=v*_,i+=m*_,n+=y*_)}e._a+=s,e._c+=i,e._b+=n},g:function(t,e){var i,n,s=i=n=0;this._dp++,t._f=this._dp;for(var r=t._b.ae();null!=r;r=r.a7()){var a=this._d2[r.a2().al()];a._f=this._dp;var o=a._k-t._k,h=a._h-t._h,l=a._g-t._g,c=o*o+h*h+l*l,u=Math.sqrt(c);if(0!==u){var d=Math.max(1e-6,u-(t._e+a._e)),f=-this._ef[r.a5()]/(d*d);f+=d*d*this._d1[r.a5()],f/=u,s+=o*f,i+=h*f,n+=l*f}}for(var g=t._b.ag();null!=g;g=g.a8()){var _=this._d2[g.a3().al()];_._f=this._dp;var p=_._k-t._k,v=_._h-t._h,m=_._g-t._g,y=p*p+v*v+m*m,A=Math.sqrt(y);if(0!==A){var x=Math.max(1e-6,A-(t._e+_._e)),w=-this._ef[g.a5()]/(x*x);w+=x*x*this._d1[g.a5()],w/=A,s+=p*w,i+=v*w,n+=m*w}}e._a+=s,e._c+=i,e._b+=n},j:function(t,e){for(var i,n,s=i=n=0,r=this._dt-1;r>=0;r--){var a=this._d2[r];if(a._f!==t._f){var o=t._k-a._k,h=t._h-a._h,l=t._g-a._g,c=o*o+h*h+l*l;if(0!==c){var u=Math.sqrt(c),d=Math.max(1e-6,u-(t._e+a._e)),f=this._dr/(d*d*u);s+=o*f,i+=h*f,n+=l*f}}}e._a+=s,e._c+=i,e._b+=n},c:function(t,e){for(var i,n,s=i=n=0,r=this._dt-1;r>=0;r--){var a=this._d2[r],o=t._k-a._k,h=t._h-a._h,l=t._g-a._g,c=o*o+h*h+l*l;if(0!==c){var u,d=Math.sqrt(c),f=d-(t._e+a._e);u=0>=f?this._dr/(1e-8*d):this._dr/(f*f*d),s+=o*u,i+=h*u,n+=l*u}}e._a+=s,e._c+=i,e._b+=n},i:function(t,e){var i=this._du._b/this._dt-t._g;e._b+=i*this._dl*this._dt/this._dh},d:function(t,e){if(0!==this._de){var i=this._du._a/this._dt-t._k,n=this._du._c/this._dt-t._h,s=this._du._b/this._dt-t._g;e._a+=i*this._de,e._c+=n*this._de,e._b+=s*this._de}},h:function(t,e){var i=.05*(t._r+2);i>0&&(e._a=ar.l(-i,i),e._c=ar.l(-i,i),e._b=ar.l(-i,i))},ac:function(t,e,i){if(0!==i&&0!==t._a){var n=e._a*t._o+e._c*t._l+e._b*t._i,s=n/(i*t._a);this._dh-=t._r*t._r,this._dj-=t._r,t._r+=t._p*s>0?.45*s:.15*s,t._r>this._dq?t._r=this._dq:t._r<.1&&(t._r=.1),this._dj+=t._r,this._dh+=t._r*t._r,t._p=s}},aa:function(t,e,i){if(i>0){var n=t._r/i,s=e._a*n,r=e._c*n,a=e._b*n;t._k+=s,t._h+=r,t._g+=a,this._du._a+=s,this._du._c+=r,this._du._b+=a,t._a=i,t._o=e._a,t._l=e._c,t._i=e._b}},r:function(){for(var t=this._d2.length-1;t>=0;t--){var e=this._d2[t];this._d5.s2(e._b,e._k,e._h)}}});var yr=function(t,e,i,n){this._e=t,this._f=e,this._a=i,this._b=n,this._c={}};Be.ext(yr,Object,{resetGroup:function(){if(this._a&&null==this._b)for(var t in this._c){var e=this._c[t];e.group.setExpanded(!!this._e.isExpandGroup()||e.b)}},process:function(){for(var t=new gn,e=0,i=this._f.size();i>e;e++){var n=this._f.get(e);if(n instanceof De.Link)n.isLooped()||t.add(n);else{if(null==this._b&&n.getParent()instanceof Vn)continue;(null==this._b||null!=this._b&&this._b!==n)&&t.add(n),null==this._b&&n instanceof Vn&&this.layoutGroup(n)}}return t},layoutGroup:function(t){if(this._a&&null==this._c[t.getId()]&&null==this._b){this._c[t.getId()]={group:t,b:t.isExpanded()};var e=this._e.getGroupLayoutType(t);if(e){t.setExpanded(!0);for(var i,n=new gn,s=t.getChildren(),r=0,a=s.size();a>r;r++)if(i=s.get(r),i instanceof Vn&&(this.layoutGroup(i),i.setExpanded(!1)),i instanceof De.Link||n.contains(i)||n.add(i),i instanceof On){var o=i.getLinks();if(null!=o)for(var h=0,l=o.size();l>h;h++){var c=o.get(h);n.contains(c)||n.add(c)}}var u=new fr(this._e,n,e,this._a,this._b);try{var d=null;if("round"===e?d=new sr:"symmetry"===e?d=new mr:"hierarchic"===e?d=new Lr:("topbottom"===e||"bottomtop"===e||"rightleft"===e||"leftright"===e)&&(d=new Xs),null!=d){d.i2(u);var f=yr.createMatrix(e),g={},_={};for(var p in u._a){var v=u._a[p],m=v.node,y=u.g4(v);
if(g[p]=m.getCenterLocation(),null!=f){var A=f.transform(y);m.setCenterLocation(A.x,A.y)}else m.setCenterLocation(y.x,y.y);_[p]=m.getCenterLocation()}}}catch(x){}for(s=t.getChildren(),r=0,a=s.size();a>r;r++)i=s.get(r),i instanceof Vn&&i.setExpanded(!0)}}}}),yr.createMatrix=function(t){return"rightleft"===t?Ge.createMatrix(Math.PI/2,0,0):"leftright"===t?Ge.createMatrix(-Math.PI/2,0,0):"bottomtop"===t?Ge.createMatrix(Math.PI,0,0):null};var Ar=function(){};Be.ext(Ar,Object,{i1:function(t,e,i){var n=this.a1(t,e);return this.a2(t,e,i),n},a1:function(t,e){var i=Ar.i4(t);i.ax();for(var n=0,s=i.x1();s.i1();s.i2())e.i7(s.i9(),-1);for(var r=i.x1();r.i1();r.i2()){for(var a=r.i9(),o=-1,h=a.aq();h.i1();h.i2())o=Math.max(o,e.i2(h.i9()));e.i7(a,o+1),n=Math.max(n,o+1)}return n+1},a2:function(t,e,i){i.az(Ar.i3(t,e))}}),Ar.i3=function(t,e){for(var i=new ms,n=t.xf();n.i1();n.i2()){var s=n.i8();e.i2(s.a2())>e.i2(s.a3())&&(t.x3(s),i.ac(s))}return i},Ar.i4=function(t){var e=Rr.a(t.xa());return(new ls).a1(t,e),Ar.i2(t,e)},Ar.i2=function(t,e){for(var i=Rr.d(t.x0()),n=t.x9();n.i1();n.i2()){var s=n.i9(),r=s.al();i[e[r]]=s}return new Ns(i)};var xr=function(){xr.superClass.constructor.call(this),this.c0()};Be.ext(xr,ms,{c0:function(){this._bc=1,this._bd=0}});var wr=function(){this._m1=20,this._m2=60,this._m3=5,this._m4=0};Be.ext(wr,Object,{i4:function(t){this._m3=t},i5:function(t){this._m4=t},i3:function(t){this._m1=t},i6:function(t){this._m2=t},i2:function(t){this._m5=t},t1:function(){return this._m2},a1:function(t,e){for(var i=Rr.d(e.length),n=0;n<e.length;n++)i[n]=e[n].x1();this.a2(t,i)},a2:function(t,e){for(var i=Rr.a(e.length),n=0,s=0;s<e.length;s++){var r=0,a=e[s];for(a.i4();a.i1();a.i2())r=Math.max(r,t.g9(a.i9()));for(i[s]=r,a.i4();a.i1();a.i2()){var o=(i[s]-t.g9(a.i9()))/2;t.s4(a.i9(),new Gn(t.gi(a.i9()),n+o))}var h=this.t1();n+=i[s]+h,a.i4()}},i1:function(t,e,i){this._m6=t,this.t2(e,i)}});var br=function(t,e){br.superClass.constructor.call(this)};Be.ext(br,wr,{t2:function(t,e){var i=this._m6;this._a=i.xc("D"),this._h=i.xc("C"),this.a1(i,t),this.tg(i,t),this.tf(t,Vs.a5(this._e),this._m5,this._l),this.tb(i,this._f[0]),this.ta(t),this.th(i,this._f[0],t),this.b(t),this.tb(i,this._f[1]),this.ta(t),this.th(i,this._f[1],t),this.b(t),this.a11(this._f[1]),this.a12(t),this.tb(i,this._f[2]),this.ta(t),this.th(i,this._f[2],t),this.b(t),this.tb(i,this._f[3]),this.ta(t),this.th(i,this._f[3],t),this.b(t),this.a11(this._f[3]),this.a12(t),this.tc(i),this.tj()},a11:function(t){for(var e=0;e<t.length;e++)t[e]=-t[e]},b:function(t){for(var e=0;e<t.length;e++){var i=t[e];i.ax()}for(var n=0;n<t.length;n++)for(var s=0,r=null,a=t[n].x1();a.i1();a.i2()){var o=a.i9(),h=o.al();this._l[h]=s++,this._b[h]=r,this._k[h]=null,null!=r&&(this._k[r.al()]=o),r=o}var l=this._a;this._a=this._h,this._h=l;for(var c=this._m6.xf();c.i1();c.i2()){var u=c.i8(),d=this._m6.gn(u);this._m6.gt(u,new Gn((-d.x),d.y));var f=this._m6.gk(u);this._m6.gz(u,new Gn((-f.x),f.y))}var g=this._l,_=function(t,e){return null==t&&null!=e?1:null!=t&&null==e?-1:null==t&&null==e?0:g[t.a2().al()]-g[e.a2().al()]},p=function(t,e){return null==t&&null!=e?1:null!=t&&null==e?-1:null==t&&null==e?0:g[t.a3().al()]-g[e.a3().al()]};this._m6.x2(_,p)},a12:function(t){for(var e=this._m6.xf();e.i1();e.i2()){var i=e.i8();this._m6.x3(i);var n=this._m6.gn(i),s=this._m6.gk(i);this._m6.gz(i,n),this._m6.gt(i,s)}for(var r=new vs,a=0;a<t.length;a++)r.ae(t[a]);for(var o=0;o<t.length;o++)t[o]=r.au();var h=this._l,l=function(t,e){return null==t&&null!=e?1:null!=t&&null==e?-1:null==t&&null==e?0:h[t.a2().al()]-h[e.a2().al()]},c=function(t,e){return null==t&&null!=e?1:null!=t&&null==e?-1:null==t&&null==e?0:h[t.a3().al()]-h[e.a3().al()]};this._m6.x2(l,c)},tg:function(t,e){var i=t.x0(),n=t.xg();this._l=Rr.a(i),this._b=Rr.d(i),this._k=Rr.d(i),this._m=Rr.d(i),this._i=Rr.d(i),this._o=Rr.d(i),this._f=Rr.e(4,i),this._c=Rr.a(i),this._g=Rr.a(i),this._j=Rr.a(i),this._d=Rr.b(i),this._e=Rr.b(n);for(var s=0;s<e.length;s++)for(var r=0,a=null,o=e[s].x1();o.i1();o.i2()){var h=o.i9(),l=h.al();this._l[l]=r++,this._b[l]=a,this._k[l]=null,null!=a&&(this._k[a.al()]=h),a=h}var c=this._l,u=function(t,e){return null==t&&null!=e?1:null!=t&&null==e?-1:null==t&&null==e?0:c[t.a2().al()]-c[e.a2().al()]},d=function(t,e){return null==t&&null!=e?1:null!=t&&null==e?-1:null==t&&null==e?0:c[t.a3().al()]-c[e.a3().al()]};t.x2(u,d)},tb:function(t,e){for(var i=t.x9();i.i1();i.i2()){var n=i.i9(),s=n.al();this._m[s]=n,this._i[s]=n,e[s]=Number.MAX_VALUE,this._o[s]=n,this._c[s]=Number.MAX_VALUE,this._d[s]=!1,this._j[s]=this._g[s]=0}},ta:function(t){for(var e=1;e<t.length;e++)for(var i=-1,n=t[e]._b;null!=n;n=n.a()){var s=n.d(),r=s.al(),a=s.ak();if(0!==a){var o,h=Math.floor((a+1)/2),l=Math.ceil((a+1)/2),c=1;for(o=s.ae();h>c;o=o.a7())c++;for(var u=!1;l>=c&&!u;c++){var d=this._m6.g2(o),f=o.a2(),g=f.al();this._i[r]===s&&!this._e[o.a5()]&&i<this._l[g]&&(i=this._l[g],this._i[g]=s,this._m[r]=this._m[g],this._i[r]=this._m[r],u=!0,this._j[g]=d.i6().x,this._g[r]=d.i7().x),o=o.a7()}}}},th:function(t,e,i){for(var n=t.x9();n.i1();n.i2()){var s=n.i9(),r=s.al();this._m[r]===s&&this.td(t,s,e)}for(var a=0;a<i.length;a++){var o=i[a].x1();if(o.i1()){var h=i[a].x1().i9(),l=h.al();this._o[this._m[l].al()]===h&&this.tk(t,h,e)}}for(var c=t.x9();c.i1();c.i2()){var u=c.i9(),d=u.al(),f=this._c[this._o[this._m[d].al()].al()];f<Number.MAX_VALUE&&(e[d]+=f)}},td:function(t,e,i){var n=e.al();if(i[n]===Number.MAX_VALUE){i[n]=0;var s=e,r=0;do{var a=s.al();if(a!==n&&(r-=this._g[a]),this._l[a]>0){var o=this._b[a],h=this._m[this._b[a].al()],l=h.al();this.td(t,h,i),this._o[n]===e&&(this._o[n]=this._o[l]),this._o[n]===this._o[l]&&(i[n]=Math.max(i[n],i[o.al()]+this.ti(t,o,s)-r))}r+=this._j[a],s=this._i[a]}while(s!==e);r=0,s=e;do{var c=s.al();c!==n&&(r-=this._g[c]),i[c]=i[n]+r,r+=this._j[c],s=this._i[c]}while(s!==e)}},tk:function(t,e,i){var n=e.al();if(!this._d[n]){this._d[n]=!0;var s=e;do{var r=s.al(),a=this._k[r];if(null!=a){var o=a.al(),h=this._o[this._m[o].al()];if(h!==this._o[n]){var l=i[o]-i[n]-this.ti(t,s,a);this._c[h.al()]!==Number.MAX_VALUE&&(l+=this._c[h.al()]),this._c[this._o[n].al()]=Math.min(this._c[this._o[n].al()],l)}else this.tk(t,this._m[o],i)}s=this._i[r]}while(s!==e)}},tc:function(t){for(var e=Rr.a(4),i=Rr.a(4),n=t.x9();n.i1();n.i2()){var s=n.i9(),r=s.al();i[0]+=this._f[0][r],i[1]+=this._f[1][r],i[2]+=this._f[2][r],i[3]+=this._f[3][r]}i[0]/=t.xa(),i[1]/=t.xa(),i[2]/=t.xa(),i[3]/=t.xa();for(var a=t.x9();a.i1();a.i2()){var o=a.i9(),h=o.al(),l=t.g4(o);e[0]=this._f[0][h]-i[0],e[1]=this._f[1][h]-i[1],e[2]=this._f[2][h]-i[2],e[3]=this._f[3][h]-i[3],e.sort(Rr.n);var c=(e[1]+e[2])/2;t.s1(o,new Gn(c,l.y))}},ti:function(t,e,i){var n,s=t.gj(e),r=t.gj(i);return n=s>1&&r>1?this._m1+(s+r)/2:this._m3+(s+r)/2,this._l[e.al()]<this._l[i.al()]?(null!=this._a&&(n+=this._a.i3(i)),null!=this._h&&(n+=this._h.i3(e))):(null!=this._a&&(n+=this._a.i3(e)),null!=this._h&&(n+=this._h.i3(i))),n},tj:function(){this._l=null,this._b=null,this._k=null,this._e=null,this._m=null,this._i=null,this._f=null,this._c=null,this._o=null,this._d=null,this._j=null,this._g=null},tf:function(t,e,i,n){for(var s=t.length,r=2;s-1>r;r++)for(var a=-1,o=0,h=0,l=t[r].x1(),c=t[r].x1();c.i1();c.i2()){var u=c.i9(),d=null,f=!1;if(1===u.ak()&&(d=u.ae().a2(),null!=i.i1(d)&&null!=i.i1(u)&&(f=!0)),h===t[r].ay()-1||f){for(var g=f?n[d.al()]:t[r-1].ay();h>=o;o++){for(var _=l.i9(),p=_.am();p.i1();p.i2()){var v=p.i8(),m=n[v.a2().al()];(a>m||m>g)&&e.i7(p.i8(),!0)}l.i2()}a=g}h++}}});var Sr=function(t,e){this._b=20,this._a=e,this._d=t,this._f={}};Be.ext(Sr,Object,{a3:function(t){this._b=t},a4:function(t,e,i,n,s){if(this.a2(t)){var r=this.b2(t);r._o=e,r._m=s,r._n=n,r._f=i}},b2:function(t){var e=this._f[t._id];return null==e&&(e=new Cr,this._f[t._id]=e),e},a2:function(t){return null!=this._f[t._id]},c:function(){for(var t=Vs.a1(Rr.a(this._d.xa())),e=Vs.a1(Rr.a(this._d.xa())),i=this._d.x9();i.i1();i.i2()){var n=i.i9();if(this.a2(n)){var s=this.b2(n);t.i6(n,this._b*(s.c()-1)),e.i6(n,this._b*(s.b()-1))}}this._d.x1("D",t),this._d.x1("C",e)},g:function(){this._d.x6("D"),this._d.x6("C")},f:function(){for(var t=this._d.x9();t.i1();t.i2()){var e=t.i9();if(this.a2(e)){var i=this._d.gi(e),n=this._d.gh(e),s=this._d.gj(e),r=this._d.g9(e),a=this.b2(e),o=a._q.ay()+a._b.ay()+a._f,h=a._d.ay()+a._g.ay()+a._o,l=a._i.ay()+a._l.ay()+a._n,c=a._h.ay()+a._k.ay()+a._m,u=this._a.a7(s,o),d=this._a.a7(s,h),f=this._a.a7(r,c),g=this._a.a7(r,l);a.a2(this._a.a8(s,o,u),this._a.a8(s,h,d),this._a.a8(r,c,f),this._a.a8(r,l,g));for(var _=a._j.c1();_.i1();_.i2()){var p=_.i8(),v=this.a1(p),m=this.b1(p),y=new vs;v.b()===m.b()?(v.c()?(y.aa(new Gn(i+a._g._bd*d+a._c,n)),y.aa(new Gn(i+a._g._bd*d+a._c,n-this._b)),a._g._bd++,y.aa(new Gn(i+a._g._bd*d+a._c,n-this._b)),y.aa(new Gn(i+a._g._bd*d+a._c,n)),a._g._bd++,a._g._bc=Math.max(a._g._bc,2)):v.d()?(y.aa(new Gn(i+a._b._bd*u+a._p,n+r)),y.aa(new Gn(i+a._b._bd*u+a._p,n+r+this._b)),a._b._bd++,y.aa(new Gn(i+a._b._bd*u+a._p,n+r+this._b)),y.aa(new Gn(i+a._b._bd*u+a._p,n+r)),a._b._bd++,a._b._bc=Math.max(a._b._bc,2)):v.f()?(y.aa(new Gn(i,n+a._i._bd*g+a._a)),y.aa(new Gn(i-this._b,n+a._i._bd*g+a._a)),a._i._bd++,y.aa(new Gn(i-this._b,n+a._i._bd*g+a._a)),y.aa(new Gn(i,n+a._i._bd*g+a._a)),a._i._bd++,a._i._bc=Math.max(a._i._bc,2)):v.e()&&(y.aa(new Gn(i+s,n+a._h._bd*f+a._e)),y.aa(new Gn(i+s+this._b,n+a._h._bd*f+a._e)),a._h._bd++,y.aa(new Gn(i+s+this._b,n+a._h._bd*f+a._e)),y.aa(new Gn(i+s,n+a._h._bd*f+a._e)),a._h._bd++,a._h._bc=Math.max(a._h._bc,2)),this._d.m1(p,y)):v.c()||m.c()?v.e()||m.e()?(y.aa(new Gn(i+s-a._d._bd*d-a._c,n)),y.aa(new Gn(i+s-a._d._bd*d-a._c,n-this._b*a._d._bc)),y.aa(new Gn(i+s+this._b*a._h._bc,n-this._b*a._d._bc)),y.aa(new Gn(i+s+this._b*a._h._bc,n+a._h._bd*f+a._e)),y.aa(new Gn(i+s,n+a._h._bd*f+a._e)),a._d._bd++,a._d._bc++,a._h._bd++,a._h._bc++,m.c()&&y.ax(),this._d.m1(p,y)):v.f()||m.f()?(y.aa(new Gn(i+a._g._bd*d+a._c,n)),y.aa(new Gn(i+a._g._bd*d+a._c,n-this._b*a._g._bc)),y.aa(new Gn(i-this._b*a._i._bc,n-this._b*a._g._bc)),y.aa(new Gn(i-this._b*a._i._bc,n+a._i._bd*g+a._a)),y.aa(new Gn(i,n+a._i._bd*g+a._a)),a._g._bd++,a._g._bc++,a._i._bd++,a._i._bc++,m.c()&&y.ax(),this._d.m1(p,y)):(v.d()||m.d())&&(y.aa(new Gn(i+s-a._d._bd*d-a._c,n)),y.aa(new Gn(i+s-a._d._bd*d-a._c,n-this._b*a._d._bc)),y.aa(new Gn(i+s+this._b*a.b(),n-this._b*a._d._bc)),y.aa(new Gn(i+s+this._b*a.b(),n+r+this._b*a._q._bc)),y.aa(new Gn(i+s-a._q._bd*u-a._p,n+r+this._b*a._q._bc)),y.aa(new Gn(i+s-a._q._bd*u-a._p,n+r)),a._d._bd++,a._d._bc++,a._k._bc++,a._h._bc++,a._q._bc++,a._q._bd++,m.c()&&y.ax(),this._d.m1(p,y)):v.d()||m.d()?v.e()||m.e()?(y.aa(new Gn(i+s-a._q._bd*u-a._p,n+r)),y.aa(new Gn(i+s-a._q._bd*u-a._p,n+r+this._b*a._q._bc)),y.aa(new Gn(i+s+this._b*a._k._bc,n+r+this._b*a._q._bc)),y.aa(new Gn(i+s+this._b*a._k._bc,n+r-a._k._bd*f-a._e)),y.aa(new Gn(i+s,n+r-a._k._bd*f-a._e)),a._q._bd++,a._q._bc++,a._k._bd++,a._k._bc++,m.d()&&y.ax(),this._d.m1(p,y)):(v.f()||m.f())&&(y.aa(new Gn(i+a._b._bd*u+a._p,n+r)),y.aa(new Gn(i+a._b._bd*u+a._p,n+r+this._b*a._b._bc)),y.aa(new Gn(i-this._b*a._l._bc,n+r+this._b*a._b._bc)),y.aa(new Gn(i-this._b*a._l._bc,n+r-a._l._bd*g-a._a)),y.aa(new Gn(i,n+r-a._l._bd*g-a._a)),a._b._bd++,a._b._bc++,a._l._bd++,a._l._bc++,m.d()&&y.ax(),this._d.m1(p,y)):(y.aa(new Gn(i,n+r-a._l._bd*g-a._a)),y.aa(new Gn(i-this._b*a._l._bc,n+r-a._l._bd*g-a._a)),y.aa(new Gn(i-this._b*a._l._bc,n+r+this._b*a.a1())),y.aa(new Gn(i+s+this._b*a._k._bc,n+r+this._b*a.a1())),y.aa(new Gn(i+s+this._b*a._k._bc,n+r-a._k._bd*f-a._e)),y.aa(new Gn(i+s,n+r-a._k._bd*f-a._e)),a._l._bd++,a._l._bc++,a._b._bc++,a._q._bc++,a._k._bc++,a._k._bd++,m.f()&&y.ax(),this._d.m1(p,y))}}}},a5:function(t,e){for(var i=0;i<t.length;i++)for(var n=t[i],s=e[i],r=n.x1();r.i1();r.i2()){var a=r.i9();if(this.a2(a)){var o=this.b2(a);s._g=Math.max(s._g,this._b*(o.d()-1)),s._j=Math.max(s._j,this._b*(o.a1()-1))}}},a1:function(t){var e=this._d.xc("A"),i=null;if(null!=e&&(i=e.i1(t)),null==i||i.g()){var n=this._d.xc("B");if(null==n)return _r.j(1);var s=n.i1(t);if(null==s||s.g())return _r.j(1);if(s.c())return _r.j(8);if(s.f())return _r.j(1);if(s.d())return _r.j(4);if(s.e())return _r.j(2)}return i},b1:function(t){var e=this._d.xc("B"),i=null;if(null!=e&&(i=e.i1(t)),null==i||i.g()){var n=this._d.xc("A");if(null==n)return _r.j(8);var s=n.i1(t);if(null==s||s.g())return _r.j(8);if(s.c())return _r.j(8);if(s.f())return _r.j(1);if(s.d())return _r.j(4);if(s.e())return _r.j(2)}return i}});var Cr=function(){this._o=0,this._f=0,this._n=0,this._m=0,this._c=0,this._p=0,this._e=0,this._a=0,this._j=new ms,this._g=new xr,this._d=new xr,this._b=new xr,this._q=new xr,this._h=new xr,this._k=new xr,this._i=new xr,this._l=new xr};Be.ext(Cr,Object,{a1:function(){return Math.max(this._q._bc,this._b._bc)},d:function(){return Math.max(this._d._bc,this._g._bc)},b:function(){return Math.max(this._k._bc,this._h._bc)},c:function(){return Math.max(this._l._bc,this._i._bc)},a2:function(t,e,i,n){this._c=e,this._a=n,this._p=t,this._e=i,this._g.c0(),this._d.c0(),this._b.c0(),this._q.c0(),this._k.c0(),this._h.c0(),this._l.c0(),this._i.c0()}});var Tr=function(t,e,i,n){this._k=20,this._r=.5,this._d=t,this._c=e,this._j=i,this._m=n,this._i=null!=t.xc("A")||null!=t.xc("B"),this._t=new Mr(t,e,i,n),this._b=new Sr(t,this)};Be.ext(Tr,Object,{a6:function(t){this._k=t,this._t.a1(t),this._b.a3(t)},g1:function(){return this._k},a9:function(t){return this.c1(),t},a5:function(t){return this.a1(),t},b3:function(t){return this.c1(),t=this.c4(t),this._b.c(),t},g2:function(t){return this._b.g(),t},e2:function(t){t=this.f(t),this._b.f()},e1:function(){this._t.d(),null!=this._n&&this._d.xi(this._n),this.a1(),this._d=null},a1:function(){this._i&&(null!=this._q&&(this._d.x1("A",this._q),this._q=null),null!=this._p&&(this._d.x1("B",this._p),this._p=null),null!=this._h&&(this._d.xj(this._h),this._h=null),null!=this._l&&(this._d.xj(this._l),this._l=null))},c1:function(){if(this._i){null==this._h&&(this._h=this._d.xl()),null==this._l&&(this._l=this._d.xl());for(var t=this._d.xf();t.i1();t.i2()){var e=t.i8(),i=null!=this._j.i1(e.a2()),n=null!=this._j.i1(e.a3());if(i&&!n){var s=this._j.i1(e.a2());this._m.i4(s)?this._l.i8(e,_r.h(this._d,s)):this._l.i8(e,_r.i(this._d,s))}else if(!i&&n){var r=this._j.i1(e.a3());this._m.i4(r)?this._h.i8(e,_r.i(this._d,r)):this._h.i8(e,_r.h(this._d,r))}else i||n||(this._m.i4(e)?(this._h.i8(e,_r.i(this._d,e)),this._l.i8(e,_r.h(this._d,e))):(this._h.i8(e,_r.h(this._d,e)),this._l.i8(e,_r.i(this._d,e))))}this._q=this._d.xc("A"),this._p=this._d.xc("B"),this._d.x1("A",this._h),this._d.x1("B",this._l)}},c4:function(t){this._n=this._d.xk(),this._a=this._d.xl(),this._g=this._d.xl();for(var e=new ms,i=new ms,n=new ms,s=new ms,r=new ms,a=new ms,o=new ms,h=new ms,l=new ms,c=this._d.xk(),u=0;u<t.length;u++)for(var d=0,f=t[u].x1();f.i1();)c.i6(f.i9(),d),f.i2(),d++;for(var g=function(t,e){var i=c.i3(t.a3())-c.i3(e.a3());return 0>=i?i>=0?0:-1:1},_=function(t,e){var i=c.i3(t.a2())-c.i3(e.a2());return 0>=i?i>=0?0:-1:1},p=0;p<t.length;p++)for(var v=t[p],m=v._b;null!=m;m=m.a()){var y=m.d();y.av(g),y.au(_);var A=0;e.af(),i.af(),n.af(),s.af(),r.af(),a.af(),o.af(),h.af(),l.af();for(var x=y.ap();x.i1();){var w=x.i8(),b=this.b1(w);null==b||b.d()||b.g()?n.aa(w):b.e()?e.aa(w):b.f()?(i.aa(w),l.aa(w)):b.c()&&(h.aa(w),l.aa(w)),x.i2(),A++}A=0;for(var S=y.am();S.i1();){var C=S.i8(),T=this.a2(C);null==T||T.c()||T.g()?s.aa(C):T.e()?e.aa(C):T.f()?(i.aa(C),l.aa(C)):T.d()&&(a.aa(C),l.aa(C)),S.i2(),A++}var E=c.i3(y);if(!l.ar())for(var L=.1/l.ay(),M=E-.4;!l.ar();M+=L){var P=l.c3();if(P.a2()===y){var k=this._d.xm();this._n.z1(k,P.a2()),this._d.s7(k,1,1),this._c.z1(k,this._c.i1(y)),c.i6(k,M),this._a.i8(P,this._d.gn(P)),this._d.gt(P,ar._A),this._d.xr(P,k,P.a3()),v.ao(k,m)}else{var I=this._d.xm();this._n.z1(I,P.a3()),this._d.s7(I,1,1),this._c.z1(I,this._c.i1(y)),c.i6(I,M),this._g.i8(P,this._d.gk(P)),this._d.gz(P,ar._A),this._d.xr(P,P.a2(),I),v.ao(I,m)}}if(!e.ar())for(var R=.1/e.ay(),D=E+.1;!e.ar();D+=R){var B=e.c3();if(B.a2()===y){var N=this._d.xm();this._n.z1(N,B.a2()),this._d.s7(N,1,1),this._c.z1(N,this._c.i1(y)),c.i6(N,D),this._a.i8(B,this._d.gn(B)),this._d.gt(B,ar._A),this._d.xr(B,N,B.a3()),m=v.an(N,m)}else{var z=this._d.xm();this._n.z1(z,B.a3()),this._d.s7(z,1,1),this._c.z1(z,this._c.i1(y)),c.i6(z,D),this._g.i8(B,this._d.gk(B)),this._d.gz(B,ar._A),this._d.xr(B,B.a2(),z),m=v.an(z,m)}}var O=Tr._z;this._b.a2(y)&&(O=this._b.b2(y));var F=O._b.ay()+a.ay()+y.ao()+r.ay()+O._q.ay();if(F>0)for(var V=this._d.g9(y)/2,U=this._d.gj(y),H=this.a7(U,F),W=-.5*U+this.a8(this._d.gj(y),F,H)+H*(O._b.ay()+a.ay()),X=y.ap();X.i1();X.i2()){var G=X.i8();this.c2(G)||null!=this._j.i1(G.a2())||(this._d.g2(G).i8(new Gn(W,V)),W+=H)}var Z=this._t.a3(y),Y=0,j=0,q=0,K=0;if(null!=Z&&(Y=Z._e.ay(),j=Z._c.ay(),q=Z._b.ay(),K=Z._d.ay()),F=O._g.ay()+Y+h.ay()+y.ak()+o.ay()+j+O._d.ay(),F>0){for(var Q=this._d.gj(y),J=this.a7(Q,F),$=this.a8(Q,F,J),tt=-.5*Q+$+J*(O._g.ay()+Y+h.ay()),et=-this._d.g9(y)/2,it=y.am();it.i1();it.i2()){var nt=it.i8();this.d1(nt)||null!=this._j.i1(nt.a3())||(this._d.g2(nt).i9(new Gn(tt,et)),tt+=J)}if(null!=Z){for(var st=-.5*Q+$+J*(O._g.ay()+h.ay()+Z._e.ay()-1),rt=Z._e.c1();rt.i1();rt.i2()){var at=rt.i8();this._d.u1(at),at.a2()!==y||this.c2(at)?this.d1(at)||(this._d.g2(rt.i8()).i9(new Gn(st,et)),st-=J):(this._d.g2(rt.i8()).i8(new Gn(st,et)),st-=J),this._d.h1(at)}st=.5*Q-$-J*(O._d.ay()+o.ay());for(var ot=Z._c.c1();ot.i1();ot.i2()){var ht=ot.i8();this._d.u1(ht),ht.a2()!==y||this.c2(ht)?this.d1(ht)||(this._d.g2(ot.i8()).i9(new Gn(st,et)),st-=J):(this._d.g2(ot.i8()).i8(new Gn(st,et)),st-=J),this._d.h1(ht)}}}this._b.a2(y)&&this._b.a4(y,Y+h.ay()+y.ak()+o.ay()+j,a.ay()+y.ao()+r.ay(),q+i.ay(),K+e.ay())}return this._d.xi(c),t},a7:function(t,e){return 1>=e?0:t/(e-1+2*this._r)},a8:function(t,e,i){return 1>=e?.5*t:.5*(t-i*(e-1))},f:function(t){var e=this.g1();this._f=this._d.xk();for(var i=0;i<t.length;i++)for(var n=t[i],s=n._b;null!=s;){var r=s.d(),a=this._n.i1(r);if(null!=a||this._t.b2(r))s=s.a();else{var o=new Ns,h=new Ns,l=new Ns,c=new Ns,u=new Ns,d=new Ns,f=new ms,g=new ms,_=new Ir(o,h,l,c,u,d,f,g);this._f.z1(r,_),f.ab(r.am()),g.ab(r.ap());for(var p=s.b();null!=p&&this._n.i1(p.d())===r;p=p.b()){var v=p.d(),m=this.c3(v);m.f()?h.ac(v):m.c()?c.ac(v):m.d()&&d.ac(v)}var y;for(y=s.a();null!=y&&this._n.i1(y.d())===r;y=y.a()){var A=y.d(),x=this.c3(A);x.e()?o.aa(A):x.c()?l.aa(A):x.d()&&u.aa(A)}s=y}}for(var w=this.d2(t),b=0,S=0;S<t.length;S++){var C=w[S];S>0&&(b+=w[S-1]._j+w[S-1]._h+w[S-1]._b),b+=C._g+C._f+C._a+C._d;for(var T=t[S].x1();T.i1();T.i2()){var E=T.i9();this._d.s3(E,this._d.gi(E),this._d.gh(E)+b)}C._c+=b,C._i+=b}for(var L=0;L<t.length;L++)for(var M=t[L],P=M.x1();P.i1();P.i2()){var k=P.i9();null!=this._n.i1(k)&&M.av(P)}for(var I=this,R=function(t,e){return I.a3(t)?I.a3(e)&&I._d.gi(t)>=I._d.gi(e)?-1:1:I.a3(e)?-1:I._d.gi(t)>=I._d.gi(e)?1:-1},D=function(t,e){return I.a3(t)?I.a3(e)?I._d.gi(t)>=I._d.gi(e)?1:-1:1:I.a3(e)?-1:I._d.gi(t)>=I._d.gi(e)?-1:1},B=0;B<t.length;B++)for(var N=w[B],z=t[B].x1();z.i1();z.i2()){var O=z.i9();if(!this._t.b2(O)){var F=this._f.i1(O),V=F._d,U=F._a,H=F._b,W=F._h,X=F._f,G=F._c,Z=F._g,Y=F._e,j=0,q=0,K=0,Q=0,J=O.ao(),$=O.ak(),tt=this._d.gi(O),et=this._d.gh(O),it=this._d.gj(O),nt=this._d.g9(O),st=this._t.a3(O),rt=Tr._z;if(this._b.a2(O)&&(rt=this._b.b2(O)),null!=st){if(j=st._d.ay(),q=st._b.ay(),K=st._e.ay(),Q=st._c.ay(),j>0)for(var at=rt._h.ay()+V.ay()+j+rt._k.ay(),ot=this.a7(nt,at),ht=this.a8(nt,at,ot),lt=et+ht+ot*(rt._h.ay()+this.a4(V)),ct=st._d.c1();ct.i1();ct.i2()){var ut=ct.i8();this._d.u1(ut),ut.a2()===O?this.c2(ut)||this._d.gx(ut,new Gn(tt+it,lt)):(this.d1(ut),this._d.gy(ut,new Gn(tt+it,lt))),lt+=ot,this._d.h1(ut)}if(q>0)for(var dt=rt._i.ay()+U.ay()+q+rt._l.ay(),ft=this.a7(nt,dt),gt=this.a8(nt,dt,ft),_t=et+gt+ft*(rt._i.ay()+this.a4(U)),pt=st._b.c1();pt.i1();pt.i2()){var vt=pt.i8();this._d.u1(vt),vt.a2()===O?this.c2(vt)||this._d.gx(vt,new Gn(tt,_t)):this.d1(vt)||this._d.gy(vt,new Gn(tt,_t)),_t+=ft,this._d.h1(vt)}}if(V.ay()>0){V.a1(R);for(var mt=rt._h.ay()+V.ay()+j+rt._k.ay(),yt=this.a7(nt,mt),At=this.a8(nt,mt,yt),xt=et+At+yt*rt._h.ay(),wt=!0;!V.ar();){var bt=V.x4();if(this.a3(bt)){wt&&(wt=!1,xt+=yt*j);var St=bt.ag(),Ct=this._d.gd(St),Tt=Ct.at();if(Ct.ac(new Gn(Tt.x,N.b())),this.c2(St)){var Et=this._a.i1(St);Ct.ac(new Gn(Tt.x,Et.y+this._d.g6(O))),Ct.ac(new Gn(Et.x+this._d.g5(O),Et.y+this._d.g6(O)))}else Ct.ac(new Gn(Tt.x,xt)),Ct.ac(new Gn(tt+it,xt));this._d.xr(St,O,St.a3()),this._d.m1(St,Ct)}else{var Lt=bt.ae(),Mt=this._d.gd(Lt),Pt=Mt.au();if(Mt.ae(new Gn(Pt.x,N.a())),this.d1(Lt)){var kt=this._g.i1(Lt);Mt.ae(new Gn(Pt.x,kt.y+this._d.g6(O))),Mt.ae(new Gn(kt.x+this._d.g5(O),kt.y+this._d.g6(O)))}else Mt.ae(new Gn(Pt.x,xt)),Mt.ae(new Gn(tt+it,xt));this._d.xr(Lt,Lt.a2(),O),this._d.m1(Lt,Mt)}this._d.x4(bt),xt+=yt}}if(U.ay()>0){U.a1(D);for(var It=rt._i.ay()+U.ay()+q+rt._l.ay(),Rt=this.a7(nt,It),Dt=this.a8(nt,It,Rt),Bt=et+Dt+Rt*rt._i.ay(),Nt=!0;!U.ar();){var zt=U.x4();if(this.a3(zt)){Nt&&(Nt=!1,Bt+=Rt*q);var Ot=zt.ag(),Ft=this._d.gd(Ot),Vt=Ft.at();if(Ft.ac(new Gn(Vt.x,N.b())),this.c2(Ot)){var Ut=this._a.i1(Ot);Ft.ac(new Gn(Vt.x,Ut.y+this._d.g6(O))),Ft.ac(new Gn(Ut.x+this._d.g5(O),Ut.y+this._d.g6(O)))}else Ft.ac(new Gn(Vt.x,Bt)),Ft.ac(new Gn(tt,Bt));this._d.xr(Ot,O,Ot.a3()),this._d.m1(Ot,Ft)}else{var Ht=zt.ae(),Wt=this._d.gd(Ht),Xt=Wt.au();if(Wt.ae(new Gn(Xt.x,N.a())),this.d1(Ht)){var Gt=this._g.i1(Ht);Wt.ae(new Gn(Xt.x,Gt.y+this._d.g6(O))),Wt.ae(new Gn(Gt.x+this._d.g5(O),Gt.y+this._d.g6(O)))}else Wt.ae(new Gn(Xt.x,Bt)),Wt.ae(new Gn(tt,Bt));this._d.xr(Ht,Ht.a2(),O),this._d.m1(Ht,Wt)}this._d.x4(zt),Bt+=Rt}}var Zt=rt._g.ay()+rt._d.ay()+$+W.ay()+H.ay()+K+Q;it=this._d.gj(O);var Yt=this.a7(it,Zt),jt=this.a8(it,Zt,Yt);Zt=rt._b.ay()+rt._q.ay()+J+G.ay()+X.ay();var qt=this.a7(it,Zt),Kt=this.a8(it,Zt,qt);if(W.ay()>0)for(var Qt,Jt=Yt,$t=e,te=this._d.gi(O)+jt+Jt*(rt._g.ay()+W.ay()-1),ee=this._d.gh(O),ie=N._c-N._g-W.ay()*$t;!W.ar();this._d.x4(Qt)){Qt=W.x4();var ne=Qt.ag(),se=this._d.gd(ne),re=se.at();if(se.ac(new Gn(re.x,N.b())),se.ac(new Gn(re.x,ie)),this.c2(ne)){var ae=this._a.i1(ne);se.ac(new Gn(ae.x+this._d.g5(O),ie)),se.ac(new Gn(ae.x+this._d.g5(O),ae.y+this._d.g6(O)))}else se.ac(new Gn(te,ie)),se.ac(new Gn(te,ee)),te-=Jt;ie+=$t,this._d.xr(ne,O,ne.a3()),this._d.m1(ne,se)}if(H.ay()>0)for(var oe,he=Yt,le=e,ce=this._d.gi(O)+this._d.gj(O)-jt-he*rt._d.ay(),ue=this._d.gh(O),de=N._c-N._g-le;!H.ar();this._d.x4(oe)){oe=H.x4();var fe=oe.ag(),ge=this._d.gd(fe),_e=ge.at();if(ge.ac(new Gn(_e.x,N.b())),ge.ac(new Gn(_e.x,de)),this.c2(fe)){var pe=this._a.i1(fe);ge.ac(new Gn(pe.x+this._d.g5(O),de)),ge.ac(new Gn(pe.x+this._d.g5(O),pe.y+this._d.g6(O)))}else ge.ac(new Gn(ce,de)),ge.ac(new Gn(ce,ue)),ce-=he;de-=le,this._d.xr(fe,O,fe.a3()),this._d.m1(fe,ge)}if(G.ay()>0)for(var ve,me=qt,ye=e,Ae=this._d.gi(O)+Kt+me*(rt._b.ay()+G.ay()-1),xe=this._d.gh(O)+this._d.g9(O),we=xe+G.ay()*ye;!G.ar();this._d.x4(ve)){ve=G.x4();var be=ve.ae(),Se=this._d.gd(be),Ce=Se.au();if(Se.ae(new Gn(Ce.x,N.a())),Se.ae(new Gn(Ce.x,we)),this.d1(be)){var Te=this._g.i1(be);Se.ae(new Gn(Te.x+this._d.g5(O),we)),Se.ae(new Gn(Te.x+this._d.g5(O),Te.y+this._d.g6(O)))}else Se.ae(new Gn(Ae,we)),Se.ae(new Gn(Ae,xe)),Ae-=me;we-=ye,this._d.xr(be,be.a2(),O),this._d.m1(be,Se)}if(X.ay()>0)for(var Ee,Le=qt,Me=e,Pe=this._d.gi(O)+this._d.gj(O)-Kt-qt*rt._q.ay(),ke=this._d.gh(O)+this._d.g9(O),Ie=ke+Me;!X.ar();this._d.x4(Ee)){Ee=X.x4();var Re=Ee.ae(),De=this._d.gd(Re),Be=De.au();if(De.ae(new Gn(Be.x,N.a())),De.ae(new Gn(Be.x,Ie)),this.d1(Re)){var Ne=this._g.i1(Re);De.ae(new Gn(Ne.x+this._d.g5(O),Ie)),De.ae(new Gn(Ne.x+this._d.g5(O),Ne.y+this._d.g6(O)))}else De.ae(new Gn(Pe,Ie)),De.ae(new Gn(Pe,ke)),Pe-=Le;Ie+=Me,this._d.xr(Re,Re.a2(),O),this._d.m1(Re,De)}for(;!Y.ar();){var ze=Y.c3(),Oe=this._d.gl(ze);N.a()+12<Oe.y&&this._d.g7(ze).i4(Oe.x,N.a())}for(;!Z.ar();){var Fe=Z.c3(),Ve=this._d.gs(Fe);if(N.b()-12>Ve.y){var Ue=this._d.gf(Fe);Ue.ac(new Gn(Ve.x,N.b())),this._d.s6(Fe,Ue)}}}}for(var He=0;He<t.length;He++)for(var We=t[He],Xe=We._b;null!=Xe;Xe=Xe.a()){var Ge=Xe.d(),Ze=this._t.a3(Ge);null!=Ze&&null!=Ze._a&&(this._d.x4(Ze._a),We.aw(Xe.b()))}return this._d.xi(this._f),this._d.xj(this._a),this._d.xj(this._g),t},c3:function(t){return this.a3(t)?this.b1(t.ag()):this.a2(t.ae())},b1:function(t){return null==this._h?Tr.s:this._h.i1(t)},a2:function(t){return null==this._l?Tr.u:this._l.i1(t)},c2:function(t){if(null==t)return!1;var e=this.b1(t);return null!=e&&e.a()},d1:function(t){if(null==t)return!1;var e=this.a2(t);return null!=e&&e.a()},a3:function(t){return 1===t.ao()},b2:function(t){return 1===t.ak()},a4:function(t){for(var e=0,i=t._b;null!=i;i=i.a())this.b2(i.d())&&e++;return e},d2:function(t){for(var e=this._k,i=Rr.d(t.length+1),n=0;n<t.length;n++){var s=t[n],r=new Pr;i[n]=r,r._c=Number.MAX_VALUE,r._i=Number.MIN_VALUE;for(var a=s.x1();a.i1();a.i2()){var o=a.i9(),h=this._d.gb(o);r._c=Math.min(r._c,h.i2()),r._i=Math.max(r._i,h.i2()+h.i4())}}this._b.a5(t,i);for(var l=0;l<t.length;l++)for(var c=i[l],u=t[l].x1();u.i1();u.i2()){var d=u.i9(),f=this._f.i1(d);null!=f&&(c._h=Math.max(c._h,Math.max(f._f.ay()*e,f._c.ay()*e)),c._f=Math.max(c._f,Math.max(f._b.ay()*e,f._h.ay()*e)))}return i}}),Tr.s=_r.j(2),Tr.u=_r.j(1),Tr._z=new Cr;var Er=function(){this._af=0,this._b=0};Be.ext(Er,Object,{ib:function(t){this._af=t},ia:function(t,e,i){this.a6(t,e,i),this.b2(!1);var n=this.g();if(this.o()&&n>0){for(var s=this.r(),r=0;20>r&&n>0&&this.o();r++){this.b2(!0);var a=this.g();n>a&&(this.a7(s),n=a)}this.b3(s),this.b1()}return this.c()},a6:function(t,e,i){this._b=(new Date).getTime(),this._ac=t,this._ah=e;var n=this;this._p=function(t,e){var i=n._n[t.al()]-n._n[e.al()];return i>0?1:i>=0?0:-1},this._ad=Rr.d(i);for(var s=0;s<this._ad.length;s++)this._ad[s]=new Ns;this._ab=Rr.a(this._ac.x0()),this._f=Rr.d(this._ac.x0()),this._n=Rr.a(this._ac.x0()+1);var r=this._ab;this._o=function(t,e){if(null==t&&null!=e)return 1;if(null!=t&&null==e)return-1;if(null==t&&null==e)return 0;var i=t,n=e,s=i._h,a=i.a2(),o=n.a2(),h=r[a.al()]-r[o.al()];if(0===h){var l=Er.b(_r.h(s,i),s.gn(i)),c=Er.b(_r.h(s,n),s.gn(n)),u=l-c;if(0===u){var d=r[i.a3().al()]-r[n.a3().al()];if(0===d){var f=Er.a(_r.i(s,i),s.gk(i)),g=Er.a(_r.i(s,n),s.gk(n));return f-g}return d}return u}return h},this._l=function(t,e){if(null==t&&null!=e)return 1;if(null!=t&&null==e)return-1;if(null==t&&null==e)return 0;var i=t,n=e,s=i._h,a=i.a3(),o=n.a3(),h=r[a.al()]-r[o.al()];if(0===h){var l=Er.a(_r.i(s,i),s.gk(i)),c=Er.a(_r.i(s,n),s.gk(n)),u=l-c;if(0===u){var d=r[i.a2().al()]-r[n.a2().al()];if(0===d){var f=Er.b(_r.h(s,i),s.gn(i)),g=Er.b(_r.h(s,n),s.gn(n));return f-g}return d}return u}return h},this._z=function(t,e){if(null==t&&null!=e)return 1;if(null!=t&&null==e)return-1;if(null==t&&null==e)return 0;var i=t,n=e,s=i._h,r=Er.b(_r.h(s,i),s.gn(i)),a=Er.b(_r.h(s,n),s.gn(n));return r-a},this._e=function(t,e){if(null==t&&null!=e)return 1;if(null!=t&&null==e)return-1;if(null==t&&null==e)return 0;var i=t,n=e,s=i._h,r=Er.a(_r.i(s,i),s.gk(i)),a=Er.a(_r.i(s,n),s.gk(n));return r-a},this._ac.x2(this._e,this._z)},c:function(){this._ah=null,this._aa=null,this._f=null,this._n=null,this._p=null,this._o=null,this._l=null,this._ac=null;var t=this._ad;return this._ad=null,t},o:function(){var t=(new Date).getTime()-this._b;return t<=this._af},m:function(){for(var t=this,e=function(e,i){return Math.ceil(t._n[e.a3().al()])-Math.ceil(t._n[i.a3().al()])},i=this._ac.x9();i.i1();i.i2()){for(var n=i.i9().aw();n.i1();n.i2())this._n[n.i9().al()]=ar.j();i.i9().av(e)}},b2:function(t){for(var e=0;e<this._ad.length;e++)this._ad[e].af();if(t){this.m();for(var i=0,n=this._ab.length;n>i;i++)this._ab[i]=0;this._ac.x2(null,this._z)}var s=this._ac.xm();this._ah.i7(s,0);for(var r=this._ac.x9();r.i1();r.i2())0===r.i9().ak()&&r.i9()!==s&&this._ac.xo(s,r.i9());var a=new rs(this);a.a6(!0),a.a9(this._ac,s),this._ad[0].at(),this._ac.x4(s),this.d()},a1:function(){this._ac.x2(this._o,this._l);for(var t=0,e=1;e<this._ad.length;e++){var i=this.a2(this._ad[e-1],this._ad[e]);t+=i}var n=0;return t+=n},a2:function(t,e){var i=t.ah(),n=e.ah(),s=new vs,r=new vs;this._aa=Rr.d(this._ac.x0());for(var a=0;i.i1()&&n.i1();n.i2())a+=this.a8(i.i6(),s,r,!0),a+=this.a8(n.i6(),r,s,!1),i.i2();for(;i.i1();i.i2())a+=this.a8(i.i6(),s,r,!0);for(;n.i1();n.i2())a+=this.a8(n.i6(),r,s,!1);return a},a8:function(t,e,i,n){var s=0,r=0,a=0;if(null!=this._aa[t.al()])for(var o=this._aa[t.al()].a(),h=e._b;h!==o;h=h.a()){var l=h._c;l===t?(s++,a+=r,e.aw(h)):r++}var c=s*i.ay()+a;if(n)for(var u=t.ag();null!=u;u=u.a8()){var d=u.a3();this._ab[d.al()]>=this._ab[t.al()]&&(this._aa[d.al()]=i.ae(d))}else for(var f=t.ae();null!=f;f=f.a7()){var g=f.a2();this._ab[g.al()]>this._ab[t.al()]&&(this._aa[g.al()]=i.ae(g))}return c},g:function(){for(var t=this.r(),e=this.a1(),i=!0,n=0;3>n&&this.o()&&e>0;){var s=this.k();e>s?(this.a7(t),e=s):n++,i=!i}if(this.b3(t),this.b1(),e>0){for(var r=1,a=0;1===r&&e>0;a++){this.e(),this.i();var o=this.a1();e>o?(r=1,this.a7(t)):r=-1,e=o}this.b3(t),this.b1()}return e},e:function(){for(var t=this.l(),e=this.r(),i=Rr.d(this._ac.x0()),n=this._ad.length-1;n>=0;n--)for(var s=this._ad[n].ah();s.i1();s.i2()){var r=s.i6();if(1===r.ak()&&1===r.ao()){var a=t.i1(r.ag());if(null!=a&&null==i[a.al()])for(var o=this.a4(r,a),h=a.al(),l=i[h]=Rr.d(o+1),c=l.length-1;c>=0;c--)l[c]=new vs}}for(var u=0;u<this._ad.length;u++)for(var d=this._ad[u].ah();d.i1();d.i2()){var f=d.i6();if(1===f.ak()&&1===f.ao()){var g=t.i1(f.ag());if(null!=g){var _=g.al(),p=this.a4(f,g)-1;i[_][p].ae(f.ae())}}else for(var v=f.ae();null!=v;v=v.a7()){var m=t.i1(v);if(null!=m){var y=m.al(),A=this.a4(f,m)-1;i[y][A].ae(v)}}}for(var x=this._ac.x9();x.i1();x.i2()){var w=x.i9();if(null!=i[w.al()])for(var b=w.ag();null!=b;b=b.a8()){var S=t.i1(b);if(null!=S)for(var C=i[S.al()];C[0].ay()>0;){for(var T,E=0;;){T=C[E].am();var L=T.a3();if(1!==L.ak()||1!==L.ao())break;E++}var M=C[E].at().a3();E--,M=T.a2(),T=C[E].at();for(var P=T.a3();E>=0;)if(e[M.al()]!==e[P.al()]&&(this._ab[M.al()]=e[P.al()]),M=M.ae().a2(),--E>=0){var k=C[E].at();P=k.a3()}}}}this.b1(),this._ac.xj(t)},i:function(){for(var t=this.f(),e=this.r(),i=Rr.d(this._ac.x0()),n=0;n<this._ad.length;n++)for(var s=this._ad[n].ah();s.i1();s.i2()){var r=s.i6();if(1===r.ak()&&1===r.ao()){var a=t.i1(r.ae());if(null!=a&&null==i[a.al()])for(var o=this.a4(a,r),h=a.al(),l=i[h]=Rr.d(o+1),c=l.length-1;c>=0;c--)l[c]=new vs}}for(var u=this._ad.length-1;u>=0;u--)for(var d=this._ad[u].ah();d.i1();d.i2()){var f=d.i6();if(1===f.ak()&&1===f.ao()){var g=t.i1(f.ae());if(null!=g){var _=g.al(),p=this.a4(g,f)-1;i[_][p].ae(f.ag())}}else for(var v=f.ag();null!=v;v=v.a8()){var m=t.i1(v);if(null!=m){var y=m.al(),A=this.a4(m,f)-1;i[y][A].ae(v)}}}for(var x=this._ac.x9();x.i1();x.i2()){var w=x.i9();if(null!=i[w.al()])for(var b=w.ae();null!=b;b=b.a7()){var S=t.i1(b);if(null!=S)for(var C=i[S.al()];C[0].ay()>0;){for(var T,E=0;;){T=C[E].am();var L=T.a2();if(1!==L.ak()||1!==L.ao())break;E++}var M=C[E].at().a2();E--,M=T.a3(),T=C[E].at();for(var P=T.a2();E>=0;)if(e[M.al()]!==e[P.al()]&&(this._ab[M.al()]=e[P.al()]),M=M.ag().a3(),--E>=0){var k=C[E].at();P=k.a2()}}}}this.b1(),this._ac.xj(t)},a4:function(t,e){return this._ah.i2(t)-this._ah.i2(e)},l:function(){for(var t=Vs.a6(Rr.d(this._ac.xg())),e=this._ac.x9();e.i1();e.i2()){var i=e.i9();if(i.ao()>1){for(var n=0,s=i.ag();null!=s;s=s.a8()){var r=s.a3();1===r.ak()&&1===r.ao()&&n++}if(n>1)for(var a=i.ag();null!=a;a=a.a8()){var o=a,h=o.a3();if(1===h.ak()&&1===h.ao()){for(;1===h.ak()&&1===h.ao();h=o.a3())t.i8(o,i),o=h.ag();t.i8(o,i)}}}}return t},f:function(){for(var t=Vs.a6(Rr.d(this._ac.xg())),e=this._ac.x9();e.i1();e.i2()){var i=e.i9();if(i.ak()>1){for(var n=0,s=i.ae();null!=s;s=s.a7()){var r=s.a2();1===r.ak()&&1===r.ao()&&n++}if(n>1)for(var a=i.ae();null!=a;a=a.a7()){var o=a,h=o.a2();if(1===h.ak()&&1===h.ao()){for(;1===h.ak()&&1===h.ao();h=o.a2())t.i8(o,i),o=h.ae();t.i8(o,i)}}}}return t},k:function(){for(var t=1;t<this._ad.length;t++){for(var e=this._ad[t],i=e.ah();i.i1();i.i2()){var n=i.i6();this._n[n.al()]=this.a5(n,e.ay(),n.am(),this._ad[t-1].ay()),this._n[n.al()]+=this._ab[n.al()]/(3*this._ad[t-1].ay())}this.a3(e,this._p)}return this.a1()},a5:function(t,e,i,n){
var s=0;if(0===i.i7())s=n*this._ab[t.al()]/e;else{for(;i.i1();i.i2()){var r=i.i8();s+=r.a2()===t?this._ab[r.a3().al()]:this._ab[r.a2().al()]}s/=i.i7()}return s},a7:function(t){Rr.f(this._ab,t,t.length)},b3:function(t){Rr.f(t,this._ab,t.length)},r:function(){var t=Rr.a(this._ab.length);return this.a7(t),t},d:function(){for(var t=0;t<this._ad.length;t++)for(var e=0,i=this._ad[t].ah();i.i1();)this._ab[i.i6().al()]=e,i.i2(),e++},b1:function(){for(var t=0;t<this._ad.length;t++){for(var e=this._ad[t],i=e._b;null!=i;i=i.a()){var n=i.d();this._f[this._ab[n.al()]]=n}for(var s=0,r=e._b;null!=r;)r.c(this._f[s]),r=r.a(),s++}},a3:function(t,e){for(var i=t.ah(),n=0;n<t.ay();i.i2())this._f[n]=i.i6(),n++;Rr.s(this._f,t.ay(),e);for(var s=0,r=t._b;null!=r;)r.c(this._f[s]),this._ab[this._f[s].al()]=s,r=r.a(),s++}}),Er.b=function(t,e){if(null==t)return 0;var i=t.a()?Math.floor(e.x):0,n=t.a()?Math.floor(e.y):0;return t.e()?1e4-n:t.f()?-1e4+n:t.c()?-2e4-i:i},Er.a=function(t,e){if(null==t)return 0;var i=t.a()?Math.floor(e.x):0,n=t.a()?Math.floor(e.y):0;return t.e()?1e4+n:t.f()?-1e4-n:t.d()?-2e4-i:i};var Lr=function(){Lr.superClass.constructor.call(this),this._i6=0,this._i3=2147483647,this._i0=60,this._iz=20,this._i2=20,this._i4=20,this.i5(!1),this._i7=new Ar,this._i1=new Er,this._i8=new br};Be.ext(Lr,Ws,{j2:function(){return this._i2},i4:function(t){return!0},i3:function(t){this._i6=(new Date).getTime(),gr.d(t,!1);var e=t.xk(),i=t.xk(),n=t.xl(),s=new ms,r=new Tr(t,e,i,n);r.a6(this.j2()),this._i8.i3(this._iz),this._i8.i6(this._i0),this._i8.i4(this._i2),this._i8.i5(this._i4),this._i8.i2(i);for(var a=this._i7.i1(t,e,s),o=s.c1();o.i1();o.i2()){var h=o.i8();n.i7(h,!0);var l=t.gn(h);t.gt(h,t.gk(h)),t.gz(h,l)}this.a2(t,e,i),a=r.a9(a);var c=this.j1(t,e,a);c=r.a5(c),c=r.b3(c),this._i8.i1(t,c,e),c=r.g2(c),r.e2(c),this.b(t,i),this.w(t),this.a1(t,s),r.e1(),t.xj(n),t.xi(i),t.xi(e)},j1:function(t,e,i){if(this._i1 instanceof Er){var n=this._i1,s=(new Date).getTime()-this._i6;n.ib(this._i3-s)}var r=this._i1.ia(t,e,i);return r},a1:function(t,e){for(var i=e.c1();i.i1();i.i2()){var n=i.i8(),s=t.gs(n),r=t.gl(n);t.x3(n);var a=t.gp(n);t.s5(n,a.a()),t.gy(n,s),t.gx(n,r)}},b:function(t,e){for(var i=t.x9();i.i1();i.i2()){var n=i.i9(),s=e.i1(n);if(null!=s&&!t.xp(s)){for(var r=n.am().i8().a2();null!=e.i1(r);r=n.am().i8().a2())n=r;t.u1(s);for(var a=n.ae(),o=new vs;null!=e.i1(a.a3());a=a.a3().ag()){var h=t.gs(a);o.aa(h),o.az(t.gf(a));var l=t.gl(a);l.equals(h)||o.aa(l)}var c=t.gs(a);o.aa(c),o.az(t.gf(a));var u=t.gl(a);u.equals(c)||o.aa(u),t.m1(s,o)}}for(var d=t.x9();d.i1();d.i2())null!=e.i1(d.i9())&&t.x4(d.i9())},w:function(t){for(var e=t.xf();e.i1();e.i2()){var i=e.i8(),n=t.g2(i);if(n.i1()>0){var s=new gn,r=t.gc(i),a=r.c(),o=a.i6();a.i2();var h=o.x,l=o.y;if(a.i1()){var c=a.i6(),u=c.x,d=c.y;for(a.i2();a.i1();a.i2()){var f=a.i6(),g=f.x,_=f.y,p=(h-g)*(d-_)/(l-_)+g;Math.abs(p-u)>=1&&(s.add(c),h=u,l=d),c=f,u=g,d=_}}s.size()<n.i1()&&t.s5(i,new Kn(s))}}},a2:function(t,e,i){var n=t.g8().c1();for(n.i5();n.i1();n.i3()){var s=n.i8().a2(),r=n.i8().a3(),a=e.i2(r)-e.i2(s);if(a>1){for(var o=null,h=null,l=s;a>1;a--)o=t.xm(),t.s7(o,1,1),t.s4(o,ar._A),h=t.xo(l,o),l===s&&t.gt(h,t.gn(n.i8())),e.i7(o,e.i2(l)+1),i.z1(o,n.i8()),l=o;h=t.xo(o,r),t.gz(h,t.gk(n.i8())),t.h1(n.i8())}}}});var Mr=function(t,e,i,n){this._i=20,this._j=t,this._g=e,this._a=i,this._h=n};Be.ext(Mr,Object,{a1:function(t){this._i=t},b2:function(t){return null!=this._e&&this._e.i4(t)},a3:function(t){return null==this._f?null:this._f.i1(t)},d:function(){this._j.xi(this._f),this._j.xi(this._e)}});var Pr=function(){this._c=0,this._i=0,this._g=0,this._j=0,this._f=0,this._h=0,this._d=0,this._e=0,this._a=0,this._b=0};Be.ext(Pr,Object,{a:function(){return this._c-this._g-this._f-this._a},b:function(){return this._i+this._j+this._h+this._b}});var kr=function(){this._d=new ms,this._b=new ms,this._c=new ms,this._e=new ms};Be.ext(kr,Object,{});var Ir=function(t,e,i,n,s,r,a,o){this._d=t,this._a=e,this._b=i,this._h=n,this._f=s,this._c=r,this._e=a,this._g=o};Be.ext(Ir,Object,{});var Rr={};Rr.a=function(t,e){for(var i=[],n=0;t>n;n++)i[n]=e||0;return i},Rr.b=function(t){for(var e=[],i=0;t>i;i++)e[i]=!1;return e},Rr.c=function(t,e){if(t instanceof Gn)return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y<=e.y?0:1;if(t instanceof Zn)return e.width>t.width?-1:e.width<t.width?1:e.height>t.height?-1:e.height>=t.height?0:1;if(t instanceof jn)return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:e.width>t.width?-1:e.width<t.width?1:e.height>t.height?-1:e.height>=t.height?0:1;throw"Unkown Type: "+t},Rr.d=function(t){for(var e=[],i=0;t>i;i++)e[i]=null;return e},Rr.e=function(t,e){for(var i=[],n=0;t>n;n++)i[n]=Rr.a(e);return i},Rr.f=function(t,e,i){for(var n=0;i>n;n++)e[n]=t[n]},Rr.s=function(t,e,i){var n=[];Rr.f(t,n,e),n.sort(i),Rr.f(n,t,e)},Rr.n=function(t,e){return t-e}}(this);